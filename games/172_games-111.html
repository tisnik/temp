<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Historie vývoje poèítaèových her (111. èást - Reality Co-Processor v herní konzoli Nintendo 64)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Historie vývoje poèítaèových her (111. èást - Reality Co-Processor v herní konzoli Nintendo 64)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dne¹ní èásti seriálu o historii vývoje poèítaèových her a herního hardware dokonèíme popis ètvrté významné konzole páté generace &ndash; Nintendo 64. Budeme se zabývat pøedev¹ím èipem nazvaným Reality Co-Processor, který byl urèen jak pro vykreslování 2D a 3D scén, tak i pro syntézu hudby a zvukù.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Historie vývoje poèítaèových her (111. èást - Reality Co-Processor v&nbsp;herní konzoli Nintendo 64)</a></p>
<p><a href="#k02">2. Interní struktura Reality Co-Processoru</a></p>
<p><a href="#k03">3. Reality Signal Processor (RSP)</a></p>
<p><a href="#k04">4. RSP jako jedna z&nbsp;mnoha implementací vektorového procesoru typu SIMD</a></p>
<p><a href="#k05">5. Registry RSP</a></p>
<p><a href="#k06">6. Instrukce RSP</a></p>
<p><a href="#k07">7. Vyu¾ití akumulátorù pøipojených ke ka¾dé ALU v&nbsp;RSP</a></p>
<p><a href="#k08">8. Reality Display Processor (RDP)</a></p>
<p><a href="#k09">9. Pøíkazy posílané do rasterizaèní jednotky</a></p>
<p><a href="#k10">10. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Historie vývoje poèítaèových her (111. èást - Reality Co-Processor v herní konzoli Nintendo 64)</h2>

<p>V&nbsp;pøedchozí èásti tohoto seriálu jsme si popsali dva základní moduly
herní konzole páté generace nazvané <i>Nintendo 64</i>. Jednalo se pøedev¹ím o
centrální procesorovou jednotku zalo¾enou na RISCovém jádru øady <i>MIPS
R4000</i>. Tento mikroprocesor podporoval 32bitové i 64bitové operace a
obsahoval i matematický koprocesor. Minule jsme si té¾ popsali i pamì»ový
subsystém, v&nbsp;nìm¾ byly pou¾ity pamì»ové moduly s&nbsp;architekturou
<i>Rambus</i>. Dnes se budeme pøevá¾nì zabývat tøetím dùle¾itým èipem umístìným
v&nbsp;této herní konzoli. Jedná se o èip nazvaný <i>Reality Co-Processor</i>,
neboli zkrácenì té¾ <i>RCP</i>. V&nbsp;tomto èipu byl implementován pøedev¹ím
grafický a zvukový subsystém a pravdìpodobnì nejzajímavìj¹í vlastností
<i>RCP</i> je jeho programovatelnost a konfigurovatelnost, co¾ napøíklad
znamená, ¾e grafický subsystém (resp.&nbsp;vykreslovací pipeline
s&nbsp;rasterizaèní jednotkou) bylo mo¾né pøeprogramovat, implementovat
v&nbsp;nìm rùzné grafické algoritmy a filtry, vyu¾ít framebuffer jako texturu
pro dal¹í vykreslování atd.</p>

<p>Z&nbsp;dne¹ního pohledu se jednalo o støednì slo¾itý èip s&nbsp;pøibli¾nì
2,6 miliony tranzistorù, jeho¾ plocha byla pøibli¾nì 81mm<sup>2</sup>. Pro
zajímavost: zhruba tøetinu plochy èipu zabíral <i>Display Processor</i>
(tj.&nbsp;konfigurovatelná vykreslovací/rasterizaèní jednotka øízená
specializovanými pøíkazy), dal¹í tøetinu zabraly pamìti pro instrukce, data i
textury a jen pìtina plochy èipu byla rezervována pro vektorový procesor, jeho¾
popisem se budeme zabývat v&nbsp;navazujících kapitolách. Hodinový signál èipu
<i>RCP</i> byl nastaven na frekvenci 62,5 MHz, tj.&nbsp;frekvenci odli¹nou od
hodinové frekvence hlavního procesoru a jeho ¹pièková spotøeba nepøesahovala
2,8W. Díky tomu bylo mo¾né èip chladit pouze s&nbsp;vyu¾itím pasivního
chladièe, podobnì jako tomu bylo v&nbsp;pøípadì hlavního mikroprocesoru.
Komunikace mezi jednotlivými moduly tohoto èipu probíhala po interní 128bitové
sbìrnici, tak¾e pøenosová rychlost se blí¾ila jednomu gigabajtu za sekundu
(62,5&times;128/8).</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Interní struktura Reality Co-Processoru</h2>

<p>Pøi návrhu interní struktury èipu <i>RCP</i> stáli jeho tvùrci pøed úkolem
navrhnout takový èip, který by umo¾nil provádìt syntézu hudby, dekódovat video
a zobrazovat dvoudimenzionální i tøídimenzionální grafické scény. Kdy¾ se
zamyslíme nad tím, co mají tyto ètyøi èinnosti spoleèné, zjistíme, ¾e vìt¹ina
algoritmù z&nbsp;tìchto oblastí vy¾aduje operace typické pro DSP procesory
(sèítání se saturací, operace typu multiply-and-accumulate) a takté¾ práci
s&nbsp;vektory a maticemi. <i>Reality Co-Processor</i> byl následnì navr¾en
takovým zpùsobem, aby tyto operace podporoval, ov¹em na druhou stranu nesmìla
být výrobní cena èipu pøíli¹ velká, proto¾e by mohlo dojít k&nbsp;situaci, kdy
by celá herní konzole <i>Nintendo 64</i> byla dra¾¹í ne¾ herní konzole vyrábìné
konkurencí. Výsledkem snahy o &bdquo;cenovou optimalizaci&ldquo; byl èip
slo¾ený ze dvou modulù &ndash; <i>Reality Signal Processor (RSP)</i> a
<i>Reality Display Processor (RDP)</i>. Oba moduly byly ¹iroce konfigurovatelné
a programovatelné a to dokonce do takové míry, ¾e u <i>RCP</i> bylo mo¾né mìnit
mikrokód na základì po¾adavkù vývojáøù hry.</p>

<img src="http://i.iinfo.cz/images/35/n64-1.png" class="image-159159" width="411" height="110" alt="&#160;" />
<p><i>Obrázek 1: Interní struktura a moduly èipu Reality Co-Processor.</i></p>

<p>Dùle¾itý byl i fakt, ¾e <i>Reality Signal Processor (RSP)</i> byl zamìøen na
práci s&nbsp;vektory, proto¾e kromì klasické ALU, shifteru, pracovních registrù
a (od sebe oddìlených) pamìtí pro instrukce a data obsahoval tento modul i osm
paralelnì pracujících 16/32 bitových aritmeticko-logických jednotek,
z&nbsp;nich¾ ka¾dá byla pøipojena k&nbsp;samostatnému 32bitovému akumulátoru.
Navíc byl <i>Reality Signal Processor</i> vybaven instrukcemi pro naèítání a
automatickou konverzi osmibitových hodnot, co¾ soubì¾nì s&nbsp;podporou operací
se ¹estnáctibitovými a 32bitovými hodnotami dostaèovalo jak pro implementaci
audio algoritmù (digitální filtry, syntéza hudby), tak i pro algoritmy
z&nbsp;oblasti 2D i 3D grafiky. Druhý modul <i>Reality Display Processor
(RDP)</i>, jen¾ byl pøímo øízen z&nbsp;<i>RSP</i>, byl urèen pro vykreslování
2D a 3D scén. Jeho hlavním úkolem bylo vykreslování trojúhelníkù èi obdélníkù,
které mohly být buï vyplnìny barvou nebo pokryty texturou. Dále tento modul
mohl pøi vykreslování provádìt rùzné dal¹í operace, napøíklad aplikace filtrù
atd. Výsledek vykreslování (rasterizace) se ukládal do framebufferu.</p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Reality Signal Processor (RSP)</h2>

<p>V&nbsp;této kapitole si struènì popí¹eme první modul èipu <i>RCP</i>, který
se jmenuje <i>Reality Signal Processor (RSP)</i>. Jedná se v&nbsp;podstatì o
druhý samostatnì pracující mikroprocesor zalo¾ený na jádru <i>MIPS R4000</i>,
podobnì jako hlavní procesorová jednotka popsaná minule. Ov¹em zatímco hlavní
CPU dokázal provádìt operace s&nbsp;32bitovými i 64bitovými operandy, mìl
<i>RSP</i> ponìkud odli¹nou konfiguraci. Tento èip obsahoval 32bitové skalární
pracovní registry a vlastní pamì» pro data i instrukce &ndash; pamì» pro data
mìla kapacitu 4kB a od ní oddìlená pamì» pro data mìla tuté¾ kapacitu 4 kB.
Pokud bylo zapotøebí pracovat s&nbsp;daty èi instrukcemi umístìnými
v&nbsp;hlavní pamìti, musel být proveden pøenos celého bloku dat
s&nbsp;vyu¾itím DMA, proto¾e <i>RCP</i> nemìl do hlavní pamìti pøímý pøístup,
co¾ je podobná koncepce, s&nbsp;jakou jsme se ji¾ nìkolikrát setkali i u
dal¹ích herních konzolí páté generace (souèasnì se v¹ak jedná i o úzké hrdlo
celé konzole, co¾ si uká¾eme na pøíkladu texturovací jednotky).</p>

<p>Jedním z&nbsp;nejvìt¹ích rozdílù mezi hlavní procesorovou jednotkou a
modulem <i>RSP</i> bylo odstranìní instrukcí pro práci s&nbsp;64bitovými
operandy i odstranìní nìkterých &bdquo;pokroèilej¹ích&ldquo; instrukcí typu
<i>branch likely</i> (opìt viz pøedchozí èást, kde jsou tyto instrukce
z&nbsp;tohoto dùvodu explicitnì zmínìny) atd. Ov¹em <i>Reality Signal
Processor</i> byl naproti tomu obohacen o osm vektorových jednotek (<i>Vector
Unit &ndash; VU</i>) pracujících paralelnì, a to se vstupními operandy o ¹íøce
¹estnáct bitù. Ka¾dá vektorová jednotka obsahovala vlastní aritmeticko-logickou
jednotku (ALU), násobièku, shifter a takté¾ 32bitový akumulátor, do nìho¾ se
ukládaly výsledky operací a který mohl slou¾it i jako jeden vstupní operand
(co¾ znamená, ¾e pøi vhodném naprogramování bylo mo¾né provádìt nejenom
16bitové operace, ale i operace èásteènì 32bitové). Navíc ka¾dá vektorová
jednotka obsahovala i obvod umo¾òující provést souèet v¹ech osmi prvkù vektorù.
Celkový výpoèetní výkon byl na dobu vzniku tohoto èipu úctyhodný &ndash;
dosahoval a¾ 500 000 000 operací typu multiply-and-accumulate za sekundu.</p>



<p><a name="k04"></a></p>
<h2 id="k04">4. RSP jako jedna z&nbsp;mnoha implementací vektorového procesoru typu SIMD</h2>

<p><i>Reality Signal Processor</i> je pøíkladem èipu, v&nbsp;nìm¾ se spojily
vlastnosti RISCových procesorù s&nbsp;architekturou <i>SIMD</i> neboli
<i>Single Instruction Multiple Data</i>. Jedná se o v&nbsp;souèasnosti znaènì
populární architekturu, její¾ koøeny ov¹em sahají hluboko do minulosti,
konkrétnì do ¹edesátých a sedmdesátých let minulého století (tato oblast
výpoèetní techniky je spojena se <i>Symourem Crayem</i> a jeho superpoèítaèi).
Do této kategorie patøí ty architektury procesorù, u kterých se pomocí jedné
instrukce mù¾e zpracovat vìt¹í mno¾ství dat. Napøíklad u roz¹íøené instrukèní
sady <strong>MMX</strong> je mo¾né pomocí jediné instrukce provést souèet dvou
vektorù èíselných hodnot. Mù¾e se jednat o osm osmibitových hodnot ulo¾ených
v&nbsp;jednom vektoru, ètyøi ¹estnáctibitové hodnoty v&nbsp;jednom vektoru atd.
Této vlastnosti se dá v&nbsp;mnoha pøípadech vyu¾ít pro urychlení bìhu
programù, proto¾e nìkteré algoritmy (ve skuteènosti je tìchto algoritmù mo¾ná
a¾ udivující poèet) provádí velké mno¾ství stejných operací s&nbsp;rozsáhlým
objemem dat &ndash; napøíklad se mù¾e jednat o aplikaci konvoluèního filtru na
rastrový obrázek, zpracování zvukového signálu, vynásobení matice vektorem,
vynásobení dvou matic atd.</p>

<a href="http://i.iinfo.cz/images/311/pc158-7.png"><img src="http://i.iinfo.cz/images/311/pc158-7-prev.png" width="205" height="270" alt="&#160;" /></a>
<p><i>Obrázek 2: Schéma systému patøícího do kategorie SIMD.</i></p>

<p>Mezi pøednosti èipù nále¾ejících do kategorie <strong>SIMD</strong> patøí
jak relativnì kompaktní instrukèní sada, tak i paralelní a tím pádem i rychlý
bìh mnoha algoritmù, ov¹em za cenu vìt¹ích nárokù kladených na programátora,
popø.&nbsp;na pøekladaè. Stále jen velmi malé mno¾ství programovacích jazykù
toti¾ umo¾òuje explicitnì vyjádøit vektorové èi maticové operace (napøíklad u
pøekladaèe Fortranu urèeného pro superpoèítaèe <i>Cray</i> bylo v&nbsp;manuálu
explicitnì øeèeno, které jazykové konstrukce se budou skuteènì provádìt ve
vektorové &ndash; <strong>SISD</strong> &ndash; jednotce). Z&nbsp;tohoto dùvodu
také není mo¾né vìt¹inu <strong>SIMD</strong> konstrukcí zapsat
v&nbsp;konvenèním vy¹¹ím programovacím jazyce: musí se pou¾ít buï hotová makra,
ruènì optimalizované knihovní funkce nebo specializované programovací jazyky.
Urèitou, ale nezanedbatelnou výjimku pøedstavují <strong>GPU</strong> na
grafických akcelerátorech, které explicitnì pracují s&nbsp;2D a 3D vektory,
pøièem¾ programátor mù¾e pøedem zjistit, které operace budou skuteènì provedeny
paralelnì.</p> 



<p><a name="k05"></a></p>
<h2 id="k05">5. Registry RSP</h2>

<p>Pøi programování modulu <i>Reality Signal Processor</i> mìli vývojáøi
k&nbsp;dispozici dvì skupiny pracovních registrù. V&nbsp;první skupinì se
nacházelo tøicet dva skalárních pracovních registrù, z&nbsp;nich¾ ka¾dý mìl
¹íøku 32 bitù. Tyto pracovní registry mìly stejnou funkci, jakou jsme si
popsali ji¾ v&nbsp;pøedchozí èásti tohoto seriálu &ndash; provádìní bì¾ných
skalárních celoèíselných aritmetických a logických operací, konverzi dat pøi
jejich naèítání a ukládání do pamìti atd. Tato skupina registrù nás tedy dnes
ji¾ nebude dále zajímat, ov¹em o to zajímavìj¹í je druhá skupina pracovních
registrù.</p>

<p>Ve druhé skupinì se nacházelo takté¾ tøicet dva registrù, ov¹em ka¾dý
registr mìl ¹íøku plných 128 bitù. Tìchto 128 bitù bylo internì rozdìleno na
osm èástí, co¾ znamenalo, ¾e se vlastnì jednalo o vektor s&nbsp;osmi prvky,
pøièem¾ ka¾dý prvek mìl bitovou ¹íøku ¹estnáct bitù. Ka¾dý prvek tohoto vektoru
tedy mohl být samostatnì zpracováván jinou vektorovou jednotkou, popø.&nbsp;se
do vybraného registru mohlo ulo¾it osm ¹estnáctibitových výsledkù vypoètených
paralelnì ve v¹ech osmi vektorových jednotkách. Nìkteré instrukce navíc
umo¾òovaly takzvané párování registrù, tj.&nbsp;provádìní 32bitových operací.
Mimochodem &ndash; datová pamì» o kapacitì 4kB, o ní¾ jsme se zmínili <a
href="#k03">ve tøetí kapitole</a>, byla organizována po 128 bitových slovech,
co¾ znamenalo, ¾e celý vektorový registr bylo mo¾né z&nbsp;této pamìti naèíst
èi naopak ulo¾it po pøenosu jediného slova.</p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Instrukce RSP</h2>

<p>Vìt¹ina &bdquo;vektorových&ldquo; instrukcí podporovaných modulem <i>Reality
Signal Processor</i> mìla tøi operandy, co¾ znamená, ¾e dva operandy byly
zdrojové a tøetí operand cílový. Navíc bylo mo¾né u druhého operandu uvést
takzvaný modifikátor, který urèoval, se kterými prvky osmibitového vektoru bude
operace provádìna. Uveïme si jednoduchý pøíklad s&nbsp;instrukcí typu
<strong>vadd</strong> (<i>vector add</i>), tj.&nbsp;instrukcí pro souèet dvou
osmiprvkových vektorù. Jedná se o instrukci se tøemi operandy (dva operandy
zdrojové a jeden operand cílový), pøièem¾ u druhého zdrojového operandu (zde
konkrétnì u vektorového registru <strong>v3</strong>) je uveden
modifikátor:</p>

<table>
<tr><th>Instrukce</th><th>Operace se provede s&nbsp;prvky</th></tr>
<tr><td>vadd $v1, $v2, $v3    </td><td>0 1 2 3 4 5 6 7</td></tr>
<tr><td>vadd $v1, $v2, $v3[0] </td><td>0 0 0 0 0 0 0 0</td></tr>
<tr><td>vadd $v1, $v2, $v3[0q]</td><td>0 1 2 3 0 1 2 3</td></tr>
<tr><td>vadd $v1, $v2, $v3[1q]</td><td>4 5 6 7 4 5 6 7</td></tr>
</table>

<p>Z&nbsp;tohoto pøíkladu je patrné, ¾e i takto jednoduchá instrukce mù¾e být
pøekvapivì flexibilní.</p>

<p>V&nbsp;následující tabulce jsou vypsány základní aritmetické instrukce
provádìné nad osmiprvkovými vektory:</p>

<table>
<tr><th>#</th><th>Instrukce</th><th>Význam</th></tr>
<tr><td>1</td><td>VADD </td><td>souèet vektorù</td></tr>
<tr><td>2</td><td>VSUB </td><td>rozdíl vektorù</td></tr>
<tr><td>3</td><td>VSUT </td><td>opaèný rozdíl vektorù (prohození operandù)</td></tr>
<tr><td>4</td><td>VABS </td><td>výpoèet absolutní hodnoty prvkù vektorù</td></tr>
<tr><td>5</td><td>VADDC</td><td>souèet s pøenosem</td></tr>
<tr><td>6</td><td>VSUBC</td><td>rozdíl s pøenosem</td></tr>
</table>

<p>Vektorové jednotky v¹ak mohly provádìt i rùzné logické a bitové operace,
napøíklad:</p>

<table>
<tr><th> #</th><th>Instrukce</th><th>Význam</th></tr>
<tr><td> 1</td><td>VLT  </td><td>porovnání prvkù vektorù (less than)</td></tr>
<tr><td> 2</td><td>VEQ  </td><td>porovnání prvkù vektorù (equal)</td></tr>
<tr><td> 3</td><td>VNE  </td><td>porovnání prvkù vektorù (not equal)</td></tr>
<tr><td> 4</td><td>VGE  </td><td>porovnání prvkù vektorù (greater than or equal to)</td></tr>
<tr><td> 5</td><td>VCR  </td><td>jednièkový doplnìk (negace)</td></tr>
<tr><td> 6</td><td>VAND </td><td>operace typu AND provádìná nad prvky dvou vektorù</td></tr>
<tr><td> 7</td><td>VNAND</td><td>operace typu NAND provádìná nad prvky dvou vektorù</td></tr>
<tr><td> 8</td><td>VOR  </td><td>operace typu OR provádìná nad prvky dvou vektorù</td></tr>
<tr><td> 9</td><td>VNOR </td><td>operace typu NOR provádìná nad prvky dvou vektorù</td></tr>
<tr><td>10</td><td>VXOR </td><td>operace typu XOR provádìná nad prvky dvou vektorù</td></tr>
<tr><td>11</td><td>VNXOR</td><td>negace XOR provádìná nad prvky dvou vektorù</td></tr>
</table>

<p>Tyto instrukce mají velký význam napøíklad pro implementaci 2D grafických
algoritmù (maskování spritu apod.).</p>



<p><a name="k07"></a></p>
<h2 id="k07">7. Vyu¾ití akumulátorù pøipojených ke ka¾dé ALU v&nbsp;RSP</h2>

<p>Jednou z&nbsp;èasto provádìných operací pøi implementaci rùzných algoritmù
z&nbsp;oblasti zpracování audio signálu èi 2D grafiky, jsou operace typu
multiply-and-accumulate, tj.&nbsp;souèin následovaný pøiètením výsledku souèinu
k&nbsp;mezivýsledku ulo¾eného do akumulátoru. Modul <i>Reality Signal
Processor</i> pro podporu provádìní tìchto operací obsahuje osm 32bitových
akumulátorù, pøièem¾ ka¾dý akumulátor je umístìn na výstupu ALU+shifteru ka¾dé
vektorové jednotky. Instrukèní sada <i>RSP</i> je roz¹íøena o nìkolik
instrukcí, které tento akumulátor vyu¾ívají. Tyto instrukce jsou zalo¾eny na
násobení dvou ¹estnáctibitových operandù, pøièem¾ výsledek je 32bitový. Tento
výsledek je buï pøímo ulo¾en do akumulátoru (tj.&nbsp;pøepí¹e pøedchozí
hodnotu), nebo je pøièten k&nbsp;aktuální hodnotì akumulátoru. Pov¹imnìte si,
¾e se stále jedná o tøíoperandové instrukce i toho, jakým zpùsobem je vypoèten
výsledek vrácený v&nbsp;cílovém operandu:</p>

<table>
<tr><th>#</th><th>Instrukce</th><th>Provádìná operace</th></tr>
<tr><td>1</td><td>VMUDL</td><td>acc  = (src1 * src2) &gt;&gt; 16, dest = acc &amp; 0xffff</td></tr>
<tr><td>2</td><td>VMADL</td><td>acc += (src1 * src2) &gt;&gt; 16, dest = acc &amp; 0xffff</td></tr>
<tr><td>3</td><td>VMUDM</td><td>acc  = (src1 * src2), dest = acc &gt;&gt; 16</td></tr>
<tr><td>4</td><td>VMADM</td><td>acc += (src1 * src2), dest = acc &gt;&gt; 16</td></tr>
<tr><td>5</td><td>VMUDN</td><td>acc  = (src1 * src2), dest = acc &amp; 0xffff</td></tr>
<tr><td>6</td><td>VMADN</td><td>acc += (src1 * src2), dest = acc &amp; 0xffff</td></tr>
<tr><td>7</td><td>VMUDH</td><td>acc  = (src1 * src2) &gt;&gt; 16, dest = acc &gt;&gt; 16</td></tr>
<tr><td>8</td><td>VMADH</td><td>acc += (src1 * src2) &gt;&gt; 16, dest = acc &gt;&gt; 16</td></tr>
</table>

<p>To, ¾e je ¹íøka akumulátoru 32 bitù, zatímco ¹íøka v¹ech operandù jen
¹estnáct bitù, není v&nbsp;oblasti zpracování signálu ¾ádná novinka, proto¾e
v&nbsp;mnoha DSP je ¹íøka akumulátoru vìt¹í ne¾ bitová ¹íøka ostatních registrù
i bunìk operaèní pamìti &ndash; napøíklad mnohé digitální signálové procesory
urèené pro práci s&nbsp;audio signálem zpracovávají sice ¹estnáctibitové
vzorky, ov¹em mezivýsledky jsou ukládány do akumulátoru o ¹íøce 20 èi 24
bitù.</p>

<p>Druhou modifikací sèítaèky a násobièky v&nbsp;mnoha DSP je to, ¾e pracují
s&nbsp;takzvanou <i>saturací</i>. Její princip je velmi jednoduchý &ndash;
výsledky aritmetických operací nepøetíkají (nepoèítá se tedy &bdquo;modulo
N&ldquo;), ale v&nbsp;pøípadì, ¾e je výsledek operace vìt¹í ne¾ nejvy¹¹í
reprezentovatelná hodnota, zapí¹e se do výstupního registru maximální hodnota,
napøíklad 65535 u DSP pracujícího s&nbsp;¹estnáctibitovými èísly bez znaménka
(to je pøesnì pøípad <i>RSP</i>).  Podobnì je tomu u minimálních hodnot, pokud
jsou vzorky reprezentovány èísly se znaménkem. Kvùli saturaci sice takté¾
dochází ke ztrátì informace &ndash; napøíklad oøezání maximálních hodnot u
audio signálu &ndash; jedná se ov¹em o mnohem men¹í zlo, ne¾ kdyby do¹lo
k&nbsp;pøeteèení a ulo¾ení pouze spodních bitù výsledku se zanedbáním bitù
s&nbsp;nejvy¹¹ími váhami.</p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Reality Display Processor (RDP)</h2>

<p>Druhou jednotkou umístìnou na èipu <i>Reality Co-Processor</i> je modul
<i>RDP</i> neboli plným jménem <i>Reality Display Processor</i>. Jedná se o
konfigurovatelnou rasterizaèní a texturovací jednotku øízenou pøíkazy
posílanými z&nbsp;modulu <i>RSP</i> popsaného vý¹e (viz té¾ schéma zobrazené
pod tímto odstavcem). To znamená, ¾e pøi správném naprogramování <i>RSP</i>
bylo zaji¹tìno plnì automatické vykreslování 2D èi 3D scén, a to bez nutnosti
toho, aby do tohoto procesu jakkoli zasahoval hlavní mikroprocesor. <i>Reality
Display Processor</i> byl navíc vybaven i lokální pamìtí o kapacitì ètyøi
kilobajty, která byla pou¾ita pro ulo¾ení právì vyu¾ívané textury. Textury
mohly být ulo¾eny v&nbsp;nìkolika rùzných formátech, od bì¾ného 16bitového èi
24bitového RGBA pøes osmibitový formát s&nbsp;paletou a¾ po formát, v&nbsp;nìm¾
byla textura reprezentována texely se specifikací svìtlosti,
popø.&nbsp;svìtlosti a prùhlednosti (pou¾ití rùzných formátù bylo vynuceno
mj.&nbsp;i relativnì malou kapacitou pamìti pro textury, o ní¾ jsme se zmínili
vý¹e).</p>

<img src="http://i.iinfo.cz/images/244/n64-2.png" class="image-159160" width="513" height="156" alt="&#160;" />
<p><i>Obrázek 3: Reality Display Processor je øízen pøíkazy posílanými
z&nbsp;Reality Signal Processoru.</i></p>

<p><i>Reality Display Processor</i> se od nìkterých dal¹ích dobových 3D
akcelerátorù odli¹oval pøedev¹ím tím, ¾e byl ¹iroce konfigurovatelný, co¾
znamenalo, ¾e programátoøi mohli (samozøejmì opìt pøes <i>RSP</i>)
implementovat celou øadu rùzných grafických algoritmù, vèetnì Gouraudova
stínování, vyu¾ití pamìti hloubky (Z-bufferu), environment mappingu, bilineární
èi dokonce trilineární interpolace pøi texturování popø.&nbsp;provádìní
antialiasingu pøi vykreslování hran. Zejména díky trilineární interpolaci a
antialiasingu byly 3D scény vykreslované herní konzolí <i>Nintendo 64</i>
vìt¹inou kvalitnìj¹í v&nbsp;porovnání s&nbsp;konkurenèními konzolemi, a to
pøesto, ¾e velikost (rozli¹ení) textur byla omezena relativnì malou kapacitou
texturovací pamìti (navíc se pøi pou¾ití trilineární interpolace musela textura
ukládat vícekrát, napøíklad s&nbsp;rozli¹ením 32&times;32 pixelù, 16&times;16
pixelù a 8&times;8 pixelù). Pøi texturování bylo té¾ mo¾né provádìt
perspektivní korekci na úrovni jednotlivých pixelù, pou¾ít framebuffer (do
nìho¾ se vykreslování provádìlo) jako zdroj pro dal¹í texturu (efekty
zrcadlení) apod.</p>



<p><a name="k09"></a></p>
<h2 id="k09">9. Pøíkazy posílané do rasterizaèní jednotky</h2>

<p>Do rasterizaèní jednotky byly z&nbsp;<i>Reality Signal Processoru</i>
postupnì posílány pøíkazy, které jednotka ihned zaèala vykonávat. Vìt¹ina
pøíkazù mìla délku 64 bitù a lze je rozdìlit do tøech kategorií: konfiguraèní
pøíkazy, øízení rasterizaèní a texturovací pipeline a vykreslovací pøíkazy.
Nejkomplexnìj¹í byly konfiguraèní pøíkazy slou¾ící pro nastavení èi
pøenastavení <i>RDP</i>. Mohl se napøíklad pøesnì specifikovat formát
výstupu/framebufferu (RGBA, YUV, intenzita, intenzita+prùhlednost), formát
pixelù ve framebuferu (4bit, 8bit, 16/32bit RGBA), ¹íøka framebufferu, adresa
framebufferu (¹la snadno zmìnit), adresa Z bufferu atd. U textur bylo takté¾
mo¾né pøesnì specifikovat jejich formát.</p>

<img src="http://i.iinfo.cz/images/390/n64-3.png" class="image-159161" width="694" height="121" alt="&#160;" />
<p><i>Obrázek 4: Do RDP vstupují údaje o trojúhelnících/obdélnících i o
texturách, celá vykreslovací pipeline je konfigurovatelná.</i></p>

<p>Nejzajímavìj¹í jsou konfiguraèní pøíkazy urèené pro øízení vykreslování: zde
bylo mo¾né nastavit oøezávací box (scissor test), povolit interpolaci textur
(vèetnì typu interpolace), povolit perspektivní korekci pøi mapování textur,
zapnout dithering (v&nbsp;závislosti na formátu framebufferu), mìnit stav Z
bufferu (zákaz zápisu, zákaz aplikace testu na hloubku fragmentù) apod.</p>

<p>Vykreslovací pøíkazy byly ponìkud pøekvapivì (zejména pøi porovnání
s&nbsp;pøíkazy, které jsme si uvedli u dal¹ích herních konzolí) velmi
jednoduché. Jednalo se o pøíkaz pro vykreslení vyplnìného ètyøúhelníku a o
pøíkaz pro vykreslení ètyøúhelníku pokrytého texturou. Jak budou tyto
ètyøúhelníky vytvoøeny bylo ponecháno na programovatelném modulu <i>RSP</i>,
který vìt¹inou ve svých vektorových jednotkách provádìl jak výpoèty projekce,
tak i výpoèty související s&nbsp;osvìtlovacím modelem. Do poslední skupiny
pøíkazù patøí pøíkazy pro øízení vykreslovací pipeline. Vìt¹inou se pou¾íval
pøíkaz pro synchronizaci pipeline ve chvíli, kdy do¹lo ke zmìnì textury.</p>

<p>Z&nbsp;tohoto popisu je zøejmé, ¾e díky kombinaci <i>RSP</i>
s&nbsp;<i>RDP</i> byl grafický subsystém herní konzole <i>Nintendo 64</i> velmi
flexibilní, ov¹em v&nbsp;nìkterých pøípadech se negativnì projevovalo omezení
rozli¹ení textur kvùli pomìrnì malé kapacitì vyrovnávací pamìti pro
textury. K&nbsp;tomuto tématu se vrátíme pøi popisu a porovnání her vytvoøených
pro jednotlivé herní konzole páté generace.</p>



<p><a name="k10"></a></p>
<h2 id="k10">10. Odkazy na Internetu</h2>

<ol>

<li>Great Microprocessors of the Past and Present: Part IX: Signetics 8x300, Early cambrian DSP ancestor (1978):<br />
<a href="http://www.cpushack.com/CPU/cpu2.html#Sec2Part9">http://www.cpushack.com/CPU/cpu2.html#Sec2Part9</a>
</li>

<li>Introduction to DSP - DSP processors:<br />
<a href="http://www.bores.com/courses/intro/chips/index.htm">http://www.bores.com/courses/intro/chips/index.htm</a>
</li>

<li>The Scientist and Engineer's Guide to Digital Signal Processing:<br />
<a href="http://www.dspguide.com/">http://www.dspguide.com/</a>
</li>

<li>Digital signal processor (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/Digital_signal_processor">http://en.wikipedia.org/wiki/Digital_signal_processor</a>
</li>

<li>Digitální signálový procesor (Wikipedia CZ)<br />
<a href="http://cs.wikipedia.org/wiki/Digitální_signálový_procesor">http://cs.wikipedia.org/wiki/Digitální_signálový_procesor</a>
</li>

<li>Digital Signal Processing FAQs<br />
<a href="http://dspguru.com/dsp/faqs">http://dspguru.com/dsp/faqs</a>
</li>

<li>FIR Filter FAQ<br />
<a href="http://dspguru.com/dsp/faqs/fir">http://dspguru.com/dsp/faqs/fir</a>
</li>

<li>Finite impulse response (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Finite_impulse_response">http://en.wikipedia.org/wiki/Finite_impulse_response</a>
</li>

<li>DSPRelated<br />
<a href="http://www.dsprelated.com/">http://www.dsprelated.com/</a>
</li>

<li>Don't Blame Rare, Blame Rambus<br />
<a href="http://www.therwp.com/forums/showthread.php?t=881">http://www.therwp.com/forums/showthread.php?t=881</a>
</li>

<li>RDRAM<br />
<a href="http://en.wikipedia.org/wiki/RDRAM">http://en.wikipedia.org/wiki/RDRAM</a>
</li>

<li>MIPS Architecture Overview<br />
<a href="http://tams-www.informatik.uni-hamburg.de/applets/hades/webdemos/mips.html">http://tams-www.informatik.uni-hamburg.de/applets/hades/webdemos/mips.html</a>
</li>

<li>MIPS Technologies R3000<br />
<a href="http://www.cpu-world.com/CPUs/R3000/">http://www.cpu-world.com/CPUs/R3000/</a>
</li>

<li>Sony PlayStation (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/PlayStation_(console)">http://en.wikipedia.org/wiki/PlayStation_(console)</a>
</li>

<li>The Official PlayStation muzeum<br />
<a href="http://playstationmuseum.com/playstation-systems/">http://playstationmuseum.com/playstation-systems/</a>
</li>

<li>CPU-collection: IDT R3010 FPU<br />
<a href="http://www.cpu-collection.de/?tn=0&l0=co&l1=IDT&l2=R3010+FPU">http://www.cpu-collection.de/?tn=0&amp;l0=co&amp;l1=IDT&amp;l2=R3010+FPU</a>
</li>

<li>The MIPS R2000 Instruction Set<br />
<a href="http://suraj.lums.edu.pk/~cs423a05/Reference/MIPSCodeTable.pdf">http://suraj.lums.edu.pk/~cs423a05/Reference/MIPSCodeTable.pdf</a>
</li>

<li>Maska mikroprocesoru RISC 1<br />
<a href="http://www.cs.berkeley.edu/~pattrsn/Arch/RISC1.jpg">http://www.cs.berkeley.edu/~pattrsn/Arch/RISC1.jpg</a>
</li>

<li>Maska mikroprocesoru RISC 2<br />
<a href="http://www.cs.berkeley.edu/~pattrsn/Arch/RISC2.jpg">http://www.cs.berkeley.edu/~pattrsn/Arch/RISC2.jpg</a>
</li>

<li>The MIPS Register Usage Conventions<br />
<a href="http://pages.cs.wisc.edu/~cs354-2/beyond354/conventions.html">http://pages.cs.wisc.edu/~cs354-2/beyond354/conventions.html</a>
</li>

<li>C.E. Sequin and D.A.Patterson: Design and Implementation of RISC I<br />
<a href="http://www.eecs.berkeley.edu/Pubs/TechRpts/1982/CSD-82-106.pdf">http://www.eecs.berkeley.edu/Pubs/TechRpts/1982/CSD-82-106.pdf</a>
</li>

<li>Berkeley RISC<br />
<a href="http://en.wikipedia.org/wiki/Berkeley_RISC">http://en.wikipedia.org/wiki/Berkeley_RISC</a>
</li>

<li>Great moments in microprocessor history<br />
<a href="http://www.ibm.com/developerworks/library/pa-microhist.html">http://www.ibm.com/developerworks/library/pa-microhist.html</a>
</li>

<li>Great Microprocessors of the Past and Present<br />
<a href="http://www.cpushack.com/CPU/cpu1.html">http://www.cpushack.com/CPU/cpu1.html</a>
</li>

<li>Sega documentation<br />
<a
href="http://koti.kapsi.fi/~antime/sega/docs.html">http://koti.kapsi.fi/~antime/sega/docs.html</a>
</li>

<li>1995 Programming on the Sega Saturn<br />
<a
href="http://cowboyprogramming.com/2010/06/03/1995-programming-on-the-sega-saturn/">http://cowboyprogramming.com/2010/06/03/1995-programming-on-the-sega-saturn/</a>
</li>

<li>Sega Myths-Saturn was the most difficult console to program for of 5th Gen<br />
<a href="http://forums.sega.com/showthread.php?313485-Sega-Myths-Saturn-was-the-most-difficult-console-to-program-for-of-5th-Gen">http://forums.sega.com/showthread.php?313485-Sega-Myths-Saturn-was-the-most-difficult-console-to-program-for-of-5th-Gen</a>
</li>

<li>SuperH RISC engine Family<br />
<a href="http://www.renesas.com/products/mpumcu/superh/index.jsp">http://www.renesas.com/products/mpumcu/superh/index.jsp</a>
</li>

<li>Sega Saturn<br />
<a href="http://en.wikipedia.org/wiki/Sega_saturn">http://en.wikipedia.org/wiki/Sega_saturn</a>
</li>

<li>Jaguar Sector - II<br />
<a href="http://www.jaguarsector.com/index.php">http://www.jaguarsector.com/index.php</a>
</li>

<li>Atari Age: Atari Jaguar History<br />
<a href="http://www.atariage.com/Jaguar/history.html">http://www.atariage.com/Jaguar/history.html</a>
</li>

<li>Jaguar<br />
<a href="http://www.giantbomb.com/jaguar/3045-28/">http://www.giantbomb.com/jaguar/3045-28/</a>
</li>

<li>Consoles that won't die: The Atari Jaguar<br />
<a href="http://venturebeat.com/2013/04/25/consoles-that-wont-die-atari-jaguar/">http://venturebeat.com/2013/04/25/consoles-that-wont-die-atari-jaguar/</a>
</li>

<li>Atari Jaguar and Atari Jaguar CD<br />
<a href="http://videogamecritic.com/jaguarinfo.htm">http://videogamecritic.com/jaguarinfo.htm</a>
</li>

<li>Atari Jaguar Documentation (Forum)<br />
<a href="http://www.jaguarsector.com/index.php?showforum=65">http://www.jaguarsector.com/index.php?showforum=65</a>
</li>

<li>Atari Jaguar Programming (Forum)<br />
<a href="http://www.jaguarsector.com/index.php?showforum=63">http://www.jaguarsector.com/index.php?showforum=63</a>
</li>

<li>The Jaguar Underground Documentation<br />
<a href="http://justclaws.atari.org/devcats/dox/dox.htm">http://justclaws.atari.org/devcats/dox/dox.htm</a>
</li>

<li>Blitter (Wikipedia CZ)<br />
<a href="http://cs.wikipedia.org/wiki/Blitter">http://cs.wikipedia.org/wiki/Blitter</a>
</li>

<li>Blitter (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/Blitter">http://en.wikipedia.org/wiki/Blitter</a>
</li>

<li>Bit blit<br />
<a href="http://en.wikipedia.org/wiki/Bit_blit">http://en.wikipedia.org/wiki/Bit_blit</a>
</li>

<li>Disassembler for the portable Jaguar DSP emulator (zdrojový kód s&nbsp;instrukcemi)<br />
<a href="http://mamedev.org/source/src/emu/cpu/jaguar/jagdasm.c.html">http://mamedev.org/source/src/emu/cpu/jaguar/jagdasm.c.html</a>
</li>

<li>Fourth-Generation Consoles<br />
<a href="http://gaming.wikia.com/wiki/Fourth-Generation_Consoles">http://gaming.wikia.com/wiki/Fourth-Generation_Consoles</a>
</li>

<li>Fifth-Generation Consoles<br />
<a href="http://gaming.wikia.com/wiki/Fifth-Generation_Consoles">http://gaming.wikia.com/wiki/Fifth-Generation_Consoles</a>
</li>

<li>History of video game consoles (fifth generation)<br />
<a href="http://en.wikipedia.org/wiki/History_of_video_game_consoles_(fifth_generation)">http://en.wikipedia.org/wiki/History_of_video_game_consoles_(fifth_generation)</a>
</li>

<li>Atari Jaguar<br />
<a href="http://gaming.wikia.com/wiki/Atari_Jaguar">http://gaming.wikia.com/wiki/Atari_Jaguar</a>
</li>

<li>Atari Jaguar Games<br />
<a href="http://gaming.wikia.com/wiki/List_of_Atari_Jaguar_games">http://gaming.wikia.com/wiki/List_of_Atari_Jaguar_games</a>
</li>

<li>MyMedia Games Network Retrospective - Nintendo Super FX chip<br />
<a href="http://psp.mmgn.com/News/MyMedia-Games-Network-Retrospe-G6W">http://psp.mmgn.com/News/MyMedia-Games-Network-Retrospe-G6W</a>
</li>

<li>Wikipedia: Super FX<br />
<a href="http://en.wikipedia.org/wiki/Super_FX">http://en.wikipedia.org/wiki/Super_FX</a>
</li>

<li>IGN: Top 25 Consoles<br />
<a href="http://www.ign.com/top-25-consoles/13.html">http://www.ign.com/top-25-consoles/13.html</a>
</li>

<li>Sega Mega Drive<br />
<a href="http://sega.jp/archive/segahard/md/">http://sega.jp/archive/segahard/md/</a>
</li>

<li>The16bit Era Of Console Video Games<br />
<a href="http://tvtropes.org/pmwiki/pmwiki.php/Main/The16bitEraOfConsoleVideoGames">http://tvtropes.org/pmwiki/pmwiki.php/Main/The16bitEraOfConsoleVideoGames</a>
</li>

<li>The Console Wars<br />
<a href="http://www.cracked.com/funny-2590-the-console-wars/">http://www.cracked.com/funny-2590-the-console-wars/</a>
</li>

<li>Console Wars<br />
<a href="http://tvtropes.org/pmwiki/pmwiki.php/Main/ConsoleWars">http://tvtropes.org/pmwiki/pmwiki.php/Main/ConsoleWars</a>
</li>

<li>Era of the "Bit Wars"<br />
<a href="http://www.gtplanet.net/forum/threads/era-of-the-bit-wars.119796/">http://www.gtplanet.net/forum/threads/era-of-the-bit-wars.119796/</a>
</li>

<li>Rez Wars: How the Bit Wars never really ended<br />
<a href="http://www.ign.com/blogs/beastmastertoad/2013/01/31/rez-wars-how-the-bit-wars-never-really-ended">http://www.ign.com/blogs/beastmastertoad/2013/01/31/rez-wars-how-the-bit-wars-never-really-ended</a>
</li>

<li>Which system ended the "Bit Wars"?<br />
<a href="http://atariage.com/forums/topic/199163-which-system-ended-the-bit-wars/">http://atariage.com/forums/topic/199163-which-system-ended-the-bit-wars/</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2014</small></p>
</body>
</html>

