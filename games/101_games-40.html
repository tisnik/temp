<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Historie vývoje poèítaèových her (40. èást - popis herní konzole Sega Mega Drive/Sega Genesis)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Historie vývoje poèítaèových her (40. èást - popis herní konzole Sega Mega Drive/Sega Genesis)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dne¹ní èásti seriálu o historii vývoje výpoèetní techniky se budeme zabývat podrobnìj¹ím popisem herní konzole Sega Mega Drive (Sega Genesis). Popí¹eme si zejména grafický a zvukový subsystém této konzole, proto¾e právì architektura pou¾itá u tìchto dvou modulù ovlivnila mj. i vzhled a chování her, které pro konzoli Sega Mega Drive vznikly.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Historie vývoje poèítaèových her (40. èást - popis herní konzole Sega Mega Drive/Sega Genesis)</a></p>
<p><a href="#k02">2. Grafický subsystém herní konzole Sega Mega Drive a zpìtná kompatibilita èipu VDP v&nbsp;konzoli Sega Mega Drive s&nbsp;pøedchozími verzemi VDP</a></p>
<p><a href="#k03">3. Podporované grafické re¾imy</a></p>
<p><a href="#k04">4. Herní pole (playfields)</a></p>
<p><a href="#k05">5. Scrolling, priorita herních polí a jejich zrcadlení</a></p>
<p><a href="#k06">6. Podpora pro práci se sprity</a></p>
<p><a href="#k07">7. Zvukový subsystém herní konzole Sega Mega Drive</a></p>
<p><a href="#k08">8. Èip Yamaha YM 2612</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Historie vývoje poèítaèových her (40. èást - popis herní konzole Sega Mega Drive/Sega Genesis)</h2>

<p>V&nbsp;dne¹ní èásti <a
href="http://www.root.cz/serialy/unixove-vykopavky/">seriálu o historii vývoje
výpoèetní techniky</a> se budeme zabývat podrobnìj¹ím popisem herní konzole
<i>Sega Mega Drive</i> a.k.a. <i>Sega Genesis</i>. Popí¹eme si pøedev¹ím
grafický a zvukový subsystém této konzole. Nebude se sice jednat o tak podrobný
popis, aby bylo mo¾né ihned zaèít pro <i>Mega Drive</i> vytváøet nové programy
(ano &ndash; mnoho programátorù se právì touto èinností baví, kdy¾ u¾ jsou
unaveni tvorbou &bdquo;enterprise øe¹ení&ldquo; :-), ale ètenáø by mìl získat
alespoò základní informace o mo¾nostech této konzole a porovnat tyto mo¾nosti
s&nbsp;parametry konzolí, které ji¾ byly v&nbsp;tomto seriálu popsány. Pro
pøipomenutí: základní technické parametry o herní konzoli <i>Sega Mega
Drive</i> jsou shrnuty v&nbsp;následující tabulce:</p>

<table>
<tr><th>Vlastnost</th><th>Popis</th></tr>
<tr><td>Výrobce</td><td>SEGA</td></tr>
<tr><td>Zaèátek prodeje</td><td>1988</td></tr>
<tr><td>Mikroprocesor</td><td>MC68HC00 (CMOS varianta Motorola 68000)</td></tr>
<tr><td>Hodinová frekvence CPU</td><td>7,61 èi 7,67 MHz (podle televizní normy)</td></tr>
<tr><td>Koprocesor</td><td>Zilog Z80 (pozdìji kompatibilní èip jiného výrobce)</td></tr>
<tr><td>Grafický øadiè</td><td>VDP 315-5313 (pozdìji obdobné èipy od Yamahy)</td></tr>
<tr><td>Televizní norma</td><td>PAL èi NTSC</td></tr>
<tr><td>Rozli¹ení (NTSC)</td><td>a¾ 320&times;224</td></tr>
<tr><td>Rozli¹ení (PAL)</td><td>a¾ 320&times;240</td></tr>
<tr><td>Zvukový èip (samply+¹um)</td><td>Texas Instruments SN76489</td></tr>
<tr><td>Zvukový èip (FM syntéza)</td><td>Yamaha YM2612</td></tr>
<tr><td>Kapacita RAM</td><td>64 kB</td></tr>
<tr><td>Kapacita Video RAM</td><td>64 kB</td></tr>
<tr><td>Kapacita Color RAM</td><td>64&times;9 bitù</td></tr>
<tr><td>Kapacita Audio RAM</td><td>8 kB</td></tr>
<tr><td></td><td></td></tr>
</table>

<img src="http://i.iinfo.cz/images/625/games100-13.jpg" width="324" height="276" alt="&#160;" />
<p><i>Obrázek 1: Herní konzole Sega Mega Drive.</i></p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Grafický subsystém herní konzole Sega Mega Drive a zpìtná kompatibilita èipu VDP v&nbsp;konzoli Sega Mega Drive s&nbsp;pøedchozími verzemi VDP</h2>

<p>Zaènìme nejdøíve popisem grafického subsystému. Jak jsme si ji¾ øekli
v&nbsp;pøedchozí èásti tohoto seriálu, byl grafický subsystém herní konzole
<i>Sega Mega Drive</i> vytvoøen na bázi èipu oznaèovaného zkratkou <i>VDP</i>
neboli <i>Video Display Processor</i>. Pùvodní varianty tohoto èipu, které byly
zalo¾eny na dnes ji¾ historickém integrovaném obvodu <i>Texas Instruments
TMS9918</i>, byly pou¾ity i v&nbsp;osmibitových konzolích <i>Sega Mark III</i>,
<i>Sega Master System (II)</i> a takté¾ v&nbsp;kapesní herní konzoli <i>Sega
Game Gear</i>. Èip <i>VDP 315-5313</i> pou¾itý v&nbsp;herní konzoli <i>Sega
Mega Drive</i> byl ji¾ ètvrtým vylep¹ením pùvodního designu. Tento integrovaný
obvod byl èásteènì zpìtnì kompatibilní s&nbsp;pøedchozími tøemi variantami
<i>VDP</i>, co¾ je dùle¾ité, proto¾e díky tomu (a takté¾ díky pou¾ití
koprocesoru <i>Zilog Z80</i>) byla zaji¹tìna mo¾nost pøehrávat star¹í
osmibitové hry i na konzoli <i>Sega Mega Drive</i> &ndash; viz té¾ tabulka
zobrazená pod tímto odstavcem:</p>

<table>
<tr><th>Oznaèení èipu</th><th>Pou¾ito v...</th></tr>
<tr><td>315-5124</td><td>Sega Mark III, Sega Master System</td></tr>
<tr><td>315-5246</td><td>Sega Master System II, pozdìj¹í varianty Sega Master System</td></tr>
<tr><td>315-5378</td><td>Game Gear</td></tr>
<tr><td>315-5313</td><td>Genesis, Sega Mega Drive</td></tr>
</table>

<img src="http://i.iinfo.cz/images/315/8001.jpg" width="450" height="394" alt="&#160;" />
<p><i>Obrázek 2: Herní konzole tøetí generace SG-1000 (asijská verze), vybavená
pùvodní variantou grafického øadièe VDP.</i></p>

<p>Grafický øadiè <i>VDP</i> se od pùvodního øadièe <i>Texas Instruments
TMS9918</i> odli¹oval i podporou vìt¹ího poètu grafických re¾imù. Jedná se o
ètyøi pùvodní grafické re¾imy známé nejenom z&nbsp;osmibitových herních konzolí
<i>Sega</i>: textový re¾im, rastrový re¾im <i>Graphic 1</i>, takté¾ rastrový
re¾im <i>Graphic 2</i> a re¾im <i>Multicolor</i> (ten pou¾íval odli¹nou
organizaci grafické pamìti a sna¾il se napodobit klasický framebuffer). Pátý
re¾im se jmenoval <i>Mode 4</i>, co¾ je oznaèení zalo¾ené na pøedpokladu, ¾e
re¾im <i>Multicolor</i> byl pokládán za grafický re¾im èíslo 3. Modernìj¹í
integrovaný obvod <i>VDP 315-5313</i> (a jeho rùzné varianty vyrábìné
spoleèností <i>Yamaha</i>) pou¾itý v&nbsp;konzolích <i>Sega Mega Drive/Sega
Genesis</i> ov¹em dokázal v&nbsp;re¾imu kompatibility pracovat pouze
v&nbsp;re¾imu èíslo 4 (<i>Mode 4</i>) a &ndash; co¾ je asi mnohem dùle¾itìj¹í
&ndash; novì takté¾ nabízel re¾im 5 (<i>Mode 5</i>), jen¾ byl pou¾it u naprosté
vìt¹iny nových her, které pro tyto herní konzole vznikaly. V&nbsp;dal¹ím textu
se z&nbsp;tohoto dùvodu zamìøíme pøedev¹ím na popis èipu <i>VDP</i> nastaveného
do re¾imu 5.</p>

<img src="http://i.iinfo.cz/images/147/8205.jpg" width="450" height="328" alt="&#160;" />
<p><i>Obrázek 3: Herní konzole Sega Master System (SMS), s&nbsp;ní¾ je
kompatibilní i konzole Sega Mega Drive.</i></p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Podporované grafické re¾imy</h2>

<p>V&nbsp;pøedchozí kapitole jsme se zmínili o grafických re¾imech pùvodního
èipu <i>TMS9918</i> i o grafických re¾imech podporovaných v&nbsp;modernìj¹ích
variantách integrovaného obvodu <i>VDP</i>, které jsou od <i>TMS9918</i>
odvozeny. V&nbsp;následující tabulce je v¹ech ¹est re¾imù vypsáno i
s&nbsp;podrobnìj¹ími informacemi o tìchto re¾imech. Ve vìt¹inì grafických
re¾imù bylo kromì pozadí mo¾né pracovat i se sprity:</p>

<table>
<tr><th>Re¾im</th><th>Typ</th><th>Rozli¹ení (znakù)</th><th>Rozli¹ení (pixelù)</th><th>Poznámka</th></tr>
<tr><td>0</td><td>text   </td><td>40&times;24</td><td>320&times;192</td><td>podpora v&nbsp;TMS9918</td></tr>
<tr><td>1</td><td>grafika</td><td>32&times;24</td><td>256&times;192</td><td>podpora v&nbsp;TMS9918</td></tr>
<tr><td>2</td><td>grafika</td><td>32&times;24</td><td>256&times;192</td><td>podpora v&nbsp;TMS9918</td></tr>
<tr><td>3</td><td>grafika</td><td>64&times;48</td><td>64&times;48</td><td>podpora v&nbsp;TMS9918</td></tr>
<tr><td>4</td><td>grafika</td><td>32&times;28/30</td><td>256&times;224/240</td><td>re¾im konzole Sega Master System</td></tr>
<tr><td>5 (A)</td><td>grafika</td><td>32&times;28/30</td><td>256&times;224/240</td><td>nový re¾im konzole Sega Mega Drive</td></tr>
<tr><td>5 (B)</td><td>grafika</td><td>40&times;28/30</td><td>320&times;224/240</td><td>nový re¾im konzole Sega Mega Drive</td></tr>
</table>

<img src="http://i.iinfo.cz/images/621/10104.jpg" width="720" height="540" alt="&#160;" />
<p><i>Obrázek 4: Osazený plo¹ný spoj konzole Sega Mega Drive II<br />
Autor: Nomad (dìkuji!).</i></p>

<p>Je¹tì mo¾ná bude dùle¾ité si zobrazit tabulku, v&nbsp;ní¾ je uvedena
(zpìtná) kompatibilita jednotlivých grafických re¾imù:</p>

<table>
<tr><th>Èip/konzole</th><th>Mode 0</th><th>Mode 1</th><th>Mode 2</th><th>Mode 3</th><th>Mode 4</th><th>Mode 5</th></tr>
<tr><td>Sega Game 1000 (TMS9918)</td><td>A</td><td>A</td><td>A</td><td>A</td><td>-</td><td>-</td></tr>
<tr><td>Sega Master System      </td><td>A</td><td>A</td><td>A</td><td>A</td><td>A</td><td>-</td></tr>
<tr><td>Sega Mega Drive         </td><td>-</td><td>-</td><td>-</td><td>-</td><td>A</td><td>A</td></tr>
</table>

<p>Èip <i>VDP</i> pracoval s&nbsp;grafickými údaji organizovanými do takzvaných
dla¾dic (anglicky <i>tiles</i> èi té¾ ve firemní dokumentaci <i>cells</i>) o
rozmìrech 8&times;8 pixelù, pøièem¾ ka¾dému pixelu v&nbsp;dla¾dici mohla být
pøiøazena jedna z&nbsp;patnácti barev ulo¾ených v&nbsp;barvové paletì. Barvové
palety byly ètyøi, ka¾dá se ¹estnácti barvami, i kdy¾ ¹estnáctá barva mìla
speciální význam, zejména pøi práci se sprity (viz té¾ následující kapitoly).
V¹echny ètyøi barvové palety byly ulo¾eny ve zvlá¹tní oblasti pamìti
s&nbsp;organizací 64&times;9 bitù, pøièem¾ tato pamì» byla pøímo souèástí èipu
<i>VDP</i> (nejednalo se tedy o samostatný integrovaný obvod). Organizace této
pamìti je ponìkud zvlá¹tní z&nbsp;toho dùvodu, proto¾e ka¾dá barva byla ulo¾ena
v&nbsp;devíti bitech: pro ka¾dou barvovou slo¾ku R, G, B byly vyhrazeny tøi
bity. <a href="#k04">V&nbsp;následující kapitole</a> si popí¹eme strukturu
herních polí <i>playfield</i>, <a href="#k06">v&nbsp;kapitole ¹esté</a> pak
strukturu spritù.</p>

<img src="http://i.iinfo.cz/images/607/10105.jpg" width="540" height="540" alt="&#160;" />
<p><i>Obrázek 5: Mikroprocesor MC68HC00 na základní desce Sega Mega Drive.<br />
Autor: Nomad.</i></p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Herní pole (playfields)</h2>

<p>Integrovaný obvod <i>Video Display Processor</i> se staral o vykreslování
herní scény na obrazovce televizoru a kromì toho podporoval i blokové pøenosy
dat s&nbsp;vyu¾itím pøímého pøístupu do pamìti (DMA) a takté¾ dokázal generovat
pøeru¹ení na ka¾dém obrazovém øádku (<i>horizontal interrupt</i>) i po
zobrazení ka¾dého snímku (<i>vertical interrupt</i>). Vzhledem k&nbsp;tomu, ¾e
i pøes relativnì vysoký výpoèetní výkon mikroprocesoru <i>Motorola 68000</i> by
bylo dosti nepraktické vytváøet dnes zcela bì¾ný framebuffer, jeho¾ obsah by
byl modifikovatelný pøímo mikroprocesorem, mìl èip <i>VDC</i> pøidìlenou
samostatnou pamì»ovou oblast o velikosti 64 kB, v&nbsp;ní¾ se namísto
klasického framebufferu ukládaly grafické informace strukturované do ji¾
zmínìných dla¾dic o velikostech 8&times;8 pixelù, tak¾e se <i>VDC</i>
v&nbsp;tomto ohledu podobal napøíklad èipu <i>Antic</i>, pøesnìji øeèeno jeho
textovì-grafickým re¾imùm èíslo 12 a 13 (zajímavé je, ¾e podobný pøístup
zvolili i konstruktéøi retro herní konzole <i>Uzebox</i>). Tyto dla¾dice
tvoøily ètyøi roviny (<i>planes</i>), jejich¾ prioritu (dnes bychom
pravdìpodobnì øekli Z-pozici) bylo mo¾né v&nbsp;urèitých rozmezích mìnit. Jedná
se o roviny s&nbsp;následujícími názvy:</p>

<table>
<tr><th>#</th><th>Grafická rovina</th><th>Popis</th></tr>
<tr><td>1</td><td>BACKGROUND</td><td>barva zobrazená na pozadí</td></tr>
<tr><td>2</td><td>SCROLL A</td><td>první herní pole (<i>playfield</i>) dále rozdìlená na dla¾dice o rozmìrech 8&times;8 pixelù</td></tr>
<tr><td>3</td><td>SCROLL B</td><td>druhé herní pole (<i>playfield</i>) dále rozdìlená na dla¾dice o rozmìrech 8&times;8 pixelù</td></tr>
<tr><td>4</td><td>SPRITE</td><td>pohyblivé objekty o rozmìrech 8&times;8 a¾ 32&times;32 pixelù</td></tr>
</table>

<a href="http://i.iinfo.cz/images/260/pc137-1.jpg"><img src="http://i.iinfo.cz/images/260/pc137-1-prev.jpg" width="370" height="269" alt=" " /></a>
<p><i>Obrázek 6: Herní retro konzole Uzebox obsahující osmibitový mikroøadiè
AVR øady ATmega. Zpùsob generování video signálu na této konzoli se do jisté
míry podobal VDP.</i></p>

<p>Roviny nazvané <strong>SCROLL A</strong> a <strong>SCROLL B</strong> se
souhrnnì nazývají herní pole neboli <i>playfield(s)</i>. Ka¾dá rovina je
slo¾ena z&nbsp;men¹ích dla¾dic o rozmìrech 8&times;8 pixelù, pøièem¾ rozmìry
ka¾dé roviny (pøesnìji øeèeno poèet dla¾dic pro ka¾dou rovinu) lze vybrat
z&nbsp;následujících ¹esti mo¾ností: 32&times;32, 32&times;64, 32&times;128,
64&times;32, 64&times;64 a 128&times;32 dla¾dic. Mohlo by se tedy zdát, ¾e
rozmìry obou herních polí urèují i rozli¹ení výsledného obrázku na televizoru,
ve skuteènosti se v¹ak na televizoru vìt¹inou zobrazoval pouze výsek
z&nbsp;obou rovin, proto¾e reálné rozli¹ení bylo urèeno jedním
z&nbsp;následujících podre¾imù grafického re¾imu èíslo 5 (viz té¾ tabulka
uvedená <a href="#k03">v&nbsp;pøedchozí kapitole</a>):</p>

<table>
<tr><th>Re¾im</th><th>Varianta</th><th>TV</th><th>Velikost (dla¾dice)</th><th>Rozli¹ení (pixely)</th></tr>
<tr><td>#5</td><td>#1</td><td>PAL+NTSC</td><td>32&times;28</td><td>256&times;224</td></tr>
<tr><td>#5</td><td>#2</td><td>PAL+NTSC</td><td>40&times;28</td><td>320&times;224</td></tr>
<tr><td>#5</td><td>#3</td><td>pouze PAL</td><td>32&times;30</td><td>256&times;240</td></tr>
<tr><td>#5</td><td>#4</td><td>pouze PAL</td><td>40&times;30</td><td>320&times;240</td></tr>
</table>

<a href="http://i.iinfo.cz/images/260/pc137-15.png"><img src="http://i.iinfo.cz/images/260/pc137-15-prev.png" width="370" height="230" alt=" " /></a>
<p><i>Obrázek 7: Pøedìlávka slavné plo¹inovky z&nbsp;dob osmibitových poèítaèù
Donkey Kong na herní konzoli Uzebox osazenou mikroøadièem AVR ATmega
644.</i></p>



<p><a name="k05"></a></p>
<h2 id="k05">5. Scrolling, priorita herních polí a jejich zrcadlení</h2>

<p>Jak ji¾ název obou herních polí <strong>SCROLL A</strong> a <strong>SCROLL
B</strong> naznaèuje, podporoval èip <i>VDP</i> i jejich scrolling,
tj.&nbsp;plynulý (èi volitelnì naopak ménì plynulý) posun v¹emi smìry.
Posunovat bylo mo¾né ka¾dé herní pole nezávisle na poli druhém. Zajímavé bylo,
¾e informace o posunu herních polí nebyly pøedstavovány pouze dvojicí celých
èísel (horizontální a vertikální posun), ale celou datovou strukturou
umo¾òující poloautomatický scrolling provádìný buï po jednotlivých dla¾dicích,
tedy napøíklad po osmi øádcích, nebo dokonce po jednotlivých obrazových
øádcích, èeho¾ se vyu¾ívalo napøíklad pøi tvorbì efektu vlnícího se nápisu,
simulace 3D zobrazení apod. Se scrollingem souvisí i mo¾nost pøevrátit
jednotlivé dla¾dice okolo horizontální a/nebo vertikální osy, èeho¾ bylo takté¾
mo¾né vyu¾ít pøi tvorbì rùzných grafických efektù. Stejnì jako v&nbsp;pøípadì
spritù (viz té¾ <a href="#k06">následující kapitolu</a>) se pro ka¾dou
dla¾dici, z&nbsp;nich¾ se skládaly obì herní pole, mohla zvolit barvová paleta
a ka¾dý pixel v&nbsp;dla¾dici mohl být nastaven na vybranou barvu
v&nbsp;paletì.</p>

<img src="http://i.iinfo.cz/images/497/10108.jpg" width="540" height="540" alt="&#160;" />
<p><i>Obrázek 8: Mikroprocesor Zilog Z80 na desce Sega Mega Drive II.</i></p>

<p>K&nbsp;prvnímu hernímu poli (<strong>SCROLL A</strong>) byla navíc pøiøazena
datová struktura nazvaná pøíznaènì <strong>WINDOW</strong>. Jednalo se o oblast
zobrazenou na televizoru, která mìla pevnì urèenou pozici, ¹íøku i vý¹ku,
kterou nebylo mo¾né posunovat (scrollovat) a její¾ priorita, tj.&nbsp;Z-pozice
vùèi ostatním tøem rovinám, byla shodná s&nbsp;nastavením priority herního pole
<strong>SCROLL A</strong>. Význam <strong>WINDOW</strong> spoèíval
v&nbsp;mo¾nosti zobrazit nìjakou pevnì umístìnou informaci na obrazovce &ndash;
typicky se jednalo o ukazatel skóre èi ubíhajícího èasu. Podobného efektu by
sice bylo mo¾né dosáhnout i s&nbsp;vyu¾itím spritù, tím by se v¹ak programátoøi
zbyteènì ochuzovali o mo¾nost vyu¾ít sprity pro úèely, k&nbsp;nim¾ byly pùvodnì
vytvoøeny &ndash; k&nbsp;zobrazení pohyblivých objektù. Pokud by se sprity
napøíklad pou¾ily pro zobrazení ¹estimístného skóre, bylo by nutné pro ka¾dou
cifru pou¾ít jeden sprite, èím¾ by programátor &bdquo;zahodil&ldquo; celou
desetinu pou¾itelných spritù.</p>

<p>Zpùsob vzájemné kombinace grafických rovin a nastavení priorit ukazuje
následující schéma:</p>

<pre>
&nbsp;
+--------------+
|              |
|   SCROLL B   +-------+
|              |       |
+--------------+       |
                       |
+--------------+       |                             +---------------------+
|              |       |                             |      BACKGROUND     |
|   SCROLL A   |----+  |    +---------------+        |  +---------------+  |
|              |    |  |    |               |        |  |               |  |
+--------------+    |  +----&gt;   Øízení      |        |  |               |  |
                    o-------&gt;   priority    |-------&gt;   |   Obrazovka   |  |
+--------------+    |  +----&gt;               |        |  |               |  |
|              |    |  |    |               |        |  |               |  |
|    WINDOW    |----+  |    +---------------+        |  +---------------+  |
|              |       |                             |      BACKGROUND     |
+--------------+       |                             +---------------------+
                       |
+--------------+       |
|              |       |
|    SPRITE    +-------+
|              |
+--------------+
&nbsp;
</pre>

<img src="http://i.iinfo.cz/images/456/10109.jpg" width="720" height="538" alt="&#160;" />
<p><i>Obrázek 9: Tento èip obsahuje Video RAM vyu¾ívanou èipem VDP.</i></p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Podpora pro práci se sprity</h2>

<p>Zatímco herní pole (<i>playfield</i>) byla pou¾ívána pøedev¹ím pro zobrazení
relativnì nemìnného herního pozadí, pro práci s&nbsp;pohyblivými objekty se
pou¾ívaly <i>sprity</i>, podobnì jako tomu bylo u grafických subsystémù mnoha
dal¹ích herních konzolí, na mnoha domácích poèítaèích (Atari, Commodore C64,
...) i na nìkterých poèítaèích osobních (Amiga). V&nbsp;pøípadì herní konzole
<i>Sega Mega Drive</i> bylo mo¾né pracovat buï s&nbsp;64 sprity v&nbsp;re¾imu
s&nbsp;horizontálním rozli¹ením 256 pixelù (32 dla¾dic), nebo dokonce
s&nbsp;osmdesáti sprity v&nbsp;re¾imu s&nbsp;horizontálním rozli¹ením 320
pixelù (40 dla¾dic). Na jednom obrazovém øádku v¹ak bylo mo¾né zobrazit pouze
16 (re¾im 256&times;224 pixel) resp.&nbsp;20 (re¾im 320&times;224 pixelù)
spritù souèasnì. Pokud se stalo, ¾e se na jednom obrazovém øádku
z&nbsp;nìjakého dùvodu objevilo vìt¹í mno¾ství spritù, do¹lo k&nbsp;chybám
v&nbsp;zobrazení a navíc se nastavil bitový pøíznak (konkrétnì bit èíslo ¹est)
ve stavovém registru èipu <i>VDP</i>. Základní velikost ka¾dého spritu
odpovídala jedné dla¾dici, tj.&nbsp;obrázku o velikosti 8&times;8 pixelù, ov¹em
ve skuteènosti bylo mo¾né spojit dvì èi ètyøi dla¾dice jak
v&nbsp;horizontálním, tak i ve vertikálním smìru a vyu¾ít tak celkem ¹estnáct
rùzných velikostí spritù:</p>

<pre>
 8&times;8,   8&times;16,   8&times;24,   8&times;32
16&times;8,  16&times;16,  16&times;24,  16&times;32
24&times;8,  24&times;16,  24&times;24,  24&times;32
32&times;8,  32&times;16,  32&times;24,  32&times;32
</pre>

<img src="http://i.iinfo.cz/images/571/101011.jpg" width="540" height="540" alt="&#160;" />
<p><i>Obrázek 10: Obvod pro pøevod RGB na signály kompatibilní s&nbsp;PAL a
NTSC.</i></p>

<p>Ka¾dá dla¾dice o rozmìrech 8&times;8 pixelù byla v&nbsp;pamìti vyhrazené pro
integrovaný obvod <i>VDP</i> ulo¾ena ve 32 bajtech, co¾ znamená, ¾e pro ka¾dý
pixel byly vyhrazeny ètyøi bity. Tyto ètyøi bity (¹estnáct rùzných kombinací)
urèovaly index barvy 0-15 v&nbsp;barvové paletì. Podporovány byly ètyøi barvové
palety (co¾ je oproti pùvodním èipùm <i>VDP</i> a <i>TMS9918</i> dvojnásobek)
po ¹estnácti barvách nastavované pro ka¾dý sprite zvlá¹». Ov¹em jeden index
barvy mìl zvlá¹tní význam, proto¾e tento index slou¾il ke zmìnì priority
zobrazení, tj.&nbsp;pro podporu prùhlednosti oblastí ve spritu &ndash; pøes
sprite v&nbsp;místech pixelù s&nbsp;indexem barvy #15 prosvítala buï barva
pozadí (<strong>BACKGROUND</strong>), barva ulo¾ená v&nbsp;herním poli
<strong>SCROLL A</strong> èi barva ulo¾ená v&nbsp;herním poli <strong>SCROLL
B</strong>, a to v&nbsp;závislosti na nastavené prioritì. Celkem bylo mo¾né
vybrat osm priorit zobrazení, viz té¾ následující tabulka (a schéma
z&nbsp;pøedchozí kapitoly):</p>

<table>
<tr><th>#</th><th>S priority</th><th>A priority</th><th>B priority</th><th>Skuteèná priorita</th></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>S&rarr;A&rarr;B&rarr;G</td></tr>
<tr><td>1</td><td>1</td><td>0</td><td>0</td><td>S&rarr;A&rarr;B&rarr;G</td></tr>
<tr><td>2</td><td>0</td><td>1</td><td>0</td><td>A&rarr;S&rarr;B&rarr;G</td></tr>
<tr><td>3</td><td>1</td><td>1</td><td>0</td><td>S&rarr;A&rarr;B&rarr;G</td></tr>
<tr><td>4</td><td>0</td><td>0</td><td>1</td><td>B&rarr;S&rarr;A&rarr;G</td></tr>
<tr><td>5</td><td>1</td><td>0</td><td>1</td><td>S&rarr;B&rarr;A&rarr;G</td></tr>
<tr><td>6</td><td>0</td><td>1</td><td>1</td><td>A&rarr;B&rarr;S&rarr;G</td></tr>
<tr><td>7</td><td>1</td><td>1</td><td>1</td><td>S&rarr;A&rarr;B&rarr;G</td></tr>
</table>
         
<p>kde znaky S, A a B znamenají:</p>

<table>
<tr><th>Znak</th><th>Význam</th></tr>
<tr><td>S</td><td><strong>SPRITE</strong></td></tr>
<tr><td>A</td><td>herní pole <strong>SCROLL A</strong></td></tr>
<tr><td>B</td><td>herní pole <strong>SCROLL B</strong></td></tr>
<tr><td>G</td><td>barva pozadí (<strong>BACKGROUND</strong>)</td></tr>
</table>

<img src="http://i.iinfo.cz/images/389/101012.jpg" width="720" height="488" alt="&#160;" />
<p><i>Obrázek 11: Krystal v&nbsp;Sega Mega Drive II.</i></p>



<p><a name="k07"></a></p>
<h2 id="k07">7. Zvukový subsystém herní konzole Sega Mega Drive</h2>

<p>Zvukový subsystém herní konzole <i>Sega Mega Drive</i> je stejnì zajímavý
jako její grafický subsystém. I v&nbsp;tomto pøípadì se toti¾ konstruktéøi
herní konzole sna¾ili v&nbsp;co nejvìt¹í míøe u¹etøit práci hlavnímu procesoru
(<i>Motorola 68000</i>) a prakticky ve¹kerou funkcionalitu pøi generování zvukù
a hudby pøevzaly samostatné èipy. Jednalo se pøedev¹ím o osmibitový
mikroprocesor <i>Zilog Z80</i> s&nbsp;pøidìlenou pamìtí o kapacitì osmi
kilobajtù, který kromì jiného zaji¹»oval zpìtnou kompatibilitu se star¹ími
konzolemi, dále pak o integrovaný obvod <i>Texas Instruments 76489</i> urèený
pøedev¹ím pro vytváøení zvukù (nikoli melodií) ve hrách a pøi generování hudby
se pou¾íval poslední èip <i>Yamaha YM 2612</i>. Poznámka: pro osmibitovou herní
konzoli <i>Sega Master System</i> existoval roz¹iøující modul s&nbsp;hudebním
èipem <i>Yamaha YM 2413</i> (obsahovaly ho pravdìpodobnì jen japonské verze),
tento èip nebyl v&nbsp;<i>Sega Mega Drive</i> pou¾íván, i kdy¾ ho teoreticky
bylo mo¾né pøipojit i k&nbsp;této konzoli.</p>

<img src="http://i.iinfo.cz/images/123/8214.jpg" width="450" height="290" alt="&#160;" />
<p><i>Obrázek 12: Interní struktura èipu YM 2413 (není souèástí Sega Mega Drive).</i></p>

<p>Pro práci se zvukem byl urèen relativnì jednoduchý èip <i>Texas Instruments
SN76489</i>, který dokázal generovat (obdélníkové) zvukové signály
s&nbsp;volitelnou frekvencí a amplitudou. Èip <i>SN76489</i> obsahoval tøi
tónové generátory vytváøející periodický obdélníkový signál a jeden generátor
¹umu s&nbsp;periodou 2<sup>15</sup>-1 realizovaný posuvným registrem se zpìtnou
vazbou. Frekvence ka¾dého tónového generátoru byla urèena desetibitovou
konstantou ulo¾enou do øídicího registru èipu <i>SN76489</i>. Tato konstanta
byla pou¾ita ve frekvenèní dìlièce (bì¾ném èítaèi), pøièem¾ reálná frekvence
vytváøeného obdélníkového signálu se vypoèítala následovnì:</p>

<pre>
f=Fosc/32n
</pre>

<p>kde <i>F<sub>osc</sub></i> je frekvence hodinového signálu pøivádìného na
vstup èipu (3,579545 MHz pro konzole urèené pro normu NTSC, 3,546893 MHz pro
konzole pro normu PAL).</p>

<img src="http://i.iinfo.cz/images/456/8008.jpg" width="450" height="198" alt="&#160;" />
<p><i>Obrázek 13: Zvukový èip SN76489.</i></p>

<p>U ka¾dého tónového generátoru bylo takté¾ mo¾né urèit amplitudu pomocí
ètyøbitové hodnoty. Na výstupu se v¹echny zvukové signály seèetly, tak¾e se
rychlou zmìnou amplitudy a vhodným nastavením frekvencí jednotlivých zvukových
kanálù daly generovat i pomìrnì slo¾ité melodie nebo zvuky ve hrách. Jak jsme
se ji¾ øekli v&nbsp;pøedchozím odstavci, obsahoval tento èip navíc jeden
generátor ¹umu, který byl implementován pomocí posuvného registru o ¹íøce 15
bitù se zpìtnou vazbou (bit, který se vracel na vstup posuvného registru, byl
získán logickou operací nonekvivalence (XOR) nejvy¹¹ích bitù posuvného
registru). Pro generátor ¹umu bylo mo¾né zvolit pouze tøi frekvence:
F<sub>osc</sub>/64, F<sub>osc</sub>/128 a F<sub>osc</sub>/256.  Ponìkud
ne¹ikovné je to, ¾e obsah generátoru ¹umu nebylo mo¾né pøeèíst mikroprocesorem,
proto¾e by se tato funkce mohla hodit ve hrách, které mnohdy vy¾adují generátor
(pseudo)náhodných èísel.</p>

<img src="http://i.iinfo.cz/images/483/8009.jpg" width="450" height="424" alt="&#160;" />
<p><i>Obrázek 14: Zpùsob zapojení èipu SN76489.<br />
Zdroj: firemní dokumentace k&nbsp;tomuto èipu.</i></p>

<p>Èip <i>SN76489</i> obsahoval osm øídicích registrù &ndash; tøi registry pro
ulo¾ení konstanty pro dìlièky frekvence tónových generátorù, tøi registry pro
zápis amplitudy tónových generátorù, registr pro øízení generátoru ¹umu a
koneènì registr pro øízení amplitudy a frekvence generátoru ¹umu. Jak je
z&nbsp;tohoto popisu patrné, byly mo¾nosti zvukového èipu <i>SN76489</i>
ponìkud men¹í ne¾ mo¾nosti konkurenèních èipù <i>AY-3-8910</i> èi <i>POKEY</i>,
na druhou stranu ov¹em lep¹í, ne¾ tomu bylo u èipu <i>TIA</i> pou¾itého
v&nbsp;herní konzoli <i>Atari 2600</i>.</p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Èip Yamaha YM 2612</h2>

<p>Pro vytváøení hudby se v&nbsp;herní konzoli <i>Sega Mega Drive</i> pou¾íval
integrovaný obvod nazvaný <i>Yamaha YM 2612</i>, který je v&nbsp;mnoha ohledech
podobný obvodu <i>Yamaha 2151</i>. S&nbsp;druhým jmenovaným integrovaným
obvodem ji¾ mìla spoleènost SEGA urèité zku¹enosti, proto¾e ho pou¾ívala ve
svých video automatech a firma Yamaha tento èip pou¾ívala v&nbsp;nìkterých
svých syntetizérech. Vra»me se k&nbsp;èipu <i>Yamaha YM 2612</i>. Ten
podporoval celkem ¹est kanálù, pøièem¾ se zvuk v&nbsp;ka¾dém kanálu tvoøil
pomocí FM syntézy, tj.&nbsp;podobnì, jak to znají napøíklad programátoøi
zvukové karty <i>Adlib</i> na PC. Kromì ¹esti FM kanálù bylo mo¾né jeden kanál
(konkrétnì ¹estý kanál) nahradit pøímým osmibitovým výstupem &ndash;
tj.&nbsp;vlastnì pøehrávaèem samplù, který v¹ak musel být øízen softwarovì
(nebylo podporováno DMA). Navíc byl èip <i>YM 2612</i> vybaven i dvojicí
èasovaèù vyu¾itelných ve hrách. Tyto èasovaèe v¹ak nebyly pøipojeny na
pøeru¹ovací vstupy mikroprocesoru (ani Motoroly 68000 ani Zilogu Z80), tak¾e
jediné, co &nbsp;nimi programátor mohl dìlat, bylo jejich ètení
v&nbsp;programu.</p>

<p>Pro ka¾dý ze ¹esti FM kanálù byl zvuk vytváøen pomocí ètveøice takzvaných
<i>operátorù</i>, pøièem¾ pro ka¾dý operátor bylo mo¾né zvolit jeho frekvenci a
tvar obálky. Navíc se pro ka¾dý kanál urèila vzájemná konfigurace operátorù
&ndash; zda byl výstup jednoho operátoru pøiveden na vstup operátoru druhého
(FM syntéza) èi zda se výstupy obou operátorù seèetly. Aby byly zvukové
mo¾nosti èipu <i>YM 2612</i> je¹tì vìt¹í, bylo mo¾né pro první operátor
v&nbsp;øadì (u ka¾dého kanálu) povolit zpìtnovazební smyèku, tak¾e se výstup
pøivádìl zpìt na vstup. Ka¾dý FM kanál navíc mohl být ovlivnìn nízkofrekvenèním
oscilátorem (LFO). Mo¾nosti konfigurace v¹ak nebyly tak velké jako
v&nbsp;pøípadì karty <i>Adlib</i> (èip OPL2/YM3812), proto¾e k&nbsp;dispozici
bylo jen osm mo¾ných konfigurací &ndash; takzvaných &bdquo;algoritmù&ldquo;.</p>

<img src="http://i.iinfo.cz/images/346/101010.jpg" width="540" height="540" alt="&#160;" />
<p><i>Obrázek 15: V&nbsp;Sega Mega Drive II byl pou¾it tento integrovaný obvod
obsahující na jednom èipu: VDP, hudební obvod Yamaha 2612 a øadiè
sbìrnice.</i></p>



<p><a name="k09"></a></p>
<h2 id="k09">9. Odkazy na Internetu</h2>

<ol>

<li>SN76489 sound chip details<br />
<a href="http://web.inter.nl.net/users/J.Kortink/home/articles/sn76489/">http://web.inter.nl.net/users/J.Kortink/home/articles/sn76489/</a>
</li>

<li>SN76464 datasheet<br />
<a href="http://www.ic-on-line.cn/view_online.php?id=1106623&file=0054%5Csn76494_409323.pdf">http://www.ic-on-line.cn/view_online.php?id=1106623&file=0054%5Csn76494_409323.pdf</a>
</li>

<li>Texas Instruments SN76489 (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Texas_Instruments_SN76489">http://en.wikipedia.org/wiki/Texas_Instruments_SN76489</a>
</li>

<li>SN76489<br />
<a href="http://www.smspower.org/Development/SN76489?sid=ae16503f2fb18070f3f40f2af56807f1">http://www.smspower.org/Development/SN76489?sid=ae16503f2fb18070f3f40f2af56807f1</a>
</li>

<li>YM2413 FM Operator Type-LL (OPLL) Application Manual<br />
<a href="http://www.smspower.org/maxim/Documents/YM2413ApplicationManual?sid=28c370e1fcac51d5774319979bf96f4c">http://www.smspower.org/maxim/Documents/YM2413ApplicationManual?sid=28c370e1fcac51d5774319979bf96f4c</a>
</li>

<li>Programming the Sega MegaDrive<br />
<a href="http://darkdust.net/writings/megadrive">http://darkdust.net/writings/megadrive</a>
</li>

<li>MegaDrive / SegaGenesis docs<br />
<a href="http://www.genny4ever.net/index.php?page=docs">http://www.genny4ever.net/index.php?page=docs</a>
</li>

<li>IGN: Top 25 Consoles<br />
<a href="http://www.ign.com/top-25-consoles/13.html">http://www.ign.com/top-25-consoles/13.html</a>
</li>

<li>Sega Mega Drive<br />
<a href="http://sega.jp/archive/segahard/md/">http://sega.jp/archive/segahard/md/</a>
</li>

<li>Sega Archives<br />
<a href="http://sega.jp/archive/segahard/">http://sega.jp/archive/segahard/</a>
</li>

<li>Sega Genesisi<br />
<a href="http://www.dmoz.org/Games/Video_Games/Console_Platforms/Sega/Genesis/">http://www.dmoz.org/Games/Video_Games/Console_Platforms/Sega/Genesis/</a>
</li>

<li>The Retro Gen Plays Genesis Games<br />
<a href="http://uk.gamespy.com/articles/998/998637p1.html">http://uk.gamespy.com/articles/998/998637p1.html</a>
</li>

<li>The Sega Mega Drive/Genesis<br />
<a href="http://www.captainwilliams.co.uk/sega/megadrive/megadrive.php">http://www.captainwilliams.co.uk/sega/megadrive/megadrive.php</a>
</li>

<li>Sega Game Gear 101: A Beginner's Guide<br />
<a href="http://www.racketboy.com/retro/sega/gamegear/sega-game-gear-101-a-beginners-guide">http://www.racketboy.com/retro/sega/gamegear/sega-game-gear-101-a-beginners-guide</a>
</li>

<li>SEGA GameGear | Marc's Realm<br />
<a href="http://darkdust.net/retrogaming/gamegear">http://darkdust.net/retrogaming/gamegear</a>
</li>

<li>Sega Master System Hardware<br />
<a href="http://www.smspower.org/Development/Documents">http://www.smspower.org/Development/Documents</a>
</li>

<li>SMS/GG hardware notes<br />
<a href="http://www.smspower.org/uploads/Development/smstech-20021112.txt?sid=28c370e1fcac51d5774319979bf96f4c">http://www.smspower.org/uploads/Development/smstech-20021112.txt?sid=28c370e1fcac51d5774319979bf96f4c</a>
</li>

<li>Sega Master System Museum<br />
<a href="http://alexkidd.com/">http://alexkidd.com/</a>
</li>

<li>Jadeite's Sega Master System Museum<br />
<a href="http://rp_gamer.tripod.com/SMS/1.html">http://rp_gamer.tripod.com/SMS/1.html</a>
</li>

<li>Sega Master System (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Sega_Master_System">http://en.wikipedia.org/wiki/Sega_Master_System</a>
</li>

<li>Sega Card (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Sega_Card">http://en.wikipedia.org/wiki/Sega_Card</a>
</li>

<li>Sega Master System VDP documentation<br />
<a href="http://www.smspower.org/uploads/Development/msvdp-20021112.txt?sid=28c370e1fcac51d5774319979bf96f4c">http://www.smspower.org/uploads/Development/msvdp-20021112.txt?sid=28c370e1fcac51d5774319979bf96f4c</a>
</li>

<li>bee - The Multi-Console Emulator<br />
<a href="http://www.thebeehive.ws/">http://www.thebeehive.ws/</a>
</li>

<li>TurboGrafx-16 TurboExpress<br />
<a href="http://www.allgame.com/platform.php?id=17673">http://www.allgame.com/platform.php?id=17673</a>
</li>

<li>HuC6280 CPU<br />
<a href="http://shu.emuunlim.com/download/pcedocs/pce_cpu.html">http://shu.emuunlim.com/download/pcedocs/pce_cpu.html</a>
</li>

<li>Hudson Soft HuC6280 (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Hudson_Soft_HuC6280">http://en.wikipedia.org/wiki/Hudson_Soft_HuC6280</a>
</li>

<li>TurboGrafx-16 (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/TurboGrafx-16">http://en.wikipedia.org/wiki/TurboGrafx-16</a>
</li>

<li>MagicEngine - TurboGrafx-16 emulator<br />
<a href="http://www.magicengine.com/">http://www.magicengine.com/</a>
</li>

<li>Motorola 68000 CPU<br />
<a href="http://en.wikipedia.org/wiki/68000">http://en.wikipedia.org/wiki/68000</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2012</small></p>
</body>
</html>

