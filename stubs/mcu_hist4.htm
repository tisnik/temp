<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Čtyřbitové mikrořadiče řady Epson S1C60</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Čtyřbitové mikrořadiče řady Epson S1C60</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Předposledními čtyřbitovými mikrořadiči, jimiž se budeme v&nbsp;tomto seriálu zabývat, jsou mikrořadiče řady S1C60 vyráběné společností Epson. Architektura těchto mikrořadičů je poměrně elegantní a tvoří základ k&nbsp;poněkud výkonnějším čipům s&nbsp;jádry S1C63000.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Velký, ale poněkud utajený svět čtyřbitových mikrořadičů</a></p>
<p><a href="#k02">2. Čtyřbitové mikrořadiče Epson S1C60</a></p>
<p><a href="#k03">3. Vstupní a výstupní porty čipu S1C60N05</a></p>
<p><a href="#k04">4. Piny použité pro řízení LCD</a></p>
<p><a href="#k05">5. Programátorský model mikrořadiče: sada registrů</a></p>
<p><a href="#k06">6. Bitové příznaky</a></p>
<p><a href="#k07">7. Struktura programové paměti ROM</a></p>
<p><a href="#k08">8. Struktura datové paměti RAM</a></p>
<p><a href="#k09">9. Speciální paměť používaná při řízení displeje</a></p>
<p><a href="#k10">10. Instrukční soubor mikrořadičů soubor S1C60</a></p>
<p><a href="#k11">11. Aritmetické a logické instrukce</a></p>
<p><a href="#k12">12. Bitové rotace</a></p>
<p><a href="#k13">13. Skoky</a></p>
<p><a href="#k14">14. Instrukce typu Load &amp; Store</a></p>
<p><a href="#k15">15. Práce s&nbsp;příznakovými bity</a></p>
<p><a href="#k16">16. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Velký, ale poněkud utajený svět čtyřbitových mikrořadičů</h2>

<p>Prozatím jsme se v&nbsp;seriálu o architekturách počítačů zabývali některými
již nevyráběnými čtyřbitovými mikrořadiči. Ovšem svět 4bitových MCU je ve
skutečnosti poměrně rozsáhlý a živý, neboť tyto čipy mají mnohdy minimální
spotřebu a proto je lze používat i v&nbsp;takových aplikacích, kde se vyžaduje
dlouhodobý běh na baterie (teploměry, cyklopočítače, termostaty, klíčky
k&nbsp;automobilům...). Jedním z&nbsp;důvodů, proč se s&nbsp;těmito čipy
nesetkáme například v&nbsp;dnes tak populárním segmentu IoT je ten, že
s&nbsp;ohledem na co nejnižší cenu a spotřebu je (bylo) mnoho těchto MCU
nabízeno jen v&nbsp;konfiguraci s&nbsp;pamětí ROM, tj.&nbsp;tato paměť se
inicializovala již při výrobě čipu poslední maskou. Tím pádem jsou tyto
mikrořadiče použity skutečně tam, kde se počítá s&nbsp;velkými výrobními
sériemi, aby se aplikace masky ROM vůbec vyplatila (navíc se poněkud komplikuje
vývoj). Jen pro ilustraci jsou v&nbsp;následující tabulce vypsány známé
čtyřbitové MCU (zdroj: <a
href="https://en.wikichip.org/wiki/4-bit_architecture">https://en.wikichip.org/wiki/4-bit_architecture</a>):</p>

<table>
<tr><th>Výrobce</th><th>Čip</th></tr>
<tr><td>Atmel</td><td>MARC4</td></tr>
<tr><td>AMI</td><td>S2000</td></tr>
<tr><td>Epson</td><td>S1C60</td></tr>
<tr><td>Epson</td><td>S1C63</td></tr>
<tr><td>Fujitsu</td><td>MB88200</td></tr>
<tr><td>Fujitsu</td><td>MB8840/400</td></tr>
<tr><td>Fujitsu</td><td>MB8850/500</td></tr>
<tr><td>Hitachi</td><td>HD404720</td></tr>
<tr><td>Hitachi</td><td>HMCS40</td></tr>
<tr><td>Hitachi</td><td>HMCS400</td></tr>
<tr><td>ITT</td><td>7150</td></tr>
<tr><td>National</td><td>MAPS</td></tr>
<tr><td>National</td><td>COPS I</td></tr>
<tr><td>National</td><td>COPS II</td></tr>
<tr><td>NEC</td><td>17K</td></tr>
<tr><td>NEC</td><td>μCOM-4</td></tr>
<tr><td>NEC</td><td>μPD751</td></tr>
<tr><td>NEC</td><td>μPD707</td></tr>
<tr><td>NEC</td><td>μPD7500</td></tr>
<tr><td>NEC</td><td>μPD75000</td></tr>
<tr><td>Matsushita</td><td>MN1400</td></tr>
<tr><td>Matsushita</td><td>MN1500</td></tr>
<tr><td>Matsushita</td><td>MN1700</td></tr>
<tr><td>Mitsubishi</td><td>MELPS 4</td></tr>
<tr><td>Mitsubishi</td><td>M50430/440</td></tr>
<tr><td>Mitsubishi</td><td>M50460/560</td></tr>
<tr><td>Mitsubishi</td><td>M5072/M5076</td></tr>
<tr><td>Mitsubishi</td><td>M5090</td></tr>
<tr><td>MMI</td><td>5700</td></tr>
<tr><td>OKI</td><td>OLMS-40/50/60/64/65</td></tr>
<tr><td>OKI</td><td>OLMS-63K</td></tr>
<tr><td>OKI</td><td>OLMS-64K</td></tr>
<tr><td>Rockwell</td><td>PPS-4/1</td></tr>
<tr><td>Sanyo</td><td>LC65</td></tr>
<tr><td>Sanyo</td><td>66xx</td></tr>
<tr><td>Sanyo</td><td>LM64xx</td></tr>
<tr><td>Sharp</td><td>SM</td></tr>
<tr><td>Sony</td><td>SPC500</td></tr>
<tr><td>TI</td><td>TMS1000</td></tr>
<tr><td>Toshiba</td><td>T3400</td></tr>
<tr><td>Toshiba</td><td>TLCS-42</td></tr>
<tr><td>Toshiba</td><td>TLCS-43</td></tr>
<tr><td>Toshiba</td><td>TLCS-46A</td></tr>
<tr><td>Toshiba</td><td>TLCS-47</td></tr>
<tr><td>Toshiba</td><td>TLCS-470</td></tr>
<tr><td>WD</td><td>CR1872</td></tr>
<tr><td>WD</td><td>WD4200</td></tr>
</table>



<p><a name="k02"></a></p>
<h2 id="k02">2. Čtyřbitové mikrořadiče Epson S1C60</h2>

<p>Mezi často používané čtyřbitové mikrořadiče patří především řada Epson
S1C60. Ta je zvláštní tím, že zatímco paměť RAM má slova široká čtyři bity,
paměť ROM s&nbsp;programovým kódem používá slova o šířce dvanácti bitů (všechny
instrukce mají tuto šířku). Jedná se o čipy, u nichž se přímo počítá
s&nbsp;tím, že k&nbsp;nim budou připojeny &bdquo;hloupé&ldquo; LCD, tedy
displeje bez vlastního řadiče (ostatně samotný řadič &bdquo;chytrých&ldquo; LCD
by byl pravděpodobně stejně složitý, jako celý mikrořadič S1C60). Proto také
tyto mikrořadiče obsahují poměrně velké množství vstupních a výstupních pinů.
Kapacita operační paměti RAM dosahuje hodnot od 80&times;4 bity až po relativně
vysoké číslo 832&times;4 bity. Kapacita ROM (pravděpodobně jsou dostupné jen
čipy s&nbsp;ROM tvořenou maskou) je 1536&times;12 bitů až 4096&times;12 bitů
v&nbsp;základní sadě. Podívejme se nyní na základní parametry těchto čipů:</p>

<table>
<tr><th>Čip</th><th>RAM</th><th>ROM</th><th>Hodiny (hi-speed)</th><th>Hodiny (low-speed)</th><th>Displej</th><th>Vstupní port</th><th>Výstupní port</th><th>I/O port</th></tr>
<tr><td>S1C60N05</td><td> 80&times;4</td><td>1536&times;12</td><td>&times;</td><td>32768 Hz</td><td>20&times;4/3/2/1</td><td>4 piny</td><td>4 piny</td><td>4 piny</td></tr>
<tr><td>S1C60L05</td><td> 80&times;4</td><td>1536&times;12</td><td>&times;</td><td>32768 Hz</td><td>20&times;4/3/2/1</td><td>4 piny</td><td>4 piny</td><td>4 piny</td></tr>
<tr><td>S1C60N08</td><td>832&times;4</td><td>4096&times;12</td><td>&times;</td><td>32768 Hz</td><td>48&times;4/3/2/1</td><td>9 pinů</td><td>8 pinů</td><td>8 pinů</td></tr>
<tr><td>S1C60L08</td><td>832&times;4</td><td>4096&times;12</td><td>&times;</td><td>32768 Hz</td><td>48&times;4/3/2/1</td><td>9 pinů</td><td>8 pinů</td><td>8 pinů</td></tr>
<tr><td>S1C60A08</td><td>832&times;4</td><td>4096&times;12</td><td>500 kHz</td><td>32768 Hz</td><td>48&times;4/3/2/1</td><td>9 pinů</td><td>8 pinů</td><td>8 pinů</td></tr>
<tr><td>S1C60N16</td><td>256&times;4</td><td>4096&times;12</td><td>&times;</td><td>32768 Hz</td><td>38&times;4/3/2/1</td><td>5 pinů</td><td>8 pinů</td><td>8 pinů</td></tr>
<tr><td>S1C60L16</td><td>256&times;4</td><td>4096&times;12</td><td>&times;</td><td>32768 Hz</td><td>38&times;4/3/2/1</td><td>5 pinů</td><td>8 pinů</td><td>8 pinů</td></tr>
<tr><td>S1C60A16</td><td>256&times;4</td><td>4096&times;12</td><td>1 MHz  </td><td>32768 Hz</td><td>38&times;4/3/2/1</td><td>5 pinů</td><td>8 pinů</td><td>8 pinů</td></tr>
</table>

<p>Typická konfigurace, kde tento čip najdete: digitální teploměr s&nbsp;jedním
interním a jedním externím čidlem, LCD dokáže zobrazit dvě teploty (vnější,
vnitřní) + několik dalších symbolů na sedmisegmentovém displeji,
k&nbsp;dispozici je i <a
href="https://en.wikipedia.org/wiki/Piezoelectric_speaker">piezoelektrický
reproduktor</a>, který například oznamuje bod mrazu a teploměr se ovládá
několika tlačítky s&nbsp;programově řízenou detekcí zákmitů. Taktéž je možné
zobrazit minimální či maximální dosažené teploty a čas.</p>

<p>Poznámka: nejnižší napájecí napětí vyžaduje čip S1C60L08, a to konkrétně
pouze 0,9V při maximálním odběru proudu 2,2 &micro;A (do toho se ale nepočítá
řízení LCD).</p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Vstupní a výstupní porty čipu S1C60N05</h2>

<p>Z&nbsp;tabulky uvedené <a href="#k02">v&nbsp;předchozí kapitole</a> vyplývá,
že nejmenším čipem z&nbsp;celé série S1C60 je mikrořadič s&nbsp;označením
<strong>S1C60N05</strong>. Pojďme si nyní tento mikrořadič popsat podrobněji.
Celý čip se dodává v&nbsp;pouzdru se šedesáti vývody. Kromě pinů určených pro
napájení samotného mikrořadiče popř.&nbsp;připojeného LCD (ten může mít až tři
odlišná napájecí napětí) nalezneme na pouzdru tyto piny, které je možné
programově ovládat:</p>

<ul>

<li>Čtyři vstupní piny označované <strong>K00</strong> až <strong>K03</strong>.
Změna stavu libovolného vstupního pinu může podle nastavení vygenerovat
přerušení (přerušovací rutinu).</li>

<li>Čtyři výstupní piny označované <strong>R00</strong> až
<strong>R03</strong>. Na vývody <strong>R00</strong> nebo <strong>R01</strong>
je možné v&nbsp;případě potřeby připojit piezoelektrický reproduktor a poslat
na tyto piny zvolenou frekvenci 2kHz nebo 4kHz.</li>

<li>Čtyři vstupně/výstupní piny <strong>P00</strong> až <strong>P03</strong>.
Jejich funkce se přepíná bitovým příznakem <strong>IOC</strong>
v&nbsp;konfiguračním registru (jinými slovy jsou buď všechny tyto piny vstupní
nebo všechny výstupní).</li>

<li>Jeden vstupní pin <strong>TEST</strong>. Tento pin není součástí žádného
portu a je používán při testování čipu výrobcem (tím pádem není přesný popis
chování k&nbsp;dispozici).</li>

<li>Ovládání LCD přes piny <strong>COM0</strong> až <strong>COM3</strong>.</li>

<li>Přímé ovládání segmentů LCD přes piny <strong>SEG0</strong> až
<strong>SEG19</strong> (další mikrořadiče z&nbsp;řady S1C60 mohou ovládat i
displeje s&nbsp;větším množstvím segmentů).</li>

<li>Analogové rozhraní představované piny <strong>ADOUT</strong>,
<strong>RS</strong>, <strong>TH1</strong>, <strong>TH2</strong> a
<strong>CS</strong>.</li>

</ul>

<p>Poznámka: vzhledem k&nbsp;tomu, že piezzo reproduktor je připojen na
generátor signálu o frekvenci 2kHz nebo 4kHz, je možné tento čip relativně
snadno identifikovat, například v&nbsp;digitálních teploměrech, radiobudících
atd. (samozřejmě se nejedná o stoprocentní test...)</p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Piny použité pro řízení LCD</h2>

<p>Pro řízení displeje (LCD) se používají dvě skupiny výstupních pinů. Opět se
přidržme nejmenšího čipu <strong>S1C60N05</strong>, který konstruktérům dává
k&nbsp;dispozici tyto piny:</p>

<ol>
<li><strong>COM0</strong> až <strong>COM3</strong></li>
<li><strong>SEG0</strong> až <strong>SEG19</strong></li>
</ol>

<p>S&nbsp;použitím těchto pinů je možné automaticky řídit až 80 segmentů,
popř.&nbsp;v&nbsp;závislosti na typu displeje menší počet segmentů podle toho,
jak je zkonstruována maska displeje (jak se vybírají &bdquo;řádky&ldquo; a
&bdquo;sloupce&ldquo;, což ovšem u displejů se segmenty nutně neznamená, že se
používá matice pixelů):</p>

<table>
<tr><th>Označení</th><th>Výběr segmentů signály</th><th>Maximální počet ovládaných segmentů</th></tr>
<tr><td>1/4</td><td>COM0–3</td><td>80 (20 &times; 4)</td></tr>
<tr><td>1/3</td><td>COM0–2</td><td>60 (20 &times; 3)</td></tr>
<tr><td>1/2</td><td>COM0–1</td><td>40 (20 &times; 2)</td></tr>
</table>

<p>Poznámka: nejedná se o čistě digitální výstupy, neboť se &ndash; opět
v&nbsp;závislosti na konfiguraci a použitém LCD &ndash; generuje signál
s&nbsp;úrovněmi napětí získanými ze vstupních pinů Vdd, VL1, VL2, VL3.</p>



<p><a name="k05"></a></p>
<h2 id="k05">5. Programátorský model mikrořadiče: sada registrů</h2>

<p>Základní programátorský model mikrořadičů S1C60, tedy sada přímo či nepřímo
dostupných registrů, je vypsán v&nbsp;následující tabulce:</p>

<table>
<tr><th>Registr</th><th>Šířka</th><th>Rozdělen na</th><th>Celé jméno</th></tr>
<tr><td>PCS</td><td>8</td><td>&times;</td><td>Program counter step</td></tr>
<tr><td>PCP</td><td>4</td><td>&times;</td><td>Program counter page</td></tr>
<tr><td>NPP</td><td>4</td><td>&times;</td><td>New page pointer</td></tr>
<tr><td>SP</td><td>8</td><td>SPH+SPL</td><td>Stack pointer</td></tr>
<tr><td>IX</td><td>12</td><td>XP+XH+XL</td><td>Index register X</td></tr>
<tr><td>IY</td><td>12</td><td>YP+YH+YL</td><td>Index register Y</td></tr>
<tr><td>RP</td><td>4</td><td>&times;</td><td>Register pointer</td></tr>
<tr><td>A</td><td>4</td><td>&times;</td><td>General register A</td></tr>
<tr><td>B</td><td>4</td><td>&times;</td><td>General register B</td></tr>
</table>

<p>Z&nbsp;pohledu programátora jsou nejdůležitější registry <strong>A</strong>,
<strong>B</strong>, <strong>IX</strong> a <strong>IY</strong>. Registry
<strong>A</strong> a <strong>B</strong> můžeme považovat za běžné pracovní
registry či akumulátory, které se používají ve všech ALU operacích. Registry
<strong>IX</strong> a <strong>IY</strong> slouží pro adresování operandů
v&nbsp;paměti, takže je můžeme považovat za index registry. Ve skutečnosti se
vždy jedná o trojici, například <strong>IX=XP+XH+XL</strong>, přičemž každý
z&nbsp;těchto registrů <strong>XP</strong> (<i>page</i>), <strong>XH</strong>
(<i>high</i>) <strong>XL</strong> (<i>low</i>) má šířku čtyři bity. U malých
čipů se většinou <strong>XP/YP</strong> nepoužívá, protože je k&nbsp;dispozici
jen jedna stránka paměti.</p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Bitové příznaky</h2>

<p>Skupina bitových příznaků je pojata poměrně minimalisticky. V&nbsp;průběhu
výpočtů mohou být nastavovány pouze dva příznaky <strong>Carry</strong> a
<strong>Zero</strong>, které zde mají běžný význam. Navíc je možné pracovat
s&nbsp;příznaky (či spíše přesněji řečeno s&nbsp;konfiguračními přepínači)
<strong>Decimal</strong> (řídí aritmetické operace) a
<strong>Interrupt</strong> (povoluje a zakazuje přerušení):</p>

<table>
<tr><th>Označení</th><th>Příznak</th><th>Význam</th></tr>
<tr><td>I</td><td>Interrupt flag</td><td>příznak přerušení (zákaz/povolení)</td></tr>
<tr><td>D</td><td>Decimal flag</td><td>režim výpočtů (desítkový/šestnáctkový)</td></tr>
<tr><td>Z</td><td>Zero flag</td><td>příznak nulového výsledku</td></tr>
<tr><td>C</td><td>Carry flag</td><td>příznak přenosu</td></tr>
</table>



<p><a name="k07"></a></p>
<h2 id="k07">7. Struktura programové paměti ROM</h2>

<p>U nejmenších mikrořadičů řady S1C60 má programová paměť ROM kapacitu
1536&times;12 bitů, u větších čipů pak 4096&times;12 bitů. Šířka slova nebyla
zvolena náhodně, protože každá instrukce má šířku přesně oněch dvanáct bitů.
Paměť je rozdělena na stránky o velikosti 256 slov, takže například u čipu
<strong>S1C60N05</strong> bude mít šest stránek (6&times;256&times;12).</p>

<p>Při adresování instrukcí tvořících program se používá dvojice registrů
<strong>PCP+PCS</strong>. Registr <strong>PCP</strong> obsahuje aktuální
stránku a má šířku 4 bitů, registr <strong>PCS</strong> pak obsahuje index
instrukce v&nbsp;rámci jedné stránky. Teoreticky je tak možné použít 4 bity + 8
bitů = 12 bitů adresy, tedy 4096 dvanáctibitových slov. U větších čipů se pak
počítá s&nbsp;dalším rozšířením o jednobitový registr <strong>PCB</strong>
(<i>Program Counter Bank</i>), který adresovatelnou paměť dále rozšiřuje na
8192 dvanáctibitových slov (to však neplatí pro mini-mikrořadiče popisované
dnes).</p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Struktura datové paměti RAM</h2>

<p>Datová paměť RAM je rozdělena na stránky, přičemž každá stránka má maximální
velikost 256 nibblů. U nižších řad čipů s&nbsp;kapacitou RAM 80&times;4 bity či
256&times;4 bity je ovšem použita jen nultá stránka paměti, pouze u čipů
s&nbsp;RAM o kapacitě 832&times;4 bity je stránek více (konkrétně jsou čtyři,
tři mají kapacitu 256 nibblů, poslední jen 64 nibblů). Část paměti je přitom
obsazena zásobníkem.</p>

<p>Pro adresování se používají osmibitové registry <strong>X</strong> a
<strong>Y</strong>, které jsou u větší RAM s&nbsp;více stránkami doplněné o
čtyřbitové stránkové registry <strong>XP</strong> a <strong>YP</strong>
(P=<i>page</i>). Pokud se používá nepřímá adresace přes <strong>SP</strong>,
musí se dbát na to, že tento registr je osmibitový, což omezuje velikost
zásobníku na 256 čtyřbitových slov. U mnoha operací se ovšem obsadí hned 3
slova (12 bitů) &ndash; návratové adresy atd.</p>



<p><a name="k09"></a></p>
<h2 id="k09">9. Speciální paměť používaná při řízení displeje</h2>

<p>Pro řízení displeje (LCD) je použita speciální oblast paměti, která má
typickou velikost 32&times;4 bity a je zcela oddělena od RAM (nezapočítává se
tedy do uvedené kapacity RAM). Tato oblast je dostupná pouze pro zápis. Čtení
je prováděno zcela automaticky řadičem displeje, který samozřejmě musí být
správně nakonfigurován takovým způsobem, aby bylo čtení synchronizováno
s&nbsp;nastavením výstupních pinů <strong>COM0</strong> až
<strong>COM3</strong> a <strong>SEG0</strong> až <strong>SEG19</strong>.</p>

<p>Poznámka: zmíněných 32 nibblů je u čipů <strong>S1C60N05</strong> namapováno
na adresy 0x90 až 0xaf.</p>



<p><a name="k10"></a></p>
<h2 id="k10">10. Instrukční soubor mikrořadičů soubor S1C60</h2>

<p>V&nbsp;následujících pěti kapitolách si popíšeme většinu instrukcí tvořících
instrukční soubor (ISA) mikrořadičů řady S1C60. Některé dále popisované
instrukce jsou pouze <i>aliasy</i> na instrukce jiné. Všechna instrukční slova
mají konstantní šířku dvanácti bitů a každé slovo se rozděluje na operační kód
o proměnlivé šířce a na operand (pochopitelně taktéž o proměnlivé šířce).
Existuje celkem šest formátů instrukcí zmíněných v&nbsp;tabulce umístěné pod
tímto odstavcem:</p>

<table>
<tr><th>Operační kód</th><th>Operand</th><th>Celkově</th><th>Příklad instrukce</th></tr>
<tr><td>4 bity</td><td>8 bitů</td><td>12 bitů</td><td>CALL s</td></tr>
<tr><td>6 bitů</td><td>6 bitů</td><td>12 bitů</td><td>ADD r, i</td></tr>
<tr><td>7 bitů</td><td>5 bitů</td><td>12 bitů</td><td>PSET p</td></tr>
<tr><td>8 bitů</td><td>4 bity</td><td>12 bitů</td><td>SET F,i</td></tr>
<tr><td>10 bitů</td><td>2 bity</td><td>12 bitů</td><td>PUSH r</td></tr>
<tr><td>12 bitů</td><td>0 bitů</td><td>12 bitů</td><td>INC X</td></tr>
</table>

<p>Příkladem prvního formátu je instrukce <strong>CALL s</strong> pro skok do
podprogramu. Ta vypadá následovně:</p>

<pre>
+------------+-------------+-------------+
| 0  1  0  0 | s7 s6 s5 s4 | s3 s2 s1 s0 |
+------------+-------------+-------------+
</pre>

<p>Instrukce <strong>ADD r, i</strong> dokáže přičíst čtyřbitovou konstantu
k&nbsp;vybranému registru (r1 a r2 je selektor registr):</p>

<pre>
+------------+-------------+-------------+
| 1  1  0  0 | 0  0  r1 r0 | i3 i2 i1 i0 |
+------------+-------------+-------------+
</pre>



<p><a name="k11"></a></p>
<h2 id="k11">11. Aritmetické a logické instrukce</h2>

<p>Sada aritmetických a logických instrukcí obsahuje prakticky všechny
očekávatelné instrukce (asi nikdo nebude očekávat, že na takto malých čipech
bude násobička nebo dělička...). Zajímavé je, že prakticky všechny instrukce
jako svůj první operand akceptují registry <strong>A</strong>,
<strong>B</strong> či paměťové buňky adresované přes <strong>IX</strong> a
<strong>IY</strong>. Druhým operandem je buď čtyřbitová konstanta nebo jiný
registr/paměťová buňka. Výjimkou jsou poslední dvě instrukce, které přímo
v&nbsp;instrukčním slovu obsahují adresu svého operandu:</p>

<table>
<tr><th>Instrukce</th><th>Stručný popis</th></tr>
<tr><td>ADD r,i</td><td>součet registr+konstanta</td></tr>
<tr><td>ADD r,q</td><td>součet dvou registrů</td></tr>
<tr><td>ADC r,i</td><td>součet registr+konstanta+Carry</td></tr>
<tr><td>ADC r,q</td><td>součet dvou registrů+Carry</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>SUB r,i</td><td>rozdíl registr-konstanta</td></tr>
<tr><td>SUB r,q</td><td>rozdíl dvou registrů</td></tr>
<tr><td>SBC r,i</td><td>rozdíl registr-konstanta-Carry</td></tr>
<tr><td>SBC r,q</td><td>rozdíl dvou registrů-Carry</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>AND r,i</td><td>operace registr AND konstanta</td></tr>
<tr><td>AND r,q</td><td>operace registr AND registr</td></tr>
<tr><td>OR r,i</td><td>operace registr OR konstanta</td></tr>
<tr><td>OR r,q</td><td>operace registr OR registr</td></tr>
<tr><td>XOR r,i</td><td>operace registr XOR konstanta</td></tr>
<tr><td>XOR r,q</td><td>operace registr XOR registr</td></tr>
<tr><td>NOT r</td><td>negace registru</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>INC X</td><td>zvýšení hodnoty index registru IX</td></tr>
<tr><td>INC Y</td><td>zvýšení hodnoty index registry IY</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>INC SP</td><td>zvýšení hodnoty registru SP</td></tr>
<tr><td>DEC SP</td><td>snížení hodnoty registru SP</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>INC Mn</td><td>zvýšení hodnoty nepřímo adresované paměťové buňky</td></tr>
<tr><td>DEC Mn</td><td>snížení hodnoty nepřímo adresované paměťové buňky</td></tr>
</table>



<p><a name="k12"></a></p>
<h2 id="k12">12. Bitové rotace a porovnání operandů</h2>

<p>Existují dvě instrukce pro bitové rotace. Obě instrukce vždy pracují i
s&nbsp;příznakem Carry a vzhledem k&nbsp;tomu, že vstupním operandem je
&bdquo;registr&ldquo; (ve smyslu, jak ho chápeme u S1C60), může se rotovat
pracovní registr <strong>A</strong>, <strong>B</strong>, popř.&nbsp;paměť
adresovaná přes <strong>IX</strong> či <strong>IY</strong>. Totéž platí i pro
dvě operace pro porovnání následované operace pro AND bez uložení výsledků (u
jiných procesorů se tato instrukce jmenuje <strong>TEST</strong>). Navíc
poslední instrukce dokáže porovnat libovolný &bdquo;registr&ldquo; s&nbsp;jiným
&bdquo;registrem&ldquo;, tedy i dvě paměťové buňky, z&nbsp;nichž jedna je
adresována přes <strong>IX</strong> a druhá přes <strong>IY</strong>:</p>

<table>
<tr><th>Instrukce</th><th>Stručný popis</th></tr>
<tr><td>RCL r</td><td>rotace vybraného registru doleva přes příznak Carry (rotuje se tedy pět bitů)</td></tr>
<tr><td>RRC r</td><td>rotace vybraného registru doprava přes příznak Carry (rotuje se tedy pět bitů)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>CP r, immed</td><td>porovnání vybraného registru se čtyřbitovou konstantou a nastavení příznaků</td></tr>
<tr><td>CP r, q</td><td>porovnání dvou vybraných registrů a nastavení příznaků</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>FAN r, immed</td><td>logické AND vybraného registru se čtyřbitovou konstantou a nastavení příznaků</td></tr>
<tr><td>FAN r, q</td><td>logické AND dvou vybraných registrů a nastavení příznaků</td></tr>
</table>



<p><a name="k13"></a></p>
<h2 id="k13">13. Skoky</h2>

<p>Instrukce provádějící skoky můžeme rozdělit do několika kategorií. Nalezneme
zde nepodmíněný skok, dále čtveřici podmíněných skoků provedených či
neprovedených na základě testu příznakových bitů <strong>Carry</strong> a
<strong>Zero</strong>, dále nepřímý skok na adresu uloženou ve dvojici registrů
A+B, skoky do podprogramu a návraty z&nbsp;podprogramů. Poslední instrukce
provede návrat z&nbsp;podprogramu a současně ještě uloží konstantu na adresu
umístěnou v&nbsp;registru X:</p>

<table>
<tr><th>Instrukce</th><th>Stručný popis</th></tr>
<tr><td>JP s</td><td>nepodmíněný skok</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>JP C,s</td><td>podmíněný skok pokud Carry=1</td></tr>
<tr><td>JP NC,s</td><td>podmíněný skok pokud Carry=0</td></tr>
<tr><td>JP Z,s</td><td>podmíněný skok pokud Zero=1</td></tr>
<tr><td>JP NZ,s</td><td>podmíněný skok pokud Zero=0</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>JPBA</td><td>nepřímý skok na adresu umístěnou v&nbsp;registrech A+B</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>CALL s</td><td>skok do podprogramu</td></tr>
<tr><td>CALZ s</td><td>skok do podprogramu na nulté stránce</td></tr>
<tr><td>RET</td><td>návrat z&nbsp;podprogramu</td></tr>
<tr><td>RETS</td><td>dtto, ale navíc zvýšení PC a 1 (přeskočí se další instrukce ve volajícím kódu)</td></tr>
<tr><td>RETD e</td><td>návrat z&nbsp;podprogramu s&nbsp;výsledkem uloženým do paměti adresované X</td></tr>
</table>



<p><a name="k14"></a></p>
<h2 id="k14">14. Instrukce typu Load &amp; Store</h2>

<p>Největší skupina instrukcí slouží pro načtení či naopak uložení operandů do
operační paměti. Při adresování operandů se používají index registry
<strong>IX</strong> a <strong>IY</strong>. Pro naplnění adres do těchto
registrů (každý je rozložen do trojice
<strong>XP</strong>+<strong>XH</strong>+<strong>XL</strong>) se používá prvních
14 instrukcí z&nbsp;následující tabulky. Nejuniverzálnější instrukcí je dále
zmíněná instrukce <strong>LD</strong>, která dokáže pracovat s&nbsp;registry
<strong>A</strong>, <strong>B</strong>, paměťovou buňkou <strong>(IX)</strong>,
<strong>(IY)</strong> i čtyřbitovou konstantou. Proto také tato instrukce
nahrazuje neexistující instrukci <strong>ST</strong> (store):</p>

<table>
<tr><th>Instrukce</th><th>Stručný popis</th></tr>
<tr><td>LD X, e</td><td>načtení osmibitové konstanty do registru X</td></tr>
<tr><td>LD XP, r</td><td>přesun čtyřbitového operandu do registru XP</td></tr>
<tr><td>LD XH, r</td><td>přesun čtyřbitového operandu do registru XH</td></tr>
<tr><td>LD XL, r</td><td>přesun čtyřbitového operandu do registru XL</td></tr>
<tr><td>LD r, XP</td><td>přesun čtyřbitového operandu z registru XP</td></tr>
<tr><td>LD r, XH</td><td>přesun čtyřbitového operandu z registru XH</td></tr>
<tr><td>LD r, XL</td><td>přesun čtyřbitového operandu z registru XL</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>LD Y, e</td><td>načtení osmibitové konstanty do registru Y</td></tr>
<tr><td>LD YP, r</td><td>přesun čtyřbitového operandu do registru YP</td></tr>
<tr><td>LD YH, r</td><td>přesun čtyřbitového operandu do registru YH</td></tr>
<tr><td>LD YL, r</td><td>přesun čtyřbitového operandu do registru YL</td></tr>
<tr><td>LD r, YP</td><td>přesun čtyřbitového operandu z registru YP</td></tr>
<tr><td>LD r, YH</td><td>přesun čtyřbitového operandu z registru YH</td></tr>
<tr><td>LD r, YL</td><td>přesun čtyřbitového operandu z registru YL</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>LD r, i</td><td>instrukce pro načtení operandu do registru, s&nbsp;případným nepřímým adresováním (více variant)</td></tr>
<tr><td>LD r, q</td><td>instrukce pro načtení operandu do registru, s&nbsp;případným nepřímým adresováním (více variant)</td></tr>
<tr><td>LDPX</td><td>uložení konstanty na adresu z&nbsp;registru IX, zvýšení IX o 1</td></tr>
<tr><td>LDPY</td><td>uložení konstanty na adresu z&nbsp;registru IY, zvýšení IY o 1</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>PUSH</td><td>uložení konstanty, příznakových bitů či registru na zásobník</td></tr>
<tr><td>POP</td><td>obnovení konstanty, příznakových bitů či registru ze zásobníku</td></tr>
</table>



<p><a name="k15"></a></p>
<h2 id="k15">15. Práce s&nbsp;příznakovými bity</h2>

<p>Poslední skupina instrukcí, se kterou se v&nbsp;dnešním článku seznámíme, je
tvořena deseti instrukcemi určenými pro nastavení či naopak vynulování
příznakových bitů. Prvních osm instrukcí nastaví nebo vynuluje vybraný bit
<strong>Carry</strong>, <strong>Zero</strong>, <strong>Decimal</strong> či
<strong>Interrupt</strong>, další dvě instrukce pracují s&nbsp;bitovou maskou
(čtyř bitů) a mohou tak současně nastavit či vynulovat vybranou skupinu
příznakových bitů:</p>

<table>
<tr><th>Instrukce</th><th>Stručný popis</th></tr>
<tr><td>SCF</td><td>nastavení Carry=1</td></tr>
<tr><td>RCF</td><td>vynulování Carry=0</td></tr>
<tr><td>SZF</td><td>nastavení Zero=1</td></tr>
<tr><td>RZF</td><td>vynulování Zero=0</td></tr>
<tr><td>SDF</td><td>nastavení Decimal=1</td></tr>
<tr><td>RDF</td><td>vynulování Decimal=0</td></tr>
<tr><td>EI</td><td>nastavení Interrupt=1 (a současně povolení přerušení)</td></tr>
<tr><td>DI</td><td>vynulování Interrupt=0 (a současně zakázání přerušení)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>SET F,i</td><td>nastavení vybraných příznaků (bitová maska)</td></tr>
<tr><td>RST F,i</td><td>vynulování vybraných příznaků (bitová maska</td></tr>
</table>

<p>Poznámka: ve skutečnosti je například instrukce <strong>SET</strong>
zakódována takto:</p>

<pre>
+------------+------------+------------+
| 1  1  1  1 | 0  1  0  0 |i3 i2 i1 i0 |
+------------+------------+------------+
</pre>

<p>Asi vás tedy nepřekvapí, že instrukce <strong>SCF</strong> má následující
operační kód &ndash; jinými slovy, že se jedná o instrukční alias
k&nbsp;univerzální instrukci <strong>SET</strong>:</p>

<pre>
+------------+------------+------------+
| 1  1  1  1 | 0  1  0  0 | 0  0  0  1 |
+------------+------------+------------+
</pre>

<p>Totéž samozřejmě platí i pro další instrukce z&nbsp;výše uvedené
tabulky.</p>



<p><a name="k16"></a></p>
<h2 id="k16">16. Odkazy na Internetu</h2>

<ol>

<li>4-bit architecture<br />
<a href="https://en.wikichip.org/wiki/4-bit_architecture">https://en.wikichip.org/wiki/4-bit_architecture</a>
</li>

<li>S1C60 - Epson<br />
<a href="https://en.wikichip.org/wiki/epson/s1c60">https://en.wikichip.org/wiki/epson/s1c60</a>
</li>

<li>S1C63 - Epson<br />
<a href="https://en.wikichip.org/wiki/epson/s1c63">https://en.wikichip.org/wiki/epson/s1c63</a>
</li>

<li>4-bit to 32-bit low power microcontrollers (Epson)<br />
<a href="http://global.epson.com/products_and_drivers/semicon/products/micro_controller/">http://global.epson.com/products_and_drivers/semicon/products/micro_controller/</a>
</li>

<li>4-bit microcontrollers (Epson)<br />
<a href="http://global.epson.com/products_and_drivers/semicon/products/micro_controller/4bit/">http://global.epson.com/products_and_drivers/semicon/products/micro_controller/4bit/</a>
</li>

<li>High Performance 4bit (Epson)<br />
<a href="http://global.epson.com/products_and_drivers/semicon/products/micro_controller/high4bit/">http://global.epson.com/products_and_drivers/semicon/products/micro_controller/high4bit/</a>
</li>

<li>S1C60 Family Products overview (PDF)<br />
<a href="http://global.epson.com/products_and_drivers/semicon/products/micro_controller/pdf/spec_mcu_4bit.pdf">http://global.epson.com/products_and_drivers/semicon/products/micro_controller/pdf/spec_mcu_4bit.pdf</a>
</li>

<li>Zero-power Microcontrollers for Low-power and High-temperature Applications<br />
<a href="http://en.wikichip.org/w/images/1/17/Atmel_MARC4_brochure.pdf">http://en.wikichip.org/w/images/1/17/Atmel_MARC4_brochure.pdf</a>
</li>

<li>MARC4 Micro-Controller (Wikipedia)<br />
<a href="https://en.wikipedia.org/wiki/MARC4_Micro-Controller">https://en.wikipedia.org/wiki/MARC4_Micro-Controller</a>
</li>

<li>MARC4 - Atmel<br />
<a href="https://en.wikichip.org/wiki/atmel/marc4">https://en.wikichip.org/wiki/atmel/marc4</a>
</li>

<li>MARC 4bit Microcontrollers Programmer's Guide<br />
<a href="https://en.wikichip.org/w/images/4/44/MARC4_4-bit_Microcontrollers_Programmer%27s_Guide.pdf">https://en.wikichip.org/w/images/4/44/MARC4_4-bit_Microcontrollers_Programmer%27s_Guide.pdf</a>
</li>

<li>MARC4 User's Guide qFORTH Compiler<br />
<a href="https://en.wikichip.org/w/images/2/25/MARC4_User%27s_Guide_qFORTH_Compiler.pdf">https://en.wikichip.org/w/images/2/25/MARC4_User%27s_Guide_qFORTH_Compiler.pdf</a>
</li>

<li>Programovací jazyk Forth a zásobníkové procesory<br />
<a href="http://www.root.cz/clanky/programovaci-jazyk-forth-a-zasobnikove-procesory/">http://www.root.cz/clanky/programovaci-jazyk-forth-a-zasobnikove-procesory/</a>
</li>

<li>Seriál Programovací jazyk Forth<br />
<a href="http://www.root.cz/serialy/programovaci-jazyk-forth/">http://www.root.cz/serialy/programovaci-jazyk-forth/</a>
</li>

<li>Programovací jazyk Factor<br />
<a href="http://www.root.cz/clanky/programovaci-jazyk-factor/">http://www.root.cz/clanky/programovaci-jazyk-factor/</a>
</li>

<li>Grafický metaformát PostScript<br />
<a href="http://www.root.cz/clanky/graficky-metaformat-postscript/">http://www.root.cz/clanky/graficky-metaformat-postscript/</a>
</li>

<li>PMOS<br />
<a href="https://en.wikipedia.org/wiki/PMOS_logic">https://en.wikipedia.org/wiki/PMOS_logic</a>
</li>

<li>NMOS<br />
<a href="https://en.wikipedia.org/wiki/NMOS_logic">https://en.wikipedia.org/wiki/NMOS_logic</a>
</li>

<li>CMOS<br />
<a href="https://en.wikipedia.org/wiki/CMOS">https://en.wikipedia.org/wiki/CMOS</a>
</li>

<li>Vacuum Fluorescent Display<br />
<a href="https://en.wikipedia.org/wiki/Vacuum_fluorescent_display">https://en.wikipedia.org/wiki/Vacuum_fluorescent_display</a>
</li>

<li>Computer History Museum: TMS 1000 4-Bit microcontroller<br />
<a href="http://www.computerhistory.org/collections/catalog/102711697">http://www.computerhistory.org/collections/catalog/102711697</a>
</li>

<li>Texas Instruments TMS1000 microcontroller family<br />
<a href="http://www.cpu-world.com/CPUs/TMS1000/">http://www.cpu-world.com/CPUs/TMS1000/</a>
</li>

<li>Invention History of Microcontroller<br />
<a href="http://www.circuitstoday.com/microcontroller-invention-history">http://www.circuitstoday.com/microcontroller-invention-history</a>
</li>

<li>TMS1000 Series - TI<br />
<a href="https://en.wikichip.org/wiki/ti/tms1000">https://en.wikichip.org/wiki/ti/tms1000</a>
</li>

<li>TMX1795 - TI<br />
<a href="https://en.wikichip.org/wiki/ti/tmx1795">https://en.wikichip.org/wiki/ti/tmx1795</a>
</li>

<li>Milton Bradley Microvision (U.S.) (1979, LCD, 9 Volt (1 or 2), Model# 4952)<br />
<a href="http://www.handheldmuseum.com/MB/uVUS.htm">http://www.handheldmuseum.com/MB/uVUS.htm</a>
</li>

<li>8051 Microcontroller<br />
<a href="http://www.circuitstoday.com/8051-microcontroller">http://www.circuitstoday.com/8051-microcontroller</a>
</li>

<li>4-bit (computer architectures)<br />
<a href="https://en.wikipedia.org/wiki/4-bit">https://en.wikipedia.org/wiki/4-bit</a>
</li>

<li>TMS 1000 Data Manual<br />
<a href="http://blog.kevtris.org/blogfiles/TMS_1000_Data_Manual.pdf">http://blog.kevtris.org/blogfiles/TMS_1000_Data_Manual.pdf</a>
</li>

<li>Considerations for 4-bit processing<br />
<a href="http://www.embeddedinsights.com/channels/2010/12/10/considerations-for-4-bit-processing/">http://www.embeddedinsights.com/channels/2010/12/10/considerations-for-4-bit-processing/</a>
</li>

<li>Are you, or would you consider, using a 4-bit microcontroller?<br />
<a href="http://www.embeddedinsights.com/channels/2010/11/24/are-you-or-would-you-consider-using-a-4-bit-microcontroller/">http://www.embeddedinsights.com/channels/2010/11/24/are-you-or-would-you-consider-using-a-4-bit-microcontroller/</a>
</li>

<li>MARC4 Micro-Controller<br />
<a href="https://en.wikipedia.org/wiki/MARC4_Micro-Controller">https://en.wikipedia.org/wiki/MARC4_Micro-Controller</a>
</li>

<li>The Texas Instruments TMX 1795: the (almost) first, forgotten microprocessor <br />
<a href="http://www.righto.com/2015/05/the-texas-instruments-tmx-1795-first.html">http://www.righto.com/2015/05/the-texas-instruments-tmx-1795-first.html</a>
</li>

<li>O2 Homepage<br />
<a href="http://www.the-nextlevel.com/odyssey2/">http://www.the-nextlevel.com/odyssey2/</a>
</li>

<li>Magnavox Odyssey2 (1978), Philips Videopac G7000 / C52 (1979)<br />
<a href="http://www.mess.org/sysinfo:odyssey2">http://www.mess.org/sysinfo:odyssey2</a>
</li>

<li>The Video Game Critic's Odyssey 2 Reviews <br />
<a href="http://videogamecritic.net/odd.htm">http://videogamecritic.net/odd.htm</a>
</li>

<li>Computer Closet Collection: Magnavox Odyssey^2<br />
<a href="http://www.computercloset.org/MagnavoxOdyssey2.htm">http://www.computercloset.org/MagnavoxOdyssey2.htm</a>
</li>

<li>PHILIPS Videopac C52<br />
<a href="http://old-computers.com/museum/computer.asp?c=1060">http://old-computers.com/museum/computer.asp?c=1060</a>
</li>

<li>O2 Tech. Manual V.1.1 (PDF dokument)<br />
<a href="http://www.atarihq.com/danb/files/o2doc.pdf">http://www.atarihq.com/danb/files/o2doc.pdf</a>
</li>

<li>Magnavox Odyssey<sup>2</sup><br />
<a href="http://www.game-machines.com/consoles/odyssey2.php">http://www.game-machines.com/consoles/odyssey2.php</a>
</li>

<li>Magnavox Odyssey<sup>2</sup> (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/Odyssey_2">http://en.wikipedia.org/wiki/Odyssey_2</a>
</li>

<li>Magnavox Odyssey<sup>2</sup> Games (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/List_of_Videopac_games">http://en.wikipedia.org/wiki/List_of_Videopac_games</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2017</small></p>
</body>
</html>

