<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Pyrsistent: persistentní datové struktury v Pythonu (dokončení)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Pyrsistent: persistentní datové struktury v Pythonu (dokončení)</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Ve druhé části článku o knihovně pyrsistent se zaměříme na popis zbývajících persistentních datových struktur, které tato knihovna vývojářům nabízí. Jedná se především o persistentní mapy a obousměrné fronty. V této knihovně nalezneme i persistentní objekty popř. takzvané záznamy i podporu pro kolekce s testem konzistence a typovosti.</p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. Pyrsistent: persistentní datové struktury v&nbsp;Pythonu (dokončení)</a></p>
<p><a href="#k02">*** 2. Persistentní mapy</a></p>
<p><a href="#k03">*** 3. Konstrukce mapy</a></p>
<p><a href="#k04">*** 4. </a></p>
<p><a href="#k05">*** 5. </a></p>
<p><a href="#k06">*** 6. </a></p>
<p><a href="#k07">*** 7. </a></p>
<p><a href="#k08">*** 8. </a></p>
<p><a href="#k09">*** 9. </a></p>
<p><a href="#k10">*** 10. </a></p>
<p><a href="#k11">*** 11. </a></p>
<p><a href="#k12">*** 12. </a></p>
<p><a href="#k13">*** 13. </a></p>
<p><a href="#k14">*** 14. </a></p>
<p><a href="#k15">*** 15. </a></p>
<p><a href="#k16">*** 16. </a></p>
<p><a href="#k17">*** 17. </a></p>
<p><a href="#k18">*** 18. </a></p>
<p><a href="#k19">*** 19. Repositář s&nbsp;demonstračními příklady</a></p>
<p><a href="#k20">*** 20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Pyrsistent: persistentní datové struktury v&nbsp;Pythonu (dokončení)</h2>

<p>Ve druhé části článku o knihovně <i>pyrsistent</i> se zaměříme na popis zbývajících persistentních datových struktur, které tato knihovna vývojářům nabízí. Jednat se bude zejména o persistentní mapy (<i>maps</i>), ale i o persistentní obousměrné fronty (<i>deque</i>). To však není ani zdaleka vše, protože v&nbsp;knihovně <i>pyrsistent</i> nalezneme i podporu pro persistentní objekty (což je v&nbsp;Pythonu poměrně nový koncept) popř.&nbsp;pro takzvané záznamy (<i>records</i>). Nezapomeneme ani na podporu pro kolekce, u nichž je testována jejich konzistence a dokonce i typů popř.&nbsp;hodnot prvků, které jsou v&nbsp;takových kolekcích uloženy.</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Persistentní mapy</h2>

<p><a href="https://www.root.cz/clanky/pyrsistent-persistentni-datove-struktury-v-pythonu/">V&nbsp;předchozím článku</a> o knihovně <i>pyrsistent</i> byly popsány dvě základní persistentní datové struktury, které se nazývají <i>vektory</i> a <i>množiny</i>. Na vektory i na množiny se můžeme dívat jako na pole s&nbsp;neměnitelnou strukturou (prvky nelze přidávat ani odebírat), ovšem zatímco u vektorů je zaručeno pořadí prvků a možnost výběru prvků na základě jejich celočíselných indexů, u množin se operace omezují na test existence prvku popř.&nbsp;na přečtení hodnoty prvku. Ovšem s&nbsp;množinami jako celkem lze provádět standardní množinové operace &ndash; sjednocení, průnik, diferenci, symetrickou diferenci a test, zda je nějaká množina podmnožinou množiny jiné. Množiny jsou tedy v&nbsp;mnoha ohledech velmi užitečné datové struktury, které jsou však mnohdy &ndash; poněkud neprávem &ndash; přehlíženy.</p>

<p>Nyní se však zaměřme na další velmi užitečnou datovou strukturu neboli <i>kontejner</i>. Jedná se o mapy, které jsou známé taktéž pod jménem asociativní pole. Prvky uložené v&nbsp;mapě jsou přístupné přes <i>klíč</i> a nikoli přes celočíselný <i>index</i>. A vzhledem k&nbsp;tomu, že se v&nbsp;knihovně <i>Pyrsistent</i> pracuje s&nbsp;persistentními datovými strukturami, jsou i mapy persistentní, tj.&nbsp;do mapy není možné přidávat ani z&nbsp;nich odebírat prvky. Mapy po své konstrukci sice zdánlivě nabízí možnost s&nbsp;prvky mapy manipulovat, ovšem každá manipulace vede k&nbsp;vytvoření (a vrácení) nové mapy. Využívá se zde již minule zmíněné sdílení interní struktury (<i>structural sharing</i>), což znamená, že nově vytvořená mapa ve skutečnosti sdílí prakticky celou vnitřní strukturu s&nbsp;mapou původní (až na nově vytvořené, smazané či modifikované prvky). Přístup k&nbsp;prvkům přes klíče je velmi rychlý &ndash; časová složitost přístupu je rovna časové složitosti přístupu u vektorů a množin, tedy <i>O(log<sub>32</sub>n)</i>, kde <i>n</i> je počet prvků uložených v&nbsp;mapě.</p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Konstrukce mapy</h2>

<p>Pro konstrukci mapy se používá konstruktor nazvaný jednoduše <strong>m</strong>, podobně jako pro vektor existuje konstruktor pojmenovaný <strong>v</strong> a pro množiny konstruktor <strong>s</strong>. Tomuto konstruktoru lze předat libovolné množství pojmenovaných parametrů, přičemž jméno parametru bude klíčem prvku a hodnota parametru hodnotou prvku. Na mapy je navíc mj.&nbsp;možné aplikovat standardní funkci <strong>len</strong> a samozřejmě i zjistit její typ:</p>

<pre>
from pyrsistent import m
&nbsp;
map1 = m(first=1, second=2, third=3)
&nbsp;
print(map1)
print(type(map1))
print(len(map1))
</pre>

<p>S&nbsp;výsledky:</p>

<pre>
pmap({'first': 1, 'third': 3, 'second': 2})
&lt;class 'pyrsistent._pmap.PMap'&gt;
3
</pre>



<p><a name="k04"></a></p>
<h2 id="k04">4. Klíče mapy typem rozdílným od řetězce</h2>

<pre>
from pyrsistent import m
&nbsp;
map1 = m(1="first", 2="second", 3="third")
&nbsp;
print(map1)
print(type(map1))
print(len(map1))
</pre>

<pre>
  File "map02.py", line 3
    map1 = m(1="first", 2="second", 3="third")
&nbsp;             ^
SyntaxError: expression cannot contain assignment, perhaps you meant "=="?
</pre>

<pre>
from pyrsistent import pmap
&nbsp;
map1 = pmap({1:"first", 2:"second", 3:"third"})
&nbsp;
print(map1)
print(type(map1))
print(len(map1))
</pre>

<pre>
pmap({1: 'first', 2: 'second', 3: 'third'})
&lt;class 'pyrsistent._pmap.PMap'&gt;
3
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. &bdquo;Modifikace&ldquo; mapy</h2>

<pre>
from pyrsistent import m
&nbsp;
map1 = m(first=1, second=2, third=3)
print("Original map")
print(map1)
&nbsp;
map2 = map1.set("fourth", 4)
print("\nAfter set")
print(map1)
print(map2)
&nbsp;
map3 = map1.remove("first")
print("\nAfter remove")
print(map1)
print(map2)
print(map3)
</pre>

<pre>
Original map
pmap({'second': 2, 'third': 3, 'first': 1})
&nbsp;
After set
pmap({'second': 2, 'third': 3, 'first': 1})
pmap({'second': 2, 'fourth': 4, 'third': 3, 'first': 1})
&nbsp;
After remove
pmap({'second': 2, 'third': 3, 'first': 1})
pmap({'second': 2, 'fourth': 4, 'third': 3, 'first': 1})
pmap({'second': 2, 'third': 3})
</pre>



<p><a name="k06"></a></p>
<h2 id="k06">6. </h2>



<p><a name="k07"></a></p>
<h2 id="k07">7. </h2>



<p><a name="k08"></a></p>
<h2 id="k08">8. </h2>



<p><a name="k09"></a></p>
<h2 id="k09">9. </h2>



<p><a name="k10"></a></p>
<h2 id="k10">10. </h2>



<p><a name="k11"></a></p>
<h2 id="k11">11. </h2>



<p><a name="k12"></a></p>
<h2 id="k12">12. </h2>



<p><a name="k13"></a></p>
<h2 id="k13">13. </h2>



<p><a name="k14"></a></p>
<h2 id="k14">14. </h2>



<p><a name="k15"></a></p>
<h2 id="k15">15. </h2>



<p><a name="k16"></a></p>
<h2 id="k16">16. </h2>



<p><a name="k17"></a></p>
<h2 id="k17">17. </h2>



<p><a name="k18"></a></p>
<h2 id="k18">18. </h2>



<p><a name="k19"></a></p>
<h2 id="k19">19. Repositář s&nbsp;demonstračními příklady</h2>

<p>Zdrojové kódy všech prozatím popsaných demonstračních příkladů určených pro
programovací jazyk Python 3 a knihovnu <i>pyrsistent</i> byly uloženy do Git
repositáře dostupného na adrese <a
href="https://github.com/tisnik/most-popular-python-libs">https://github.com/tisnik/most-popular-python-libs</a>.
V&nbsp;případě, že nebudete chtít klonovat celý repositář (ten je ovšem stále
velmi malý, dnes má velikost zhruba několik desítek kilobajtů), můžete namísto
toho použít odkazy na jednotlivé příklady, které naleznete v&nbsp;následující
tabulce:</p>

<table>
<tr><th> #</th><th>Demonstrační příklad</th><th>Stručný popis příkladu</th><th>Cesta</th></tr>
<tr><td> 1</td><td>list01.py</td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/list01.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/list01.py</a></td></tr>
<tr><td> 2</td><td>list02.py</td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/list02.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/list02.py</a></td></tr>
<tr><td> 3</td><td>list03.py</td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/list03.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/list03.py</a></td></tr>
<tr><td> 4</td><td>list04.py</td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/list04.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/list04.py</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 5</td><td>tuple01.py</td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/tuple01.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/tuple01.py</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 6</td><td>vectors01.py</td><td>konstrukce vektoru se třemi prvky stejného typu</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors01.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors01.py</a></td></tr>
<tr><td> 7</td><td>vectors02.py</td><td>konstrukce vektoru se čtyřmi prvky rozdílného typu</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors02.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors02.py</a></td></tr>
<tr><td> 8</td><td>vectors03.py</td><td>metoda <strong>append</strong> vytvářející nový vektor</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors03.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors03.py</a></td></tr>
<tr><td> 9</td><td>vectors04.py</td><td>neměnná hodnota &ndash; reference na seznam</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors04.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors04.py</a></td></tr>
<tr><td>10</td><td>vectors05.py</td><td>proměnná hodnota &ndash; vlastní obsah seznamu</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors05.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors05.py</a></td></tr>
<tr><td>11</td><td>vectors06.py</td><td>proměnná hodnota &ndash; obsah mapy</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors06.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors06.py</a></td></tr>
<tr><td>12</td><td>vectors07.py</td><td>přístup k&nbsp;prvkům vektoru</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors07.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors07.py</a></td></tr>
<tr><td>13</td><td>vectors08.py</td><td>slicing</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors08.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors08.py</a></td></tr>
<tr><td>14</td><td>vectors09.py</td><td>slicing se specifikací kroku</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors09.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/vectors09.py</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>15</td><td>sets01.py</td><td>konstrukce persistentní množiny</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets01.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets01.py</a></td></tr>
<tr><td>16</td><td>sets02.py</td><td>persistentní množina a operace <strong>add</strong></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets02.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets02.py</a></td></tr>
<tr><td>17</td><td>sets03.py</td><td>persistentní množina a operace <strong>remove</strong></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets03.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets03.py</a></td></tr>
<tr><td>18</td><td>sets04.py</td><td>množinové operace</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets04.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets04.py</a></td></tr>
<tr><td>19</td><td>sets05.py</td><td>test na existenci prvku v&nbsp;množině</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets05.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/sets05.py</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>20</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>21</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>22</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>23</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>24</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>25</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>26</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>27</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>28</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>29</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
<tr><td>30</td><td></td><td></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/">https://github.com/tisnik/most-popular-python-libs/blob/master/pyrsistent/</a></td></tr>
</table>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>Persistent data structure<br />
<a href="https://en.wikipedia.org/wiki/Persistent_data_structure">https://en.wikipedia.org/wiki/Persistent_data_structure</a>
</li>

<li>Collections (Python)<br />
<a href="https://docs.python.org/3/library/collections.abc.html">https://docs.python.org/3/library/collections.abc.html</a>
</li>

<li>Immutable object<br />
<a href="https://en.wikipedia.org/wiki/Immutable_object">https://en.wikipedia.org/wiki/Immutable_object</a>
</li>

<li>pyrsistent na PyPi<br />
<a href="https://pypi.org/project/pyrsistent/">https://pypi.org/project/pyrsistent/</a>
</li>

<li>pyrsistent na GitHubu<br />
<a href="https://github.com/tobgu/pyrsistent">https://github.com/tobgu/pyrsistent</a>
</li>

<li>Dokumentace knihovny pyrsistent<br />
<a href="https://pyrsistent.readthedocs.io/en/latest/index.html">https://pyrsistent.readthedocs.io/en/latest/index.html</a>
</li>

<li>pyrthon na GitHubu<br />
<a href="https://github.com/tobgu/pyrthon/">https://github.com/tobgu/pyrthon/</a>
</li>

<li>Mori na GitHubu<br />
<a href="https://github.com/swannodette/mori">https://github.com/swannodette/mori</a>
</li>

<li>Mori: popis API (dokumentace)<br />
<a href="http://swannodette.github.io/mori/">http://swannodette.github.io/mori/</a>
</li>

<li>Mori: Benchmarking<br />
<a href="https://github.com/swannodette/mori/wiki/Benchmarking">https://github.com/swannodette/mori/wiki/Benchmarking</a>
</li>

<li>Functional data structures in JavaScript with Mori<br />
<a href="http://sitr.us/2013/11/04/functional-data-structures.html">http://sitr.us/2013/11/04/functional-data-structures.html</a>
</li>

<li>Immutable.js<br />
<a href="https://facebook.github.io/immutable-js/">https://facebook.github.io/immutable-js/</a>
</li>

<li>Understanding Clojure's Persistent Vectors, pt. 1<br />
<a href="http://hypirion.com/musings/understanding-persistent-vector-pt-1">http://hypirion.com/musings/understanding-persistent-vector-pt-1</a>
</li>

<li>Hash array mapped trie (Wikipedia)<br />
<a href="https://en.wikipedia.org/wiki/Hash_array_mapped_trie">https://en.wikipedia.org/wiki/Hash_array_mapped_trie</a>
</li>

<li>Java theory and practice: To mutate or not to mutate?<br />
<a href="http://www.ibm.com/developerworks/java/library/j-jtp02183/index.html">http://www.ibm.com/developerworks/java/library/j-jtp02183/index.html</a>
</li>

<li>Efficient persistent (immutable) data structures<br />
<a href="https://persistent.codeplex.com/">https://persistent.codeplex.com/</a>
</li>

<li>Clojure (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/Clojure">http://en.wikipedia.org/wiki/Clojure</a>
</li>

<li>Clojure (Wikipedia CS)<br />
<a href="http://cs.wikipedia.org/wiki/Clojure">http://cs.wikipedia.org/wiki/Clojure</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2022</small></p>
</body>
</html>

