<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Skripty pro automatické ovládání aplikací s&nbsp;GUI postavené na knihovně PyAutoGUI</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Skripty pro automatické ovládání aplikací s&nbsp;GUI postavené na knihovně PyAutoGUI</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Na článek o nástroji xdotool dnes tematicky navážeme. Zaměříme se totiž na knihovnu nazvanou PyAutoGUI. Tato knihovna umožňuje ovládat aplikace s grafickým uživatelským rozhraním (simulovat operace prováděné myší atd.), a to s využitím skriptů naprogramovaných v Pythonu.</p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. Skripty pro automatické ovládání aplikací s&nbsp;GUI postavené na knihovně <i>PyAutoGUI</i></a></p>
<p><a href="#k02">*** 2. Od nástroje <strong>xdotool</strong> ke knihovně <i>PyAutoGUI</i></a></p>
<p><a href="#k03">*** 3. Instalace knihovny <i>PyAutoGUI</i> i všech potřebných podpůrných balíčků</a></p>
<p><a href="#k04">*** 4. Otestování instalace</a></p>
<p><a href="#k05">*** 5. </a></p>
<p><a href="#k06">*** 6. </a></p>
<p><a href="#k07">*** 7. </a></p>
<p><a href="#k08">*** 8. </a></p>
<p><a href="#k09">*** 9. </a></p>
<p><a href="#k10">*** 10. </a></p>
<p><a href="#k11">*** 11. </a></p>
<p><a href="#k12">*** 12. </a></p>
<p><a href="#k13">*** 13. </a></p>
<p><a href="#k14">*** 14. </a></p>
<p><a href="#k15">*** 15. </a></p>
<p><a href="#k16">*** 16. Pomocný nástroj <strong>mouseInfo</strong></a></p>
<p><a href="#k17">*** 17. Pomocný nástroj <strong>scrot</strong></a></p>
<p><a href="#k18">*** 18. Využití knihovny <i>PyAutoGUI</i> pro testování aplikací &ndash; virtuální framebuffer</a></p>
<p><a href="#k19">*** 19. Repositář s&nbsp;demonstračními příklady</a></p>
<p><a href="#k20">*** 20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Skripty pro automatické ovládání aplikací s&nbsp;GUI postavené na knihovně <i>PyAutoGUI</i></h2>

<p>Unixové systémy a od nich odvozené operační systémy (mezi něž v&nbsp;současnosti patří především Linux apod.) jsou používány a oblíbeny mj.&nbsp;i z&nbsp;toho důvodu, že umožňují relativně snadnou automatizaci mnoha operací s&nbsp;využitím skriptů, které mohou nahradit ruční zadávání jednotlivých příkazů a popř.&nbsp;přenos dat mezi nimi. Primárně je skriptování doménou takových nástrojů a utilit, jejichž vstupní či výstupní data jsou reprezentována textovými či (v&nbsp;poněkud menší míře) binárními daty. Ostatně pro tento účel je v&nbsp;unixu dostupných mnoho desítek specializovaných nástrojů (<strong>wc</strong>, <strong>uniq</strong>, <strong>sort</strong>, <strong>sed</strong>, <strong>grep</strong>, <strong>awk</strong> a tak dále). Mnohdy je však užitečné skriptovat (či nějakým způsobem automatizovat) i ty aplikace, které jsou vybaveny grafickým uživatelským rozhraním a ovládají se s&nbsp;využitím klávesnice a myši popř.&nbsp;pomocí podobně koncipovaných vstupních zařízení (touchpad, trackball atd.). Některé pokročilejší aplikace automatizaci explicitně podporují, protože jsou skriptovatelné. Jedná se o některé komerční aplikace (AutoCAD), ale například i o GIMP, LibreOffice apod.</p>

<p>Ve skutečnosti je však možné programově ovládat i ostatní aplikace s&nbsp;grafickým uživatelským rozhraním, a to i ty aplikace, které pro tento účel nejsou explicitně připraveny. <a href="">Relativně nedávno</a> jsme se na stránkách Roota věnovali popisu nástroje nazvaného <strong>xdotool</strong>, který je určen pro automatizaci některých operací, které jsou běžně prováděny interaktivně uživatelem, tedy primárně s&nbsp;využitím klávesnice a myši. Připomeňme si, že tento nástroj <a href="https://github.com/jordansissel/xdotool">naprogramovaný primárně v&nbsp;C</a>, jenž je volatelný přímo z&nbsp;příkazové řádky a tím pádem i z&nbsp;BASH skriptů atd., umožňuje provádět mj.&nbsp;i následující operace:</p>

<ol>
<li>Simulace stisku klávesy popř.&nbsp;klávesy s&nbsp;modifikátorem</li>
<li>Simulace buď pouze stisku či naopak puštění klávesy</li>
<li>Simulace psaní delšího textu (tedy sekvence alfanumerických kláves)</li>
<li>Interaktivní výběr okna pro prováděné operace</li>
<li>Automatický výběr okna pro prováděné operace na základě zadaného kritéria</li>
<li>Simulace stisku vybraného tlačítka myši</li>
<li>Simulace pohybu ukazatelem myši</li>
<li>Další operace s&nbsp;vybraným oknem, například jeho minimalizace apod.</li>
<li>Naprogramování akce, která se má provést při změně stavu okna (najetí myší apod.)</li>
</ol>

<p><div class="rs-tip-major">Poznámka: automatické ovládání aplikací s&nbsp;GUI lze využít v&nbsp;mnoha oblastech. Kromě tvorby &bdquo;GUI maker&ldquo; pro automatizaci některých činností se jedná především o testování. V&nbsp;oblasti webových aplikací (a některé dnešní aplikace jsou založeny na webovém prohlížeči, ať již klasickém, či &bdquo;schovaném&ldquo; ve frameworcích typu Electron) se pro tento účel používá nástroj <i>Selenium</i>, které obsahuje podporu i pro Python a další programovací jazyky. Existují však i další nástroje s&nbsp;podobným zaměřením, například <i>Windmill</i> či <i>Splinter</i>.</div></p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Od nástroje <strong>xdotool</strong> ke knihovně <i>PyAutoGUI</i></h2>

<p>V&nbsp;případě, že budete potřebovat volat <strong>xdotool</strong> z&nbsp;jiných programovacích jazyků (tedy nikoli pouze ze shellu), je vhodné se poohlédnout po rozhraních k&nbsp;těmto jazykům.  V&nbsp;případě Pythonu se například jedná o dnes již poněkud zastaralou knihovnu nazvanou <a href="https://pypi.org/project/python-libxdo/">python-libxdo</a>. Pro mnoho účelů &ndash; zejména pro tvorbu testů &ndash; je však výhodnější použít balíček <a href="https://pypi.org/project/PyAutoGUI/">PyAutoGUI</a>, s&nbsp;nímž se seznámíme v&nbsp;dnešním článku. Důvodem pro přechod ke knihovně <i>PyAutoGUI</i> může být i to, že některé operace poskytované nástrojem <strong>xdotool</strong> jsou nedostatečné, protože například neumožňují snadno vyhledávat ovládací prvky atd.</p>

<p>Mezi operace, které knihovna PyAutoGUI podporuje, patří především:</p>

<ol>
</ol>

<p><div class="rs-tip-major">Poznámka: mnohé z&nbsp;těchto operací se (podle očekávání) překrývají s&nbsp;možnostmi nástroje <strong>xdotool</strong>.</div></p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Instalace knihovny <i>PyAutoGUI</i> i všech potřebných podpůrných balíčků</h2>

<p>Samotná knihovna <i>PyAutoGUI</i> je pochopitelně <a href="">dostupná na PyPi</a>, takže by teoreticky měla být její instalace jednoduchá a přímočará. Ovšem některé operace vyžadují přístup na úrovni <i>xlib</i> a pro tento účel je nutné explicitně nainstalovat další podpůrný balíček nazvaný <i>python3-xlib</i>. Instalaci tohoto balíčku ovšem neprovedeme přes <a href="">PyPi</a>, ale s&nbsp;využitím balíčkovacího nástroje daného operačního systému (<strong>dnf</strong>, <strong>apt-get</strong> atd.):</p>

<pre>
# <strong>dnf install python3-xlib</strong>
</pre>

<p>Průběh instalace může proběhnout následovně:</p>

<pre>
Last metadata expiration check: 0:09:59 ago on Sat 06 Feb 2021 06:14:01 AM EST.
Dependencies resolved.
================================================================================
 Package              Architecture   Version              Repository       Size
================================================================================
Installing:
 python3-xlib         noarch         0.28-2.fc32          updates         262 k
&nbsp;
Transaction Summary
================================================================================
Install  1 Package

Total download size: 262 k
Installed size: 1.1 M
Is this ok [y/N]:
Downloading Packages:
python3-xlib-0.28-2.fc32.noarch.rpm             402 kB/s | 262 kB     00:00    
--------------------------------------------------------------------------------
Total                                           199 kB/s | 262 kB     00:01     
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1
  Installing       : python3-xlib-0.28-2.fc32.noarch                        1/1
  Running scriptlet: python3-xlib-0.28-2.fc32.noarch                        1/1
  Verifying        : python3-xlib-0.28-2.fc32.noarch                        1/1
&nbsp;
Installed:
  python3-xlib-0.28-2.fc32.noarch
&nbsp;
Complete!
</pre>

<p>Po instalaci balíčku <strong>python3-xlib</strong> již můžeme přistoupit k&nbsp;instalaci knihovny <i>PyAutoGUI</i>. Pro tento účel již použijeme známý nástroj <strong>pip</strong> (či <strong>pip3</strong>) určený pro Pythonovský ekosystém:</p>

<pre>
$ <strong>pip install --user pyautogui</strong>
</pre>

<p>Průběh instalace:</p>

<pre>
Collecting pyautogui
  Downloading https://files.pythonhosted.org/packages/40/0a/1373680148828d7ea3f0e432f06c08f51a33d72306719954d3ae379f5890/PyAutoGUI-0.9.52.tar.gz (55kB)
     |████████████████████████████████| 61kB 1.8MB/s 
Collecting pymsgbox
  Downloading https://files.pythonhosted.org/packages/7d/ff/4c6f31a4f08979f12a663f2aeb6c8b765d3bd592e66eaaac445f547bb875/PyMsgBox-1.0.9.tar.gz
  Installing build dependencies ... done
  Getting requirements to build wheel ... done
    Preparing wheel metadata ... done
Collecting PyTweening&gt;=1.0.1
  Downloading https://files.pythonhosted.org/packages/b9/f8/c32a58d6e4dff8aa5c27e907194d69f3b57e525c2e4af96f39c6e9c854d2/PyTweening-1.0.3.zip
Collecting pyscreeze&gt;=0.1.21
  Downloading https://files.pythonhosted.org/packages/b7/7d/a0e85da28a96e2ff2f39e682ff84eb92501b564883fde87d92aee29966a2/PyScreeze-0.1.26.tar.gz
Collecting pygetwindow&gt;=0.0.5
  Downloading https://files.pythonhosted.org/packages/e1/70/c7a4f46dbf06048c6d57d9489b8e0f9c4c3d36b7479f03c5ca97eaa2541d/PyGetWindow-0.0.9.tar.gz
Collecting mouseinfo
  Downloading https://files.pythonhosted.org/packages/28/fa/b2ba8229b9381e8f6381c1dcae6f4159a7f72349e414ed19cfbbd1817173/MouseInfo-0.1.3.tar.gz
Collecting python3-Xlib
  Downloading https://files.pythonhosted.org/packages/ef/c6/2c5999de3bb1533521f1101e8fe56fd9c266732f4d48011c7c69b29d12ae/python3-xlib-0.15.tar.gz (132kB)
     |████████████████████████████████| 133kB 3.7MB/s 
Collecting Pillow&gt;=6.2.1
  Downloading https://files.pythonhosted.org/packages/c9/57/a6c81c1d6b8973d288ec6df0993a71a61318c862afc1de71fd3aa1ba1dcd/Pillow-8.1.0-cp38-cp38-manylinux1_x86_64.whl (2.2MB)
     |████████████████████████████████| 2.2MB 16.7MB/s 
Collecting pyrect
  Downloading https://files.pythonhosted.org/packages/2f/68/bd7bf96fc44217e769f27912e6c9bb3e9987cba286054af6120448ce8212/PyRect-0.1.4.tar.gz
Collecting pyperclip
  Downloading https://files.pythonhosted.org/packages/6f/4c/0b1d507ad7e8bc31d690d04b4f475e74c2002d060f7994ce8c09612df707/pyperclip-1.8.1.tar.gz
Building wheels for collected packages: pymsgbox
  Building wheel for pymsgbox (PEP 517) ... done
  Created wheel for pymsgbox: filename=PyMsgBox-1.0.9-cp38-none-any.whl size=7420 sha256=c0e7f71340220fc6f6ababdb5a98260331111d2260fc7843e5854bb0fa40a5eb
  Stored in directory: /home/tester/.cache/pip/wheels/16/d7/4e/fffdd54b1cca86608b7655c9a2854890a38f955ce9532848cd
Successfully built pymsgbox
Installing collected packages: pymsgbox, PyTweening, Pillow, pyscreeze, pyrect, pygetwindow, pyperclip, python3-Xlib, mouseinfo, pyautogui
    Running setup.py install for PyTweening ... done
    Running setup.py install for pyscreeze ... done
    Running setup.py install for pyrect ... done
    Running setup.py install for pygetwindow ... done
    Running setup.py install for pyperclip ... done
    Running setup.py install for python3-Xlib ... done
    Running setup.py install for mouseinfo ... done
    Running setup.py install for pyautogui ... done
Successfully installed Pillow-8.1.0 PyTweening-1.0.3 mouseinfo-0.1.3 pyautogui-0.9.52 pygetwindow-0.0.9 pymsgbox-1.0.9 pyperclip-1.8.1 pyrect-0.1.4 pyscreeze-0.1.26 python3-Xlib-0.15
</pre>

<p><div class="rs-tip-major">Poznámka: povšimněte si, že se nainstalovalo relativně velké množství podpůrných knihoven, s&nbsp;nimiž se (alespoň nepřímo) seznámíme v&nbsp;dalším textu.</div></p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Otestování instalace</h2>

<p></p>

<pre>
$ <strong>$ python3</strong>
</pre>

<pre>
&gt;&gt;&gt; import pyautogui
&gt;&gt;&gt; help(pyautogui)
</pre>

<pre>
Help on package pyautogui:
&nbsp;
NAME
    pyautogui
&nbsp;
DESCRIPTION
    # PyAutoGUI lets Python control the mouse and keyboard, and other GUI automation tasks. For Windows, macOS, and Linux,
    # on Python 3 and 2.
    # https://github.com/asweigart/pyautogui
    # Al Sweigart al@inventwithpython.com (Send me feedback &amp; suggestions!)
&nbsp;
PACKAGE CONTENTS
    __main__
    _pyautogui_java
    _pyautogui_osx
    _pyautogui_win
    _pyautogui_x11
&nbsp;
SUBMODULES
    platformModule
&nbsp;
CLASSES
    builtins.Exception(builtins.BaseException)
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Simulace stisku kláves</h2>

<p></p>



<p><a name="k06"></a></p>
<h2 id="k06">6. </h2>

<p></p>



<p><a name="k07"></a></p>
<h2 id="k07">7. </h2>

<p></p>



<p><a name="k08"></a></p>
<h2 id="k08">8. </h2>

<p></p>



<p><a name="k09"></a></p>
<h2 id="k09">9. </h2>

<p></p>



<p><a name="k10"></a></p>
<h2 id="k10">10. </h2>

<p></p>



<p><a name="k11"></a></p>
<h2 id="k11">11. </h2>

<p></p>



<p><a name="k12"></a></p>
<h2 id="k12">12. </h2>



<p><a name="k13"></a></p>
<h2 id="k13">13. </h2>



<p><a name="k14"></a></p>
<h2 id="k14">14. </h2>



<p><a name="k15"></a></p>
<h2 id="k15">15. </h2>



<p><a name="k16"></a></p>
<h2 id="k16">16. Pomocný nástroj <strong>mouseInfo</strong></h2>



<p><a name="k17"></a></p>
<h2 id="k17">17. Pomocný nástroj <strong>scrot</strong></h2>

<p>Dalším pomocným nástrojem, který může být knihovnou <i>PyAutoGUI</i> využit, je nástroj pojmenovaný <strong>scrot</strong>. Jedná se o aplikaci, která slouží pro získání screenshotů, a to buď screenshotů celé obrazovky, vybrané oblasti obrazovky, či screenshotu jednoho okna. Tento nástroj se ovládá z&nbsp;příkazové řádky a podle očekávání je k&nbsp;němu dodávána i manuálová stránka:</p>

<pre>
$ <strong>man scrot</strong>
</pre>

<pre>
scrot(1)                                                          General Commands Manual                                                          scrot(1)
&nbsp;
NAME
       scrot - Screen capture using imlib2
&nbsp;
SYNOPSIS
       scrot [options] [file]
&nbsp;
DESCRIPTION
       scrot  is  a  screen capture utility using the imlib2 library to aquire and save images.  scrot has a few options, detailed below. Specify [file] as
       the filename to save the screenshot to.  If [file] is not specified, a date-stamped file will be dropped in the current directory.
&nbsp;
</pre>



<p><a name="k18"></a></p>
<h2 id="k18">18. Využití knihovny <i>PyAutoGUI</i> pro testování aplikací &ndash; virtuální framebuffer</h2>

<p>V&nbsp;závěrečné části dnešního článku se ještě zmiňme o problematice testování aplikací s&nbsp;grafickým uživatelským rozhraním. Testování těchto aplikací má jednu nevýhodu &ndash; pokud testovanou aplikaci spustíme a spustíme i GUI testy, bude samotné desktopové prostředí v&nbsp;době testování nepoužitelné. Jedním z&nbsp;možných řešení je použití <i>virtuálního framebufferu</i>.</p>



<p><a name="k19"></a></p>
<h2 id="k19">19. Repositář s&nbsp;demonstračními příklady</h2>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>Repositář balíčku PyAutoGUI na GitHubu<br />
<a href="https://github.com/asweigart/pyautogui">https://github.com/asweigart/pyautogui</a>
</li>

<li>PyAutoGUI 0.9.52 (na PyPi)<br />
<a href="https://pypi.org/project/PyAutoGUI/">https://pypi.org/project/PyAutoGUI/</a>
</li>

<li>Dokumentace ke knihovně PyAutoGUI<br />
<a href="https://pyautogui.readthedocs.io/en/latest/">https://pyautogui.readthedocs.io/en/latest/</a>
</li>

<li>Xdotool - Keyboard<br />
<a href="https://www.linux.org/threads/xdotool-keyboard.10528/">https://www.linux.org/threads/xdotool-keyboard.10528/</a>
</li>

<li>How to Use Xdotool to Stimulate Mouse Clicks and Keystrokes in Linux<br />
<a href="https://linuxhint.com/xdotool_stimulate_mouse_clicks_and_keystrokes/">https://linuxhint.com/xdotool_stimulate_mouse_clicks_and_keystrokes/</a>
</li>

<li>xdootool.1 (manuálová stránka)<br />
<a href="http://manpages.ubuntu.com/manpages/trusty/man1/xdotool.1.html">http://manpages.ubuntu.com/manpages/trusty/man1/xdotool.1.html</a>
</li>

<li>Repositář projektu xdotool<br />
<a href="https://github.com/jordansissel/xdotool">https://github.com/jordansissel/xdotool</a>
</li>

<li>Balíček python-libxdo<br />
<a href="https://pypi.org/project/python-libxdo/">https://pypi.org/project/python-libxdo/</a>
</li>

<li>Dokumentace k&nbsp;balíčku python-libxdo<br />
<a href="https://rshk.github.io/python-libxdo/library.html">https://rshk.github.io/python-libxdo/library.html</a>
</li>


<li>How do I find the X window ID under the mouse pointer in bash?<br />
<a href="https://unix.stackexchange.com/questions/16131/how-do-i-find-the-x-window-id-under-the-mouse-pointer-in-bash">https://unix.stackexchange.com/questions/16131/how-do-i-find-the-x-window-id-under-the-mouse-pointer-in-bash</a>
</li>

<li>xwininfo (manuálová stránka)<br />
<a href="https://www.x.org/releases/X11R7.7/doc/man/man1/xwininfo.1.xhtml">https://www.x.org/releases/X11R7.7/doc/man/man1/xwininfo.1.xhtml</a>
</li>

<li>xev (manuálová stránka)<br />
<a href="http://manpages.ubuntu.com/manpages/xenial/en/man1/xev.1.html">http://manpages.ubuntu.com/manpages/xenial/en/man1/xev.1.html</a>
</li>

<li>X Window System (Wikipedia)<br />
<a href="https://en.wikipedia.org/wiki/X_Window_System">https://en.wikipedia.org/wiki/X_Window_System</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2021</small></p>
</body>
</html>

