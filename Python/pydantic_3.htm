<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Validace dat v Pythonu s využitím knihovny Pydantic (3. část - dokumentace)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Validace dat v Pythonu s využitím knihovny Pydantic (3. část - dokumentace)</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Ve třetím článku o knihovně Pydantic si vysvětlíme, jakým způsobem je možné vygenerovat dokumentaci k definovanému modelu nebo i více modelům. Tento proces sice není složitý, ale vyžaduje několik triků.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Validace dat v&nbsp;Pythonu s&nbsp;využitím knihovny Pydantic (3. část - dokumentace)</a></p>
<p><a href="#k02">2. První varianta demonstračního datového modelu</a></p>
<p><a href="#k03">3. Otestování demonstračního příkladu: načtení dat s&nbsp;jejich následným exportem</a></p>
<p><a href="#k04">4. Export schématu modelu</a></p>
<p><a href="#k05">5. Ukázka vyexportovaného schématu před a po jeho naformátování</a></p>
<p><a href="#k06">6. Export schématu ve formátu OpenAPI</a></p>
<p><a href="#k07">7. Ukázka vyexportovaného schématu před a po jeho naformátování</a></p>
<p><a href="#k08">8. První pokus o načtení schématu do SwaggerEditoru</a></p>
<p><a href="#k09">9. Změna atributu <strong>exclusiveMinimum</strong> na <strong>minimum</strong></a></p>
<p><a href="#k10">10. Druhý pokus o načtení schématu do SwaggerEditoru</a></p>
<p><a href="#k11">11. Špinavý trik s&nbsp;opravou definice volitelných atributů</a></p>
<p><a href="#k12">12. Třetí (úspěšný) pokus o načtení schématu do SwaggerEditoru</a></p>
<p><a href="#k13">13. Vygenerování dokumentace ve formátu Markdown</a></p>
<p><a href="#k14">14. Přidání popisků k&nbsp;jednotlivým atributům modelu</a></p>
<p><a href="#k15">15. Úplný zdrojový kód příkladu s&nbsp;popsaným modelem</a></p>
<p><a href="#k16">16. Dokument se schématem, které má popsány všechny atributy</a></p>
<p><a href="#k17">17. Převod na HTML stránku či na jiný typ dokumentu</a></p>
<p><a href="#k18">18. Závěr</a></p>
<p><a href="#k19">19. Repositář s&nbsp;demonstračními příklady</a></p>
<p><a href="#k20">20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Validace dat v&nbsp;Pythonu s&nbsp;využitím knihovny Pydantic (3. část - dokumentace)</h2>

<p>Na úvodní dva články o knihovně Pydantic [<a
href="https://www.root.cz/clanky/validace-dat-v-pythonu-s-vyuzitim-knihovny-pydantic/">1</a>]
[<a
href="https://www.root.cz/clanky/validace-dat-v-pythonu-s-vyuzitim-knihovny-pydantic-2-cast/">2</a>]
dnes navážeme. Prozatím jsme si popsali způsob definice (datového) modelu, jeho
načítání a ukládání a samozřejmě i způsob validace, zda jsou všechny atributy
(a vůbec celá struktura modelu) korektní. Ovšem ještě si musíme ukázat další
velmi důležitou techniku &ndash; způsob automatického vygenerování dokumentace
k&nbsp;modelu nebo modelům (to znamená i volbu formátu dokumentace atd.). Jedná
se o oblast, která vyžaduje kombinaci možností nabízených knihovnou
<i>Pydantic</i> s&nbsp;dalšími nástroji (a navíc i několika triky). Výsledkem
může být dokumentace ve formátu specifikace OpenAPI (tu dokážou zpracovávat
různé nástroje) nebo dokument ve formátu Markdown (který lze pochopitelně
naimportovat do textových procesorů, systémů pro správu obsahu včetně
Confluence atd.), popř.&nbsp;dokument převedený z&nbsp;Markdownu do dalších
formátů (HTML atd.).</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. První varianta demonstračního datového modelu</h2>

<p>V&nbsp;dalších kapitolách budeme pracovat s&nbsp;relativně jednoduchým
datovým modelem, který později vylepšíme přidáním popisků k&nbsp;jeho
jednotlivým atributům. V&nbsp;knihovně Pydantic jsou všechny modely přímo či
nepřímo odvozeny od třídy <strong>BaseModel</strong>:</p>

<pre>
from pydantic import BaseModel
</pre>

<p>My ovšem budeme požadovat, aby vstupní data, která datový model
reprezentuje, neobsahovala žádné atributy navíc. Z&nbsp;tohoto důvodu od třídy
<strong>BaseModel</strong> odvodíme novou &bdquo;základní&ldquo; třídu nazvanou
<strong>ConfigurationBase</strong>, která sice obsahuje všechny vlastností
původního základního modelu, ovšem navíc vyžaduje, aby model
<strong>ne</strong>obsahoval neznámé (předem nedefinované) atributy:</p>

<pre>
class <strong>ConfigurationBase</strong>(BaseModel):
    <i>"""Base class for all configuration models that rejects unknown fields."""</i>
&nbsp;
    model_config = ConfigDict(extra="forbid")
</pre>

<p>Náš datový model bude popsán třídou pojmenovanou
<strong>Configuration</strong>. Jedná se o zdánlivě jednoduchý model
s&nbsp;pouhými dvěma atributy:</p>

<pre>
class <strong>Configuration</strong>(ConfigurationBase):
    <i>"""Global configuration."""</i>
&nbsp;
    name: str
    service: ServiceConfiguration
</pre>

<p>Ovšem při prvním pohledu na typy těchto atributů je zřejmé, že musíme
dodefinovat <strong>ServiceConfiguration</strong>. Základní varianta této třídy
může vypadat následovně:</p>

<pre>
class <strong>ServiceConfiguration</strong>(ConfigurationBase):
    <i>"""Service configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 8080
    auth_enabled: bool = False
    workers: PositiveInt = 1
    database: DatabaseConfiguration
&nbsp;
    @model_validator(mode="after")
    def <strong>check_service_configuration</strong>(self) -&gt; Self:
        <i>"""Check service configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
</pre>

<p>Ovšem stále ještě nejsme u konce, neboť zbývá dodefinovat typ atributu
nazvaného <strong>database</strong>. Tento atribut je typu
<strong>DatabaseConfiguration</strong>:</p>

<pre>
class <strong>DatabaseConfiguration</strong>(ConfigurationBase):
    <i>"""Database configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 5432
    db: str
    user: str
    password: str
    ssl_mode: str = POSTGRES_DEFAULT_SSL_MODE
    gss_encmode: str = POSTGRES_DEFAULT_GSS_ENCMODE
    ca_cert_path: Optional[FilePath] = None
&nbsp;
    @model_validator(mode="after")
    def <strong>check_postgres_configuration</strong>(self) -&gt; Self:
        <i>"""Check PostgreSQL configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
</pre>

<p>V&nbsp;tento okamžik již máme k&nbsp;dispozici všechny části dnešního
prvního demonstračního příkladu, jehož úplný zdrojový kód vypadá
následovně:</p>

<pre>
<i># Knihovna Pydantic</i>
<i>#</i>
<i># - model s konfigurací obsahující čtyři atributy</i>
<i># - jeden z atributů je tvořen dalším modelem</i>
<i># - kontrola obsahu atributů po inicializaci modelu</i>
<i># - zákaz inicializace modelu s neznámými atributy</i>
&nbsp;
import json
from typing_extensions import Optional, Self
&nbsp;
from pydantic import (
    BaseModel,
    ConfigDict,
    FilePath,
    PositiveInt,
    model_validator,
)
&nbsp;
<i># PostgreSQL connection constants</i>
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLMODE</i>
POSTGRES_DEFAULT_SSL_MODE = "prefer"
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-GSSENCMODE</i>
POSTGRES_DEFAULT_GSS_ENCMODE = "prefer"
&nbsp;
&nbsp;
class <strong>ConfigurationBase</strong>(BaseModel):
    <i>"""Base class for all configuration models that rejects unknown fields."""</i>
&nbsp;
    model_config = ConfigDict(extra="forbid")
&nbsp;
&nbsp;
class <strong>DatabaseConfiguration</strong>(ConfigurationBase):
    <i>"""Database configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 5432
    db: str
    user: str
    password: str
    ssl_mode: str = POSTGRES_DEFAULT_SSL_MODE
    gss_encmode: str = POSTGRES_DEFAULT_GSS_ENCMODE
    ca_cert_path: Optional[FilePath] = None
&nbsp;
    @model_validator(mode="after")
    def <strong>check_postgres_configuration</strong>(self) -&gt; Self:
        <i>"""Check PostgreSQL configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>ServiceConfiguration</strong>(ConfigurationBase):
    <i>"""Service configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 8080
    auth_enabled: bool = False
    workers: PositiveInt = 1
    database: DatabaseConfiguration
&nbsp;
    @model_validator(mode="after")
    def <strong>check_service_configuration</strong>(self) -&gt; Self:
        <i>"""Check service configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>Configuration</strong>(ConfigurationBase):
    <i>"""Global configuration."""</i>
&nbsp;
    name: str
    service: ServiceConfiguration
&nbsp;
    def <strong>dump</strong>(self, filename: str = "configuration.json") -&gt; None:
        <i>"""Dump actual configuration into JSON file."""</i>
        with open(filename, "w", encoding="utf-8") as fout:
            fout.write(self.model_dump_json(indent=4))
</pre>



<p><a name="k03"></a></p>
<h2 id="k03">3. Otestování demonstračního příkladu: načtení dat s&nbsp;jejich následným exportem</h2>

<p><a href="#k02">Výše uvedený</a> příklad (resp.&nbsp;přesněji řečeno model,
jenž je v&nbsp;něm definován) otestujeme relativně snadno. Načteme do modelu
obsah tohoto souboru (ve formátu YAML) a následně budeme obsah modelu
exportovat:</p>

<pre>
name: Service configuration #1
service:
  host: 127.0.0.1
  port: 8080
  auth_enabled: false
  workers: 5
  database:
    host: db1.pg.com
    db: test
    user: test
    password: 123qwe
</pre>

<p>Načtení tohoto souboru obstará následující kód využívající knihovnu
<strong>yaml</strong>:</p>

<pre>
import yaml
&nbsp;
def <strong>load_configuration</strong>(filename: str) -&gt; Configuration:
    """Load configuration from YAML file."""
    with open(filename, encoding="utf-8") as fin:
        config_dict = yaml.safe_load(fin)
        return Configuration(**config_dict)
</pre>

<p>Samotné načtení následované exportem dat je již otázkou dvou programových
řádků:</p>

<pre>
configuration = load_configuration("config_10.yaml")
configuration.dump("config_10.json")
</pre>

<p>Výsledkem by měl být soubor <strong>config_10.json</strong>
s&nbsp;exportovaným modelem:</p>

<pre>
{
    "name": "Service configuration",
    "service": {
        "host": "127.0.0.1",
        "port": 8080,
        "auth_enabled": false,
        "workers": 5,
        "database": {
            "host": "db1.pg.com",
            "port": 5432,
            "db": "test",
            "user": "test",
            "password": "123qwe",
            "ssl_mode": "prefer",
            "gss_encmode": "prefer",
            "ca_cert_path": null
        }
    }
}
</pre>

<p><div class="rs-tip-major">Poznámka: pro jednoduchost jsme vynechali část
s&nbsp;načítáním hesel (nebo dalších atributů) z&nbsp;externích souborů
popř.&nbsp;z&nbsp;proměnných prostředí (<i>environment
variables</i>).</div></p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Export schématu modelu</h2>

<p>Knihovna Pydantic umožňuje export schématu modelu (tj.&nbsp;popisu struktury
dat) do formátu JSON. Postačuje zavolat metodu
<strong>model_json_schema</strong>, která vrací slovník (<i>dictionary</i>)
s&nbsp;popisem schématu modelu:</p>

<pre>
Help on method model_json_schema in module pydantic.main:
&nbsp;
model_json_schema(by_alias: 'bool' = True, ref_template: 'str' = '#/$defs/{model}', schema_generator: 'type[GenerateJsonSchema]' = <class 'pydantic.json_schema.GenerateJsonSchema'>, mode: 'JsonSchemaMode' = 'validation') -&gt; 'dict[str, Any]' class method of pydantic.main.BaseModel
    Generates a JSON schema for a model class.
&nbsp;
    Args:
        by_alias: Whether to use attribute aliases or not.
        ref_template: The reference template.
        schema_generator: To override the logic used to generate the JSON schema, as a subclass of
            `GenerateJsonSchema` with your desired modifications
        mode: The mode in which to generate the schema.
&nbsp;
    Returns:
        The JSON schema for the given model class.
</pre>

<p>Následný export do formátu JSON je již snadný, protože pro tento účel můžeme
použít standardní balíček <strong>json</strong>:</p>

<pre>
with open("schema_11.json", "w") as fout:
    json.dump(Configuration.model_json_schema(), fout)
</pre>

<p>Upravme si tedy náš demonstrační příklad do takové podoby, aby po svém
spuštění vytvořil soubor s&nbsp;popisem schématu modelu:</p>

<pre>
<i># Knihovna Pydantic</i>
<i>#</i>
<i># - model s konfigurací obsahující čtyři atributy</i>
<i># - jeden z atributů je tvořen dalším modelem</i>
<i># - kontrola obsahu atributů po inicializaci modelu</i>
<i># - zákaz inicializace modelu s neznámými atributy</i>
<i># - export schématu modelu</i>
&nbsp;
import json
from typing_extensions import Optional, Self
&nbsp;
from pydantic import (
    BaseModel,
    ConfigDict,
    FilePath,
    PositiveInt,
    model_validator,
)
&nbsp;
<i># PostgreSQL connection constants</i>
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLMODE</i>
POSTGRES_DEFAULT_SSL_MODE = "prefer"
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-GSSENCMODE</i>
POSTGRES_DEFAULT_GSS_ENCMODE = "prefer"
&nbsp;
&nbsp;
class <strong>ConfigurationBase</strong>(BaseModel):
    <i>"""Base class for all configuration models that rejects unknown fields."""</i>
&nbsp;
    model_config = ConfigDict(extra="forbid")
&nbsp;
&nbsp;
class <strong>DatabaseConfiguration</strong>(ConfigurationBase):
    <i>"""Database configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 5432
    db: str
    user: str
    password: str
    ssl_mode: str = POSTGRES_DEFAULT_SSL_MODE
    gss_encmode: str = POSTGRES_DEFAULT_GSS_ENCMODE
    ca_cert_path: Optional[FilePath] = None
&nbsp;
    @model_validator(mode="after")
    def <strong>check_postgres_configuration</strong>(self) -&gt; Self:
        <i>"""Check PostgreSQL configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>ServiceConfiguration</strong>(ConfigurationBase):
    <i>"""Service configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 8080
    auth_enabled: bool = False
    workers: PositiveInt = 1
    database: DatabaseConfiguration
&nbsp;
    @model_validator(mode="after")
    def <strong>check_service_configuration</strong>(self) -&gt; Self:
        <i>"""Check service configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>Configuration</strong>(ConfigurationBase):
    <i>"""Global configuration."""</i>
&nbsp;
    name: str
    service: ServiceConfiguration
&nbsp;
    def <strong>dump</strong>(self, filename: str = "configuration.json") -&gt; None:
        <i>"""Dump actual configuration into JSON file."""</i>
        with open(filename, "w", encoding="utf-8") as fout:
            fout.write(self.model_dump_json(indent=4))
&nbsp;
&nbsp;
with open("schema_11.json", "w") as fout:
    json.dump(Configuration.model_json_schema(), fout)
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Ukázka vyexportovaného schématu před a po jeho naformátování</h2>

<p>Soubor <strong>schema_11.json</strong> se schématem, který jsme získali, má
následující obsah:</p>

<pre>
{"$defs": {"DatabaseConfiguration": {"additionalProperties": false, "description": "Database configuration.",
"properties": {"host": {"default": "localhost", "title": "Host", "type": "string"}, "port": {"default": 5432,
"exclusiveMinimum": 0, "title": "Port", "type": "integer"}, "db": {"title": "Db", "type": "string"}, "user":
{"title": "User", "type": "string"}, "password": {"title": "Password", "type": "string"}, "ssl_mode": {"default":
"prefer", "title": "Ssl Mode", "type": "string"}, "gss_encmode": {"default": "prefer", "title": "Gss Encmode",
"type": "string"}, "ca_cert_path": {"anyOf": [{"format": "file-path", "type": "string"}, {"type": "null"}],
"default": null, "title": "Ca Cert Path"}}, "required": ["db", "user", "password"], "title": "DatabaseConfiguration",
"type": "object"}, "ServiceConfiguration": {"additionalProperties": false, "description": "Service configuration.",
"properties": {"host": {"default": "localhost", "title": "Host", "type": "string"}, "port": {"default": 8080,
"exclusiveMinimum": 0, "title": "Port", "type": "integer"}, "auth_enabled": {"default": false, "title": "Auth Enabled",
"type": "boolean"}, "workers": {"default": 1, "exclusiveMinimum": 0, "title": "Workers", "type": "integer"},
"database": {"$ref": "#/$defs/DatabaseConfiguration"}}, "required": ["database"], "title": "ServiceConfiguration",
"type": "object"}}, "additionalProperties": false, "description": "Global configuration.", "properties": {"name":
{"title": "Name", "type": "string"}, "service": {"$ref": "#/$defs/ServiceConfiguration"}}, "required": ["name", "service"],
"title": "Configuration", "type": "object"}
</pre>

<p>To sice není moc čitelné, ovšem nic nám nebrání v&nbsp;naformátování JSONu,
například oblíbeným nástrojem <a
href="https://www.root.cz/clanky/zpracovani-dat-reprezentovanych-ve-formatu-json-nastrojem-jq/">jq</a>:</p>

<pre>
{
  "$defs": {
    "DatabaseConfiguration": {
      "additionalProperties": false,
      "description": "Database configuration.",
      "properties": {
        "host": {
          "default": "localhost",
          "title": "Host",
          "type": "string"
        },
        "port": {
          "default": 5432,
          "exclusiveMinimum": 0,
          "title": "Port",
          "type": "integer"
        },
        "db": {
          "title": "Db",
          "type": "string"
        },
        "user": {
          "title": "User",
          "type": "string"
        },
        "password": {
          "title": "Password",
          "type": "string"
        },
        "ssl_mode": {
          "default": "prefer",
          "title": "Ssl Mode",
          "type": "string"
        },
        "gss_encmode": {
          "default": "prefer",
          "title": "Gss Encmode",
          "type": "string"
        },
        "ca_cert_path": {
          "anyOf": [
            {
              "format": "file-path",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Ca Cert Path"
        }
      },
      "required": [
        "db",
        "user",
        "password"
      ],
      "title": "DatabaseConfiguration",
      "type": "object"
    },
    "ServiceConfiguration": {
      "additionalProperties": false,
      "description": "Service configuration.",
      "properties": {
        "host": {
          "default": "localhost",
          "title": "Host",
          "type": "string"
        },
        "port": {
          "default": 8080,
          "exclusiveMinimum": 0,
          "title": "Port",
          "type": "integer"
        },
        "auth_enabled": {
          "default": false,
          "title": "Auth Enabled",
          "type": "boolean"
        },
        "workers": {
          "default": 1,
          "exclusiveMinimum": 0,
          "title": "Workers",
          "type": "integer"
        },
        "database": {
          "$ref": "#/$defs/DatabaseConfiguration"
        }
      },
      "required": [
        "database"
      ],
      "title": "ServiceConfiguration",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "description": "Global configuration.",
  "properties": {
    "name": {
      "title": "Name",
      "type": "string"
    },
    "service": {
      "$ref": "#/$defs/ServiceConfiguration"
    }
  },
  "required": [
    "name",
    "service"
  ],
  "title": "Configuration",
  "type": "object"
}
</pre>



<p><a name="k06"></a></p>
<h2 id="k06">6. Export schématu ve formátu OpenAPI</h2>

<p><a href="#k05">Výše uvedené</a> schéma do určité míry odpovídá specifikaci
OpenAPI, se kterým se pravděpodobně čtenáři tohoto článku již setkali. Ovšem do
souboru s&nbsp;popisem schématu musíme doplnit další atributy, zejména
specifikaci verze OpenAPI, metainformace, referenci na komponenty (což je
vlastní popis modelu a vlastně i jediná zajímavá část celého souboru) a taktéž
přidáme atribut <strong>paths</strong>, který bude prázdný &ndash; potřebujeme
totiž získat jen popis modelu a nikoli i specifikaci koncových bodů REST
API.</p>

<p>Zdrojový kód demonstračního příkladu tedy upravíme. Využijeme funkci
<strong>models_json_schema</strong> z&nbsp;balíčku
<strong>pydantic.json_schema</strong>:</p>

<pre>
from pydantic.json_schema import models_json_schema
</pre>

<p>Touto funkcí získáme slovník se schématem či schématy. Obsah tohoto slovníku
&bdquo;zabalíme&ldquo; do dalšího slovníku, jehož struktura (jména klíčů a typy
hodnot) budou odpovídat OpenAPI. A poté se již provede export obsahu slovníku
do souboru ve formátu JSON:</p>

<pre>
&nbsp;
with open("schema_12.json", "w") as fout:
    _, schemas = models_json_schema(
        [(model, "validation") for model in [Configuration]],
        ref_template="#/components/schemas/{model}",
    )
    openapi_schema = {
        "openapi": "3.0.0",
        "info": {
            "title": "Weyland-Yutani Information System",
            "version": "0.3.0",
        },
        "components": {
            "schemas": schemas.get('$defs'),
        },
        "paths": {},
    }
    json.dump(openapi_schema, fout)
</pre>

<p><div class="rs-tip-major">Poznámka: titulek a verzi si samozřejmě můžete
modifikovat.</div></p>

<p>Zdrojový kód takto upraveného demonstračního příkladu bude vypadat
následovně:</p>

<pre>
<i># Knihovna Pydantic</i>
<i>#</i>
<i># - model s konfigurací obsahující čtyři atributy</i>
<i># - jeden z atributů je tvořen dalším modelem</i>
<i># - kontrola obsahu atributů po inicializaci modelu</i>
<i># - zákaz inicializace modelu s neznámými atributy</i>
<i># - úprava schématu do podoby OpenAPI</i>
<i># - export schématu modelu</i>
&nbsp;
import json
from typing_extensions import Optional, Self
&nbsp;
from pydantic import (
    BaseModel,
    ConfigDict,
    FilePath,
    PositiveInt,
    model_validator,
)
from pydantic.json_schema import models_json_schema
&nbsp;
&nbsp;
<i># PostgreSQL connection constants</i>
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLMODE</i>
POSTGRES_DEFAULT_SSL_MODE = "prefer"
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-GSSENCMODE</i>
POSTGRES_DEFAULT_GSS_ENCMODE = "prefer"
&nbsp;
&nbsp;
class <strong>ConfigurationBase</strong>(BaseModel):
    <i>"""Base class for all configuration models that rejects unknown fields."""</i>
&nbsp;
    model_config = ConfigDict(extra="forbid")
&nbsp;
&nbsp;
class <strong>DatabaseConfiguration</strong>(ConfigurationBase):
    <i>"""Database configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 5432
    db: str
    user: str
    password: str
    ssl_mode: str = POSTGRES_DEFAULT_SSL_MODE
    gss_encmode: str = POSTGRES_DEFAULT_GSS_ENCMODE
    ca_cert_path: Optional[FilePath] = None
&nbsp;
    @model_validator(mode="after")
    def <strong>check_postgres_configuration</strong>(self) -&gt; Self:
        <i>"""Check PostgreSQL configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>ServiceConfiguration</strong>(ConfigurationBase):
    <i>"""Service configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 8080
    auth_enabled: bool = False
    workers: PositiveInt = 1
    database: DatabaseConfiguration
&nbsp;
    @model_validator(mode="after")
    def <strong>check_service_configuration</strong>(self) -&gt; Self:
        <i>"""Check service configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>Configuration</strong>(ConfigurationBase):
    <i>"""Global configuration."""</i>
&nbsp;
    name: str
    service: ServiceConfiguration
&nbsp;
    def <strong>dump</strong>(self, filename: str = "configuration.json") -&gt; None:
        <i>"""Dump actual configuration into JSON file."""</i>
        with open(filename, "w", encoding="utf-8") as fout:
            fout.write(self.model_dump_json(indent=4))
&nbsp;
&nbsp;
with open("schema_12.json", "w") as fout:
    _, schemas = models_json_schema(
        [(model, "validation") for model in [Configuration]],
        ref_template="#/components/schemas/{model}",
    )
    openapi_schema = {
        "openapi": "3.0.0",
        "info": {
            "title": "Weyland-Yutani Information System",
            "version": "0.3.0",
        },
        "components": {
            "schemas": schemas.get('$defs'),
        },
        "paths": {},
    }
    json.dump(openapi_schema, fout)
</pre>



<p><a name="k07"></a></p>
<h2 id="k07">7. Ukázka vyexportovaného schématu před a po jeho naformátování</h2>

<p>Opět se podívejme na obsah JSONu, který jsme získali:</p>

<pre>
{"openapi": "3.0.0", "info": {"title": "Weyland-Yutani Information System",
"version": "0.3.0"}, "components": {"schemas": {"Configuration":
{"additionalProperties": false, "description": "Global configuration.",
"properties": {"name": {"title": "Name", "type": "string"}, "service": {"$ref":
"#/components/schemas/ServiceConfiguration"}}, "required": ["name", "service"],
"title": "Configuration", "type": "object"}, "DatabaseConfiguration":
{"additionalProperties": false, "description": "Database configuration.",
"properties": {"host": {"default": "localhost", "title": "Host", "type":
"string"}, "port": {"default": 5432, "exclusiveMinimum": 0, "title": "Port",
"type": "integer"}, "db": {"title": "Db", "type": "string"}, "user": {"title":
"User", "type": "string"}, "password": {"title": "Password", "type": "string"},
"ssl_mode": {"default": "prefer", "title": "Ssl Mode", "type": "string"},
"gss_encmode": {"default": "prefer", "title": "Gss Encmode", "type": "string"},
"ca_cert_path": {"anyOf": [{"format": "file-path", "type": "string"}, {"type":
"null"}], "default": null, "title": "Ca Cert Path"}}, "required": ["db",
"user", "password"], "title": "DatabaseConfiguration", "type": "object"},
"ServiceConfiguration": {"additionalProperties": false, "description": "Service
configuration.", "properties": {"host": {"default": "localhost", "title":
"Host", "type": "string"}, "port": {"default": 8080, "exclusiveMinimum": 0,
"title": "Port", "type": "integer"}, "auth_enabled": {"default": false,
"title": "Auth Enabled", "type": "boolean"}, "workers": {"default": 1,
"exclusiveMinimum": 0, "title": "Workers", "type": "integer"}, "database":
{"$ref": "#/components/schemas/DatabaseConfiguration"}}, "required":
["database"], "title": "ServiceConfiguration", "type": "object"}}}, "paths":
{}}
</pre>

<p>Po naformátování je již zřejmé, že se skutečně přibližujeme ke standardnímu
OpenAPI:</p>

<pre>
{
  "openapi": "3.0.0",
  "info": {
    "title": "Weyland-Yutani Information System",
    "version": "0.3.0"
  },
  "components": {
    "schemas": {
      "Configuration": {
        "additionalProperties": false,
        "description": "Global configuration.",
        "properties": {
          "name": {
            "title": "Name",
            "type": "string"
          },
          "service": {
            "$ref": "#/components/schemas/ServiceConfiguration"
          }
        },
        "required": [
          "name",
          "service"
        ],
        "title": "Configuration",
        "type": "object"
      },
      "DatabaseConfiguration": {
        "additionalProperties": false,
        "description": "Database configuration.",
        "properties": {
          "host": {
            "default": "localhost",
            "title": "Host",
            "type": "string"
          },
          "port": {
            "default": 5432,
            "exclusiveMinimum": 0,
            "title": "Port",
            "type": "integer"
          },
          "db": {
            "title": "Db",
            "type": "string"
          },
          "user": {
            "title": "User",
            "type": "string"
          },
          "password": {
            "title": "Password",
            "type": "string"
          },
          "ssl_mode": {
            "default": "prefer",
            "title": "Ssl Mode",
            "type": "string"
          },
          "gss_encmode": {
            "default": "prefer",
            "title": "Gss Encmode",
            "type": "string"
          },
          "ca_cert_path": {
            "anyOf": [
              {
                "format": "file-path",
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "title": "Ca Cert Path"
          }
        },
        "required": [
          "db",
          "user",
          "password"
        ],
        "title": "DatabaseConfiguration",
        "type": "object"
      },
      "ServiceConfiguration": {
        "additionalProperties": false,
        "description": "Service configuration.",
        "properties": {
          "host": {
            "default": "localhost",
            "title": "Host",
            "type": "string"
          },
          "port": {
            "default": 8080,
            "exclusiveMinimum": 0,
            "title": "Port",
            "type": "integer"
          },
          "auth_enabled": {
            "default": false,
            "title": "Auth Enabled",
            "type": "boolean"
          },
          "workers": {
            "default": 1,
            "exclusiveMinimum": 0,
            "title": "Workers",
            "type": "integer"
          },
          "database": {
            "$ref": "#/components/schemas/DatabaseConfiguration"
          }
        },
        "required": [
          "database"
        ],
        "title": "ServiceConfiguration",
        "type": "object"
      }
    }
  },
  "paths": {}
}
</pre>



<p><a name="k08"></a></p>
<h2 id="k08">8. První pokus o načtení schématu do SwaggerEditoru</h2>

<p>V&nbsp;dalším kroku se pokusíme schéma uvedené <a
href="#k07">v&nbsp;předchozí kapitole</a> přenést například do interaktivního
Swagger editoru, jehož volně použitelná varianta je dostupná na adrese <a
href="https://editor.swagger.io/">https://editor.swagger.io/</a>. Výsledný
Swagger s&nbsp;popisem schématu bude vypadat následovně (provede se převod do
YAMLu, to je ovšem jen drobný detail):</p>

<div class="rs-img-center" style="margin-left: auto; margin-right: auto; max-width: 639px"><a href="https://www.root.cz/obrazek/1245786/"><img src="https://i.iinfo.cz/images/408/pydantic-3-1-large.png" class="image-1245786" width="639" height="525" data-prev-filename="https://i.iinfo.cz/images/408/pydantic-3-1-prev.png" data-prev-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-1-prev.webp" data-prev-width="328" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/408/pydantic-3-1-large.png" data-large-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-1-large.webp" data-large-width="639" data-large-height="525" alt="Pydantic" data-description="Pydantic" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" style="width: 100%; height: auto; max-width: 639px" /></a><p>Obrázek 1: Vygenerovaný popis schématu ve Swagger editoru<br class="_remove" /></p><p class="author">Autor: tisnik, podle licence: <a href="http://en.wikipedia.org/wiki/Rights_Managed">Rights Managed</a><br class="_remove" /></p></div>

<p>To je sice poměrně velký krok dopředu k&nbsp;čitelné dokumentaci, ovšem
současně Swagger editor ohlásí několik chyb v&nbsp;našem schématu:</p>

<div class="rs-img-center" style="margin-left: auto; margin-right: auto; max-width: 720px"><a href="https://www.root.cz/obrazek/1245789/"><img src="https://i.iinfo.cz/images/408/pydantic-3-2-large.png" class="image-1245789" width="720" height="365" data-prev-filename="https://i.iinfo.cz/images/408/pydantic-3-2-prev.png" data-prev-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-2-prev.webp" data-prev-width="370" data-prev-height="188" data-large-filename="https://i.iinfo.cz/images/408/pydantic-3-2-large.png" data-large-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-2-large.webp" data-large-width="720" data-large-height="365" alt="Pydantic" data-description="Pydantic" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" style="width: 100%; height: auto; max-width: 720px" /></a><p>Obrázek 2: Chyby, které Swagger editor vypíše po importu schématu<br class="_remove" /></p><p class="author">Autor: tisnik, podle licence: <a href="http://en.wikipedia.org/wiki/Rights_Managed">Rights Managed</a><br class="_remove" /></p></div>




<p><a name="k09"></a></p>
<h2 id="k09">9. Změna atributu <strong>exclusiveMinimum</strong> na <strong>minimum</strong></h2>

<p>SwaggerEditor korektně ohlásil chybu v&nbsp;použití atributu
<strong>exclusiveMinimum</strong>. Ten má totiž odlišný význam, než
v&nbsp;jakém je použit &ndash; je to totiž pravdivostní hodnota, která určuje,
zda specifikované minimum určuje otevřený nebo uzavřený interval (tedy
&bdquo;kromě limitní hodnoty&ldquo; nebo &bdquo;včetně limitní hodnoty&ldquo;).
V&nbsp;OpenAPI 3.0.0 tedy potřebujeme zaměnit <i>jméno</i> atributu
<strong>exclusiveMinimum</strong> na <strong>minimum</strong>, a to (obecně)
rekurzivně pro všechny uzly v&nbsp;popisu schématu. Tuto operaci lze provést
ještě před exportem schématu do JSONu, a to následující funkcí:</p>

<pre>
def <strong>recursive_update</strong>(original: dict) -&gt; dict:
    new = {}
    for key, value in original.items():
        if isinstance(value, dict):
            new[key] = recursive_update(original[key])
        elif key == "exclusiveMinimum":
            new["minimum"] = value
        else:
            new[key] = value
    return new
</pre>

<p>Zdrojový kód s&nbsp;našim modelem i instrukcemi pro export jeho schématu
upravíme do následující podoby:</p>

<pre>
<i># Knihovna Pydantic</i>
<i>#</i>
<i># - model s konfigurací obsahující čtyři atributy</i>
<i># - jeden z atributů je tvořen dalším modelem</i>
<i># - kontrola obsahu atributů po inicializaci modelu</i>
<i># - zákaz inicializace modelu s neznámými atributy</i>
<i># - úprava schématu do podoby OpenAPI</i>
<i># - řešení atributu exclusiveMinimum</i>
<i># - export schématu modelu</i>
&nbsp;
import json
from typing_extensions import Optional, Self
&nbsp;
from pydantic import (
    BaseModel,
    ConfigDict,
    FilePath,
    PositiveInt,
    model_validator,
)
from pydantic.json_schema import models_json_schema
&nbsp;
&nbsp;
<i># PostgreSQL connection constants</i>
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLMODE</i>
POSTGRES_DEFAULT_SSL_MODE = "prefer"
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-GSSENCMODE</i>
POSTGRES_DEFAULT_GSS_ENCMODE = "prefer"
&nbsp;
&nbsp;
class <strong>ConfigurationBase</strong>(BaseModel):
    <i>"""Base class for all configuration models that rejects unknown fields."""</i>
&nbsp;
    model_config = ConfigDict(extra="forbid")
&nbsp;
&nbsp;
class <strong>DatabaseConfiguration</strong>(ConfigurationBase):
    <i>"""Database configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 5432
    db: str
    user: str
    password: str
    ssl_mode: str = POSTGRES_DEFAULT_SSL_MODE
    gss_encmode: str = POSTGRES_DEFAULT_GSS_ENCMODE
    ca_cert_path: Optional[FilePath] = None
&nbsp;
    @model_validator(mode="after")
    def <strong>check_postgres_configuration</strong>(self) -&gt; Self:
        <i>"""Check PostgreSQL configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>ServiceConfiguration</strong>(ConfigurationBase):
    <i>"""Service configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 8080
    auth_enabled: bool = False
    workers: PositiveInt = 1
    database: DatabaseConfiguration
&nbsp;
    @model_validator(mode="after")
    def <strong>check_service_configuration</strong>(self) -&gt; Self:
        <i>"""Check service configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>Configuration</strong>(ConfigurationBase):
    <i>"""Global configuration."""</i>
&nbsp;
    name: str
    service: ServiceConfiguration
&nbsp;
    def <strong>dump</strong>(self, filename: str = "configuration.json") -&gt; None:
        <i>"""Dump actual configuration into JSON file."""</i>
        with open(filename, "w", encoding="utf-8") as fout:
            fout.write(self.model_dump_json(indent=4))
&nbsp;
&nbsp;
def <strong>recursive_update</strong>(original: dict) -&gt; dict:
    new = {}
    for key, value in original.items():
        if isinstance(value, dict):
            new[key] = recursive_update(original[key])
        elif key == "exclusiveMinimum":
            new["minimum"] = value
        else:
            new[key] = value
    return new
&nbsp;
&nbsp;
with open("schema_13.json", "w") as fout:
    _, schemas = models_json_schema(
        [(model, "validation") for model in [Configuration]],
        ref_template="#/components/schemas/{model}",
    )
    schemas = recursive_update(schemas)
    openapi_schema = {
        "openapi": "3.0.0",
        "info": {
            "title": "Weyland-Yutani Information System",
            "version": "0.3.0",
        },
        "components": {
            "schemas": schemas.get('$defs'),
        },
        "paths": {},
    }
    json.dump(openapi_schema, fout)
</pre>

<p>Výsledkem bude JSON se schématem, které bude po exportu vypadat
následovně:</p>

<pre>
{"openapi": "3.0.0", "info": {"title": "Weyland-Yutani Information System",
"version": "0.3.0"}, "components": {"schemas": {"Configuration":
{"additionalProperties": false, "description": "Global configuration.",
"properties": {"name": {"title": "Name", "type": "string"}, "service": {"$ref":
"#/components/schemas/ServiceConfiguration"}}, "required": ["name", "service"],
"title": "Configuration", "type": "object"}, "DatabaseConfiguration":
{"additionalProperties": false, "description": "Database configuration.",
"properties": {"host": {"default": "localhost", "title": "Host", "type":
"string"}, "port": {"default": 5432, "minimum": 0, "title": "Port", "type":
"integer"}, "db": {"title": "Db", "type": "string"}, "user": {"title": "User",
"type": "string"}, "password": {"title": "Password", "type": "string"},
"ssl_mode": {"default": "prefer", "title": "Ssl Mode", "type": "string"},
"gss_encmode": {"default": "prefer", "title": "Gss Encmode", "type": "string"},
"ca_cert_path": {"anyOf": [{"format": "file-path", "type": "string"}, {"type":
"null"}], "default": null, "title": "Ca Cert Path"}}, "required": ["db",
"user", "password"], "title": "DatabaseConfiguration", "type": "object"},
"ServiceConfiguration": {"additionalProperties": false, "description": "Service
configuration.", "properties": {"host": {"default": "localhost", "title":
"Host", "type": "string"}, "port": {"default": 8080, "minimum": 0, "title":
"Port", "type": "integer"}, "auth_enabled": {"default": false, "title": "Auth
Enabled", "type": "boolean"}, "workers": {"default": 1, "minimum": 0, "title":
"Workers", "type": "integer"}, "database": {"$ref":
"#/components/schemas/DatabaseConfiguration"}}, "required": ["database"],
"title": "ServiceConfiguration", "type": "object"}}}, "paths": {}}
</pre>

<p>Po naformátování schématu nástrojem <strong>jq</strong> dostaneme tuto
čitelnou podobu:</p>

<pre>
{
  "openapi": "3.0.0",
  "info": {
    "title": "Weyland-Yutani Information System",
    "version": "0.3.0"
  },
  "components": {
    "schemas": {
      "Configuration": {
        "additionalProperties": false,
        "description": "Global configuration.",
        "properties": {
          "name": {
            "title": "Name",
            "type": "string"
          },
          "service": {
            "$ref": "#/components/schemas/ServiceConfiguration"
          }
        },
        "required": [
          "name",
          "service"
        ],
        "title": "Configuration",
        "type": "object"
      },
      "DatabaseConfiguration": {
        "additionalProperties": false,
        "description": "Database configuration.",
        "properties": {
          "host": {
            "default": "localhost",
            "title": "Host",
            "type": "string"
          },
          "port": {
            "default": 5432,
            "minimum": 0,
            "title": "Port",
            "type": "integer"
          },
          "db": {
            "title": "Db",
            "type": "string"
          },
          "user": {
            "title": "User",
            "type": "string"
          },
          "password": {
            "title": "Password",
            "type": "string"
          },
          "ssl_mode": {
            "default": "prefer",
            "title": "Ssl Mode",
            "type": "string"
          },
          "gss_encmode": {
            "default": "prefer",
            "title": "Gss Encmode",
            "type": "string"
          },
          "ca_cert_path": {
            "anyOf": [
              {
                "format": "file-path",
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "title": "Ca Cert Path"
          }
        },
        "required": [
          "db",
          "user",
          "password"
        ],
        "title": "DatabaseConfiguration",
        "type": "object"
      },
      "ServiceConfiguration": {
        "additionalProperties": false,
        "description": "Service configuration.",
        "properties": {
          "host": {
            "default": "localhost",
            "title": "Host",
            "type": "string"
          },
          "port": {
            "default": 8080,
            "minimum": 0,
            "title": "Port",
            "type": "integer"
          },
          "auth_enabled": {
            "default": false,
            "title": "Auth Enabled",
            "type": "boolean"
          },
          "workers": {
            "default": 1,
            "minimum": 0,
            "title": "Workers",
            "type": "integer"
          },
          "database": {
            "$ref": "#/components/schemas/DatabaseConfiguration"
          }
        },
        "required": [
          "database"
        ],
        "title": "ServiceConfiguration",
        "type": "object"
      }
    }
  },
  "paths": {}
}
</pre>



<p><a name="k10"></a></p>
<h2 id="k10">10. Druhý pokus o načtení schématu do SwaggerEditoru</h2>

<p>Upravené schéma opět načteme do SwaggerEditoru. Výsledkem bude prakticky
totožný Swagger, nyní ovšem s&nbsp;korektně nastavenými minimálními hodnotami
(pochopitelně jen tam, kde jsme minimum definovali například typem
<strong>PositiveInt</strong>):</p>

<div class="rs-img-center" style="margin-left: auto; margin-right: auto; max-width: 639px"><a href="https://www.root.cz/obrazek/1245792/"><img src="https://i.iinfo.cz/images/408/pydantic-3-3-large.png" class="image-1245792" width="639" height="525" data-prev-filename="https://i.iinfo.cz/images/408/pydantic-3-3-prev.png" data-prev-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-3-prev.webp" data-prev-width="328" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/408/pydantic-3-3-large.png" data-large-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-3-large.webp" data-large-width="639" data-large-height="525" alt="Pydantic" data-description="Pydantic" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" style="width: 100%; height: auto; max-width: 639px" /></a><p>Obrázek 3: Vygenerovaný popis schématu ve Swagger editoru<br class="_remove" /></p><p class="author">Autor: tisnik, podle licence: <a href="http://en.wikipedia.org/wiki/Rights_Managed">Rights Managed</a><br class="_remove" /></p></div>

<p>Ovšem schéma ještě stále není zcela korektní, na což nás SwaggerEditor upozorní:</p>

<div class="rs-img-center" style="margin-left: auto; margin-right: auto; max-width: 720px"><a href="https://www.root.cz/obrazek/1245795/"><img src="https://i.iinfo.cz/images/408/pydantic-3-4-large.png" class="image-1245795" width="720" height="178" data-prev-filename="https://i.iinfo.cz/images/408/pydantic-3-4-prev.png" data-prev-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-4-prev.webp" data-prev-width="370" data-prev-height="91" data-large-filename="https://i.iinfo.cz/images/408/pydantic-3-4-large.png" data-large-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-4-large.webp" data-large-width="720" data-large-height="178" alt="Pydantic" data-description="Pydantic" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" style="width: 100%; height: auto; max-width: 720px" /></a><p>Obrázek 4: Chyba, kterou Swagger editor vypíše po importu schématu<br class="_remove" /></p><p class="author">Autor: tisnik, podle licence: <a href="http://en.wikipedia.org/wiki/Rights_Managed">Rights Managed</a><br class="_remove" /></p></div>



<p><a name="k11"></a></p>
<h2 id="k11">11. Špinavý trik s&nbsp;opravou definice volitelných atributů</h2>

<p>Poslední chybou, kterou SwaggerEditor detekoval, byla špatná specifikace
volitelných atributů modelu, tj.&nbsp;takových atributů, které mají
v&nbsp;Pythonu typ <strong>Optional</strong> (to se převede na &bdquo;spojení
typů&ldquo; v&nbsp;uzlu <strong>anyOf</strong>). Úpravou transformační funkce
<strong>recursive_update</strong> (transformuje jeden popis modelu na jinak
strukturovaný popis) můžeme tento problém alespoň částečně obejít, když
volitelné atributy nahradíme za přímou definici jejich typu s&nbsp;nastavením
příznaku <strong>nullable</strong>. Výsledkem je korektní popis schématu
modelu, i když samotná transformační funkce by si zasloužila mnohem lepší (ale
i mnohem delší) implementaci:</p>

<pre>
def <strong>recursive_update</strong>(original: dict) -&gt; dict:
    new = {}
    for key, value in original.items():
        <i># rekurzivní průchod podslovníky</i>
        if isinstance(value, dict):
            new[key] = recursive_update(original[key])
        <i># řešení volitelných typů</i>
        elif key == "anyOf" and isinstance(value, list) and value[1]["type"] == "null":
            <i># jen první typ je konktrétní, ingorovat druhý</i>
            val = value[0]["type"]
            new["type"] = val
            <i># nový atribut</i>
            new["nullable"] = True
        <i># řešení atributu exclusiveMinimum</i>
        elif key == "exclusiveMinimum":
            new["minimum"] = value
        else:
            new[key] = value
    return new
</pre>

<p>Opravený zdrojový kód našeho příkladu:</p>

<pre>
<i># Knihovna Pydantic</i>
<i>#</i>
<i># - model s konfigurací obsahující čtyři atributy</i>
<i># - jeden z atributů je tvořen dalším modelem</i>
<i># - kontrola obsahu atributů po inicializaci modelu</i>
<i># - zákaz inicializace modelu s neznámými atributy</i>
<i># - úprava schématu do podoby OpenAPI</i>
<i># - řešení atributu exclusiveMinimum</i>
<i># - řešení volitelné hodnoty</i>
<i># - export schématu modelu</i>
&nbsp;
import json
from typing_extensions import Optional, Self
&nbsp;
from pydantic import (
    BaseModel,
    ConfigDict,
    FilePath,
    PositiveInt,
    model_validator,
)
from pydantic.json_schema import models_json_schema
&nbsp;
&nbsp;
<i># PostgreSQL connection constants</i>
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLMODE</i>
POSTGRES_DEFAULT_SSL_MODE = "prefer"
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-GSSENCMODE</i>
POSTGRES_DEFAULT_GSS_ENCMODE = "prefer"
&nbsp;
&nbsp;
class <strong>ConfigurationBase</strong>(BaseModel):
    <i>"""Base class for all configuration models that rejects unknown fields."""</i>
&nbsp;
    model_config = ConfigDict(extra="forbid")
&nbsp;
&nbsp;
class <strong>DatabaseConfiguration</strong>(ConfigurationBase):
    <i>"""Database configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 5432
    db: str
    user: str
    password: str
    ssl_mode: str = POSTGRES_DEFAULT_SSL_MODE
    gss_encmode: str = POSTGRES_DEFAULT_GSS_ENCMODE
    ca_cert_path: Optional[FilePath] = None
&nbsp;
    @model_validator(mode="after")
    def <strong>check_postgres_configuration</strong>(self) -&gt; Self:
        <i>"""Check PostgreSQL configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>ServiceConfiguration</strong>(ConfigurationBase):
    <i>"""Service configuration."""</i>
&nbsp;
    host: str = "localhost"
    port: PositiveInt = 8080
    auth_enabled: bool = False
    workers: PositiveInt = 1
    database: DatabaseConfiguration
&nbsp;
    @model_validator(mode="after")
    def <strong>check_service_configuration</strong>(self) -&gt; Self:
        <i>"""Check service configuration."""</i>
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>Configuration</strong>(ConfigurationBase):
    <i>"""Global configuration."""</i>
&nbsp;
    name: str
    service: ServiceConfiguration
&nbsp;
    def <strong>dump</strong>(self, filename: str = "configuration.json") -&gt; None:
        <i>"""Dump actual configuration into JSON file."""</i>
        with open(filename, "w", encoding="utf-8") as fout:
            fout.write(self.model_dump_json(indent=4))
&nbsp;
&nbsp;
def <strong>recursive_update</strong>(original: dict) -&gt; dict:
    new = {}
    for key, value in original.items():
        <i># rekurzivní průchod podslovníky</i>
        if isinstance(value, dict):
            new[key] = recursive_update(original[key])
        <i># řešení volitelných typů</i>
        elif key == "anyOf" and isinstance(value, list) and value[1]["type"] == "null":
            <i># jen první typ je konktrétní, ingorovat druhý</i>
            val = value[0]["type"]
            new["type"] = val
            <i># nový atribut</i>
            new["nullable"] = True
        <i># řešení atributu exclusiveMinimum</i>
        elif key == "exclusiveMinimum":
            new["minimum"] = value
        else:
            new[key] = value
    return new
&nbsp;
&nbsp;
with open("schema_14.json", "w") as fout:
    _, schemas = models_json_schema(
        [(model, "validation") for model in [Configuration]],
        ref_template="#/components/schemas/{model}",
    )
    schemas = recursive_update(schemas)
    openapi_schema = {
        "openapi": "3.0.0",
        "info": {
            "title": "Weyland-Yutani Information System",
            "version": "0.3.0",
        },
        "components": {
            "schemas": schemas.get('$defs'),
        },
        "paths": {},
    }
    json.dump(openapi_schema, fout)
</pre>

<p>Výsledkem bude kratší a současně i korektní schéma:</p>

<pre>
{"openapi": "3.0.0", "info": {"title": "Weyland-Yutani Information System",
"version": "0.3.0"}, "components": {"schemas": {"Configuration":
{"additionalProperties": false, "description": "Global configuration.",
"properties": {"name": {"title": "Name", "type": "string"}, "service": {"$ref":
"#/components/schemas/ServiceConfiguration"}}, "required": ["name", "service"],
"title": "Configuration", "type": "object"}, "DatabaseConfiguration":
{"additionalProperties": false, "description": "Database configuration.",
"properties": {"host": {"default": "localhost", "title": "Host", "type":
"string"}, "port": {"default": 5432, "minimum": 0, "title": "Port", "type":
"integer"}, "db": {"title": "Db", "type": "string"}, "user": {"title": "User",
"type": "string"}, "password": {"title": "Password", "type": "string"},
"ssl_mode": {"default": "prefer", "title": "Ssl Mode", "type": "string"},
"gss_encmode": {"default": "prefer", "title": "Gss Encmode", "type": "string"},
"ca_cert_path": {"type": "string", "nullable": true, "default": null, "title":
"Ca Cert Path"}}, "required": ["db", "user", "password"], "title":
"DatabaseConfiguration", "type": "object"}, "ServiceConfiguration":
{"additionalProperties": false, "description": "Service configuration.",
"properties": {"host": {"default": "localhost", "title": "Host", "type":
"string"}, "port": {"default": 8080, "minimum": 0, "title": "Port", "type":
"integer"}, "auth_enabled": {"default": false, "title": "Auth Enabled", "type":
"boolean"}, "workers": {"default": 1, "minimum": 0, "title": "Workers", "type":
"integer"}, "database": {"$ref":
"#/components/schemas/DatabaseConfiguration"}}, "required": ["database"],
"title": "ServiceConfiguration", "type": "object"}}}, "paths": {}}
</pre>

<p>Po naformátování do čitelné podoby:</p>

<pre>
{
  "openapi": "3.0.0",
  "info": {
    "title": "Weyland-Yutani Information System",
    "version": "0.3.0"
  },
  "components": {
    "schemas": {
      "Configuration": {
        "additionalProperties": false,
        "description": "Global configuration.",
        "properties": {
          "name": {
            "title": "Name",
            "type": "string"
          },
          "service": {
            "$ref": "#/components/schemas/ServiceConfiguration"
          }
        },
        "required": [
          "name",
          "service"
        ],
        "title": "Configuration",
        "type": "object"
      },
      "DatabaseConfiguration": {
        "additionalProperties": false,
        "description": "Database configuration.",
        "properties": {
          "host": {
            "default": "localhost",
            "title": "Host",
            "type": "string"
          },
          "port": {
            "default": 5432,
            "minimum": 0,
            "title": "Port",
            "type": "integer"
          },
          "db": {
            "title": "Db",
            "type": "string"
          },
          "user": {
            "title": "User",
            "type": "string"
          },
          "password": {
            "title": "Password",
            "type": "string"
          },
          "ssl_mode": {
            "default": "prefer",
            "title": "Ssl Mode",
            "type": "string"
          },
          "gss_encmode": {
            "default": "prefer",
            "title": "Gss Encmode",
            "type": "string"
          },
          "ca_cert_path": {
            "type": "string",
            "nullable": true,
            "default": null,
            "title": "Ca Cert Path"
          }
        },
        "required": [
          "db",
          "user",
          "password"
        ],
        "title": "DatabaseConfiguration",
        "type": "object"
      },
      "ServiceConfiguration": {
        "additionalProperties": false,
        "description": "Service configuration.",
        "properties": {
          "host": {
            "default": "localhost",
            "title": "Host",
            "type": "string"
          },
          "port": {
            "default": 8080,
            "minimum": 0,
            "title": "Port",
            "type": "integer"
          },
          "auth_enabled": {
            "default": false,
            "title": "Auth Enabled",
            "type": "boolean"
          },
          "workers": {
            "default": 1,
            "minimum": 0,
            "title": "Workers",
            "type": "integer"
          },
          "database": {
            "$ref": "#/components/schemas/DatabaseConfiguration"
          }
        },
        "required": [
          "database"
        ],
        "title": "ServiceConfiguration",
        "type": "object"
      }
    }
  },
  "paths": {}
}
</pre>



<p><a name="k12"></a></p>
<h2 id="k12">12. Třetí (úspěšný) pokus o načtení schématu do SwaggerEditoru</h2>

<p>Po načtení nového popisu schématu ve formátu JSON do SwaggerEditoru se již
nehlásí žádné chyby a vytvořený interaktivní Swagger (pravá strana) je taktéž
vygenerován zcela korektně.  Pochopitelně obsahuje pouze popis komponent, ovšem
nic dalšího stejně není zapotřebí:</p>

<div class="rs-img-center" style="margin-left: auto; margin-right: auto; max-width: 633px"><a href="https://www.root.cz/obrazek/1245798/"><img src="https://i.iinfo.cz/images/408/pydantic-3-5-large.png" class="image-1245798" width="633" height="525" data-prev-filename="https://i.iinfo.cz/images/408/pydantic-3-5-prev.png" data-prev-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-5-prev.webp" data-prev-width="326" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/408/pydantic-3-5-large.png" data-large-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-5-large.webp" data-large-width="633" data-large-height="525" alt="Pydantic" data-description="Pydantic" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" style="width: 100%; height: auto; max-width: 633px" /></a><p>Obrázek 5: Vygenerovaný popis schématu ve Swagger editoru<br class="_remove" /></p><p class="author">Autor: tisnik, podle licence: <a href="http://en.wikipedia.org/wiki/Rights_Managed">Rights Managed</a><br class="_remove" /></p></div>




<p><a name="k13"></a></p>
<h2 id="k13">13. Vygenerování dokumentace ve formátu Markdown</h2>

<p>V&nbsp;dalším kroku z&nbsp;popisu schématu ve formátu JSON vygenerujeme
čitelnou dokumentaci v&nbsp;Markdownu. Pro tento účel existuje několik více či
méně kompletních nástrojů. Jedním z&nbsp;nich je i <a
href="https://pypi.org/project/openapi-to-md/">openapi-to-md</a>, který lze
nainstalovat přes PIP, do virtuálního prostředí Pythonu atd.:</p>

<pre>
$ <strong>uv add openapi-to-md</strong>
&nbsp;
Using CPython 3.12.10 interpreter at: /usr/bin/python3.12
Creating virtual environment at: .venv
Resolved 7 packages in 259ms
Prepared 4 packages in 299ms
Installed 5 packages in 16ms
 + click==8.3.1
 + jinja2==3.1.6
 + markupsafe==3.0.3
 + openapi-to-md==0.1.0b2
 + pyyaml==6.0.3
</pre>

<p>Vlastní převod na Markdown proběhne takto:</p>

<pre>
$ <strong>openapi-to-markdown --input_file schema_14_formatted.json</strong>
&nbsp;
filter_paths ()
Converting /home/ptisnovs/xy/xxx/schema_14_formatted.json to output.md...
Conversion complete.
</pre>

<p>Výsledkem bude soubor ve formátu Markdown, který obsahuje sadu tabulek
s&nbsp;popisem komponent (což jsou části našeho modelu):</p>

<pre>
# Weyland-Yutani Information System
&nbsp;
&nbsp;
&nbsp;
## 🌍 Base URL
&nbsp;
&nbsp;
| URL | Description |
|-----|-------------|
&nbsp;
&nbsp;
# 🛠️ APIs
&nbsp;
---
&nbsp;
# 📋 Components
&nbsp;
&nbsp;
&nbsp;
## Configuration
&nbsp;
&nbsp;
Global configuration.
&nbsp;
&nbsp;
| Field | Type | Description |
|-------|------|-------------|
| name | string |  |
| service |  |  |
&nbsp;
&nbsp;
## DatabaseConfiguration
&nbsp;
&nbsp;
Database configuration.
&nbsp;
&nbsp;
| Field | Type | Description |
|-------|------|-------------|
| host | string |  |
| port | integer |  |
| db | string |  |
| user | string |  |
| password | string |  |
| ssl_mode | string |  |
| gss_encmode | string |  |
| ca_cert_path | string |  |
&nbsp;
&nbsp;
## ServiceConfiguration
&nbsp;
&nbsp;
Service configuration.
&nbsp;
&nbsp;
| Field | Type | Description |
|-------|------|-------------|
| host | string |  |
| port | integer |  |
| auth_enabled | boolean |  |
| workers | integer |  |
| database |  |  |
</pre>



<p><a name="k14"></a></p>
<h2 id="k14">14. Přidání popisků k&nbsp;jednotlivým atributům modelu</h2>

<p>Problémem vygenerované dokumentace jsou především chybějící popisy
jednotlivých atributů. Ty ovšem můžeme doplnit, a to tak, že každému atributu
přímo v&nbsp;definici modelu přiřadíme hodnotu typu <strong>Field</strong>. To
nám umožní, aby měl každý atribut svoje označení (může se lišit od jména ve
zdrojovém kódu) a taktéž popisek.</p>

<p>Pro atributy, které mají nastavenou výchozí hodnotu, je to snadné a
přímočaré. Řádek:</p>

<pre>
host: str = "localhost"
</pre>

<p>se nahradí za:</p>

<pre>
host: str = <strong>Field</strong>(
    "localhost",
    title="Hostname",
    description="Database server host or socket directory",
)
</pre>

<p>U atributů, které nemají nastavenou výchozí hodnotu, je nutné namísto
prvního parametru konstruktoru <strong>Field</strong> zapsat trojtečku (což je
zcela legální konstrukce v&nbsp;Pythonu). Opět si uvedeme příklad jednoho
atributu z&nbsp;našeho modelu:</p>

<pre>
password: str
</pre>

<p>Atribut <strong>password</strong> nemá žádnou výchozí hodnotu, takže jeho
popisek doplníme s&nbsp;využitím trojtečky:</p>

<pre>
password: str = Field(
    ...,
    title="Password",
    description="Password used to authenticate",
)
</pre>

<p><div class="rs-tip-major">Poznámka: podobným způsobem se doplní i popisky
všech ostatních atributů.</div></p>



<p><a name="k15"></a></p>
<h2 id="k15">15. Úplný zdrojový kód příkladu s&nbsp;popsaným modelem</h2>

<p>Zdrojový kód obsahující mj.&nbsp;i definici datového modelu, vypadá po všech
provedených úpravách následovně:</p>

<pre>
<i># Knihovna Pydantic</i>
<i>#</i>
<i># - model s konfigurací obsahující čtyři atributy</i>
<i># - jeden z atributů je tvořen dalším modelem</i>
<i># - kontrola obsahu atributů po inicializaci modelu</i>
<i># - zákaz inicializace modelu s neznámými atributy</i>
<i># - úprava schématu do podoby OpenAPI</i>
<i># - řešení atributu exclusiveMinimum</i>
<i># - řešení volitelné hodnoty</i>
<i># - export schématu modelu</i>
&nbsp;
import json
from typing_extensions import Optional, Self
&nbsp;
from pydantic import (
    BaseModel,
    Field,
    ConfigDict,
    FilePath,
    PositiveInt,
    model_validator,
)
from pydantic.json_schema import models_json_schema
&nbsp;
&nbsp;
<i># PostgreSQL connection constants</i>
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLMODE</i>
POSTGRES_DEFAULT_SSL_MODE = "prefer"
<i># See: https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-GSSENCMODE</i>
POSTGRES_DEFAULT_GSS_ENCMODE = "prefer"
&nbsp;
&nbsp;
class <strong>ConfigurationBase</strong>(BaseModel):
    <i>"""Base class for all configuration models that rejects unknown fields."""</i>
&nbsp;
    model_config = ConfigDict(extra="forbid")
&nbsp;
&nbsp;
class <strong>DatabaseConfiguration</strong>(ConfigurationBase):
    <i>"""Database configuration."""</i>
&nbsp;
    host: str = Field(
        "localhost",
        title="Hostname",
        description="Database server host or socket directory",
    )
&nbsp;
    port: PositiveInt = Field(
        5432,
        title="Port",
        description="Database server port",
    )
&nbsp;
    db: str = Field(
        ...,
        title="Database name",
        description="Database name to connect to",
    )
&nbsp;
    user: str = Field(
        ...,
        title="User name",
        description="Database user name used to authenticate",
    )
&nbsp;
    password: str = Field(
        ...,
        title="Password",
        description="Password used to authenticate",
    )
&nbsp;
    ssl_mode: str = Field(
        POSTGRES_DEFAULT_SSL_MODE,
        title="SSL mode",
        description="SSL mode",
    )
&nbsp;
    gss_encmode: str = Field(
        POSTGRES_DEFAULT_GSS_ENCMODE,
        title="GSS encmode",
        description="This option determines whether or with what priority a secure GSS "
        "TCP/IP connection will be negotiated with the server.",
    )
&nbsp;
    ca_cert_path: Optional[FilePath] = Field(
        None,
        title="CA certificate path",
        description="Path to CA certificate",
    )
&nbsp;
    @model_validator(mode="after")
    def <strong>check_postgres_configuration</strong>(self) -&gt; Self:
        """Check PostgreSQL configuration."""
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>ServiceConfiguration</strong>(ConfigurationBase):
    <i>"""Service configuration."""</i>
&nbsp;
    host: str = Field(
        "localhost",
        title="Host",
        description="Service hostname",
    )
&nbsp;
    port: PositiveInt = 8080
    port: PositiveInt = Field(
        8080,
        title="Port",
        description="Service port",
    )
&nbsp;
    auth_enabled: bool = Field(
        False,
        title="Authentication enabled",
        description="Enables authentication subsystem",
    )
&nbsp;
    workers: PositiveInt = Field(
        1,
        title="Number of workers",
        description="Number of workers to be started",
    )
&nbsp;
    database: DatabaseConfiguration = Field(
        ...,
        title="Database configuration",
        description="Database configuration",
    )
&nbsp;
    @model_validator(mode="after")
    def <strong>check_service_configuration</strong>(self) -&gt; Self:
        """Check service configuration."""
        if self.port &gt; 65535:
            raise ValueError("Port value should be less than 65536")
        return self
&nbsp;
&nbsp;
class <strong>Configuration</strong>(ConfigurationBase):
    <i>"""Global configuration."""</i>
&nbsp;
    name: str = Field(
        ...,
        title="Service name",
        description="Service name",
    )
&nbsp;
    service: ServiceConfiguration = Field(
        ...,
        title="Service configuration",
        description="Service configuration",
    )
&nbsp;
    def <strong>dump</strong>(self, filename: str = "configuration.json") -&gt; None:
        <i>"""Dump actual configuration into JSON file."""</i>
        with open(filename, "w", encoding="utf-8") as fout:
            fout.write(self.model_dump_json(indent=4))
&nbsp;
&nbsp;
def <strong>recursive_update</strong>(original: dict) -&gt; dict:
    new = {}
    for key, value in original.items():
        <i># rekurzivní průchod podslovníky</i>
        if isinstance(value, dict):
            new[key] = recursive_update(original[key])
        <i># řešení volitelných typů</i>
        elif key == "anyOf" and isinstance(value, list) and value[1]["type"] == "null":
            <i># jen první typ je konktrétní, ingorovat druhý</i>
            val = value[0]["type"]
            new["type"] = val
            <i># nový atribut</i>
            new["nullable"] = True
        <i># řešení atributu exclusiveMinimum</i>
        elif key == "exclusiveMinimum":
            new["minimum"] = value
        else:
            new[key] = value
    return new
&nbsp;
&nbsp;
with open("schema_15.json", "w") as fout:
    _, schemas = models_json_schema(
        [(model, "validation") for model in [Configuration]],
        ref_template="#/components/schemas/{model}",
    )
    schemas = recursive_update(schemas)
    openapi_schema = {
        "openapi": "3.0.0",
        "info": {
            "title": "Weyland-Yutani Information System",
            "version": "0.3.0",
        },
        "components": {
            "schemas": schemas.get("$defs"),
        },
        "paths": {},
    }
    json.dump(openapi_schema, fout)
</pre>

<p>Po spuštění tohoto modifikovaného příkladu získáme popis schématu, který
obsahuje i popisky jednotlivých atributů:</p>

<pre>
{"openapi": "3.0.0", "info": {"title": "Weyland-Yutani Information System",
"version": "0.3.0"}, "components": {"schemas": {"Configuration":
{"additionalProperties": false, "description": "Global configuration.",
"properties": {"name": {"description": "Service name", "title": "Service name",
"type": "string"}, "service": {"$ref":
"#/components/schemas/ServiceConfiguration", "description": "Service
configuration", "title": "Service configuration"}}, "required": ["name",
"service"], "title": "Configuration", "type": "object"},
"DatabaseConfiguration": {"additionalProperties": false, "description":
"Database configuration.", "properties": {"host": {"default": "localhost",
"description": "Database server host or socket directory", "title": "Hostname",
"type": "string"}, "port": {"default": 5432, "description": "Database server
port", "minimum": 0, "title": "Port", "type": "integer"}, "db": {"description":
"Database name to connect to", "title": "Database name", "type": "string"},
"user": {"description": "Database user name used to authenticate", "title":
"User name", "type": "string"}, "password": {"description": "Password used to
authenticate", "title": "Password", "type": "string"}, "ssl_mode": {"default":
"prefer", "description": "SSL mode", "title": "SSL mode", "type": "string"},
"gss_encmode": {"default": "prefer", "description": "This option determines
whether or with what priority a secure GSS TCP/IP connection will be negotiated
with the server.", "title": "GSS encmode", "type": "string"}, "ca_cert_path":
{"type": "string", "nullable": true, "default": null, "description": "Path to
CA certificate", "title": "CA certificate path"}}, "required": ["db", "user",
"password"], "title": "DatabaseConfiguration", "type": "object"},
"ServiceConfiguration": {"additionalProperties": false, "description": "Service
configuration.", "properties": {"host": {"default": "localhost", "description":
"Service hostname", "title": "Host", "type": "string"}, "port": {"default":
8080, "description": "Service port", "minimum": 0, "title": "Port", "type":
"integer"}, "auth_enabled": {"default": false, "description": "Enables
authentication subsystem", "title": "Authentication enabled", "type":
"boolean"}, "workers": {"default": 1, "description": "Number of workers to be
started", "minimum": 0, "title": "Number of workers", "type": "integer"},
"database": {"$ref": "#/components/schemas/DatabaseConfiguration",
"description": "Database configuration", "title": "Database configuration"}},
"required": ["database"], "title": "ServiceConfiguration", "type": "object"}}},
"paths": {}}
</pre>

<p>Po naformátování získáme poměrně dobře čitelné schéma, které je navíc zcela
korektní:</p>

<pre>
{
  "openapi": "3.0.0",
  "info": {
    "title": "Weyland-Yutani Information System",
    "version": "0.3.0"
  },
  "components": {
    "schemas": {
      "Configuration": {
        "additionalProperties": false,
        "description": "Global configuration.",
        "properties": {
          "name": {
            "description": "Service name",
            "title": "Service name",
            "type": "string"
          },
          "service": {
            "$ref": "#/components/schemas/ServiceConfiguration",
            "description": "Service configuration",
            "title": "Service configuration"
          }
        },
        "required": [
          "name",
          "service"
        ],
        "title": "Configuration",
        "type": "object"
      },
      "DatabaseConfiguration": {
        "additionalProperties": false,
        "description": "Database configuration.",
        "properties": {
          "host": {
            "default": "localhost",
            "description": "Database server host or socket directory",
            "title": "Hostname",
            "type": "string"
          },
          "port": {
            "default": 5432,
            "description": "Database server port",
            "minimum": 0,
            "title": "Port",
            "type": "integer"
          },
          "db": {
            "description": "Database name to connect to",
            "title": "Database name",
            "type": "string"
          },
          "user": {
            "description": "Database user name used to authenticate",
            "title": "User name",
            "type": "string"
          },
          "password": {
            "description": "Password used to authenticate",
            "title": "Password",
            "type": "string"
          },
          "ssl_mode": {
            "default": "prefer",
            "description": "SSL mode",
            "title": "SSL mode",
            "type": "string"
          },
          "gss_encmode": {
            "default": "prefer",
            "description": "This option determines whether or with what priority a secure GSS TCP/IP connection will be negotiated with the server.",
            "title": "GSS encmode",
            "type": "string"
          },
          "ca_cert_path": {
            "type": "string",
            "nullable": true,
            "default": null,
            "description": "Path to CA certificate",
            "title": "CA certificate path"
          }
        },
        "required": [
          "db",
          "user",
          "password"
        ],
        "title": "DatabaseConfiguration",
        "type": "object"
      },
      "ServiceConfiguration": {
        "additionalProperties": false,
        "description": "Service configuration.",
        "properties": {
          "host": {
            "default": "localhost",
            "description": "Service hostname",
            "title": "Host",
            "type": "string"
          },
          "port": {
            "default": 8080,
            "description": "Service port",
            "minimum": 0,
            "title": "Port",
            "type": "integer"
          },
          "auth_enabled": {
            "default": false,
            "description": "Enables authentication subsystem",
            "title": "Authentication enabled",
            "type": "boolean"
          },
          "workers": {
            "default": 1,
            "description": "Number of workers to be started",
            "minimum": 0,
            "title": "Number of workers",
            "type": "integer"
          },
          "database": {
            "$ref": "#/components/schemas/DatabaseConfiguration",
            "description": "Database configuration",
            "title": "Database configuration"
          }
        },
        "required": [
          "database"
        ],
        "title": "ServiceConfiguration",
        "type": "object"
      }
    }
  },
  "paths": {}
}
</pre>



<p><a name="k16"></a></p>
<h2 id="k16">16. Dokument se schématem, které má popsány všechny atributy</h2>

<p>Nyní po otevření <a href="#k15">výše ukázaného</a> schématu ve
SwaggerEditoru můžeme vidět, že všechny atributy u sebe mají zobrazeny korektní
popisky:</p>

<div class="rs-img-center" style="margin-left: auto; margin-right: auto; max-width: 633px"><a href="https://www.root.cz/obrazek/1245801/"><img src="https://i.iinfo.cz/images/408/pydantic-3-6-large.png" class="image-1245801" width="633" height="525" data-prev-filename="https://i.iinfo.cz/images/408/pydantic-3-6-prev.png" data-prev-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-6-prev.webp" data-prev-width="326" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/408/pydantic-3-6-large.png" data-large-filename-webp="https://i.iinfo.cz/images/408/pydantic-3-6-large.webp" data-large-width="633" data-large-height="525" alt="Pydantic" data-description="Pydantic" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" style="width: 100%; height: auto; max-width: 633px" /></a><p>Obrázek 6: Vygenerovaný popis schématu ve Swagger editoru<br class="_remove" /></p><p class="author">Autor: tisnik, podle licence: <a href="http://en.wikipedia.org/wiki/Rights_Managed">Rights Managed</a><br class="_remove" /></p></div>

<p>Podobně se &bdquo;doplnily&ldquo; sloupce <strong>Description</strong> po
převodu schématu ve formátu OpenAPI do formátu Markdown (viz obsahy všech
tabulek):</p>

<pre>
# Weyland-Yutani Information System
&nbsp;
&nbsp;
&nbsp;
## 🌍 Base URL
&nbsp;
&nbsp;
| URL | Description |
|-----|-------------|
&nbsp;
&nbsp;
# 🛠️ APIs
&nbsp;
---
&nbsp;
# 📋 Components
&nbsp;
&nbsp;
&nbsp;
## Configuration
&nbsp;
&nbsp;
Global configuration.
&nbsp;
&nbsp;
| Field | Type | Description |
|-------|------|-------------|
| name | string | Service name |
| service |  | Service configuration |
&nbsp;
&nbsp;
## DatabaseConfiguration
&nbsp;
&nbsp;
Database configuration.
&nbsp;
&nbsp;
| Field | Type | Description |
|-------|------|-------------|
| host | string | Database server host or socket directory |
| port | integer | Database server port |
| db | string | Database name to connect to |
| user | string | Database user name used to authenticate |
| password | string | Password used to authenticate |
| ssl_mode | string | SSL mode |
| gss_encmode | string | This option determines whether or with what priority a secure GSS TCP/IP connection will be negotiated with the server. |
| ca_cert_path | string | Path to CA certificate |
&nbsp;
&nbsp;
## ServiceConfiguration
&nbsp;
&nbsp;
Service configuration.
&nbsp;
&nbsp;
| Field | Type | Description |
|-------|------|-------------|
| host | string | Service hostname |
| port | integer | Service port |
| auth_enabled | boolean | Enables authentication subsystem |
| workers | integer | Number of workers to be started |
| database |  | Database configuration |
</pre>



<p><a name="k17"></a></p>
<h2 id="k17">17. Převod na HTML stránku či na jiný typ dokumentu</h2>

<p>Posledním krokem, který provedeme, je převod dokumentu s&nbsp;popisem modelu
z&nbsp;formátu Markdown do nějakého odlišného formátu vhodného pro přímé
zobrazení (na druhou stranu Markdown lze umístit na GitHub pages atd., což může
být plně dostačující). Pochopitelně je možné soubor ve formátu Markdown načíst
například do textového procesoru, ovšem to není nejvhodnější technologie pro
automatizaci generování dokumentace. Namísto toho použijeme populární Pandoc,
který je spustitelný z&nbsp;příkazové řádky a nevyžaduje manuální operace:</p>

<pre>
$ <strong>pandoc -s --metadata title="nějaký titulek nebo jen mezera" --from markdown --to html config.md -o config.html</strong>
</pre>

<p>Výsledkem takto provedené konverze je HTML stránka obsahující jak popis
modelu, tak i styly atd.:</p>

<div class="rs-img-center" style="width: 641px"><img src="https://i.iinfo.cz/images/408/pydantic-3-7.png" class="image-1245804" width="641" height="1016" alt="Pydantic" data-description="Pydantic" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /><p>Obrázek 6: Finální verze dokumentace<br class="_remove" /></p><p class="author">Autor: tisnik, podle licence: <a href="http://en.wikipedia.org/wiki/Rights_Managed">Rights Managed</a><br class="_remove" /></p></div>

<p><div class="rs-tip-major">Poznámka: vygenerovat je možné i
&bdquo;holou&ldquo; dokumentaci, tedy HTML stránku pouze s&nbsp;popisem
atributů. V&nbsp;případě, že vyžadujete tento výsledek, postačuje vynechat
přepínače <strong>-s</strong> a <strong>--metadata</strong>.</div></p>



<p><a name="k18"></a></p>
<h2 id="k18">18. Závěr</h2>

<p>Tvorba dokumentace je většinou dosti nezáživná činnost. Navíc má dokumentace
tendenci zastarávat a proto je vhodné se zaměřit na automatizaci pro její
generování (samozřejmě tam, kde je to vůbec možné). V&nbsp;případě modelů máme
práci usnadněnou, protože vstupem budou přímo zdrojové kódy, což znamená, že by
dokumentace neměla zastarávat, pokud bude automaticky z&nbsp;těchto kódů
generovaná. Samotná tvorba dokumentace o modelech vyžaduje několik kroků, ovšem
ty je možné plně automatizovat a provádět je například v&nbsp;rámci CI/CD
pipeline, bez nutnosti manuálních zásahů.</p>



<p><a name="k19"></a></p>
<h2 id="k19">19. Repositář s&nbsp;demonstračními příklady</h2>

<p>Demonstrační příklady vytvořené v&nbsp;Pythonu a popsané v&nbsp;dnešním
článku i v&nbsp;obou článcích předchozích najdete v&nbsp;repositáři <a
href="https://github.com/tisnik/most-popular-python-libs/">https://github.com/tisnik/most-popular-python-libs/</a>.
Následují odkazy na jednotlivé příklady:</p>

<table>
<tr><th> #</th><th>Příklad</th><th>Stručný popis</th><th>Adresa</th></tr>
<tr><td> 1</td><td>user_01.py</td><td>definice vlastního jednoduchého modelu</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_01.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_01.py</a></td></tr>
<tr><td> 2</td><td>user_02.py</td><td>inicializace objektu s&nbsp;explicitním nastavením všech jeho atributů</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_02.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_02.py</a></td></tr>
<tr><td> 3</td><td>user_03.py</td><td>typová kontrola atributů</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_03.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_03.py</a></td></tr>
<tr><td> 4</td><td>user_04.py</td><td>pokus o nastavení některých atributů na hodnotu <strong>None</strong></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_04.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_04.py</a></td></tr>
<tr><td> 5</td><td>user_05.py</td><td>atributy s&nbsp;typem umožňující i reprezentaci neexistující hodnoty</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_05.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_05.py</a></td></tr>
<tr><td> 6</td><td>user_06.py</td><td>ukázka použití specializovaného typu poskytovaného knihovnou <i>Pydantic</i></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_06.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_06.py</a></td></tr>
<tr><td> 7</td><td>user_07.py</td><td>explicitní kontrola zadané hodnoty atributu</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_07.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_07.py</a></td></tr>
<tr><td> 8</td><td>user_08.py</td><td>omezení délky řetězců zapisovaných do atributů</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_08.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_08.py</a></td></tr>
<tr><td> 9</td><td>user_09.py</td><td>přečtení celé datové struktury z&nbsp;JSONu</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_09.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_09.py</a></td></tr>
<tr><td>10</td><td>user_10.py</td><td>zápis modelu do formátu JSON</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_10.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/user_10.py</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>11</td><td>character_1.py</td><td>komplikovanější datová struktura obsahující další struktury</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/character_1.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/character_1.py</a></td></tr>
<tr><td>12</td><td>character_2.py</td><td>kontrola všech povinných atributů</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/character_2.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/character_2.py</a></td></tr>
<tr><td>13</td><td>character_3.py</td><td>výchozí hodnota strukturovaných atributů</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/character_3.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/character_3.py</a></td></tr>
<tr><td>14</td><td>character_4.py</td><td>nepovinné strukturované atributy</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/character_4.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/character_4.py</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>15</td><td>config_01.py</td><td>model představující konfiguraci aplikace: pouze její jméno</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_01.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_01.py</a></td></tr>
<tr><td>16</td><td>config_01.yaml</td><td>vstupní konfigurační soubor ve formátu YAML (vstup pro inicializaci modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_01.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_01.yaml</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>17</td><td>config_02.py</td><td>přidaná metoda pro uložení konfigurace do formátu JSON</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_02.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_02.py</a></td></tr>
<tr><td>18</td><td>config_02.yaml</td><td>vstupní konfigurační soubor ve formátu YAML (vstup pro inicializaci modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_02.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_02.yaml</a></td></tr>
<tr><td>19</td><td>config_02.json</td><td>vygenerovaný konfigurační soubor ve formátu JSON (export modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_02.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_02.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>20</td><td>config_03.py</td><td>načtení konfiguračního souboru s&nbsp;položkami, které nebudou načteny ani zpracovány</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_03.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_03.py</a></td></tr>
<tr><td>21</td><td>config_03.yaml</td><td>konfigurační soubor obsahující volby, které nebudou načteny</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_03.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_03.yaml</a></td></tr>
<tr><td>22</td><td>config_03.json</td><td>vygenerovaný konfigurační soubor ve formátu JSON (export modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_03.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_03.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>23</td><td>config_04.py</td><td>úprava modelu takovým způsobem, že nepovolí načtení nepodporovaných položek</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_04.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_04.py</a></td></tr>
<tr><td>24</td><td>config_04.yaml</td><td>konfigurační soubor obsahující volby, které nebudou načteny</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_04.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_04.yaml</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>25</td><td>config_05.py</td><td>konfigurace obsahující další model: konfiguraci služby</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_05.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_05.py</a></td></tr>
<tr><td>26</td><td>config_05.yaml</td><td>konfigurační soubor ve formátu YAML (vstup pro inicializaci modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_05.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_05.yaml</a></td></tr>
<tr><td>27</td><td>config_05.json</td><td>vygenerovaný konfigurační soubor ve formátu JSON (export modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_05.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_05.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>27</td><td>config_06.py</td><td>konfigurace obsahující ještě jeden model: konfiguraci databáze</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_06.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_06.py</a></td></tr>
<tr><td>28</td><td>config_06.yaml</td><td>konfigurační soubor ve formátu YAML (vstup pro inicializaci modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_06.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_06.yaml</a></td></tr>
<tr><td>29</td><td>config_06.json</td><td>vygenerovaný konfigurační soubor ve formátu JSON (export modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_06.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_06.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>30</td><td>config_07.py</td><td>nová vlastnost: vyplnění hodnot z&nbsp;proměnných prostředí</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_07.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_07.py</a></td></tr>
<tr><td>31</td><td>config_07.yaml</td><td>konfigurační soubor ve formátu YAML (vstup pro inicializaci modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_07.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_07.yaml</a></td></tr>
<tr><td>32</td><td>config_07.json</td><td>vygenerovaný konfigurační soubor ve formátu JSON (export modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_07.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_07.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>33</td><td>config_08.py</td><td>nová vlastnost: načtení hesla ze souboru</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_08.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_08.py</a></td></tr>
<tr><td>34</td><td>config_08.yaml</td><td>konfigurační soubor ve formátu YAML (vstup pro inicializaci modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_08.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_08.yaml</a></td></tr>
<tr><td>35</td><td>config_08.json</td><td>vygenerovaný konfigurační soubor ve formátu JSON (export modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_08.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_08.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>36</td><td>config_09.py</td><td>nová vlastnost: test, zda je řetězcová hodnota korektní</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_09.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_09.py</a></td></tr>
<tr><td>37</td><td>config_09.yaml</td><td>konfigurační soubor ve formátu YAML (vstup pro inicializaci modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_09.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_09.yaml</a></td></tr>
<tr><td>38</td><td>config_09.json</td><td>vygenerovaný konfigurační soubor ve formátu JSON (export modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_09.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_09.json</a></td></tr>
<tr><td>39</td><td>config_09_wrong.yaml</td><td>konfigurační soubor ve formátu YAML s&nbsp;nekorektním obsahem</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_09_wrong.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_09_wrong.yaml</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>40</td><td>config_10.py</td><td>definice modelu, který bude použitý i v&nbsp;dalších příkladech</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_10.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_10.py</a></td></tr>
<tr><td>41</td><td>config_10.yaml</td><td>konfigurační soubor ve formátu YAML (vstup pro inicializaci modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_10.yaml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_10.yaml</a></td></tr>
<tr><td>42</td><td>config_10.json</td><td>vygenerovaný konfigurační soubor ve formátu JSON (export modelu)</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_10.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_10.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>43</td><td>config_11.py</td><td>export schématu modelu do formátu JSON</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_11.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_11.py</a></td></tr>
<tr><td>44</td><td>schema_11.json</td><td>vyexportovaný popis schématu modelu před naformátováním</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_11.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_11.json</a></td></tr>
<tr><td>45</td><td>schema_11_formatted.json</td><td>vyexportovaný popis schématu modelu po naformátování</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_11_formatted.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_11_formatted.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>46</td><td>config_12.py</td><td>přidání metainformací, aby schéma odpovídalo specifikaci OpenAPI</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_12.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_12.py</a></td></tr>
<tr><td>47</td><td>schema_12.json</td><td>vyexportovaný popis schématu modelu před naformátováním</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_12.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_12.json</a></td></tr>
<tr><td>48</td><td>schema_12_formatted.json</td><td>vyexportovaný popis schématu modelu po naformátování</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_12_formatted.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_12_formatted.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>49</td><td>config_13.py</td><td>oprava jména atributu <strong>export</strong> na <strong>minimum</strong></td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_13.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_13.py</a></td></tr>
<tr><td>50</td><td>schema_13.json</td><td>vyexportovaný popis schématu modelu před naformátováním</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_13.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_13.json</a></td></tr>
<tr><td>51</td><td>schema_13_formatted.json</td><td>vyexportovaný popis schématu modelu po naformátování</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_13_formatted.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_13_formatted.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>52</td><td>config_14.py</td><td>trik s&nbsp;opravou definice volitelných atributů</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_14.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_14.py</a></td></tr>
<tr><td>53</td><td>schema_14.json</td><td>vyexportovaný popis schématu modelu před naformátováním</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_14.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_14.json</a></td></tr>
<tr><td>54</td><td>schema_14_formatted.json</td><td>vyexportovaný popis schématu modelu po naformátování</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_14_formatted.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_14_formatted.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>55</td><td>config_15.py</td><td>přidání popisků k&nbsp;jednotlivým atributům modelu</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_15.py">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/config_15.py</a></td></tr>
<tr><td>55</td><td>schema_15.json</td><td>vyexportovaný popis schématu modelu před naformátováním</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_15.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_15.json</a></td></tr>
<tr><td>56</td><td>schema_15_formatted.json</td><td>vyexportovaný popis schématu modelu po naformátování</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_15_formatted.json">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/schema_15_formatted.json</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>57</td><td>pyproject.toml</td><td>soubor s&nbsp;definicí projektu i s&nbsp;jeho závislostmi</td><td><a href="https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/pyproject.toml">https://github.com/tisnik/most-popular-python-libs/blob/master/pydantic/pyproject.toml</a></td></tr>
</table>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>Validace dat v&nbsp;Pythonu s&nbsp;využitím knihovny Pydantic<br />
<a href="https://www.root.cz/clanky/validace-dat-v-pythonu-s-vyuzitim-knihovny-pydantic/">https://www.root.cz/clanky/validace-dat-v-pythonu-s-vyuzitim-knihovny-pydantic/</a>
</li>

<li>Validace dat v&nbsp;Pythonu s&nbsp;využitím knihovny Pydantic (2. část)<br />
<a href="https://www.root.cz/clanky/validace-dat-v-pythonu-s-vyuzitim-knihovny-pydantic-2-cast/">https://www.root.cz/clanky/validace-dat-v-pythonu-s-vyuzitim-knihovny-pydantic-2-cast/</a>
</li>

<li>Pydantic: domácí stránka<br />
<a href="https://docs.pydantic.dev/latest/">https://docs.pydantic.dev/latest/</a>
</li>

<li>Pydantic na GitHubu<br />
<a href="https://github.com/pydantic/pydantic">https://github.com/pydantic/pydantic</a>
</li>

<li>Pydantic na PyPi<br />
<a href="https://pypi.org/project/pydantic/">https://pypi.org/project/pydantic/</a>
</li>

<li>Introduction to Python Pydantic Library<br />
<a href="https://www.geeksforgeeks.org/python/introduction-to-python-pydantic-library/">https://www.geeksforgeeks.org/python/introduction-to-python-pydantic-library/</a>
</li>

<li>An introduction to Pydantic (with basic example)<br />
<a href="https://www.slingacademy.com/article/an-introduction-to-pydantic-with-basic-example/">https://www.slingacademy.com/article/an-introduction-to-pydantic-with-basic-example/</a>
</li>

<li>Pydantic: Simplifying Data Validation in Python<br />
<a href="https://realpython.com/python-pydantic/">https://realpython.com/python-pydantic/</a>
</li>

<li>Pydantic: A Guide With Practical Examples<br />
<a href="https://www.datacamp.com/tutorial/pydantic">https://www.datacamp.com/tutorial/pydantic</a>
</li>

<li>Pydantic validators<br />
<a href="https://docs.pydantic.dev/latest/concepts/validators/">https://docs.pydantic.dev/latest/concepts/validators/</a>
</li>

<li>Statické typové kontroly zdrojových kódů Pythonu prováděné nástrojem Mypy<br />
<a href="https://www.root.cz/clanky/staticke-typove-kontroly-zdrojovych-kodu-pythonu-provadene-nastrojem-mypy/">https://www.root.cz/clanky/staticke-typove-kontroly-zdrojovych-kodu-pythonu-provadene-nastrojem-mypy/</a>
</li>

<li>Statické typové kontroly zdrojových kódů Pythonu prováděné nástrojem Mypy (2.část)<br />
<a href="https://www.root.cz/clanky/staticke-typove-kontroly-zdrojovych-kodu-pythonu-provadene-nastrojem-mypy-2-cast/">https://www.root.cz/clanky/staticke-typove-kontroly-zdrojovych-kodu-pythonu-provadene-nastrojem-mypy-2-cast/</a>
</li>

<li>Statické typové kontroly zdrojových kódů Pythonu prováděné nástrojem Mypy (3)<br />
<a href="https://www.root.cz/clanky/staticke-typove-kontroly-zdrojovych-kodu-pythonu-provadene-nastrojem-mypy-3/">https://www.root.cz/clanky/staticke-typove-kontroly-zdrojovych-kodu-pythonu-provadene-nastrojem-mypy-3/</a>
</li>

<li>Novinky v&nbsp;typovém systému přidané do Pythonu 3.12<br />
<a href="https://www.root.cz/clanky/novinky-v-typovem-systemu-pridane-do-pythonu-3-12/">https://www.root.cz/clanky/novinky-v-typovem-systemu-pridane-do-pythonu-3-12/</a>
</li>

<li>Mastering Pydantic - A Guide for Python Developers<br />
<a href="https://dev.to/devasservice/mastering-pydantic-a-guide-for-python-developers-3kan">https://dev.to/devasservice/mastering-pydantic-a-guide-for-python-developers-3kan</a>
</li>

<li>7 Best Python Libraries for Validating Data<br />
<a href="https://www.yeahhub.com/7-best-python-libraries-validating-data/">https://www.yeahhub.com/7-best-python-libraries-validating-data/</a>
</li>

<li>Universally unique identifier (Wikipedia)<br />
<a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">https://en.wikipedia.org/wiki/Universally_unique_identifier</a>
</li>

<li>UUID objects according to RFC 4122 (knihovna pro Python)<br />
<a href="https://docs.python.org/3.5/library/uuid.html#uuid.uuid4">https://docs.python.org/3.5/library/uuid.html#uuid.uuid4</a>
</li>

<li>Object identifier (Wikipedia)<br />
<a href="https://en.wikipedia.org/wiki/Object_identifier">https://en.wikipedia.org/wiki/Object_identifier</a>
</li>

<li>Digital object identifier (Wikipedia)<br />
<a href="https://en.wikipedia.org/wiki/Digital_object_identifier">https://en.wikipedia.org/wiki/Digital_object_identifier</a>
</li>

<li>voluptuous na (na PyPi)<br />
<a href="https://pypi.python.org/pypi/voluptuous">https://pypi.python.org/pypi/voluptuous</a>
</li>

<li>voluptuous (na GitHubu)<br />
<a href="https://github.com/alecthomas/voluptuous">https://github.com/alecthomas/voluptuous</a>
</li>

<li>pytest-voluptuous 1.0.2 (na PyPi)<br />
<a href="https://pypi.org/project/pytest-voluptuous/">https://pypi.org/project/pytest-voluptuous/</a>
</li>

<li>pytest-voluptuous (na GitHubu)<br />
<a href="https://github.com/F-Secure/pytest-voluptuous">https://github.com/F-Secure/pytest-voluptuous</a>
</li>

<li>schemagic 0.9.1 (na PyPi)<br />
<a href="https://pypi.python.org/pypi/schemagic/0.9.1">https://pypi.python.org/pypi/schemagic/0.9.1</a>
</li>

<li>Schemagic / Schemagic.web (na GitHubu)<br />
<a href="https://github.com/Mechrophile/schemagic">https://github.com/Mechrophile/schemagic</a>
</li>

<li>schema 0.6.7 (na PyPi)<br />
<a href="https://pypi.python.org/pypi/schema">https://pypi.python.org/pypi/schema</a>
</li>

<li>schema (na GitHubu)<br />
<a href="https://github.com/keleshev/schema">https://github.com/keleshev/schema</a>
</li>

<li>XML Schema validator and data conversion library for Python<br />
<a href="https://github.com/brunato/xmlschema">https://github.com/brunato/xmlschema</a>
</li>

<li>xmlschema 0.9.7<br />
<a href="https://pypi.python.org/pypi/xmlschema/0.9.7">https://pypi.python.org/pypi/xmlschema/0.9.7</a>
</li>

<li>jsonschema 2.6.0<br />
<a href="https://pypi.python.org/pypi/jsonschema">https://pypi.python.org/pypi/jsonschema</a>
</li>

<li>Tired of Pydantic? Try These 5 Game-Changing Python Libraries<br />
<a href="https://developer-service.blog/tired-of-pydantic-try-these-5-game-changing-python-libraries/">https://developer-service.blog/tired-of-pydantic-try-these-5-game-changing-python-libraries/</a>
</li>

<li>PostgreSQL: 32.1. Database Connection Control Functions<br />
<a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-GSSENCMODE">https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-GSSENCMODE</a>
</li>

<li>Python type hints: Literals<br />
<a href="https://typing.python.org/en/latest/spec/literal.html">https://typing.python.org/en/latest/spec/literal.html</a>
</li>

<li>YAML<br />
<a href="https://yaml.org/">https://yaml.org/</a>
</li>

<li>How to Update Nested Dictionaries in Python Without Overwriting Existing Keys<br />
<a href="https://www.pythontutorials.net/blog/updating-nested-dictionaries-when-data-has-existing-key/">https://www.pythontutorials.net/blog/updating-nested-dictionaries-when-data-has-existing-key/</a>
</li>

<li>Zpracování dat reprezentovaných ve formátu JSON nástrojem <strong>jq</strong><br />
<a href="https://www.root.cz/clanky/zpracovani-dat-reprezentovanych-ve-formatu-json-nastrojem-jq/">https://www.root.cz/clanky/zpracovani-dat-reprezentovanych-ve-formatu-json-nastrojem-jq/</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="https://github.com/tisnik/">Pavel Tišnovský</a> &nbsp; 2025</small></p>
</body>
</html>

