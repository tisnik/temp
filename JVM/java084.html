<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Pohled pod kapotu JVM - nástroje pro vytváøení a manipulaci s bajtkódem</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Pohled pod kapotu JVM - nástroje pro vytváøení a manipulaci s bajtkódem</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Od dne¹ní èásti seriálu o programovacím jazyce Java i o virtuálním stroji Javy se zaèneme vìnovat dal¹í problematice související s JVM. Postupnì si toti¾ popí¹eme zpùsob vyu¾ití nástrojù urèených pro vytváøení a/nebo manipulaci s bajtkódem zpracovávaným virtuálním strojem Javy. Dne¹ní demonstraèní pøíklad bude postaven na nástroji Javassist.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Nástroje pro vytváøení a manipulaci s&nbsp;bajtkódem JVM</a></p>
<p><a href="#k02">2. ASM</a></p>
<p><a href="#k03">3. BCEL: Byte Code Engineering Library</a></p>
<p><a href="#k04">4. Byteman</a></p>
<p><a href="#k05">5. Javassist</a></p>
<p><a href="#k06">6. Demonstraèní pøíklad &ndash; generování bajtkódu tøídy s&nbsp;vyu¾itím nástroje <strong>Javassist</strong></a></p>
<p><a href="#k07">7. Pøeklad a spu¹tìní demonstraèního pøíkladu i vygenerované tøídy</a></p>
<p><a href="#k08">8. Výsledná podoba bajtkódu vygenerované tøídy, porovnání s&nbsp;kompilovanou tøídou</a></p>
<p><a href="#k09">9. Repositáø se zdrojovými kódy demonstraèního pøíkladu i pomocných skriptù</a></p>
<p><a href="#k10">10. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Nástroje pro vytváøení a manipulaci s&nbsp;bajtkódem JVM</h2>

<p>Dal¹í pomìrnì zajímavou problematikou, kterou se <a
href="http://www.root.cz/serialy/programovaci-jazyk-java-a-jvm/">v&nbsp;seriálu
o programovacím jazyku Java i o virtuálním stroji Javy</a> budeme zabývat, bude
popis nástrojù a knihoven urèených pro manipulaci s&nbsp;bajtkódem JVM nebo
dokonce k&nbsp;vytváøení zcela nového bajtkódu, který nemá ¾ádný pøedobraz ve
zdrojových kódech Javy. Nástrojù pro vytváøení èi pro manipulaci
s&nbsp;bajkódem virtuálního jazyka Java existuje pomìrnì velké mno¾ství, co¾ je
pochopitelné, kdy¾ si uvìdomíme, ¾e JVM ji¾ dávno není platformou urèenou pouze
pro provozování aplikací psaných jen v&nbsp;programovacím jazyku Java, ale
najdeme mnoho dal¹ích jazykù i nástrojù, které JVM vyu¾ívají. To znamená, ¾e
soubory <strong>.class</strong>, které jsou zpracovávány v&nbsp;JVM, nevznikají
jen pøekladem zdrojových textù napsaných v&nbsp;Javì, proto¾e se mù¾e jednat o
bajtkód pøelo¾ený assemblerem typu <i>Jasmin</i> èi nìkterým generátorem kódu
popsaným v&nbsp;dal¹ím textu.</p>

<p>Samotné ètení, analýza a vytváøení bajtkódu, popø.&nbsp;jeho cílená
modifikace, mù¾e být provádìna z&nbsp;mnoha dùvodù, mezi nì¾ patøí
napøíklad:</p>

<ol>

<li>Zji¹tìní pokrytí kódu testy, co¾ vy¾aduje zásahy do kódu jednotlivých metod
(nástroje <i>Cobertura</i>, <i>EMMA</i> èi <i>JaCoCo</i>)</li>

<li>Transformace kódu v&nbsp;nìkterých nástrojích podporujících aspektovì
orientované programování</li>

<li>Implementace interpretru èi pøekladaèe bez toho, aby musel programátor
nutnì znát v¹echna úskalí binárního bajtkódu</li>

<li>Transformace API z&nbsp;dùvodu zvý¹ení bezpeènosti</li>

<li>Implementace testù vyu¾ívajících substituované API</li>

<li>Statická analýza a hledání potenciálních chyb nástrojem
<i>FindBugs</i></li>

</ol>

<p>V&nbsp;dal¹ích kapitolách si velmi struènì popí¹eme vlastnosti nìkterých
nástrojù urèených pro manipulaci s&nbsp;bajtkódem.</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. ASM</h2>

<p>Jedním z&nbsp;nejznámìj¹ích a souèasnì i nejpou¾ívanìj¹ích nástrojù
umo¾òujících relativnì snadnou manipulaci s&nbsp;bajtkódem je nástroj nazvaný
<i>ASM</i> (<a href="http://asm.ow2.org/">http://asm.ow2.org/</a> &ndash;
podívejte se na pìknì navr¾ené logo tohoto nástroje). Práce s&nbsp;<i>ASM</i>
je zalo¾ena na transformaci bajtkódu, která je provádìna postupnì naèítáním
bajtkódu vstupního a postupným generováním bajtkódu výstupního (pøi pøenosu
informací ze vstupního bajtkódu do bajtkódu výstupního se na tato data aplikuje
zvolená transformace èi modifikace). Tento pøístup má své pøednosti, ale i
zápory. Mezi pøednosti patøí fakt, ¾e není zapotøebí si udr¾ovat
v&nbsp;operaèní pamìti celou strukturu bajtkódu (a» ji¾ jedné tøídy èi celého
balíèku, ...), co¾ je pro nìkteré úèely více ne¾ dostaèující. Pøíkladem mù¾e
být vlo¾ení volání nìjaké logovací metody na zaèátek ka¾dé metody v¹ech tøíd
&ndash; zde skuteènì nepotøebujeme mít v&nbsp;operaèní pamìti k&nbsp;dispozici
celou tøídu èi dokonce celý balíèek.</p>

<p>&bdquo;Proudové zpracování&ldquo;, tj.&nbsp;manipulace s&nbsp;bajtkódem
pøímo v&nbsp;prùbìhu jeho naèítání a následného ukládání, je navíc velmi rychlé
mj.&nbsp;i z&nbsp;toho dùvodu, ¾e <i>ASM</i> nemusí slo¾itì budovat celou
hierarchii objektù zpùsobem, jakým to dìlají napøíklad dále popsané nástroje
<i>BCEL</i> èi <i>Javassist</i>. Pøi provádìní slo¾itìj¹ích manipulací
s&nbsp;bajtkódem v¹ak mù¾e být výhodnìj¹í mít k&nbsp;dispozici struktury celých
tøíd. Pøestavme si napøíklad nástroj, který kód tøíd globálnì zpracuje na
základì nìjaké anotace (èi obecnì nìjakých metadat) pøilo¾ených ke tøídì èi
k&nbsp;balíèku. I tento re¾im je mo¾né v&nbsp;novìj¹ích verzích nástroje
<i>ASM</i> vyu¾ít (<i>ASM</i> tedy ve skuteènosti doká¾e pracovat ve dvou
módech), i kdy¾ si myslím, ¾e &bdquo;proudový re¾im&ldquo; zmínìný
v&nbsp;pøedchozím odstavci je v&nbsp;API <i>ASM</i> navr¾en lep¹ím
a pøedev¹ím pøehlednìj¹ím zpùsobem.</p>



<p><a name="k03"></a></p>
<h2 id="k03">3. BCEL: Byte Code Engineering Library</h2>

<p>Jedním z&nbsp;historicky nejstar¹ích programù umo¾òujících manipulaci
s&nbsp;bajtkódem na vy¹¹í úrovni je nástroj (èi spí¹e pøesnìji øeèeno knihovna)
nazvaná <i>BCEL</i>, neboli <i>Byte Code Engineering Library)</i>. Tato
knihovna umo¾òuje nejprve naèíst celý bajtkód do operaèní pamìti a posléze
s&nbsp;tímto bajtkódem rùzným zpùsobem manipulovat. Vzhledem k&nbsp;tomu, ¾e se
bajtkód pøi naèítání pøevádí na vnitøní reprezentaci (rùzné typy rozhraní, tøíd
a výètových typù), je manipulace s&nbsp;bajtkódem pomocí knihovny <i>BCEL</i>
pomìrnì pomalá, co¾ se v¹ak vìt¹inou negativnì projeví a¾ pøi práci
s&nbsp;rozsáhlej¹ími projekty. Vìt¹í problém pro vývojáøe pøedstavuje ponìkud
nepøehledné aplikaèní programové rozhraní knihovny <i>BCEL</i> a s&nbsp;tím
související hor¹í dokumentace. I kdy¾ se tato knihovna pou¾ívá pomìrnì èasto,
je pro první seznámení se s&nbsp;mo¾nostmi manipulace s&nbsp;bajtkódem podle mì
výhodnìj¹í pou¾ít knihovnu <i>Javassist</i> popsanou <a
href="#k06">v&nbsp;¹esté kapitole</a>.</p>

<p>Rozdíl mezi knihovnou <i>BCEL</i> a knihovnou <i>ASM</i> (zde je my¹len
pøedev¹ím &bdquo;proudový re¾im&ldquo; zpracování bajtkódu) se v&nbsp;urèitém
pohledu podobá rozdílu mezi zpùsobem zpracování XML souborù &ndash; buï lze
pou¾ít <i>DOM (Document Object Model)</i> (analogie k&nbsp;<i>BCEL</i>) nebo
<i>SAX (Simple API for XML)</i> (analogie k&nbsp;<i>ASM</i> v&nbsp;proudovém
re¾imu). Knihovnu <i>ASM</i> je v¹ak takté¾ mo¾né vyu¾ívat v&nbsp;&bdquo;re¾imu
DOM&ldquo;, podobnì jako <i>BCEL</i>, i kdy¾ se API obou knihoven od sebe dosti
li¹í.</p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Byteman</h2>

<p>Tøetím nástrojem, o nìm¾ se dnes prozatím alespoò ve struènosti zmíníme, je
nástroj nesoucí název <i>Byteman</i>. I tento nástroj doká¾e manipulovat
s&nbsp;javovským bajtkódem, ov¹em jedná se vìt¹inou o manipulaci zalo¾enou na
textových souborech, do nich¾ se zapisují pravidla aplikovaná na jednotlivé
tøídy, rozhraní èi skupiny tøíd/rozhraní. Díky této podpoøe souborù
s&nbsp;pravidly je mo¾né mnoho po¾adovaných modifikací zapsat deklarativnì, bez
nutnosti vytváøet program v&nbsp;Javì, co¾ bylo nutné v&nbsp;pøípadì pou¾ití
nástrojù <i>ASM</i> èi <i>BCEL</i>. Zajímavý a pro mnoho aplikací i dùle¾itý je
fakt, ¾e se zmìny v&nbsp;bajtkódu mohou provádìt pøímo v&nbsp;bì¾ícím
virtuálním stroji Javy, tak¾e je napøíklad mo¾né zmìnit chování aplikace bez
nutnosti ji restartovat (popø.&nbsp;bez nutnosti napøíklad restartu aplikaèního
serveru). Na tuto vlastnost jsou sice vývojáøi zvyklí v&nbsp;pøípadì
skriptovacích jazykù, ov¹em v&nbsp;oblasti Javy se jedná o mo¾ná ponìkud
neobvyklé chování :-)</p>

<p>Nástrojem <i>Byteman</i> se budeme podrobnìji zabývat pozdìji, dnes si jen
pro zajímavost uka¾me, jak vypadá soubor s&nbsp;pravidly:</p>

<pre>
# rule skeleton
RULE &lt;rule name&gt;
CLASS &lt;class name&gt;
METHOD &lt;method name&gt;
BIND &lt;bindings&gt;
IF &lt;condition&gt;
DO &lt;actions&gt;
ENDRULE
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Javassist</h2>

<p>Ètvrtým nástrojem, s&nbsp;ním¾ se zaèneme do vìt¹ích podrobností seznamovat
v&nbsp;navazující èásti tohoto seriálu, je nástroj nesoucí název
<i>Javassist</i>. Tento nástroj mù¾eme pøirovnat k&nbsp;ji¾ zmínìné knihovnì
<i>BCEL</i>, proto¾e i <i>Javassist</i> nabízí vývojáøùm API urèené pro
vytváøení èi pro modifikaci bajtkódu jednotlivých tøíd èi rozhraní. Ve
skuteènosti je v¹ak API nabízené nástrojem <i>Javassist</i> podle mého názoru
mnohem jednodu¹¹í (èi mo¾ná lépe øeèeno pochopitelnìj¹í), ne¾ tomu je
v&nbsp;pøípadì <i>BCEL</i>, co¾ je mj.&nbsp;zaji¹tìno i tím, ¾e se jedná o
rozhraní, v&nbsp;nìm¾ je mo¾né vyu¾ít jak vysokoúrovòové konstrukce (vytvoøení
metody z&nbsp;øetìzce), tak i konstrukce nízkoúrovòové (postupné doplòování
jednotlivých &bdquo;strojových&ldquo; instrukcí JVM do tìl metod).
Vysokoúrovòové i nízkoúrovòové konstrukce je samozøejmì mo¾né navzájem
kombinovat, èeho¾ je mo¾né vyu¾ít napøíklad pøi programování interpretrù èi
pøekladaèù.</p>

<p>Pøíklad vytvoøení nové metody s&nbsp;vyu¾itím vysokoúrovòových
konstrukcí:</p>

<pre>
    private static void addAddMethod(CtClass cc) throws CannotCompileException {
        CtMethod add = CtMethod.make(
                "public static int add(int x, int y)" +
                "{" +
                "    return x+y;" +
                "}",  cc);
        cc.addMethod(add);
    }
</pre>

<p>Pøíklad práce na ni¾¹í úrovni, tj.&nbsp;na úrovni jednotlivých kódù instrukcí:</p>

<pre>
        MethodInfo minfo = method.getMethodInfo();
&nbsp;
        ConstPool constPool = minfo.getConstPool();
        Bytecode b = new Bytecode(constPool, 2, 0); // stacksize == 2
        b.addIconst(42);
        b.addReturn(CtClass.intType);
        CodeAttribute codeAttribute = b.toCodeAttribute();

</pre>



<p><a name="k06"></a></p>
<h2 id="k06">6. Demonstraèní pøíklad &ndash; generování bajtkódu tøídy s&nbsp;vyu¾itím nástroje <strong>Javassist</strong></h2>

<p>I bez podrobného popisu vlastností nástroje <i>Javassist</i> je mo¾né si
mo¾nosti tohoto nástroje vyzkou¹et na jednoduchém demonstraèním pøíkladu
nazvaného <strong>ClassGenerationTest1</strong>. Tento demonstraèní pøíklad po
svém spu¹tìní vytvoøí bytekód tøídy <strong>GeneratedClass</strong>, který bude
mj.&nbsp;obsahovat i statickou metodu <strong>main()</strong>, jen¾ na
standardní výstup vypí¹e obligátní text "Hello world!" s&nbsp;vyu¾itím metody
<strong>System.out.println()</strong>. V&nbsp;tomto demonstraèním pøíkladu jsou
ukázány ètyøi vlastnosti nástroje <i>Javassist</i> &ndash; zpùsob získání tøídy
z&nbsp;takzvaného poolu tøíd (<strong>ClassPool.makeClass()</strong>), pøidání
nové metody do tøídy (<strong>CtClass.addMethod()</strong>), deklarace tìla
metody pøímo pomocí øetìzce (<strong>CtMethod.make()</strong>, existují v¹ak i
dal¹í mo¾nosti) a koneènì ulo¾ení bajtkódu vygenerované tøídy na disk
(<strong>CtClass.writeFile()</strong>). Následuje výpis okomentovaného
zdrojového kódu tohoto demonstraèního pøíkladu:</p>

<pre>
import java.io.IOException;
&nbsp;
import javassist.CannotCompileException;
import javassist.ClassPool;
import javassist.CtClass;
import javassist.CtMethod;
import javassist.NotFoundException;
&nbsp;
&nbsp;
&nbsp;
<i>/**</i>
<i> * Test moznosti nastroje Javassist - vygenerovani jednoduche tridy.</i>
<i> *</i>
<i> * @author Pavel Tisnovsky</i>
<i> */</i>
public class <strong>ClassGenerationTest1</strong> {
&nbsp;
<i>    /**</i>
<i>     * Zdrojovy kod metody main(), ktery bude nasledne zkompilovan</i>
<i>     * do bajtkodu a zakomponovan do vytvorene tridy.</i>
<i>     */</i>
    private static final String <strong>MAIN_METHOD_SOURCE_TEXT</strong> =
        "public static void main(String[] args)" +
        "{" +
        "    System.out.println(\"Hello world! \");" +
        "}";
&nbsp;
<i>    /**</i>
<i>     * Vytvoreni metody main() z jejiho zdrojoveho kodu.</i>
<i>     * </i>
<i>     * @param generatedClass</i>
<i>     *            predstavuje vytvarenou tridu</i>
<i>     * @throws CannotCompileException</i>
<i>     *             vyhozena v pripade chyby ve zdrojovem kodu</i>
<i>     */</i>
    private static void <strong>addMainMethod</strong>(CtClass generatedClass) throws CannotCompileException {
        CtMethod methodMain = CtMethod.make(MAIN_METHOD_SOURCE_TEXT, generatedClass);
        generatedClass.addMethod(methodMain);
    }
&nbsp;
<i>    /**</i>
<i>     * Vytvoreni tridy s metodou main().</i>
<i>     * </i>
<i>     * @throws CannotCompileException</i>
<i>     *             vyhozena v pripade chyby ve zdrojovem kodu metody main()</i>
<i>     * @throws IOException</i>
<i>     *             pokud dojde k chybe pri zapisu bajtkodu na disk</i>
<i>     * @throws NotFoundException</i>
<i>     *             pokud dojde k chybe pri zapisu bajtkodu na disk</i>
<i>     */</i>
    private static void <strong>generateClass</strong>() throws CannotCompileException, NotFoundException, IOException {
<i>        // ziskat vychozi class pool</i>
        ClassPool pool = ClassPool.getDefault();
&nbsp;
<i>        // vytvoreni nove verejne tridy</i>
        CtClass cc = pool.makeClass("GeneratedClass");
<i>        // pridani metody do teto tridy</i>
        addMainMethod(cc);
&nbsp;
<i>        // ulozeni bajtkodu na disk</i>
        cc.writeFile();
    }
&nbsp;
<i>    /**</i>
<i>     * Spusteni generatoru tridy.</i>
<i>     *</i>
<i>     * @param args nevyuzito</i>
<i>     */</i>
    public static void <strong>main</strong>(String[] args) {
        System.out.println("class generation begin");
        try {
            generateClass();
        }
        catch (CannotCompileException e) {
            e.printStackTrace();
        }
        catch (NotFoundException e) {
            e.printStackTrace();
        }
        catch (IOException e) {
            e.printStackTrace();
        }
        System.out.println("class generation end");
    }
&nbsp;
}
</pre>



<p><a name="k07"></a></p>
<h2 id="k07">7. Pøeklad a spu¹tìní demonstraèního pøíkladu i vygenerované tøídy</h2>

<p>Demonstraèní pøíklad <strong>ClassGenerationTest1</strong> se pøelo¾í
následujícím zpùsobem:</p>

<pre>
javac -cp javassist.jar ClassGenerationTest1.java
</pre>

<p>Pov¹imnìte si, ¾e je nutné zadat cestu k&nbsp;Java archivu
<strong>javassist.jar</strong> obsahujícího v¹echny tøídy a rozhraní nástroje
<i>Javassist</i>. Tento archiv lze získat buï pøekladem nebo pøímo ze stránek
tohoto projektu: <a
href="http://www.jboss.org/javassist/">http://www.jboss.org/javassist/</a>.</p>

<p>O spu¹tìní pøelo¾eného demonstraèního pøíkladu se postará pøíkaz:</p>

<pre>
java -cp .:javassist.jar ClassGenerationTest1
</pre>

<p>(opìt je zde nutné zadat cestu k&nbsp;Java archivu
<strong>javassist.jar</strong>, ale i cestu do aktuálního adresáøe).</p>

<p>Po spu¹tìní by se mìl v&nbsp;aktuálním adresáøi objevit nový soubor nazvaný
<strong>GeneratedClass.class</strong> obsahující bajtkód nové tøídy. Tuto
tøídu, resp.&nbsp;pøesnìji øeèeno její statickou metodu <strong>main</strong>
lze samozøejmì spustit, a to zcela stejným zpùsobem jako bajtkód tøídy vzniklý
pøímo pøekladaèem Javy:</p>

<pre>
java GeneratedClass
Hello world!
</pre>



<p><a name="k08"></a></p>
<h2 id="k08">8. Výsledná podoba bajtkódu vygenerované tøídy, porovnání s&nbsp;kompilovanou tøídou</h2>

<p>Podívejme se nyní na interní strukturu bajtkódu vytvoøeného pomocí na¹eho
demonstraèního pøíkladu <strong>ClassGenerationTest1</strong>. Pro dekompilaci
bajtkódu do èitelné podoby je mo¾né pou¾ít standardní nástroj
<strong>javap</strong>:</p>

<pre>
javap -c -private GeneratedClass &gt; GeneratedClass.asm
</pre>

<p>Výsledkem by mìl být následující text (indexy konstant v&nbsp;<i>constant
poolu</i> se v¹ak mohou li¹it):</p>

<pre>
Compiled from "GeneratedClass.java"
public class GeneratedClass extends java.lang.Object{
public static void main(java.lang.String[]);
  Code:
   0:   getstatic       #14; // Field java/lang/System.out:Ljava/io/PrintStream;
   3:   ldc             #16; // String Hello world! 
   5:   invokevirtual   #22; // Method java/io/PrintStream.println:(Ljava/lang/String;)V
   8:   return
&nbsp;
public GeneratedClass();
  Code:
   0:   aload_0
   1:   invokespecial   #27; // Method java/lang/Object."&lt;init&gt;":()V
   4:   return
&nbsp;
}
</pre>

<p>Z&nbsp;výpisu je patrné, ¾e nástroj <i>Javassist</i> skuteènì vytvoøil tøídu
obsahující statickou metodu <strong>main()</strong>, v&nbsp;ní¾ se vypisuje
text "Hello world!" na standardní výstup. Kromì toho byl vytvoøen i implicitní
bezparametrický konstruktor volající (takté¾ bezparametrický) konstruktor
pøedka.</p>

<p>Pro porovnání si uka¾me, jak vypadá bajtkód tøídy <strong>Hello</strong>
pøelo¾ené standardním pøekladaèem <strong>javac</strong>. Zdrojový kód této
tøídy je jednoduchý:</p>

<pre>
public class <strong>Hello</strong> {
    public static void <strong>main</strong>(String[] args) {
        System.out.println("Hello world!");
    }
}
</pre>

<p>Po pøekladu pomocí <strong>javac Hello.java</strong> a zpìtném pøekladu
s&nbsp;vyu¾itím <strong>javap -c Hello</strong> dostaneme následující
výstup:</p>

<pre>
Compiled from "Hello.java"
public class Hello extends java.lang.Object{
public Hello();
  Code:
   0:   aload_0
   1:   invokespecial   #1; // Method java/lang/Object."&lt;init&gt;":()V
   4:   return
&nbsp;
public static void main(java.lang.String[]);
  Code:
   0:   getstatic       #2; // Field java/lang/System.out:Ljava/io/PrintStream;
   3:   ldc             #3; // String Hello world!
   5:   invokevirtual   #4; // Method java/io/PrintStream.println:(Ljava/lang/String;)V
   8:   return
&nbsp;
}
</pre>

<p>Pøi porovnání obou &bdquo;disassemblovaných&ldquo; bajtkódù zjistíme, ¾e se
jedná o prakticky toto¾né programy, které se li¹í pouze jinou posloupností
deklarace jednotlivých metod (konstruktoru a metody <strong>main</strong>) a
takté¾ odli¹nou posloupností záznamù ulo¾ených v&nbsp;constant poolu &ndash; to
jsou v¹ak jen malé zmìny, které nemají ¾ádný vliv na bìh aplikací. Pro úplnost
si je¹tì uka¾me rozdíly mezi obìma bajtkódy v&nbsp;pøípadì, ¾e se ruènì prohodí
deklarace konstruktoru a metody <strong>main</strong>:</p>

<a href="http://i.iinfo.cz/images/675/diff.png"><img src="http://i.iinfo.cz/images/675/diff-prev.png" class="image-136683" width="370" height="119" alt="&#160;" /></a>



<p><a name="k09"></a></p>
<h2 id="k09">9. Repositáø se zdrojovými kódy demonstraèního pøíkladu i pomocných skriptù</h2>

<p>Zdrojové kódy dnes popsaného demonstraèního pøíkladu
<strong>ClassGenerationTest1</strong> a v¹ech pomocných skriptù jsou, jak se
ji¾ v&nbsp;tomto seriálu stalo zvykem, ulo¾eny do Mercurial repositáøe
dostupného na adrese <a
href="http://icedtea.classpath.org/people/ptisnovs/jvm-tools/">http://icedtea.classpath.org/people/ptisnovs/jvm-tools/</a>.
V&nbsp;následující tabulce najdete odkazy na prozatím nejnovìj¹í verze tìchto
zdrojových kódù:</p>

<table>
<tr><th>#</th><th>Zdrojový soubor/skript</th><th>Umístìní souboru v&nbsp;repositáøi</th></tr>
<tr><td>1</td><td>ClassGenerationTest1.java</td><td><a href="http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/ClassGenerationTest1.java">http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/ClassGenerationTest1.java</a></td></tr>
<tr><td>2</td><td>buildClassGenerator.sh</td><td><a href="http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/buildClassGenerator.sh">http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/buildClassGenerator.sh</a></td></tr>
<tr><td>3</td><td>runClassGenerator.sh</td><td><a href="http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/runClassGenerator.sh">http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/runClassGenerator.sh</a></td></tr>
<tr><td>4</td><td>runGeneratedClass.sh</td><td><a href="http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/runGeneratedClass.sh">http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/runGeneratedClass.sh</a></td></tr>
<tr><td>5</td><td>disassembleGeneratedClass.sh</td><td><a href="http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/disassembleGeneratedClass.sh">http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/disassembleGeneratedClass.sh</a></td></tr>
<tr><td>6</td><td>Hello.java</td><td><a href="http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/Hello.java">http://icedtea.classpath.org/people/ptisnovs/jvm-tools/file/008931c9e149/javassist/ClassGenerationTest1/Hello.java</a></td></tr>
</table>



<p><a name="k10"></a></p>
<h2 id="k10">10. Odkazy na Internetu</h2>

<ol>

<li>Open Source ByteCode Libraries in Java<br />
<a href="http://java-source.net/open-source/bytecode-libraries">http://java-source.net/open-source/bytecode-libraries</a>
</li>

<li>ASM Home page<br />
<a href="http://asm.ow2.org/">http://asm.ow2.org/</a>
</li>

<li>Seznam nástrojù vyu¾ívajících projekt ASM<br />
<a href="http://asm.ow2.org/users.html">http://asm.ow2.org/users.html</a>
</li>

<li>ObjectWeb ASM (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/ObjectWeb_ASM">http://en.wikipedia.org/wiki/ObjectWeb_ASM</a>
</li>

<li>Java Bytecode BCEL vs ASM<br />
<a href="http://james.onegoodcookie.com/2005/10/26/java-bytecode-bcel-vs-asm/">http://james.onegoodcookie.com/2005/10/26/java-bytecode-bcel-vs-asm/</a>
</li>

<li>BCEL Home page<br />
<a href="http://commons.apache.org/bcel/">http://commons.apache.org/bcel/</a>
</li>

<li>Byte Code Engineering Library (pøed verzí 5.0)<br />
<a href="http://bcel.sourceforge.net/">http://bcel.sourceforge.net/</a>
</li>

<li>Byte Code Engineering Library (verze &gt;= 5.0)<br />
<a href="http://commons.apache.org/proper/commons-bcel/">http://commons.apache.org/proper/commons-bcel/</a>
</li>

<li>BCEL Manual<br />
<a href="http://commons.apache.org/bcel/manual.html">http://commons.apache.org/bcel/manual.html</a>
</li>

<li>Byte Code Engineering Library (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/BCEL">http://en.wikipedia.org/wiki/BCEL</a>
</li>

<li>BCEL Tutorial<br />
<a href="http://www.smfsupport.com/support/java/bcel-tutorial!/">http://www.smfsupport.com/support/java/bcel-tutorial!/</a>
</li>

<li>Bytecode Engineering<br />
<a href="http://book.chinaunix.net/special/ebook/Core_Java2_Volume2AF/0131118269/ch13lev1sec6.html">http://book.chinaunix.net/special/ebook/Core_Java2_Volume2AF/0131118269/ch13lev1sec6.html</a>
</li>

<li>Bytecode Outline plugin for Eclipse (screenshoty + info)<br />
<a href="http://asm.ow2.org/eclipse/index.html">http://asm.ow2.org/eclipse/index.html</a>
</li>

<li>Javassist<br />
<a href="http://www.jboss.org/javassist/">http://www.jboss.org/javassist/</a>
</li>

<li>Byteman<br />
<a href="http://www.jboss.org/byteman">http://www.jboss.org/byteman</a>
</li>

<li>Java programming dynamics, Part 7: Bytecode engineering with BCEL<br />
<a href="http://www.ibm.com/developerworks/java/library/j-dyn0414/">http://www.ibm.com/developerworks/java/library/j-dyn0414/</a>
</li>

<li>The Java<sup>TM</sup> Virtual Machine Specification, Second Edition<br />
<a href="http://java.sun.com/docs/books/jvms/second_edition/html/VMSpecTOC.doc.html">http://java.sun.com/docs/books/jvms/second_edition/html/VMSpecTOC.doc.html</a>
</li>

<li>The class File Format<br />
<a href="http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html">http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html</a>
</li>

<li>javap - The Java Class File Disassembler<br />
<a href="http://docs.oracle.com/javase/1.4.2/docs/tooldocs/windows/javap.html">http://docs.oracle.com/javase/1.4.2/docs/tooldocs/windows/javap.html</a>
</li>

<li>javap-java-1.6.0-openjdk(1) - Linux man page<br />
<a href="http://linux.die.net/man/1/javap-java-1.6.0-openjdk">http://linux.die.net/man/1/javap-java-1.6.0-openjdk</a>
</li>

<li>Using javap<br />
<a href="http://www.idevelopment.info/data/Programming/java/miscellaneous_java/Using_javap.html">http://www.idevelopment.info/data/Programming/java/miscellaneous_java/Using_javap.html</a>
</li>

<li>Examine class files with the javap command<br />
<a href="http://www.techrepublic.com/article/examine-class-files-with-the-javap-command/5815354">http://www.techrepublic.com/article/examine-class-files-with-the-javap-command/5815354</a>
</li>

<li>aspectj (Eclipse)<br />
<a href="http://www.eclipse.org/aspectj/">http://www.eclipse.org/aspectj/</a>
</li>

<li>Aspect-oriented programming (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Aspect_oriented_programming">http://en.wikipedia.org/wiki/Aspect_oriented_programming</a>
</li>

<li>AspectJ (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/AspectJ">http://en.wikipedia.org/wiki/AspectJ</a>
</li>

<li>EMMA: a free Java code coverage tool<br />
<a href="http://emma.sourceforge.net/">http://emma.sourceforge.net/</a>
</li>

<li>Cobertura<br />
<a href="http://cobertura.sourceforge.net/">http://cobertura.sourceforge.net/</a>
</li>

<li>jclasslib bytecode viewer<br />
<a href="http://www.ej-technologies.com/products/jclasslib/overview.html">http://www.ej-technologies.com/products/jclasslib/overview.html</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2013</small></p>
</body>
</html>

