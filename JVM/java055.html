<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Pohled pod kapotu JVM - sledování èinnosti virtuálního stroje Javy pøes rozhraní JVM TI (3.èást)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Pohled pod kapotu JVM - sledování èinnosti virtuálního stroje Javy pøes rozhraní JVM TI (3.èást)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dne¹ní èásti seriálu o programovacím jazyce Java i o virtuálním stroji Javy se ji¾ potøetí budeme zabývat popisem rozhraní JVM TI, které je mo¾né vyu¾ít pro tvorbu takzvaných agentù monitorujících popø. ovlivòujících chování aplikace v JVM. Pøíklady uvedené v dne¹ní èásti budou velmi jednoduché, proto¾e si uká¾eme pou¾ití funkcí pro ètení a zmìnu obsahu systémových promìnných.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Systémové promìnné dostupné agentùm: funkce <strong>GetSystemProperty()</strong></a></p>
<p><a href="#k02">2. Pøíklad pou¾ití funkce <strong>GetSystemProperty()</strong></a></p>
<p><a href="#k03">3. Sedmý demonstraèní pøíklad: agent, který pøeète hodnoty vybraných systémových promìnných</a></p>
<p><a href="#k04">4. Zmìna hodnot systémových promìnných: funkce <strong>SetSystemProperty()</strong></a></p>
<p><a href="#k05">5. Osmý demonstraèní pøíklad: zmìna nastavení <strong>CLASSPATH</strong> v&nbsp;dobì spu¹tìní agenta</a></p>
<p><a href="#k06">6. Devátý demonstraèní pøíklad: pokus o zmìnu nemodifikovatelné promìnné</a></p>
<p><a href="#k07">7. Funkce <strong>GetSystemProperties()</strong> urèená pro ètení názvù v¹ech systémových promìnných</a></p>
<p><a href="#k08">8. Desátý demonstraèní pøíklad: výpis v¹ech systémových promìnných nastavených virtuálním strojem</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Systémové promìnné dostupné agentùm: funkce <strong>GetSystemProperty()</strong></h2>

<p>V&nbsp;pøedchozích dvou èástech <a
href="http://www.root.cz/serialy/programovaci-jazyk-java-a-jvm/">tohoto
seriálu</a> jsme si popsali zpùsob vyu¾ití rozhraní <i>JVM TI (JVM Tool
Interface)</i>, které se vyu¾ívá k&nbsp;rùzným èinnostem, zejména pro sledování
a takté¾ pro ovlivòování èinnosti bìhu virtuálního stroje Javy. Minule jste si
takté¾ ukázali zpùsob registrace callback funkcí v&nbsp;JVM TI agentech. Tyto
funkce, pokud jsou ov¹em korektnì zaregistrovány a je provedena nále¾itá
konfigurace agenta, jsou zavolány napøíklad pøi zahájení èi ukonèení bìhu
správce pamìti (<i>GC &ndash; garbage collector</i>), ve chvíli, kdy je
zavolána nìjaká javovská metoda, popø.&nbsp;pøi vzniku zachycené èi nezachycené
výjimky (typù callback funkcí v¹ak existuje mnohem více, nìkteré typy si
popí¹eme pøí¹tì). Dne¹ní èást seriálu o JVM bude ponìkud jednodu¹¹í, proto¾e si
&bdquo;pouze&ldquo; uká¾eme, jakým zpùsobem mù¾e agent èíst popø.&nbsp;mìnit
hodnotu nìkterých systémových promìnných (<i>system properties</i>), které jsou
vyu¾ívané virtuálním strojem Javy a v&nbsp;nìkterých pøípadech i samotnou
javovskou aplikací &ndash; pøíkladem je aplikace naèítající nìjakou promìnnou
pøes metodu <strong>System.getProperty()</strong>,
popø.&nbsp;<strong>System.getProperties()</strong>.</p>

<p>JVM TI agent mù¾e naèíst hodnotu libovolné systémové promìnné
s&nbsp;vyu¾itím funkce nazvané jednodu¹e <strong>GetSystemProperty()</strong>,
její¾ hlavièka je následující:</p>

<pre>
jvmtiError GetSystemProperty(
        jvmtiEnv* env,
        const char* property,
        char** value_ptr)
</pre>

<p>Jak je z&nbsp;této hlavièky patrné, pøedávají se funkci
<strong>GetSystemProperty()</strong> tøi parametry. První parametr je nám ji¾
dobøe známý &ndash; jedná se o ukazatel na strukturu obsahující stav
&bdquo;prostøedí&ldquo; agenta. Tato struktura je pøedávána do vìt¹iny callback
funkcí a v&nbsp;na¹em pøípadì je dùle¾ité to, ¾e ji mù¾eme získat ve funkci
<strong>Agent_OnLoad()</strong> po zavolání <strong>GetEnv()</strong>. Druhým
parametrem je název systémové promìnné (konstantní øetìzec) a tøetím parametrem
je ukazatel na céèkový øetìzec, který je automaticky alokovaný a naplnìný pøímo
funkcí <strong>GetSystemProperty()</strong> hodnotou zvolené systémové
promìnné. To znamená, ¾e nemusíme dopøedu alokovat místo pro tento øetìzec a
souèasnì je nutné (nejlépe co nejdøíve) tento øetìzec uvolnit s&nbsp;vyu¾itím
funkce <strong>Deallocate()</strong> popsané podrobnìji v&nbsp;pøedchozí èásti
tohoto seriálu. Ka¾dý virtuální stroj Javy by mìl nastavovat pøinejmen¹ím
následujících ¹est systémových promìnných:</p>

<table>
<tr><td>java.vm.vendor   </td></tr>
<tr><td>java.vm.version  </td></tr>
<tr><td>java.vm.name     </td></tr>
<tr><td>java.vm.info     </td></tr>
<tr><td>java.library.path</td></tr>
<tr><td>java.class.path  </td></tr>
</table>

<p>Ve skuteènosti je tìchto promìnných nastaveno více, minimálnì v&nbsp;pøípadì
OpenJDK a Oracle JDK.</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Pøíklad pou¾ití funkce <strong>GetSystemProperty()</strong></h2>

<p>Uka¾me si nyní, jakým zpùsobem lze naèíst a vypsat vybrané systémové
promìnné. To se pøímo v&nbsp;agentovi provede pomìrnì snadno, musíme ov¹em mít
na mysli, ¾e funkci <strong>GetSystemProperty()</strong> je mo¾né zavolat pouze
ve fázi naèítání a inicializace agenta, tj.&nbsp;buï pøímo ve fázi inicializace
virtuálního stroje Javy, popø.&nbsp;ve chvíli, kdy je agent pøipojován
k&nbsp;ji¾ bì¾ícímu virtuálnímu stroji (to jsme si ov¹em je¹tì neukazovali).
Pro nás to znamená, ¾e budeme funkci <strong>GetSystemProperty()</strong> volat
z&nbsp;funkce <strong>Agent_OnLoad()</strong>, co¾ je funkce, která je
automaticky zavolaná ve chvíli inicializace samotného agenta. V&nbsp;této
chvíli má agent mo¾nost si systémové promìnné pøeèíst a popøípadì nìkteré
z&nbsp;nich i modifikovat. Funkce (zavolaná
z&nbsp;<strong>Agent_OnLoad()</strong>, která vypí¹e obsah dvanácti základních
systémových promìnných nabízených OpenJDK i Oracle JDK, mù¾e ve své
nejjednodu¹¹í podobì vypadat následovnì. Pov¹imnìte si, ¾e ihned po vypsání
hodnoty systémové promìnné provedeme dealokaci øetìzce s&nbsp;vyu¾itím funkce
<strong>Deallocate()</strong>:</p>

<pre>
<i>/*</i>
<i> * Tisk nekterych vybranych systemovych promennych.</i>
<i> */</i>
static void <strong>print_selected_system_properties</strong>(jvmtiEnv *jvmti_env)
{
    <i>/* pole se jmeny promennych - nutno ukoncit NULLem! */</i>
    static char* property_names[] =
    {
        "sun.java.command",
        "java.home",
        "java.class.path",
        "java.library.path",
        "sun.boot.class.path",
        "sun.boot.library.path",
        "java.ext.dirs",
        "java.endorsed.dirs",
        "java.vm.version",
        "java.vm.name",
        "java.vm.info",
        "java.vm.vendor",
        NULL
    };
&nbsp;
    MSG("---  System properties  ---");
&nbsp;
    <i>/* ziskame a vypiseme hodnoty vybranych systemovych promennych */</i>
    char **property_name = property_names;
    for (; *property_name != NULL; property_name++)
    {
        char *property_value = NULL;
        (*jvmti_env)-&gt;<strong>GetSystemProperty</strong>(jvmti_env, *property_name, &amp;property_value);
        printf("%-30s\t%s\n", *property_name, property_value);
        (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char*) property_value);
    }
    MSG("--- --- --- --- --- --- ---");
}
</pre>

<p>V&nbsp;pøípadì, ¾e nìjaká systémová promìnná neexistuje nebo ji nelze
z&nbsp;nìjakého dùvodu pøeèíst, vrátí funkce
<strong>GetSystemProperty()</strong> chybový kód (JVMTI_ERROR_NOT_AVAILABLE,
JVMTI_ERROR_NULL_POINTER), který je vhodné korektnì testovat, co¾ znamená, ¾e
by na¹e funkce pro ètení systémových promìnných mohla vypadat spí¹e následovnì
&ndash; kontrolujeme zde jak návratový kód funkce
<strong>GetSystemProperty()</strong>, tak pro úplnou jistotu i návratový kód
funkce <strong>Deallocate()</strong>:</p>

<pre>
<i>/*</i>
<i> * Tisk nekterych vybranych systemovych promennych.</i>
<i> */</i>
static void <strong>print_selected_system_properties</strong>(jvmtiEnv *jvmti_env)
{
    <i>/* pole se jmeny promennych - nutno ukoncit NULLem! */</i>
    static char* property_names[] =
    {
        "sun.java.command",
        "java.home",
        "java.class.path",
        "java.library.path",
        "sun.boot.class.path",
        "sun.boot.library.path",
        "java.ext.dirs",
        "java.endorsed.dirs",
        "java.vm.version",
        "java.vm.name",
        "java.vm.info",
        "java.vm.vendor",
        NULL
    };
&nbsp;
    jvmtiError error_code;
&nbsp;
    MSG("---  System properties  ---");
&nbsp;
    <i>/* ziskame a vypiseme hodnoty vybranych systemovych promennych */</i>
    char **property_name = property_names;
    for (; *property_name != NULL; property_name++)
    {
        char *property_value = NULL;
        error_code = (*jvmti_env)-&gt;<strong>GetSystemProperty</strong>(jvmti_env, *property_name, &amp;property_value);
        check_jvmti_error(jvmti_env, error_code, "GetSystemProperty");
        printf("%-30s\t%s\n", *property_name, property_value);
        error_code = (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char*) property_value);
        check_jvmti_error(jvmti_env, error_code, "Deallocate");
    }
    MSG("--- --- --- --- --- --- ---");
}
</pre>



<p><a name="k03"></a></p>
<h2 id="k03">3. Sedmý demonstraèní pøíklad: agent, který pøeète hodnoty vybraných systémových promìnných</h2>

<p>S&nbsp;vyu¾itím informací, které jsme získali <a
href="#k01">v&nbsp;první</a> i <a href="#k02">ve druhé kapitole</a> ji¾ mù¾eme
napsat zdrojový kód celého agenta. V&nbsp;porovnání se zdrojovými kódy
z&nbsp;pøedchozí èásti tohoto seriálu je agent velmi jednoduchý, proto¾e
nemusíme nastavovat ¾ádné jeho po¾adované vlastnosti ani není zapotøebí
registrovat callback funkce:</p>

<pre>
<i>/*</i>
<i> * JVM TI agent, ktery na standardni vystup vypise hodnoty</i>
<i> * nekterych vybranych systemovych promennych.</i>
<i> */</i>
&nbsp;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
&nbsp;
<i>/* Nutno nastavit cestu pres volbu -Icesta_k_jvm */</i>
#include &lt;jvmti.h&gt;
&nbsp;
#define AGENT_NAME "Agent7:"
&nbsp;
<i>/*</i>
<i> * Vypis zpravy na standardni vystup.</i>
<i> */</i>
#define MSG(message) puts(AGENT_NAME " " message)
&nbsp;
<i>/*</i>
<i> * Vypis kodu chyby a chybove zpravy.</i>
<i> */</i>
static void <strong>print_jvmti_error</strong>(jvmtiEnv *jvmti, jvmtiError error_code, const char *str)
{
    char *error_code_str = NULL;
    const char *msg_str = str == NULL ? "" : str;
    char *msg_err = NULL;
&nbsp;
    (*jvmti)-&gt;GetErrorName(jvmti, error_code, &amp;error_code_str);
    msg_err = error_code_str == NULL ? "Unknown" : error_code_str;
    printf(AGENT_NAME " ERROR: JVMTI: %d(%s): %s\n", error_code, msg_err, msg_str);
}
&nbsp;
<i>/*</i>
<i> * Pokud je predany navratovy kod chybovym kodem, vypise se hlaseni.</i>
<i> */</i>
static void <strong>check_jvmti_error</strong>(jvmtiEnv *jvmti, jvmtiError error_code, const char *str)
{
    if ( error_code != JVMTI_ERROR_NONE )
    {
        print_jvmti_error(jvmti, error_code, str);
    }
}
&nbsp;
<i>/*</i>
<i> * Tisk nekterych vybranych systemovych promennych.</i>
<i> */</i>
static void <strong>print_selected_system_properties</strong>(jvmtiEnv *jvmti_env)
{
    <i>/* pole se jmeny promennych - nutno ukoncit NULLem! */</i>
    static char* property_names[] =
    {
        "sun.java.command",
        "java.home",
        "java.class.path",
        "java.library.path",
        "sun.boot.class.path",
        "sun.boot.library.path",
        "java.ext.dirs",
        "java.endorsed.dirs",
        "java.vm.version",
        "java.vm.name",
        "java.vm.info",
        "java.vm.vendor",
        NULL
    };
&nbsp;
    jvmtiError error_code;
&nbsp;
    MSG("---  System properties  ---");
&nbsp;
    <i>/* ziskame a vypiseme hodnoty vybranych systemovych promennych */</i>
    char **property_name = property_names;
    for (; *property_name != NULL; property_name++)
    {
        char *property_value = NULL;
        error_code = (*jvmti_env)-&gt;<strong>GetSystemProperty</strong>(jvmti_env, *property_name, &amp;property_value);
        check_jvmti_error(jvmti_env, error_code, "GetSystemProperty");
        printf("%-30s\t%s\n", *property_name, property_value);
        error_code = (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char*) property_value);
        check_jvmti_error(jvmti_env, error_code, "Deallocate");
    }
    MSG("--- --- --- --- --- --- ---");
}
&nbsp;
<i>/*</i>
<i> * Funkce zavolana ve chvili nacitani agenta do JVM.</i>
<i> */</i>
JNIEXPORT jint JNICALL <strong>Agent_OnLoad</strong>(JavaVM *jvm, char *options, void *reserved)
{
    jvmtiEnv *jvmti = NULL;
    jint result;
&nbsp;
    MSG("Agent_OnLoad");
    result = (*jvm)-&gt;GetEnv(jvm, (void **) &amp;jvmti, JVMTI_VERSION_1_0);
    if (result != JNI_OK || jvmti == NULL)
    {
        printf("ERROR: Unable to access JVMTI Version 1 (0x%x),"
                " is your J2SE a 1.5 or newer version? JNIEnv's GetEnv() returned %d\n",
                JVMTI_VERSION_1, (int)result);
        return result;
    }
    MSG("JVM TI version is correct");
&nbsp;
    <i>/* Vytiskneme vybrane systemove promenne. */</i>
    print_selected_system_properties(jvmti);
    return JNI_OK;
}
&nbsp;
<i>/*</i>
<i> * Funkce zavolana ve chvili odstranovani agenta z JVM.</i>
<i> */</i>
JNIEXPORT void JNICALL <strong>Agent_OnUnload</strong>(JavaVM *vm)
{
    MSG("Agent_OnUnload");
}
</pre>

<p>Funkci tohoto agenta je mo¾né si otestovat na tomto jednoduchém javovském
programu:</p>

<pre>
<i>/**</i>
<i> * Vypise na standardni vystup hodnotu systemove promenne "java.vm.vendor"</i>
<i> */</i>
public class <strong>Test7</strong> {
&nbsp;
    public static void <strong>main</strong>(String[] args) {
        System.out.println("--- Java side ---");
        System.out.format("%-30s\t%s\n", "java.vm.vendor", System.getProperty("java.vm.vendor"));
        System.out.println("--- Java side ---");
    }
&nbsp;
}
</pre>

<p>Po pøekladu obou programù:</p>

<pre>
gcc -Wall -ansi -I/usr/lib/jvm/java-1.6.0-openjdk/include/ -shared -o libagent7.so agent7.c
javac Test7.java
</pre>

<p>ji¾ mù¾eme spustit JVM i s&nbsp;agentem, a to pøíkazem:</p>

<pre>
java -agentpath:./libagent7.so Test7
</pre>

<p>Následuje pøíklad výpisu, v&nbsp;nìm¾ mù¾eme vidìt jak obsah v¹ech zvolených
systémových promìnných pøeètených agentem, tak i výstup testovacího javovského
programu. Konkrétní hodnoty v&nbsp;tomto pøípadì samozøejmì budou na rùzných
systémech odli¹né, proto¾e zále¾í na konkrétní konfiguraci Javy, její verzi,
nastavení &bdquo;alternatives&ldquo; atd. (zvýraznìním je naznaèeno, ¾e jak
agent, tak i javovský program dostane shodné hodnoty):</p>

<pre>
Agent7: Agent_OnLoad
Agent7: JVM TI version is correct
Agent7: ---  System properties  ---
sun.java.command                Test7
java.home                       /usr/lib/jvm/java-6-openjdk/jre
java.class.path                 .
java.library.path               /usr/lib/jvm/java-6-openjdk/jre/lib/i386/client:/usr/lib/jvm/java-6-openjdk/jre/lib/i386:/usr/lib/jvm/java-6-openjdk/jre/../lib/i386:/usr/java/packages/lib/i386:/usr/lib/jni:/lib:/usr/lib
sun.boot.class.path             /usr/lib/jvm/java-6-openjdk/jre/lib/resources.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rt.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jsse.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jce.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/charsets.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/netx.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/plugin.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rhino.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/modules/jdk.boot.jar:/usr/lib/jvm/java-6-openjdk/jre/classes
sun.boot.library.path           /usr/lib/jvm/java-6-openjdk/jre/lib/i386
java.ext.dirs                   /usr/lib/jvm/java-6-openjdk/jre/lib/ext:/usr/java/packages/lib/ext
java.endorsed.dirs              /usr/lib/jvm/java-6-openjdk/jre/lib/endorsed
java.vm.version                 20.0-b12
java.vm.name                    OpenJDK Client VM
java.vm.info                    mixed mode, sharing
<strong>java.vm.vendor                  Sun Microsystems Inc.</strong>
Agent7: --- --- --- --- --- --- ---
--- Java side ---
<strong>java.vm.vendor                  Sun Microsystems Inc.</strong>
--- Java side ---
Agent7: Agent_OnUnload
</pre>



<p><a name="k04"></a></p>
<h2 id="k04">4. Zmìna hodnot systémových promìnných: funkce <strong>SetSystemProperty()</strong></h2>

<p>Pøeètení obsahu vybrané systémové promìnné mù¾e být pro agenta velmi
dùle¾ité, proto¾e z&nbsp;obsahu nìkterých promìnných napøíklad mù¾e získat
informaci o tom, kde hledat nìjakou knihovnu atd. (na stranì javovských
programù se to dìje poloautomaticky pøes CLASSPATH, v&nbsp;pøípadì agenta
psaného vìt¹inou v&nbsp;céèku èi C++ to je v¹ak ponìkud slo¾itìj¹í). Ov¹em mù¾e
nastat situace, kdy bude nutné nìjakou promìnnou zmìnit. I to je samozøejmì
mo¾né, ov¹em (opìt) pouze ve fázi inicializace samotného virtuálního stroje
Javy &ndash; není tedy ¾ádoucí (a mnoho implementací JVM TI to hlídá), aby
agent mìnil systémové promìnné prakticky kdykoli javovské aplikaci &bdquo;pod
rukama&ldquo;. Pro zmìnu hodnoty nìkteré systémové promìnné lze v&nbsp;agentovi
vyu¾ít funkci nazvanou, jak ji¾ zajisté oèekáváte,
<strong>SetSystemProperty()</strong>, její¾ hlavièka vypadá následovnì:</p>

<pre>
jvmtiError SetSystemProperty(
        jvmtiEnv* env,
        const char* property,
        const char* value)
</pre>

<p>Této funkci se opìt pøedávají tøi parametry. Prvním parametrem je ukazatel
na strukturu obsahující stav &bdquo;prostøedí&ldquo; agenta, ve druhém
parametru musí být pøedán øetìzec s&nbsp;názvem nìjaké systémové promìnné a
v&nbsp;parametru tøetím se opìt pøedává øetìzec, tentokrát s&nbsp;novou
hodnotou systémové promìnné. Jak si uká¾eme dále, je mo¾né mìnit pouze nìkteré
systémové promìnné a pokud se agent pokusí modifikovat nìkterou promìnnou
urèenou pouze pro ètení, vrátí funkce <strong>SetSystemProperty()</strong>
chybový kód <strong>JVMTI_ERROR_NOT_AVAILABLE</strong>, který znamená, ¾e daná
systémová promìnná buï vùbec neexistuje nebo je mo¾né její obsah pouze pøeèíst,
ale nikoli pøepsat. Jednou z&nbsp;promìnných &ndash; a to velmi dùle¾itých
promìnných &ndash; je i promìnná <strong>java.class.path</strong>, která
obsahuje cestu, na nich¾ JVM hledá tøídy aplikace. Tuto promìnnou lze zmìnit a
pokud ji zmìníme napøíklad tak, ¾e zde nebude obsa¾ena teèka (aktuální
adresáø), dojde pøi inicializaci aplikace k&nbsp;chybì, co¾ si mù¾ete vyzkou¹et
v&nbsp;demonstraèním pøíkladu uvedeném <a href="#k05">v&nbsp;navazující
kapitole</a>.</p>

<p>Funkce pro zmìnu systémové promìnné nazvané <strong>java.class.path</strong>
mù¾e být velmi jednoduchá, jak je to ostatnì patrné pøi pohledu na následující
funkci, kterou vyu¾ijeme i v&nbsp;osmém demonstraèním pøíkladu popsaném <a
href="#k05">v&nbsp;páté kapitole</a>:</p>

<pre>
<i>/*</i>
<i> * Zmena jedne vybrane promenne.</i>
<i> */</i>
static void <strong>change_selected_property</strong>(jvmtiEnv *jvmti_env)
{
    jvmtiError error_code;
    error_code = (*jvmti_env)-&gt;SetSystemProperty(jvmti_env, "java.class.path", ".:new_path");
    check_jvmti_error(jvmti_env, error_code, "SetSystemProperty");
}
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Osmý demonstraèní pøíklad: zmìna nastavení <strong>CLASSPATH</strong> v&nbsp;dobì spu¹tìní agenta</h2>

<p>Na¹i funkci <strong>change_selected_property()</strong> <a
href="#k04">z&nbsp;pøedchozí kapitoly</a> vyu¾ijeme prakticky, tentokrát
v&nbsp;osmém demonstraèním agentovi, jeho¾ zdrojový kód je vypsán pod tímto
odstavcem. Agent nejdøíve naète a vypí¹e hodnoty v¹ech vybraných systémových
promìnných, potom jednu zvolenou promìnnou (<strong>java.class.path</strong>)
zmìní a posléze opìt vypí¹e hodnoty vybraných systémových promìnných &ndash;
zde se ji¾ ov¹em promítne zmìna v&nbsp;jedné promìnné:</p>

<pre>
<i>/*</i>
<i> * JVM TI agent, ktery na standardni vystup vypise hodnoty</i>
<i> * nekterych vybranych systemovych promennych, posleze</i>
<i> * zmeni jednu promennou, ktera je nasledne prectena z programu</i>
<i> * beziciho v JVM.</i>
<i> */</i>
&nbsp;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
&nbsp;
<i>/* Nutno nastavit cestu pres volbu -Icesta_k_jvm */</i>
#include &lt;jvmti.h&gt;
&nbsp;
#define AGENT_NAME "Agent8:"
&nbsp;
<i>/*</i>
<i> * Vypis zpravy na standardni vystup.</i>
<i> */</i>
#define MSG(message) puts(AGENT_NAME " " message)
&nbsp;
<i>/*</i>
<i> * Vypis kodu chyby a chybove zpravy.</i>
<i> */</i>
static void <strong>print_jvmti_error</strong>(jvmtiEnv *jvmti, jvmtiError error_code, const char *str)
{
    char *error_code_str = NULL;
    const char *msg_str = str == NULL ? "" : str;
    char *msg_err = NULL;
&nbsp;
    (*jvmti)-&gt;GetErrorName(jvmti, error_code, &amp;error_code_str);
    msg_err = error_code_str == NULL ? "Unknown" : error_code_str;
    printf(AGENT_NAME " ERROR: JVMTI: %d(%s): %s\n", error_code, msg_err, msg_str);
}
&nbsp;
<i>/*</i>
<i> * Pokud je predany navratovy kod chybovym kodem, vypise se hlaseni.</i>
<i> */</i>
static void <strong>check_jvmti_error</strong>(jvmtiEnv *jvmti, jvmtiError error_code, const char *str)
{
    if ( error_code != JVMTI_ERROR_NONE )
    {
        print_jvmti_error(jvmti, error_code, str);
    }
}
&nbsp;
<i>/*</i>
<i> * Tisk nekterych vybranych systemovych promennych.</i>
<i> */</i>
static void <strong>print_selected_system_properties</strong>(jvmtiEnv *jvmti_env)
{
    <i>/* pole se jmeny promennych - nutno ukoncit NULLem! */</i>
    static char* property_names[] =
    {
        "sun.java.command",
        "java.home",
        "java.class.path",
        "java.library.path",
        "sun.boot.class.path",
        "sun.boot.library.path",
        "java.ext.dirs",
        "java.endorsed.dirs",
        "java.vm.version",
        "java.vm.name",
        "java.vm.info",
        "java.vm.vendor",
        NULL
    };
&nbsp;
    jvmtiError error_code;
&nbsp;
    MSG("---  System properties  ---");
&nbsp;
    <i>/* ziskame a vypiseme hodnoty vybranych systemovych promennych */</i>
    char **property_name = property_names;
    for (; *property_name != NULL; property_name++)
    {
        char *property_value = NULL;
        error_code = (*jvmti_env)-&gt;<strong>GetSystemProperty</strong>(jvmti_env, *property_name, &amp;property_value);
        check_jvmti_error(jvmti_env, error_code, "GetSystemProperty");
        printf("%-30s\t%s\n", *property_name, property_value);
        error_code = (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char*) property_value);
        check_jvmti_error(jvmti_env, error_code, "Deallocate");
    }
    MSG("--- --- --- --- --- --- ---");
}
&nbsp;
<i>/*</i>
<i> * Zmena jedne vybrane promenne.</i>
<i> */</i>
static void <strong>change_selected_property</strong>(jvmtiEnv *jvmti_env)
{
    jvmtiError error_code;
    error_code = (*jvmti_env)-&gt;SetSystemProperty(jvmti_env, "java.class.path", ".:new_path");
    check_jvmti_error(jvmti_env, error_code, "SetSystemProperty");
}
&nbsp;
<i>/*</i>
<i> * Funkce zavolana ve chvili nacitani agenta do JVM.</i>
<i> */</i>
JNIEXPORT jint JNICALL <strong>Agent_OnLoad</strong>(JavaVM *jvm, char *options, void *reserved)
{
    jvmtiEnv *jvmti = NULL;
    jint result;
&nbsp;
    MSG("Agent_OnLoad");
    result = (*jvm)-&gt;GetEnv(jvm, (void **) &amp;jvmti, JVMTI_VERSION_1_0);
    if (result != JNI_OK || jvmti == NULL)
    {
        printf("ERROR: Unable to access JVMTI Version 1 (0x%x),"
                " is your J2SE a 1.5 or newer version? JNIEnv's GetEnv() returned %d\n",
                JVMTI_VERSION_1, (int)result);
        return result;
    }
    MSG("JVM TI version is correct");
&nbsp;
    <i>/* Vytiskneme vybrane systemove promenne. */</i>
    <i>/* potom jednu zmenime a provede se novy tisk. */</i>
    print_selected_system_properties(jvmti);
    change_selected_property(jvmti);
    print_selected_system_properties(jvmti);
&nbsp;
    return JNI_OK;
}
&nbsp;
<i>/*</i>
<i> * Funkce zavolana ve chvili odstranovani agenta z JVM.</i>
<i> */</i>
JNIEXPORT void JNICALL <strong>Agent_OnUnload</strong>(JavaVM *vm)
{
    MSG("Agent_OnUnload");
}
</pre>

<p>Opìt mù¾eme provést test s&nbsp;vyu¾itím následujícího javovského
programu:</p>

<pre>
<i>/**</i>
<i> * Vypise na standardni vystup hodnotu systemove promenne "java.class.path"</i>
<i> */</i>
public class <strong>Test8</strong> {
&nbsp;
    public static void <strong>main</strong>(String[] args) {
        System.out.println("--- Java side ---");
        System.out.format("%-30s\t%s\n", "java.class.path", System.getProperty("java.class.path"));
        System.out.println("--- Java side ---");
    }
&nbsp;
}
</pre>

<p>Pøeklad:</p>

<pre>
gcc -Wall -ansi -I/usr/lib/jvm/java-1.6.0-openjdk/include/ -shared -o libagent8.so agent8.c
javac Test8.java
</pre>

<p>Spu¹tìní:</p>

<pre>
java -agentpath:./libagent8.so Test8
</pre>

<p>Ve výpise (tj.&nbsp;v&nbsp;zachyceném standardním výstupu) mù¾eme vidìt, ¾e
javovský program skuteènì získal modifikovanou hodnotu systémové promìnné
<strong>java.class.path</strong>. Pov¹imnìte si pøedev¹ím zvýraznìných
øádkù:</p>

<pre>
Agent8: Agent_OnLoad
Agent8: JVM TI version is correct
Agent8: ---  System properties  ---
sun.java.command                Test8
java.home                       /usr/lib/jvm/java-6-openjdk/jre
<strong>java.class.path                 .</strong>
java.library.path               /usr/lib/jvm/java-6-openjdk/jre/lib/i386/client:/usr/lib/jvm/java-6-openjdk/jre/lib/i386:/usr/lib/jvm/java-6-openjdk/jre/../lib/i386:/usr/java/packages/lib/i386:/usr/lib/jni:/lib:/usr/lib
sun.boot.class.path             /usr/lib/jvm/java-6-openjdk/jre/lib/resources.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rt.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jsse.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jce.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/charsets.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/netx.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/plugin.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rhino.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/modules/jdk.boot.jar:/usr/lib/jvm/java-6-openjdk/jre/classes
sun.boot.library.path           /usr/lib/jvm/java-6-openjdk/jre/lib/i386
java.ext.dirs                   /usr/lib/jvm/java-6-openjdk/jre/lib/ext:/usr/java/packages/lib/ext
java.endorsed.dirs              /usr/lib/jvm/java-6-openjdk/jre/lib/endorsed
java.vm.version                 20.0-b12
java.vm.name                    OpenJDK Client VM
java.vm.info                    mixed mode, sharing
java.vm.vendor                  Sun Microsystems Inc.
Agent8: --- --- --- --- --- --- ---
Agent8: ---  System properties  ---
sun.java.command                Test8
java.home                       /usr/lib/jvm/java-6-openjdk/jre
<strong>java.class.path                 .:new_path</strong>
java.library.path               /usr/lib/jvm/java-6-openjdk/jre/lib/i386/client:/usr/lib/jvm/java-6-openjdk/jre/lib/i386:/usr/lib/jvm/java-6-openjdk/jre/../lib/i386:/usr/java/packages/lib/i386:/usr/lib/jni:/lib:/usr/lib
sun.boot.class.path             /usr/lib/jvm/java-6-openjdk/jre/lib/resources.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rt.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jsse.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jce.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/charsets.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/netx.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/plugin.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rhino.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/modules/jdk.boot.jar:/usr/lib/jvm/java-6-openjdk/jre/classes
sun.boot.library.path           /usr/lib/jvm/java-6-openjdk/jre/lib/i386
java.ext.dirs                   /usr/lib/jvm/java-6-openjdk/jre/lib/ext:/usr/java/packages/lib/ext
java.endorsed.dirs              /usr/lib/jvm/java-6-openjdk/jre/lib/endorsed
java.vm.version                 20.0-b12
java.vm.name                    OpenJDK Client VM
java.vm.info                    mixed mode, sharing
java.vm.vendor                  Sun Microsystems Inc.
--- Java side ---
<strong>java.class.path                 .:new_path</strong>
--- Java side ---
Agent8: --- --- --- --- --- --- ---
Agent8: Agent_OnUnload
</pre>



<p><a name="k06"></a></p>
<h2 id="k06">6. Devátý demonstraèní pøíklad: pokus o zmìnu nemodifikovatelné promìnné</h2>

<p>Ve <a href="#k04">ètvrté kapitole</a> jsme si øekli, ¾e zdaleka ne v¹echny
systémové promìnné je mo¾né mìnit. U nìkterých implementací JVM napøíklad není
mo¾né modifikovat promìnnou <strong>java.vm.vendor</strong>, v&nbsp;ní¾ je
&bdquo;podepsán&ldquo; dodavatel virtuálního stroje. Pokud se o zmìnu této
promìnné pokusíme, dojde k&nbsp;chybì, co¾ konkrétnì znamená, ¾e funkce
<strong>SetSystemProperty()</strong> vrátí hodnotu
<strong>JVMTI_ERROR_NOT_AVAILABLE</strong> a systémová promìnná se podle
oèekávání nezmìní:</p>

<pre>
<i>/*</i>
<i> * Pokus o zmenu jedne vybrane promenne.</i>
<i> */</i>
static void <strong>change_selected_property</strong>(jvmtiEnv *jvmti_env)
{
    jvmtiError error_code;
    error_code = (*jvmti_env)-&gt;SetSystemProperty(jvmti_env, "java.vm.vendor", "Planet Express, Universe A");
    check_jvmti_error(jvmti_env, error_code, "SetSystemProperty");
}
</pre>

<p>Zdrojový kód celého demonstraèního pøíkladu vypadá takto:</p>

<pre>
<i>/*</i>
<i> * JVM TI agent, ktery na standardni vystup vypise hodnoty</i>
<i> * nekterych vybranych systemovych promennych, posleze</i>
<i> * se pokusi zmenit jednu promennou.</i>
<i> */</i>
&nbsp;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
&nbsp;
<i>/* Nutno nastavit cestu pres volbu -Icesta_k_jvm */</i>
#include &lt;jvmti.h&gt;
&nbsp;
#define AGENT_NAME "Agent9:"
&nbsp;
<i>/*</i>
<i> * Vypis zpravy na standardni vystup.</i>
<i> */</i>
#define MSG(message) puts(AGENT_NAME " " message)
&nbsp;
<i>/*</i>
<i> * Vypis kodu chyby a chybove zpravy.</i>
<i> */</i>
static void <strong>print_jvmti_error</strong>(jvmtiEnv *jvmti, jvmtiError error_code, const char *str)
{
    char *error_code_str = NULL;
    const char *msg_str = str == NULL ? "" : str;
    char *msg_err = NULL;
&nbsp;
    (*jvmti)-&gt;GetErrorName(jvmti, error_code, &amp;error_code_str);
    msg_err = error_code_str == NULL ? "Unknown" : error_code_str;
    printf(AGENT_NAME " ERROR: JVMTI: %d(%s): %s\n", error_code, msg_err, msg_str);
}
&nbsp;
<i>/*</i>
<i> * Pokud je predany navratovy kod chybovym kodem, vypise se hlaseni.</i>
<i> */</i>
static void <strong>check_jvmti_error</strong>(jvmtiEnv *jvmti, jvmtiError error_code, const char *str)
{
    if ( error_code != JVMTI_ERROR_NONE )
    {
        print_jvmti_error(jvmti, error_code, str);
    }
}
&nbsp;
<i>/*</i>
<i> * Tisk nekterych vybranych systemovych promennych.</i>
<i> */</i>
static void <strong>print_selected_system_properties</strong>(jvmtiEnv *jvmti_env)
{
    <i>/* pole se jmeny promennych - nutno ukoncit NULLem! */</i>
    static char* property_names[] =
    {
        "sun.java.command",
        "java.home",
        "java.class.path",
        "java.library.path",
        "sun.boot.class.path",
        "sun.boot.library.path",
        "java.ext.dirs",
        "java.endorsed.dirs",
        "java.vm.version",
        "java.vm.name",
        "java.vm.info",
        "java.vm.vendor",
        NULL
    };
&nbsp;
    jvmtiError error_code;
&nbsp;
    MSG("---  System properties  ---");
&nbsp;
    <i>/* ziskame a vypiseme hodnoty vybranych systemovych promennych */</i>
    char **property_name = property_names;
    for (; *property_name != NULL; property_name++)
    {
        char *property_value = NULL;
        error_code = (*jvmti_env)-&gt;<strong>GetSystemProperty</strong>(jvmti_env, *property_name, &amp;property_value);
        check_jvmti_error(jvmti_env, error_code, "GetSystemProperty");
        printf("%-30s\t%s\n", *property_name, property_value);
        error_code = (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char*) property_value);
        check_jvmti_error(jvmti_env, error_code, "Deallocate");
    }
    MSG("--- --- --- --- --- --- ---");
}
&nbsp;
<i>/*</i>
<i> * Zmena jedne vybrane promenne.</i>
<i> */</i>
static void <strong>change_selected_property</strong>(jvmtiEnv *jvmti_env)
{
    jvmtiError error_code;
    error_code = (*jvmti_env)-&gt;SetSystemProperty(jvmti_env, "java.vm.vendor", "Planet Express, Universe A");
    check_jvmti_error(jvmti_env, error_code, "SetSystemProperty");
}
&nbsp;
<i>/*</i>
<i> * Funkce zavolana ve chvili nacitani agenta do JVM.</i>
<i> */</i>
JNIEXPORT jint JNICALL <strong>Agent_OnLoad</strong>(JavaVM *jvm, char *options, void *reserved)
{
    jvmtiEnv *jvmti = NULL;
    jint result;
&nbsp;
    MSG("Agent_OnLoad");
    result = (*jvm)-&gt;GetEnv(jvm, (void **) &amp;jvmti, JVMTI_VERSION_1_0);
    if (result != JNI_OK || jvmti == NULL)
    {
        printf("ERROR: Unable to access JVMTI Version 1 (0x%x),"
                " is your J2SE a 1.5 or newer version? JNIEnv's GetEnv() returned %d\n",
                JVMTI_VERSION_1, (int)result);
        return result;
    }
    MSG("JVM TI version is correct");
&nbsp;
    <i>/* Vytiskneme vybrane systemove promenne. */</i>
    <i>/* potom jednu zmenime a provede se novy tisk. */</i>
    print_selected_system_properties(jvmti);
    change_selected_property(jvmti);
    print_selected_system_properties(jvmti);
&nbsp;
    return JNI_OK;
}
&nbsp;
<i>/*</i>
<i> * Funkce zavolana ve chvili odstranovani agenta z JVM.</i>
<i> */</i>
JNIEXPORT void JNICALL <strong>Agent_OnUnload</strong>(JavaVM *vm)
{
    MSG("Agent_OnUnload");
}
</pre>

<p>Pøeklad:</p>

<pre>
gcc -Wall -ansi -I/usr/lib/jvm/java-1.6.0-openjdk/include/ -shared -o libagent9.so agent9.c
javac Test9.java
</pre>

<p>Spu¹tìní:</p>

<pre>
java -agentpath:./libagent9.so Test9
</pre>

<p>Na standardním a chybovém výstupu je vypsána i chyba funkce
<strong>SetSystemProperty()</strong>:</p>

<pre>
Agent9: Agent_OnLoad
Agent9: JVM TI version is correct
Agent9: ---  System properties  ---
sun.java.command                Test9
java.home                       /usr/lib/jvm/java-6-openjdk/jre
java.class.path                 .
java.library.path               /usr/lib/jvm/java-6-openjdk/jre/lib/i386/client:/usr/lib/jvm/java-6-openjdk/jre/lib/i386:/usr/lib/jvm/java-6-openjdk/jre/../lib/i386:/usr/java/packages/lib/i386:/usr/lib/jni:/lib:/usr/lib
sun.boot.class.path             /usr/lib/jvm/java-6-openjdk/jre/lib/resources.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rt.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jsse.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jce.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/charsets.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/netx.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/plugin.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rhino.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/modules/jdk.boot.jar:/usr/lib/jvm/java-6-openjdk/jre/classes
sun.boot.library.path           /usr/lib/jvm/java-6-openjdk/jre/lib/i386
java.ext.dirs                   /usr/lib/jvm/java-6-openjdk/jre/lib/ext:/usr/java/packages/lib/ext
java.endorsed.dirs              /usr/lib/jvm/java-6-openjdk/jre/lib/endorsed
java.vm.version                 20.0-b12
java.vm.name                    OpenJDK Client VM
java.vm.info                    mixed mode, sharing
<strong>java.vm.vendor                  Sun Microsystems Inc.</strong>
Agent9: --- --- --- --- --- --- ---
<strong>Agent9: ERROR: JVMTI: 98(JVMTI_ERROR_NOT_AVAILABLE): SetSystemProperty</strong>
Agent9: ---  System properties  ---
sun.java.command                Test9
java.home                       /usr/lib/jvm/java-6-openjdk/jre
java.class.path                 .
java.library.path               /usr/lib/jvm/java-6-openjdk/jre/lib/i386/client:/usr/lib/jvm/java-6-openjdk/jre/lib/i386:/usr/lib/jvm/java-6-openjdk/jre/../lib/i386:/usr/java/packages/lib/i386:/usr/lib/jni:/lib:/usr/lib
sun.boot.class.path             /usr/lib/jvm/java-6-openjdk/jre/lib/resources.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rt.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jsse.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jce.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/charsets.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/netx.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/plugin.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rhino.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/modules/jdk.boot.jar:/usr/lib/jvm/java-6-openjdk/jre/classes
sun.boot.library.path           /usr/lib/jvm/java-6-openjdk/jre/lib/i386
java.ext.dirs                   /usr/lib/jvm/java-6-openjdk/jre/lib/ext:/usr/java/packages/lib/ext
java.endorsed.dirs              /usr/lib/jvm/java-6-openjdk/jre/lib/endorsed
java.vm.version                 20.0-b12
java.vm.name                    OpenJDK Client VM
java.vm.info                    mixed mode, sharing
<strong>java.vm.vendor                  Sun Microsystems Inc.</strong>
--- Java side ---
<strong>java.vm.vendor                  Sun Microsystems Inc.</strong>
--- Java side ---
Agent9: --- --- --- --- --- --- ---
Agent9: Agent_OnUnload
</pre>



<p><a name="k07"></a></p>
<h2 id="k07">7. Funkce <strong>GetSystemProperties()</strong> urèená pro ètení názvù v¹ech systémových promìnných</h2>

<p>V¹echny demonstraèní pøíklady ukázané v&nbsp;pøedchozích kapitolách byly
zalo¾eny na znalosti správného názvu systémových promìnných. Ov¹em rozhraní
<i>JVM TI</i> obsahuje i funkci nazvanou
<strong>GetSystemProperties()</strong>, kterou je mo¾né pou¾ít pro získání jmen
(nikoli hodnot!) v¹ech systémových promìnných.  Podobná funkce (metoda)
existuje i v&nbsp;Javì, ov¹em v&nbsp;pøípadì rozhraní <i>JVM TI</i> je v¹e
komplikováno tím, ¾e se programátor musí postarat o dealokaci pamìti obsahující
vrácená jména systémových promìnných:</p>

<pre>
jvmtiError GetSystemProperties(
        jvmtiEnv* env,
        jint* count_ptr,
        char*** property_ptr)
</pre>

<p>Tato funkce ve svém druhém parametru vrátí poèet v¹ech systémových
promìnných a ve svém tøetím parametru pak pole øetìzcù s&nbsp;názvy tìchto
promìnných. Pole se musí internì vytvoøit, proto se pøedává <i>ukazatel</i> na
toto pole, tj.&nbsp;<strong>char***</strong>, proto¾e <strong>char**</strong>
znaèí pole øetìzcù a <strong>char*</strong> jeden øetìzec. S&nbsp;tìmito názvy
ji¾ umíme pracovat &ndash; pou¾ijeme je pro získání hodnoty promìnné
s&nbsp;vyu¾itím funkce <strong>GetSystemProperty()</strong>:</p>

<pre>
    char **property_names;
    jint count;
    int i;
&nbsp;
    error_code = (*jvmti_env)-&gt;<strong>GetSystemProperties</strong>(jvmti_env, &amp;count, &amp;property_names);
&nbsp;
    <i>/* ziskame a vypiseme hodnoty vsech systemovych promennych */</i>
    for (i = 0; i &lt; count; i++)
    {
        char *prop_name = property_names[i];
        char *property_value = NULL;
        (*jvmti_env)-&gt;<strong>GetSystemProperty</strong>(jvmti_env, prop_name, &amp;property_value);
        printf("%-30s\t%s\n", prop_name, property_value);
        (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char*) property_value);
    }
</pre>

<p>Velmi dùle¾ité je v¹ak uvolnit pamì» alokovanou uvnitø funkce
<strong>GetSystemProperties()</strong>. Jak ji¾ víme, jedná se o pole øetìzcù,
tak¾e dealokace probíhá ve dvou fázích. Ve fázi první se uvolní jednotlivé
øetìzce a teprve ve fázi druhé se uvolní celé pole (to obsahuje pouze
ukazatele):</p>

<pre>
    <i>/* faze dealokace pameti */</i>
    for (i = 0; i &lt; count; i++)
    {
        char *prop_name = property_names[i];
        printf("Deallocation of string '%-30s' with length %3d stored at %p\n",
                prop_name, strlen(prop_name), prop_name);
        (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char *)prop_name);
    }
    printf("Deallocation of an array stored at %p\n", property_names);
    (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char *)property_names);
</pre>



<p><a name="k08"></a></p>
<h2 id="k08">8. Desátý demonstraèní pøíklad: výpis v¹ech systémových promìnných nastavených virtuálním strojem</h2>

<p>Vý¹e uvedené dva fragmenty kódu mù¾eme snadno pøidat do na¹eho testovacího
agenta, v&nbsp;nìm¾ se novì objevuje funkce nazvaná
<strong>print_all_system_properties()</strong>:</p>

<pre>
<i>/*</i>
<i> * JVM TI agent, ktery na standardni vystup vypise hodnoty</i>
<i> * vsech systemovych promennych.</i>
<i> */</i>
&nbsp;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
&nbsp;
<i>/* Nutno nastavit cestu pres volbu -Icesta_k_jvm */</i>
#include &lt;jvmti.h&gt;
&nbsp;
#define <strong>AGENT_NAME</strong> "Agent10:"
&nbsp;
<i>/*</i>
<i> * Vypis zpravy na standardni vystup.</i>
<i> */</i>
#define MSG(message) puts(AGENT_NAME " " message)
&nbsp;
<i>/*</i>
<i> * Vypis kodu chyby a chybove zpravy.</i>
<i> */</i>
static void <strong>print_jvmti_error</strong>(jvmtiEnv *jvmti, jvmtiError error_code, const char *str)
{
    char *error_code_str = NULL;
    const char *msg_str = str == NULL ? "" : str;
    char *msg_err = NULL;
&nbsp;
    (*jvmti)-&gt;GetErrorName(jvmti, error_code, &amp;error_code_str);
    msg_err = error_code_str == NULL ? "Unknown" : error_code_str;
    printf(AGENT_NAME " ERROR: JVMTI: %d(%s): %s\n", error_code, msg_err, msg_str);
}
&nbsp;
<i>/*</i>
<i> * Pokud je predany navratovy kod chybovym kodem, vypise se hlaseni.</i>
<i> */</i>
static void <strong>check_jvmti_error</strong>(jvmtiEnv *jvmti, jvmtiError error_code, const char *str)
{
    if ( error_code != JVMTI_ERROR_NONE )
    {
        print_jvmti_error(jvmti, error_code, str);
    }
}
&nbsp;
<i>/*</i>
<i> * Tisk vsech systemovych promennych.</i>
<i> */</i>
static void <strong>print_all_system_properties</strong>(jvmtiEnv *jvmti_env)
{
    jvmtiError error_code;
    jint count;
    char **property_names;
    int i;
&nbsp;
    MSG("---  All system properties  ---");
&nbsp;
    error_code = (*jvmti_env)-&gt;<strong>GetSystemProperties</strong>(jvmti_env, &amp;count, &amp;property_names);
&nbsp;
    <i>/* ziskame a vypiseme hodnoty vsech systemovych promennych */</i>
    for (i = 0; i &lt; count; i++)
    {
        char *prop_name = property_names[i];
        char *property_value = NULL;
        error_code = (*jvmti_env)-&gt;<strong>GetSystemProperty</strong>(jvmti_env, prop_name, &amp;property_value);
        check_jvmti_error(jvmti_env, error_code, "GetSystemProperty");
        printf("%-30s\t%s\n", prop_name, property_value);
        error_code = (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char*) property_value);
        check_jvmti_error(jvmti_env, error_code, "Deallocate");
    }
    MSG("--- --- --- --- --- --- --- ---");
&nbsp;
    <i>/* faze dealokace pameti */</i>
    for (i = 0; i &lt; count; i++)
    {
        char *prop_name = property_names[i];
        printf("Deallocation of string '%-30s' with length %3d stored at %p\n",
                prop_name, strlen(prop_name), prop_name);
        error_code = (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char *)prop_name);
        check_jvmti_error(jvmti_env, error_code, "Deallocate");
    }
    printf("Deallocation of an array stored at %p\n", property_names);
    error_code = (*jvmti_env)-&gt;<strong>Deallocate</strong>(jvmti_env, (unsigned char *)property_names);
    check_jvmti_error(jvmti_env, error_code, "Deallocate");
}
&nbsp;
<i>/*</i>
<i> * Funkce zavolana ve chvili nacitani agenta do JVM.</i>
<i> */</i>
JNIEXPORT jint JNICALL <strong>Agent_OnLoad</strong>(JavaVM *jvm, char *options, void *reserved)
{
    jvmtiEnv *jvmti = NULL;
    jint result;
&nbsp;
    MSG("Agent_OnLoad");
    result = (*jvm)-&gt;GetEnv(jvm, (void **) &amp;jvmti, JVMTI_VERSION_1_0);
    if (result != JNI_OK || jvmti == NULL)
    {
        printf("ERROR: Unable to access JVMTI Version 1 (0x%x),"
                " is your J2SE a 1.5 or newer version? JNIEnv's GetEnv() returned %d\n",
                JVMTI_VERSION_1, (int)result);
        return result;
    }
    MSG("JVM TI version is correct");
&nbsp;
    <i>/* Vytiskneme vsechny systemove promenne. */</i>
    print_all_system_properties(jvmti);
    return JNI_OK;
}
&nbsp;
<i>/*</i>
<i> * Funkce zavolana ve chvili odstranovani agenta z JVM.</i>
<i> */</i>
JNIEXPORT void JNICALL <strong>Agent_OnUnload</strong>(JavaVM *vm)
{
    MSG("Agent_OnUnload");
}
</pre>

<p>Javovská èást testu je velmi jednoduchá:</p>

<pre>
public class Test10 {
&nbsp;
    public static void main(String[] args) {
    }
&nbsp;
}
</pre>

<p>Pøeklad:</p>

<pre>
gcc -Wall -ansi -I/usr/lib/jvm/java-1.6.0-openjdk/include/ -shared -o libagent10.so agent10.c
javac Test10.java
</pre>

<p>Spu¹tìní:</p>

<pre>
java -agentpath:./libagent10.so Test10
</pre>

<p>Po spu¹tìní se na standardní výstup skuteènì vypí¹e obsah v¹ech dostupných
systémových promìnných:</p>

<pre>
Agent10: Agent_OnLoad
Agent10: JVM TI version is correct
Agent10: ---  All system properties  ---
java.vm.specification.name      Java Virtual Machine Specification
java.vm.version                 20.0-b12
java.vm.name                    OpenJDK Client VM
java.vm.info                    mixed mode, sharing
java.ext.dirs                   /usr/lib/jvm/java-6-openjdk/jre/lib/ext:/usr/java/packages/lib/ext
java.endorsed.dirs              /usr/lib/jvm/java-6-openjdk/jre/lib/endorsed
sun.boot.library.path           /usr/lib/jvm/java-6-openjdk/jre/lib/i386
java.library.path               /usr/lib/jvm/java-6-openjdk/jre/lib/i386/client:/usr/lib/jvm/java-6-openjdk/jre/lib/i386:/usr/lib/jvm/java-6-openjdk/jre/../lib/i386:/usr/java/packages/lib/i386:/usr/lib/jni:/lib:/usr/lib
java.home                       /usr/lib/jvm/java-6-openjdk/jre
java.class.path                 .
sun.boot.class.path             /usr/lib/jvm/java-6-openjdk/jre/lib/resources.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rt.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jsse.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/jce.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/charsets.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/netx.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/plugin.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/rhino.jar:/usr/lib/jvm/java-6-openjdk/jre/lib/modules/jdk.boot.jar:/usr/lib/jvm/java-6-openjdk/jre/classes
java.vm.specification.vendor    Sun Microsystems Inc.
java.vm.specification.version   1.0
java.vm.vendor                  Sun Microsystems Inc.
sun.java.command                Test10
sun.java.launcher               SUN_STANDARD
Agent10: --- --- --- --- --- --- --- ---
</pre>

<p>Následnì se vypí¹e zpráva o dealokaci pamìti, pøesnìji øeèeno pole øetìzcù
s&nbsp;názvy systémových promìnných:</p>

<pre>
Deallocation of string 'java.vm.specification.name    ' with length  26 stored at 0x8cb7d40
Deallocation of string 'java.vm.version               ' with length  15 stored at 0x8cb7d60
Deallocation of string 'java.vm.name                  ' with length  12 stored at 0x8cb7d78
Deallocation of string 'java.vm.info                  ' with length  12 stored at 0x8cb7d90
Deallocation of string 'java.ext.dirs                 ' with length  13 stored at 0x8cb7da8
Deallocation of string 'java.endorsed.dirs            ' with length  18 stored at 0x8cb7dc0
Deallocation of string 'sun.boot.library.path         ' with length  21 stored at 0x8cb7dd8
Deallocation of string 'java.library.path             ' with length  17 stored at 0x8cb7df8
Deallocation of string 'java.home                     ' with length   9 stored at 0x8cb7e10
Deallocation of string 'java.class.path               ' with length  15 stored at 0x8cb7e20
Deallocation of string 'sun.boot.class.path           ' with length  19 stored at 0x8cb7e38
Deallocation of string 'java.vm.specification.vendor  ' with length  28 stored at 0x8cb7e50
Deallocation of string 'java.vm.specification.version ' with length  29 stored at 0x8cb7e78
Deallocation of string 'java.vm.vendor                ' with length  14 stored at 0x8cb7ea0
Deallocation of string 'sun.java.command              ' with length  16 stored at 0x8cb7eb8
Deallocation of string 'sun.java.launcher             ' with length  17 stored at 0x8cb7ed0
Deallocation of an array stored at 0x8cb7cf8
Agent10: Agent_OnUnload
</pre>



<p><a name="k09"></a></p>
<h2 id="k09">9. Odkazy na Internetu</h2>

<ol>

<li>The JVM Tool Interface (JVM TI): How VM Agents Work<br />
<a href="http://www.oracle.com/technetwork/articles/javase/jvm-ti-141370.html">http://www.oracle.com/technetwork/articles/javase/jvm-ti-141370.html</a>
</li>

<li>JVM Tool Interface Version 1.2<br />
<a href="http://docs.oracle.com/javase/7/docs/platform/jvmti/jvmti.html">http://docs.oracle.com/javase/7/docs/platform/jvmti/jvmti.html</a>
</li>

<li>Creating a Debugging and Profiling Agent with JVMTI<br />
<a href="http://www.oracle.com/technetwork/articles/javase/jvmti-136367.html">http://www.oracle.com/technetwork/articles/javase/jvmti-136367.html</a>
</li>

<li>JVM TI (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/JVM_TI">http://en.wikipedia.org/wiki/JVM_TI</a>
</li>

<li>IBM JVMTI extensions<br />
<a href="http://publib.boulder.ibm.com/infocenter/realtime/v2r0/index.jsp?topic=%2Fcom.ibm.softrt.doc%2Fdiag%2Ftools%2Fjvmti_extensions.html">http://publib.boulder.ibm.com/infocenter/realtime/v2r0/index.jsp?topic=%2Fcom.ibm.softrt.doc%2Fdiag%2Ftools%2Fjvmti_extensions.html</a>
</li>

<li>ClojureScript One: Index<br />
<a href="http://clojurescriptone.com/index.html">http://clojurescriptone.com/index.html</a>
</li>

<li>ClojureScript One: Documentation<br />
<a href="http://clojurescriptone.com/documentation.html">http://clojurescriptone.com/documentation.html</a>
</li>

<li>ClojureScript One: Wiki<br />
<a href="https://github.com/brentonashworth/one/wiki">https://github.com/brentonashworth/one/wiki</a>
</li>

<li>ClojureScript: Quick Start<br />
<a href="https://github.com/clojure/clojurescript/wiki/Quick-Start">https://github.com/clojure/clojurescript/wiki/Quick-Start</a>
</li>

<li>Getting Started with ClojureScript (and FW/1)<br />
<a href="http://corfield.org/entry/getting-started-with-clojurescript-and-fw-1">http://corfield.org/entry/getting-started-with-clojurescript-and-fw-1</a>
</li>

<li>First ClojureScript experiences: using Raphaël<br />
<a href="http://maurits.wordpress.com/2012/02/13/first-clojurescript-experiences-using-raphael/">http://maurits.wordpress.com/2012/02/13/first-clojurescript-experiences-using-raphael/</a>
</li>

<li>Raphaël-JavaScript Library<br />
<a href="http://raphaeljs.com/">http://raphaeljs.com/</a>
</li>

<li>A detailed installation Guide for VimClojure 2.2<br />
<a href="http://www.duenas.at/new_homepage/vimclojure">http://www.duenas.at/new_homepage/vimclojure</a>
</li>

<li>VimClojure : A filetype, syntax and indent plugin for Clojure<br />
<a href="http://www.vim.org/scripts/script.php?script_id=2501">http://www.vim.org/scripts/script.php?script_id=2501</a>
</li>

<li>Nailgun server<br />
<a href="http://www.martiansoftware.com/nailgun/background.html">http://www.martiansoftware.com/nailgun/background.html</a>
</li>

<li>SLIME (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/SLIME">http://en.wikipedia.org/wiki/SLIME</a>
</li>

<li>slime.vim<br />
<a href="http://s3.amazonaws.com/mps/slime.vim">http://s3.amazonaws.com/mps/slime.vim</a>
</li>

<li>Textový editor Vim jako IDE: 1. èást<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide/</a>
</li>

<li>Textový editor Vim jako IDE: 2. èást<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-2-cast/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-2-cast/</a>
</li>

<li>Textový editor Vim jako IDE: 3. èást (omni completion)<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-3-cast/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-3-cast/</a>
</li>

<li>Textový editor Vim jako IDE: 4. èást<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-4-cast/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-4-cast/</a>
</li>

<li>Textový editor Vim jako IDE: 5. èást<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-5-cast/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-5-cast/</a>
</li>

<li>Textový editor Vim jako IDE: 6. èást &ndash; Vim Script<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-6-cast-vim-script/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-6-cast-vim-script/</a>
</li>

<li>Textový editor Vim jako IDE: 7. èást &ndash; Vim Script<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-7-cast-vim-script/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-7-cast-vim-script/</a>
</li>

<li>Textový editor Vim jako IDE: 8. èást<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-8-cast/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-8-cast/</a>
</li>

<li>Textový editor Vim jako IDE: 9. èást &ndash; pluginy Netrw a snipMate<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-9-cast-pluginy-netrw-a-snipmate/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-9-cast-pluginy-netrw-a-snipmate/</a>
</li>

<li>Textový editor Vim jako IDE: 10. èást &ndash; rùzné tipy a triky<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-10-cast-ruzne-tipy-a-triky/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-10-cast-ruzne-tipy-a-triky/</a>
</li>

<li>Pøenos textù mezi Vimem a dal¹ími aplikacemi<br />
<a href="http://www.root.cz/clanky/prenos-textu-mezi-vimem-a-dalsimi-aplikacemi/">http://www.root.cz/clanky/prenos-textu-mezi-vimem-a-dalsimi-aplikacemi/</a>
</li>

<li>Textový editor Vim: konfigurace pravítka a stavového øádku<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-12-cast-konfigurace-pravitka-a-stavoveho-radku/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-12-cast-konfigurace-pravitka-a-stavoveho-radku/</a>
</li>

<li>Textový editor Vim: automatické formátování textù<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-14-cast-automaticke-formatovani-textu/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-14-cast-automaticke-formatovani-textu/</a>
</li>

<li>Textový editor Vim: automatické formátování textù<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-automaticke-formatovani-textu-dokonceni/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-automaticke-formatovani-textu-dokonceni/</a>
</li>

<li>Textový editor Vim: editace XML a HTML<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-15-cast-editace-xml-a-html/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-15-cast-editace-xml-a-html/</a>
</li>

<li>Textový editor Vim: kooperace mezi Vimem a skripty<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-16-cast-kooperace-mezi-vimem-a-skriptovacimi-jazyky/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-16-cast-kooperace-mezi-vimem-a-skriptovacimi-jazyky/</a>
</li>

<li>Textový editor Vim: kooperace mezi Vimem a jazykem Perl<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-17-cast-kooperace-mezi-vimem-a-jazykem-perl/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-17-cast-kooperace-mezi-vimem-a-jazykem-perl/</a>
</li>

<li>Textový editor Vim: konfigurace a pøeklad Vimu<br />
<a href="http://www.root.cz/clanky/textovy-editor-vim-jako-ide-18-cast-konfigurace-a-preklad-vimu/">http://www.root.cz/clanky/textovy-editor-vim-jako-ide-18-cast-konfigurace-a-preklad-vimu/</a>
</li>

<li>Counterclockwise<br />
<a href="http://code.google.com/p/counterclockwise/">http://code.google.com/p/counterclockwise/</a>
</li>

<li>Clojure IDEs - The Grand Tour<br />
<a href="http://www.bestinclass.dk/index.clj/2010/03/clojure-ides-the-grand-tour-getting-started.html">http://www.bestinclass.dk/index.clj/2010/03/clojure-ides-the-grand-tour-getting-started.html</a>
</li>

<li>Light Table - a new IDE concept<br />
<a href="http://www.chris-granger.com/2012/04/12/light-table---a-new-ide-concept/">http://www.chris-granger.com/2012/04/12/light-table---a-new-ide-concept/</a>
</li>

<li>SICP (The Structure and Interpretation of Computer Programs)<br />
<a href="http://mitpress.mit.edu/sicp/">http://mitpress.mit.edu/sicp/</a>
</li>

<li>Pure function<br />
<a href="http://en.wikipedia.org/wiki/Pure_function">http://en.wikipedia.org/wiki/Pure_function</a>
</li>

<li>Funkcionální programování<br />
<a href="http://cs.wikipedia.org/wiki/Funkcionální_programování">http://cs.wikipedia.org/wiki/Funkcionální_programování</a>
</li>

<li>Èistì funkcionální (datové struktury, jazyky, programování)<br />
<a href="http://cs.wikipedia.org/wiki/Èistì_funkcionální">http://cs.wikipedia.org/wiki/Èistì_funkcionální</a>
</li>

<li>Clojure Macro Tutorial (Part I, Getting the Compiler to Write Your Code For You)<br />
<a href="http://www.learningclojure.com/2010/09/clojure-macro-tutorial-part-i-getting.html">http://www.learningclojure.com/2010/09/clojure-macro-tutorial-part-i-getting.html</a>
</li>

<li>Clojure Macro Tutorial (Part II: The Compiler Strikes Back)<br />
<a href="http://www.learningclojure.com/2010/09/clojure-macro-tutorial-part-ii-compiler.html">http://www.learningclojure.com/2010/09/clojure-macro-tutorial-part-ii-compiler.html</a>
</li>

<li>Clojure Macro Tutorial (Part III: Syntax Quote)<br />
<a href="http://www.learningclojure.com/2010/09/clojure-macro-tutorial-part-ii-syntax.html">http://www.learningclojure.com/2010/09/clojure-macro-tutorial-part-ii-syntax.html</a>
</li>

<li>Tech behind Tech: Clojure Macros Simplified<br />
<a href="http://techbehindtech.com/2010/09/28/clojure-macros-simplified/">http://techbehindtech.com/2010/09/28/clojure-macros-simplified/</a>
</li>

<li>Fatvat - Exploring functional programming: Clojure Macros<br />
<a href="http://www.fatvat.co.uk/2009/02/clojure-macros.html">http://www.fatvat.co.uk/2009/02/clojure-macros.html</a>
</li>

<li>Eulerovo èíslo<br />
<a href="http://cs.wikipedia.org/wiki/Eulerovo_èíslo">http://cs.wikipedia.org/wiki/Eulerovo_èíslo</a>
</li>

<li>List comprehension<br />
<a href="http://en.wikipedia.org/wiki/List_comprehension">http://en.wikipedia.org/wiki/List_comprehension</a>
</li>

<li>List Comprehensions in Clojure<br />
<a href="http://asymmetrical-view.com/2008/11/18/list-comprehensions-in-clojure.html">http://asymmetrical-view.com/2008/11/18/list-comprehensions-in-clojure.html</a>
</li>

<li>Clojure Programming Concepts: List Comprehension<br />
<a href="http://en.wikibooks.org/wiki/Clojure_Programming/Concepts#List_Comprehension">http://en.wikibooks.org/wiki/Clojure_Programming/Concepts#List_Comprehension</a>
</li>

<li>Clojure core API: for macro<br />
<a href="http://clojure.github.com/clojure/clojure.core-api.html#clojure.core/for">http://clojure.github.com/clojure/clojure.core-api.html#clojure.core/for</a>
</li>

<li>cirrus machina - The Clojure for macro<br />
<a href="http://www.cirrusmachina.com/blog/comment/the-clojure-for-macro/">http://www.cirrusmachina.com/blog/comment/the-clojure-for-macro/</a>
</li>

<li>Clojure.org: Clojure home page<br />
<a href="http://clojure.org/downloads">http://clojure.org/downloads</a>
</li>

<li>Clojure.org: Vars and the Global Environment<br />
<a href="http://clojure.org/Vars">http://clojure.org/Vars</a>
</li>

<li>Clojure.org: Refs and Transactions<br />
<a href="http://clojure.org/Refs">http://clojure.org/Refs</a>
</li>

<li>Clojure.org: Atoms<br />
<a href="http://clojure.org/Atoms">http://clojure.org/Atoms</a>
</li>

<li>Clojure.org: Agents as Asynchronous Actions<br />
<a href="http://clojure.org/agents">http://clojure.org/agents</a>
</li>

<li>A Couple of Clojure Agent Examples<br />
<a href="http://lethain.com/a-couple-of-clojure-agent-examples/">http://lethain.com/a-couple-of-clojure-agent-examples/</a>
</li>

<li>Clojure - Functional Programming for the JVM<br />
<a href="http://java.ociweb.com/mark/clojure/article.html">http://java.ociweb.com/mark/clojure/article.html</a>
</li>

<li>Clojure quick reference<br />
<a href="http://faustus.webatu.com/clj-quick-ref.html">http://faustus.webatu.com/clj-quick-ref.html</a>
</li>

<li>4Clojure<br />
<a href="http://www.4clojure.com/">http://www.4clojure.com/</a>
</li>

<li>ClojureDoc<br />
<a href="http://clojuredocs.org/">http://clojuredocs.org/</a>
</li>

<li>Clojure (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/Clojure">http://en.wikipedia.org/wiki/Clojure</a>
</li>

<li>Clojure (Wikipedia CS)<br />
<a href="http://cs.wikipedia.org/wiki/Clojure">http://cs.wikipedia.org/wiki/Clojure</a>
</li>

<li>Riastradh's Lisp Style Rules<br />
<a href="http://mumble.net/~campbell/scheme/style.txt">http://mumble.net/~campbell/scheme/style.txt</a>
</li>

<li>Dynamic Languages Strike Back<br />
<a href="http://steve-yegge.blogspot.cz/2008/05/dynamic-languages-strike-back.html">http://steve-yegge.blogspot.cz/2008/05/dynamic-languages-strike-back.html</a>
</li>

<li>Scripting: Higher Level Programming for the 21st Century<br />
<a href="http://www.tcl.tk/doc/scripting.html">http://www.tcl.tk/doc/scripting.html</a>
</li>

<li>Java Virtual Machine Support for Non-Java Languages<br />
<a href="http://docs.oracle.com/javase/7/docs/technotes/guides/vm/multiple-language-support.html">http://docs.oracle.com/javase/7/docs/technotes/guides/vm/multiple-language-support.html</a>
</li>

<li>New JDK 7 Feature: Support for Dynamically Typed Languages in the Java Virtual Machine<br />
<a href="http://java.sun.com/developer/technicalArticles/DynTypeLang/">http://java.sun.com/developer/technicalArticles/DynTypeLang/</a>
</li>

<li>JSR 223: Scripting for the Java<sup>TM</sup> Platform<br />
<a href="http://jcp.org/en/jsr/detail?id=223">http://jcp.org/en/jsr/detail?id=223</a>
</li>

<li>JSR 292: Supporting Dynamically Typed Languages on the Java<sup>TM</sup> Platform<br />
<a href="http://jcp.org/en/jsr/detail?id=292">http://jcp.org/en/jsr/detail?id=292</a>
</li>

<li>Java 7: A complete invokedynamic example<br />
<a href="http://niklasschlimm.blogspot.com/2012/02/java-7-complete-invokedynamic-example.html">http://niklasschlimm.blogspot.com/2012/02/java-7-complete-invokedynamic-example.html</a>
</li>

<li>InvokeDynamic: Actually Useful?<br />
<a href="http://blog.headius.com/2007/01/invokedynamic-actually-useful.html">http://blog.headius.com/2007/01/invokedynamic-actually-useful.html</a>
</li>

<li>A First Taste of InvokeDynamic<br />
<a href="http://blog.headius.com/2008/09/first-taste-of-invokedynamic.html">http://blog.headius.com/2008/09/first-taste-of-invokedynamic.html</a>
</li>

<li>Java 6 try/finally compilation without jsr/ret<br />
<a href="http://cliffhacks.blogspot.com/2008/02/java-6-tryfinally-compilation-without.html">http://cliffhacks.blogspot.com/2008/02/java-6-tryfinally-compilation-without.html</a>
</li>

<li>An empirical study of Java bytecode programs<br />
<a href="http://www.mendeley.com/research/an-empirical-study-of-java-bytecode-programs/">http://www.mendeley.com/research/an-empirical-study-of-java-bytecode-programs/</a>
</li>

<li>Java quick guide: JVM Instruction Set (tabulka v¹ech instrukcí JVM)<br />
<a href="http://www.mobilefish.com/tutorials/java/java_quickguide_jvm_instruction_set.html">http://www.mobilefish.com/tutorials/java/java_quickguide_jvm_instruction_set.html</a>
</li>

<li>The JVM Instruction Set<br />
<a href="http://mpdeboer.home.xs4all.nl/scriptie/node14.html">http://mpdeboer.home.xs4all.nl/scriptie/node14.html</a>
</li>

<li>Control Flow in the Java Virtual Machine<br />
<a href="http://www.artima.com/underthehood/flowP.html">http://www.artima.com/underthehood/flowP.html</a>
</li>

<li>Root.cz: Vyu¾ití komprimovaných ukazatelù na objekty v&nbsp;JVM<br />
<a href="http://www.root.cz/clanky/vyuziti-komprimovanych-ukazatelu-na-objekty-v-nbsp-jvm/">http://www.root.cz/clanky/vyuziti-komprimovanych-ukazatelu-na-objekty-v-nbsp-jvm/</a></a>
</li>

<li>Root.cz: JamVM aneb alternativa k HotSpotu nejenom pro embedded zaøízení a chytré telefony<br />
<a href="http://www.root.cz/clanky/jamvm-aneb-alternativa-k-hotspotu-nejenom-pro-embedded-zarizeni-tablety-a-chytre-telefony/">http://www.root.cz/clanky/jamvm-aneb-alternativa-k-hotspotu-nejenom-pro-embedded-zarizeni-tablety-a-chytre-telefony/</a>
</li>

<li>The Java<sup>TM</sup> Virtual Machine Specification, Second Edition<br />
<a href="http://java.sun.com/docs/books/jvms/second_edition/html/VMSpecTOC.doc.html">http://java.sun.com/docs/books/jvms/second_edition/html/VMSpecTOC.doc.html</a>
</li>

<li>The class File Format<br />
<a href="http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html">http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html</a>
</li>

<li>javap - The Java Class File Disassembler<br />
<a href="http://docs.oracle.com/javase/1.4.2/docs/tooldocs/windows/javap.html">http://docs.oracle.com/javase/1.4.2/docs/tooldocs/windows/javap.html</a>
</li>

<li>javap-java-1.6.0-openjdk(1) - Linux man page<br />
<a href="http://linux.die.net/man/1/javap-java-1.6.0-openjdk">http://linux.die.net/man/1/javap-java-1.6.0-openjdk</a>
</li>

<li>Using javap<br />
<a href="http://www.idevelopment.info/data/Programming/java/miscellaneous_java/Using_javap.html">http://www.idevelopment.info/data/Programming/java/miscellaneous_java/Using_javap.html</a>
</li>

<li>Examine class files with the javap command<br />
<a href="http://www.techrepublic.com/article/examine-class-files-with-the-javap-command/5815354">http://www.techrepublic.com/article/examine-class-files-with-the-javap-command/5815354</a>
</li>

<li>BCEL Home page<br />
<a href="http://commons.apache.org/bcel/">http://commons.apache.org/bcel/</a>
</li>

<li>BCEL Manual<br />
<a href="http://commons.apache.org/bcel/manual.html">http://commons.apache.org/bcel/manual.html</a>
</li>

<li>Byte Code Engineering Library (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/BCEL">http://en.wikipedia.org/wiki/BCEL</a>
</li>

<li>Java programming dynamics, Part 7: Bytecode engineering with BCEL<br />
<a href="http://www.ibm.com/developerworks/java/library/j-dyn0414/">http://www.ibm.com/developerworks/java/library/j-dyn0414/</a>
</li>

<li>Bytecode Engineering<br />
<a href="http://book.chinaunix.net/special/ebook/Core_Java2_Volume2AF/0131118269/ch13lev1sec6.html">http://book.chinaunix.net/special/ebook/Core_Java2_Volume2AF/0131118269/ch13lev1sec6.html</a>
</li>

<li>BCEL Tutorial<br />
<a href="http://www.smfsupport.com/support/java/bcel-tutorial!/">http://www.smfsupport.com/support/java/bcel-tutorial!/</a>
</li>

<li>ASM Home page<br />
<a href="http://asm.ow2.org/">http://asm.ow2.org/</a>
</li>

<li>Seznam nástrojù vyu¾ívajících projekt ASM<br />
<a href="http://asm.ow2.org/users.html">http://asm.ow2.org/users.html</a>
</li>

<li>ObjectWeb ASM (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/ObjectWeb_ASM">http://en.wikipedia.org/wiki/ObjectWeb_ASM</a>
</li>

<li>Java Bytecode BCEL vs ASM<br />
<a href="http://james.onegoodcookie.com/2005/10/26/java-bytecode-bcel-vs-asm/">http://james.onegoodcookie.com/2005/10/26/java-bytecode-bcel-vs-asm/</a>
</li>

<li>Bytecode Outline plugin for Eclipse (screenshoty + info)<br />
<a href="http://asm.ow2.org/eclipse/index.html">http://asm.ow2.org/eclipse/index.html</a>
</li>

<li>aspectj (Eclipse)<br />
<a href="http://www.eclipse.org/aspectj/">http://www.eclipse.org/aspectj/</a>
</li>

<li>Aspect-oriented programming (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Aspect_oriented_programming">http://en.wikipedia.org/wiki/Aspect_oriented_programming</a>
</li>

<li>AspectJ (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/AspectJ">http://en.wikipedia.org/wiki/AspectJ</a>
</li>

<li>EMMA: a free Java code coverage tool<br />
<a href="http://emma.sourceforge.net/">http://emma.sourceforge.net/</a>
</li>

<li>Cobertura<br />
<a href="http://cobertura.sourceforge.net/">http://cobertura.sourceforge.net/</a>
</li>

<li>FindBugs<br />
<a href="http://findbugs.sourceforge.net/">http://findbugs.sourceforge.net/</a>
</li>

<li>GNU Classpath<br />
<a href="www.gnu.org/s/classpath/">www.gnu.org/s/classpath/</a></li>

<li>Java VMs Compared<br />
<a href="http://bugblogger.com/java-vms-compared-160/">http://bugblogger.com/java-vms-compared-160/</a>
</li>

<li>JSRs: Java Specification Requests &ndash; JSR 223: Scripting for the Java Platform<br />
<a href="http://www.jcp.org/en/jsr/detail?id=223">http://www.jcp.org/en/jsr/detail?id=223</a>
</li>

<li>Scripting for the Java Platform<br />
<a href="http://java.sun.com/developer/technicalArticles/J2SE/Desktop/scripting/">http://java.sun.com/developer/technicalArticles/J2SE/Desktop/scripting/</a>
</li>

<li>Scripting for the Java Platform (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Scripting_for_the_Java_Platform">http://en.wikipedia.org/wiki/Scripting_for_the_Java_Platform</a>
</li>

<li>Java Community Process<br />
<a href="http://en.wikipedia.org/wiki/Java_Specification_Request">http://en.wikipedia.org/wiki/Java_Specification_Request</a>
</li>

<li>Java HotSpot VM Options<br />
<a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html">http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html</a>
</li>

<li>Great Computer Language Shootout<br />
<a href="http://c2.com/cgi/wiki?GreatComputerLanguageShootout">http://c2.com/cgi/wiki?GreatComputerLanguageShootout</a>
</li>

<li>Java performance<br />
<a href="http://en.wikipedia.org/wiki/Java_performance">http://en.wikipedia.org/wiki/Java_performance</a>
</li>

<li>Trying the prototype<br />
<a href="http://mail.openjdk.java.net/pipermail/lambda-dev/2010-August/002179.html">http://mail.openjdk.java.net/pipermail/lambda-dev/2010-August/002179.html</a>
</li>

<li>Better closures (for Java)<br />
<a href="http://blogs.sun.com/jrose/entry/better_closures">http://blogs.sun.com/jrose/entry/better_closures</a>
</li>

<li>Lambdas in Java: An In-Depth Analysis<br />
<a href="http://www.infoq.com/articles/lambdas-java-analysis">http://www.infoq.com/articles/lambdas-java-analysis</a>
</li>

<li>Class ReflectiveOperationException<br />
<a href="http://download.java.net/jdk7/docs/api/java/lang/ReflectiveOperationException.html">http://download.java.net/jdk7/docs/api/java/lang/ReflectiveOperationException.html</a>
</li>

<li>Scala Programming Language<br />
<a href="http://www.scala-lang.org/">http://www.scala-lang.org/</a>
</li>

<li>Run Scala in Apache Tomcat in 10 minutes<br />
<a href="http://www.softwaresecretweapons.com/jspwiki/run-scala-in-apache-tomcat-in-10-minutes">http://www.softwaresecretweapons.com/jspwiki/run-scala-in-apache-tomcat-in-10-minutes</a>
</li>

<li>Fast Web Development With Scala<br />
<a href="http://chasethedevil.blogspot.cz/2007/09/fast-web-development-with-scala.html">http://chasethedevil.blogspot.cz/2007/09/fast-web-development-with-scala.html</a>
</li>

<li>Top five scripting languages on the JVM<br />
<a href="http://www.infoworld.com/d/developer-world/top-five-scripting-languages-the-jvm-855">http://www.infoworld.com/d/developer-world/top-five-scripting-languages-the-jvm-855</a>
</li>

<li>Proposal: Indexing access syntax for Lists and Maps<br />
<a href="http://mail.openjdk.java.net/pipermail/coin-dev/2009-March/001108.html">http://mail.openjdk.java.net/pipermail/coin-dev/2009-March/001108.html</a>
</li>

<li>Proposal: Elvis and Other Null-Safe Operators<br />
<a href="http://mail.openjdk.java.net/pipermail/coin-dev/2009-March/000047.html">http://mail.openjdk.java.net/pipermail/coin-dev/2009-March/000047.html</a>
</li>

<li>Java 7 : Oracle pushes a first version of closures<br />
<a href="http://www.baptiste-wicht.com/2010/05/oracle-pushes-a-first-version-of-closures/">http://www.baptiste-wicht.com/2010/05/oracle-pushes-a-first-version-of-closures/</a>
</li>

<li>Groovy: An agile dynamic language for the Java Platform<br />
<a href="http://groovy.codehaus.org/Operators">http://groovy.codehaus.org/Operators</a>
</li>

<li>Better Strategies for Null Handling in Java<br />
<a href="http://www.slideshare.net/Stephan.Schmidt/better-strategies-for-null-handling-in-java">http://www.slideshare.net/Stephan.Schmidt/better-strategies-for-null-handling-in-java</a>
</li>

<li>Control Flow in the Java Virtual Machine<br />
<a href="http://www.artima.com/underthehood/flowP.html">http://www.artima.com/underthehood/flowP.html</a>
</li>

<li>Java Virtual Machine<br />
<a href="http://en.wikipedia.org/wiki/Java_virtual_machine">http://en.wikipedia.org/wiki/Java_virtual_machine</a>
</li>

<li>==, .equals(), compareTo(), and compare()<br />
<a href="http://leepoint.net/notes-java/data/expressions/22compareobjects.html">http://leepoint.net/notes-java/data/expressions/22compareobjects.html</a>
</li>

<li>New JDK7 features<br />
<a href="http://openjdk.java.net/projects/jdk7/features/">http://openjdk.java.net/projects/jdk7/features/</a>
</li>

<li>Project Coin: Bringing it to a Close(able)<br />
<a href="http://blogs.sun.com/darcy/entry/project_coin_bring_close">http://blogs.sun.com/darcy/entry/project_coin_bring_close</a>
</li>

<li>CloseableFinder source code<br />
<a href="http://blogs.sun.com/darcy/resource/ProjectCoin/CloseableFinder.java">http://blogs.sun.com/darcy/resource/ProjectCoin/CloseableFinder.java</a>
</li>

<li>Joe Darcy blog about JDK<br />
<a href="http://blogs.sun.com/darcy">http://blogs.sun.com/darcy</a>
</li>

<li>Java 7 - more dynamics<br />
<a href="http://www.baptiste-wicht.com/2010/04/java-7-more-dynamics/">http://www.baptiste-wicht.com/2010/04/java-7-more-dynamics/</a>
</li>

<li>New JDK 7 Feature: Support for Dynamically Typed Languages in the Java Virtual Machine<br />
<a href="http://java.sun.com/developer/technicalArticles/DynTypeLang/index.html">http://java.sun.com/developer/technicalArticles/DynTypeLang/index.html</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2012</small></p>
</body>
</html>

