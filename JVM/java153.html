<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>LuaJIT - Just in Time pøekladaè pro programovací jazyk Lua (5 - tabulky a pole)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>LuaJIT - Just in Time pøekladaè pro programovací jazyk Lua (5 - tabulky a pole)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V páté èásti èlánku o Just in Time pøekladaèi nazvaném LuaJIT se budeme zabývat zpùsobem pøekladu programù pracujících s tabulkami. Uká¾eme se zpùsob tvorby jednorozmìrných i dvourozmìrných tabulek a takté¾ pøístup k prvkùm tabulek, a to jak s vyu¾itím celoèíselných indexù, tak i s pou¾itím klíèù.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. LuaJIT - Just in Time pøekladaè pro programovací jazyk Lua (5 - tabulky a pole)</a></p>
<p><a href="#k02">2. Demonstraèní pøíklad <strong>test24.lua</strong> &ndash; vytvoøení prázdné tabulky, zji¹tìní poètu prvkù tabulky, pøístup k&nbsp;prvkùm tabulky</a></p>
<p><a href="#k021">&nbsp;&nbsp;2.1 Zdrojový kód pøíkladu <strong>test24.lua</strong></a></p>
<p><a href="#k022">&nbsp;&nbsp;2.2 Pøeklad pøíkladu <strong>test24.lua</strong> do mezijazyka LuaJITu</a></p>
<p><a href="#k03">3. Demonstraèní pøíklad <strong>test25.lua</strong> &ndash; vytvoøení a inicializace neprázdné tabulky</a></p>
<p><a href="#k031">&nbsp;&nbsp;3.1 Zdrojový kód pøíkladu <strong>test25.lua</strong></a></p>
<p><a href="#k032">&nbsp;&nbsp;3.2 Pøeklad pøíkladu <strong>test25.lua</strong> do mezijazyka LuaJITu</a></p>
<p><a href="#k04">4. Demonstraèní pøíklad <strong>test26.lua</strong> &ndash; pøidání prvkù do tabulky s&nbsp;vyu¾itím (konstantních) indexù</a></p>
<p><a href="#k041">&nbsp;&nbsp;4.1 Zdrojový kód pøíkladu <strong>test26.lua</strong></a></p>
<p><a href="#k042">&nbsp;&nbsp;4.2 Pøeklad pøíkladu <strong>test26.lua</strong> do mezijazyka LuaJITu</a></p>
<p><a href="#k05">5. Demonstraèní pøíklad <strong>test27.lua</strong> &ndash; pøidání prvkù do tabulky s&nbsp;vyu¾itím (konstantních) klíèù</a></p>
<p><a href="#k051">&nbsp;&nbsp;5.1 Zdrojový kód pøíkladu <strong>test27.lua</strong></a></p>
<p><a href="#k052">&nbsp;&nbsp;5.2 Pøeklad pøíkladu <strong>test27.lua</strong> do mezijazyka LuaJITu</a></p>
<p><a href="#k06">6. Demonstraèní pøíklad <strong>test28.lua</strong> &ndash; pøidání prvkù do tabulky s&nbsp;vyu¾itím promìnných namísto konstantních indexù èi klíèù</a></p>
<p><a href="#k061">&nbsp;&nbsp;6.1 Zdrojový kód pøíkladu <strong>test28.lua</strong></a></p>
<p><a href="#k062">&nbsp;&nbsp;6.2 Pøeklad pøíkladu <strong>test28.lua</strong> do mezijazyka LuaJITu</a></p>
<p><a href="#k07">7. Demonstraèní pøíklad <strong>test29.lua</strong> &ndash; práce s&nbsp;dvourozmìrnými tabulkami (maticemi)</a></p>
<p><a href="#k071">&nbsp;&nbsp;7.1 Zdrojový kód pøíkladu <strong>test29.lua</strong></a></p>
<p><a href="#k072">&nbsp;&nbsp;7.2 Pøeklad pøíkladu <strong>test29.lua</strong> do mezijazyka LuaJITu</a></p>
<p><a href="#k08">8. Repositáø se zdrojovými kódy v¹ech ¹esti dne¹ních demonstraèních pøíkladù</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. LuaJIT - Just in Time pøekladaè pro programovací jazyk Lua (5 - tabulky a pole)</h2>

<p>V&nbsp;programovacím jazyce <i>Lua</i> jsou nejdùle¾itìj¹ím strukturovaným
datovým typem tabulky (<i>table</i>). Tento datový typ lze pou¾ít jak pro
implementaci pole (<i>array</i>) s&nbsp;prvky adresovanými s&nbsp;vyu¾itím
celoèíselných indexù, tak i pro implementaci asociativního pole, kdy jsou
namísto celoèíselných indexù pou¾ity klíèe, které jsou typicky reprezentovány
øetìzci (není to v¹ak nutné). V&nbsp;jazyku <i>Lua</i> je interní struktura
tabulek implementována takovým zpùsobem, aby byla práce s&nbsp;tabulkami
efektivní jak pøi pou¾ití celoèíselných indexù, tak i pøi pou¾ití klíèù. Není
tedy divu, ¾e jsou tabulky pou¾ity v&nbsp;prakticky v¹ech aplikacích a navíc i
samotná <i>Lua</i> tabulky internì pomìrnì èasto vyu¾ívá &ndash; pøíkladem mù¾e
být napøíklad známá globální tabulka <strong>_G</strong>. Potøeba práce
s&nbsp;tabulkami je samozøejmì reflektována i v&nbsp;mezijazyku (IR) LuaJITu.
V¹echny instrukce, které nìjakým zpùsobem s&nbsp;tabulkami pracují, lze
rozdìlit do ètyø skupin:</p>

<table>
<tr><th>#</th><th>Funkce</th><th>Seznam instrukcí</th></tr>
<tr><td>1</td><td>vytvoøení nové tabulky           </td><td>TNEW, TDUP</td></tr>
<tr><td>2</td><td>práce s&nbsp;globální tabulkou _G</td><td>GGET, GSET</td></tr>
<tr><td>3</td><td>ètení prvkù z&nbsp;tabulky       </td><td>TGETV, TGETS, TGETB</td></tr>
<tr><td>4</td><td>zápis prvku do tabulky           </td><td>TSETV, TSETS, TSETB, TSETM</td></tr>
</table>

<p>V&nbsp;tabulce zobrazené pod tímto odstavcem jsou v¹echny základní instrukce
IR, které se týkají práce s&nbsp;tabulkami, vypsány spoleènì
s&nbsp;podrobnìj¹ím popisem i s&nbsp;pou¾itými operandy:</p>

<table>
<tr><th>#</th><th>Instrukce</th><th>Operandy (A,B,C/D)</th><th>Popis</th></tr>
<tr><td> 1</td><td>TNEW</td><td>dst, lit</td><td>vytvoøení nové tabulky o velikosti specifikované v D (lit), reference na vytvoøenou tabulku se ulo¾í do A (dst)</td></tr>
<tr><td> 2</td><td>TDUP</td><td>dst, tab</td><td>vytvoøení nové tabulky na základì ¹ablony specifikované v D (tab), reference na vytvoøenou tabulku se ulo¾í do A (dst)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 3</td><td>GGET</td><td>dst, str</td><td>pøeètení prvku z globální tabulky _G, v D (str) je ulo¾en klíè (øetìzec)</td></tr>
<tr><td> 4</td><td>GSET</td><td>var, str</td><td>zápis prvku do globální tabulky _G, v D (str) je ulo¾en klíè (øetìzec)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 5</td><td>TGETV</td><td>dst, var, var</td><td>ètení prvku z tabulky specifikované v B, klíè je ulo¾en v promìnné</td></tr>
<tr><td> 6</td><td>TGETS</td><td>dst, var, str</td><td>ètení prvku z tabulky specifikované v B, klíèem je øetìzec</td></tr>
<tr><td> 7</td><td>TGETB</td><td>dst, var, lit</td><td>ètení prvku z tabulky specifikované v B, klíèem je literál (konstanta, typicky celé èíslo)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 8</td><td>TSETV</td><td>var, var, var</td><td>zápis prvku do tabulky specifikované v B, klíè je ulo¾en v promìnné</td></tr>
<tr><td> 9</td><td>TSETS</td><td>var, var, str</td><td>zápis prvku do tabulky specifikované v B, klíèem je øetìzec</td></tr>
<tr><td>10</td><td>TSETB</td><td>var, var, lit</td><td>zápis prvku do tabulky specifikované v B, klíèem je literál (konstanta, typicky celé èíslo)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>11</td><td>TSETM</td><td>base, num*</td><td>nastavení vìt¹ího mno¾ství prvkù dle vztahu: (A-1)[D], (A-1)[D+1], ... = A, A+1, ...</td></tr>
</table>

<p>S&nbsp;instrukcemi <strong>GGET</strong> a <strong>GSET</strong> jsme se ji¾
v&nbsp;nìkolika demonstraèních pøíkladech setkali, proto¾e se s&nbsp;vyu¾itím
tìchto instrukcí mj.&nbsp;pracuje i s&nbsp;&bdquo;globálními&ldquo; funkcemi,
tj.&nbsp;funkcemi, které nejsou anonymní a nejsou ulo¾eny do u¾ivatelsky
definované tabulky. Vìt¹inu dal¹ích instrukcí s&nbsp;výjimkou ponìkud speciální
instrukce <strong>TSETM</strong> si popí¹eme v&nbsp;navazujících
kapitolách.</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Demonstraèní pøíklad <strong>test24.lua</strong> &ndash; vytvoøení prázdné tabulky, zji¹tìní poètu prvkù tabulky, pøístup k&nbsp;prvkùm tabulky</h2>

<p>V&nbsp;dne¹ním prvním demonstraèním pøíkladu nazvaném
<strong>test24.lua</strong> jsou ukázány ètyøi základní jazykové konstrukce
podporované programovacím jazykem <i>Lua</i>, které se pou¾ívají pøi práci
s&nbsp;tabulkami. Jedná se o konstrukci pro vytvoøení prázdné tabulky
(jednorozmìrného pole &ndash; vektoru), dále o tisk informace o celé tabulce
(vytiskne se hodnota reference), tisk poètu prvkù v&nbsp;tabulce (platí jen pro
klasická pole, nikoli pro asociativní pole) a samozøejmì té¾ i o konstrukci
slou¾ící pro získání hodnoty konkrétního prvku v&nbsp;tabulce na základì jeho
indexu. Pøipomeòme si, ¾e v&nbsp;<i>Lue</i> se prvky èíslují od jednièky a
nikoli od nuly:</p>



<p><a name="k021"></a></p>
<h3 id="k021">2.1 Zdrojový kód pøíkladu <strong>test24.lua</strong></h3>

<pre>
<i>--</i>
<i>-- LuaJIT: demonstraèní pøíklad èíslo 24</i>
<i>--</i>
<i>-- Práce s tabulkami:</i>
<i>--    * vytvoøení prázdné tabulky</i>
<i>--    * tisk poctu prvku tabulky</i>
<i>--    * pøístup k prvkùm tabulky</i>
<i>--</i>
&nbsp;
&nbsp;
&nbsp;
<i>-- vytvoøení prázdné tabulky</i>
<strong>local</strong> tbl = {}
&nbsp;
<i>-- tisk informace o tabulce (reference...)</i>
print(tbl)
&nbsp;
<i>-- tisk poctu prvku v tabulce</i>
print(#tbl)
&nbsp;
<i>-- tisk hodnoty prvního prvku v tabulce</i>
print(tbl[1])
&nbsp;
<i>-- tisk hodnoty desátého prvku v tabulce</i>
print(tbl[10])
&nbsp;
&nbsp;
&nbsp;
<i>-- finito</i>
</pre>



<p><a name="k022"></a></p>
<h3 id="k022">2.2 Pøeklad pøíkladu <strong>test24.lua</strong> do mezijazyka LuaJITu</h3>

<p>Pøi pohledu na IR získaný pøekladem demonstraèního pøíkladu
<strong>test24.lua</strong> do mezijazyka LuaJITu mù¾eme získat základní
pøedstavu o tom, jak se v&nbsp;IR s&nbsp;tabulkami pracuje. Pro vytvoøení
prázdné tabulky se pou¾ívá instrukce <strong>TNEW</strong>, které se pøedají
rozmìry tabulky a index slotu, do kterého se ulo¾í reference na vytvoøenou
tabulku. Pro výpoèet poètu prvkù tabulky se pou¾ívá instrukce
<strong>LEN</strong> a pro pøeètení hodnoty konkrétního prvku ulo¾eného na
urèitém indexu lze pou¾ít instrukci <strong>TGETB</strong>. Posledním operandem
této instrukce je index èteného prvku:</p>

<pre>
<i>; Pøeklad demonstraèního pøíkladu test24.lua</i>
<i>; do IR vyu¾ívaného virtuálním strojem a JIT</i>
<i>; pøekladaèem LuaJIT.</i>
&nbsp;
-- BYTECODE -- test24.lua:0-31
&nbsp;
<i>; vytvoøení prázdné tabulky</i>
<i>; local tbl = {}</i>
0001    <strong>TNEW</strong>     0   0        <i>; vytvoøení nové prázdné tabulky</i>
&nbsp;
<i>; tisk informace o tabulce (reference...)</i>
<i>; print(tbl)</i>
0002    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0003    <strong>MOV</strong>      2   0        <i>; bude se tisknout reference na tabulku</i>
0004    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk poètu prvkù v tabulce</i>
<i>; print(#tbl)</i>
0005    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0006    <strong>LEN</strong>      2   0        <i>; získání poètu prvkù tabulky (resp. pole, které je souèástí tabulky)</i>
0007    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty prvního prvku v tabulce</i>
<i>; print(tbl[1])</i>
0008    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0009    <strong>TGETB</strong>    2   0   1    <i>; pøeètení hodnoty prvního prvku tabulky</i>
0010    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty desátého prvku v tabulce</i>
<i>; print(tbl[10])</i>
0011    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0012    <strong>TGETB</strong>    2   0  10    <i>; pøeètení hodnoty desátého prvku tabulky</i>
0013    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; ka¾dý program je automaticky ukonèen následující instrukcí</i>
0014    <strong>RET0</strong>     0   1
&nbsp;
<i>; konec</i>
</pre>



<p><a name="k03"></a></p>
<h2 id="k03">3. Demonstraèní pøíklad <strong>test25.lua</strong> &ndash; vytvoøení a inicializace neprázdné tabulky</h2>

<p>Kromì vytvoøení prázdné tabulky je mo¾né v&nbsp;programovacím jazyku
<i>Lua</i> vytvoøit novou tabulku a souèasnì provést i inicializaci jejích
prvkù. Pro tento úèel se v&nbsp;nejjednodu¹¹ím pøípadì pou¾ívá konstrukce
<strong>local tbl = {hodnota1, hodnota2, hodnota3, ...}</strong>. Vzhledem
k&nbsp;tomu, ¾e se jedná o velmi èasto pou¾ívanou jazykovou konstrukci, lze
oèekávat, ¾e bude nìjakým zpùsobem podporována i v&nbsp;IR LuaJITu, tak¾e
nezbývá, ne¾ si v¹e otestovat:</p>



<p><a name="k031"></a></p>
<h3 id="k031">3.1 Zdrojový kód pøíkladu <strong>test25.lua</strong></h3>

<pre>
<i>--</i>
<i>-- LuaJIT: demonstraèní pøíklad èíslo 25</i>
<i>--</i>
<i>-- Práce s tabulkami:</i>
<i>--    * vytvoøení a inicializace neprázdné tabulky</i>
<i>--    * tisk poctu prvku tabulky</i>
<i>--    * pøístup k prvkùm tabulky</i>
<i>--</i>
&nbsp;
&nbsp;
&nbsp;
<i>-- vytvoøení desetiprvkové tabulky</i>
<strong>local</strong> tbl = {10, 9, 8, 7, 6, 5, 4, 3, 2, 1}
&nbsp;
<i>-- tisk informace o tabulce (reference...)</i>
print(tbl)
&nbsp;
<i>-- tisk poctu prvku v tabulce</i>
print(#tbl)
&nbsp;
<i>-- tisk hodnoty prvního prvku v tabulce</i>
print(tbl[1])
&nbsp;
<i>-- tisk hodnoty desátého prvku v tabulce</i>
print(tbl[10])
&nbsp;
&nbsp;
&nbsp;
<i>-- finito</i>
</pre>



<p><a name="k032"></a></p>
<h3 id="k032">3.2 Pøeklad pøíkladu <strong>test25.lua</strong> do mezijazyka LuaJITu</h3>

<p>Pohled na IR demonstraèního pøíkladu <strong>test25.lua</strong> pøelo¾eného
do mezijazyka LuaJITu nám uká¾e, ¾e se IR prakticky nijak zásadnì neli¹í od IR
pøedchozího pøíkladu nazvaného <strong>test24.lua</strong>. Jediným rozdílem je
zde pou¾ití instrukce <strong>TDUP</strong> namísto instrukce
<strong>TNEW</strong>. Zatímco <strong>TNEW</strong> slou¾í pro vytvoøení
prázdné tabulky zadané velikosti, je <strong>TDUP</strong> internì mnohem
komplikovanìj¹í, proto¾e vytvoøí a inicializuje novou tabulku na základì zadané
¹ablony, která je ulo¾ena v&nbsp;obdobì <i>constant poolu</i>. Díky existenci
této instrukce je tedy mo¾né IR znaèným zpùsobem zkrátit, pøedev¹ím
v&nbsp;porovnání s&nbsp;nìkterými populárními bajtkódy, které mnohdy
inicializaci tabulek neøe¹í optimálním zpùsobem:</p>

<pre>
<i>; Pøeklad demonstraèního pøíkladu test25.lua</i>
<i>; do IR vyu¾ívaného virtuálním strojem a JIT</i>
<i>; pøekladaèem LuaJIT.</i>
&nbsp;
-- BYTECODE -- test25.lua:0-31
&nbsp;
<i>; vytvoøení a inicializace desetiprvkové tabulky</i>
<i>; local tbl = {10, 9, 8, 7, 6, 5, 4, 3, 2, 1}</i>
0001    <strong>TDUP</strong>     0   0        <i>; pozor - rozdíl oproti pøedchozímu pøíkladu</i>
&nbsp;
<i>; tisk informace o tabulce (reference...)</i>
<i>; print(tbl)</i>
0002    <strong>GGET</strong>     1   1        <i>; získání reference na funkci se jménem "print"</i>
0003    <strong>MOV</strong>      2   0        <i>; bude se tisknout reference na tabulku</i>
0004    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk poètu prvkù v tabulce</i>
<i>; print(#tbl)</i>
0005    <strong>GGET</strong>     1   1        <i>; získání reference na funkci se jménem "print"</i>
0006    <strong>LEN</strong>      2   0        <i>; získání poètu prvkù tabulky (resp. pole, které je souèástí tabulky)</i>
0007    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty prvního prvku v tabulce</i>
<i>; print(tbl[1])</i>
0008    <strong>GGET</strong>     1   1        <i>; získání reference na funkci se jménem "print"</i>
0009    <strong>TGETB</strong>    2   0   1    <i>; pøeètení hodnoty prvního prvku tabulky</i>
0010    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty desátého prvku v tabulce</i>
<i>; print(tbl[10])</i>
0011    <strong>GGET</strong>     1   1        <i>; získání reference na funkci se jménem "print"</i>
0012    <strong>TGETB</strong>    2   0  10    <i>; pøeètení hodnoty desátého prvku tabulky</i>
0013    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; ka¾dý program je automaticky ukonèen následující instrukcí</i>
0014    <strong>RET0</strong>     0   1
&nbsp;
<i>; konec</i>
</pre>



<p><a name="k04"></a></p>
<h2 id="k04">4. Demonstraèní pøíklad <strong>test26.lua</strong> &ndash; pøidání prvkù do tabulky s&nbsp;vyu¾itím (konstantních) indexù</h2>

<p>V&nbsp;dne¹ním tøetím demonstraèním pøíkladu si vyzkou¹íme, jakým zpùsobem
se v&nbsp;mezijazyku LuaJITu øe¹í situace, kdy je nutné zmìnit èi nastavit
hodnotu prvku ulo¾eného na urèitém indexu. Opìt se jedná o velmi èasto
pou¾ívanou jazykovou konstrukci, pøièem¾ se velmi èasto setkáme s&nbsp;pou¾itím
relativnì malých tabulek s&nbsp;indexy prvkù od jednièky do 256. A právì
k&nbsp;prvkùm takto malých tabulek lze pøistupovat velmi efektivním zpùsobem,
co¾ bude patrné z&nbsp;výpisu IR:</p>



<p><a name="k041"></a></p>
<h3 id="k041">4.1 Zdrojový kód pøíkladu <strong>test26.lua</strong></h3>

<pre>
<i>--</i>
<i>-- LuaJIT: demonstraèní pøíklad èíslo 26</i>
<i>--</i>
<i>-- Práce s tabulkami:</i>
<i>--    * vytvoøení a inicializace prázdné tabulky</i>
<i>--    * pøidání prvku do tabulky s pou¾itím indexu</i>
<i>--    * tisk poctu prvku tabulky</i>
<i>--    * pøístup k prvkùm tabulky</i>
<i>--</i>
&nbsp;
&nbsp;
&nbsp;
<i>-- vytvoøení prázdné tabulky</i>
<strong>local</strong> tbl = {}
&nbsp;
<i>-- nastavit hodnotu prvního prvku tabulky</i>
tbl[1] = 777
&nbsp;
<i>-- nastavit hodnotu druhého prvku tabulky</i>
tbl[2] = 999
&nbsp;
<i>-- nastavit hodnotu desátého prvku tabulky</i>
tbl[10] = 1000
&nbsp;
<i>-- tisk informace o tabulce (reference...)</i>
print(tbl)
&nbsp;
<i>-- tisk poctu prvku v tabulce</i>
print(#tbl)
&nbsp;
<i>-- tisk hodnoty prvního prvku v tabulce</i>
print(tbl[1])
&nbsp;
<i>-- tisk hodnoty druhého prvku v tabulce</i>
print(tbl[2])
&nbsp;
<i>-- tisk hodnoty desátého prvku v tabulce</i>
print(tbl[10])
&nbsp;
&nbsp;
&nbsp;
<i>-- finito</i>
</pre>



<p><a name="k042"></a></p>
<h3 id="k042">4.2 Pøeklad pøíkladu <strong>test26.lua</strong> do mezijazyka LuaJITu</h3>

<p>Po pøekladu demonstraèního pøíkladu <strong>test26.lua</strong> do
mezijazyka LuaJITu je patrné, jakým zpùsobem se zápis prvkù do tabulky
pøelo¾il. Mù¾eme zde vidìt dvojici instrukcí <strong>KSHORT+TSETB</strong>.
První z&nbsp;tìchto instrukcí ulo¾í celoèíselnou konstantu do vybraného slotu,
druhá instrukce tuto konstantu zapí¹e do tabulky na urèený index. Pov¹imnìte si
toho, ¾e poslední operand instrukce <strong>TSETB</strong> pøímo obsahuje index
zapisovaného prvku, druhý operand obsahuje referenci na tabulku a operand první
pak index slotu, v&nbsp;nìm¾ je ulo¾ena zapisovaná hodnota:</p>

<pre>
<i>; Pøeklad demonstraèního pøíkladu test26.lua</i>
<i>; do IR vyu¾ívaného virtuálním strojem a JIT</i>
<i>; pøekladaèem LuaJIT.</i>
&nbsp;
-- BYTECODE -- test26.lua:0-44
&nbsp;
<i>; vytvoøení prázdné tabulky</i>
<i>; local tbl = {}</i>
0001    <strong>TNEW</strong>     0   0
&nbsp;
<i>; nastavit hodnotu prvního prvku tabulky</i>
<i>; tbl[1] = 777</i>
0002    <strong>KSHORT</strong>   1 777        <i>; ukládaná konstanta</i>
0003    <strong>TSETB</strong>    1   0   1    <i>; nastavení prvního prvku tabulky</i>
&nbsp;
<i>; nastavit hodnotu druhého prvku tabulky</i>
<i>; tbl[2] = 999</i>
0004    <strong>KSHORT</strong>   1 999        <i>; ukládaná konstanta</i>
0005    <strong>TSETB</strong>    1   0   2    <i>; nastavení druhého prvku tabulky</i>
&nbsp;
<i>; nastavit hodnotu desátého prvku tabulky</i>
<i>; tbl[10] = 1000</i>
0006    <strong>KSHORT</strong>   1 1000       <i>; ukládaná konstanta</i>
0007    <strong>TSETB</strong>    1   0  10    <i>; nastavení desátého prvku tabulky</i>
&nbsp;
<i>; tisk informace o tabulce (reference...)</i>
<i>; print(tbl)</i>
0008    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0009    <strong>MOV</strong>      2   0        <i>; bude se tisknout reference na tabulku</i>
0010    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk poètu prvkù v tabulce</i>
<i>; print(#tbl)</i>
0011    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0012    <strong>LEN</strong>      2   0        <i>; získání poètu prvkù tabulky (resp. pole, které je souèástí tabulky)</i>
0013    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty prvního prvku v tabulce</i>
<i>; print(tbl[1])</i>
0014    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0015    <strong>TGETB</strong>    2   0   1    <i>; pøeètení hodnoty prvního prvku tabulky</i>
0016    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty druhého prvku v tabulce</i>
<i>; print(tbl[2])</i>
0017    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0018    <strong>TGETB</strong>    2   0   2    <i>; pøeètení hodnoty druhého prvku tabulky</i>
0019    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty desátého prvku v tabulce</i>
<i>; print(tbl[10])</i>
0020    <strong>GGET</strong>     1   0        <i>; získání reference na funkci se jménem "print"</i>
0021    <strong>TGETB</strong>    2   0  10    <i>; pøeètení hodnoty desátého prvku tabulky</i>
0022    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; ka¾dý program je automaticky ukonèen následující instrukcí</i>
0023    <strong>RET0</strong>     0   1
&nbsp;
<i>; konec</i>
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Demonstraèní pøíklad <strong>test27.lua</strong> &ndash; pøidání prvkù do tabulky s&nbsp;vyu¾itím (konstantních) klíèù</h2>

<p>Kromì celoèíselných indexù lze pro adresování ukládaných èi ètených prvkù
pou¾ít i klíèe jiného typu. Velmi èasto se v&nbsp;programovacím jazyku
<i>Lua</i> pou¾ívají klíèe typu øetìzec (<i>string</i>), tak¾e není divu, ¾e
pøímo v&nbsp;mezijazyku existují instrukce umo¾òující manipulaci s&nbsp;prvky
tabulky urèenými právì s&nbsp;vyu¾itím øetìzcù, pøesnìji øeèeno s&nbsp;vyu¾itím
øetìzcových literálù (konstant). Podívejme se na jednoduchý pøíklad:</p>



<p><a name="k051"></a></p>
<h3 id="k051">5.1 Zdrojový kód pøíkladu <strong>test27.lua</strong></h3>

<pre>
<i>--</i>
<i>-- LuaJIT: demonstraèní pøíklad èíslo 27</i>
<i>--</i>
<i>-- Práce s tabulkami:</i>
<i>--    * vytvoøení a inicializace prázdné tabulky</i>
<i>--    * pøidání prvku do tabulky s pou¾itím klíèù</i>
<i>--    * tisk poctu prvku tabulky</i>
<i>--    * pøístup k prvkùm tabulky</i>
<i>--</i>
&nbsp;
&nbsp;
&nbsp;
<i>-- vytvoøení prázdné tabulky</i>
<strong>local</strong> tbl = {}
&nbsp;
<i>-- nastavit hodnotu prvku tabulky</i>
tbl["first"] = 777
&nbsp;
<i>-- nastavit hodnotu prvku tabulky</i>
tbl["second"] = 999
&nbsp;
<i>-- nastavit hodnotu prvku tabulky</i>
tbl["tenth"] = 1000
&nbsp;
<i>-- tisk informace o tabulce (reference...)</i>
print(tbl)
&nbsp;
<i>-- tisk poctu prvku v tabulce</i>
print(#tbl)
&nbsp;
<i>-- tisk hodnoty prvního prvku v tabulce</i>
print(tbl["first"])
&nbsp;
<i>-- tisk hodnoty druhého prvku v tabulce</i>
print(tbl["second"])
&nbsp;
<i>-- tisk hodnoty desátého prvku v tabulce</i>
print(tbl["tenth"])
&nbsp;
&nbsp;
&nbsp;
<i>-- finito</i>
</pre>



<p><a name="k052"></a></p>
<h3 id="k052">5.2 Pøeklad pøíkladu <strong>test27.lua</strong> do mezijazyka LuaJITu</h3>

<p>Ve zdrojovém kódu demonstraèního pøíkladu <strong>test27.lua</strong> jsme
vidìli pou¾ití jazykové konstrukce pro zápis prvku do tabulky i pro ètení prvku
z&nbsp;tabulky, pøièem¾ pro adresování prvkù byl pou¾it øetìzcový literál. Tyto
dvì konstrukce se do mezijazyka LuaJITu pøelo¾í s&nbsp;vyu¾itím instrukcí
<strong>TSETS</strong> a <strong>TGETS</strong>, kde <strong>S</strong> na
konci jména tìchto instrukcí samozøejmì znamená &bdquo;string&ldquo;. Tyto
instrukce tedy namísto pøímého indexu prvku obsahují index do tabulky
konstantních øetìzcù, co¾ znamená, ¾e mnoho operací s&nbsp;asociativními poli
je pøelo¾eno velmi efektivním zpùsobem:</p>

<pre>
<i>; Pøeklad demonstraèního pøíkladu test27.lua</i>
<i>; do IR vyu¾ívaného virtuálním strojem a JIT</i>
<i>; pøekladaèem LuaJIT.</i>
&nbsp;
-- BYTECODE -- test27.lua:0-44
&nbsp;
<i>; vytvoøení prázdné tabulky</i>
<i>; local tbl = {}</i>
0001    <strong>TNEW</strong>     0   0
&nbsp;
<i>; nastavit hodnotu prvního prvku tabulky</i>
<i>; tbl["first"] = 777</i>
0002    <strong>KSHORT</strong>   1 777        <i>; ukládaná konstanta</i>
0003    <strong>TSETS</strong>    1   0   0    <i>; ulo¾ení hodnoty pod klíèem "first"</i>
&nbsp;
<i>; nastavit hodnotu druhého prvku tabulky</i>
<i>; tbl["second"] = 999</i>
0004    <strong>KSHORT</strong>   1 999        <i>; ukládaná konstanta</i>
0005    <strong>TSETS</strong>    1   0   1    <i>; ulo¾ení hodnoty pod klíèem "second"</i>
&nbsp;
<i>; nastavit hodnotu desátého prvku tabulky</i>
<i>; tbl["tenth"] = 1000</i>
0006    <strong>KSHORT</strong>   1 1000       <i>; ukládaná konstanta</i>
0007    <strong>TSETS</strong>    1   0   2    <i>; ulo¾ení hodnoty pod klíèem "tenth"</i>
&nbsp;
<i>; tisk informace o tabulce (reference...)</i>
<i>; print(tbl)</i>
0008    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0009    <strong>MOV</strong>      2   0        <i>; bude se tisknout reference na tabulku</i>
0010    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk poètu prvkù v tabulce</i>
<i>; print(#tbl)</i>
0011    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0012    <strong>LEN</strong>      2   0        <i>; získání poètu prvkù tabulky (resp. pole, které je souèástí tabulky)</i>
0013    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty prvního prvku v tabulce</i>
<i>; print(tbl["first"])</i>
0014    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0015    <strong>TGETS</strong>    2   0   0    <i>; pøeètení prvku ulo¾eného pod klíèem "first"</i>
0016    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty druhého prvku v tabulce</i>
<i>; print(tbl["second"])</i>
0017    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0018    <strong>TGETS</strong>    2   0   1    <i>; pøeètení prvku ulo¾eného pod klíèem "second"</i>
0019    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty desátého prvku v tabulce</i>
<i>; print(tbl["tenth"])</i>
0020    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0021    <strong>TGETS</strong>    2   0   2    <i>; pøeètení prvku ulo¾eného pod klíèem "tenth"</i>
0022    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; ka¾dý program je automaticky ukonèen následující instrukcí</i>
0023    <strong>RET0</strong>     0   1
&nbsp;
<i>; konec</i>
</pre>



<p><a name="k06"></a></p>
<h2 id="k06">6. Demonstraèní pøíklad <strong>test28.lua</strong> &ndash; pøidání prvkù do tabulky s&nbsp;vyu¾itím promìnných namísto konstantních indexù èi klíèù</h2>

<p>Existuje je¹tì jeden zpùsob adresování prvkù ulo¾ených v&nbsp;tabulkách
&ndash; namísto celoèíselných konstant èi øetìzcových literálù se toti¾ mù¾e
pou¾ít hodnota ulo¾ená do promìnné, a» ji¾ se jedná o celoèíselnou hodnotu èi o
øetìzec èi hodnotu jiného typu (kromì <strong>nil</strong>). I tuto jazykovou
konstrukci musí být <i>LuaJIT</i> schopen pøelo¾it do mezijazyka, ov¹em nemù¾e
pøitom vyu¾ít ani dvojici <strong>TSETB+TGETB</strong> ani dvojici
<strong>TSETS+TGETS</strong>:</p>



<p><a name="k061"></a></p>
<h3 id="k061">6.1 Zdrojový kód pøíkladu <strong>test28.lua</strong></h3>

<pre>
<i>--</i>
<i>-- LuaJIT: demonstraèní pøíklad èíslo 28</i>
<i>--</i>
<i>-- Práce s tabulkami:</i>
<i>--    * vytvoøení a inicializace prázdné tabulky</i>
<i>--    * pøidání prvku do tabulky s pou¾itím promìnných namísto klíèù</i>
<i>--    * tisk poctu prvku tabulky</i>
<i>--    * pøístup k prvkùm tabulky</i>
<i>--</i>
&nbsp;
&nbsp;
&nbsp;
<i>-- vytvoøení prázdné tabulky</i>
<strong>local</strong> tbl = {}
&nbsp;
<i>-- inicializace promìnných pou¾itých jako klice</i>
<strong>local</strong> key1 = "first"
<strong>local</strong> key2 = 2
<strong>local</strong> key3 = "tenth"
&nbsp;
<i>-- nastavit hodnotu prvku tabulky</i>
<i>-- s vyu¾itím indexu èi klice ulo¾eného v promìnné</i>
tbl[key1] = 777
&nbsp;
<i>-- nastavit hodnotu prvku tabulky</i>
<i>-- s vyu¾itím indexu èi klice ulo¾eného v promìnné</i>
tbl[key2] = 999
&nbsp;
<i>-- nastavit hodnotu prvku tabulky</i>
<i>-- s vyu¾itím indexu èi klice ulo¾eného v promìnné</i>
tbl[key3] = 1000
&nbsp;
<i>-- tisk informace o tabulce (reference...)</i>
print(tbl)
&nbsp;
<i>-- tisk poctu prvku v tabulce</i>
print(#tbl)
&nbsp;
<i>-- tisk hodnoty prvku v tabulce</i>
<i>-- s vyu¾itím indexu èi klice ulo¾eného v promìnné</i>
print(tbl[key1])
&nbsp;
<i>-- tisk hodnoty prvku v tabulce</i>
<i>-- s vyu¾itím indexu èi klice ulo¾eného v promìnné</i>
print(tbl[key2])
&nbsp;
<i>-- tisk hodnoty prvku v tabulce</i>
<i>-- s vyu¾itím indexu èi klice ulo¾eného v promìnné</i>
print(tbl[key3])
&nbsp;
&nbsp;
&nbsp;
<i>-- finito</i>
</pre>



<p><a name="k062"></a></p>
<h3 id="k062">6.2 Pøeklad pøíkladu <strong>test28.lua</strong> do mezijazyka LuaJITu</h3>

<p>Podívejme se nyní na pøeklad demonstraèního pøíkladu
<strong>test28.lua</strong> do mezijazyka <i>LuaJITu</i>. Mù¾eme zde vidìt
novou dvojici instrukcí <strong>TSETV</strong> a <strong>TGETV</strong>, kde
<strong>V</strong> na konci jmen tìchto instrukcí samozøejmì znaèí
&bdquo;variable&ldquo;. Tyto dvì instrukce se pou¾ijí pøi zápisu resp.&nbsp;pøi
ètení hodnoty libovolného prvku tabulky v&nbsp;pøípadì, kdy není mo¾né pro
adresaci pou¾ít ani celé èíslo, ani øetìzcový literál. Operandy obou instrukcí
jsou tøi &ndash; index èteného/zapisovaného slotu, index slotu obsahujícího
referenci na tabulku a koneènì index slotu obsahujícího hodnotu pou¾itou jako
index èi jako klíè:</p>

<pre>
<i>; Pøeklad demonstraèního pøíkladu test28.lua</i>
<i>; do IR vyu¾ívaného virtuálním strojem a JIT</i>
<i>; pøekladaèem LuaJIT.</i>
&nbsp;
-- BYTECODE -- test28.lua:0-55
&nbsp;
<i>; vytvoøení prázdné tabulky</i>
<i>; local tbl = {}</i>
0001    <strong>TNEW</strong>     0   0
&nbsp;
<i>; inicializace promìnných pou¾itých jako klíèe</i>
<i>; local key1 = "first"</i>
0002    <strong>KSTR</strong>     1   0        <i>; øetìzec "first"</i>
&nbsp;
<i>; local key2 = 2</i>
0003    <strong>KSHORT</strong>   2   2        <i>; ukládaná konstanta</i>
&nbsp;
<i>; local key3 = "tenth"</i>
0004    <strong>KSTR</strong>     3   1        <i>; øetìzec "tenth"</i>
&nbsp;
<i>; nastavit hodnotu prvku tabulky</i>
<i>; s vyu¾itím indexu èi klíèe ulo¾eného v promìnné</i>
<i>; tbl[key1] = 777</i>
0005    <strong>KSHORT</strong>   4 777        <i>; ukládaná konstanta</i>
0006    <strong>TSETV</strong>    4   0   1    <i>; ulo¾ení hodnoty do tabulky</i>
&nbsp;
<i>; nastavit hodnotu prvku tabulky</i>
<i>; s vyu¾itím indexu èi klíèe ulo¾eného v promìnné</i>
<i>; tbl[key2] = 999</i>
0007    <strong>KSHORT</strong>   4 999        <i>; ukládaná konstanta</i>
0008    <strong>TSETV</strong>    4   0   2    <i>; ulo¾ení hodnoty do tabulky</i>
&nbsp;
<i>; nastavit hodnotu prvku tabulky</i>
<i>; s vyu¾itím indexu èi klíèe ulo¾eného v promìnné</i>
<i>; tbl[key3] = 1000</i>
0009    <strong>KSHORT</strong>   4 1000       <i>; ukládaná konstanta</i>
0010    <strong>TSETV</strong>    4   0   3    <i>; ulo¾ení hodnoty do tabulky</i>
&nbsp;
<i>; tisk informace o tabulce (reference...)</i>
<i>; print(tbl)</i>
0011    <strong>GGET</strong>     4   2        <i>; získání reference na funkci se jménem "print"</i>
0012    <strong>MOV</strong>      5   0        <i>; bude se tisknout reference na tabulku</i>
0013    <strong>CALL</strong>     4   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk poctu prvku v tabulce</i>
<i>; print(#tbl)</i>
0014    <strong>GGET</strong>     4   2        <i>; získání reference na funkci se jménem "print"</i>
0015    <strong>LEN</strong>      5   0        <i>; získání poètu prvkù tabulky (resp. pole, které je souèástí tabulky)</i>
0016    <strong>CALL</strong>     4   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty prvku v tabulce</i>
<i>; s vyu¾itím indexu èi klíèe ulo¾eného v promìnné</i>
<i>; print(tbl[key1])</i>
0017    <strong>GGET</strong>     4   2        <i>; získání reference na funkci se jménem "print"</i>
0018    <strong>TGETV</strong>    5   0   1    <i>; pøeètení prvku z tabulky</i>
0019    <strong>CALL</strong>     4   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty prvku v tabulce</i>
<i>; s vyu¾itím indexu èi klíèe ulo¾eného v promìnné</i>
<i>; print(tbl[key2])</i>
0020    <strong>GGET</strong>     4   2        <i>; získání reference na funkci se jménem "print"</i>
0021    <strong>TGETV</strong>    5   0   2    <i>; pøeètení prvku z tabulky</i>
0022    <strong>CALL</strong>     4   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty prvku v tabulce</i>
<i>; s vyu¾itím indexu èi klíèe ulo¾eného v promìnné</i>
<i>; print(tbl[key3])</i>
0023    <strong>GGET</strong>     4   2        <i>; získání reference na funkci se jménem "print"</i>
0024    <strong>TGETV</strong>    5   0   3    <i>; pøeètení prvku z tabulky</i>
0025    <strong>CALL</strong>     4   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; ka¾dý program je automaticky ukonèen následující instrukcí</i>
0026    <strong>RET0</strong>     0   1
&nbsp;
<i>; konec</i>
</pre>



<p><a name="k07"></a></p>
<h2 id="k07">7. Demonstraèní pøíklad <strong>test29.lua</strong> &ndash; práce s&nbsp;dvourozmìrnými tabulkami (maticemi)</h2>

<p>Kromì jednorozmìrných tabulek je v&nbsp;programovacím jazyce <i>Lua</i>
samozøejmì mo¾né pracovat i s&nbsp;tabulkami, které mají vet¹í poèet dimenzí.
Velmi èasté bývá pou¾ití dvourozmìrných tabulek neboli matic. Z&nbsp;hlediska
programovacího jazyka <i>Lua</i> je práce s&nbsp;vícerozmìrnými tabulkami
snadná, ov¹em zajímavé bude zjistit, jakým zpùsobem se pøíkazy pro ètení a
zápis prvkù pøelo¾í do mezijazyka <i>LuaJITu</i>. K&nbsp;otestování základních
vlastností IR nám bude slou¾it pomìrnì jednoduchý demonstraèní pøíklad,
v&nbsp;nìm¾ je nejdøíve vytvoøena matice a následnì se pøistupuje jak
k&nbsp;jednotlivým øádkùm této matice, tak i k&nbsp;prvkùm ulo¾eným
v&nbsp;matici (pøesnìji øeèeno na vybraném øádku).</p>



<p><a name="k071"></a></p>
<h3 id="k071">7.1 Zdrojový kód pøíkladu <strong>test29.lua</strong></h3>

<pre>
<i>--</i>
<i>-- LuaJIT: demonstraèní pøíklad èíslo 29</i>
<i>--</i>
<i>-- Práce s tabulkami:</i>
<i>--    * vytvoøení a inicializace dvourozmìrné tabulky</i>
<i>--    * vlo¾ení podtabulek do "hlavni" tabulky</i>
<i>--    * pøístup k prvkùm matice</i>
<i>--</i>
&nbsp;
&nbsp;
&nbsp;
<i>-- vytvoøení a inicializace dvourozmìrné</i>
<strong>local</strong> tbl = {
    { 1,  2,  3,  4},
    { 5,  6,  7,  8},
    { 9, 10, 11, 12}
}
&nbsp;
<i>-- tisk informace o tabulce (reference...)</i>
print(tbl)
&nbsp;
<i>-- tisk poctu prvku v tabulce (nejvy¹¹í dimenze)</i>
print(#tbl)
&nbsp;
<i>-- tisk poctu prvku v prvním øádku tabulky (ni¾¹í dimenze)</i>
print(#tbl[1])
&nbsp;
<i>-- tisk poctu prvku ve druhem øádku tabulky (ni¾¹í dimenze)</i>
print(#tbl[2])
&nbsp;
<i>-- tisk poctu prvku ve tøetím øádku tabulky (ni¾¹í dimenze)</i>
print(#tbl[3])
&nbsp;
<i>-- tisk hodnoty vybraného prvku v dvourozmìrné tabulce</i>
print(tbl[1][1])
&nbsp;
<i>-- tisk hodnoty vybraného prvku v dvourozmìrné tabulce</i>
print(tbl[3][4])
&nbsp;
<i>-- finito</i>
</pre>



<p><a name="k072"></a></p>
<h3 id="k072">7.2 Pøeklad pøíkladu <strong>test29.lua</strong> do mezijazyka LuaJITu</h3>

<p>V&nbsp;IR pøelo¾eného pøíkladu <strong>test29.lua</strong> mù¾eme vidìt hned
nìkolik nových technik. První z&nbsp;nich se týká vytvoøení a inicializace
dvourozmìrné tabulky, co¾ je ji¾ operace, kterou nelze vykonat jedinou
instrukcí <strong>TNEW</strong>, ale je nutné je¹tì explicitnì vytvoøit
jednotlivé øádky matice:</p>

<pre>
<i>; Pøeklad demonstraèního pøíkladu test29.lua</i>
<i>; do IR vyu¾ívaného virtuálním strojem a JIT</i>
<i>; pøekladaèem LuaJIT.</i>
&nbsp;
-- BYTECODE -- test29.lua:0-42
&nbsp;
<i>; vytvoøení a inicializace dvourozmìrné tabulky</i>
<i>; local tbl = {</i>
0001    <strong>TNEW</strong>     0   4
<i>;     { 1,  2,  3,  4},</i>
0002    <strong>TDUP</strong>     1   0
0003    <strong>TSETB</strong>    1   0   1
<i>;     { 5,  6,  7,  8},</i>
0004    <strong>TDUP</strong>     1   1
0005    <strong>TSETB</strong>    1   0   2
<i>;     { 9, 10, 11, 12}</i>
0006    <strong>TDUP</strong>     1   2
0007    <strong>TSETB</strong>    1   0   3
<i>; }</i>
</pre>

<p>Tisk souhrnných informací o tabulce zùstává stejný, nezávisle na tom, zda se
jedná o jednorozmìrný vektor èi o dvourozmìrnou matici. Stejný je i zpùsob
zji¹tìní poètu prvkù v&nbsp;tabulce, co¾ zde znamená poèet øádkù matice:</p>

<pre>
<i>; tisk informace o tabulce (reference...)</i>
<i>; print(tbl)</i>
0008    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0009    <strong>MOV</strong>      2   0
0010    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk poètu prvkù v tabulce (nejvy¹¹í dimenze)</i>
<i>; print(#tbl)</i>
0011    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0012    <strong>LEN</strong>      2   0        <i>; výpoèet velikosti tabulky (nejvy¹¹í dimenze)</i>
0013    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
</pre>

<p>Zajímavìj¹í je ji¾ pøístup k&nbsp;jednotlivým øádkùm matice, proto¾e ka¾dý
øádek je vlastnì prvkem nadøazené tabulky. Toté¾ platí i pøi pøístupu ke
konkrétním prvkùm matice, kde je nutné pou¾ít dvojici instrukcí
<strong>TGETB</strong> &ndash; první pro získání reference na øádek, druhou pro
pøeètení prvku z&nbsp;tohoto øádku:</p>

<pre>
<i>; tisk poètu prvkù v prvním øádku tabulky (ni¾¹í dimenze)</i>
<i>; print(#tbl[1])</i>
0014    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0015    <strong>TGETB</strong>    2   0   1    <i>; naètení celého øádku tabulky</i>
0016    <strong>LEN</strong>      2   2        <i>; výpoèet délky jednoho øádku tabulky</i>
0017    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk poètu prvkù ve druhem øádku tabulky (ni¾¹í dimenze)</i>
<i>; print(#tbl[2])</i>
0018    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0019    <strong>TGETB</strong>    2   0   2    <i>; naètení celého øádku tabulky</i>
0020    <strong>LEN</strong>      2   2        <i>; výpoèet délky jednoho øádku tabulky</i>
0021    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk poètu prvkù ve tøetím øádku tabulky (ni¾¹í dimenze)</i>
<i>; print(#tbl[3])</i>
0022    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0023    <strong>TGETB</strong>    2   0   3    <i>; naètení celého øádku tabulky</i>
0024    <strong>LEN</strong>      2   2        <i>; výpoèet délky jednoho øádku tabulky</i>
0025    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty vybraného prvku v dvourozmìrné tabulce</i>
<i>; print(tbl[1][1])</i>
0026    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0027    <strong>TGETB</strong>    2   0   1    <i>; naètení celého øádku tabulky</i>
0028    <strong>TGETB</strong>    2   2   1    <i>; naètení vybraného prvku z øádku</i>
0029    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; tisk hodnoty vybraného prvku v dvourozmìrné tabulce</i>
<i>; print(tbl[3][4])</i>
0030    <strong>GGET</strong>     1   3        <i>; získání reference na funkci se jménem "print"</i>
0031    <strong>TGETB</strong>    2   0   3    <i>; naètení celého øádku tabulky</i>
0032    <strong>TGETB</strong>    2   2   4    <i>; naètení vybraného prvku z øádku</i>
0033    <strong>CALL</strong>     1   1   2    <i>; volání funkce print()</i>
&nbsp;
<i>; ka¾dý program je automaticky ukonèen následující instrukcí</i>
0034    <strong>RET0</strong>     0   1
&nbsp;
<i>; konec</i>
</pre>



<p><a name="k08"></a></p>
<h2 id="k08">8. Repositáø se zdrojovými kódy v¹ech ¹esti dne¹ních demonstraèních pøíkladù</h2>

<p>V¹ech ¹est dnes popsaných a takté¾ &bdquo;disasemblovaných&ldquo;
demonstraèních pøíkladù bylo ulo¾eno do Git repositáøe umístìného na adrese <a
href="https://github.com/tisnik/luajit-examples">https://github.com/tisnik/luajit-examples</a>.
Odkazy na prozatím poslední verze tìchto ¹esti pøíkladù naleznete
v&nbsp;tabulce umístìné pod tímto odstavcem:</p>

<table>
<tr><th> #</th><th>Zdrojový kód</th><th>Umístìní</th></tr>
<tr><td> 1</td><td>test24.lua</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/src/test24.lua">https://github.com/tisnik/luajit-examples/blob/master/src/test24.lua</a></td></tr>
<tr><td> 2</td><td>test25.lua</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/src/test25.lua">https://github.com/tisnik/luajit-examples/blob/master/src/test25.lua</a></td></tr>
<tr><td> 3</td><td>test26.lua</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/src/test26.lua">https://github.com/tisnik/luajit-examples/blob/master/src/test26.lua</a></td></tr>
<tr><td> 4</td><td>test27.lua</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/src/test27.lua">https://github.com/tisnik/luajit-examples/blob/master/src/test27.lua</a></td></tr>
<tr><td> 5</td><td>test28.lua</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/src/test28.lua">https://github.com/tisnik/luajit-examples/blob/master/src/test28.lua</a></td></tr>
<tr><td> 6</td><td>test29.lua</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/src/test29.lua">https://github.com/tisnik/luajit-examples/blob/master/src/test29.lua</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 7</td><td>test24.asm</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/asm/test24.asm">https://github.com/tisnik/luajit-examples/blob/master/asm/test24.asm</a></td></tr>
<tr><td> 8</td><td>test25.asm</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/asm/test25.asm">https://github.com/tisnik/luajit-examples/blob/master/asm/test25.asm</a></td></tr>
<tr><td> 9</td><td>test26.asm</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/asm/test26.asm">https://github.com/tisnik/luajit-examples/blob/master/asm/test26.asm</a></td></tr>
<tr><td>10</td><td>test27.asm</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/asm/test27.asm">https://github.com/tisnik/luajit-examples/blob/master/asm/test27.asm</a></td></tr>
<tr><td>11</td><td>test28.asm</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/asm/test28.asm">https://github.com/tisnik/luajit-examples/blob/master/asm/test28.asm</a></td></tr>
<tr><td>12</td><td>test29.asm</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/asm/test29.asm">https://github.com/tisnik/luajit-examples/blob/master/asm/test29.asm</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>13</td><td>Makefile</td><td><a href="https://github.com/tisnik/luajit-examples/blob/master/Makefile">https://github.com/tisnik/luajit-examples/blob/master/Makefile</a></td></tr>
</table>



<p><a name="k09"></a></p>
<h2 id="k09">9. Odkazy na Internetu</h2>

<ol>

<li>Wikipedia: Mezijazyk<br />
<a href="http://cs.wikipedia.org/wiki/Mezijazyk">http://cs.wikipedia.org/wiki/Mezijazyk</a>
</li>

<li>The LuaJIT Project<br />
<a href="http://luajit.org/index.html">http://luajit.org/index.html</a>
</li>

<li>LuaJIT FAQ<br />
<a href="http://luajit.org/faq.html">http://luajit.org/faq.html</a>
</li>

<li>LuaJIT Performance Comparison<br />
<a href="http://luajit.org/performance.html">http://luajit.org/performance.html</a>
</li>

<li>LuaJIT 2.0 intellectual property disclosure and research opportunities<br />
<a href="http://article.gmane.org/gmane.comp.lang.lua.general/58908">http://article.gmane.org/gmane.comp.lang.lua.general/58908</a>
</li>

<li>LuaJIT Wiki<br />
<a href="http://wiki.luajit.org/Home">http://wiki.luajit.org/Home</a>
</li>

<li>LuaJIT 2.0 Bytecode Instructions<br />
<a href="http://wiki.luajit.org/Bytecode-2.0">http://wiki.luajit.org/Bytecode-2.0</a>
</li>

<li>Programming in Lua 9.1 &ndash; Coroutine Basics,<br />
<a href="http://www.lua.org/pil/9.1.html">http://www.lua.org/pil/9.1.html</a>
</li>

<li>Programming in Lua (first edition)<br />
<a href="http://www.lua.org/pil/contents.html">http://www.lua.org/pil/contents.html</a>
</li>

<li>Programming in Lua: 6 - More about Functions<br />
<a href="http://www.lua.org/pil/6.html">http://www.lua.org/pil/6.html</a>
</li>

<li>Lua Lanes<br />
<a href="http://kotisivu.dnainternet.net/askok/bin/lanes/">http://kotisivu.dnainternet.net/askok/bin/lanes/</a>
</li>

<li>Programming in Lua: 6.1 - Closures<br />
<a href="http://www.lua.org/pil/6.1.html">http://www.lua.org/pil/6.1.html</a>
</li>

<li>Programming in Lua: 9.1 - Coroutine Basics<br />
<a href="http://www.lua.org/pil/9.1.html">http://www.lua.org/pil/9.1.html</a>
</li>

<li>Programming in Lua: Numeric for<br />
<a href="http://www.lua.org/pil/4.3.4.html">http://www.lua.org/pil/4.3.4.html</a>
</li>

<li>Programming in Lua: break and return<br />
<a href="http://www.lua.org/pil/4.4.html">http://www.lua.org/pil/4.4.html</a>
</li>

<li>Programming in Lua: Tables<br />
<a href="http://www.lua.org/pil/2.5.html">http://www.lua.org/pil/2.5.html</a>
</li>

<li>Programming in Lua: Table Constructors<br />
<a href="http://www.lua.org/pil/3.6.html">http://www.lua.org/pil/3.6.html</a>
</li>

<li>Programovací jazyk Lua<br />
<a href="http://palmknihy.cz/web/kniha/programovaci-jazyk-lua-12651.htm">http://palmknihy.cz/web/kniha/programovaci-jazyk-lua-12651.htm</a>
</li>

<li>Lua: Tables Tutorial<br />
<a href="http://lua-users.org/wiki/TablesTutorial">http://lua-users.org/wiki/TablesTutorial</a>
</li>

<li>Lua: Control Structure Tutorial<br />
<a href="http://lua-users.org/wiki/ControlStructureTutorial">http://lua-users.org/wiki/ControlStructureTutorial</a>
</li>

<li>Lua Types Tutorial<br />
<a href="http://lua-users.org/wiki/LuaTypesTutorial">http://lua-users.org/wiki/LuaTypesTutorial</a>
</li>

<li>Goto Statement in Lua<br />
<a href="http://lua-users.org/wiki/GotoStatement">http://lua-users.org/wiki/GotoStatement</a>
</li>

<li>Lua 5.2 sources<br />
<a href="http://www.lua.org/source/5.2/">http://www.lua.org/source/5.2/</a>
</li>

<li>Lua 5.2 sources - lopcodes.h<br />
<a href="http://www.lua.org/source/5.2/lopcodes.h.html">http://www.lua.org/source/5.2/lopcodes.h.html</a>
</li>

<li>Lua 5.2 sources - lopcodes.c<br />
<a href="http://www.lua.org/source/5.2/lopcodes.c.html">http://www.lua.org/source/5.2/lopcodes.c.html</a>
</li>

<li>Lambda the Ultimate: Coroutines in Lua,<br />
<a href="http://lambda-the-ultimate.org/node/438">http://lambda-the-ultimate.org/node/438</a>
</li>

<li>Coroutines Tutorial,<br />
<a href="http://lua-users.org/wiki/CoroutinesTutorial">http://lua-users.org/wiki/CoroutinesTutorial</a>
</li>

<li>Lua Coroutines Versus Python Generators,<br />
<a href="http://lua-users.org/wiki/LuaCoroutinesVersusPythonGenerators">http://lua-users.org/wiki/LuaCoroutinesVersusPythonGenerators</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2014</small></p>
</body>
</html>

