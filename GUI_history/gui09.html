<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Historie vývoje GUI (9): pou¾ití PostScriptu v&nbsp;systému NeXTSTEP</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Historie vývoje GUI (9): pou¾ití PostScriptu v&nbsp;systému NeXTSTEP</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V pøedchozí èásti seriálu o historii GUI jsme se seznámili s poèítaèi spoleènosti NeXT. Na tìchto poèítaèích byl provozován systém NeXTSTEP, jeho¾ nedílnou souèástí byl i jazyk PostScript, resp. jeho varianta Display PostScript. PostScript v¹ak byl mj. vyu¾it i konkurenèním systémem NeWS firmy Sun. Dnes si øekneme, z jakých dùvodù byl PostScript pro tvorbu GUI vùbec pou¾íván.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Historie vývoje GUI (9): pou¾ití PostScriptu v&nbsp;systému NeXTSTEP</a></p>
<p><a href="#k02">2. NeXTSTEP &ndash; první objektovì orientovaný systém s&nbsp;GUI?</a></p>
<p><a href="#k03">3. Základní informace o programovacím jazyku PostScript</a></p>
<p><a href="#k04">4. Kreslení v&nbsp;PostScriptu s&nbsp;vyu¾itím cest</a></p>
<p><a href="#k05">5. Bézierovy køivky a fonty v&nbsp;PostScriptu</a></p>
<p><a href="#k06">6. Zásobníkový programovací jazyk a tvorba nových slov (funkcí)</a></p>
<p><a href="#k07">7. Øídicí pøíkazy (podmínky a programové smyèky)</a></p>
<p><a href="#k08">8. Display PostScript &ndash; pou¾ití PostScriptu pøi práci s&nbsp;obrazovkou (nejenom) v&nbsp;systému NeXTSTEP</a></p>
<p><a href="#k09">9. Odkazy na dal¹í informaèní zdroje</a></p>



<p><a name="k01"></a></p>
<h2>1. Historie vývoje GUI (9): pou¾ití PostScriptu v&nbsp;systému NeXTSTEP</h2>

<p>V&nbsp;pøedchozí èásti seriálu o historii vývoje grafických u¾ivatelských
rozhraní jsme si øekli, jakým zpùsobem vznikla spoleènost <i>NeXT</i> odchodem
Steva Jobse a nìkterých dal¹ích klíèových zamìstnancù z&nbsp;firmy <i>Apple</i>
v&nbsp;roce 1985. Takté¾ jsme si popsali nejdùle¾itìj¹í technické parametry
pracovních stanic vyrábìných spoleèností <i>NeXT</i>. Jednalo se jak o pùvodní
pracovní stanici první generace nazvanou <i>NeXT Computer</i>, tak i o druhou
generaci tìchto poèítaèù, pøedev¹ím o hi-endový poèítaè <i>NeXT Cube</i> a
ponìkud levnìj¹í, ale cenovì dostupnìj¹í <i>NeXTstation</i> a <i>NeXTstation
Color</i>. V¹echny poèítaèe vyrábìné firmou <i>NeXT</i> vynikaly jak svým
nadstandardním výkonem (pomìrnì rychlý mikroprocesor spojený s&nbsp;DSP
poskytoval výpoèetní výkon a¾ 15 MIPS a 2 MFLOPS), tak i na svou dobu
vynikajícím grafickým rozli¹ením 1120&times;832 pixelù, rozhraním SCSI a
standardnì dodávanou sí»ovou kartou standardu Ethernet &ndash; to v¹e
v&nbsp;dobì, kdy poèítaèové sítì budované pro platformu PC byly spí¹e
výjimeènou zále¾itostí.</p>

<a href="http://i.iinfo.cz/images/308/gui08-5.jpg"><img src="http://i.iinfo.cz/images/308/gui08-5-prev.jpg" width="370" height="252" alt=" " /></a>
<p><i>Obrázek 1: Pracovní stanice NeXTcube (tj.&nbsp;jedná se o druhou generaci
poèítaèù firmy NeXT) i s&nbsp;monitorem, klávesnicí, my¹í a magnetooptickým
diskem.</i></p>

<p>Ov¹em nedílnou souèástí poèítaèù <i>NeXT</i>, která je z&nbsp;historického
hlediska dokonce mnohem dùle¾itìj¹í ne¾ technické parametry hardwaru, byl i
operaèní systém <i>NeXTSTEP</i>, jen¾ v&nbsp;sobì spojoval jak výkonnost a
robustnost UNIXu, tak i mnoho nových konceptù, které v&nbsp;ponìkud zmìnìné
podobì dodnes pøe¾ívají napøíklad v&nbsp;operaèním systému <i>Mac OS X</i>.
Základem operaèního systému <i>NeXTSTEP</i> je upravené jádro, je¾ bylo pùvodnì
pøevzaté ze systému <i>Mach</i>. Toto jádro bylo doplnìné o nìkteré tradièní
Unixové nástroje. Nad touto základní vrstvou byl postaven systém pro správu
pracovní plochy a grafických oken, jejich¾ obsah se vykresloval s&nbsp;vyu¾itím
<i>Display PostScriptu</i>, tj.&nbsp;systému zalo¾eného na programovacím jazyku
<i>PostScript</i>, který byl upravený takovým zpùsobem, aby umo¾òoval práci
s&nbsp;grafickou obrazovkou, soubì¾ný bìh více programù (s&nbsp;mo¾ností jejich
vzájemné synchronizace), byl vybaven funkcemi pro zji¹tìní pozice kurzoru my¹i
vùèi grafickým objektùm (<i>hit detection</i>) atd.</p>

<img src="http://i.iinfo.cz/images/308/gui08-9.jpg" width="206" height="150" alt=" " />
<p><i>Obrázek 2: Pracovní stanice NeXTstation Color se spu¹tìným operaèním
systémem.</i></p>

<p>Právì tímto programovacím jazykem se budeme podrobnìji zabývat
v&nbsp;následujících kapitolách. Ov¹em i dal¹í souèásti systému <i>NeXTSTEP</i>
jsou zajímavé a v&nbsp;mnoha ohledech pøelomové. Konkurenèní operaèní systémy
s&nbsp;grafickým u¾ivatelským rozhraním byly v&nbsp;polovinì osmdesátých let
minulého století vìt¹inou naprogramovány v&nbsp;kombinaci assembleru
(tj.&nbsp;nízkoúrovòového jazyka symbolických adres) a programovacího jazyka
<i>C</i>, co¾ dosti podstatným zpùsobem ovlivnilo jejich aplikaèní programové
rozhraní (API) &ndash; ostatnì nemusíme chodit pouze do dnes ji¾ pomìrnì
vzdálené minulosti, proto¾e napøíklad <i>WinAPI</i> systému <i>Microsoft
Windows</i> nebo <i>Xlib</i> systému <i>X</i> mají stále API vycházející
z&nbsp;céèka. Naproti tomu se tvùrci operaèního systému <i>NeXTSTEPu</i>
rozhodli pou¾ít pro nízkoúrovòové moduly takté¾ programovací jazyk <i>C</i>
(co¾ není pøekvapivé, proto¾e na céèko se i díky zvy¹ující se kvalitì
pøekladaèù programátoøi dívali jako na &bdquo;pøenositelný assembler&ldquo;),
ov¹em vìt¹í èást systému byla napsána v&nbsp;programovacím jazyce
<i>Objective-C</i>.</p>

<a href="http://i.iinfo.cz/images/308/gui08-10.jpg"><img src="http://i.iinfo.cz/images/308/gui08-10-prev.jpg" width="363" height="270" alt=" " /></a>
<p><i>Obrázek 3: Grafické u¾ivatelské rozhraní systému NeXTSTEP zobrazené na
poèítaèi NeXTstation s&nbsp;rozli¹ením 1120&times;832 pixelù ve ètyøech
stupních ¹edi.</i></p>



<p><a name="k02"></a></p>
<h2>2. NeXTSTEP &ndash; první objektovì orientovaný systém s&nbsp;GUI?</h2>

<p>Programovací jazyk <i>Objective-C</i> je, podobnì jako na osobních
poèítaèích øady PC ponìkud více známý a mnohem roz¹íøenìj¹í programovací jazyk
<i>C++</i>, sice zalo¾en na pùvodním céèku, ov¹em pøidává do nìj objektové
rysy. Oproti staticky typovanému <i>C++</i> se v¹ak <i>Objective-C</i>
pøibli¾uje spí¹e ke klasicky pojatému &bdquo;smalltalkovskému&ldquo;
objektovému systému s&nbsp;posíláním zpráv a reflexí, díky ní¾ se napøíklad
objekt, jemu¾ je zpráva poslána, doká¾e a¾ v&nbsp;èase bìhu programu
rozhodnout, jakým zpùsobem a zda vùbec tuto zprávu zpracuje atd. Právì díky
pou¾ití programovacího jazyka <i>Objective-C</i> bylo mo¾né nad základními
moduly operaèního systému <i>NeXTSTEP</i> (jádro Mach, UNIXové utility, okenní
systém, Display PostScript) vytvoøit plnì objektovì orientovanou aplikaèní
vrstvu, co¾ bylo velmi dùle¾ité, proto¾e to umo¾nilo vývojáøùm psát aplikace
s&nbsp;grafickým u¾ivatelským rozhraním pomìrnì snadno a rychle, zejména pøi
porovnání s&nbsp;v&nbsp;té dobì existujícími nebo právì vyvíjenými
konkurenèními systémy (<i>Windows 3.x</i>, <i>GEOS</i>, <i>TOS+GEM</i>,
<i>Amiga OS Workbench</i>, <i>X (+Motif)</i>).</p>

<a href="http://i.iinfo.cz/images/91/gui09-1.jpg"><img src="http://i.iinfo.cz/images/91/gui09-1-prev.jpg" width="338" height="270" alt=" " /></a>
<p><i>Obrázek 4: Historický správce oken (potomek pùvodního NeXTSTEPu)
s&nbsp;historickým webovým prohlí¾eèem (Netscape Navigator Gold) bì¾ící na dnes
ji¾ historické grafické pracovní stanici.</i></p>

<p>Pozdìji byly k&nbsp;objektové aplikaèní vrstvì dodány rùzné doplòkové a
roz¹iøující kity, napøíklad <i>PDO (Portable Distributed Objects</i>)
umo¾òující komunikaci mezi objekty &bdquo;¾ijícími&ldquo; na rùzných
poèítaèích, objektovì-relaèní databáze atd. Spolu s&nbsp;vývojovým prostøedím
se <i>Objective-C</i> a objektová vrstva systému <i>NeXTSTEP</i> staly na
nìkolik let prakticky nejlep¹í platformou pro rychlý vývoj aplikací s&nbsp;GUI.
To ostatnì potvrdil napøíklad i Tim Berners-Lee, který øekl, ¾e kdyby
programování prvního webového prohlí¾eèe probíhalo na jiném systému, ne¾
<i>NeXTSTEP</i>, byl by celý vývoj mnohem pracnìj¹í a mo¾ná by výsledek vypadal
jinak (napøíklad nìkteré rysy znaèkovacího jazyka HTML vychází
z&nbsp;formátovacích mo¾ností widgetu pro práci s&nbsp;textem systému
<i>NeXTSTEP</i>). Mezi dal¹í známé vývojáøe, kteøí systém <i>NeXTSTEP</i>
pou¾ívali, patøí <i>John Carmack</i>, který právì zde vytvoøil první demoverze
her <i>Wolfenstein 3D</i> a <i>Doom</i>, je¾ byly posléze portovány na PC,
které samozøejmì pøedstavovalo z&nbsp;komerèního hlediska mnohem zajímavìj¹í
platformu.</p>

<a href="http://i.iinfo.cz/images/91/gui09-2.jpg"><img src="http://i.iinfo.cz/images/91/gui09-2-prev.jpg" width="370" height="246" alt=" " /></a>
<p><i>Obrázek 5: První webový server na svìtì byl vyvinut i otestován na
pracovní stanici NeXT Computer. Autorem tohoto projektu &ndash; a souèasnì i
webového prohlí¾eèe WorldWideWeb a souèasnì i samotného principu práce webu
&ndash; byl Tim Berners-Lee.</i></p>

<p>Zajímavé je, ¾e právì objektovì orientovaná aplikaèní vrstva operaèního
systému <i>NeXTSTEP</i> byla pomìrnì èasto napodobována ostatními spoleènostmi,
které produkovaly operaèní systémy s&nbsp;grafickým u¾ivatelským rozhraním.
Z&nbsp;tìch známìj¹ích systémù se jednalo napøíklad o systém <i>Taligent</i>
firem <i>Apple</i> (mìlo se jednat o nástupce Mac OS), <i>HP</i> a <i>IBM</i>
(tato firma mìla velké zku¹enosti s&nbsp;objektovì orientovaným pøístupem díky
vývoji <i>VisualAge for Smalltalk</i>), ale takté¾ o sice èasto citovaný, ale
nikdy nedokonèený systém <i>Cairo</i> firmy <i>Microsoft</i>. Dnes je podobný
pøístup pou¾it jak v&nbsp;<i>Qt</i>, tak i v&nbsp;<i>GTK++</i>, i kdy¾ zde je
patrný mnohem vìt¹í vliv programovacích jazykù C a C++. Jedná se napøíklad o
rozli¹ování typù objektù ji¾ v&nbsp;dobì pøekladu a nikoli a¾ v&nbsp;dobì bìhu
programu, co¾ vy¾aduje zmìnu stylu programování i odli¹ný zpùsob návrhu
aplikaèního programového rozhraní (API).</p>

<a href="http://i.iinfo.cz/images/308/gui08-12.jpg"><img src="http://i.iinfo.cz/images/308/gui08-12-prev.jpg" width="341" height="270" alt=" " /></a>
<p><i>Obrázek 6: První grafický webový prohlí¾eè na svìtì (WorldWideWeb)
z&nbsp;roku 1991 bì¾ící na systému NeXTSTEP.</i></p>



<p><a name="k03"></a></p>
<h2>3. Základní informace o programovacím jazyku PostScript</h2>

<p>Ji¾ v&nbsp;úvodní kapitole tohoto èlánku jsme si øekli, ¾e souèástí
operaèního systému <i>NeXTSTEP</i> je i <i>Display PostScript</i>, co¾ je
varianta programovacího jazyka <i>PostScript</i> firmy <i>Adobe</i>, který byl
roz¹íøen o nìkteré funkce nutné pro vytváøení grafického u¾ivatelského
rozhraní. Nejprve si velmi struènì popí¹eme základní vlastnosti jazyka
<i>PostScript</i> a poté si øekneme, jaké zmìny bylo nutné v&nbsp;tomto jazyku
provést, aby byl vyu¾itelný pøi práci s&nbsp;GUI. Pùvodnì byl
<i>PostScriptu</i> navr¾en jako specializovaný jazyk urèený primárnì pøedev¹ím
pro popis tiskových stránek, které jsou urèeny k&nbsp;tisku na postscriptové
tiskárnì nebo osvitové jednotce, popø.&nbsp;k&nbsp;pøevodu tiskové stránky na
bitmapový obrázek urèený pro tisk na &bdquo;hloupìj¹ích&ldquo; tiskárnách
(jedná se o GDI tiskárny, tiskárny s&nbsp;konkurenèním jazykem PCL,
v&nbsp;minulosti té¾ jehlièkové tiskárny). Pozdìji se mo¾nosti
<i>PostScriptu</i> roz¹íøily, nebo» vznikly specializované programy (viewery)
umo¾òující zobrazit tiskové stránky na obrazovce poèítaèe. Jedná se napøíklad o
program <i>GhostView</i> pou¾ívaný spoleènì s&nbsp;<i>Ghostscriptem</i>.</p>

<a href="http://i.iinfo.cz/images/91/gui09-3.jpg"><img src="http://i.iinfo.cz/images/91/gui09-3-prev.jpg" width="346" height="270" alt=" " /></a>
<p><i>Obrázek 7: Dal¹í pohled na grafické u¾ivatelské rozhraní
NeXTSTEPu.</i></p>

<p>Kromì toho mù¾e jazyk <i>PostScript</i> (pøedev¹ím jeho varianta zapouzdøený
PostScript &ndash; EPS) slou¾it i jako <i>metaformát</i> urèený pro pøenos
grafických informací mezi rùznými aplikacemi a operaèními systémy (slovem
&bdquo;metaformát&ldquo; je v&nbsp;tomto kontextu my¹len souborový formát, ve
kterém je mo¾né ukládat jak vektorovou kresbu, tak i bitmapovou,
tj.&nbsp;rastrovou grafiku). Na rozdíl od vìt¹iny ostatních znaèkovacích jazykù
i datových formátù urèených pro popis tiskových stránek (jmenujme napøíklad
v&nbsp;minulosti pomìrnì èasto pou¾ívaný <i>PCL</i> urèený pro laserové
tiskárny firmy HP èi formát HP-GL urèený pøedev¹ím pro plottery) je grafickou
informaci mo¾né v&nbsp;<i>PostScriptu</i> popsat plnohodnotným programovým
kódem s&nbsp;vyu¾itím promìnných, øídicích struktur, mo¾ností definice nových
slov (ty jsou obdobou procedur a maker), promìnných, slovníkù apod. I kdy¾ se
to v&nbsp;mnoha materiálech pøíli¹ nezdùrazòuje, je <i>PostScript</i>
turingovsky kompletním jazykem, tj.&nbsp;má stejnou vyjadøovací schopnost, jako
bì¾né programovací jazyky (a ty mají stejnou vyjadøovací schopnost, jako
Turingùv stroj).</p>

<a href="http://i.iinfo.cz/images/91/gui09-4.png"><img src="http://i.iinfo.cz/images/91/gui09-4-prev.png" width="370" height="217" alt=" " /></a>
<p><i>Obrázek 8: Grafické u¾ivatelské rozhraní NeXTSTEPu zùstalo z&nbsp;velké
míry zachováno ve správci oken Window Maker (zde ve variantì pro Linux &ndash;
Window Maker na Asus EEE).</i></p>

<p>Program napsaný v&nbsp;PostScriptu existuje v&nbsp;èitelné podobì ve formì
(skoro)textového souboru, který má vìt¹inou pøíponu <tt>.ps</tt> nebo
<tt>.eps</tt> (zapouzdøený PostScript). V&nbsp;tìchto souborech mohou být
ulo¾ena i binární data fontù, vlo¾ených bitmap apod., proto mohou nastat
problémy pøi ruèní editaci souboru v&nbsp;tìch textových editorech, které do
souboru nìkteré ne-alfanumerické znaky pøidávají, nebo naopak ubírají. Program
pro popis tiskové stránky mù¾e být v&nbsp;<i>PostScriptu</i> napsán velmi
èitelnì, nicménì prakticky v¹echny aplikace, které PostScriptový soubor
generují, produkují pro èlovìka neèitelný kód &ndash; prohlédnìte si napøíklad
PostScriptový výstup z&nbsp; T<sub>E</sub>Xu (generovaný vìt¹inou pøes
<i>dvips</i>, ale zde je neèitelnost dána i èastou aplikací kerningu) nebo
výstup z&nbsp;MS Wordu (obdobou prakticky neèitelného výstupu jsou i mnohé
WYSIWYG editory pro HTML èi XHTML, které také neprodukují zrovna èistý a
èitelný HTML kód).</p>

<a href="http://i.iinfo.cz/images/450/gui08-22.png"><img src="http://i.iinfo.cz/images/450/gui08-22-prev.png" width="338" height="270" alt=" " /></a>
<p><i>Obrázek 9: Dal¹í screenshot pracovní plochy poèítaèe s&nbsp;bì¾ícím
správcem oken Window Maker.</i></p>

<p>Na <i>PostScriptu</i> je zalo¾eno velké mno¾ství dal¹ích aplikací. Kromì ji¾
zmínìných programových prohlí¾eèù (<i>GhostView</i>, <i>KGhostView</i>) a
dal¹ích podobných komerèních programù i prohlí¾eèù ¹íøených pod svobodnými
licencemi, jsou to pøedev¹ím tiskové programy (ponìkud nesprávnì nazývané RIPy
&ndash; <i>Raster Image Processor(s)</i>), které mohou provádìt konverzi
PostScriptového souboru na bitmapy, je¾ se mají zobrazit èi vytisknout. Tyto
konverzní programy nejsou vlastnì nic jiného ne¾ plnohodnotné interpretry
programovacího jazyka <i>PostScript</i>, které postupnì zadaný program
vykonávají a podle volaných grafických funkcí mìní barvu jednotlivých pixelù
výsledné bitmapy. PostScriptové tiskárny a osvitové jednotky takté¾ obsahují
interpretr PostScriptu (RIP), který skládá jednotlivé stránky a postupnì je
tiskne. Na nìkterých tiskárnách jde také ovládat zabudovaný displej a
klávesnièku a psát pomocí pøíkazù PostScriptu humorné hlá¹ky obsluze.</p>



<p><a name="k04"></a></p>
<h2>4. Kreslení v&nbsp;PostScriptu s&nbsp;vyu¾itím cest a fontù</h2>

<p>Patrnì nejmocnìj¹í vlastností <i>PostScriptu</i> je jeho schopnost práce
s&nbsp;takzvanými cestami (<i>path(s)</i>). Ty byly díky své univerzalitì
pozdìji pøevzaty i do dal¹ích grafických formátù, napøíklad <strong>SVG &ndash;
Scalable Vector Graphics</strong>, na jejich¾ vývoji se takté¾ podílela firma
Adobe (vlastník licence PostScriptu). Ka¾dá cesta se skládá z&nbsp;otevøených
nebo uzavøených køivek, dokonce je mo¾né pøevádìt jednotlivé znaky na køivky.
Cesta má zadané základní vlastnosti, jako je typ èáry, výplòový vzorek, zpùsob
zakonèení a barvu (ta existuje pouze u novìj¹ích verzí PostScriptu &ndash;
konkrétnì od Levelu 2). Pomocí uzavøených cest lze také oøezávat èást obrázku a
cesty souèasnì slou¾í pro detekci pozice kurzoru v&nbsp;dále popsaném
<i>Display PostScriptu</i>. Parametry jednotlivých køivek, ze kterých je cesta
slo¾ena, se ukládají na datový zásobník a pøíslu¹ný pøíkaz
(<strong>moveto</strong>, <strong>lineto</strong>, <strong>curveto</strong>) si
ze zásobníku automaticky vybere tolik souøadnic, kolik jich pro svou èinnost
potøebuje. Vlastní vykreslení (rasterizace) cesty se provádí pomocí slova
<strong>stroke</strong>.</p>

<a href="http://i.iinfo.cz/images/91/gui09-5.png"><img src="http://i.iinfo.cz/images/91/gui09-5-prev.png" width="245" height="270" alt=" " /></a>
<p><i>Obrázek 10: Blokové schéma cvièného mikroprocesoru, které jsme pou¾ívali
pøi popisu funkce ALU a øadièe v&nbsp;paralelnì bì¾ícím seriálu o
architekturách poèítaèù. Toto schéma bylo nakresleno v&nbsp;aplikaci Open
Office.org Draw (dùvod, proè je tento obrázek zaøazen do tohoto èlánku, se
dozvíte o nìkolik centimetrù ní¾e :-).</i></p>

<p>V&nbsp;následující tabulce je vypsáno sedm základních pøíkazù pro práci
s&nbsp;cestami:</p>

<table>
<tr><th>Pøíkaz</th><th>Význam</th></tr>
<tr><td>newpath</td><td>vytvoøení nové cesty, která tak nenavazuje na cestu pøedchozí</td></tr>
<tr><td>moveto</td><td>pøesun aktivního bodu na zadané absolutní souøadnice bez kreslení</td></tr>
<tr><td>lineto</td><td>pøesun aktivního bodu na zadané absolutní souøadnice s&nbsp;kreslením</td></tr>
<tr><td>rmoveto</td><td>pøesun aktivního bodu na zadané relativní souøadnice bez kreslení</td></tr>
<tr><td>rlineto</td><td>pøesun aktivního bodu na zadané relativní souøadnice s&nbsp;kreslením</td></tr>
<tr><td>closepath</td><td>uzavøení cesty, poslední bod je spojen s&nbsp;bodem prvním</td></tr>
<tr><td>stroke</td><td>vykreslení cesty nastaveným stylem (implicitnì vlasová èára)</td></tr>
</table>

<a href="http://i.iinfo.cz/images/91/gui09-6.png"><img src="http://i.iinfo.cz/images/91/gui09-6-prev.png" width="245" height="270" alt=" " /></a>
<p><i>Obrázek 11: Èást PostScriptového souboru s&nbsp;obrázkem vý¹e zobrazeného
blokového schématu cvièného mikroprocesoru. Za pov¹imnutí stojí zejména zpùsob
definice nových slov (funkcí), napøíklad l = lineto, které vedou ke zkrácení
výsledného souboru.</i></p>

<p>Pøi kreslení, tj.&nbsp;zadávání souøadnic pro pøíkazy typu
<strong>moveto</strong>, <strong>lineto</strong> atd. se pou¾ívá délková
jednotka zvaná typografický bod (<i>point</i>), jeho¾ délka je rovna 1/72
palce. Pojem &bdquo;typografický bod&ldquo; je ponìkud matoucí, proto¾e
existuje více vzájemnì odli¹ných stejnì pojmenovaných délkových jednotek a o
jejich významu se typografové mnohdy pomìrnì vá¹nivì pøou (vyplývá to
z&nbsp;faktu, ¾e kolébkou typografie je sice Evropa, ale DTP vzniklo a bylo
nejvíce rozvinuto v&nbsp;USA). Faktem ov¹em zùstává, ¾e <i>PostScript</i> (a
zdaleka nejenom on, pov¹imnìte si zpùsobu zadávání velikosti písma v&nbsp;mnoha
programech &ndash; &bdquo;palcové titulky&ldquo; jsou sázeny 72bodovým fontem)
pova¾uje za svou jednotku právì 1/72 palce, tedy pøibli¾nì 0,3527 milimetru
(navíc i pùvodní <i>Macintosh</i> mìl rozli¹ení obrazovky upraveno tak, aby se
dobøe poèítalo s&nbsp;touto délkou). To v¹ak v&nbsp;¾ádném pøípadì neznamená,
¾e by jeden typografický bod byl tou nejmen¹í délkovou jednotkou, kterou je
mo¾né v&nbsp;<i>PostScriptu</i> pou¾ít. Norma pøedepisuje, ¾e se délky mohou
zapisovat i pomocí èísel s&nbsp;plovoucí øádovou èárkou, po¾adovaná pøesnost je
minimálnì ètyøi desetinná místa (pøesností se tedy v&nbsp;tomto ohledu blí¾íme
i k&nbsp;legendárnímu "superpøesnému" T<sub>E</sub>Xu).</p>

<p>Uka¾me si nyní velmi jednoduchý pøíklad, který pomocí osmice úseèek vykreslí
domeèek &bdquo;jednou èarou&ldquo; Pøíklad (který je mimochodem plnohodnotným
<i>PostScriptovým</i> programem!) nejdøíve vytvoøí novou cestu pøíkazem
<strong>newpath</strong>, posléze pøejde do poèáteèního bodu pøíkazem
<strong>moveto</strong> a následnì s&nbsp;vyu¾itím pøíkazu
<strong>lineto</strong> vykreslí zbytek cesty slo¾ený z&nbsp;na sebe
navazujících úseèek. Nakonec se pøíkazem <strong>stroke</strong> cesta vykreslí
(rasterizuje) a interpretr PostScriptu o cestì zapomene ve¹keré dal¹í údaje.
Poslední pøíkaz <strong>showpage</strong> zajistí vykreslení èi vyti¹tìní celé
stránky na obrazovku èi tiskárnu (v&nbsp;pøípadì EPS by v¹ak tento pøíkaz být
uveden naopak nesmìl &ndash; to si mù¾ete vyzkou¹et importem tohoto pøíkladu
napøíklad do nìkterého z&nbsp;vektorových editorù):</p>

<pre>
% Demonstracni priklad na vykresleni domecku
% pomoci osmi na sebe navazujicich usecek.
&nbsp;
newpath
100 100 moveto
400 100 lineto
100 400 lineto
100 100 lineto
400 400 lineto
100 400 lineto
250 550 lineto
400 400 lineto
400 100 lineto
&nbsp;
% rasterizace cesty
stroke
&nbsp;
% vykresleni cele stranky
showpage
</pre>

<a href="http://i.iinfo.cz/images/91/gui09-7.png"><img src="http://i.iinfo.cz/images/91/gui09-7-prev.png" width="226" height="270" alt=" " /></a>
<p><i>Obrázek 12: První demonstraèní pøíklad zobrazený v&nbsp;softwarovém
prohlí¾eèi PostScriptu.</i></p>



<p><a name="k05"></a></p>
<h2>5. Bézierovy køivky a fonty v&nbsp;PostScriptu</h2>

<p>Souèástí cest v&nbsp;<i>PostScriptu</i> mohou být i <i>Bézierovy køivky</i>.
Vzhledem k&nbsp;tomu, ¾e tyto køivky navazují na ji¾ nakreslené segmenty cesty,
znamená to, ¾e se pøi jejich specifikaci zadávají pouze tøi body: dva body
øídicí a jeden koncový bod. Zbývající koncový bod je tvoøen bodem, kterým cesta
doposud konèila. Je to podobné, jako pøi pøidávání úseèek do cest &ndash; také
jsme specifikovali pouze druhý koncový bod úseèky, první koncový bod nebylo
zapotøebí zadávat (viz pøedchozí demonstraèní pøíklad). Køivka je do aktuálnì
vytváøené cesty pøidána pøíkazem <strong>curveto</strong>. Tento pøíkaz si pøi
svém spu¹tìní (zavolání) vyzvedne ze zásobníku souøadnice tøí bodù, vytvoøí
køivku (vìt¹inou ji ihned pøevede na sadu úseèek &ndash; to ov¹em zále¾í na
konkrétní implementaci SW nebo HW RIPu) a pøidá takto rozlo¾enou køivku do
cesty. Pøi pøevodu Bézierovy køivky na úseèky se køivka rekurzivnì dìlí a¾ do
okam¾iku, kdy je rozdíl mezi skuteèným prùbìhem køivky a její aproximací men¹í
ne¾ hodnota plochosti (<i>flatness</i>). Uka¾me si v¹e na jednoduchém
demonstraèním pøíkladu:</p>

<pre>
% Demonstracni priklad na vykresleni sady Bezierovych krivek.
&nbsp;
% prvni krivka
newpath
 50 700
moveto
 50 800
150 800
150 700
curveto
% rasterizace cesty
stroke
&nbsp;
% druha krivka
newpath
 50 550
moveto
100 650
100 650
150 550
curveto
% rasterizace cesty
stroke
&nbsp;
% treti krivka
newpath
 50 400
moveto
125 500
 75 500
150 400
curveto
% rasterizace cesty
stroke
&nbsp;
% ctvrta krivka
newpath
 50 250
moveto
150 350
 50 350
150 250
curveto
% rasterizace cesty
stroke
&nbsp;
% pata krivka (se smyckou)
newpath
 75 100
moveto
150 200
 50 200
125 100
curveto
% rasterizace cesty
stroke
&nbsp;
% cesta v prave casti papiru
newpath
200 800
moveto
% zacneme useckou
400 800
lineto
% a hladce navazeme krivkou
600 800
600 700
400 700
curveto
200 700
200 600
400 550
curveto
600 500
600 450
400 400
curveto
200 350
200 450
400 450
curveto
% hladce navazeme useckou
500 450
lineto
% oblouk - ridici body jsou shodne!
550 450
550 450
550 400
curveto
% opet hladce navazeme useckou
550 200
lineto
% rasterizace cesty
stroke
&nbsp;
% vykresleni cele stranky
showpage
</pre>

<a href="http://i.iinfo.cz/images/91/gui09-8.png"><img src="http://i.iinfo.cz/images/91/gui09-8-prev.png" width="217" height="270" alt=" " /></a>
<p><i>Obrázek 13: Druhý demonstraèní pøíklad zobrazený v&nbsp;softwarovém
prohlí¾eèi PostScriptu.</i></p>

<p>Nedílnou souèástí <i>PostScriptu</i> je i práce s&nbsp;fonty. Systém
pou¾ívající <i>PostScript</i> (prohlí¾eè, RIP v&nbsp;tiskárnì, systémová
knihovna operaèního systému <i>NeXTSTEP</i>...) mù¾e pou¾ívat více rùzných typù
fontù. Vìt¹inou se jedná o fonty, v&nbsp;nich¾ jsou jednotlivé znaky popsány
svým (vektorovým) obrysem, mù¾e se v¹ak jednat i o fonty rastrové (bitmapové).
Dále popsaný <i>Display PostScript</i> navíc obsahuje i podporu pro rastrové
fonty s&nbsp;rozli¹ením shodným s&nbsp;rozli¹ením obrazovky, které se
vykreslují mnohem rychleji ne¾ písma zadaná svým obrysem. Práce s&nbsp;fonty je
v&nbsp;<i>PostScriptu</i> velmi jednoduchá, co¾ je ukázáno na následujícím
demonstraèním pøíkladu (dùvod pro tuto jednoduchost je zøejmý &ndash; prvotním
úkolem <i>PostScriptu</i> byla tvorba sice slo¾itých dokumentù, které se v¹ak
stále skládaly pøedev¹ím z&nbsp;textu). Ve zdrojovém kódu tøetího
demonstraèního pøíkladu si pov¹imnìte, jakým zpùsobem je nejdøíve nastaven
poèáteèní bod vykreslovaného textu a jak je text vykreslený pøíkazem
<strong>show</strong> zapsán do kulatých závorek:</p>

<pre>
% Demonstracni priklad na pouziti fontu.
&nbsp;
% podkladovy text - musi byt uveden jako prvni
&nbsp;
% vyhledani fontu
/Helvetica findfont
220 scalefont
setfont
200 350 moveto
0.8 0.8 1.0 setrgbcolor
(42) show
&nbsp;
% ostatni text je zobrazen cernou barvou
&nbsp;
0 0 0 setrgbcolor
&nbsp;
/Helvetica findfont
40 scalefont
setfont
200 300 moveto
(Hello world!) show
&nbsp;
/Times-Roman findfont
40 scalefont
setfont
200 350 moveto
(Hello world!) show
&nbsp;
/Bookman findfont
40 scalefont
setfont
200 400 moveto
(Hello world!) show
&nbsp;
/Palatino findfont
40 scalefont
setfont
200 450 moveto
(Hello world!) show
&nbsp;
/Zapf-Chancery findfont
40 scalefont
setfont
200 500 moveto
(Hello world!) show
&nbsp;
% vykresleni cele stranky
showpage
</pre>

<a href="http://i.iinfo.cz/images/91/gui09-9.png"><img src="http://i.iinfo.cz/images/91/gui09-9-prev.png" width="216" height="270" alt=" " /></a>
<p><i>Obrázek 14: Tøetí demonstraèní pøíklad zobrazený v&nbsp;softwarovém
prohlí¾eèi PostScriptu.</i></p>



<p><a name="k06"></a></p>
<h2>6. Zásobníkový programovací jazyk a tvorba nových slov (funkcí)</h2>

<p>Kromì &bdquo;pouhého&ldquo; kreslení je v¹ak mo¾né v&nbsp;<i>PostScriptu</i>
psát i plnohodnotné programy. Programovací jazyk PostScript je, podobnì jako <a
href="http://www.root.cz/serialy/programovaci-jazyk-forth/">programovací jazyk
Forth</a> èi tradièní <a
href="http://www.root.cz/clanky/matematika-v-prikazove-radce-iv-utilita-dc-1/">unixová
utilita dc</a>, postavený nad abstraktním (virtuálním) nìkolikazásobníkovým
procesorem. Z&nbsp;tohoto dùvodu se pøi programování v&nbsp;PostScriptu
nevyhneme èastým manipulacím se zásobníky, zejména se zásobníkem operandù. Tyto
manipulace se buï provádí pomocí explicitnì zadaných pøíkazù (napøíklad
duplikace hodnoty ulo¾ené na zásobníku pomocí operátoru <strong>dup</strong>)
nebo implicitními operacemi (napøíklad pøi provádìní matematických výpoètù nebo
pøi volání vestavìných funkcí). Mezi pøíkazy, které se zásobníkem manipulují
implicitnì patøí ji¾ døíve popsané funkce, jakou je <strong>moveto</strong>,
která ze zásobníku pøeète a posléze odstraní dva èíselné parametry
pøedstavující pozici bodu v&nbsp;rovinì.</p>

<img src="http://i.iinfo.cz/images/91/gui09-10.png" width="320" height="240" alt=" " />
<p><i>Obrázek 15: Základní operace s&nbsp;abstraktním datovým typem zásobník
(stack).</i></p>

<p>Zásobníky jsou v&nbsp;PostScriptu pou¾ity z&nbsp;nìkolika dùvodù. Asi
nejvýznamnìj¹ím dùvodem je to, ¾e se &bdquo;zásobníkový kód&ldquo; velmi
jednodu¹e a pøitom rychle interpretuje. Ostatnì mnoho abstraktních
(virtuálních) procesorù je právì z&nbsp;tohoto dùvodu postaveno na zásobnících;
typickým pøíkladem je virtuální zdroj jazyka <i>Java</i> (JVM) èi
<i>Pythonu</i>. Nenechte se zmást pamì»ovou nároèností Javy &ndash; pøíèina
jejích mnohdy obrovských pamì»ových nárokù netkví v&nbsp;zásobníkovém kódu
(právì naopak), ale v&nbsp;tom, ¾e se pro ka¾dý i sebemen¹í javovský program
naèítá prakticky celé bìhové prostøedí Javy s&nbsp;nìkolika tisíci tøídami a
rozhraními a ¾e i krátké programy manipulují se stovkami a tisíci objekty. Ale
napøíklad <i>Java Kilobyte Machine</i> resp.&nbsp; KVM bì¾í, kromì PDA a
mobilních telefonù, i na staøièkém ZX Spectru! Dal¹í pøíèinou pou¾ití zásobníkù
v&nbsp;PostScriptu je unifikace v¹ech operací. Zatímco se v&nbsp;bì¾né
matematice vyskytují v¹echny tøi zápisy matematických výrazù (prefixový,
infixový i postfixový) a je definitoricky stanovena priorita nìkterých
operátorù, <i>PostScript</i> pou¾ívá v¹ude pouze postfixový zápis.</p>

<p>Nepøímo s&nbsp;tím souvisí i zpùsob ukládání parametrù na zásobník pøed
voláním funkcí a mo¾nost návratu více hodnot z&nbsp;funkce (pou¾ito napøíklad
pøi manipulaci s&nbsp;transformaèními maticemi). Tøetí pøíèinou pou¾ití
zásobníkù v&nbsp;<i>PostScriptu</i> je pomìrnì znaèná obliba <i>Forthu</i>
v&nbsp;dobì jeho návrhu. Ostatnì volba programovacího jazyka na základì jeho
oblíbenosti také není nièím novým &ndash; staèí se podívat na historii COBOLu
èi Javy. Nicménì pro mnoho programátorù bylo pou¾ití postfixové notace a
zásobníkù pomìrnì komplikované, co¾ vedlo ke vzniku pøekladaèe (èi spí¹e
transformátoru) z&nbsp;jazyka <i>C</i> do <i>PostScriptu</i> (a v&nbsp;kontextu
tohoto èlánku je zajímavé, ¾e tento pøekladaè vznikl právì pro operaèní systém
<i>NeXTSTEP</i>).</p>

<p>Dùle¾itou souèástí <i>PostScriptu</i>, která usnadòuje modularizaci
v&nbsp;nìm psaných programù, je mo¾nost vytváøení nových slov (funkcí) pomocí
pøíkazu <strong>def</strong>. V&nbsp;následujícím demonstraèním programu je
ukázáno, jak lze pomocí nových slov <strong>m</strong>, <strong>lc</strong>
atd. zkrátit soubor s&nbsp;jednoduchým obrázkem:</p>

<pre>
/m {moveto} def
/l {lineto} def
/c {curveto} def
/n {newpath} def
/s {stroke} def
/lc {setlinecap} def
/lj {setlinejoin} def
5.0 setlinewidth
0 lc
0 lj n 50 700 m 150 800 l 50 800 l 150 700 l s
1 lj n 50 550 m 150 650 l 50 650 l 150 550 l s
2 lj n 50 400 m 150 500 l 50 500 l 150 400 l s
n 50 250 m 150 350 50 350 150 250 c s
1 lc
0 lj n 250 700 m 350 800 l 250 800 l 350 700 l s
1 lj n 250 550 m 350 650 l 250 650 l 350 550 l s
2 lj n 250 400 m 350 500 l 250 500 l 350 400 l s
n 250 250 m 400 350 200 350 350 250 c s
2 lc
0 lj n 450 700 m 550 800 l 450 800 l 550 700 l s
1 lj n 450 550 m 550 650 l 450 650 l 550 550 l s
2 lj n 450 400 m 550 500 l 450 500 l 550 400 l s
n 500 250 m 600 350 400 350 500 250 c s
showpage
</pre>



<p><a name="k07"></a></p>
<h2>7. Øídicí pøíkazy (podmínky a programové smyèky)</h2>

<p>Prakticky jakýkoli programovací jazyk, který má být reálnì pou¾itelný i pro
tvorbu slo¾itìj¹ích programù, ne¾ jednoduchých maker èi prostých
nìkolikaøádkových seznamù pøíkazù, které se mají postupnì provést, obsahuje
nìkterou z&nbsp;technologií urèených pro øízení bìhu programu. Tato technologie
je typicky implementovaná ve formì zavedených a takøka univerzálnì
pojmenovaných strukturovaných pøíkazù typu &bdquo;if-then-else&ldquo;
(resp.&nbsp;pouze pøíkazu &bdquo;if-then&ldquo; neobsahujícího vìtev
&bdquo;else&ldquo;) popø.&nbsp;pøíkazù typu &bdquo;switch-case&ldquo; (co¾ je
ve své podstatì pouze jiná podoba rozeskokù). Tyto pøíkazy jsou v&nbsp;rùzné
syntaktické podobì obsa¾eny prakticky ve v¹ech programovacích jazycích
pocházejících z&nbsp;algolské vìtve vývoje, vèetnì Pascalu, Céèka i Javy a lze
je samozøejmì pou¾ít i v&nbsp;<i>PostScriptu</i>:</p>

<pre>
x y gt {(x je vetsi nez y)} if
&nbsp;
x y lt
    {(x je mensi nez y)}
    {(y je mensi nebo rovno x)}
ifelse
</pre>

<p>Programovací jazyk <i>PostScript</i> obsahuje i nìkolik operátorù, pomocí
kterých je mo¾né sestrojit programové smyèky, tj.&nbsp;opakující se èásti
programového kódu. Z&nbsp;praktických dùvodù se v&nbsp;programovacích jazycích
vyskytují pøedev¹ím dva typy smyèek: poèítané a nepoèítané smyèky
(popø.&nbsp;smyèky typu &bdquo;for each&ldquo;, které pøebírají vìt¹inu dobrých
vlastností smyèek poèítaných, pøièem¾ tyto smyèky roz¹iøují iterování pøes
pole, seznamy, n-tice èi slovníky). <i>PostScript</i> obsahuje
z&nbsp;poèítaných smyèek smyèku typu <i>repeat</i> a smyèku typu
<i>for</i>:</p>

<pre>
10 {(tato smyèka probìhne desetkrát)} repeat
</pre>

<p>Pøíklady pou¾ití smyèky typu <strong>for</strong>:</p>

<pre>
1 1 10 {} for     % na zásobník se ulo¾í èíselná sekvence 1 2 3 4 5 6 7 8 9 10
0 2 10 {} for     % na zásobník se ulo¾í èíselná sekvence 0 2 4 6 8 10
10 1 0 {} for     % tato smyèka neprobìhne ani jedenkrát
0 -1 10 {} for    % ani tato smyèka nebude spu¹tìna
0 1 1 4 {add} for % provede se souèet 0+1+2+3+4=10
3 -.5 1 { } for   % na zásobník se ulo¾í èíselná sekvence 3.0 2.5 2.0 1.5 1.0
</pre>

<p>Následuje nepatrnì slo¾itìj¹í pøíklad vyu¾ívající poèítanou smyèku typu
<strong>for</strong> pro vykreslení jednoduchého obrázku slo¾eného
z&nbsp;nìkolika úseèek. V&nbsp;tìle smyèky je vyu¾ito hodnoty jejího poèitadla
pro výpoèet koncových souøadnic vykreslovaných úseèek. Ka¾dá úseèka tvoøí
samostatnou cestu, ale bylo by mo¾né vytvoøit i cestu jedinou, slo¾enou
z&nbsp;na sebe NEnavazujících èástí. Podobným zpùsobem je mo¾né vykreslit
napøíklad i pravidelnou møí¾ku, logaritmickou møí¾ku, horizontální èi
vertikální pravítko apod. &ndash; to jsou operace, které se v&nbsp;prakticky
v¹ech vektorových editorech tvoøí pomìrnì slo¾itì a pøitom mohou být
v&nbsp;mnoha pøípadech u¾iteèné.</p>

<pre>
50 10 400 {    % inicializace smycky for
    newpath    % vytvoreni nove cesty
        % instrukce   zasobnik
        dup         % i i
        50          % i i 50
        moveto      % i        - moveto si vzala souradnici (i, 50)
        400         % i 400
        exch        % 400 i
        lineto      % --       - lineto si vzala souradnici (400, i)
    stroke     % rasterizace cesty
} for
showpage       % a vykresleni cele stranky
</pre>

<img src="http://i.iinfo.cz/images/91/gui09-11.png" width="210" height="210" alt=" " />
<p><i>Obrázek 16: Výsledek zobrazení PostScriptového souboru obsahujícího vý¹e
uvedený kód s&nbsp;poèítanou smyèkou typu &bdquo;for&ldquo;.</i></p>

<p>Zcela univerzálním typem smyèky v&nbsp;<i>PostScriptu</i> je nepoèítaná
smyèka typu <strong>loop</strong>. Ta je ji¾ ze své podstaty smyèkou
nekoneènou, tj.&nbsp;ukonèení smyèky je nutné explicitnì provést pomocí pøíkazu
<strong>exit</strong> èi <strong>stop</strong>. Pøíkazy <strong>exit</strong> a
<strong>stop</strong> se od sebe odli¹ují pøedev¹ím tím, ¾e se po zavolání
pøíkazu <strong>exit</strong> provede automatický úklid zásobníku tak, aby na
nìm byly ulo¾eny pouze ty hodnoty, které se zde nacházely pøed inicializací a
spu¹tìním smyèky, zatímco pøíkaz <strong>exit</strong> pouze smyèku ukonèí a
¾ádné manipulace se zásobníkem neprovádí. Vzhledem k&nbsp;tomu, ¾e smyèka typu
<strong>loop</strong> nemodifikuje obsah zásobníku operandù (tj.&nbsp;neukládá
zde hodnotu poèitadla ani nepotøebuje ¾ádné inicializaèní hodnoty), mají
v&nbsp;tomto pøípadì pøíkazy <strong>exit</strong> a <strong>stop</strong>
stejný význam (u dal¹ích smyèek to v¹ak neplatí, proto se u nich vìt¹inou volá
pouze pøíkaz <strong>exit</strong>).</p>

<img src="http://i.iinfo.cz/images/91/gui09-12.png" width="340" height="488" alt=" " />
<p><i>Obrázek 17: Fraktál vytvoøený pomocí ní¾e uvedeného demonstraèního
pøíkladu (je vhodné jej spou¹tìt spí¹e v&nbsp;softwarovém prohlí¾eèi a nikoli
na sdílené sí»ové tiskárnì :-)</i></p>

<p>Abychom si ukázali nìkteré schopnosti <i>PostScriptu</i> a souèasnì i
vlastnosti programové smyèky <strong>loop</strong>, je v&nbsp;následujícím
pøíkladu (jedná se o ètyøøádkovou signaturu) ukázán program, který po svém
spu¹tìní na tiskárnì nebo v&nbsp;softwarovém prohlí¾eèi po urèité dobì zobrazí
slo¾itý dynamický systém (<i>GhostView</i> umí stránku zobrazovat pøímo
v&nbsp;prùbìhu vykreslování, na rozdíl od bì¾né tiskárny :-). Celý program má i
s&nbsp;dvojicí poznámek délku pouze 296 bajtù, zatímco výsledný (RIPovaný) PNG
soubor celých 164 kB. Navíc samozøejmì nelze výsledný bitmapový obrázek
zvìt¹ovat beze ztráty kvality:</p>

<pre>
/d{def}def/a{add}d/s{sub}d/u{usertime}d % Alun Jones, IBS, UW Aberystwyth
/x 0 d/y 0 d 9 9 scale 35 47 translate/b u d .1 setlinewidth{u b s 6e4 gt
{exit}if/x x 4 a d/v 1 x s d/x y 2 x mul 3 s abs sqrt x 0 lt{neg}if a d/y
v d x y moveto .1 0 rlineto stroke}loop showpage% You may need %!PS-Adobe
</pre>

<img src="http://i.iinfo.cz/images/91/gui09-13.png" width="340" height="450" alt=" " />
<p><i>Obrázek 18: Pøedchozí demonstraèní pøíklad (signatura) pøepsaný do
èitelnìj¹ího kódu.</i></p>



<p><a name="k08"></a></p>
<h2>8. Display PostScript &ndash; pou¾ití PostScriptu pøi práci s&nbsp;obrazovkou (nejenom) v&nbsp;systému NeXTSTEP</h2>

<p>V&nbsp;pøedchozích pìti kapitolách jsme se struènì seznámili
s&nbsp;programovacím jazykem <i>PostScript</i> a v&nbsp;nìkterých odstavcích
jsme se takté¾ zmínili o urèitých specifických vlastnostech <i>Display
PostScriptu</i>. O co se vlastnì v&nbsp;pøípadì <i>Display PostScriptu</i>
jedná? <i>Display PostScript</i>, který budeme v&nbsp;dal¹ím textu oznaèovat
zkratkou <i>DSP</i>, byl navr¾en firmou Adobe pro práci s&nbsp;vektorovou i
bitmapovou grafikou na obrazovkách i pøi tvorbì grafického u¾ivatelského
rozhraní. <i>DSP</i> byl pou¾it na nìkterých systémech vyvíjených firmou
<i>Xerox</i> (¹lo o jednu z&nbsp;posledních významných poèinù této spoleènosti
v&nbsp;oblasti grafických u¾ivatelských rozhraní) a pøedev¹ím dnes popisovaným
operaèním systémem <i>NeXTSTEP</i>. <i>DSP</i> se sestává z&nbsp;více èástí,
pøedev¹ím z&nbsp;upraveného interpretru <i>PostScriptu</i> a takté¾
z&nbsp;rozhraní urèeného pro programovací jazyk C (Objective-C), které
zpøístupòuje základní funkcionalitu <i>DSP</i> aplikacím. Toto rozhraní se
nazývá <i>pswrap</i>.</p>

<p>Dùle¾ité je, ¾e obì èásti <i>DSP</i>, tj.&nbsp;jak interpret
<i>PostScriptu</i>, tak i rozhraní pro dal¹í programovací jazyky, jsou zcela
nezávislé na parametrech grafického systému, tj.&nbsp;na rozli¹ení obrazovky èi
na poètu zobrazitelných barev. V&nbsp;<i>DSP</i> je navíc implementováno pouze
vykreslování do ji¾ existujících oken, co¾ mj.&nbsp;znamená, ¾e tato okna musí
být vytvoøena jinými prostøedky, a» ji¾ v&nbsp;rámci technologie pou¾ité
v&nbsp;operaèním systému <i>NeXTSTEP</i> nebo (pøedev¹ím na PC èi grafických
stanicích) systémem oken <i>X</i> (<i>X Window System</i>). Jinými slovy
&ndash; <i>DSP</i> se vùbec nestará o to, jakým zpùsobem jsou okna vytvoøena
ani jak s&nbsp;nimi u¾ivatel manipuluje. Na následujícím obrázku je naznaèeno,
jakým zpùsobem lze <i>DSP</i> zaèlenit do dnes standardního desktopového
systému s&nbsp;<i>X</i> klienty a <i>X</i> servery. Aby <i>DSP</i> mohl splnit
svoji roli pøi práci s&nbsp;obrazovkou i pøi tvorbì grafického u¾ivatelského
rozhraní, bylo nutné v&nbsp;nìkolika ohledech roz¹íøit jeho funkcionalitu.</p>

<img src="http://i.iinfo.cz/images/91/gui09-14.png" width="407" height="270" alt=" " />
<p><i>Obrázek 19: Zaèlenìní Display PostScriptu do systému NeXTSTEP.</i></p>

<p>Vzhledem k&nbsp;nìkterým rozdílùm mezi tiskárnami a obrazovkami (pøedev¹ím
se jedná o øádový rozdíl v&nbsp;rozli¹ení) se v&nbsp;<i>DSP</i> roz¹íøila
podpora pro bitmapové fonty optimalizované pro aktuálnì pou¾ívané rozli¹ení
obrazovky. Zatímco obrysové fonty mají nespornou výhodu v&nbsp;tom, ¾e je lze
prakticky beze ztráty kvality zvìt¹ovat a v&nbsp;urèité míøe zmen¹ovat, je u
nízkých rozli¹ení (obrazovky monitorù) a typických velikostí písma 9 a¾ 12 bodù
nutné provádìt ruèní optimalizaci vykreslovaných znakù takovým zpùsobem, aby
napøíklad tlou¹»ka svislých èar byla shodná (asi by nebylo pìkné vidìt
napøíklad malé &bdquo;m&ldquo; vykreslené tak, ¾e krajní no¾ièky budou mít
¹íøku dvou pixelù a prostøední no¾ièka pouze jednopixelovou tlou¹»ku).
V&nbsp;<i>DSP</i> se pro tento úèel pou¾ívají bitmapová písma se znaky
definovanými pro ka¾dou velikost písma zvlá¹» (zvìt¹ování a zmen¹ování bitmap
by v&nbsp;tomto pøípadì vedlo k&nbsp;velké degradaci kvality písma).</p>

<p>U obrazovkových bitmapových fontù má navíc ka¾dý znak pøesnì definovanou
¹íøku specifikovanou v&nbsp;celoèíselných násobcích pixelù a souèasnì i ¹íøku
zadanou v&nbsp;typografických bodech. To má svùj význam, proto¾e bitmapové
znaky je nutné vykreslovat jako skuteèné bitmapy, co¾ v¹ak mù¾e vést
k&nbsp;tomu, ¾e text zobrazený na obrazovce by neodpovídal textu vyti¹tìnému na
tiskárnì. Teoreticky toti¾ u ka¾dého bitmapového znaku mù¾e kvùli zaokrouhlení
jeho ¹íøky na celé pixely dojít k&nbsp;chybì o velikosti a¾ poloviny pixelu
(znak je potom pøi vykreslení o jeden pixel ¹ir¹í èi naopak u¾¹í), co¾
napøíklad pøi 80 znacích na jedné øádce mù¾e vést a¾ ke kumulaci chyby o
velikosti nìkolika desítek pixelù! <i>DSP</i> tento problém øe¹í tak, ¾e jsou
znaky sice v&nbsp;rámci jednoho slova usazovány na celoèíselné souøadnice, ale
souøadnice následujícího <strong>slova</strong> jsou ji¾ poèítány pøesnì
&ndash; jako souèet pøesných ¹íøek znakù pøedchozího slova spolu se zapoètením
podøezávání atd. (<i>DSP</i> má tedy dvojí souèasnì pou¾ívaný souøadný
systém).</p>

<p>Dále je v&nbsp;<i>DSP</i> upraven subsystém slou¾ící pro dithering a
halftoning, tj.&nbsp;zdánlivého zvy¹ování poètu souèasnì zobrazitelných barev
kombinací barev sousedních pixelù. Algoritmy ditheringu a halftoningu pou¾ité
pøi tisku toti¾ mohou na obrazovce tvoøit nepøíjemné vizuální chyby, pøedev¹ím
v&nbsp;tìch pøípadech, kdy se obsah okna posouvá (scrolluje). Programátor mù¾e
v&nbsp;tomto pøípadì urèit pozici bodu, od kterého se vzorek vznikající
halftoningem zaèíná vykreslovat.</p>

<a href="http://i.iinfo.cz/images/91/gui09-15.png"><img src="http://i.iinfo.cz/images/91/gui09-15-prev.png" width="370" height="116" alt=" " /></a>
<p><i>Obrázek 20: Display PostScript pøi pou¾ití spolu se systémem oken
X.</i></p>

<p>Vý¹e uvedené zmìny èi pøesnìji øeèeno roz¹íøení <i>DSP</i> spoèívají zejména
v&nbsp;úpravì vykreslovacích algoritmù s&nbsp;ohledem na jinou technologii
zobrazení dat na obrazovce oproti tisku na tiskárnám. Ov¹em dùle¾itìj¹í jsou
zmìny související s&nbsp;okny a GUI. Pøedev¹ím se jedná o komunikaci se
správcem oken, díky ní¾ je napøíklad mo¾né zajistit, aby se pøekreslovala pouze
èást celé kreslicí plochy &ndash; napøíklad pøi animaci stisku tlaèítka na
obrazovce zajisté není nutné pøekreslovat celou pracovní plochu aplikace,
zejména v&nbsp;tom pøípadì, ¾e je viditelná pouze malá èást této plochy.
Z&nbsp;tohoto dùvodu lze definovat oblast, která se má pøekreslit, pøièem¾ tato
oblast je definována pomocí obecné cesty (!), nikoli pouze obdélníku, jak je
tomu v&nbsp;jiných systémech.</p>

<p>S&nbsp;touto novou funkcí souvisí i dal¹í zmìna &ndash; v&nbsp;klasickém
<i>PostScriptu</i> je mo¾né pomocí slova <strong>def</strong> vytváøet objekty,
které jsou pojmenované. Mù¾e se napøíklad jednat o funkci (slovo), které slou¾í
k&nbsp;vykreslení ji¾ zmínìného tlaèítka s&nbsp;nápisem. Ov¹em pojmenování
objektù pomocí øetìzcù je nároèné na technické prostøedky poèítaèe (rychlost
procesoru a kapacitu operaèní pamìti) a navíc nevhodné pøi volání
postscriptového kódu z&nbsp;céèkových programù. Z&nbsp;tohoto dùvodu lze
v&nbsp;<i>DSP</i> novì vytváøeným objektùm pøiøadit celoèíselný identifikátor,
ke kterému lze pøistupovat jak z&nbsp;vlastního <i>PostScriptu</i>, tak i
z&nbsp;céèkového/Objective-C programu.</p>

<img src="http://i.iinfo.cz/images/91/gui09-16.png" width="377" height="564" alt=" " />
<p><i>Obrázek 21: Struktura aplikace vyu¾ívající Display PostScript a knihovny
systému oken X.</i></p>

<p>Pøi tisku (spu¹tìní) postscriptového programu na tiskárnì èi
v&nbsp;programovém RIPu je celé vykreslení spu¹tìno jako jediný proces,
tj.&nbsp;tiskárna èi SW RIP si musí vytvoøit pouze jednu transformaèní matici,
jednu pamì»ovou oblast pro promìnné a u¾ivatelské funkce, jeden zásobník
operandù atd. Toto v¹ak v&nbsp;¾ádném pøípadì neplatí v&nbsp;<i>DSP</i>, kdy je
ka¾dé okno vykreslováno nezávisle na ostatních oknech a to dokonce ve stejném
okam¾iku. Z&nbsp;tohoto dùvodu zavádí <i>DSP</i> podporu pro soubì¾nou práci
vìt¹ího mno¾ství postscriptových procesù, a tato podpora je dokonce dota¾ena do
té míry, ¾e jednotlivé postscriptové procesy (zvané kontexty) spolu mohou
v&nbsp;pøípadì potøeby komunikovat, sdílet si promìnné nebo se navzájem
synchronizovat. Samozøejmì je mo¾né nastavit míru izolace jednotlivých procesù,
proto¾e je nepøípustné, aby jedna ¹patnì napsaná aplikace blokovala v¹echny
ostatní programy pou¾ívající GUI. Pro úèely vytváøení nových postscriptových
procesù byla v&nbsp;<i>DSP</i> nadefinována nová slova, jejich¾ význam je
vìt¹inou zøejmý: <strong>fork, join, detach, currentcontext, wait, monitor,
yield, lock, condition</strong>.</p>

<p>Poslední nová vlastnost zavedená v&nbsp;rámci <i>DSP</i> souvisí se zpìtnou
vazbou mezi grafickým oknem a aplikací, které toto okno nále¾í. Aplikace
v&nbsp;jednom smìru provádí vykreslování pomocí <i>DSP</i> do okna, ov¹em
v&nbsp;opaèném smìru musí mít mo¾nost zjistit, na kterém místì v&nbsp;oknì se
nachází kurzor my¹i. Na zcela nejni¾¹í úrovni to samozøejmì není prakticky
¾ádný problém, proto¾e správce oken vrátí souøadnice my¹i v&nbsp;oknì (x,y).
Tato informace je v¹ak nedostaèující v&nbsp;pøípadì slo¾itìj¹ích aplikací, kdy
je napøíklad nutné zjistit, zda u¾ivatel klikl na vykreslené tlaèítko, obrázek
vedle tlaèítka, na nìjaké zobrazené slovo atd.</p>

<p>Samozøejmì je mo¾né si pøímo v&nbsp;aplikaci vést &bdquo;evidenci&ldquo;
tvarù v¹ech objektù vykreslených v&nbsp;oknì, ov¹em to je zbyteènì pracné.
Namísto toho je v&nbsp;<i>DSP</i> zavedena podpora pro takzvanou <i>hit
detection</i> (detekci zásahu), její¾ princip je v&nbsp;podstatì velmi
jednoduchý &ndash; lze testovat, zda by byl zvolený bod (vìt¹inou pøeètené
souøadnice kurzoru my¹i) vykreslený nìjakou kreslicí èi vyplòovací operací,
tj.&nbsp;zda le¾í <strong>na</strong> zvolené cestì èi <strong>uvnitø</strong>
vyplnìné cesty. Toté¾ je mo¾né zjistit pro definované okolí tohoto bodu (jedná
se vìt¹inou o malou kru¾nici, ètverec èi diamant se støedem v&nbsp;tomto bodì).
Okolí bodu se pou¾ívá pøedev¹ím pro &bdquo;chytání&ldquo; koncových bodù úseèek
ve vektorových grafických editorech èi CAD programech, ménì èasto ji¾ pro
uzavøené tvary.</p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na dal¹í informaèní zdroje</h2>

<ol>

<li>Adobe Systems: <i>PostScript Language Reference Manual, The Red Book</i>,<br />
Adobe Systems Incorporated, 2nd ed., Addison Wesley 1990.</li>

<li><i>Adobe Type 1 Font Format</i> (vèetnì ukázek s&nbsp;pou¾itím smyèek),<br />
Addison-Wesley</li>

<li><i>PostScript Language Program Design</i>,<br />
Addison-Wesley 1990, ISBN 0-201-14396-8</li>

<li><i>PostScript Language Reference Manual</i>,<br />
Addison-Wesley 1990, ISBN 0-201-18127-4</li>

<li><i>PostScript Language Tutorial and Cookbook</i>,<br />
Addison-Wesley 1990, ISBN 0-201-10179-3</li>

<li>Display PostScript<br />
<a href="http://c2.com/cgi/wiki?DisplayPostscript">http://c2.com/cgi/wiki?DisplayPostscript</a>
</li>

<li>Display PostScript<br />
<a href="http://en.wikipedia.org/wiki/Display_PostScript">http://en.wikipedia.org/wiki/Display_PostScript</a>
</li>

<li>Network Extensible Window System<br />
<a href="http://c2.com/cgi/wiki?NetworkExtensibleWindowSystem">http://c2.com/cgi/wiki?NetworkExtensibleWindowSystem</a>
</li>

<li><i>PostScript fractals</i>,<br />
<a href="http://www.pvv.ntnu.no/~andersr/fractal/PostScript.html">http://www.pvv.ntnu.no/~andersr/fractal/PostScript.html</a></li>

<li><i>Fractal generation</i>,<br />
<a href="http://www.chez.com/emarsden/downloads/">http://www.chez.com/emarsden/downloads/</a></li>

<li>Paul Bourke: <i>PostScript Tutorial</i>,<br />
<a href="http://local.wasp.uwa.edu.au/~pbourke/dataformats/postscript/">http://local.wasp.uwa.edu.au/~pbourke/dataformats/postscript/</a></li>

<li><i>A First Guide to PostScript</i>,<br />
<a href="http://www.tailrecursive.org/postscript/postscript.html">http://www.tailrecursive.org/postscript/postscript.html</a></li>

<li>A History of the GUI (6) - More GUIs of the 1980s<br />
<a href="http://arstechnica.com/old/content/2005/05/gui.ars/6">http://arstechnica.com/old/content/2005/05/gui.ars/6</a>
</li>

<li>Chronology of Workstation Computers<br />
<a href="http://www.islandnet.com/~kpolsson/workstat/">http://www.islandnet.com/~kpolsson/workstat/</a>
</li>

<li>NeXTSTEP (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/NeXTSTEP">http://en.wikipedia.org/wiki/NeXTSTEP</a>
</li>

<li>NeXTSTEP (Wikipedia CS)<br />
<a href="http://cs.wikipedia.org/wiki/NeXTSTEP">http://cs.wikipedia.org/wiki/NeXTSTEP</a>
</li>

<li>NeXT Computers<br />
<a href="http://www.nextcomputers.org/">http://www.nextcomputers.org/</a>
</li>

<li>The NeXT Computer Historical Site<br />
<a href="http://simson.net/ref/NeXT/">http://simson.net/ref/NeXT/</a>
</li>

<li>NeXT Computers Specification<br />
<a href="http://simson.net/ref/NeXT/specifications.htm">http://simson.net/ref/NeXT/specifications.htm</a>
</li>

<li>NeXT (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/NeXT">http://en.wikipedia.org/wiki/NeXT</a>
</li>

<li>NeXTstation Overview and technical details<br />
<a href="http://lowendmac.com/next/nextstation.html">http://lowendmac.com/next/nextstation.html</a>
</li>

<li>NeXTstation (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/NeXTstation">http://en.wikipedia.org/wiki/NeXTstation</a>
</li>

<li>Window Maker<br />
<a href="http://en.wikipedia.org/wiki/Window_maker">http://en.wikipedia.org/wiki/Window_maker</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

