<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Pou¾ití LISPu v&nbsp;praxi &ndash; AutoCAD a AutoLISP</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Pou¾ití LISPu v&nbsp;praxi &ndash; AutoCAD a AutoLISP</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V&nbsp;dne¹ní èásti seriálu o historii výpoèetní techniky si uká¾eme jednu pomìrnì dùle¾itou oblast informatiky, ve které byl s&nbsp;velkým úspìchem pou¾it dialekt programovacího jazyka LISP. Jedná se o známou aplikaci AutoCAD s&nbsp;AutoLISPem pozdìji pøejmenovaným na Visual LISP.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Programování v&nbsp;LISPu prakticky &ndash; AutoCAD a AutoLISP</a></p>
<p><a href="#k02">2. Úspìch &bdquo;skriptovatelného&ldquo; CADu</a></p>
<p><a href="#k03">3. Roz¹iøování repertoáru pøíkazù AutoCADu</a></p>
<p><a href="#k04">4. Volání funkcí AutoLISPu jako bì¾ných AutoCADových pøíkazù</a></p>
<p><a href="#k05">5. Opaèný problém &ndash; volání AutoCADových výrazù z&nbsp;AutoLISPu</a></p>
<p><a href="#k06">6. Grafická databáze AutoCADu</a></p>
<p><a href="#k07">7. Slo¾itìj¹í AutoLISPovské programy</a></p>
<p><a href="#k08">8. Literatura</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Programování v&nbsp;LISPu prakticky &ndash; AutoCAD a AutoLISP</h2>

<p>V&nbsp;pøedchozích èástech tohoto seriálu jsme si popsali základní
vlastnosti programovacího jazyka <i>LISP</i> a také jsme se zmínili o nìkterých
vlastnostech (pøedev¹ím makrech) zavedených v&nbsp;jednom
z&nbsp;nejroz¹íøenìj¹ích dialektù tohoto jazyka &ndash; <i>Common Lispu</i>.
Zpoèátku, zejména na pøelomu ¹edesátých a sedmdesátých let minulého století, se
programovací jazyk <i>LISP</i> a jeho dialekty (pøedev¹ím <i>Scheme</i>) ¹íøil
a pou¾íval pøedev¹ím mezi komunitou vìdcù zabývajících se výzkumem umìlé
inteligence a expertních systémù, ov¹em posléze se nìkteré jeho vlastnosti
ukázaly být výhodné i pro znaènì odli¹né typy aplikací.
Pøíkladem mù¾e být známý skriptovatelný textový editor <a
href="http://www.gnu.org/software/emacs/emacs.html">Emacs</a>, jeho¾ první
verze byla vyvinuta <i>Richardem Stallmanem</i> spolu s&nbsp;<i> Guyem
L.&nbsp;Steelem</i>, o nìm¾ se je¹tì v&nbsp;tomto seriálu nìkolikrát zmíníme,
proto¾e se mj.&nbsp;jedná i o spolutvùrce programovacího jazyka <i>Scheme</i>.
Vra»me se v¹ak k&nbsp;pou¾ití programovacího jazyka <i>LISP</i> ve významných
&bdquo;velkých&ldquo; aplikacích.</p>

<p>Mezi u¾ivateli osobních poèítaèù (PC) se ji¾ po velmi dlouhou dobu tì¹í
znaèné popularitì CAD systém <i>AutoCAD</i>, jeho¾ první verze vznikla
v&nbsp;poèítaèovém dávnovìku, konkrétnì v&nbsp;roce 1982. Jednou z&nbsp;pøíèin
oblíbenosti <i>AutoCADu</i> byl i fakt, ¾e tento nástroj obsahoval i interpret
programovacího jazyka <i>LISP</i> odvozený od DOSové verze <i>XLispu</i>. Tento
interpret byl zpoèátku pojmenován <i>AutoLISP</i>, jeho pozdìj¹í verze se
pøejmenovaly na <i>Visual LISP</i>. Skripty psané v&nbsp;<i>AutoLISPu</i> mohly
být pou¾ity pro velmi mnoho úèelù, napøíklad mohly roz¹iøovat repertoár pøíkazù
dostupných u¾ivateli (tyto pøíkazy bylo mo¾né pøidat do roletových menu,
výbìrových formuláøù i takzvaného obrazovkového menu zobrazeného vìt¹inou na
pravém okraji obrazovky &ndash; toto menu je vlastnì pøedchùdcem dne¹ních
toolbarù), provádìt nìkdy i velmi komplikované operace s&nbsp;nakreslenými
grafickými entitami èi se dokonce jednalo o mnohdy velmi rozsáhlé nadstavby nad
celým <i>AudoCADem</i> &ndash; existovaly napøíklad nadstavby urèené pro tvorbu
stavebních výkresù, elektrických schémat, architektonických výkresù èi map
(automatická tvorba vrstevnic, speciálních typù èar se symboly &ndash;
elektrická èi plynová vedení) atd.</p>



<p><a name="k02"></a></p>
<h2>2. Úspìch &bdquo;skriptovatelného&ldquo; CADu</h2>

<p>V&nbsp;souèasnosti není podpora skriptování ve vìt¹ích aplikacích nièím
zvlá¹tní èi dokonce revoluèní, viz napøíklad rùzné balíèky &bdquo;office&ldquo; vybavené
interpretrem jazyka (Visual) Basic, Python atd., èi plnì skriptovatelné webové
prohlí¾eèe (Firefox), ov¹em v&nbsp;dobách DOSu a (vìt¹inou) uzavøených CAD systémù
umo¾nil <i>AutoCAD</i>, aby se na roz¹iøování jeho funkcionality podíleli i
zruènìj¹í u¾ivatelé èi dal¹í firmy, které tak vlastnì firmì AutoDesk (výrobci
<i>AutoCADu</i>) zvy¹ovaly obrat, proto¾e se <i>AutoCAD</i> mohl pou¾ívat i
v&nbsp;tìch oblastech, pro které pùvodnì nebyl urèený (na druhou stranu je dnes
kromì &bdquo;plného&ldquo; <i>AutoCADu</i> nabízena i znaènì levnìj¹í varianta
<i>AutoCAD LT</i>, která je v&nbsp;oblasti skriptování omezena). Pro ukázku
mo¾ností skriptování <i>AutoCADu</i> se podívejte, jakým zpùsobem bylo mo¾né
modifikovat menu nabízené tabletem (na tablet se pøikládala fólie nebo
speciální ¹ablona, na ní¾ byly pøedti¹tìny ikony jednotlivých pøíkazù). Podobné
LISPovské funkce bylo mo¾né naèítat pøímo pøi startu <i>AutoCADu</i>,
resp.&nbsp;pøi otevírání jednotlivých výkresù (vlastnost autoload):</p>

<pre>
;;; Set alternate tablet menus based on cfg settings
(defun set_alt_tabs ()

    ;; check for active tablet areas
    (setq T_Menu (read (ai_popmenucfg "T_Menu")))
    (mapcar
        '(lambda (x y z)
            (if (= (logand x T_Menu) x)
                (progn
                    (menucmd (strcat "T" y "=TABLET" y "ALT"))
                    (if (/= "" (getcfg "CfgData/Editor/TabletMenusActive"))
                        (eval z)
                    )
                )
            )
        )
        '(1 2 4 8)
        '("1" "2" "3" "4")
        '(
            (princ ;|ACAD_MNL_6|;"\nAlternativní oblast tabletu 1 naètena.  ")
            (princ ;|ACAD_MNL_10|;"\nAlternativní oblast tabletu 2 naètena.  ")
            (princ ;|ACAD_MNL_14|;"\nAlternativní oblast tabletu 3 naètena.  ")
            (princ ;|ACAD_MNL_18|;"\nAlternativní oblast tabletu 41 naètena.  ")
        )
    )
    (if (and (/= "" (getcfg "CfgData/Editor/TabletMenusActive"))
            (/= 0 T_Menu)
        )
        (terpri)
    )
    (setq set_alt_tabs nil)
)
</pre>



<p><a name="k03"></a></p>
<h2>3. Roz¹iøování repertoáru pøíkazù AutoCADu</h2>

<p>Nejèastìj¹ím pou¾itím programovacího jazyka AutoLISP v&nbsp;AutoCADu byla
tvorba pomìrnì jednoduchých funkcí, které roz¹iøovaly repertoár pøíkazù
nabízených samotným AutoCADem. Pøi tvorbì funkcí v&nbsp;AutoLISPu bylo
samozøejmì mo¾né pou¾ívat prakticky v¹echny mo¾nosti nabízené grafickým
u¾ivatelským rozhraním AutoCADu. Napøíklad zavolání funkce <i>(getpoint
"libovolná textová zpráva")</i> z&nbsp;LISPovského programu vedlo k&nbsp;tomu,
¾e se u¾ivateli zobrazilo zvolené textové hlá¹ení na textové konzoli (nebo na
posledních øádcích grafické obrazovky) s&nbsp;tím, ¾e u¾ivatel mohl my¹í,
tabletem èi s&nbsp;pomocí klávesnice provést výbìr bodu ve výkresu, samozøejmì
s&nbsp;vyu¾itím v¹ech dostupných uchopovacích re¾imù (<i>osnap modes</i>),
které AutoCAD nabízel &ndash; získání koncového bodu úseèky èi jiné entity,
prostøedního bodu úseèky, støedu kru¾nice èi oblouku, prùseèíku dvou entit
atd. Bod vrácený funkcí <i>(getpoint)</i> obsahoval tøi souøadnice [x,y,z]
(jednalo se o bì¾ný LISPovský seznam), nezávisle na tom, jakým zpùsobem byly
tyto souøadnice získány. Pokud napøíklad u¾ivatel potøeboval pou¾ívat funkci
pro výpoèet vzdálenosti dvou bodù (ve skuteènosti by to nepotøeboval, proto¾e
taková funkce ji¾ existuje :-), mohl si ji jednodu¹e vytvoøit:</p>

<pre>
(defun vzdalenost ()
    (setq bod1 (getpoint "\nZadej poèáteèní bod: ") )
    (setq bod2 (getpoint "\nZadej koncový bod: ") )
    (distance bod1 bod2)
)
</pre>

<p>Zavolání této funkce mohlo být provedeno buï z&nbsp;menu (to bylo plnì
konfigurovatelné) nebo pøímo z&nbsp;pøíkazové øádky AutoCADu. Pov¹imnìte si
pou¾ití závorek pøi volání funkce z&nbsp;pøíkazového øádku i toho, ¾e poslední
výraz ve funkci <i>vzdalenost</i> je souèasnì i její návratovou hodnotou, která
je vypsána na textovou konzoli pøi návratu z&nbsp;funkce (pokud by poslední
pøíkaz nevracel ¾ádnou hodnotu, vypí¹e se <strong>nil</strong>, co¾ se dá
potlaèit napøíklad zavoláním funkce <i>(princ)</i>):</p>

<pre>
(vzdalenost)
</pre>



<p><a name="k04"></a></p>
<h2>4. Volání funkcí AutoLISPu jako bì¾ných AutoCADových pøíkazù</h2>

<p>Ov¹em nutnost psaní závorek pøi volání funkce <i>(vzdalenost)</i> ukázané
v&nbsp;pøedchozí kapitole by bì¾né u¾ivatele zbyteènì mátla a zdr¾ovala.
Z&nbsp;tohoto dùvodu bylo mo¾né, aby se pøed jméno libovolné LISPovské funkce
pøidala dvojice znakù <strong>C:</strong>. Takto pojmenovaná funkce se pak
mohla volat (spou¹tìt) stejnì jako jiný AutoCADovský pøíkaz, napøíklad
<strong>line</strong>, <strong>insert</strong> èi <strong>chprop</strong>:</p>

<pre>
(defun C:vzdalenost ()
    (setq bod1 (getpoint "\nZadej poèáteèní bod: ") )
    (setq bod2 (getpoint "\nZadej koncový bod: ") )
    (distance bod1 bod2)
)
</pre>

<p>Volání z&nbsp;pøíkazové øádky ji¾ nemù¾e být jednodu¹¹í:</p>

<pre>
vzdalenost
</pre>



<p><a name="k05"></a></p>
<h2>5. Opaèný problém &ndash; volání AutoCADových výrazù z&nbsp;AutoLISPu</h2>

<p>V&nbsp;mnoha pøípadech v¹ak programátoøi stáli pøed opaèným problémem
&ndash; potøebovali z&nbsp;<i>AutoLISPovského</i> programu zavolat nìjaký
u¾ivatelský pøíkaz AutoCADu, napøíklad ve chvíli, kdy potøebovali nakreslit
nìjakou grafickou entitu, zmìnit její atributy (barvu, hladinu, typ èáry, text)
atd. Tvùrci AutoCADu sice mohli zpøístupnit &bdquo;pouze&ldquo; aplikaèní
programové rozhraní (API) celého systému, ov¹em to by znamenalo, ¾e by se
programátoøi museli uèit stejné funkce dvakrát &ndash; jednou by se jednalo o
u¾ivatelské pøíkazy (<strong>line</strong> &ndash; nakreslení èáry,
<strong>copy</strong> &ndash; kopie objektu èi objektù, <strong>zoom</strong>
&ndash; zmìna pohledu), podruhé o funkci API. Namísto toho dali tvùrci AutoCADu
v¹em programátorùm kromì vlastního API k&nbsp;dispozici jedinou funkci nazvanou
jednodu¹e <i>(command)</i>, které bylo mo¾né pøedat jak témìø libovolný
AutoCADovský u¾ivatelský pøíkaz, tak i parametry tohoto pøíkazu (a to stejným
zpùsobem, jakým se zadávají pøi interaktivním zavolání tohoto pøíkazu
z&nbsp;AutoCADu).</p>

<p>Napøíklad vý¹e zmínìné programové vykreslení úseèky by se mohlo zajistit
jedním z&nbsp;následujících volání funkce <i>(command)</i>. Jednotlivá volání
se li¹í pouze tím, ¾e v&nbsp;prvním pøípadì jsou v¹echny parametry pøedány
formou øetìzcù (podobnì, jako by je zapisoval u¾ivatel na klávesnici) a ve
druhém pøípadì jako èíselné hodnoty umístìné v&nbsp;seznamech, tj.&nbsp;tak,
jak je mù¾e sestavit jakýkoli program. Posledním parametrem je prázdný øetìzec,
kterým je pøíkaz <strong>line</strong> ukonèený, stejnì jako v&nbsp;samotném
AutoCADu, kde se pou¾ívá buï mezerník nebo klávesa Enter:</p>

<pre>
(command "line" "0,0" "100,100", "" )

; apostrof pøed obìma seznamy je nutný, aby se
; LISP nepokou¹el seznamy vyhodnotit
(command "line" '(0 0) '(100 100) "" )
</pre>

<p>Ve star¹ích verzích AutoCADu neexistoval pøíkaz pro vykreslení osovì
orientovaného obdélníka, ov¹em není ¾ádný problém si ho dopsat. Na následujícím
pøíkladu je asi nejzajímavìj¹í zpùsob vytvoøení druhého a ètvrtého bodu,
proto¾e je nutné pou¾ít funkci <i>(list)</i> pro tvorbu seznamu. Posledním
parametrem pøíkazu <strong>pline</strong> (polyèára) je øetìzec
&bdquo;close&ldquo;, kterým je polyèára uzavøena, tak¾e vytvoøí polygon:</p>

<pre>
(defun C:obdelnik()
    (setq bod1 (getpoint "\nZadej poèáteèní bod obdélníka: ") )
    (setq bod3 (getpoint "\nZadej protilehlý bod obdélníka: ") )
    (setq bod2 (list (car bod3) (cadr bod1) ) )
    (setq bod4 (list (car bod1) (cadr bod3) ) )
    (command "PLINE" bod1 bod2 bod3 bod4 "CLOSE")
)
</pre>



<p><a name="k06"></a></p>
<h2>6. Grafická databáze AutoCADu</h2>

<p>V¹echny vý¹e ukázané demonstraèní pøíklady byly pomìrnì jednoduché &ndash;
v&nbsp;podstatì se jednalo o obdoby maker, jak je známe napøíklad z&nbsp;balíku
aplikací OpenOffice.org. Ov¹em programátoøi v&nbsp;AutoLISPu mohli pøímo
pøistupovat ke grafické databázi samotného AutoCADu, tj.&nbsp;k&nbsp;interním
datovým strukturám, ze kterých je vytvoøen celý výkres, co¾ se ukázalo být
velmi silným prostøedkem, zejména pøi tvorbì slo¾itìj¹ích nadstaveb. Výkres lze
pova¾ovat za mno¾inu grafických entit a ka¾dá entita má na sobì navázáno
mno¾ství atributù &ndash; kromì geometrických informací (pozice koncových bodù
úseèky, støed kru¾nice a její polomìr atd.) se jedná napøíklad o hladinu, ve
které se entita nachází, barvu entity, typ èáry a mnohé dal¹í. Pøístup
k&nbsp;této databázi umo¾òuje provádìt rùzné výbìry entit èi modifikaci jejich
atributù. Následující pøíklad spoèítá v¹echny úseèky, které se výkrese
nachází:</p>

<pre>
; **********************************************************
; tato funkce vrátí poèet v¹ech úseèek ve výkrese
; **********************************************************
(defun lines_count ()
    ; poèitadlo entit
    (setq count 0)
    ; první entita v grafické databázi
    (setq entity (entnext))

    ; iterování seznamem v¹ech entit
    (while entity
        ; získat seznam základních dat entity
        (setq entity_data (entget entity))

        ; pokud se jedná o úseèku
        (if (= "LINE" (cdr (assoc 0 entity_data)))
            ; zvý¹í se poèitadlo úseèek
            (setq count (1+ count))
        )
        ; pøechod na dal¹í entitu ve výkresu
        (setq entity (entnext entity))
    )   ;konec while

    ; hodnota posledního výrazu ve funkci je i její návratovou hodnotou
    count
)
</pre>

<p>Jak jsme si ji¾ øekli, je mo¾né atributy entit ve výkrese takté¾ mìnit,
napøíklad pøesunout v¹echny úseèky do zvolené hladiny:</p>

<pre>
; **********************************************************
; tato funkce pøesune v¹echny úseèky do zvolené hladiny
; **********************************************************
;presun vsech kruznic do jine hladiny
(defun change_lines_layer (new_layer)
    ; poèitadlo entit
    (setq count 0)
    ; první entita v grafické databázi
    (setq entity (entnext))

    ; iterování seznamem v¹ech entit
    (while entity
        ; získat seznam základních dat entity
        (setq entity_data (entget entity))

        ; pokud se jedná o úseèku
        (if (= "LINE" (cdr (assoc 0 entity_data)))
            ; programový blok
            (progn
                ; zvý¹í se poèitadlo úseèek
                (setq count (1+ count))
                ; zmìna atributù grafické entity
                ; ka¾dý atribut je dvojice kód atributu:hodnota atributu
                (setq entity_data (subst (cons 8 new_layer) (assoc 8 entity_data) entity_data))
                (entmod entity_data)
            )
        )

        ; pøechod na dal¹í entitu ve výkresu
        (setq entity (entnext entity))
    )   ;konec while
    ; hodnota posledního výrazu ve funkci je i její návratovou hodnotou
    count
)
</pre>



<p><a name="k07"></a></p>
<h2>7. Slo¾itìj¹í AutoLISPovské programy</h2>

<p>V&nbsp;této kapitole se uká¾eme dva ponìkud slo¾itìj¹í AutoLISPovské
programy. První pøíklad ukazuje pou¾ití rekurze pøi vykreslení takzvané Draèí
køivky (<i>Dragon curve</i>), která má fraktální strukturu. Tento pøíklad se
skládá ze dvou funkcí. První funkce je u¾ivatelská (volá ji u¾ivatel
z&nbsp;AutoCADu) a slou¾í k&nbsp;inicializaci v¹ech potøebných parametrù. Druhá
funkce provádí vlastní vykreslování s&nbsp;rekurzivním zanoøením, pøi nìm¾ se
zkracuje délka vykreslovaných segmentù. Pokud je délka men¹í ne¾ zadaná
hodnota, je rekurze ukonèena:</p>

<pre>
; **********************************************************
; Inicializaèní funkce pro vykreslení fraktální Draèí køivky
; **********************************************************
(defun C:drak (/ point1 segment-length min-segment-length)
    (setq point1 (getpoint "\nEnter origin of curve: ")
    (setq segment-length (getdist "\nEnter length of one segment: ")
    (setq min-segment-length (getdist "\nEnter minimal segment length: "))
    ; vypnutí opisu v¹ech pøíkazù na terminál
    (setvar "cmdecho" 0)
    ; vypnutí vykreslování pomocných bodù
    (setvar "blipmode" 0) ;vypne pomocné body
    ; zaèátek vykreslování polyèáry
    (command "PLINE" point1)
    (dragon-curve segment-length 0 1 min-segment-length)
    ; konec vykreslování polyèáry
    (command "")
    ; zapnutí opisu v¹ech pøíkazù na terminál
    (setvar "cmdecho" 1)
)

; **********************************************************
; Tato funkce generuje fraktální (rekurzivní) Draèí køivku
; **********************************************************
(defun dragon-curve (segment-length uhel sign min-segment-length)
    (cond
        ( (&lt; segment-length min-segment-length)
            (command (polar (getvar "LASTPOINT") uhel segment-length))
        )
        ; vìtev "else"
        ( T
            ; zkrácení délky segmentu o odmocninu ze dvou
            ; a provedení rekurze
            (dragon-curve (/ segment-length (sqrt 2.0))
                (+ uhel (* sign (/ pi 4.0)))
                1.0
                min-segment-length
            )
            ; zkrácení délky segmentu o odmocninu ze dvou
            ; a provedení rekurze
            (dragon-curve (/ segment-length (sqrt 2.0))
                (- uhel (* sign (/ pi 4.0)))
                -1.0
                min-segment-length
            )
        )
    )
)
</pre>

<p>Druhou AutoLISPovskou aplikaci jsem naprogramoval kdysi dávno pro dávkové
pøevody souborù z&nbsp;formátu <i>DXF</i> (tyto soubory byly generovány mimo
AutoCAD) do formátu <i>DWF</i>. Dùvod tohoto pøevodu byl jednoduchý &ndash;
výkresy ve formátu <i>DWF</i> je mo¾né vystavit na internetu nebo intranetu,
proto¾e pro jejich prohlí¾ení existují volnì dostupné prohlí¾eèe (buï jde o
samostatné aplikace nebo o pluginy do prohlí¾eèù). Na dále vypsané aplikaci je
zajímavé pøedev¹ím to, ¾e je napsána èistì imperativnì, na rozdíl od LISPaøi
prosazovaného funkcionálního pøístupu:</p>

<pre>
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
;: Jednoducha aplikace pro davkovy prevod vykresove dokumentace
;: z formatu DXF do formatu DWF
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;



;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
; Tato funkce slouzi k vymazani vsech entit z aktualne editova-
; neho vykresu. Soucasne s entitami dojde k vymazani vsech
; dalsich AutoCADovskych objektu, jako jsou typy car, dostupne
; fonty, hladiny a bloky.
;
; parametry: zadne
; vystupni hodnota: zadna
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
(defun erase_drawing( / i)
    (command "_erase" "_all" "")
    (command "_purge" "_all" "*" "_n")
)



;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
; Tato funkce funguje jako filtr, ktery ze jmena vstupniho
; souboru vytvori jmeno souboru vystupniho. Prevod se
; provadi tak, ze se odmaze jmeno koncovky vstupniho souboru
; (koncovka by mela byl .dxf) a pripoji se koncovka nova
; (v nasem konkretnim pripade .dwf).
;
; parametry: jmeno vstupniho souboru s koncovkou DXF
; vystupni hodnota: jmeno vystupniho souboru s koncovkou DWF
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
(defun create_output_name(input_file_name / output_file_name name_length)
    (setq output_file_name "")
    (setq name_length (- (strlen input_file_name) 4)) 
    (setq output_file_name (substr input_file_name 1 name_length))
    (setq output_file_name (strcat output_file_name ".dwf"))
)



;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
; Pomocna funkce provadejici import vykresu z formatu DXF
; a nasledny zoom na celou plochu vykresu
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
(defun import_and_zoom(input_file_name)
    (command "_dxfin" input_file_name)
    (command "_zoom" "_all")
)



;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
; Tato funkce prevede jeden vykres ze souboroveho formatu DXF do
; vystupniho souboroveho formatu DWF. Vystupni vykres ma pritom
; rozmery upravene tak, aby ho bylo mozne vytisknout na list
; papiru o normovane velikosti A3.
;
; parametry: jmeno vstupniho souboru s koncovkou DXF a DWF
; vystupni hodnota: zadna
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
(defun create_dwf_a3(input_file_name output_file_name)
    (import_and_zoom input_file_name)
    (command "_plot" "_y" "" "DWF ePlot.pc3"
             "ISO A3 (420.00 x 297.00 MM)"
             "M" "K" "N" "" "" "" "_n" ""
             "_n" "_n" output_file_name "_y" "_y")
    (princ)
)



;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
; Tato funkce prevede jeden vykres ze souboroveho formatu DXF do
; vystupniho souboroveho formatu DWF. Vystupni vykres ma pritom
; rozmery upravene tak, aby ho bylo mozne vytisknout na list
; papiru o normovane velikosti A3.
;
; parametry: jmeno vstupniho souboru s koncovkou DXF a DWF
; vystupni hodnota: zadna
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
(defun create_dwf_a4(input_file_name output_file_name)
    (import_and_zoom input_file_name)
    (command "_plot" "_y" "" "DWF ePlot.pc3"
             "ISO A4 (210.00 x 297.00 MM)"
             "M" "K" "N" "" "" "" "_n" ""
             "_n" "_n" output_file_name "_y" "_y")
    (princ)
)



;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
; Tato funkce prevede vsechny vykresy v adresari ze souboroveho
; formatu DXF do souboroveho formatu DWF. Pokud se na konci
; jmena souboru vyskytuje znak 'H', provede se prevod na papir
; velikosti A4, v opacnem pripade se prevadi na papir velikosti
; A3.
;
; parametry: zadne
; vystupni hodnota: zadna
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
(defun C:convert_all( / cmd_echo work_dir dirlist fout)
    (command "_UNDO" "_C" "_O")
    (command "_UNDO" "_C" "_N")
    ; zapamatujeme si stav promenne prostredi CMDECHO
    (setq cmd_echo (getvar "CMDECHO"))
    (setvar "CMDECHO" 0)
    (setvar "SDI" 1)
    ; typ dialogu pro vyber souboru
    (setvar "FILEDIA" 0)
    ; nastavit promennou podle implicitniho ulozeni vykresu
    (setq work_dir "")
    ; uzivatel si vybere jeden vstupni soubor
    (setq work_dir (getfiled "Vyber jeden soubor z pracovniho adresare" work_dir "dxf" 0))
    ; zobrazeni terminalu
    (command "_textscr")
    (if (not (null work_dir))
        (progn
            ; vykousnuti adresare z celeho jmena souboru
            (setq work_dir (vl-filename-directory work_dir))
            (princ (strcat "Vypis vsech souboru v adresari " work_dir))
            ; ziskani vsech souboru se zadanou priponou
            (setq dirlist (vl-directory-files work_dir "*.dxf" 1))
            ; pro jistotu otestujeme spravnost naplneni seznamu,
            ; i kdyz by mel byt vzdy vytvoreny korektne
            (if (null work_dir)
                (progn
                    (princ "zadny soubor nenalezen")
                    (exit)
                )
            )
            ; logovaci soubor
            (setq fout (open "dxf2dwf.log" "w"))
            ; prochazeni celym seznamem s nalezenymi soubory
            (while (not (null dirlist))
                (setq full_name (strcat work_dir "\\" (car dirlist)))
                (print full_name)
                (princ full_name fout)

                ; test, zda konec jmena souboru neobsahuje na konci znak 'H'
                (setq name_length (- (strlen full_name) 4))
                (setq name_res (substr full_name name_length 1))
                (erase_drawing)
                (setq output_file_name (create_output_name full_name))
                ; kontrolni vypis nazvu vstupniho a vystuphiho souboru
                (print input_file_name)
                (print output_file_name)
                (if (= name_res "H")
                    ; obsahuje "H"
                    (create_dwf_a4 full_name output_file_name)
                    ; neobsahuje "H"
                    (create_dwf_a3 full_name output_file_name)
                )
                (princ "\n" fout)
                (setq dirlist (cdr dirlist))
            )
            (close fout)
        )
        (princ "Zadny soubor nebyl vybran")
    )
    (setvar "CMDECHO" cmd_echo)
    (prin1)
)

;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
;; finito
;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
</pre>



<p><a name="k08"></a></p>
<h2>8. Literatura</h2>

<ol>

<li>Hillis, D.<br />
<i>&bdquo;New Computer Architectures and Their Relationship to Physics or Why CS is No Good&ldquo;</i></br>
Int J. Theoretical Physics 21 (3/4) 255-262.
</li>

<li>Lewis W. Tucker, George G. Robertson,<br />
<i>&bdquo;Architecture and Applications of the Connection Machine&ldquo;</i></br>
Computer, vol. 21, no. 8, pp. 26&ndash;38, August, 1988.
</li>

<li>Arthur Trew and Greg Wilson (eds.) (1991)<br />
<i>&bdquo;Past, Present, Parallel: A Survey of Available Parallel Computing Systems&ldquo;</i></br>
New York: Springer-Verlag. ISBN 0-387-19664-1.
</li>

<li>W. Daniel Hillis and Lewis W. Tucker<br />
<i>&bdquo;The CM-5 Connection Machine: A Scalable Supercomputer&ldquo;</i></br>
In Communications of the ACM, Vol. 36, No. 11 (November 1993)
</li>

<li>Cliff Lasser, Jeff Mincy, J.P. Massar<br />
<i>&bdquo;The Essential *LISP Manual&ldquo;</i></br>
Thinking Machines Corporation, 1986.
</li>

<li>Anonymous<br />
<i>&bdquo;Getting Started in *Lisp, Version 6.1&ldquo;</i></br>
Thinking Machines Corporation, Cambridge, Massachusetts, June 1991.
</li>

<li>Anonymous<br />
<i>&bdquo;*Lisp Dictionary&ldquo;</i></br>
Thinking Machines Corporation, Cambridge, Massachusetts.
</li>

<li>Anonymous<br />
<i>&bdquo;*Lisp Timesharing User's Guide&ldquo;</i></br>
Online at CMU AI Repository
</li>

<li>Zdzislaw Meglicki<br />
<i>&bdquo;The CM5 *Lisp Course&ldquo;</i></br>
Centre for Information Science Research, The Australian National University, 1994
</li>

<li>McCarthy<br />
<i>&bdquo;Recursive functions of symbolic expressions and their computation by machine, part I&ldquo;</i><br />
1960
</li>

<li>Guy L. Steele<br />
<i>&bdquo;History of Scheme&ldquo;</i><br />
2006, Sun Microsystems Laboratories
</li>

<li>
Koláø J., Muller K.:<br />
<i>&bdquo;Speciální programovací jazyky&ldquo;</i><br />
Praha 1981
</li>

<li>
<i>&bdquo;AutoLISP Release 9, Programmer's reference&ldquo;</i><br />
Autodesk Ltd., October 1987
</li>

<li>
<i>&bdquo;AutoLISP Release 10, Programmer's reference&ldquo;</i><br />
Autodesk Ltd., September 1988
</li>

<li>McCarthy, John; Abrahams, Paul W.; Edwards, Daniel J.; Hart, Timothy P.; Levin, Michael I.<br />
<i>&bdquo;LISP 1.5 Programmer's Manual&ldquo;</i><br />
MIT Press. ISBN 0 262 130 1 1 4
</li>

<li>Carl Hewitt; Peter Bishop and Richard Steiger<br />
<i>&bdquo;A Universal Modular Actor Formalism for Artificial Intelligence&ldquo;</i><br />
1973
</li>

<li>Feiman, J.<br />
<i>&bdquo;The Gartner Programming Language Survey (October 2001)&ldquo;</i><br />
Gartner Advisory
</li>

</ol>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>GNU Emacs<br />
<a href="http://www.gnu.org/software/emacs/emacs.html">http://www.gnu.org/software/emacs/emacs.html</a>
</li>

<li>Emacs<br />
<a href="http://en.wikipedia.org/wiki/Emacs">http://en.wikipedia.org/wiki/Emacs</a>
</li>

<li>AutoCAD<br />
<a href="http://en.wikipedia.org/wiki/Autocad">http://en.wikipedia.org/wiki/Autocad</a>
</li>

<li>AutoLISP<br />
<a href="http://en.wikipedia.org/wiki/AutoLISP">http://en.wikipedia.org/wiki/AutoLISP</a>
</li>

<li>(welcome '(schemers . org))<br />
<a href="http://www.schemers.org/">http://www.schemers.org/</a>
</li>

<li>Revised<sup>5</sup> Report on the Algorithmic Language Scheme<br />
<a href="http://www.schemers.org/Documents/Standards/R5RS/">http://www.schemers.org/Documents/Standards/R5RS/</a>
</li>

<li>The Revised<sup>6</sup> Report on the Algorithmic Language Scheme<br />
<a href="http://www.r6rs.org/">http://www.r6rs.org/</a>
</li>

<li>Scheme<br />
<a href="http://groups.csail.mit.edu/mac/projects/scheme/">http://groups.csail.mit.edu/mac/projects/scheme/</a>
</li>

<li>The Kawa language framework<br />
<a href="http://www.gnu.org/software/kawa/">http://www.gnu.org/software/kawa/</a>
</li>

<li>Scheme 48<br />
<a href="http://s48.org/">http://s48.org/</a>
</li>

<li>Introductory textbooks for Schemers<br />
<a href="http://www.schemers.org/Documents/#intro-texts">http://www.schemers.org/Documents/#intro-texts</a>
</li>

<li>Scheme (programming language)<br />
<a href="http://en.wikipedia.org/wiki/Scheme_(programming_language)">http://en.wikipedia.org/wiki/Scheme_(programming_language)</a>
</li>

<li>Scheme<br />
<a href="http://cs.wikipedia.org/wiki/Scheme">http://cs.wikipedia.org/wiki/Scheme</a>
</li>

<li>Scheme-faq<br />
<a href="http://community.schemewiki.org/?scheme-faq">http://community.schemewiki.org/?scheme-faq</a>
</li>

<li>Scheme implementations<br />
<a href="http://community.schemewiki.org/?scheme-faq-standards#implementations">http://community.schemewiki.org/?scheme-faq-standards#implementations</a>
</li>

<li>Successful Scheme<br />
<a href="http://www.itworld.com/swol-1013-regex">http://www.itworld.com/swol-1013-regex</a>
</li>

<li>Why Java (and almost every other programming language) sucks (lisp)<br />
<a href="http://www.perkiset.org/forum/pythonlispschemeerlangobscurities/why_java_and_almost_every_other_programming_language_sucks_lisp-t26.0.html;msg57#msg57">http://www.perkiset.org/forum/pythonlispschemeerlangobscurities/why_java_and_almost_every_other_programming_language_sucks_lisp-t26.0.html;msg57#msg57</a>
</li>

<li>PLT Scheme<br />
<a href="http://www.plt-scheme.org/">http://www.plt-scheme.org/</a>
</li>

<li>Guy L. Steele, Jr.<br />
<a href="http://en.wikipedia.org/wiki/Guy_L._Steele">http://en.wikipedia.org/wiki/Guy_L._Steele</a>
</li>

<li>Gerald Jay Sussman<br />
<a href="http://en.wikipedia.org/wiki/Gerald_Jay_Sussman">http://en.wikipedia.org/wiki/Gerald_Jay_Sussman</a>
</li>

<li>Lecture Notes: Macros<br />
<a href="http://www.apl.jhu.edu/~hall/Lisp-Notes/Macros.html">http://www.apl.jhu.edu/~hall/Lisp-Notes/Macros.html
</a>
</li>

<li>Common Lisp's Loop Macro Examples for Beginners<br />
<a href="http://www.unixuser.org/~euske/doc/cl/loop.html">http://www.unixuser.org/~euske/doc/cl/loop.html</a>
</li>

<li>Macro LOOP<br />
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_loop.htm">http://www.lispworks.com/documentation/HyperSpec/Body/m_loop.htm</a>
</li>

<li>Loop<br />
<a href="http://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node235.html">http://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node235.html</a>
</li>

<li>Tutorial for the Common Lisp Loop Macro<br />
<a href="http://www.ai.sri.com/~pkarp/loop.html">http://www.ai.sri.com/~pkarp/loop.html</a>
</li>

<li>LISPová makra aneb programovatelný programovací jazyk<br />
<a href="http://www.root.cz/clanky/lispova-makra-aneb-programovatelny-programovaci-jazyk/">http://www.root.cz/clanky/lispova-makra-aneb-programovatelny-programovaci-jazyk/</a>
</li>

<li>Jemný úvod do LISPu<br />
<a href="http://www.root.cz/clanky/jemny-uvod-do-lispu/">http://www.root.cz/clanky/jemny-uvod-do-lispu/</a>
</li>

<li>*Lisp<br />
<a href="http://en.wikipedia.org/wiki/*Lisp">http://en.wikipedia.org/wiki/*Lisp</a>
</li>

<li>Lisp machine<br />
<a href="http://en.wikipedia.org/wiki/Lisp_machine">http://en.wikipedia.org/wiki/Lisp_machine</a>
</li>

<li>MIT CADR Lisp Machine FAQ<br />
<a href="http://www.unlambda.com/cadr/cadr_faq.html">http://www.unlambda.com/cadr/cadr_faq.html</a>
</li>

<li>Symbolics LISP Machines<br />
<a href="http://www.frobenius.com/symbolics.htm">http://www.frobenius.com/symbolics.htm</a>
</li>

<li>UNIVAC<br />
<a href="http://en.wikipedia.org/wiki/Univac">http://en.wikipedia.org/wiki/Univac</a>
</li>

<li>UNIVAC 1100/2200 series<br />
<a href="http://en.wikipedia.org/wiki/UNIVAC_1100/2200_series#UNIVAC_1100_series">http://en.wikipedia.org/wiki/UNIVAC_1100/2200_series#UNIVAC_1100_series</a>
</li>

<li>Allegro CL Examples and Utilities<br />
<a href="http://examples.franz.com/index.html">http://examples.franz.com/index.html</a>
</li>

<li>LISP 1.5 for the Univac 1100 Mainframe<br />
<a href="http://www.frobenius.com/univac.htm">http://www.frobenius.com/univac.htm</a>
</li>

<li>STARSIM: Thinking Machines' *Lisp Simulator<br />
<a href="http://www-2.cs.cmu.edu/afs/cs/project/ai-repository/ai/lang/lisp/impl/starlisp/0.html">http://www-2.cs.cmu.edu/afs/cs/project/ai-repository/ai/lang/lisp/impl/starlisp/0.html</a>
</li>

<li>Connection Machine<br />
<a href="http://en.wikipedia.org/wiki/Connection_Machine">http://en.wikipedia.org/wiki/Connection_Machine</a>
</li>

<li>Connection Machine -1-2-5<br />
<a href="http://ed-thelen.org/comp-hist/vs-cm-1-2-5.html">http://ed-thelen.org/comp-hist/vs-cm-1-2-5.html</a>
</li>

<li>Richard Feynman and The Connection Machine<br />
<a href="http://www.longnow.org/essays/richard-feynman-connection-machine/">http://www.longnow.org/essays/richard-feynman-connection-machine/</a>
</li>

<li>Sheryl Handler<br />
<a href="http://en.wikipedia.org/wiki/Sheryl_Handler">http://en.wikipedia.org/wiki/Sheryl_Handler</a>
</li>

<li>W. Daniel Hillis<br />
<a href="http://en.wikipedia.org/wiki/Danny_Hillis">http://en.wikipedia.org/wiki/Danny_Hillis</a>
</li>

<li>The Rise and Fall of Thinking Machines<br />
<a href="http://www.inc.com/magazine/19950915/2622.html">http://www.inc.com/magazine/19950915/2622.html</a>
</li>

<li>Lisp (programming language)<br />
<a href="http://en.wikipedia.org/wiki/Lisp_(programming_language)">http://en.wikipedia.org/wiki/Lisp_(programming_language)</a>
</li>

<li>On Lisp<br />
<a href="http://paulgraham.com/onlisptext.html?asdf">http://paulgraham.com/onlisptext.html?asdf</a>
</li>

<li>Lambda calculus<br />
<a href="http://en.wikipedia.org/wiki/Lambda_calculus">http://en.wikipedia.org/wiki/Lambda_calculus</a>
</li>

<li>A Short Introduction to the Lambda Calculus<br />
<a href="http://www.cs.bham.ac.uk/~axj/pub/papers/lambda-calculus.pdf">http://www.cs.bham.ac.uk/~axj/pub/papers/lambda-calculus.pdf</a>
</li>

<li>A Tutorial Introduction to the Lambda Calculus<br />
<a href="http://www.inf.fu-berlin.de/lehre/WS03/alpi/lambda.pdf">http://www.inf.fu-berlin.de/lehre/WS03/alpi/lambda.pdf</a>
</li>

<li>An Introduction to Scheme and its Implementation<br />
<a href="ftp://ftp.cs.utexas.edu/pub/garbage/cs345/schintro-v14/schintro_toc.html">ftp://ftp.cs.utexas.edu/pub/garbage/cs345/schintro-v14/schintro_toc.html</a>
</li>

<li>Humor on Computers, Systems and Programming<br />
<a href="http://www-crypto.htw-saarland.de/weber/misc/programming.html">http://www-crypto.htw-saarland.de/weber/misc/programming.html</a>
</li>

<li>Teach Yourself Scheme in Fixnum Days<br />
<a href="http://www.ccs.neu.edu/home/dorai/t-y-scheme/t-y-scheme.html">http://www.ccs.neu.edu/home/dorai/t-y-scheme/t-y-scheme.html</a>
</li>

<li>Rosetta Code &ndash; Category:Lisp<br />
<a href="http://rosettacode.org/wiki/Category:Lisp">http://rosettacode.org/wiki/Category:Lisp</a>
</li>

<li>Retrocomputing &ndash; MIT CADR Lisp Machines<br />
<a href="http://www.unlambda.com/cadr/index.html">http://www.unlambda.com/cadr/index.html</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

