<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Komunikace pomocí sériového portu RS-232C</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Komunikace pomocí sériového portu RS-232C</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Ve ètyøicáté èásti seriálu o architekturách poèítaèù si uká¾eme, jakým zpùsobem se dá se sériovým portem pracovat na bì¾ném osobním poèítaèi. Popí¹eme si i zapojení kabelù sériového portu, od tìch nejjednodu¹¹ích se dvìma vodièi a¾ po kabely umo¾òujícími øízení toku dat pomocí handshakingu.</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. Komunikace pomocí sériového portu RS-232C</a><br />
<a href="#k02">2. Zapojení konektorù a propojovacích kabelù</a><br />
<a href="#k03">3. Sériové porty na osobních poèítaèích</a><br />
<a href="#k04">4. Konfiguraèní registry UART</a><br />
<a href="#k05">5. Nastavení pøenosové rychlosti sériového portu</a><br />
<a href="#k06">6. Konfigurace dal¹ích parametrù pøenosové linky</a><br />
<a href="#k07">7. Odkazy na Internetu</a><br />
<a href="#k08">8. Obsah dal¹ího pokraèování seriálu</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. Komunikace pomocí sériového portu</h1>

<p>V&nbsp;pøedchozí èásti tohoto seriálu jsme si popsali základní zpùsob
pøenosu dat pomocí sériového portu <i>RS-232C</i>. Dnes si øekneme, jak lze
nakonfigurovat a následnì i pou¾ít sériový port èi více portù, které jsou
zabudovány do osobních poèítaèù. Velmi podobným zpùsobem v¹ak pracují i sériové
porty pou¾ité v&nbsp;dal¹ích zaøízeních, nezávisle na tom, jakým konkrétním
øadièem (<i>UART</i>) èi konektorem jsou tato zaøízení vybavena. Na osobních
poèítaèích se dnes ponejvíce mù¾eme setkat se sériovým portem vyvedeným na
konektor <i>DB-9</i> (pøesnìji <i>DE-9</i>, pou¾ívají se v¹ak obì oznaèení),
popøípadì lze najít i poèítaèe vybavené ¹irokým konektorem <i>DB-25</i>,
proto¾e jen na tomto typu konektoru jsou vyvedeny v¹echny signály postupnì
pøidávané k&nbsp;sériovému portu (jedná se zejména o signály pou¾ité u
nìkterých modemù a také o druhou obousmìrnou sériovou linku). Sériová
komunikace odpovídající <i>RS-232C</i> v¹ak mù¾e probíhat i po kabelech
ukonèených konektorem typu <i>RJ-11</i> èi <i>RJ-45</i>, výjimkou nejsou ani
zaøízení pou¾ívající nìkterou z&nbsp;variant konektoru <i>DIN</i>
(v&nbsp;minulosti populární a po mechanické stránce velmi odolný
&bdquo;pìtikolík&ldquo;), rùzné typu jackù u men¹ích zaøízení atd.</p>

<image id="7727" original="no" />
<p-center><i>Obrázek 1: Universální kabely pou¾ité pøi propojování rùzných
zaøízení vybavených sériovými porty. V&nbsp;praxi se mù¾eme ponejvíce setkat se
dvìma typy kabelù &ndash; u jednìch se prohazují signály TxD a RxD (vysílání a
pøíjem) i dal¹í signálové vodièe, druhé typy kabelù jsou pouze
&bdquo;prodlu¾ovací&ldquo;, tj.&nbsp;na obou konektorech jsou propojeny v¾dy
stejné piny.</i></p-center>

<p>Základem komunikace pøes sériový port typu <i>RS-232C</i> je simplexní,
poloduplexní èi plnì duplexní asynchronní pøenos dat, ke kterým mù¾e být
doplnìn paritní bit, pøièem¾ komunikaèní protokol je roz¹íøen i o takzvané
start a stop bity, které slou¾í k&nbsp;synchronizaci vysílacího a pøijímacího
zaøízení (pøítomnost stop bitu navíc dává pøijímací stranì dostatek èasu na
ulo¾ení právì naèteného bajtu do vyrovnávacího datového registru èi datové
fronty &ndash; FIFO &ndash; a vygenerování pøeru¹ení pro komunikaèní program).
Osobní poèítaèe jsou vybaveny buï samostatným èipem <i>UART</i>
popø.&nbsp;<i>USART</i>, nebo je tento universální vysílaè a pøijímaè zabudován
do nìjakého slo¾itìj¹ího èipu (vìt¹inou ji¾ního mùstku &ndash; <i>south
bridge</i> &ndash; na základní desce). Komunikaci na nejni¾¹í úrovni, vèetnì
generování start bitu, stop bitu i paritního bitu, obstarává právì <i>UART</i>,
programátorovi postaèuje vhodnì nastavit parametry pøenosové linky a pøi
vlastním pøenosu dat dostateènì rychle reagovat na pøeru¹ení, které pøijde ve
chvíli, kdy se mají data vysílat èi jsou naopak pøijata.</p>

<image id="7728" original="no" />
<p-center><i>Obrázek 2: Sí»ové zaøízení umo¾òující propojení sériových portù a
Ethernetu. Tyto sériové porty lze nastavit na v¹echny standardní rychlosti,
vèetnì obvyklých 115200 bitù za sekundu.</i></p-center>

<p>Pøítomnost specializovaného èipu <i>UART/USART</i> v&nbsp;osobním poèítaèi
mj.&nbsp;znamená, ¾e vlastní komunikace ji¾ není tak nároèná na zatí¾ení
mikroprocesoru, jako komunikace po paralelním portu, u které se o posílání dat,
pøíjem dat i samotný handshaking musel starat mikroprocesor a nikoli
specializovaný èip (poznamenejme, ¾e na nìkterých jednodu¹¹ích mikroøadièích
není <i>UART</i> pøítomen; to v¹ak nemusí vadit, proto¾e se komunikace jak na
stranì vysílaèe, tak i na stranì pøíjemce, dá na mikroøadièích pomìrnì snadno
naprogramovat, pøedev¹ím tehdy, kdy¾ je k&nbsp;dispozici èasovaè pøipojený na
pøeru¹ení). V&nbsp;následujících kapitolách si øekneme základní informace o
ovládání <i>UART/USART</i> na té nejni¾¹í úrovni (pøes konfiguraèní registry
mapované do I/O prostoru mikroprocesoru) i na úrovni operaèního systému. Tato
vy¹¹í úroveò je v&nbsp;mnoha Unixových systémech pøedstavována systémovým
programem <strong>setserial</strong>, díky nìmu¾ je mo¾né pracovat i
s&nbsp;nestandardnì pøipojenými sériovými porty.</p>



<p><a name="k02"></a></p>
<h1>2. Zapojení konektorù a propojovacích kabelù</h1>

<p>Na tøetím obrázku je nakreslen konektor typu <i>DB-9/DE-9</i> spolu se jmény
jednotlivých pinù pou¾ívaných pøi komunikaci po sériovém portu. Pro mnoho
zaøízení pøipojených k&nbsp;osobnímu poèítaèi postaèují pouze piny <i>TxD</i>,
<i>RxD</i> a <i>Ground</i>, ov¹em napøíklad pro rychlé propojení dvou poèítaèù
nebo pro komunikaci s&nbsp;modemem se vyu¾ívají i dal¹í piny, pomocí nich¾ se
zaji¹»uje hardwarové øízení toku dat &ndash; <i>handshaking</i> &ndash;
(<i>DTR/DSR</i> èi <i>RTS/CTS</i>) i pøenos nìkterých informací z&nbsp;modemu
do poèítaèe (<i>DCD</i>, <i>RI</i>). V&nbsp;následujících odstavcích si
popí¹eme nìkteré typické zapojení propojovacích kabelù, ov¹em ji¾ nyní je nutné
øíci, ¾e mnoho (pøedev¹ím star¹ích) zaøízení vy¾aduje odli¹nì zapojené kabely a
pro nìkterá tato zaøízení je dokonce nutné pou¾ít sériový port vyvedený na
konektor typu <i>DB-25</i>, proto¾e na krat¹ím konektoru nìkteré ménì èasto
pou¾ívané signály chybí. V&nbsp;praxi se èasto setkáme s&nbsp;následujícími
typy zapojení:</p>

<ol>

<li>Pokud se komunikuje se zaøízením, které nevrací ¾ádná data (øádkový LCD,
nìkteré tiskárny), je mo¾né zapojit pouze dva vodièe &ndash; TxD a Ground. Pin
TxD na stranì poèítaèe se propojí s&nbsp;pinem RxD na pøijímací stranì.</li>

<li>I zaøízení, které naopak pouze posílají data smìrem do poèítaèe, lze
propojit také dvìma vodièi. Na stranì zaøízení se pin TxD spojí s&nbsp;pinem
RxD na poèítaèi, v¹e se doplní signálovou zemí Ground.</li>

<li>Pøi po¾adavku na poloduplexní pøenos s&nbsp;malým dùrazem na pøenosovou
rychlost (a SW øízením pøenosu) staèí na obou konektorech navzájem propojit
piny TxD a RxD a výsledek propojit jedním vodièem (druhým vodièem je zem).</li>

<li>Velmi èasté je zapojení, kdy se pin TxD z&nbsp;prvního konektoru propojí
s&nbsp;pinem RxD na konektoru druhém a naopak. Získáme tak podporu pro plnì
duplexní pøenos po tøech vodièích &ndash; TxD&ndash;RxD, RxD&ndash;TxD,
Ground&ndash;Ground.  Vy¾adováno je SW øízení pøenosu dat.</li>

<li>Pøi po¾adavku na HW øízení pøenosu lze pou¾ít nìkterou z&nbsp;konfigurací
takzvaného <i>null modemu</i>. První zapojení vypadá takto: TxD&ndash;RxD,
RxD&ndash;TxD, Ground&ndash;Ground, (RTS+CTS)&ndash;(RTS+CTS) (signály jsou
spojeny), (DSR+DTR)&ndash;(DSR+DTR).</li>

<li>Úplné zapojení <i>null modemu</i>:
TxD&ndash;RxD, RxD&ndash;TxD, Ground&ndash;Ground, RTS&ndash;CTS,
CTS&ndash;RTS, DSR&ndash;DTR, DTR&ndash;DSR (význam si popí¹eme pøí¹tì).</li>

<li>Nìkteré sériové tiskárny vrací stavový bit a musí být zapojeny takto:
TxD&ndash;RxD, Ground&ndash;Ground, (DSR+CTR)&ndash;DTR. Jedná se o takzvaný
<i>protokol DTR</i>.</li>

</ol>

<image id="7729" />
<p-center><i>Obrázek 3: Význam jednotlivých pinù konektoru DB-9/DE-9
v&nbsp;pøípadì, ¾e je vyu¾ívaný sériovým portem.</i></p-center>



<p><a name="k03"></a></p>
<h1>3. Sériové porty na osobních poèítaèích</h1>

<p>Sériové porty jsou na osobních poèítaèích pou¾ívány ji¾ od prapùvodního IBM
PC. Proto existuje podpora pro jejich ovládání v&nbsp;<i>BIOSu</i>,
tj.&nbsp;programu, který se mj.&nbsp;stará o základní inicializaci zaøízení a
spu¹tìní zavadìèe operaèního systému &ndash; poèítaè se pøi takzvaném
<i>POSTu</i> (<i>Power On Self Test</i>) pokou¹í nalézt první dva
(v&nbsp;nìkterých pøípadech dokonce první ètyøi) sériové porty v&nbsp;poøadí
<i>COM1</i> a¾ <i>COMn</i> a ulo¾í bázové adresy jejich konfiguraèních registrù
do své datové oblasti nazývané <i>promìnné BIOSu</i>, která se v&nbsp;reálném
re¾imu mapuje od adresy 0x0400 vý¹e (na moderních základních deskách je mo¾né
adresy sériových portù &ndash; a tím i jejich jméno &ndash; mìnit pøímo
v&nbsp;konfiguraci <i>BIOSu</i>, u star¹ích desek se musely pou¾ít jumpery).
Operaèní systémy spu¹tìné po inicializaci promìnných BIOSu buï tyto informace
pou¾ijí nebo se samy pokou¹í o nalezení dostupných sériových portù.
V&nbsp;pøípadì multiportových karet (k&nbsp;dostání jsou napøíklad karty
obsahující osm èi dokonce ¹estnáct sériových portù) je to dokonce nezbytné,
proto¾e standardní <i>BIOS</i> více ne¾ dva (ètyøi) porty nedoká¾e najít.</p>

<image id="7730" />
<p-center><i>Obrázek 4: Poèítaèová my¹ pøipojitelná k&nbsp;sériovému portu.
Tyto typy my¹í, z&nbsp;nich¾ mnohé díky své odolnosti vydr¾ely a¾ do dne¹ních
dnù, jsou stále v&nbsp;operaèních systémech podporovány.</i></p-center>

<p>Následuje výpis promìnných <i>BIOSu</i>, které se vztahují k&nbsp;sériovým
portùm (pro doplnìní pøedchozích èástí tohoto seriálu jsem pøidal i údaje o
portech paralelních):</p>

<table>
<tr><th>Adresa</th><th>Symbolické jméno</th><th>Význam</th></tr>
<tr><td>0x0400</td><td>COM1</td><td>bázová adresa prvního sériového portu</td></tr>
<tr><td>0x0402</td><td>COM2</td><td>bázová adresa druhého sériového portu</td></tr>
<tr><td>0x0404</td><td>COM3</td><td>bázová adresa tøetího sériového portu</td></tr>
<tr><td>0x0406</td><td>COM4</td><td>bázová adresa ètvrtého sériového portu</td></tr>
<tr><td>0x0408</td><td>LPT1</td><td>bázová adresa prvního paralelního portu</td></tr>
<tr><td>0x040a</td><td>LPT2</td><td>bázová adresa druhého paralelního portu</td></tr>
<tr><td>0x040c</td><td>LPT3</td><td>bázová adresa tøetího paralelního portu</td></tr>
<tr><td>0x040e</td><td>LPT4</td><td>bázová adresa ètvrtého paralelního portu</td></tr>
</table>

<p>Ka¾dý standardní sériový port se ovládá pomocí sedmi konfiguraèních
registrù; v&nbsp;prùbìhu vysílání èi pøíjmu dat mù¾e být navíc generováno
hardwarové pøeru¹ení (více viz následující kapitoly). Konfiguraèní registry
øadièù sériových portù jsou umístìny do I/O oblasti, tj.&nbsp;pøistupuje se
k&nbsp;nim pomocí strojových instrukcí <strong>IN</strong> a
<strong>OUT</strong> (v&nbsp;Céèku se jedná o funkce èi makra
<strong>inb()</strong> a <strong>outb()</strong>, viz popis programování
paralelního portu uvedený ve tøicáté sedmé èásti tohoto seriálu). Standardnì,
tj.&nbsp;po nalezení sériových portù <i>BIOSem</i>, je rozsah adres
konfiguraèních registrù jednotlivých sériových portù <i>COM1</i> a¾ <i>COM4</i>
a èíslo generovaného hardwarového pøeru¹ení následující:</p>

<table>
<tr><th>Port</th><th>I/O adresa od</th><th>I/O adresa do</th><th>Pøeru¹ení</th></tr>
<tr><td>COM1</td><td>0x3f8</td><td>0x3ff</td><td>IRQ4</td></tr>
<tr><td>COM2</td><td>0x2f8</td><td>0x2ff</td><td>IRQ3</td></tr>
<tr><td>COM3</td><td>0x3e8</td><td>0x3ef</td><td>IRQ4, IRQ5 nebo IRQ7</td></tr>
<tr><td>COM4</td><td>0x2e8</td><td>0x2ef</td><td>IRQ3, IRQ5 nebo IRQ7</td></tr>
</table>

<image id="7731" />
<p-center><i>Obrázek 5: Díky znaènému roz¹íøení sériového portu existuje mnoho
souèástek, které sériovou komunikaci podporují. Na tomto schématu je ukázáno
jednoduché zapojení teplotního èidla k&nbsp;poèítaèi. Pøes pin RxD se ète
teplota posílaná ve formì stále opakované sekvence bytù.</i></p-center>



<p><a name="k04"></a></p>
<h1>4. Konfiguraèní registry UART</h1>

<p>Struèný význam jednotlivých konfiguraèních registrù mapovaných do vý¹e
uvedeného rozsahu sedmi adres (ka¾dý z&nbsp;registrù má délku jednoho bajtu) je
uveden v&nbsp;tabulce zobrazené pod tímto odstavcem. Nìkteré registry jsou
urèeny pouze pro ètení, dal¹í jen pro zápis, a do zbylých je mo¾né data èíst èi
naopak zapisovat (zapisovaná a ètená dat mají obecnì rozdílný význam). Funkce
prvních dvou konfiguraèních registrù pøi programovém zápisu je dvojí &ndash;
registr na offsetu 0 bì¾nì slou¾í k&nbsp;vysílání bajtu (pøesnìji øeèeno
k&nbsp;zápisu bajtu, který je pozdìji bit po bitu vyslán na linku) a registr na
offsetu 1 pro nastavení pøeru¹ení. Ov¹em tyto registry mají i alternativní
funkce, proto¾e se pomocí nich nastavuje dìlitel hodin, který je pou¾itý jak
pøi vysílání, tak i pøi pøíjmu. Hodnota dìlitele hodin urèuje pøenosovou
rychlost. To, jaké informace se v&nbsp;daném okam¾iku zapisují do
konfiguraèních registrù na offsetu 0 a 1 závisí na stavu sedmého (nejvy¹¹ího)
bitu registru le¾ícího na offsetu 3 (takzvaný <i>DLAB</i>). Pøi vysílání dat je
tento bit nulový, ov¹em v&nbsp;prùbìhu konfigurace sériového portu je nastavený
na jednièku. V&nbsp;tabulce jsou popsány registry standardního <i>UARTu</i>,
který neobsahuje frontu vysílaných a pøijímaných dat:</p>

<table>
<tr><th>Port (offset)</th><th>Adresa pro COM1</th><th>Adresa pro COM2</th><th>ètení</th><th>zápis</th><th>význam</th></tr>
<tr><td>+0</td><td>0x3f8</td><td>0x2f8</td><td>ano</td><td>ano</td><td>vysílací a pøijímací registr, dolní bajt dìlitele hodin</td></tr>
<tr><td>+1</td><td>0x3f9</td><td>0x2f9</td><td>ne </td><td>ano</td><td>povolení pøeru¹ení, horní bajt dìlitele hodin</td></tr>
<tr><td>+2</td><td>0x3fa</td><td>0x2fa</td><td>ano</td><td>ne </td><td>identifikace pøeru¹ení (pøíznak, co pøeru¹ení zpùsobilo)</td></tr>
<tr><td>+3</td><td>0x3fb</td><td>0x2fb</td><td>ano</td><td>ano</td><td>øízení linky, poèet stop bitù, nastavení parity atd.</td></tr>
<tr><td>+4</td><td>0x3fc</td><td>0x2fc</td><td>ne </td><td>ano</td><td>øízení modemu - doplòkových výstupních signálù</td></tr>
<tr><td>+5</td><td>0x3fd</td><td>0x2fd</td><td>ano</td><td>ne </td><td>ètení stavu linky - chyb pøi pøenosu</td></tr>
<tr><td>+6</td><td>0x3fe</td><td>0x2fe</td><td>ano</td><td>ne </td><td>ètení stavu modemu - doplòkových vstupních signálù</td></tr>
</table>

<image id="7732" />
<p-center><i>Obrázek 6: Jeden z&nbsp;dnes ji¾ historických terminálù, který se
k&nbsp;serveru pøipojoval pøes sériový port. Ji¾ na tomto terminálu je patrný
jeden (ve své dobì &bdquo;novátorský&ldquo;) designový prvek &ndash; horní èást
terminálu se zaèínala èím dál tím více ze¹ikmovat a zakulacovat, aby se na nìj
nedaly stavìt hrneèky s&nbsp;kávou :-) a pøedev¹ím papíry èi knihy, které by
zakrývaly vìtrací otvory.</i></p-center>



<p><a name="k05"></a></p>
<h1>5. Nastavení pøenosové rychlosti sériového portu</h1>

<p>Ji¾ minule jsme si øekli, ¾e obì komunikující zaøízení, tedy jak pøijímací,
tak i vysílací strana, se nejprve musí vhodným zpùsobem nakonfigurovat, aby
pøijímaè vìdìl, v&nbsp;jakém formátu má data oèekávat a jak rychle je nutné
vzorkovat datovou linku, neboli jaká je pøenosová rychlost. Na obou zaøízeních
se musí pøedev¹ím nastavit poèet pøená¹ených bitù v&nbsp;jednom celku, co¾ je
pìt a¾ osm bitù (dnes prakticky v¾dy osm bitù, tj.&nbsp;jeden bajt), pøenosová
rychlost uvádìná v&nbsp;poètu bitù pøenesených za jednu sekundu
(<i>bitrate</i>), délka <i>stopbitu</i> a v&nbsp;nìkterých pøípadech i to, zda
a jakým zpùsobem se pøená¹í paritní bit, který pøedstavuje velmi primitivní
podobu detekèního kódu. Toto nastavení musí být na pøijímaèi i vysílaèi shodné,
co¾ je také jeden z&nbsp;dùvodù, proè je vìt¹ina zaøízení typu <i>UART</i>
konfigurovatelná &ndash; pomocí nìkolika konfiguraèních registrù se pøijímaè a
vysílaè nastaví tak, aby spolu mohly navzájem komunikovat. V&nbsp;pøípadì
sériových portù v&nbsp;osobních poèítaèích se tyto hodnoty nastavují pomocí
konfiguraèních registrù le¾ících na offsetu 0, 1 a 3 (viz tabulka uvedená
v&nbsp;pøedchozí kapitole).</p>

<p>Pomocí konfiguraèních registrù le¾ících na offsetu 0 a 1 lze nastavit
pøenosovou rychlost. Ta se nezadává pøímo, ale formou dvoubajtové hodnoty,
kterou jsou dìleny hodinové impulsy generované èipem <i>UART</i> (na èip je
pøipojený krystal s&nbsp;frekvencí nastavenou typicky na hodnotu 14,7456 MHz,
18,432 MHz èi 29,4912 MHz, základní frekvence je rovna 1,8432 MHz).
V&nbsp;dal¹í tabulce jsou vypsány hodnoty dìlitele zapisované do konfiguraèních
registrù le¾ících na offsetu 0 a 1 (ni¾¹í &ndash; vy¹¹í bajt). Hodnota dìlitele
se získá snadno kdy¾ si uvìdomíme, ¾e bitová rychlost vynásobená hodnotou
dìlitele se v¾dy rovná konstantì 115200:</p>

<table>
<tr><th>bitù za sekundu</th><th>dìlitel</th><th>poznámka</th></tr>
<tr><td>110   </td><td>1040</td><td>nepøesné, ale v mezích normy</td></tr>
<tr><td>150   </td><td> 768</td><td></td></tr>
<tr><td>300   </td><td> 384</td><td></td></tr>
<tr><td>600   </td><td> 192</td><td></td></tr>
<tr><td>1200  </td><td>  96</td><td></td></tr>
<tr><td>2400  </td><td>  48</td><td>cca touto rychlostí se nahrávaly programy z&nbsp;kazety na osmibitových poèítaèích</td></tr>
<tr><td>4800  </td><td>  24</td><td></td></tr>
<tr><td>9600  </td><td>  12</td><td>bez problémù funguje i pøi propojení poèítaèù tøemi zvonkovými dráty na vzdálenost cca 10 metrù :-)</td></tr>
<tr><td>18200 </td><td>   6</td><td></td></tr>
<tr><td>38400 </td><td>   3</td><td></td></tr>
<tr><td>57600 </td><td>   2</td><td></td></tr>
<tr><td>115200</td><td>   1</td><td>této pøenosové rychlosti lze dosáhnout na krat¹í vzdálenosti</td></tr>
</table>

<p>Vý¹e uvedené pøenosové rychlosti mo¾ná nìkteøí ze ètenáøù znají, proto¾e
odpovídají teoretickým pøenosovým rychlostem modemù. Mohlo by se zdát, ¾e
rychlost modemu (pøesnìji øeèeno rychlost pøenosu dat po vytáèené analogové èi
digitální lince) by mìla být stejná, jako rychlost nastavená na sériovém portu,
pomocí kterého poèítaè s&nbsp;modemem komunikuje. Ve skuteènosti by se v¹ak
mìla pro tuto komunikaci nastavit rychlost minimálnì o jeden stupeò vìt¹í
(38400 bps &ndash; 57600 bps apod.), proto¾e do modemu jsou kromì vlastních dat
pøená¹eny i dal¹í øídicí bajty a samotný externí modem doká¾e vysílaná data
komprimovat. Pokud by tedy byly obì pøenosové rychlosti nastaveny na stejnou
hodnotu, mohlo by se stát, ¾e by byl pøenos dat pøes vytáèenou linku nepatrnì
pomalej¹í (a v&nbsp;pøípadì u nás platných tarifù i dra¾¹í), proto¾e by se
èekalo na data posílaná z&nbsp;poèítaèe nebo naopak pro data posílaná
z&nbsp;modemu do poèítaèe. Nicménì pøipojení poèítaèe modemem je dnes (pro
domácnosti) spí¹e nouzové øe¹ení (ov¹em propojení dvou poèítaèù po vlastním
metalickém vedení na vzdálenost del¹í, ne¾ je bì¾ný dosah Ethernetu, je
napøíklad v&nbsp;prùmyslu stále pou¾íváno).</p>

<image id="7733" original="no" />
<p-center><i>Obrázek 7: Grafický terminál VT-105 ov¹em jako stojánek na kní¾ky
plnì vyhovoval.</i></p-center>



<p><a name="k06"></a></p>
<h1>6. Konfigurace dal¹ích parametrù pøenosové linky</h1>

<p>Pøes konfiguraèní port le¾ící na offsetu 3 se nastavuje poèet pøená¹ených
bitù. V&nbsp;souèasnosti vìt¹ina aplikací vy¾aduje v¾dy pøesun osmi bitù
(jednoho znaku/bajtu), ov¹em z&nbsp;historických dùvodù je podporován i pøenos
pìti, ¹esti èi sedmi bitù. Rozdìlení dat na pìtice/¹estice/sedmice bitù musí
øe¹it programátor, ov¹em do <i>UARTu</i> se v¾dy zapisuje v¹ech osm bitù,
z&nbsp;nich¾ je pøeneseno jen <i>n</i> nejni¾¹ích bitù. Dále se v&nbsp;tomto
konfiguraèním registru povoluje èi zakazuje paritní bit (tj.&nbsp;zda se vùbec
paritní bit posílá) a také, jakým zpùsobem má <i>UART</i> paritní bit
generovat. Mo¾né jsou ètyøi mo¾nosti &ndash; lichá parita (lichý souèet
jednièek), sudá parita, paritní bit je v¾dy nulový (takzvaná <i>space</i>) a
paritní bit je v¾dy jednièkový (<i>mark</i>). Velmi dùle¾itý je sedmý,
tj.&nbsp;nejvy¹¹í bit tohoto registru, proto¾e se pomocí nìj mìní smysl prvního
a druhého konfiguraèního registru &ndash; viz pøedchozí kapitola, ve které jsme
se zabývali nastavením pøenosové rychlosti.</p>

<table>
<tr><th>Bit registru na offsetu 3</th><th>Význam</th></tr>
<tr><td>0-2</td><td>délka pøená¹eného slova a poèet stop bitù:<br />
&nbsp;&nbsp;&nbsp;&nbsp;000: 5 bitù/znak, 1 stop bit<br />
&nbsp;&nbsp;&nbsp;&nbsp;001: 6 bitù/znak, 1 stop bit<br />
&nbsp;&nbsp;&nbsp;&nbsp;010: 7 bitù/znak, 1 stop bit<br />
&nbsp;&nbsp;&nbsp;&nbsp;011: 8 bitù/znak, 1 stop bit<br />
&nbsp;&nbsp;&nbsp;&nbsp;100: 5 bitù/znak, 1,5 stop bitu<br />
&nbsp;&nbsp;&nbsp;&nbsp;101: 6 bitù/znak, 2 stop bity<br />
&nbsp;&nbsp;&nbsp;&nbsp;110: 7 bitù/znak, 2 stop bity<br />
&nbsp;&nbsp;&nbsp;&nbsp;111: 8 bitù/znak, 2 stop bity
</td></tr>
<tr><td>3</td><td>povolení parity: 0=¾ádná parita</td></tr>
<tr><td>4-5</td><td>typ parity:<br />
&nbsp;&nbsp;&nbsp;&nbsp;00: lichá parita<br />
&nbsp;&nbsp;&nbsp;&nbsp;01: sudá parita<br />
&nbsp;&nbsp;&nbsp;&nbsp;10: paritní bit je v¾dy 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;11: paritní bit je v¾dy 1
</td></tr>
<tr><td>6</td><td>vysílání sekvence nul (takzvaný break)</td></tr>
<tr><td>7</td><td>pokud je zde ulo¾ena hodnota 1, lze nastavit dìlitel rychlosti</td></tr>
</table>

<image id="7734" original="no" />
<p-center><i>Obrázek 8: Jeden ze zpùsobù ovládání nìjakého zaøízení pomocí PDA.
V¹imnìte si, ¾e jsou zde pou¾ity hned tøi typy konektorù &ndash;
&bdquo;kolébkový&ldquo; konektor u PDA, standardní DB-9/DE-9 a na konci také
standardní (i kdy¾ u sériového portu ponìkud neobvyklý) konektor typu
RJ-11.</i></p-center>

<p>Na takto nízké úrovni se sériovým portem dnes pracují prakticky jen vývojáøi
jádra. Pro bì¾né u¾ivatele (kteøí v¹ak musí mít delegována pøíslu¹ná práva) je
v&nbsp;Unixovém svìtì urèena utilita <strong>setserial</strong>, pomocí které
se parametry sériového pøenosu dají specifikovat. Tato utilita také doká¾e
vypsat souèasné nastavení a dokonce i typ èipu UART, který je v&nbsp;poèítaèi
pou¾it (novìj¹í UART mají pøednost v&nbsp;tom, ¾e obsahují fronty, více si
øekneme v&nbsp;dal¹í èásti seriálu). Typické nastavení portu pro komunikaci se
oznaèuje jako <i>8N1</i>, tj.&nbsp;pøená¹í se osm bitù bez parity a
s&nbsp;jedním stop bitem. Pøenosovou rychlost je nutné nastavit tak, aby ji
podporovala obì zaøízení, ov¹em lze ji také umìle sní¾it (napøíklad tehdy, kdy¾
se komunikuje na del¹í vzdálenost po ménì kvalitní lince).</p>



<p><a name="k07"></a></p>
<h1>7. Odkazy na Internetu</h1>

<ul>

<li>Asynchronous serial communication<br />
<a href="http://en.wikipedia.org/wiki/Asynchronous_serial_communication">http://en.wikipedia.org/wiki/Asynchronous_serial_communication</a></li>

<li>Universal asynchronous receiver/transmitter<br />
<a href="http://en.wikipedia.org/wiki/Universal_asynchronous_receiver/transmitter">http://en.wikipedia.org/wiki/Universal_asynchronous_receiver/transmitter</a></li>

<li>Manchester code<br />
<a href="http://en.wikipedia.org/wiki/Manchester_code">http://en.wikipedia.org/wiki/Manchester_code</a></li>

<li>Bit rate<br />
<a href="http://en.wikipedia.org/wiki/Bit_rate">http://en.wikipedia.org/wiki/Bit_rate</a></li>

<li>Degree of start-stop distortion<br />
<a href="http://en.wikipedia.org/wiki/Degree_of_start-stop_distortion">http://en.wikipedia.org/wiki/Degree_of_start-stop_distortion</a></li>

<li>Serial HOWTO<br />
<a href="http://tldp.org/HOWTO/Serial-HOWTO.html">http://tldp.org/HOWTO/Serial-HOWTO.html</a></li>

<li>Linux / Unix Command: setserial<br />
<a href="http://linux.about.com/library/cmd/blcmdl8_setserial.htm">http://linux.about.com/library/cmd/blcmdl8_setserial.htm</a></li>

<li>HW server pøedstavuje - RS-232<br />
<a href="http://rs232.hw.cz/">http://rs232.hw.cz/</a></li>

<li>Charakteristika RS-232<br />
<a href="http://rs232.hw.cz/#parametry">http://rs232.hw.cz/#parametry</a></li>

<li>RS-232 Signals Functional Description<br />
<a href="http://hw-server.com/rs232_signals.html">http://hw-server.com/rs232_signals.html</a></li>

<li>AT&amp;T/Teletype 5620 Dot Mapped Display Terminal<br />
<a href="http://www.brouhaha.com/~eric/retrocomputing/att/5620/">http://www.brouhaha.com/~eric/retrocomputing/att/5620/</a></li>

<li>Computer terminal<br />
<a href="http://en.wikipedia.org/wiki/Computer_terminal">http://en.wikipedia.org/wiki/Computer_terminal</a></li>

<li>HP 2640<br />
<a href="http://en.wikipedia.org/wiki/HP_2640">http://en.wikipedia.org/wiki/HP_2640</a></li>

<li>VT100<br />
<a href="http://en.wikipedia.org/wiki/VT100">http://en.wikipedia.org/wiki/VT100</a></li>

<li>VT100 - Meet the Family<br />
<a href="http://vt100.net/vt_history">http://vt100.net/vt_history</a></li>

<li>Linux I/O port programming mini-HOWTO<br />
<a href="http://www.faqs.org/docs/Linux-mini/IO-Port-Programming.html">http://www.faqs.org/docs/Linux-mini/IO-Port-Programming.html</a></li>

</ul>



<p><a name="k08"></a></p>
<h1>8. Obsah dal¹ího pokraèování seriálu</h1>

<p>V&nbsp;následující èásti seriálu o architekturách poèítaèù téma sériové
komunikace pomocí portu typu <i>RS-232C</i> dokonèíme. Øekneme si, jakým
zpùsobem lze øídit pøenos dat; jak pomocí signálù <i>DTR/DSR</i> èi
<i>RTS/CTS</i>, tak i programovì &ndash; vìt¹inou pomocí øídicích znakù
<i>XON</i> a <i>XOFF</i>.</p>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2008</small></p>
</body>
</html>

