<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Instrukce typu SIMD na mikroprocesorech RISC (2. èást)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Instrukce typu SIMD na mikroprocesorech RISC (2. èást)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V&nbsp;dne¹ní èásti seriálu o architekturách poèítaèù si popí¹eme technologii MAX-1 a MAX-2 pou¾itou u 32bitových a 64bitových mikroprocesorù PA-RISC. Technologie MAX-1 je z&nbsp;historického hlediska pomìrnì dùle¾itá, proto¾e se jednalo o první implementaci SIMD instrukcí na mikroprocesorech. V&nbsp;minulosti toti¾ byly SIMD instrukce a obecnì vektorové operace výhradní doménou superpoèítaèù.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Podpora SIMD instrukcí na mikroprocesorech øady HP PA-RISC</a></p>
<p><a href="#k02">2. Rodina 32bitových mikroprocesorù øady HP PA-RISC</a></p>
<p><a href="#k03">3. Mikroprocesory HP PA-7100, PA-7100LC a PA-7300LC</a></p>
<p><a href="#k04">4. Multimedia Acceleration eXtensions 1 (MAX-1)</a></p>
<p><a href="#k05">5. Seznam instrukcí obsa¾ených v&nbsp;roz¹iøující instrukèní sadì MAX-1</a></p>
<p><a href="#k06">6. Jak velká byla &bdquo;obì»&ldquo; za podporu SIMD v pøípadì procesorù PA-7100LC?</a></p>
<p><a href="#k07">7. Multimedia Acceleration eXtensions 2 (MAX-2)</a></p>
<p><a href="#k08">8. Seznam instrukcí obsa¾ených v&nbsp;roz¹iøující instrukèní sadì MAX-2</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Podpora SIMD instrukcí na mikroprocesorech øady HP PA-RISC</h2>

<p>V&nbsp;pøedchozí èásti seriálu o architekturách poèítaèù jsme si øekli
základní informace o roz¹íøení instrukèní sady <i>MDMX (MaDMaX, MIPS Digital
Media eXtension)</i>, která byla pou¾ívána u mikroprocesorù <i>MIPS</i>
s&nbsp;architekturou <i>RISC</i>. Víme ji¾, ¾e technologie <i>MDMX</i> byla
navr¾ena a implementována s&nbsp;ohledem na to, aby bylo mo¾né urychlit
provádìní rastrových operací, popø.&nbsp;operací se zvukovými daty. Pro tyto
úèely byly do instrukèní sady mikroprocesorù <i>MIPS</i> pøidány nové instrukce
umo¾òující provádìní aritmetických operací nad vektory obsahujícími osmibitové,
popø.&nbsp;¹estnáctibitové celoèíselné hodnoty. Ve skuteènosti se v¹ak
v&nbsp;pøípadì technologie <i>MDMX</i> nejednalo o první vyu¾ití instrukcí typu
<i>SIMD</i> na RISCových mikroprocesorech. Prvenství si v&nbsp;tomto pøípadì
pøipsalo roz¹íøení instrukèní sady <i>MAX-1</i>, která byla ji¾ v&nbsp;roce
1994 implementována v&nbsp;mikroprocesoru <i>PA-7100LC</i>,
tj.&nbsp;mikroprocesoru patøícího do slavné rodiny 32bitových a posléze i
64bitových mikroprocesorù <i>PA-RISC</i> firmy Hewlett-Packard. Tato instrukèní
sada pøedstavuje první komerènì pou¾itou implementaci <i>SIMD</i> instrukcí na
mikroprocesorech vùbec, proto¾e o dva roky pøedbìhla i první <i>Pentia</i>
s&nbsp;<i>MMX</i>.</p>

<img src="http://i.iinfo.cz/images/193/pc152-10.jpg" width="450" height="407" alt=" " />
<p><i>Obrázek 1: Struktura moderní varianty multiprocesoru postaveného na
èipech PA-RISC.</i></p>

<p>Pøipomeòme si, ¾e první varianta RISCového mikroprocesoru øady
<i>PA-RISC</i>, která nesla modelové oznaèení <i>TS-1</i>, byla zalo¾ena na
integrovaných obvodech s&nbsp;technologií TTL majících nízkou a støední
integraci, jen¾ byly umístìny na ¹esti deskách, tak¾e se &ndash; podle
striktního pojetí &ndash; vlastnì ani o plnohodnotný mikroprocesor nejednalo.
Po této spí¹e testovací verzi se ji¾ pro dal¹í mikroprocesory <i>PA-RISC</i>
zaèaly pou¾ívat podobné technologie integrovaných obvodù VLSI, jaké pou¾ívali i
konkurenèní výrobci èipù. Mikroprocesory s&nbsp;oznaèením <i>NS-1</i> a
<i>NS-2</i> byly zalo¾eny na technologii NMOS, zatímco mikroprocesory
s&nbsp;oznaèením <i>CS-1</i> (testovací série) a <i>PCX</i> (komerènì nabízený
èip) pou¾ívaly technologii CMOS. Celá 32bitová rodina tìchto mikroprocesorù
pokraèovala øadou <i>PCX-L</i> a zakonèena byla èipem pojmenovaným
<i>PCX-L2</i>, po nìm¾ ji¾ následovaly 64bitové varianty mikroprocesorù
<i>PA-RISC</i> (které byly mimochodem vybaveny SIMD instrukcemi
<i>MAX-2</i>).</p>

<img src="http://i.iinfo.cz/images/193/pc152-11.jpg" width="450" height="467" alt=" " />
<p><i>Obrázek 2: Mikroprocesor PA-RISC 7100LC.</i></p>



<p><a name="k02"></a></p>
<h2>2. Rodina 32bitových mikroprocesorù øady HP PA-RISC</h2>

<p>V&nbsp;tabulce zobrazené pod tímto odstavcem jsou vypsány základní parametry
32bitových èipù øady <i>PA-RISC</i>. Z&nbsp;hlediska instrukèní sady
<i>MAX-1</i> s&nbsp;instrukcemi typu <i>SIMD</i> nás bude zajímat pøedev¹ím
mikroprocesor <i>PA-7100</i> a z&nbsp;nìho v&nbsp;pozdìj¹ích letech odvozené
èipy <i>PA-7100LC</i> i <i>PA-7300LC</i>. Rùst poètu tranzistorù v&nbsp;celém
více ne¾ desetiletém období, kdy byly tyto mikroprocesory vyrábìny, byl
zpùsoben pøedev¹ím postupnou integrací dal¹ích funkèních modulù na plochu
jednoho èipu. Jednalo se napøíklad o druhou (paralelnì pracující)
aritmeticko-logickou jednotku, matematický koprocesor, jednotku pro øízení
pøístupu do operaèní pamìti, øadiè vyrovnávací pamìti první úrovnì atd.</p>

<table>
<tr><th>#</th><th>Model procesoru</th><th>Oznaèení</th><th>Rok výroby</th><th>Frekvence (MHz)</th><th>Výrobní proces [&micro;m]</th><th>Poèet tranzistorù na èipu nebo multièipu</th></tr>
<tr><td> 1</td><td>TS-1  </td><td>&times;  </td><td>1986</td><td>8      </td><td>?   </td><td>115&nbsp;000</td></tr>
<tr><td> 2</td><td>CS-1  </td><td>&times;  </td><td>1987</td><td>8      </td><td>1.6 </td><td>164&nbsp;000</td></tr>
<tr><td> 3</td><td>NS-1  </td><td>&times;  </td><td>1987</td><td>25/30  </td><td>1.5 </td><td>144&nbsp;000</td></tr>
<tr><td> 4</td><td>NS-2  </td><td>&times;  </td><td>1989</td><td>27.5/30</td><td>1.5 </td><td>183&nbsp;000</td></tr>
<tr><td> 5</td><td>PCX   </td><td>&times;  </td><td>1990</td><td>50     </td><td>1.0 </td><td>196&nbsp;000</td></tr>
<tr><td> 6</td><td>PCX-S </td><td>PA-7000  </td><td>1991</td><td>66     </td><td>1.0 </td><td>580&nbsp;000</td></tr>
<tr><td> 7</td><td>PCX-T </td><td>PA-7100  </td><td>1992</td><td>33-100 </td><td>0.8 </td><td>850&nbsp;000</td></tr>
<tr><td> 8</td><td>PCX-T </td><td>PA-7150  </td><td>1994</td><td>125    </td><td>0.8 </td><td>850&nbsp;000</td></tr>
<tr><td> 9</td><td>PCX-T'</td><td>PA-7200  </td><td>1994</td><td>120    </td><td>0.55</td><td>1&nbsp;260&nbsp;000</td></tr>
<tr><td>10</td><td>PCX-L </td><td>PA-7100LC</td><td>1994</td><td>60-100 </td><td>0.75</td><td>900&nbsp;000</td></tr>
<tr><td>11</td><td>PCX-L2</td><td>PA-7300LC</td><td>1996</td><td>132-180</td><td>0.5 </td><td>9&nbsp;200&nbsp;000</td></tr>
</table>

<img src="http://i.iinfo.cz/images/193/pc152-12.jpg" width="450" height="450" alt=" " />
<p><i>Obrázek 3: Mikroprocesor PA-RISC 7300LC.</i></p>



<p><a name="k03"></a></p>
<h2>3. Mikroprocesory HP PA-7100, PA-7100LC a PA-7300LC</h2>

<p>Instrukèní sada <i>MAX-1</i>, kterou se dnes budeme zabývat, byla poprvé
pøedstavena jako souèást 32bitového mikroprocesoru <i>PA-7100LC</i>, známého
takté¾ pod oznaèením <i>model PCX-L</i> nebo té¾ <i>Hummingbird</i> (kódové
jméno). Tento mikroprocesor byl vyrábìn s&nbsp;vyu¾itím 0,75mikronové
technologie, mìl zhruba 900&nbsp;000 FET, plocha èipu byla 14,2&times;14,2mm a
umístìn byl (vìt¹inou) v&nbsp;PGA pouzdru s&nbsp;432 piny,
popø.&nbsp;v&nbsp;MQUAD pouzdru s&nbsp;240 a 304 piny. Jednalo se o
mikroprocesor zalo¾ený na úspì¹ném èipu <i>PA-7100 (PCX-T)</i> z&nbsp;roku
1992, který ov¹em pro¹el celou øadou více èi ménì viditelných vylep¹ení. Na
rozdíl od svého pøedchùdce mìl toti¾ mikroprocesor <i>PA-7100LC</i>
superskalární architekturu (s&nbsp;klasickou pìtifázovou RISCovou instrukèní
pipeline) a zdvojenou aritmeticko-logickou jednotku urèenou pro provádìní
operací s&nbsp;celými 32bitovými èísly &ndash; viz té¾ následující obrázek.
Díky zdvojené ALU bylo mo¾né souèasnì provádìt a¾ dvì instrukce, i kdy¾
mo¾nosti párování instrukcí byly v&nbsp;nìkterých pøípadech omezeny.</p>

<a href="http://i.iinfo.cz/images/392/pc163-2.png"><img src="http://i.iinfo.cz/images/392/pc163-2-prev.png" width="368" height="270" alt="&#160;" /></a>
<p><i>Obrázek 4: Mikroprocesor PA-7100LC byl vybaven tøemi funkèními
jednotkami: dvojicí ALU a matematickým koprocesorem.</i></p>

<p>Zatímco spoleènì s&nbsp;aritmetickou instrukcí bylo mo¾né spustit i
instrukci typu &bdquo;load/store&ldquo;, popø.&nbsp;druhou aritmetickou
instrukci, párování dvou operací &bdquo;load/store&ldquo; bylo omezeno jen na
speciální instrukce &bdquo;double word load&ldquo; a &bdquo;double word
store&ldquo;, které slou¾ily pro ètení èi zápis ze dvou 32bitových slov
umístìných v&nbsp;operaèní pamìti na sousedních adresách (dùvod je zøejmý
&ndash; v&nbsp;pøípadì pøístupu do dvou slov se zcela rozdílnou adresou je
nutné obìtovat nìkolik taktù pro vyslání nové adresy). Na èip <i>PA-7100LC</i>
navázal mikroprocesor <i>PA-7300LC</i> z&nbsp;roku 1996. Pokud se podíváte do
tabulky z&nbsp;pøedchozí kapitoly, mù¾ete zjistit, ¾e mezi obìma zmínìnými
procesory jsou velké rozdíly jak v&nbsp;hodinové frekvenci (100MHz vs. 180MHz)
a ve výrobním procesu (0,75 mikronu vs. 0,5 mikronu), tak i v&nbsp;celkovém
poètu tranzistorù umístìných na jednom èipu. To je zpùsobeno tím, ¾e firma
Hewlett-Packard zaintegrovala do èipu <i>PA-7300LC</i> jak vlastní
mikroprocesor a matematický koprocesor, tak i dal¹í moduly, zejména øadiè
vyrovnávací pamìti první úrovnì a jednotku pro øízení pøístupu do pamìti
(<i>MMU</i>). Jednalo se o pomìrnì úspì¹ný mikroprocesor pou¾ívaný
v&nbsp;pracovních stanicích.</p>

<a href="http://i.iinfo.cz/images/392/pc163-3.png"><img src="http://i.iinfo.cz/images/392/pc163-3-prev.png" width="370" height="116" alt="&#160;" /></a>
<p><i>Obrázek 5: Tøi zpùsoby zapouzdøení mikroprocesoru PA-7100LC: pouzdro PGA
s&nbsp;432 piny, pouzdro MQUAD s&nbsp;240 piny a pouzdro MQUAD s&nbsp;304
piny.</i></p>



<p><a name="k04"></a></p>
<h2>4. Multimedia Acceleration eXtensions 1 (MAX-1)</h2>

<p>Konstruktéøi mikroprocesoru <i>PA-7100LC</i> se velmi peèlivì vìnovali
návrhu nové instrukèní sady se <i>SIMD</i> instrukcemi. Dokonce pro tento úèel
vytvoøili i jeden z&nbsp;prvních multimediálních benchmarkù, díky nìmu¾ mohli
provést analýzu a následnou optimalizaci instrukèní sady. Výsledkem této snahy
byla velmi malá a pøitom elegantnì navr¾ená sada pouze devíti nových instrukcí,
jejich¾ sémantika plnì odpovídá základùm, na nich¾ jsou postaveny prakticky
v¹echny RISCové mikroprocesory (týká se to jak kódování instrukcí, tak i
zpùsobu zaintegrování nových instrukcí do stávající instrukèní sady). Nové
instrukce byly urèeny pro zpracování ¹estnáctibitových slov nazývaných
&bdquo;subword data&ldquo;, popø.&nbsp;&bdquo;halfword data&ldquo; (oznaèením
&bdquo;word&ldquo; jsou v&nbsp;pøípadì 32bitových mikroprocesorù PA-RISC
samozøejmì my¹lena 32bitová slova, men¹í informaèní jednotky se neadresovaly).
V¾dy dvojice ¹estnáctibitových slov mohla být ulo¾ena do libovolného pracovního
registru <strong>GR1</strong> a¾ <strong>GR31</strong>, proto¾e registr
<strong>GR0</strong> obsahoval konstantu 0, jak je tomu ostatnì u RISCových
procesorù zvykem.</p>

<img src="http://i.iinfo.cz/images/392/pc163-4.jpg" width="120" height="114" alt="&#160;" />
<p><i>Obrázek 6: Mikroprocesor PA-7100LC s&nbsp;chladièem.</i></p>

<p>Vzhledem k&nbsp;tomu, ¾e ka¾dý pracovní registr mohl v&nbsp;pøípadì nových
instrukcí <i>MAX</i> obsahovat dva prvky, znamenalo to dvojnásobné urychlení
nìkterých základních aritmetických operací. Ve skuteènosti v¹ak bylo mo¾né díky
ji¾ zmínìnému párování ALU instrukcí pro dvì paralelnì pracující
aritmeticko-logické jednotky dosáhnout a¾ ètyønásobného urychlení. Jinými
slovy: pokud nenastaly kolize pøi pøístupu k&nbsp;pracovním registrùm, bylo
mo¾né v&nbsp;ka¾dém taktu dokonèit ètyøi ALU operace provádìné nad
¹estnáctibitovými pùlslovy (halfword). V&nbsp;dobì vzniku technologie
<i>MAX-1</i>, kdy se výpoèetní výkon mikroprocesorù pohyboval na hranì
pou¾itelnosti pro multimediální aplikace (napøíklad pro pøehrávání videa ve
formátu <i>MPEG-1</i>) se tedy jednalo o dosti výraznou pomoc. Navíc byly nové
aritmetické operace pøizpùsobeny pro zpracování multimediálních dat &ndash;
bylo u nich mo¾né zvolit, zda se bude provádìt souèet èi rozdíl se saturací
nebo s&nbsp;pøeteèením. To znamenalo dal¹í urychlení pro mnoho algoritmù
z&nbsp;oblasti zpracování video a audio signálu.</p>

<a href="http://i.iinfo.cz/images/392/pc163-5.png"><img src="http://i.iinfo.cz/images/392/pc163-5-prev.png" width="370" height="150" alt="&#160;" /></a>
<p><i>Obrázek 7: Superskalární pipeline mikroprocesorù PA-7100LC a
PA-7300LC.</i></p>



<p><a name="k05"></a></p>
<h2>5. Seznam instrukcí obsa¾ených v&nbsp;roz¹iøující instrukèní sadì MAX-1</h2>

<p>Pojïme se nyní koneènì podívat, jaké nové instrukce byly v&nbsp;rámci
roz¹iøující instrukèní sady <i>MAX-1</i> pøidány ke stávající instrukèní sadì
PA-RISC (1). Jak jsme si ji¾ øekli v&nbsp;pøedchozím textu, jde o devìt nových
instrukcí urèených pro provádìní pouhých pìti operací. První trojici instrukcí
tvoøí instrukce pro provedení operace souètu dvou dvojic ¹estnáctibitových
hodnot (<strong>HADD</strong> &ndash; <i>half word add</i>) s&nbsp;mo¾ností
výbìru, zda se má souèet provést s&nbsp;pøeteèením (modulo) nebo se saturací.
V&nbsp;pøípadì provádìní souètu se saturací se navíc urèovalo, zda je minimální
a maximální hodnota rovna 0x0000 a 0xffff (èísla bez znaménka &ndash;
<i>unsigned</i>) èi 0x8000 a 0x7fff (èísla se znaménkem &ndash; <i>signed</i>).
Dal¹í trojice instrukcí je obdobná, jsou ov¹em urèeny pro výpoèet rozdílu
dvojice dvouprvkových vektorù (<strong>HSUB</strong> &ndash; <i>half word
subtract</i>). Tøetím typem operace je výpoèet prùmìru. Zde k&nbsp;saturaci ani
k&nbsp;pøeteèení dojít nemù¾e, proto je tato operace reprezentována jedinou
instrukcí <strong>HAVG</strong> (<i>half word average</i>).</p>

<img src="http://i.iinfo.cz/images/392/pc163-6.jpg" width="222" height="152" alt="&#160;" />
<p><i>Obrázek 8: Jeden ze serverù vybavených mikroprocesory PA-RISC: stroj
HP9000-RP2400.</i></p>

<p>Poslední dvì instrukce jsou urèeny pro posun hodnot doleva èi doprava, který
je následovaný souètem. Tyto instrukce lze pou¾ít napøíklad pro implementaci
algoritmu násobení èi dìlení, co¾ jsou operace, které z&nbsp;pochopitelných
dùvodù nejsou pøímo souèástí instrukèní sady (tyto dvì aritmetické operace,
pokud nejsou rozlo¾eny do jednotlivých iterací, toti¾ nemohou být provedeny
v&nbsp;RISCové pìtifázové pipeline):</p>

<table>
<tr><th>#</th><th>Jméno instrukce</th><th>Provádìná operace</th><th>Aritmetika</th><th>Poèet cyklù pro fázi execute</th></tr>
<tr><td>1</td><td>HADD   </td><td>souèet</td><td>s&nbsp;pøeteèením (modulo)    </td><td>1 cyklus</td></tr>
<tr><td>2</td><td>HADD,ss</td><td>souèet</td><td>hodnoty se znaménkem, saturace</td><td>1 cyklus</td></tr>
<tr><td>3</td><td>HADD,us</td><td>souèet</td><td>hodnoty bez znaménka, saturace</td><td>1 cyklus</td></tr>
<tr><td>4</td><td>HSUB   </td><td>rozdíl</td><td>s&nbsp;pøeteèením (modulo)    </td><td>1 cyklus</td></tr>
<tr><td>5</td><td>HSUB,ss</td><td>rozdíl</td><td>hodnoty se znaménkem, saturace</td><td>1 cyklus</td></tr>
<tr><td>6</td><td>HSUB,us</td><td>rozdíl</td><td>hodnoty bez znaménka, saturace</td><td>1 cyklus</td></tr>
<tr><td>7</td><td>HAVG   </td><td>prùmìr</td><td>hodnoty se znaménkem (k&nbsp;pøeteèení ani saturaci nemù¾e dojít)</td><td>1 cyklus</td></tr>
<tr><td>8</td><td>HSHLADD</td><td>posun doleva+souèet</td><td>hodnoty se znaménkem, saturace </td><td>1 cyklus</td></tr>
<tr><td>9</td><td>HSHRADD</td><td>posun doprava+souèet</td><td>hodnoty se znaménkem, saturace</td><td>1 cyklus</td></tr>
</table>

<img src="http://i.iinfo.cz/images/392/pc163-7.jpg" width="100" height="190" alt="&#160;" />
<p><i>Obrázek 9: Sada serverù HP9000-RP2400 (viz té¾ pøedchozí obrázek)
umístìných v&nbsp;racku.</i></p>



<p><a name="k06"></a></p>
<h2>6. Jak velká byla &bdquo;obì»&ldquo; za podporu SIMD v pøípadì procesorù PA-7100LC?</h2>

<p>Ze souèasného hlediska, kdy poèet tranzistorù umis»ovaných na jeden èip
neustále roste, a to mnohdy bez znatelného nárùstu reálného výkonu, je zajímavé
zjistit, jak slo¾itá vlastnì byla implementace <i>SIMD</i> instrukcí obsa¾ených
v&nbsp;instrukèní sadì <i>MAX-1</i> a jak se zvý¹il výkon nìkterých algoritmù
vyu¾ívajících tyto nové instrukce. Zaènìme nejdøíve cenou, kterou bylo nutné
&bdquo;zaplatit&ldquo; za nové instrukce. Ta byla v&nbsp;podstatì nepatrná,
proto¾e implementace <i>SIMD</i> instrukcí <i>MAX-1</i> zabrala pouze 0,2%
plochy èipu! Tento zanedbatelný nárùst slo¾itosti mikroprocesoru byl dosa¾en
zejména peèlivým výbìrem <i>SIMD</i> instrukcí a takté¾ tím, ¾e se díky pou¾ití
obecných pracovních registrù pro provádìní <i>SIMD</i> operací mohly vyu¾ít ji¾
existující subsystémy umístìné na mikroprocesoru &ndash; dvojice
aritmeticko-logických jednotek (ty se musely upravit jen minimálnì), interní
sbìrnice atd. Naproti tomu se v&nbsp;pøípadì instrukèní sady <i>MMX</i> firmy
Intel na toto hledisko z&nbsp;mnoha dùvodù pøíli¹ nehledìlo, tak¾e se
<i>MMX</i> instrukce provádí ve vlastních funkèních blocích, nezávisle na tom,
¾e v&nbsp;mikroprocesoru ji¾ existuje dvojice ALU i dal¹ích potenciálnì
vyu¾itelných blokù.</p>

<img src="http://i.iinfo.cz/images/392/pc163-8.jpg" width="120" height="120" alt="&#160;" />
<p><i>Obrázek 10: Mikroprocesor PA-7300LC.</i></p>

<p>Nyní se podívejme na to, zda se existence onìch devíti nových instrukcí
nìjak výraznì (èi zda vùbec) projevila na výpoèetním výkonu. V&nbsp;roce 1993,
tedy zhruba rok pøed uvedením èipu <i>PA-7100LC</i> na trh, byla dokonèena
norma <i>MPEG-1</i> popisující zpùsob kódování video a audio signálu (ostatnì
právì zde byl mj.&nbsp;popsán i MPEG Audio Layer III, neboli <i>MP3</i>). Tato
technologie se zaèala pou¾ívat v&nbsp;mnoha oblastech, napøíklad na <i>Video
CD</i> a pozdìji i na <i>Super Video CD</i> a pùvodnì takté¾ pro pøenos
digitální kabelové a satelitní televize (pozdìji do¹lo k&nbsp;náhradì za
<i>MPEG-2</i>). Návrháøi mikroprocesoru <i>PA-7100LC</i> chtìli, aby se nové
<i>SIMD</i> instrukce mohly pou¾ít pro pøehrávání videa <i>MPEG-1</i>
v&nbsp;reálném èase a to bez pou¾ití specializovaných èipù èi DSP procesorù. To
se jim skuteènì podaøilo, proto¾e napøíklad na hi-end pracovní stanici
<i>735/99</i> s&nbsp;procesorem bez podpory <i>MAX-1</i> taktovaném na 99 MHz a
512 kB vyrovnávací pamìti bylo mo¾né pøehrávat video se snímkovou frekvencí
18,7 fps, zatímco prùmìrná pracovní stanice <i>712</i> s&nbsp;procesorem
taktovaným na 60 MHz s&nbsp;podporou <i>MAX-1</i> a pouhými 64 kB vyrovnávací
pamìti se dosáhla pøi pøehrávání snímkové frekvence 26 fps.</p>



<p><a name="k07"></a></p>
<h2>7. Multimedia Acceleration eXtensions 2 (MAX-2)</h2>

<p>V&nbsp;roce 1995 byly firmou HP pøedstaveny 64bitové RISCové procesory nové
generace, které zaèaly být pou¾ívány ji¾ o rok pozdìji &ndash; v&nbsp;roce
1996. Skuteènì se jednalo o zcela novou architekturu procesorù, která sice
èásteènì pøevzala instrukèní formát a dal¹í malièkosti z&nbsp;32bitové
platformy, ov¹em internì ¹lo o zcela nové èipy. Tyto 64bitové mikroprocesory
byly zalo¾eny na ètyøcestné instrukèní pipeline (zatímco pùvodní 32bitová øada
mìla buï jednu pipeline, popø.&nbsp;dvoucestnou pipeline) a umo¾òovaly provádìt
instrukce mimo poøadí (<i>out of order</i>), navíc byly vybaveny i prediktorem
skokù. O provádìní instrukcí se staralo celkem deset funkèních blokù &ndash;
dvì aritmeticko-logické jednotky, dvì jednotky pro bitové posuny, dvì jednotky
FMAC (<i>fuse multiply-accumulate</i>, matematické koprocesory pro základní
aritmetické operace kromì dìlení), dvì jednotky pro provádìní dìlení a výpoètu
druhé odmocniny a koneènì dvì jednotky urèené pro naèítání a ukládání dat do
operaèní pamìti.</p>

<img src="http://i.iinfo.cz/images/392/pc163-9.jpg" width="220" height="219" alt="&#160;" />
<p><i>Obrázek 11: Mikroprocesor HP-PA 8000.<br />
Zdroj: Wikipedia</i></p>

<p>Kromì vylep¹ené interní struktury mikroprocesorù se zvìt¹ila i bitová ¹íøka
pracovních registrù, které se roz¹íøily z&nbsp;pùvodních 32 bitù na 64 bitù. To
mìlo samozøejmì velký dopad i na <i>SIMD</i> instrukce v&nbsp;roz¹iøující
instrukèní sadì <i>MAX</i>, proto¾e ka¾dý pracovní registr bylo mo¾né pou¾ít
pro ulo¾ení vektoru obsahujícího ètveøici 16bitových prvkù. Ji¾ jen tento fakt
znamenal dvojnásobné zvìt¹ení výpoèetního výkonu (napøíklad v&nbsp;pøípadì ji¾
zmiòovaného dekódování videa ulo¾eného podle standardu <i>MPEG-1</i>), ve
skuteènosti se v¹ak reálný výpoèetní výkon mohl pøi vhodné optimalizaci
programù zvý¹it je¹tì více, proto¾e v&nbsp;ideálních pøípadech bylo mo¾né
spustit dvì <i>SIMD</i> instrukce provádìné v&nbsp;aritmeticko-logických
jednotkách a dvì <i>SIMD</i> instrukce provádìné jednotce (modulu) pro bitové
posuny &ndash; viz té¾ informace uvedené v&nbsp;navazující kapitole.</p>

<img src="http://i.iinfo.cz/images/392/pc163-10.jpg" width="220" height="223" alt="&#160;" />
<p><i>Obrázek 12: Mikroprocesor HP-PA 8500.<br />
Zdroj: Wikipedia</i></p>



<p><a name="k08"></a></p>
<h2>8. Seznam instrukcí obsa¾ených v&nbsp;roz¹iøující instrukèní sadì MAX-2</h2>

<p>Vylep¹ená instrukèní sada se <i>SIMD</i> operacemi dostala jméno
<i>MAX-2</i>. Do stávajícího repertoáru &bdquo;vektorových instrukcí&ldquo;
byly pøidány ètyøi nové operace. Jedná se o bitové posuny doleva a doprava (jak
posun logický, tak i aritmetický s&nbsp;kopií znaménka), operaci typu
<strong>MIX</strong> pro kombinaci 16bitových prvkù ulo¾ených ve dvou
zdrojových registrech do prvkù umístìných do registru cílového a koneènì o
operaci typu <strong>PERMUTE</strong> slou¾ící pro permutaci &ndash; zmìnu
poøadí &ndash; 16bitových prvkù umístìných v&nbsp;jediném zdrojovém registru.
V¹echny <i>SIMD</i> instrukce, vèetnì instrukcí pøevzatých z&nbsp;pøedchozí
instrukèní sady, jsou vypsány v&nbsp;následující tabulce:</p>

<table>
<tr><th> #</th><th>Jméno instrukce</th><th>Provádìná operace</th><th>Aritmetika</th></tr>
<tr><td> 1</td><td>HADD   </td><td>souèet</td><td>s&nbsp;pøeteèením (modulo)</td></tr>
<tr><td> 2</td><td>HADD,ss</td><td>souèet</td><td>hodnoty se znaménkem, saturace</td></tr>
<tr><td> 3</td><td>HADD,us</td><td>souèet</td><td>hodnoty bez znaménka, saturace</td></tr>
<tr><td> 4</td><td>HSUB   </td><td>rozdíl</td><td>s&nbsp;pøeteèením (modulo)</td></tr>
<tr><td> 5</td><td>HSUB,ss</td><td>rozdíl</td><td>hodnoty se znaménkem, saturace</td></tr>
<tr><td> 6</td><td>HSUB,us</td><td>rozdíl</td><td>hodnoty bez znaménka, saturace</td></tr>
<tr><td> 7</td><td>HAVG   </td><td>prùmìr</td><td>hodnoty se znaménkem (k&nbsp;pøeteèení ani saturaci nemù¾e dojít)</td></tr>
<tr><td> 8</td><td>HSHLADD</td><td>posun doleva+souèet</td><td>hodnoty se znaménkem, saturace</td></tr>
<tr><td> 9</td><td>HSHRADD</td><td>posun doprava+souèet</td><td>hodnoty se znaménkem, saturace</td></tr>
<tr><td>10</td><td>HSHR	  </td><td>aritmetický posun doprava</td><td>hodnoty se znaménkem</td></tr>
<tr><td>11</td><td>HSHR,u </td><td>logický posun doprava</td><td>hodnoty bez znaménka</td></tr>
<tr><td>12</td><td>HSHL	  </td><td>logický posun doleva</td><td>hodnoty bez znaménka</td></tr>
<tr><td>13</td><td>MIXH	  </td><td>kombinace prvkù umístìných v&nbsp;dvojici registrù<td>&times;</td></td></tr>
<tr><td>14</td><td>MIXW	  </td><td>kombinace prvkù umístìných v&nbsp;dvojici registrù<td>&times;</td></td></tr>
<tr><td>15</td><td>PERMH  </td><td>prohození poøadí prvkù umístìných v&nbsp;jednom registru</td><td>&times;</td></tr>
</table>

<img src="http://i.iinfo.cz/images/392/pc163-11.png" width="326" height="175" alt="&#160;" />
<p><i>Obrázek 13: Schéma provedení instrukce MIX.</i></p>

<p>V&nbsp;pøedchozí kapitole jsme si øekli, ¾e 64bitové mikroprocesory PA-RISC
obsahovaly dvojici aritmeticko-logických jednotek (ALU) a dvojici jednotek pro
bitové posuny (SMU). <i>SIMD</i> operace obsa¾ené v&nbsp;instrukèní sadì
<i>MAX-2</i> byly rozdìleny podle toho, ve kterých jednotkách se spou¹tìly. To
mìlo velký význam pro paralelizaci operací. Pro zajímavost jsou
v&nbsp;následující tabulce vypsány <i>SIMD</i> operace podle toho, ve které
jednotce mohly být spu¹tìny. Díky jednoduchosti a eleganci instrukèní sady
<i>MAX-2</i> a navíc díky velkému mno¾ství pracovních registrù byly
optimalizace <i>SIMD</i> operací souèástí pøekladaèù a bylo je mo¾né relativnì
snadno provádìt i ruènì:</p>

<table>
<tr><th>#</th><th>ALU operace</th><th>SMU operace</th></tr>
<tr><td>1</td><td>HADD    </td><td>HSHR  </td></tr>
<tr><td>2</td><td>HADD,ss </td><td>HSHR,u</td></tr>
<tr><td>3</td><td>HADD,us </td><td>HSHL  </td></tr>
<tr><td>4</td><td>HSUB    </td><td>MIXH  </td></tr>
<tr><td>5</td><td>HSUB,ss </td><td>MIXW  </td></tr>
<tr><td>6</td><td>HSUB,us </td><td>PERMH </td></tr>
<tr><td>7</td><td>HAVG    </td><td>&nbsp;</td></tr>
<tr><td>3</td><td>HSHLADD </td><td>&nbsp;</td></tr>
<tr><td>4</td><td>HSHRADD </td><td>&nbsp;</td></tr>
</table>

<img src="http://i.iinfo.cz/images/392/pc163-12.png" width="281" height="301" alt="&#160;" />
<p><i>Obrázek 14: Schéma provedení instrukce PERMUTE.</i></p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>OpenPA.net &ndash; PA-7100LC (PCX-L)<br />
<a href="http://www.openpa.net/pa-risc_processor_pa-7100lc.html">http://www.openpa.net/pa-risc_processor_pa-7100lc.html</a>
</li>

<li>OpenPA.net &ndash; PA-7300LC (PCX-L2)<br />
<a href="http://www.openpa.net/pa-risc_processor_pa-7300lc.html">http://www.openpa.net/pa-risc_processor_pa-7300lc.html</a>
</li>

<li>Multimedia Acceleration eXtensions (MAX-1 and MAX-2)<br />
<a href="http://www.openpa.net/pa-risc_architecture.html#max">http://www.openpa.net/pa-risc_architecture.html#max</a>
</li>

<li>Architectures Hewlett-Packard PA-RISC Hewlett-Packard PA7300LC<br />
<a href="http://rambo.id.uw.edu.pl/cpuengine.htm?show=Hewlett-Packard%20PA-RISC/PA7300">http://rambo.id.uw.edu.pl/cpuengine.htm?show=Hewlett-Packard%20PA-RISC/PA7300</a>
</li>

<li>PA-7100LC<br />
<a href="http://en.wikipedia.org/wiki/PA-7100LC">http://en.wikipedia.org/wiki/PA-7100LC</a>
</li>

<li>PA7100LC ERS (External Reference Specification)<br />
Hewlett-Packard Company (1999)<br />
<a href="http://ftp.parisc-linux.org/docs/chips/PCXL_ers.pdf">http://ftp.parisc-linux.org/docs/chips/PCXL_ers.pdf</a>
</li>

<li>The PA 7100LC Microprocessor: A Case Study of IC Design Decisions in a Competitive Environment<br />
<a href="http://www.hpl.hp.com/hpjournal/95apr/apr95a2.pdf">http://www.hpl.hp.com/hpjournal/95apr/apr95a2.pdf</a>
</li>

<li>NEON<br />
<a href="http://www.arm.com/products/processors/technologies/neon.php">http://www.arm.com/products/processors/technologies/neon.php</a>
</li>

<li>Architecture and Implementation of the ARM Cortex-A8 Microprocessor<br />
<a href="http://www.design-reuse.com/articles/11580/architecture-and-implementation-of-the-arm-cortex-a8-microprocessor.html">http://www.design-reuse.com/articles/11580/architecture-and-implementation-of-the-arm-cortex-a8-microprocessor.html</a>
</li>

<li>Multimedia Acceleration eXtensions (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Multimedia_Acceleration_eXtensions">http://en.wikipedia.org/wiki/Multimedia_Acceleration_eXtensions</a>
</li>

<li>AltiVec (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/AltiVec">http://en.wikipedia.org/wiki/AltiVec</a>
</li>

<li>Visual Instruction Set (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Visual_Instruction_Set">http://en.wikipedia.org/wiki/Visual_Instruction_Set</a>
</li>

<li>MAJC (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/MAJC">http://en.wikipedia.org/wiki/MAJC</a>
</li>

<li>MDMX (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/MDMX">http://en.wikipedia.org/wiki/MDMX</a>
</li>

<li>MIPS Multiply Unit<br />
<a href="http://programmedlessons.org/AssemblyTutorial/Chapter-14/ass14_3.html">http://programmedlessons.org/AssemblyTutorial/Chapter-14/ass14_3.html</a>
</li>

<li>Silicon Graphics Introduces Enhanced MIPS Architecture<br />
<a href="http://bwrc.eecs.berkeley.edu/CIC/otherpr/enhanced_mips.html">http://bwrc.eecs.berkeley.edu/CIC/otherpr/enhanced_mips.html</a>
</li>

<li>MIPS-3D (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/MIPS-3D">http://en.wikipedia.org/wiki/MIPS-3D</a>
</li>

<li>MIPS Technologies, Inc. announces new MIPS-3D technology to provide silicon-efficient 3D graphics acceleration<br />
<a href="http://www.design-reuse.com/news/2057/mips-mips-3d-technology-silicon-efficient-3d-graphics-acceleration.html">http://www.design-reuse.com/news/2057/mips-mips-3d-technology-silicon-efficient-3d-graphics-acceleration.html</a>
</li>

<li>MIPS-3D Built-in Function (gcc.gnu.org)<br />
<a href="http://gcc.gnu.org/onlinedocs/gcc/MIPS_002d3D-Built_002din-Functions.html">http://gcc.gnu.org/onlinedocs/gcc/MIPS_002d3D-Built_002din-Functions.html</a>
</li>

<li>
Baha Guclu Dundar:<br />
Intel MMX, SSE, SSE2, SSE3/SSSE3/SSE4 Architectures
</li>

<li>
SSE (Streaming SIMD Extentions)<br />
<a href="http://www.songho.ca/misc/sse/sse.html">http://www.songho.ca/misc/sse/sse.html</a>
</li>

<li>
Timothy A. Chagnon: SSE and SSE2<br />
<a href="http://www.cs.drexel.edu/~tc365/mpi-wht/sse.pdf">http://www.cs.drexel.edu/~tc365/mpi-wht/sse.pdf</a>
</li>

<li>
Intel corporation: Extending the Worldr's Most Popular Processor Architecture<br />
<a href="http://download.intel.com/technology/architecture/new-instructions-paper.pdf">http://download.intel.com/technology/architecture/new-instructions-paper.pdf</a>
</li>

<li>
SIMD architectures:<br />
<a href="http://arstechnica.com/old/content/2000/03/simd.ars/">http://arstechnica.com/old/content/2000/03/simd.ars/</a>
</li>

<li>
Tour of the Black Holes of Computing!: Floating Point<br />
<a href="http://www.cs.hmc.edu/~geoff/classes/hmc.cs105.../slides/class02_floats.ppt">http://www.cs.hmc.edu/~geoff/classes/hmc.cs105.../slides/class02_floats.ppt</a>
</li>

<li>3Dnow! Technology Manual<br />
AMD Inc., 2000</li>

<li>Intel MMX<sup>TM</sup> Technology Overview<br />
Intel corporation, 1996</li>

<li>MultiMedia eXtensions<br />
<a href="http://softpixel.com/~cwright/programming/simd/mmx.php">http://softpixel.com/~cwright/programming/simd/mmx.php</a>i
</li>

<li>AMD K5 ("K5" / "5k86")<br />
<a href="http://www.pcguide.com/ref/cpu/fam/g5K5-c.html">http://www.pcguide.com/ref/cpu/fam/g5K5-c.html</a>
</li>

<li>Sixth Generation Processors<br />
<a href="http://www.pcguide.com/ref/cpu/fam/g6.htm">http://www.pcguide.com/ref/cpu/fam/g6.htm</a>
</li>

<li>Great Microprocessors of the Past and Present<br />
<a href="http://www.cpushack.com/CPU/cpu1.html">http://www.cpushack.com/CPU/cpu1.html</a>
</li>

<li>Very long instruction word (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Very_long_instruction_word">http://en.wikipedia.org/wiki/Very_long_instruction_word</a>
</li>

<li>CPU design (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/CPU_design">http://en.wikipedia.org/wiki/CPU_design</a>
</li>

<li>Control unit (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Control_unit">http://en.wikipedia.org/wiki/Control_unit</a>
</li>

<li>Cray History<br />
<a href="http://www.cray.com/About/History.aspx?404;http://www.cray.com:80/about_cray/history.html">http://www.cray.com/About/History.aspx?404;http://www.cray.com:80/about_cray/history.html</a>
</li>

<li>Cray Historical Timeline<br />
<a href="http://www.cray.com/Assets/PDF/about/CrayTimeline.pdf">http://www.cray.com/Assets/PDF/about/CrayTimeline.pdf</a>
</li>

<li>Computer Speed Claims 1980 to 1996<br />
<a href="http://homepage.virgin.net/roy.longbottom/mips.htm">http://homepage.virgin.net/roy.longbottom/mips.htm</a>
</li>

<li>Superpoèítaèe Cray<br />
<a href="http://www.root.cz/clanky/superpocitace-cray/">http://www.root.cz/clanky/superpocitace-cray/</a>
</li>

<li>Superpoèítaèe Cray (druhá èást)<br />
<a href="http://www.root.cz/clanky/superpocitace-cray-druha-cast/">http://www.root.cz/clanky/superpocitace-cray-druha-cast/</a>
</li>

<li>Superpoèítaèe Cray (tøetí èást)<br />
<a href="http://www.root.cz/clanky/superpocitace-cray-treti-cast/">http://www.root.cz/clanky/superpocitace-cray-treti-cast/</a>
</li>

<li>Superpoèítaèe Cray (ètvrtá èást)<br />
<a href="http://www.root.cz/clanky/superpocitace-cray-ctvrta-cast/">http://www.root.cz/clanky/superpocitace-cray-ctvrta-cast/</a>
</li>

<li>Superpoèítaèe Cray (pátá èást): architektura Cray X-MP<br />
<a href="http://www.root.cz/clanky/superpocitace-cray-pata-cast-architektura-pocitace-cray-x-mp-a-jeho-pouziti-ve-filmovem-prumyslu/">http://www.root.cz/clanky/superpocitace-cray-pata-cast-architektura-pocitace-cray-x-mp-a-jeho-pouziti-ve-filmovem-prumyslu/</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2011</small></p>
</body>
</html>

