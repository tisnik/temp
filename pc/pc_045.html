<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Universální sériová sbìrnice (USB)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Universální sériová sbìrnice (USB)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dne¹ní èásti seriálu o architekturách poèítaèù se budeme zabývat v souèasnosti velmi populární universální sériovou sbìrnicí (USB). Jedná se o externí sbìrnici (ov¹em s hvìzdicovou a nikoli sbìrnicovou topologií), která byla navr¾ena s ohledem na co nejsnaz¹í pøipojení externích zaøízení k poèítaèi.</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. Universální sériová sbìrnice (USB)</a><br />
<a href="#k02">2. Zpùsob propojení a vzájemné komunikace zaøízení</a><br />
<a href="#k03">3. Rozboèovaèe</a><br />
<a href="#k04">4. Pøenosové rychlosti</a><br />
<a href="#k05">5. Tøídy a podtøídy USB zaøízení</a><br />
<a href="#k06">6. Podpora USB v&nbsp;Linuxu &ndash; pøíkaz <strong>dmesg</strong></a><br />
<a href="#k07">7. Podpora USB v&nbsp;Linuxu &ndash; pøíkaz <strong>lsusb</strong></a><br />
<a href="#k08">8. Literatura a odkazy na Internetu</a><br />
<a href="#k09">9. Obsah dal¹í èásti seriálu</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. Universální sériová sbìrnice (USB)</h1>

<p>V&nbsp;dne¹ní èásti seriálu si popí¹eme základní charakteristiky takzvané
universální sériové sbìrnice &ndash; <i>USB</i>. Zkratka v&nbsp;názvu této
sbìrnice vznikla z&nbsp;anglického sousloví <i>Universal Serial Bus</i>. Jedná
se o externí sbìrnici, která je &ndash; kromì svého znaèného roz¹íøení &ndash;
zajímavá pøedev¹ím tím, ¾e na fyzické úrovni jsou jednotlivá komunikující
zaøízení (vèetnì <i>hubù</i> popsaných dále) propojena systémem <i>point to
point</i> (jedním kabelem jsou propojena v¾dy jen dvì zaøízení) a ne skuteènou
sbìrnicí tvoøenou spoleènými vodièi. Naproti tomu minule a pøedminule popsaná
sbìrnice <i>I<sup>2</sup>C</i> spoleèný vodiè pro pøenos dat a synchronizaèního
hodinového signálu obsahuje. Na logické úrovni se v¹ak o sbìrnici skuteènì
jedná, nebo» komunikace mù¾e probíhat i mezi zaøízeními mezi nimi¾ le¾í i
nìkolik <i>hubù</i>, tj.&nbsp;uzlù, ve kterých dochází k&nbsp;vìtvení. Jak
konstrukèní provedení konektorù, tak i zpùsob propojení jednotlivých
komunikujících uzlù (vèetnì mo¾nosti odpojit a znovu pøipojit nìjaký uzel bez
nutnosti jeho vypnutí/zapnutí nebo vypnutí a opìtovného zapnutí øídicího
poèítaèe &ndash; <i>hot plug</i>) je navr¾eno s&nbsp;ohledem na co nejsnaz¹í
práci se zaøízeními urèenými pro tuto sbìrnici.</p>

<image id="7992" />
<p-center><i>Obrázek 1: Logo sbìrnice USB pøipomíná její topologickou strukturu
s&nbsp;jedním zaøízením pracujícím v&nbsp;re¾imu master a dvìma rozboèovaèi.
Pov¹imnìte si, ¾e stejné logo se nachází napøíklad na nìkterých konektorech;
viz obrázek umístìný vlevo od perexu tohoto èlánku. Pro marketing jsou urèena
dal¹í (vícebarevná) loga, která si mù¾ete prohlédnout napøíklad na stránce <a
href="http://www.usb.org/">http://www.usb.org/</a>. Logo zobrazené na tomto
obrázku se v&nbsp;literatuøe také nazývá &bdquo;trident&ldquo;
(trojzubec).</i></p-center>

<p>U externí sbìrnice <i>USB</i> byly také do znaèné míry vyøe¹eny potí¾e
s&nbsp;neexistencí napájecího napìtí se zaruèenou proudovou zátì¾í.
V&nbsp;pøedchozích èástech tohoto seriálu jsme si øekli, ¾e napøíklad u
sériového portu <i>RS-232C</i> èi paralelního portu (a s&nbsp;ním souvisejícího
rozhraní <i>Centronics</i>) mohly vzniknout dosti záva¾né problémy
v&nbsp;pøípadì, ¾e poèítaè a pøipojené zaøízení bylo napájeno z&nbsp;odli¹né
fáze nebo ze zcela jiné napájecí sítì. Mnoho men¹ích zaøízení, které se
pøipojují ke sbìrnici <i>USB</i> má tak malé výkonové po¾adavky, ¾e je lze
napájet pøímo pomocí napájecích vodièù vyvedených z&nbsp;poèítaèe na konektory
<i>USB</i>. V&nbsp;posledních nìkolika letech jsme tak svìdky vzniku více èi
ménì u¾iteèných zaøízení, které se obejdou bez vlastního napájení (baterie èi
transformátoru), co¾ mj.&nbsp;vede k&nbsp;ni¾¹í cenì tìchto zaøízení. Sbìrnice
<i>USB</i> díky svým vlastnostem postupnì vytlaèila prakticky v¹echny star¹í
technologie slou¾ící k&nbsp;pøipojení externích zaøízení k&nbsp;poèítaèùm
&ndash; napøíklad port pro klávesnici a my¹ (pùvodnì se na IBM PC jednalo o
konektor typu <i>DIN</i>, pozdìji <i>PS/2</i>), sériový port <i>RS-232C</i>
(v&nbsp;nìkterých oblastech je v¹ak sériový port sbìrnicí <i>USB</i> jen tì¾ko
nahraditelný), paralelní porty atd. Jedinou výjimkou jsou vysokorychlostní
externí zaøízení, pro které se dnes pou¾ívá pøevá¾nì rozhraní <i>FireWire</i> a
<i>SCSI</i>, i kdy¾ i zde mù¾e dojít ke zmìnì po pøechodu na nejrychlej¹í
verzi <i>USB</i>.</p>

<image id="7993" />
<p-center><i>Obrázek 2: Miniaturní cestovní my¹ urèená pro sbìrnici USB.
Pøívodní kabel k&nbsp;my¹i je schován v&nbsp;malém mechanismu vybaveném
samonavíjecí pru¾inou. Sbìrnice USB obsahuje kromì dvou datových vodièù i
napájecí vodièe, pøièem¾ je normou stanoveno, jaký proud mohou jednotlivá
zaøízení z&nbsp;poèítaèe odebírat. Díky tomu se k&nbsp;USB mohou pøipojit rùzné
cestovní lampièky, ohøívaèe na kávu, nabíjeèe baterií, vìtráèky atd., které ji¾
nemusí mít vlastní (mnohdy neefektivní) napájecí zdroj.</i></p-center>



<p><a name="k02"></a></p>
<h1>2. Zpùsob propojení a vzájemné komunikace zaøízení</h1>

<p>V&nbsp;úvodní kapitole jsme si øekli, ¾e i pøes svùj název není fyzické
topologické schéma <i>USB</i> zalo¾eno na sbìrnicové (lineární) topologii, ale
na víceúrovòové hvìzdicové èi, pøesnìji øeèeno, stromové struktuøe (strom je
mj.&nbsp;charakteristický i tím, ¾e neobsahuje ¾ádný <i>cyklus</i>, tj.&nbsp;na
<i>USB</i> není mo¾né vytvoøit zaøízení zapojená do kruhu). Koøenem tohoto
stromu je zaøízení, které komunikaci øídí, tj.&nbsp;jedná se o zaøízení
pracující v&nbsp;re¾imu <i>master</i>; ostatní zaøízení, jich¾ mù¾e být a¾ 127,
pracují v&nbsp;re¾imu <i>slave</i>. Jako <i>master</i> vìt¹inou vystupuje
poèítaè, do kterého jsou pøipojována dal¹í zaøízení a také rozboèovaèe
(<i>hubs</i>). Existence pouze jednoho zaøízení typu <i>master</i> vede ke
zjednodu¹ení komunikaèního protokolu, na druhou stranu to v¹ak také znamená, ¾e
bez pou¾ití nìjakých mezièlánkù není mo¾né mezi sebou propojit dvì zaøízení
typu <i>master</i>, tj.&nbsp;ani dva poèítaèe. Rozdíl mezi obìma typy zaøízení
je zaji¹tìn i na fyzické úrovni &ndash; konektor umístìný v&nbsp;poèítaèi je
mechanicky odli¹ný od konektorù zabudovaných na dal¹ích zaøízeních. Existují
sice zaøízení, které mohou pracovat jako <i>master</i> i <i>slave</i> &ndash;
napøíklad se jedná o digitální fotoaparáty schopné pøi pøipojení
k&nbsp;poèítaèi emulovat <i>mass storage device</i> a naopak doká¾í ovládat
k&nbsp;nim pøipojenou tiskárnu &ndash; ov¹em v&nbsp;daném okam¾iku je aktivní
pouze jeden z&nbsp;tìchto re¾imù (nehledì na to, ¾e se pou¾ívají odli¹né
konektory èi propojovací kabely).</p>

<image id="7994" />
<p-center><i>Obrázek 3: Konektor typu A urèený pro externí sbìrnici USB. Tento
konektor se pøipojuje v¾dy do poèítaèe (pøesnìji øeèeno do zaøízení typu
master), na druhé stranì propojovacího kabelu je umístìn konektor typu B,
proto¾e na USB není mo¾né pøipojit dvì zaøízení pracující v&nbsp;re¾imu master.
To mj.&nbsp;znamená, ¾e pøes USB nelze pøímo (bez nìjakého mezièlánku) propojit
dva poèítaèe.</i></p-center>



<p><a name="k03"></a></p>
<h1>3. Rozboèovaèe</h1>

<p>Vzhledem k&nbsp;tomu, ¾e jedním kabelem lze propojit pouze dva uzly, musí
existovat zpùsob, jak celkový poèet uzlù (zaøízení) zvý¹it a¾ na maximální
hranici, která èiní 127 uzlù pøipojitelných k&nbsp;jednomu koøenovému uzlu
(<i>master</i>). Øe¹ení problému pøipojení vìt¹ího mno¾ství zaøízení spoèívá
v&nbsp;pou¾ití takzvaných rozboèovaèù (<i>hubs</i>). Ka¾dý rozboèovaè, který
mù¾e být pøedstavován buï specializovaným zaøízením, je¾ slou¾í pouze pro
pøipojení dal¹ích uzlù, nebo má i jinou funkci (rozboèovaèe na monitorech,
klávesnicích atd.) obsahuje v¾dy jeden konektor (vìt¹inou typu B) urèený pro
pøipojení buï pøímo ke koøenu (poèítaèi) nebo k&nbsp;dal¹ímu rozboèovaèi a
prakticky libovolný poèet konektorù (vìt¹inou typu A), na které lze pøipojit
koncová zaøízení. Díky tomuto uspoøádání je ji¾ mechanicky zaji¹tìno, ¾e
nevznikne zakázaná topologie obsahující cyklus. Na tomto místì je vhodné
upozornit na to, ¾e rozboèovaè obsahuje pomìrnì slo¾ité obvody, které zaji¹»ují
øízení sbìrnice, zesilování signálù, úpravu jejich hran a smìrování paketù,
tj.&nbsp;<i>nejedná</i> se o pouhé paralelní propojení nìkolika konektorù.
Norma stanovuje, ¾e za sebou mù¾e být zapojeno maximálnì pìt rozboèovaèù, ov¹em
díky tomu, ¾e poèet rozboèovaèù na stejné úrovni ji¾ omezen není, lze snadno
vybudovat i velmi rozsáhlé sítì, které jsou omezené pøedev¹ím maximální
povolenou délkou propojovacích kabelù (3m v&nbsp;pøípadì <i>USB 2.0</i>).</p>

<image id="7995" />
<p-center><i>Obrázek 4: Zaøízení poskytující mo¾nost pøipojení a¾ pìti dal¹ích
USB zaøízení.</i></p-center>



<p><a name="k04"></a></p>
<h1>4. Pøenosové rychlosti</h1>

<p>Zaøízení, která jsou pøipojena na sbìrnici <i>USB</i> mohou pøená¹et data
nìkolika rychlostmi. Pùvodní norma, dnes oznaèovaná jako <i>USB 1.0</i>
stanovovala dvì rychlosti. Základní rychlost 1,5 MB za sekundu (12 Mb za
sekundu), neboli <i>Full Speed</i> musí být podporována v¹emi rozboèovaèi a
vìt¹inou i samotným koøenovým uzlem (<i>master</i>), nikoli v¹ak nutnì
koncovými zaøízeními, proto¾e nìkterá zaøízení, napøíklad klávesnice èi
joysticky, tak vysokou rychlost ke své èinnosti nepotøebují. Taková pomalá
zaøízení pracují na rychlosti 187,5 kB za sekundu (1,5 Mb za sekundu), je¾ se
oznaèuje termínem <i>Low Speed</i>. Pøi této rychlosti se ka¾dý bit pøená¹í
osmkrát pomaleji ne¾ pøi pou¾ití základní (plné) rychlosti. V&nbsp;roze 2001
byla v&nbsp;normì <i>USB 2.0</i> stanovena i vy¹¹í rychlost &ndash; <i>High
speed</i> &ndash; pøi které lze teoreticky dosáhnout a¾ hodnot 60 MB za sekundu
(480 Mb za sekundu), ov¹em ne v¹echna zaøízení, která na sobì mají nálepku
<i>USB 2.0</i> skuteènì a¾ této rychlosti dosahují. Zaøízení dovolující pou¾ití
<i>High speed</i> mù¾e v&nbsp;pøípadì potøeby pøejít i na základní rychlost,
co¾ je nutné pro udr¾ení zpìtné kompatibility.</p>

<image id="7996" />
<p-center><i>Obrázek 5: Miniaturizace integrovaných obvodù s&nbsp;pamì»mi typu
Flash umo¾òuje konstrukci stylových USB diskù. Ten, který je zobrazen na pátém
obrázku, je mo¾né pou¾ít ve stavebnici LEGO (má &bdquo;kompatibilní&ldquo;
rozmìry).</i></p-center>

<p>V&nbsp;souèasnosti se vìt¹inou mù¾eme setkat se základními deskami a
zaøízeními, které plnì podporují <i>USB 2.0</i>, tedy i v¹echny tøi vý¹e
popsané pøenosové rychlosti. Ov¹em pomìrnì nedávno, konkrétnì v&nbsp;létì
minulého roku, byla vydána specifikace <i>USB 3.0</i>, která mj.&nbsp;obsahuje
i tzv.&nbsp;<i>SuperSpeed</i>, co¾ je oznaèení pøenosové rychlosti, její¾
hodnota dosahuje 625 MB za sekundu (5,0 Gb za sekundu). V&nbsp;souèasnosti se
se zaøízeními, které by tuto rychlost podporovaly, pravdìpodobnì nesetkáme, ale
firma Intel (jeden z&nbsp;autorù této specifikace) oèekává, ¾e by se ji¾ koncem
tohoto roku mohly na trh dostat základní desky i externí zaøízení odpovídající
<i>USB 3.0</i>. <i>SuperSpeed</i> ji¾ umo¾òuje práci s&nbsp;videem èi
s&nbsp;rychlými externími pevnými disky, tj.&nbsp;jedná se o alternativu
k&nbsp;externímu <i>SCSI</i> èi <i>FireWire</i> (v&nbsp;souèasnosti napøíklad
pevné disky pøipojené pøes <i>FireWire</i> pracují rychleji ne¾ srovnatelné
disky pøipojené pøes <i>USB 2.0</i>). Zajímavé porovnání obou technologií
mù¾ete najít pod tímto odkazem: <a
href="http://www.pcfastlane.com/features/usb-30-vs-firewire-3200/">http://www.pcfastlane.com/features/usb-30-vs-firewire-3200/</a>.</p>

<image id="7997" />
<p-center><i>Obrázek 6: Velmi praktické externí zaøízení: USB disk zabudovaný
v&nbsp;propisce, který je mo¾né doplnit i o laserové ukazovátko.</i></p-center>



<p><a name="k05"></a></p>
<h1>5. Tøídy a podtøídy USB zaøízení</h1>

<p>Na universální sériovou sbìrnici je mo¾né pøipojit velké mno¾ství rùzných
zaøízení, od pomalorychlostních klávesnic, my¹í a joystickù pøes známé pamìti
Flash (Flash disky) a¾ po tiskárny, webové kamery èi skenery. Ka¾dému zaøízení
je podle jeho funkce pøiøazen kód nazývaný <i>tøída zaøízení</i>. Podle tøídy
zaøízení, kterou je mo¾né zjistit ihned po zapojení zaøízení do sítì a jeho
resetu, operaèní systém zvolí vhodný ovladaè, pøièem¾ &ndash; a to je docela
dùle¾ité, pøedev¹ím na Linuxu &ndash; zaøízení, která spadají do stejné tøídy,
mohou pou¾ívat shodný èi velmi podobný ovladaè, i kdy¾ se mù¾e jednat o
zaøízení od rùzných výrobcù. Nìkteré tøídy zaøízení se dále dìlí na
specializované podtøídy a pod-podtøídy. V&nbsp;následujícím výpisu jsou v¹echny
tøídy zaøízení vypsány, vèetnì podtøíd (<i>subclasses</i>).</p>

<code-area>
00  (Defined at Interface level)
01  Audio
        01  Control Device
        02  Streaming
        03  MIDI Streaming
02  Communications
        01  Direct Line
        02  Abstract (modem)
                00  None
                01  AT-commands (v.25ter)
                02  AT-commands (PCCA101)
                03  AT-commands (PCCA101 + wakeup)
                04  AT-commands (GSM)
                05  AT-commands (3G)
                06  AT-commands (CDMA)
                fe  Defined by command set descriptor
                ff  Vendor Specific (MSFT RNDIS?)
        03  Telephone
        04  Multi-Channel
        05  CAPI Control
        06  Ethernet Networking
        07  ATM Networking
        08  Wireless Handset Control
        09  Device Management
        0a  Mobile Direct Line
        0b  OBEX
        0c  Ethernet Emulation
                07  Ethernet Emulation (EEM)
03  Human Interface Device
        00  No Subclass
                00  None
                01  Keyboard
                02  Mouse
        01  Boot Interface Subclass
                00  None
                01  Keyboard
                02  Mouse
05  Physical Interface Device
06  Imaging
        01  Still Image Capture
                01  Picture Transfer Protocol (PIMA 15470)
07  Printer
        01  Printer
                00  Reserved/Undefined
                01  Unidirectional
                02  Bidirectional
                03  IEEE 1284.4 compatible bidirectional
                ff  Vendor Specific
08  Mass Storage
        01  RBC (typically Flash)
                00  Control/Bulk/Interrupt
                01  Control/Bulk
                50  Bulk (Zip)
        02  SFF-8020i, MMC-2 (ATAPI)
        03  QIC-157
        04  Floppy (UFI)
                00  Control/Bulk/Interrupt
                01  Control/Bulk
                50  Bulk (Zip)
        05  SFF-8070i
        06  SCSI
                00  Control/Bulk/Interrupt
                01  Control/Bulk
                50  Bulk (Zip)
09  Hub
        00  Unused
                00  Full speed (or root) hub
                01  Single TT
                02  TT per port
0a  CDC Data
        00  Unused
                30  I.430 ISDN BRI
                31  HDLC
                32  Transparent
                50  Q.921M
                51  Q.921
                52  Q.921TM
                90  V.42bis
                91  Q.932 EuroISDN
                92  V.120 V.24 rate ISDN
                93  CAPI 2.0
                fd  Host Based Driver
                fe  CDC PUF
                ff  Vendor specific
0b  Chip/SmartCard
0d  Content Security
0e  Video
        00  Undefined
        01  Video Control
        02  Video Streaming
        03  Video Interface Collection
dc  Diagnostic
        01  Reprogrammable Diagnostics
                01  USB2 Compliance
e0  Wireless
        01  Radio Frequency
                01  Bluetooth
                02  Ultra WideBand Radio Control
                03  RNDIS
        02  Wireless USB Wire Adapter
                01  Host Wire Adapter Control/Data Streaming
                02  Device Wire Adapter Control/Data Streaming
                03  Device Wire Adapter Isochronous Streaming
ef  Miscellaneous Device
        01  ?
                01  Microsoft ActiveSync
                02  Palm Sync
        02  ?
                01  Interface Association
                02  Wire Adapter Multifunction Peripheral
        03  ?
                01  Cable Based Association
fe  Application Specific Interface
        01  Device Firmware Update
        02  IRDA Bridge
        03  Test and Measurement
                01  TMC
                02  USB488
ff  Vendor Specific Class
        ff  Vendor Specific Subclass
                ff  Vendor Specific Protocol
</code-area>

<image id="7998" />
<p-center><i>Obrázek 7: Flash disk pøipojený do poèítaèe se ohla¹uje jako
zaøízení tøídy 08, podtøída 06. Stejný flash disk byla pou¾it i pro
otestování dále popsaných Linuxových pøíkazù dmesg a lsusb.</i></p-center>



<p><a name="k06"></a></p>
<h1>6. Podpora USB v&nbsp;Linuxu &ndash; pøíkaz <strong>dmesg</strong></h1>

<p>Linux (zde mám na mysli samotné jádro, moduly a základní systémové utility)
samozøejmì podporuje jak samotnou universální sériovou sbìrnici, tak i velké
mno¾ství zaøízení urèených pro <i>USB</i>. Pøi pøipojení nového zaøízení se
pøitom Linux chová podobnì, jako mnoho dal¹ích operaèních systémù. Nejdøíve je
na novì pøipojené zaøízení poslán pøíkaz <strong>reset</strong> a poté je
zji¹tìna tøída (a popø.&nbsp;i podtøída) zaøízení a jeho výrobce (<i>vendor
ID</i>). Na základì tìchto informací je zaøízení pøes nahraný ovladaè
obsluhováno a je dostupné i u¾ivatelùm s&nbsp;pøíslu¹nými pøístupovými právy
&ndash; flash disk se napøíklad mù¾e obsluhovat pøes symbolické jméno zaøízení
<i>/dev/sda1</i> (lze jednodu¹e provést fyzickou kopii dat, vhodné napøíklad ve
chvíli, kdy se po¹kodí souborový systém Flash pamìti pro fotoaparát, na které
jsou dùle¾ité fotky), kamera jako <i>/dev/video0</i>, USB my¹ jako
<i>/dev/input/mice</i> (zkuste si pro zajímavost <strong>cat
/dev/input/mice</strong> a zahýbejte my¹í) atd.</p>

<image id="7999" />
<p-center><i>Obrázek 8: Ohøívaè na kávu napájený pøímo z&nbsp;poèítaèe pøes
USB.</i></p-center>

<p>Pøi øe¹ení rùzných problémù se zaøízeními urèenými pro <i>USB</i> èi jen pro
zji¹tìní tøídy a výrobce nìjakého zaøízení je mo¾né pou¾ít pøíkaz
<strong>dmesg</strong>, který pøi pøipojení i odpojení zaøízení vypí¹e nìkteré
zajímavé informace (pro oddìlení nových informací od informací pøedchozích lze
pou¾ít <strong>dmesg -c</strong> a posléze <strong>dmesg</strong>). Uká¾eme si
nìkolik pøíkladù výpisu:</p>



<h2>Pøipojení flash disku</h2>

<p>(Viz té¾ obrázek 7, kde jsou informace o stejném disku, ov¹em pøipojeném do
pùjèeného poèítaèe s&nbsp;Windows XP. Díky <strong>dmesg</strong> v¹ak máme
k&nbsp;dispozici i mnohem více informací, napøíklad pøesný poèet a délku
sektorù).</p>

<code-area>
[  101.568000] usb 1-1: new full speed USB device using uhci_hcd and address 3
[  101.720000] usb 1-1: configuration #1 chosen from 1 choice
[  101.892000] usbcore: registered new interface driver libusual
[  101.924000] Initializing USB Mass Storage driver...
[  101.928000] scsi0 : SCSI emulation for USB Mass Storage devices
[  101.928000] usb-storage: device found at 3
[  101.928000] usb-storage: waiting for device to settle before scanning
[  101.928000] usbcore: registered new interface driver usb-storage
[  101.928000] USB Mass Storage support registered.
[  106.928000] usb-storage: device scan complete
[  106.932000] scsi 0:0:0:0: Direct-Access     JetFlash TS256MJF110 0.00 PQ: 0 ANSI: 2
[  106.996000] sd 0:0:0:0: [sda] 491520 512-byte hardware sectors (252 MB)
[  107.000000] sd 0:0:0:0: [sda] Write Protect is off
[  107.000000] sd 0:0:0:0: [sda] Mode Sense: 00 00 00 00
[  107.000000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[  107.004000] sd 0:0:0:0: [sda] 491520 512-byte hardware sectors (252 MB)
[  107.008000] sd 0:0:0:0: [sda] Write Protect is off
[  107.008000] sd 0:0:0:0: [sda] Mode Sense: 00 00 00 00
[  107.008000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[  107.008000]  sda: sda1
[  107.120000] sd 0:0:0:0: [sda] Attached SCSI removable disk
[  107.148000] sd 0:0:0:0: Attached scsi generic sg0 type 0
</code-area>

<h2>Odpojení flash disku</h2>

<code-area>
[  219.012000] usb 1-1: USB disconnect, address 3
</code-area>

<h2>Pøipojení flash disku, které skonèilo s chybou</h2>

<p>(mù¾e jít buï o vadný kabel èi nekompatibilitu mezi základní deskou a daným
diskem)</p>

<code-area>
[17187317.880000] ohci_hcd 0000:00:02.0: wakeup
[17187318.264000] usb 1-3: new full speed USB device using ohci_hcd and address 2
[17187318.448000] usb 1-3: device descriptor read/64, error -110
[17187318.736000] usb 1-3: device descriptor read/64, error -110
[17187319.016000] usb 1-3: new full speed USB device using ohci_hcd and address 3
[17187319.200000] usb 1-3: device descriptor read/64, error -110
[17187319.488000] usb 1-3: device descriptor read/64, error -110
[17187319.768000] usb 1-3: new full speed USB device using ohci_hcd and address 4
[17187320.176000] usb 1-3: device not accepting address 4, error -110
[17187320.352000] usb 1-3: new full speed USB device using ohci_hcd and address 5
[17187320.760000] usb 1-3: device not accepting address 5, error -110
</code-area>

<h2>Pøipojení USB my¹i</h2>

<code-area>
[  510.816000] usb 1-1: new low speed USB device using uhci_hcd and address 4
[  510.988000] usb 1-1: configuration #1 chosen from 1 choice
[  511.008000] input: Logitech Optical USB Mouse as /class/input/input6
[  511.008000] input: USB HID v1.10 Mouse [Logitech Optical USB Mouse] on usb-0000:00:07.2-1
</code-area>

<h2>Odpojení USB my¹i</h2>

<code-area>
[  569.292000] usb 1-1: USB disconnect, address 4
</code-area>



<p><a name="k07"></a></p>
<h1>7. Podpora USB v&nbsp;Linuxu &ndash; pøíkaz <strong>lsusb</strong></h1>

<p>Dal¹ím u¾iteèným Linuxovým pøíkazem je pøíkaz <strong>lsusb</strong>, který
&ndash; jak asi správnì tu¹íte &ndash; provede výpis v¹ech zaøízení pøipojených
na universální sériovou sbìrnici (pro sbìrnici PCI je urèen podobnì vypadající
pøíkaz <strong>lspci</strong> atd.). Z&nbsp;ní¾e uvedeného výpisu je i pøes
absenci podrobnìj¹ích informací zøejmé, ¾e jsou pøipojena tøi zaøízení &ndash;
Flash disk, optická my¹ a klávesnice:</p>

<code-area>
Bus 001 Device 006: ID 0457:0151 Silicon Integrated Systems Corp. Super Flash 1GB Flash Drive
Bus 001 Device 005: ID 046d:c016 Logitech, Inc. M-UV69a Optical Wheel Mouse
Bus 001 Device 002: ID 04f2:0110 Chicony Electronics Co., Ltd KU-2971 Keyboard
Bus 001 Device 001: ID 0000:0000
Bus 002 Device 001: ID 0000:0000
</code-area>

<p>Pokud je zapotøebí získat podrobnìj¹í informace o nìjakém zaøízení
(napøíklad o flash disku z&nbsp;pøedchozího výpisu), lze pou¾ít modifikátor
<strong>-v</strong> (verbose) a popø.&nbsp;i pøímo specifikovat po¾adované
zaøízení. Ní¾e ukázaný výpis byl získán pøíkazem <strong>lsusb -v -d 0457:0151
&gt; flash_drive.txt</strong>, kde <strong>0457:0151</strong> je identifikace
výrobce a zaøízení:</p>

<code-area>
Bus 1 Device 4: ID 0457:0151 Silicon Integrated Systems Corp. Super Flash 1GB Flash Drive
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass            0 (Defined at Interface level)
  bDeviceSubClass         0 
  bDeviceProtocol         0 
  bMaxPacketSize0        64
  idVendor           0x0457 Silicon Integrated Systems Corp.
  idProduct          0x0151 Super Flash 1GB Flash Drive
  bcdDevice            1.00
  iManufacturer           0 
  iProduct                2 USB Mass Storage Device
  iSerial                 3 9287b453dc70d6
  bNumConfigurations      1
  Configuration Descriptor:
    bLength                 9
    bDescriptorType         2
    wTotalLength           39
    bNumInterfaces          1
    bConfigurationValue     1
    iConfiguration          0 
    bmAttributes         0x80
      (Bus Powered)
    MaxPower               98mA
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        0
      bAlternateSetting       0
      bNumEndpoints           3
      bInterfaceClass         8 Mass Storage
      bInterfaceSubClass      6 SCSI
      bInterfaceProtocol     80 Bulk (Zip)
      iInterface              0 
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x01  EP 1 OUT
        bmAttributes            2
          Transfer Type            Bulk
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0200  1x 512 bytes
        bInterval               1
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x82  EP 2 IN
        bmAttributes            2
          Transfer Type            Bulk
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0200  1x 512 bytes
        bInterval               1
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x83  EP 3 IN
        bmAttributes            3
          Transfer Type            Interrupt
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0040  1x 64 bytes
        bInterval               8
Device Qualifier (for other device speed):
  bLength                10
  bDescriptorType         6
  bcdUSB               2.00
  bDeviceClass            0 (Defined at Interface level)
  bDeviceSubClass         0 
  bDeviceProtocol         0 
  bMaxPacketSize0        64
  bNumConfigurations      1
Device Status:     0x0000
  (Bus Powered)
</code-area>

<image id="8000" />
<p-center><i>Obrázek 9: Konektory typu A sbìrnice USB umístìné na moderní
základní desce. Pro star¹í poèítaèe, které nemají øadiè USB umístìný pøímo na
základní desce je mo¾né pou¾ít pøídavnou kartu, urèenou buï do sbìrnice PCI,
PCI-X nebo PCI-Express.</i></p-center>



<p><a name="k08"></a></p>
<h1>8. Literatura a odkazy na Internetu</h1>

<ol>

<li>USB.ORG,<br />
<a href="http://www.usb.org/">http://www.usb.org/</a></li>

<li>Bit-banging,<br />
<a href="http://en.wikipedia.org/wiki/Bit-banging">http://en.wikipedia.org/wiki/Bit-banging</a></li>

<li>List of USB ID's,<br />
<a href="http://www.linux-usb.org/usb.ids">http://www.linux-usb.org/usb.ids</a></li>

<li>EUSB to SPI bus Kit,<br />
<a href="http://www.eidusa.com/Electronics_Kits_EUSB_To_SPI_BUS.htm">http://www.eidusa.com/Electronics_Kits_EUSB_To_SPI_BUS.htm</a></li>

<li>Basic USB Configuration,<br />
<a href="http://www.linux-usb.org/USB-guide/c122.html#AEN124">http://www.linux-usb.org/USB-guide/c122.html#AEN124</a></li>

<li>Linux-USB device overview,<br />
<a href="http://www.qbik.ch/usb/devices/">http://www.qbik.ch/usb/devices/</a></li>

<li>USBMan - USB 1, 2, &amp; 3 Help and Information,<br />
<a href="http://www.usbman.com/linuxusb.htm">http://www.usbman.com/linuxusb.htm</a></li>

<li>ThinkGeek - Elekronics Gadgets,<br />
<a href="http://www.thinkgeek.com/gadgets/electronic/85b6/">http://www.thinkgeek.com/gadgets/electronic/85b6/</a></li>

<li>HID Information,<br />
<a href="http://www.usb.org/developers/hidpage/">http://www.usb.org/developers/hidpage/</a></li>

<li>Bit rate,<br />
<a href="http://en.wikipedia.org/wiki/Bit_rate">http://en.wikipedia.org/wiki/Bit_rate</a></li>

<li>USB 3.0 vs. FireWire 3200,<br />
<a href="http://www.pcfastlane.com/features/usb-30-vs-firewire-3200/">http://www.pcfastlane.com/features/usb-30-vs-firewire-3200/</a></li>

</ol>



<p><a name="k09"></a></p>
<h1>9. Obsah dal¹í èásti seriálu</h1>

<p>V&nbsp;následující èásti seriálu o architekturách poèítaèù si popí¹eme
komunikaèní protokol pou¾itý universální sériovou sbìrnicí pøi pøenosu dat i
øídicích kódù. Také si popí¹eme fyzickou a linkovou vrstvu této sbìrnice,
vèetnì zpùsobu kódování jednotlivých bajtù, adresování zaøízení atd.</p>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2008</small></p>
</body>
</html>

