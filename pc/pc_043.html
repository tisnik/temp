<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Externí sériové sbìrnice SPI a I<sup>2</sup>C</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Externí sériové sbìrnice SPI a I<sup>2</sup>C</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Ve ètyøicáté tøetí èásti seriálu o architekturách poèítaèù si popí¹eme princip dvou externích sériových sbìrnic pou¾ívaných (i kdy¾ v ponìkud nenápadné formì) jak v bì¾ných osobních poèítaèích, tak i v mnoha prùmyslových zaøízeních. Jedná se o sbìrnici SPI a sbìrnici I<sup>2</sup>C.</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. Externí sériové sbìrnice SPI a I<sup>2</sup>C</a><br />
<a href="#k02">2. Vlastnosti sbìrnice SPI</a><br />
<a href="#k03">3. Pøednosti a zápory sbìrnice SPI</a><br />
<a href="#k04">4. Princip komunikace po sbìrnici SPI</a><br />
<a href="#k05">5. Komunikace s&nbsp;více uzly</a><br />
<a href="#k06">6. Zøetìzení uzlù na sbìrnici SPI</a><br />
<a href="#k07">7. Vlastnosti sbìrnice I<sup>2</sup>C</a><br />
<a href="#k08">8. Odkazy na Internetu</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. Externí sériové sbìrnice SPI a I<sup>2</sup>C</h1>

<p>Externí sériové sbìrnice oznaèované zkratkami <i>SPI</i> (Serial Peripheral
Interface) a <i>I<sup>2</sup>C</i> (Inter-Integrated Circuit)
v&nbsp;souèasnosti pøedstavují nedílnou souèást mnoha digitálních zaøízení,
vèetnì osobních poèítaèù. Velká obliba tìchto sbìrnic spoèívá ve snadnosti
jejich implementace, a to jak po stránce hardwarové (pou¾ité integrované
obvody), tak i programové. V&nbsp;tom nejjednodu¹¹ím pøípadì mù¾e pøijímací
stranu sbìrnice <i>SPI</i> pøedstavovat bì¾ný posuvný registr,
tj.&nbsp;souèástka dostupná i v&nbsp;pùvodní øadì èíslicových obvodù 7400. Obì
dále popsané sbìrnice umo¾òují komunikaci mezi dvìma èi vìt¹ím poètem
pøipojených zaøízení (uzlù), co¾ je podstatný rozdíl napøíklad oproti ji¾
popsanému sériovému portu typu <i>RS-232C</i>, s&nbsp;jeho¾ pomocí mohly
komunikovat pouze dva uzly. I pøenosová rychlost je pro mnoho úèelù více ne¾
dostaèující &ndash; <i>SPI</i> i <i>I<sup>2</sup>C</i> jsou vybaveny hodinovým
signálem, pøièem¾ jeho frekvence mù¾e v&nbsp;pøípadì <i>SPI</i> dosahovat a¾ 70
MHz (bì¾nì 10 MHz) a v&nbsp;pøípadì <i>I<sup>2</sup>C</i> v&nbsp;nejrychlej¹ím
módu 3,4 MHz. Právì pøítomnost hodinového signálu rozvedeného do v¹ech
komunikujících uzlù odli¹uje <i>SPI</i> a <i>I<sup>2</sup>C</i> od v¹ech døíve
popisovaných externích sbìrnic.</p>

<image id="7876" />
<p-center><i>Obrázek 1: Pøevadìè mezi universální sériovou sbìrnicí (USB) a
sbìrnicí SPI. Pomocí tohoto èi podobného pøípravku je mo¾né i z&nbsp;bì¾ného
osobního poèítaèe ovládat mnoho existujících typù zaøízení urèených pro
sbìrnici SPI.</i></p-center>

<p>Z&nbsp;hlediska pøenosu dat je pro prakticky v¹echny døíve popsané externí
porty a sbìrnice typické, ¾e nemají vyvedený samostatný hodinový signál, který
by slou¾il k&nbsp;synchronizaci vysílaných a ètených bitù. Z&nbsp;tohoto dùvodu
se v¹echna data i øídicí pøíkazy po datových vodièích musí posílat asynchronnì,
vìt¹inou stejným zpùsobem, jako u døíve popsaného rozhraní <i>RS-232C</i>
(nìkdy se mezi start a stop bit vkládá i del¹í sekvence bitù, ov¹em to klade
mnohem vy¹¹í nároky na pøesnost krystalù ve vysílaèi i pøijímaèi). Dal¹í
spoleènou vlastností v¹ech døíve popisovaných externích portù a sbìrnic je, ¾e
pro jednosmìrný pøenos dat èi half duplex se pou¾ívá minimum vodièù &ndash;
jeden èi dva signálové vodièe (<i>two-wire</i>) s&nbsp;mo¾ností pøidání dal¹ího
vodièe pøedstavujícího signálovou nulu. Ve¹keré øízení pøenosu dat je tedy
provádìno ryze programovì, vìt¹inou na základì softwarového
<i>handshakingu</i>. Výjimkou je sériový port <i>RS-232C</i>, u kterého je
mo¾né (a mnohá zaøízení to dokonce pøímo vy¾adují) zapojit i dal¹í vodièe, po
nich¾ se pøená¹í øídicí informace. Také u paralelního rozhraní
<i>Centronics</i> je øízení provádìno na základì <i>handshakingu</i>, pøièem¾
pro ka¾dý potvrzovací signál je vyèlenìn zvlá¹tní vodiè.</p>

<image id="7877" original="no" />
<p-center><i>Obrázek 2: Schéma zapojení pøevadìèe, který byl zobrazen na prvním
obrázku.</i></p-center>



<p><a name="k02"></a></p>
<h1>2. Vlastnosti sbìrnice SPI</h1>

<p>Sbìrnice <i>SPI</i> (<i>Serial Peripheral Interface</i>) pøedstavuje jednu
z&nbsp;forem sériových externích sbìrnic slou¾ících pro vzájemné propojení dvou
èi více komunikujících uzlù, pøièem¾ jeden uzel obvykle vystupuje v&nbsp;roli
takzvaného øadièe sbìrnice (<i>master</i>), ostatní uzly pracují v&nbsp;re¾imu
<i>slave</i>. Uzel, který pracuje jako <i>master</i>, obsahuje generátor
hodinového signálu, který je rozveden do v¹ech ostatních uzlù, èím¾ je umo¾nìn
zcela synchronní (navíc je¹tì obousmìrný) pøenos dat. Hodinový signál je
rozvádìn vodièem oznaèovaným symbolem <i>SCK</i>. Kromì vodièe s&nbsp;hodinovým
signálem jsou uzly propojeny dvojicí vodièù oznaèovaných vìt¹inou symboly
<i>MISO</i> (Master In, Slave Out) a <i>MOSI</i> (Master Out, Slave In), pomocí
nich¾ se obousmìrnì (full duplex) pøená¹í data. Posledním signálem, který se u
této sbìrnice pou¾ívá, je signál <i>SSEL</i> (Slave Select), jen¾ slou¾í
&ndash; jak ji¾ jeho název napovídá &ndash; k&nbsp;výbìru nìkterého uzlu
pracujícího v&nbsp;re¾imu <i>slave</i>. V&nbsp;následujících kapitolách si
uká¾eme, jak a kdy se tento signál pou¾ívá. V¹echny ètyøi signály &ndash;
<i>SCK</i>, <i>MISO</i>, <i>MOSI</i> i <i>SSEL</i>, pro svoji funkci vy¾adují
pouze jednosmìrné porty, co¾ pøispívá k&nbsp;jednoduché a pøedev¹ím levné
implementaci této sbìrnice.</p>

<image id="7878" original="no" />
<p-center><i>Obrázek 3: Textový LCD ovládaný pøes sbìrnici SPI. Textové LCD
tohoto typu obsahují RAM pamì», ve které je uchováván zobrazený text a nìkterou
z&nbsp;forem pamìtí ROM (EPROM, EEROM, Flash) pro ulo¾ení znakové sady,
tj.&nbsp;bitových map jednotlivých zobrazitelných znakù. Komunikaèní rozhraní
bývá rùzné &ndash; mù¾e se jednat o nìkterou z&nbsp;forem paralelního portu,
sériového portu (UART) nebo právì sbìrnici SPI.</i></p-center>

<p>Sbìrnice <i>SPI</i> se kvùli své implementaèní jednoduchosti pou¾ívá
v&nbsp;mnoha rùzných systémech, napøíklad pro komunikaci s&nbsp;nìkterými typy
pamìtí <i>EEPROM</i> (oznaèovanými také jako &bdquo;sériové&ldquo; pamìti),
textovými i grafickými LCD panely, A/D a D/A pøevodníky, hodinami reálného èasu
(<i>RTC</i>) atd. Podpora pro <i>SPI</i> je zabudována také do mnoha
mikroøadièù, zejména se to týká známé a populární øady mikroøadièù <i>Motorola
68HC11</i>, <i>AVR</i> a <i>PIC16xxx</i> (napøíklad se jedná o <i>PIC16F873</i>
a jeho varianty). Pro jednosmìrnou komunikaci, pøi které se do uzlu pouze
vysílají èi naopak ètou data, v¹ak lze pou¾ít i pouhopouhý posuvný registr èi
sériovì zapojenou sadu nìkolika posuvných registrù, co¾ je velmi jednoduchá a
také levná metoda, jak pomocí mikroøadièe ovládat okolní zaøízení (pøed mnoha
lety jsme pomocí ji¾ zmínìného mikroøadièe <i>Motorola 68HC11</i>, dvou
osmibitových posuvných sérioparalelních registrù a ètyø sedmisegmentových LED
èíslic vytvoøili pomìrnì pøesný digitální otáèkomìr pro ©kodu 105 a 120, na
vstupu <i>SPI</i> byly naopak zapojeny pøepínaèe, které funkci otáèkomìru
øídily).</p>

<image id="7879" original="no" />
<p-center><i>Obrázek 4: Ovládací obvody sbìrnice SPI jsou zabudovány do mnoha
mikroøadièù (viz èervenì zvýraznìný blok). Zde se jedná o mikroøadiè, který
kromì SPI mj.&nbsp;obsahuje i klasický USART, tj.&nbsp;synchronní a asynchronní
sériový port.</i></p-center>



<p><a name="k03"></a></p>
<h1>3. Pøednosti a zápory sbìrnice SPI</h1>

<p>Mezi nejvìt¹í pøednost sbìrnice <i>SPI</i> patøí její znaèná jednoduchost a
tím i snadnost implementace. Jednoduché je jak elektrické rozhraní sbìrnice
(jednosmìrné piny kompatibilní s&nbsp;technologií TTL, èemu¾ dnes odpovídají i
integrované obvody vyu¾ívající technologii CMOS), tak i pøenosový protokol. Ve
své podstatì toti¾ není <i>SPI</i> nic jiného ne¾ nìkolik externì propojených
posuvných registrù, pøièem¾ posun je øízen jednotným hodinovým signálem.
Jednoduchost pøenosového protokolu vyplývá i z&nbsp;toho, ¾e data jsou
pøená¹ena obousmìrnì po samostatných vodièích, tak¾e není nutné øe¹it pøepínání
mezi vysíláním a pøíjmem, jako tomu bylo u nìkterých sbìrnic pou¾ívajících
poloduplexní pøenos dat, i u dále popsané sbìrnice <i>I<sup>2</sup>C</i>. I
pøenosová rychlost je pro mnoho úèelù dostateènì vysoká. Hodinová frekvence,
z&nbsp;ní¾ se odvozuje bitová rychlost (bitrate), se v&nbsp;bì¾ných pøípadech
pohybuje v&nbsp;rozsahu 1 MHz a¾ 10 MHz, pøi dodr¾ení dostateènì malé kapacity
spoje je v¹ak mo¾né pou¾ít i pomìrnì vysokou frekvenci a¾ 70 MHz, co¾ odpovídá
140&times;10<sup>6</sup> obousmìrnì pøeneseným bitùm za sekundu.</p>

<image id="7880" />
<p-center><i>Obrázek 5: Alternativní znaèení signálù u zaøízení pracujícího
v&nbsp;re¾imu master. Jedná se o signály SCK (Serial Clock), SDO (Serial Data
Output), SDI (Serial Data Input) a CS (Chip Select), které odpovídají vý¹e
popsaným signálùm SCK, MOSI, MISO a SSEL.</i></p-center>

<p>Mezi nevýhody sbìrnice <i>SPI</i> patøí pøedev¹ím existence pouze jednoho
zaøízení, které mù¾e pracovat v&nbsp;re¾imu <i>master</i>. Existuje sice
mo¾nost pou¾ít zapojení oznaèované <i>multiple master</i>, ale to ji¾ vy¾aduje
pou¾ití slo¾itìj¹ího pøenosového protokolu, tak¾e se vytrácí jednoduchost
celého øe¹ení. Pomocí <i>SPI</i> je také mo¾né pøená¹et data pouze na krat¹í
vzdálenosti, co¾ je dáno jednak nutností synchronizace hodinového signálu
s&nbsp;pøená¹enými daty (shodné zpo¾dìní), tak i neexistencí signálu typu
<i>ACK</i> (<i>acknowledge</i>), kterým by se potvrzoval pøíjem dat a dovoloval
tak øídit rychlost pøenosu dat v&nbsp;pøípadì, ¾e nìkteré zaøízení nedoká¾e
data rychle zpracovat. Dal¹í nevýhodou je fakt, ¾e u <i>SPI</i> je mo¾né pou¾ít
nìkolik zpùsobù synchronizace dat hodinovým signálem &ndash; lze pou¾ít obì
polarity hodin, synchronizovat na nábì¾nou èi sestupnou hranu atd. Proto
napøíklad mnoho mikroøadièù obsahuje konfiguraèní registry, pomocí nich¾ je
mo¾né zvolit, jakým zpùsobem se má hodinový signál generovat (master) èi naopak
interpretovat (slave). Poslední nevýhodou, která v¹ak kvùli komunikaci na men¹í
vzdálenosti není tak patrná, je nutnost pou¾ít minimálnì ètyøi vodièe pro
obousmìrnou komunikaci &ndash; <i>SCK</i>, <i>MISO</i>, <i>MOSI</i> a
<i>GND</i> (signálová zem). Alternativní zpùsob zapojení (<i>MISO</i> a
<i>MOSI</i> spojené do jednoho vodièe <i>SISO</i>) se pøíli¹ èasto
nepou¾ívá.</p>

<image id="7881" />
<p-center><i>Obrázek 6: Alternativní znaèení signálù u zaøízení pracujícího
v&nbsp;re¾imu slave. V¹imnìte si, ¾e pøi pou¾ití oznaèení SDI a SDO mù¾e dojít
ke zmatkùm, proto¾e pin SDI na zaøízení typu master je pøipojen na pin SDO u
zaøízení typu slave a naopak. Proto je vhodnìj¹í pou¾ívat spí¹e oznaèení
signálù (a jim pøíslu¹ných pinù) MOSI a MISO.</i></p-center>



<p><a name="k04"></a></p>
<h1>4. Princip komunikace po sbìrnici SPI</h1>

<p>Na sedmém obrázku je nakreslen zpùsob propojení dvou uzlù (napøíklad
mikroøadièù) pomocí sbìrnice SPI. Oba uzly obsahují v&nbsp;tom nejjednodu¹¹ím
pøípadì dva registry &ndash; datový záchytný registr <i>Serial Input Buffer
&ndash; SSPBUF</i> a posuvný registr <i>Shift Register &ndash; SSPSR</i>. Do
registru <i>SSPSR</i> je zapsán bajt (celá osmice bitù), který byl korektnì
pøijat, ale je¹tì nebyl zpracován, tj.&nbsp;mikroøadiè si jeho obsah nepøeèetl.
Tento registr tedy slou¾í jako jednoprvková fronta zabezpeèující, ¾e pøi
korektní obsluze nedojde ke ztrátì dat. Posuvný registr <i>SSPSR</i> slou¾í
souèasnì k&nbsp;vysílání i pøíjmu jednoho bitu z&nbsp;celé osmice pøená¹ených
bitù &ndash; ka¾dý posun obsahu tohoto registru doprava znamená, ¾e se vysunutý
bit po¹le na pin <i>SDO</i> (v&nbsp;pøípadì uzlu typu <i>master</i> se jedná o
vodiè <i>MOSI</i>) a naopak logická hodnota pøeètená na pinu <i>SDI</i>
(<i>MISO</i>) je zapsána do nejni¾¹ího bitu posuvného registru. Jeden
z&nbsp;uzlù pracuje v&nbsp;re¾imu <i>master</i>, druhý v&nbsp;re¾imu
<i>slave</i>. Vysílání i pøíjem jednoho bitu je tedy nedìlitelná operace, která
v¾dy probìhne ve stejný okam¾ik.</p>

<image id="7882" original="no" />
<p-center><i>Obrázek 7: Princip propojení dvou zaøízení pomocí rozhraní SPI.
Zaøízení nakreslené vlevo je nakonfigurováno do re¾imu master, zaøízení vpravo
do re¾imu slave. Hodinový signál je v¾dy generován zaøízením typu master, data
se pøená¹í obousmìrnì po dvojici vodièù SDO-SDI (MOSI) a SDI-SDO (MISO).
Pov¹imnìte si také, ¾e nejdøíve je v¾dy vyslán nejvy¹¹í bit pøená¹eného bajtu,
pøièem¾ souèasnì dochází k&nbsp;vysouvání vysílaného bitu a nasouvání bitu
pøijatého.</i></p-center>

<p>Uzel pracující v&nbsp;re¾imu <i>master</i> generuje hodinové impulsy, které
jsou posílány po vodièi <i>SCK</i>. Pomocí hodinových pulsù je provádìna
synchronizace vysílání i pøíjmu dat, tj.&nbsp;èasy, ve kterých dochází ke zmìnì
posuvných registrù <i>SSPSR</i>. U vìt¹iny zaøízení je mo¾né nakonfigurovat
polaritu hodin i to, zda se má posun provést pøi sestupné èi vzestupné hranì
hodinového signálu &ndash; dùvod byl uveden v&nbsp;pøedchozí kapitole. Ètyøi
mo¾né tvary hodinového signálu jsou zobrazeny na osmém obrázku. Konfiguraèním
bitem <i>CKP</i> je urèena polarita hodinového signálu, tj.&nbsp;pøedev¹ím jeho
klidová úroveò (<i>idle</i>), která pøedstavuje stav, kdy se neprovádí vysílání
dat. Naproti tomu konfiguraèní bit <i>CKE</i> urèuje, zda se platná data,
tj.&nbsp;doba, ve které dochází k&nbsp;posunu v&nbsp;posuvném registru,
oznamují vzestupnou èi sestupnou hranou hodinového signálu (pro <i>CKP=1</i> je
signál invertován a tím dochází i k&nbsp;otoèení smyslu hrany). Pov¹imnìte si,
¾e k&nbsp;vysílání i pøíjmu dat dochází v¾dy a¾ po ustálení obou datových
vodièù (<i>MISO</i> i <i>MOSI</i>), tj.&nbsp;uprostøed bitového intervalu.</p>

<image id="7883" original="no" />
<p-center><i>Obrázek 8: Ètyøi mo¾né zpùsoby synchronizace pøená¹ených dat
hodinovým signálem.</i></p-center>



<p><a name="k05"></a></p>
<h1>5. Komunikace s&nbsp;více uzly</h1>

<p>Na sedmém obrázku byla ukázána ta nejjednodu¹¹í konfigurace sbìrnice
<i>SPI</i>, pøi které se data pøená¹ely mezi dvojicí uzlù, pøièem¾ ka¾dý uzel
mohl data souèasnì vysílat i pøijímat. V&nbsp;praxi se v¹ak èasto stává, ¾e je
nutné propojit vìt¹í mno¾ství uzlù &ndash; mù¾e se napøíklad jednat o rùzná
vstupní zaøízení (teplotní èidla, svìtelné sondy, A/D pøevodníky) èi naopak
zaøízení výstupní (LCD a LED). Pokud je nutné data pøená¹et bez vìt¹ího
zpo¾dìní a to i v&nbsp;pøípadì, ¾e nìkteré ze zaøízení nemusí pracovat, pou¾ije
se zapojení naznaèené na devátém obrázku. V&nbsp;tomto zapojení existuje jeden
uzel pracující v&nbsp;re¾imu <i>master</i>. Ten generuje hodinový signál
pou¾itý pøi obousmìrném pøenosu dat. Kromì toho v¹ak také obsahuje piny
oznaèené <i>CSx</i> nebo <i>SSELx</i>, kterými se vybírá právì jeden
z&nbsp;uzlù typu <i>slave</i>. V&nbsp;jeden okam¾ik mù¾e být vybrán v¾dy pouze
jeden uzel typu <i>slave</i>, jinak by do¹lo ke kolizi na vodièi <i>SDI</i>
(<i>MISO</i>) ve chvíli, kdy by více uzlù typu <i>slave</i> na tento vodiè
zaèalo vysílat data. Pøedností tohoto zpùsobu zapojení je prakticky okam¾itý
výbìr uzlu, se kterým se má komunikovat, nevýhodou pak rostoucí poèet vodièù
<i>CSx</i> a tím pádem i výstupních pinù, které je nutné v&nbsp;uzlu typu
<i>master</i> &bdquo;obìtovat&ldquo;. Podobnì jako u v¹ech podobných výbìrových
signálù (<i>CS</i>, <i>OE</i>), je i zde pou¾it invertovaný vstup,
tj.&nbsp;zaøízení se vybírá logickou nulou (úroveò L) a nikoli jednièkou
(úroveò H).</p>

<image id="7884" />
<p-center><i>Obrázek 9: Zpùsob komunikace s&nbsp;více zaøízeními pomocí výbìru
uzlu signálem SSEL. Èím více existuje uzlù typu slave, tím vìt¹í mno¾ství pinù
CSx je nutné pou¾ít. Vzhledem k&nbsp;tomu, ¾e v&nbsp;danou chvíli mù¾e být
vybrána jen jedna komunikující dvojice uzlù, lze mezi uzel typu master a
ostatní uzly vlo¾it demultiplexor pracující v&nbsp;re¾imu výbìru &bdquo;jedna
z&nbsp;n&ldquo;.</i></p-center>



<p><a name="k06"></a></p>
<h1>6. Zøetìzení uzlù na sbìrnici SPI</h1>

<p>Existuje v¹ak i alternativní zpùsob zapojení uzlù na sbìrnici <i>SPI</i>,
který spoèívá ve zøetìzení v¹ech pøipojených zaøízení tak, jak je naznaèeno na
desátém obrázku. V¹imnìte si, ¾e zatímco hodinový signál je rozveden paralelnì
do v¹ech uzlù, tak datové vodièe tvoøí kruh. Vzhledem k&nbsp;tomu, ¾e ka¾dý
uzel obsahuje uvnitø posuvný registr, je tímto zapojením vlastnì vytvoøen jeden
dlouhý posuvný registr, pøièem¾ ka¾dý uzel (zaøízení) v&nbsp;danou chvíli
&bdquo;vidí&ldquo; pouze jednu osmici bitù. V&nbsp;pøípadì, ¾e by v¹echny uzly
typu <i>slave</i> nemìnily data, která pøeètou, znamenalo by to, ¾e osmice bitù
vyslaná <i>masterem</i> by se vrátila zpìt po <i>8&times;n</i> hodinových
pulsech, kde <i>n</i> je poèet zøetìzených uzlù. Pøi tomto zpùsobu zapojení je
nutné na vy¹¹í vrstvì vytvoøit vhodný komunikaèní protokol. V&nbsp;pøípadì
schématu z&nbsp;desátého obrázku by napøíklad bylo mo¾né v&nbsp;prvních dvou
bitech z&nbsp;ka¾dého bajtu zaznamenat adresu zaøízení (<i>master</i>=00, první
<i>slave</i>=01 atd.), pøièem¾ pouze tento bajt by mohlo dané zaøízení mìnit.
Podoba samotného protokolu v¹ak mù¾e být i mnohem slo¾itìj¹í, zde ji¾ zále¾í na
konkrétních po¾adavcích.</p>

<image id="7885" />
<p-center><i>Obrázek 10: Propojení zaøízení do øetìzu (daisy chain) vede ke
sní¾ení po¾adovaného poètu vodièù, ale také k&nbsp;prodlou¾ení cesty (a tím i
èasu) dat pøi jejich vysílání a pøíjmu. V&nbsp;pøípadì, ¾e jedno
z&nbsp;pøipojených zaøízení nebude funkèní, celý øetìzec se
rozpadne.</i></p-center>



<p><a name="k07"></a></p>
<h1>7. Vlastnosti sbìrnice I<sup>2</sup>C</h1>

<p>Dal¹í sbìrnicí, kterou si dnes a pøedev¹ím v&nbsp;navazující èásti tohoto
seriálu popí¹eme, je sbìrnice oznaèovaná ponìkud neobvykle symbolem
<i>I<sup>2</sup>C</i>, co¾ je zkratka z&nbsp;celého názvu <i>Inter-Integrated
Circuit</i>. V&nbsp;urèitých ohledech se jedná o sbìrnici podobnou <i>SPI</i>
(existence hodinového signálu, jediný uzel typu <i>master</i>), ov¹em nìkteré
vlastnosti tìchto sbìrnic jsou odli¹né. Zatímco u sbìrnice <i>SPI</i> byl
umo¾nìn obousmìrný pøenos dat díky pou¾ití dvojice vodièù <i>MISO</i> a
<i>MOSI</i>, je sbìrnice <i>I<sup>2</sup>C</i> vybavena &bdquo;pouze&ldquo;
jedním datovým vodièem <i>SDA</i>, z&nbsp;èeho¾ vyplývá, ¾e se data pøená¹í
poloduplexnì. Také to znamená ponìkud slo¾itìj¹í interní strukturu v¹ech
pøipojených zaøízení, proto¾e pøíslu¹né piny musí být mo¾né pøepínat ze
vstupního re¾imu na re¾im výstupní. Také zde není pou¾it výbìr zaøízení typu
<i>slave</i> pomocí zvlá¹tních signálù, proto¾e ka¾dému uzlu je pøiøazena
jednoznaèná adresa &ndash; kromì elektrických charakteristik je toti¾ pøesnì
stanoven i komunikaèní protokol, co¾ je dal¹í rozdíl oproti vý¹e popsané
sbìrnici <i>SPI</i>. Obecnì je mo¾né øíci, ¾e <i>I<sup>2</sup>C</i> je sice
ponìkud slo¾itìj¹í, ale zato flexibilnìj¹í sbìrnice, která se velmi èasto
pou¾ívá i pro komunikaci na del¹í vzdálenosti (øádovì metry, viz napøíklad
<i>DDC</i> u monitorù), ne¾ tomu je u sbìrnice <i>SPI</i>. V&nbsp;navazující
èásti seriálu si øekneme, jakým zpùsobem komunikace probíhá a jak se vlastnì
jednotlivá zaøízení adresují.</p>

<image id="7886" original="no" />
<p-center><i>Obrázek 11: Zapojení uzlù na sbìrnici I<sup>2</sup>C.</i></p-center>



<p><a name="k08"></a></p>
<h1>8. Odkazy na Internetu</h1>

<ol>

<li>SPI interface tutorial<br />
<a href="http://www.best-microcontroller-projects.com/spi-interface.html">http://www.best-microcontroller-projects.com/spi-interface.html</a></li>

<li>Serial Peripheral Interface Bus<br />
<a href="http://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus">http://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus</a></li>

<li>EUSB to SPI bus Kit<br />
<a href="http://www.eidusa.com/Electronics_Kits_EUSB_To_SPI_BUS.htm">http://www.eidusa.com/Electronics_Kits_EUSB_To_SPI_BUS.htm</a></li>

<li>SPI Block Guide V03.06, Freescale Semiconductor<br />
<a href="http://www.freescale.com/files/microcontrollers/doc/ref_manual/S12SPIV3.pdf">http://www.freescale.com/files/microcontrollers/doc/ref_manual/S12SPIV3.pdf</a></li>

<li>What is SPI?<br />
<a href="http://www.fpga4fun.com/SPI1.html">http://www.fpga4fun.com/SPI1.html</a></li>

<li>SPI - A simple implementation<br />
<a href="http://www.fpga4fun.com/SPI2.html">http://www.fpga4fun.com/SPI2.html</a></li>

<li>Bit-banging<br />
<a href="http://en.wikipedia.org/wiki/Bit-banging">http://en.wikipedia.org/wiki/Bit-banging</a></li>

<li>Joint Test Action Group<br />
<a href="http://en.wikipedia.org/wiki/JTAG">http://en.wikipedia.org/wiki/JTAG</a></li>

<li>I<sup>2</sup>C<br />
<a href="http://en.wikipedia.org/wiki/I2C">http://en.wikipedia.org/wiki/I2C</a></li>

<li>Display Data Channel<br />
<a href="http://en.wikipedia.org/wiki/Display_Data_Channel">http://en.wikipedia.org/wiki/Display_Data_Channel</a></li>

<li>I<sup>2</sup> Background<br />
<a href="http://www.microport.tw/blognew.php?blog_no=7#theory">http://www.microport.tw/blognew.php?blog_no=7#theory</a></li>

<li>PIC16F87X, 28/40-pin 8-Bit CMOS FLASH Microcontrollers<br />
Microchip Technology Inc.<br />
<a href="http://www.microchip.com">http://www.microchip.com</a></li>

</ol>

<image id="7887" original="no" />
<p-center><i>Obrázek 12: Interní struktura rozhraní SPI u&nbsp;populárních mikroøadièù PIC16F87x. Nejdùle¾itìj¹ími bloky je záchytný registr SSPBUF a posuvný registr SSPSR.</i></p-center>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2008</small></p>
</body>
</html>

