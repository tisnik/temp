<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>SIMD instrukce vyu¾ívané v moderních mikroprocesorech øady x86 (2.èást: SSE)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>SIMD instrukce vyu¾ívané v moderních mikroprocesorech øady x86 (2.èást: SSE)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V&nbsp;dne¹ní èásti seriálu o architekturách poèítaèù se budeme zabývat dal¹ím roz¹íøením instrukèní sady procesorù patøících do rodiny x86. Zamìøíme se na instrukce SSE (Streaming SIMD Extensions), které byly poprvé pou¾ity v&nbsp;mikroprocesorech Intel Pentium III a pozdìji se roz¹íøily jak na dal¹í èipy vyrábìné firmou Intel, tak i na procesory konkurenèní spoleènosti AMD.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. SIMD instrukce vyu¾ívané v&nbsp;moderních mikroprocesorech øady x86 (2.èást: SSE)</a></p>
<p><a href="#k02">2. Od MMX pøes 3DNow! k&nbsp;instrukèním sadám SSE, SSE2 a SSE4</a></p>
<p><a href="#k03">3. Poèty nových instrukcí zavádìných v&nbsp;rámci jednotlivých roz¹íøení instrukèní sady</a></p>
<p><a href="#k04">4. Registry pou¾ívané technologií SSE</a></p>
<p><a href="#k05">5. Sada registrù pou¾itelná vývojáøi pracujícími s&nbsp;procesory podporujícími SSE</a></p>
<p><a href="#k06">6. Nové instrukce SSE</a></p>
<p><a href="#k07">7. Aritmetické instrukce pracující se skalárními hodnotami i s&nbsp;vektory</a></p>
<p><a href="#k08">8. Øízení re¾imu výpoètù s&nbsp;hodnotami reprezentovanými v&nbsp;systému plovoucí øádové èárky</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. SIMD instrukce vyu¾ívané v&nbsp;moderních mikroprocesorech øady x86 (2.èást: SSE)</h2>

<p>V&nbsp;pøedchozí èásti seriálu o architekturách poèítaèù jsme si øekli
základní informace o roz¹íøení instrukèní sady procesorù <i>x86</i> nazvané
<i>MMX</i>, neboli <i>MultiMedia eXtension</i>, popø.&nbsp;té¾ <i>Matrix Math
eXtension</i>. Díky <i>MMX</i> se vlastnì poprvé pùvodnì skalární
(v&nbsp;pøípadì èipù Pentium ve skuteènosti superskalární) procesorová
architektura <i>x86</i> roz¹íøila o instrukce typu <i>SIMD (Single Instruction,
Multiple Data)</i>, tj.&nbsp;o instrukce pracujícími s&nbsp;vektory pevné délky
a nikoli pouze se skalárními hodnotami. V&nbsp;pøípadì instrukèní sady
<i>MMX</i> bylo mo¾né pracovat s&nbsp;celoèíselnými daty ulo¾enými
v&nbsp;registrech o ¹íøce 64 bitù, popø.&nbsp;v&nbsp;operaèní pamìti. Jednalo
se buï o vektory obsahující osmici bajtù, ètveøici ¹estnáctibitových slov,
dvojici slov 32bitových èi o jedinou 64bitovou skalární hodnotu. Pomìrnì rychle
se ukázalo, ¾e technologie <i>SIMD</i> instrukcí je na platformì <i>x86</i>
nejenom velmi dobøe pou¾itelná, ale i to, ¾e se díky jejímu zaøazení do
pùvodního repertoáru skalárních instrukcí mù¾e podaøit zvý¹it výpoèetní
rychlost nìkterých algoritmù; samozøejmì za pøedpokladu, ¾e jsou tyto algoritmy
optimalizovány pro pou¾ití <i>MMX</i> instrukcí (zde jsme naopak mohli vidìt
absenci dobré podpory <i>MMX</i> jak v&nbsp;pøekladaèích, tak i
knihovnách).</p>

<img src="http://i.iinfo.cz/images/161/pc159-3.png" width="312" height="156" alt="&#160;" />
<p><i>Obrázek 1: Ukázka chování MMX instrukce <strong>PADDW</strong>, která
provádí souèet ètveøice ¹estnáctibitových hodnot s&nbsp;pøeteèením, co¾ je
patrné z&nbsp;posledního sloupce.<br />
(Zdroj: Intel MMX<sup>TM</sup> Technology Overview, Intel corporation, 1996)</i></p>

<p>Technologie <i>MMX</i> byla pøedstavena firmou <i>Intel</i> v&nbsp;roce 1996
a o rok pozdìji se ji¾ instrukèní sada <i>MMX</i> zaèala pou¾ívat
v&nbsp;reálných mikroprocesorech. To pro konkurenèní spoleènost <i>AMD</i>
samozøejmì pøedstavovalo nemalou výzvu, tak¾e ji¾ o dva roky pozdìji byla
k&nbsp;dispozici technologie <i>3DNow!</i> obsahující kromì podpory <i>MMX</i>
takté¾ nové <i>SIMD</i> instrukce. V&nbsp;tomto pøípadì se v¹ak jednalo o
instrukce umo¾òující manipulaci s&nbsp;dvouprvkovými vektory obsahujícími
numerické hodnoty s&nbsp;plovoucí øádovou èárkou odpovídající formátu
<i>single/float</i> známé normy <i>IEEE 754</i> (i kdy¾ je pravda, ¾e nìkteré
re¾imy práce pøedepisované touto normou nebyly v&nbsp;<i>3DNow!</i> pou¾ity,
k&nbsp;èemu¾ se je¹tì v&nbsp;tomto èlánku vrátíme). Podobnì jako v&nbsp;pøípadì
<i>MMX</i>, i u technologie <i>3DNow!</i> se ukázalo, ¾e se jedná o jeden
z&nbsp;dobøe pou¾itelných zpùsobù zvý¹ení reálného výpoèetního výkonu
mikroprocesorù øady <i>x86</i>, ani¾ by bylo nutné pøecházet na vy¹¹í hodinové
frekvence èi zvìt¹ovat kapacity vyrovnávacích pamìtí (<i>Level 1 Cache</i>,
<i>Level 2 Cache</i>).</p>

<img src="http://i.iinfo.cz/images/161/pc159-4.png" width="312" height="156" alt="&#160;" />
<p><i>Obrázek 2: MMX instrukce <strong>PADDUSW</strong>, která sice také
provádí souèet ètveøice ¹estnáctibitových hodnot, ov¹em souèet je proveden se
saturací &ndash; v&nbsp;pøípadì, ¾e se výsledek souètu ji¾ nemù¾e reprezentovat
¹estnáctibitovou hodnotou, ulo¾í se namísto výsledku hodnota 0xFFFF,
tj.&nbsp;nejvy¹¹í ¹estnáctibitové celé èíslo bez znaménka.<br />
(Zdroj: Intel MMX<sup>TM</sup> Technology Overview, Intel corporation, 1996)</i></p>



<p><a name="k02"></a></p>
<h2>2. Od MMX pøes 3DNow! k&nbsp;instrukèním sadám SSE, SSE2 a SSE4</h2>

<p>Po úspì¹ném a relativnì bezproblémovém zavedení roz¹íøení <i>MMX</i> i
<i>3DNow!</i> do praxe není divu, ¾e obì nejvýznamnìj¹í spoleènosti podnikající
v&nbsp;oblasti návrhu a prodeje mikroprocesorù patøících do rodiny <i>x86</i>,
tj.&nbsp;firmy <i>Intel</i> a <i>AMD</i>, zaèaly pro tyto typy mikroprocesorù
navrhovat i dal¹í roz¹iøující instrukèní sady s&nbsp;&bdquo;vektorovými&ldquo;
instrukcemi typu <i>SIMD</i>. V&nbsp;následující tabulce jsou tyto roz¹iøující
instrukèní sady vypsány, vèetnì roku vzniku dané technologie i informace o tom,
v&nbsp;jakém mikroprocesoru byla ta která technologie zpoèátku vyu¾ita. Nìkteré
z&nbsp;ní¾e zmínìných technologií byly pou¾ity v&nbsp;mikroprocesorech
vyrábìných jednou spoleèností (co¾ je pøedev¹ím pøípad <i>3DNow!</i>), ov¹em
v&nbsp;souèasnosti mù¾eme vidìt oboustranné snahy o zavádìní roz¹íøení
instrukèní sady <i>x86</i> podle jednotného schématu a navíc tak, aby ho bylo
mo¾né pou¾ívat na mikroprocesorech vyrábìných obìma zmínìnými spoleènostmi. To
je pomìrnì velký rozdíl oproti ad-hoc øe¹ením, s&nbsp;nimi¾ jsme se setkali
v&nbsp;pøípadì <i>MMX</i> i <i>3DNow!</i> (kde navíc byli výrobci èipù svázaní
snahou o zachování zpìtné kompatibility s&nbsp;existujícími operaèními
systémy):</p>

<table>
<tr><th>Název technologie</th><th>Spoleènost</th><th>Rok uvedení</th><th>Poprvé pou¾ito v&nbsp;èipu</th></tr>
<tr><td>MMX   </td><td>Intel    </td><td>1996 </td><td>Intel Pentium P5</td></tr>
<tr><td>3DNow!</td><td>AMD      </td><td>1998 </td><td>AMD K6-2</td></tr>
<tr><td>SSE   </td><td>Intel    </td><td>1999 </td><td>Intel Pentium III (mikroarchitektura P6)</td></tr>
<tr><td>SSE2  </td><td>Intel    </td><td>2001 </td><td>Intel Pentium 4 (mikroarchitektura NetBurst)</td></tr>
<tr><td>SSE3  </td><td>Intel    </td><td>2004 </td><td>Intel Pentium 4 (Prescott)</td></tr>
<tr><td>SSSE3 </td><td>Intel    </td><td>2006 </td><td>mikroarchitektura Intel Core</td></tr>
<tr><td>SSE4  </td><td>Intel+AMD</td><td>2006 </td><td>AMD K10 (SSE4a) , mikroarchitektura Intel Core</td></tr>
<tr><td>XOP   </td><td>AMD      </td><td>2011?</td><td>zalo¾eno na SSE5</td></tr>
<tr><td>CVT16 </td><td>AMD      </td><td>2011?</td><td>zalo¾eno na SSE5</td></tr>
<tr><td>AVX   </td><td>Intel+AMD</td><td>2013?</td><td>roz¹íøení SSE registrù na 256 bitù, celkem 32 registrù</td></tr>
</table>

<img src="http://i.iinfo.cz/images/503/pc160-1.jpg" width="400" height="365" alt="&#160;" />
<p><i>Obrázek 3: Intel Xeon 5600 je zástupcem mikroprocesorù urèených pro
oblast serverù. Samozøejmì takté¾ podporuje SIMD operace: MMX, SSE, SSE2, SSE3,
SSSE3, SSE4.1, SSE4.2</i></p>



<p><a name="k03"></a></p>
<h2>3. Poèty nových instrukcí zavádìných v&nbsp;rámci jednotlivých roz¹íøení instrukèní sady</h2>

<p>Pro nìkoho mù¾e být takté¾ zajímavá i informace o tom, jak velké zmìny
v&nbsp;instrukèní sadì mikroprocesorù byly vlastnì pøi pøidávání nových
&bdquo;vektorových&ldquo; roz¹iøujících instrukèních sad typu <i>SIMD</i>
provedeny. To nám uká¾e dal¹í tabulka. Je pouze nutné dát pozor na to, ¾e poèty
nových instrukcí zavedených v&nbsp;rámci tìchto nových technologií, které jsou
vypsány v&nbsp;tabulce pod odstavcem, nemusí pøesnì souhlasit s&nbsp;poèty
uvádìnými v&nbsp;jiných informaèních materiálech. Je tomu tak pøedev¹ím
z&nbsp;toho dùvodu, ¾e se v&nbsp;nìkterých pøípadech rozli¹uje i datový typ,
s&nbsp;ním¾ instrukce pracují (napøíklad se mù¾e jednat o souèet vektoru
s&nbsp;32 bitovými hodnotami nebo 64bitovými hodnotami reprezentovanými
v&nbsp;obou pøípadech ve formátu s&nbsp;plovoucí øádovou èárkou) a nìkdy se
taková instrukce do celkové sumy zapoèítává pouze jedenkrát. Nicménì údaje
vypsané v&nbsp;ní¾e uvedené tabulce by mìly být konzistentní, proto¾e se jedná
o poèty novì pøidaných operaèních kódù instrukcí (napøíklad u dále popsané
instrukèní sady <i>SSE2</i> konèí instrukce znakem <strong>D</strong>,
<strong>S</strong>, <strong>I</strong> èi <strong>Q</strong> podle typu
zpracovávaných dat/operandù):</p>

<table>
<tr><th>Název technologie</th><th>Poèet nových instrukcí</th></tr>
<tr><td>MMX   </td><td> 56</td></tr>
<tr><td>3DNow!</td><td> 21</td></tr>
<tr><td>SSE   </td><td> 70</td></tr>
<tr><td>SSE2  </td><td>144</td></tr>
<tr><td>SSE3  </td><td> 13</td></tr>
<tr><td>SSSE3 </td><td> 32 (ve skuteènosti vlastnì jen 16 instrukcí, ov¹em pro dva datové typy)</td></tr>
<tr><td>SSE4  </td><td> 54 (z&nbsp;toho 47 v&nbsp;rámci SSE4.1, zbytek v&nbsp;rámci SSE4.2)</td></tr>
</table>

<img src="http://i.iinfo.cz/images/503/pc160-2.jpg" width="450" height="260" alt="&#160;" />
<p><i>Obrázek 4: Konkurenèní mikroprocesor spoleènosti AMD, který takté¾
podporuje rùzné SIMD instrukce, konkrétnì MMX, SSE, SSE2, SSE3 i
3DNow!.</i></p>



<p><a name="k04"></a></p>
<h2>4. Registry pou¾ívané technologií SSE</h2>

<p>Technologie <i>MMX</i> a <i>3DNow!</i> jsme si ji¾ popsali v&nbsp;pøedchozí
èásti tohoto seriálu, pojïme se tedy podívat na dal¹í roz¹íøení instrukèní sady
mikroprocesorù rodiny <i>x86</i>, které je dokonce v&nbsp;nìkolika ohledech
mnohem dùle¾itìj¹í a pro mnoho programátorù takté¾ zajímavìj¹í. Jedná se o
technologii oznaèovanou <i>SSE</i>, co¾ je zkratka znamenající <i>Streaming
SIMD Extension</i>. Na <i>SSE</i> se mù¾eme dívat buï jako na zcela nové
roz¹íøení instrukèní sady o <i>SIMD</i> instrukce, nebo jako na urèité
propojení pøedností obou pøedchozích technologií, tj.&nbsp;jak <i>MMX</i>
(relativnì velký poèet prvkù ulo¾ených ve vektorech, ov¹em podpora pouze pro
celoèíselné operace nad prvky vektorù), tak i <i>3DNow!</i> (práce
s&nbsp;reálnými èísly, ov¹em ulo¾enými pouze v&nbsp;dvouprvkových vektorech,
z&nbsp;èeho¾ vyplývají men¹í mo¾nosti paralelizace výpoètù). V&nbsp;pøípadì
<i>SSE</i> je navíc umo¾nìna soubì¾ná práce jednotky <i>MMX</i> èi <i>FPU</i>.
Ve specifikaci <i>SSE</i> jsou popsány jak významy v¹ech nových instrukcí, tak
i rùzné re¾imy vyu¾ívané pøi aritmetických operacích. Specifikace takté¾ øíká,
jaké registry se u nových instrukcí pou¾ívají.</p>

<p>Nejprve se zamìøme na registry vyu¾ívané v&nbsp;technologii <i>SSE</i>. U
mikroprocesorù implementujících instrukèní sadu <i>SSE</i> je vyu¾ita nová sada
registrù pojmenovaných <strong>XMM0</strong> a¾ <strong>XMM7</strong>. Na
64bitové platformì (architektura AMD 64) navíc do¹lo k&nbsp;pøidání dal¹ích
osmi registrù se jmény <strong>XMM8</strong> a¾ <strong>XMM15</strong>
vyu¾itelných pouze v&nbsp;64bitovém re¾imu. V¹echny nové registry mají ¹íøku
128 bitù, tj.&nbsp;jsou dvakrát ¹ir¹í, ne¾ registry pou¾ívané v&nbsp;<i>MMX</i>
i <i>3DNow!</i> a ètyøikrát ¹ir¹í, ne¾ bì¾né pracovní registry na platformì
<i>x86</i> (bavíme se o 32bitovém re¾imu). Do ka¾dého registru je mo¾né ulo¾it
ètveøici reálných numerických hodnot reprezentovaných v&nbsp;systému plovoucí
øádové teèky podle normy <i>IEEE 754</i>, pøièem¾ tato norma je dodr¾ována
pøesnìji, ne¾ v&nbsp;pøípadì <i>3DNow!</i> (rùzné zaokrouhlovací re¾imy èi
práce s&nbsp;denormalizovanými èísly sice mohou vypadat tro¹ku jako èerná
magie, ov¹em napøíklad v&nbsp;knihovnách pro numerické výpoèty, které musí v¾dy
za specifikovaných okolností dát stejný výsledek, se jedná o velmi dùle¾itou
vlastnost). K&nbsp;osmi èi ¹estnácti novým registrùm <strong>XMM*</strong> byl
je¹tì pøidán jeden 32bitový registr nazvaný <strong>MXCSR</strong>, jen¾ byl
urèený pro nastavení (øízení) re¾imù výpoètu.</p>

<img src="http://i.iinfo.cz/images/503/pc160-3.jpg" width="220" height="194" alt="&#160;" />
<p><i>Obrázek 5: Sada nových pracovních registrù pøidaných v&nbsp;rámci
roz¹íøení instrukèní sady SSE.</i></p>



<p><a name="k05"></a></p>
<h2>5. Sada registrù pou¾itelná vývojáøi pracujícími s&nbsp;procesory podporujícími SSE</h2>

<p>Díky zavedení roz¹íøení instrukèní sady <i>SSE</i> do praxe zaèali mít
programátoøi vytváøející aplikace na 32bitové platformì <i>x86</i>, její¾
zaèátek se datuje od dnes ji¾ spí¹e historického mikroprocesoru <i>Intel
80386</i>, k&nbsp;dispozici nejenom 64bitové registry (jednotka <i>MMX</i>),
ale i registry 128bitové, co¾ je zajisté u¾iteèné. Pøitom i pøes zavedení
roz¹íøených instrukèních sad <i>MMX/3DNow!/SSE</i> stále zùstávala zachována
binární zpìtná i dopøedná kompatibilita s&nbsp;pøedchozími typy mikroprocesorù
(nejedná se tedy o takovou zmìnu, jako v&nbsp;pøípadì pøechodu 16-&gt;32-&gt;64
bitù). Zde je my¹lena pøedev¹ím mo¾nost bìhu star¹ích aplikací na novìj¹ích
mikroprocesorech, proto¾e program pøelo¾ený s&nbsp;podporou <i>SSE</i> nebude
na procesoru bez této technologie pracovat korektnì, i kdy¾ by pravdìpodobnì
bylo mo¾né <i>SSE</i> emulovat pomocí podprogramù spou¹tìných pøi zavolání
neplatného operaèního kódu (tj.&nbsp;operaèního kódu SSE instrukce, která je
samozøejmì pro ne-SSE procesor neznámým kódem).</p>

<p>Pro zajímavost se podívejme, jak se spoleènì se zavedením instrukèní sady
<i>SSE</i> prakticky zdvojnásobila celková kapacita v¹ech vyu¾itelných registrù
na 32bitové platformì <i>x86</i> (na 64bitové <i>x86_64</i> je situace
odli¹ná). V&nbsp;následující tabulce jsou kromì univerzálních pracovních
registrù, indexových registrù a bázových registrù vypsány i registry se
speciálním významem:</p>

<table>
<tr><th> #</th><th>Typ registrù</th><th>Poèet registrù</th><th>Bitová ¹íøka registru</th><th>Pøíklady</th></tr>
<tr><td> 1</td><td>Univerzální registry </td><td>4</td><td> 32 bitù</td><td>EAX, EBX, ECX, EDX</td></tr>
<tr><td> 2</td><td>Indexové registry    </td><td>3</td><td> 32 bitù</td><td>ESI, EDI, EIP</td></tr>
<tr><td> 3</td><td>Bázové registry      </td><td>2</td><td> 32 bitù</td><td>EBP, ESP</td></tr>
<tr><td> 4</td><td>Segmentové registry  </td><td>6</td><td> 16 bitù</td><td>CS, DS, ES, FS, GS, SS</td></tr>
<tr><td> 5</td><td>Pøíznakový registr   </td><td>1</td><td> 32 bitù</td><td>EFLAGS (pùvodnì 16bitový FLAGS)</td></tr>
<tr><td> 6</td><td>Registry pro ladìní  </td><td>8</td><td> 32 bitù</td><td>DR0..DR7</td></tr>
<tr><td> 7</td><td>Øídicí registry      </td><td>4</td><td> 32 bitù</td><td>CR0, CR2, CR3, CR4</td></tr>
<tr><td> 8</td><td>Dal¹í spec. registry </td><td>12?</td><td> 32 bitù</td><td>TR1...TR12</td></tr>
<tr><td> 9</td><td>Registry MMX/3DNow!  </td><td>8</td><td> 64 bitù</td><td>shodné s&nbsp;FPU registry st(x), resp.&nbsp;se spodními 64 bity st(x)</td></tr>
<tr><td>10</td><td>Pracovní registry SSE</td><td>8</td><td>128 bitù</td><td>XMM0 .. XMM7</td></tr>
<tr><td>11</td><td>Øídicí registr SSE   </td><td>1</td><td> 32 bitù</td><td>MXCSR</td></tr>
</table>

<img src="http://i.iinfo.cz/images/503/pc160-4.jpg" width="353" height="143" alt="&#160;" />
<p><i>Obrázek 6: Zjednodu¹ený programátorský model architektury x86
v&nbsp;32bitovém re¾imu.</i></p>



<p><a name="k06"></a></p>
<h2>6. Nové instrukce SSE</h2>

<p>V&nbsp;rámci technologie <i>SSE</i> byla instrukèní sada roz¹íøena o nìkolik
typù instrukcí, které vìt¹inou pracovaly s&nbsp;ji¾ vý¹e zmínìnými registry
<strong>XMM*</strong>, popø.&nbsp;takté¾ s&nbsp;operaèní pamìtí nebo
s&nbsp;obecnými celoèíselnými 32bitovými registry procesorù <i>x86</i>,
tj.&nbsp;napøíklad s&nbsp;registrem <strong>EAX</strong>. V¹echny instrukce je
mo¾né rozdìlit do nìkolika kategorií:</p>

<table>
<tr><th> #</th><th>Kategorie</th><th>Pøíklad instrukce</th></tr>
<tr><td> 1</td><td>Pøenosy dat</td><td>MOVUPS, MOVAPS, MOVHPS, MOVLPS...</td></tr>
<tr><td> 2</td><td>Aritmetické operace</td><td>ADDPS, SUBPS, MULPS, DIVPS, RCPPS...</td></tr>
<tr><td> 3</td><td>Porovnání</td><td>CMPEQSS, CMPEQPS, CMPLTSS, CMPNLTSS, ...</td></tr>
<tr><td> 4</td><td>Logické operace</td><td>ANDPS, ANDNPS, ORPS, XORPS</td></tr>
<tr><td> 5</td><td>Pøenosy mezi prvky vektorù (shuffle) a konverze</td><td>SHUFPS, UNPCKHPS, UNPCKLPS</td></tr>
<tr><td> 6</td><td>Naètení dat do cache</td><td>PREFETCH0, ...</td></tr>
</table>

<img src="http://i.iinfo.cz/images/503/pc160-5.png" width="450" height="311" alt="&#160;" />
<p><i>Obrázek 7: Nìkteré instrukce zavedené v&nbsp;rámci SSE pracují pouze
s&nbsp;dvojicí skalárních hodnot.</i></p>

<p>Zajímavá je podpora jak skalárních operací, tak i operací vektorových
v&nbsp;instrukèní sadì <i>SSE</i>. Pøíkladem mù¾e být napøíklad skalární
instrukce souètu <strong>ADDSS</strong> (SS=single scalar), která mù¾e mít
dvojí podobu:</p>

<pre>
ADDSS xmm1, xmm2     ; instrukce pracující s dvojicí registrù SSE
ADDSS xmm1, mem32    ; instrukce pracující s registrem SSE a pamì»ovým místem (32 bitù)
</pre>

<p>Naproti tomu &bdquo;vektorová&ldquo; podoba instrukce souètu
<strong>ADDPS</strong> (PS=parallel scalar) pracuje s&nbsp;ètyøprvkovými
vektory a zajímavé je, ¾e operaèní kód této instrukce je o jeden prefixový bajt
krat¹í, ne¾ je tomu u døíve zmínìné instrukce <strong>ADDSS</strong> (to dává
smysl, proto¾e èastìji pou¾ívané vektorové instrukce zaberou v&nbsp;operaèní
pamìti men¹í objem):</p>

<pre>
ADDPS xmm1, xmm2     ; instrukce pracující s dvojicí registrù SSE
ADDPS xmm1, mem128   ; instrukce pracující s registrem SSE a pamì»ovým místem (128 bitù)
</pre>

<p>Takté¾ stojí za zdùraznìní fakt, ¾e se v&nbsp;instrukèní sadì <i>SSE</i>
nenachází ¾ádné instrukce, v&nbsp;jejich¾ operaèním kódu by se nacházela
konstanta. Ta musí být v¾dy ulo¾ena v&nbsp;operaèní pamìti nebo pøenesena
z&nbsp;obecných registrù.</p>

<img src="http://i.iinfo.cz/images/503/pc160-6.png" width="450" height="304" alt="&#160;" />
<p><i>Obrázek 8: Vektorové operace podporované instrukèní sadou SSE.</i></p>



<p><a name="k07"></a></p>
<h2>7. Aritmetické instrukce pracující se skalárními hodnotami i s&nbsp;vektory</h2>

<p>Nejdùle¾itìj¹í skupinou <i>SSE</i> instrukcí jsou instrukce pro provádìní
aritmetických výpoètù. Tyto instrukce, které jsou vypsány v&nbsp;následující
tabulce, pracují buï s&nbsp;dvojicí skalárních hodnot typu <i>float/single</i>
umístìných v&nbsp;nejni¾¹ích 32 bitech 128bitového registru, nebo naopak
s&nbsp;dvojicí vektorù, z&nbsp;nich¾ ka¾dý obsahuje ètyøi 32bitové hodnoty opìt
typu <i>float/single</i>:</p>

<table>
<tr><th> #</th><th>Instrukce se skalárními operandy</th><th>Instrukce pracující s&nbsp;vektory</th><th>Význam instrukce</th></tr>
<tr><td> 1</td><td>ADDSS  </td><td>ADDPS  </td><td>souèet</td></tr>
<tr><td> 2</td><td>SUBSS  </td><td>SUBPS  </td><td>rozdíl</td></tr>
<tr><td> 3</td><td>MULSS  </td><td>MULPS  </td><td>souèin</td></tr>
<tr><td> 4</td><td>DIVSS  </td><td>DIVPS  </td><td>podíl</td></tr>
<tr><td> 5</td><td>RCPSS  </td><td>RCPPS  </td><td>pøevrácená hodnota</td></tr>
<tr><td> 6</td><td>SQRTSS </td><td>SQRTPS </td><td>druhá odmocnina</td></tr>
<tr><td> 7</td><td>RSQRTSS</td><td>RSQRTPS</td><td>pøevrácená hodnota z&nbsp;druhé odmocniny</td></tr>
<tr><td> 8</td><td>MAXSS  </td><td>MAXPS  </td><td>výpoèet maxima</td></tr>
<tr><td> 9</td><td>MINSS  </td><td>MINPS  </td><td>výpoèet minima</td></tr>
</table>

<a href="http://i.iinfo.cz/images/503/pc160-7.jpg"><img src="http://i.iinfo.cz/images/503/pc160-7-prev.jpg" width="370" height="75" alt="&#160;" /></a>
<p><i>Obrázek 9: Formát 32bitových slov obsahujících hodnoty s&nbsp;plovoucí
øádovou èárkou podle IEEE 754 (single/float).</i></p>



<p><a name="k08"></a></p>
<h2>8. Øízení re¾imu výpoètù s&nbsp;hodnotami reprezentovanými v&nbsp;systému plovoucí øádové èárky</h2>

<p>Pro mnohé typy algoritmù, pøedev¹ím tìch z&nbsp;oblasti numerické
matematiky, je dùle¾ité správné nastavení re¾imu aritmetické jednotky pøi
provádìní v¹ech aritmetických operací, vèetnì zpùsobu zaokrouhlování hodnot i
práce s&nbsp;denormalizovanými hodnotami, tj.&nbsp;takovými hodnotami, které
není mo¾né kvùli chybìjícímu rozsahu exponentu normalizovat tak, aby se první
bitová jednièka nacházela v&nbsp;blízkosti øádové èárky. Tato nastavení
aritmetické jednotky jsou snad je¹tì dùle¾itìj¹í v&nbsp;pøípadì pou¾ití
32bitového datového typu <i>single/float</i>, kde by ztráta pøesnosti
posledního bitu mantisy mohla mít velký vliv napøíklad na stabilitu numerických
výpoètù (pokud by se naopak pou¾il 64bitový datový typ <i>double</i> èi
80bitový <i>extended</i>, nebylo by mo¾né vyu¾ít instrukce <i>SSE</i>, tudí¾ je
v¾dy nutné zvolit mezi pøesností, pamì»ovými nároky a rychlostí výpoètu).</p>

<p>Zatímco v&nbsp;pøípadì instrukcí <i>3DNow!</i> byl vyu¾íván pouze jediný
zaokrouhlovací re¾im bez mo¾nosti volby (jednalo se buï o zaokrouhlení smìrem
k&nbsp;nule nebo k&nbsp;nejbli¾¹í reprezentovatelné hodnotì v&nbsp;závislosti
na typu instrukce), v&nbsp;pøípadì <i>SSE</i> je ji¾ situace lep¹í, proto¾e
jsou podporovány ètyøi re¾imy definované v&nbsp;normì <i>IEEE 754</i>:
zaokrouhlení smìrem k&nbsp;nule, ke kladnému nekoneènu, k&nbsp;zápornému
nekoneènu i k&nbsp;nejbli¾¹ímu reprezentovatelnému èíslu. Volba re¾imu se
provádí pøes øídicí registr <strong>MXCSR</strong>. Pøi po¾adavku na vy¹¹í
rychlost výpoètù s&nbsp;men¹í pøesností lze dokonce zakázat práci
s&nbsp;denormalizovanými èísly, které se automaticky pova¾ují za nulové
hodnoty. V&nbsp;registru <strong>MXCSR</strong> lze takté¾ zvolit masky
pøíznakù, které mohou být nastaveny pøi provádìní aritmetických operací &ndash;
dìlení nulou, pøeteèení, podteèení, nevalidní operace, ztráta pøesnosti. Právì
díky tìmto vlastnostem se <i>SSE</i> zaèalo vyu¾ívat i v&nbsp;nìkterých
tradièních knihovnách obsahujících algoritmy z&nbsp;oblasti numerické
matematiky.</p>

<a href="http://i.iinfo.cz/images/503/pc160-8.png"><img src="http://i.iinfo.cz/images/503/pc160-8-prev.png" width="370" height="234" alt="&#160;" /></a>
<p><i>Obrázek 10: V&nbsp;32bitových slovech lze podle normy IEEE 754
reprezentovat jak &bdquo;bì¾né&ldquo; èíselné konstanty, tak i kladnou èi
zápornou nulu, kladné i záporné nekoneèno i NaN (Not a Number), co¾ je pro
mnoho operací zcela korektní hodnota.</i></p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>
SSE (Streaming SIMD Extentions)<br />
<a href="http://www.songho.ca/misc/sse/sse.html">http://www.songho.ca/misc/sse/sse.html</a>
</li>

<li>
Timothy A. Chagnon: SSE and SSE2<br />
<a href="http://www.cs.drexel.edu/~tc365/mpi-wht/sse.pdf">http://www.cs.drexel.edu/~tc365/mpi-wht/sse.pdf</a>
</li>

<li>
Intel corporation: Extending the Worldr's Most Popular Processor Architecture<br />
<a href="http://download.intel.com/technology/architecture/new-instructions-paper.pdf">http://download.intel.com/technology/architecture/new-instructions-paper.pdf</a>
</li>

<li>
SIMD architectures:<br />
<a href="http://arstechnica.com/old/content/2000/03/simd.ars/">http://arstechnica.com/old/content/2000/03/simd.ars/</a>
</li>

<li>
Tour of the Black Holes of Computing!: Floating Point<br />
<a href="http://www.cs.hmc.edu/~geoff/classes/hmc.cs105.../slides/class02_floats.ppt">http://www.cs.hmc.edu/~geoff/classes/hmc.cs105.../slides/class02_floats.ppt</a>
</li>

<li>3Dnow! Technology Manual<br />
AMD Inc., 2000</li>

<li>Intel MMX<sup>TM</sup> Technology Overview<br />
Intel corporation, 1996</li>

<li>MultiMedia eXtensions<br />
<a href="http://softpixel.com/~cwright/programming/simd/mmx.php">http://softpixel.com/~cwright/programming/simd/mmx.php</a>i
</li>

<li>AMD K5 ("K5" / "5k86")<br />
<a href="http://www.pcguide.com/ref/cpu/fam/g5K5-c.html">http://www.pcguide.com/ref/cpu/fam/g5K5-c.html</a>
</li>

<li>Sixth Generation Processors<br />
<a href="http://www.pcguide.com/ref/cpu/fam/g6.htm">http://www.pcguide.com/ref/cpu/fam/g6.htm</a>
</li>

<li>Great Microprocessors of the Past and Present<br />
<a href="http://www.cpushack.com/CPU/cpu1.html">http://www.cpushack.com/CPU/cpu1.html</a>
</li>

<li>Very long instruction word (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Very_long_instruction_word">http://en.wikipedia.org/wiki/Very_long_instruction_word</a>
</li>

<li>CPU design (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/CPU_design">http://en.wikipedia.org/wiki/CPU_design</a>
</li>

<li>Control unit (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Control_unit">http://en.wikipedia.org/wiki/Control_unit</a>
</li>

<li>Cray History<br />
<a href="http://www.cray.com/About/History.aspx?404;http://www.cray.com:80/about_cray/history.html">http://www.cray.com/About/History.aspx?404;http://www.cray.com:80/about_cray/history.html</a>
</li>

<li>Cray Historical Timeline<br />
<a href="http://www.cray.com/Assets/PDF/about/CrayTimeline.pdf">http://www.cray.com/Assets/PDF/about/CrayTimeline.pdf</a>
</li>

<li>Computer Speed Claims 1980 to 1996<br />
<a href="http://homepage.virgin.net/roy.longbottom/mips.htm">http://homepage.virgin.net/roy.longbottom/mips.htm</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2011</small></p>
</body>
</html>

