<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Tvoøíme skripty pro grafický editor GIMP (2)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Tvoøíme skripty pro grafický editor GIMP (2)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V páté èásti èlánku o programovacím jazyce Scheme si na nìkolika demonstraèních pøíkladech uká¾eme, jakým zpùsobem se specifikují základní vlastností skriptù (nazývaných Script-fu) v grafickém editoru GIMP, jak se tyto skripty pøidávají do menu editoru i zpùsob definice dialogù, v nich¾ mù¾e u¾ivatel nastavovat rùzné parametry pou¾ívané skriptem.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Definice základních vlastností skriptu a registrace skriptu</a></p>
<p><a href="#k02">2. Registraèní funkce &bdquo;script-fu-register&ldquo; a &bdquo;script-fu-menu-register&ldquo;</a></p>
<p><a href="#k03">3. První demonstraèní pøíklad &ndash; vykreslení spirály</a></p>
<p><a href="#k04">4. Dialog vyvolaný pøed spu¹tìním skriptu</a></p>
<p><a href="#k05">5. Druhý demonstraèní pøíklad &ndash; zobrazení dialogu se v¹emi vstupními prvky</a></p>
<p><a href="#k06">6. Tøetí demonstraèní pøíklad &ndash; nastavení vlastností vykreslované spirály</a></p>
<p><a href="#k07">7. Ètvrtý demonstraèní pøíklad &ndash; funkce jako parametr jiných funkcí</a></p>
<p><a href="#k08">8. Obsah následující èásti seriálu</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Definice základních vlastností skriptu a registrace skriptu</h2>

<p>V&nbsp;pøedchozí èásti èlánku o programovacím jazyce <i>Scheme</i> jsme si
øekli základní informace o podpoøe skriptování ve známém rastrovém grafickém
editoru <i>GIMP</i>, pøedev¹ím o pou¾ití skriptù nazývaných <i>Script-Fu</i>.
Jedná se o skripty napsané v&nbsp;dialektu programovacího jazyka <i>Scheme</i>,
které mohou s&nbsp;vyu¾itím zveøejnìného API pøistupovat k&nbsp;mnoha interním
funkcím grafického editoru <i>GIMP</i> a vytváøet i mìnit rùzné typy objektù,
se kterými se v&nbsp;<i>GIMPu</i> pracuje. Jedná se napøíklad o samotné
rastrové obrázky rùzných typù (plnobarevné obrázky, obrázky ve stupních ¹edi,
obrázky s&nbsp;barvovou paletou...), hladiny (vrstvy), rùzné kreslicí nástroje
(tu¾ky, ¹tìtce, rozpra¹ovaèe), masky, cesty atd. V&nbsp;dne¹ním èlánku si
nejprve øekneme, jakým zpùsobem se u¾ivatelské skripty registrují (aby byly
volatelné z&nbsp;<i>GIMPu</i> èi dal¹ích skriptù) a takté¾ to, jak lze
definovat dialog, v&nbsp;nìm¾ mù¾e u¾ivatel zadat parametry potøebné pro bìh
skriptu.</p>

<a href="http://i.iinfo.cz/images/554/scheme4-4.png"><img src="http://i.iinfo.cz/images/554/scheme4-4-prev.png" width="308" height="270" alt=" " /></a>
<p><i>Obrázek 1: Rozbalené menu Filters, které kromì zaregistrovaných skriptù
nabízí i spu¹tìní dal¹ích pøídavných modulù, které jsou vìt¹inou pøekládány na
danou platformu (tyto moduly mohou být napsané napøíklad v&nbsp;céèku èi C++,
ale i dal¹ích programovacích jazycích).</i></p

<p>Nejprve si struènì popí¹eme zpùsob registrace skriptù, proto¾e se jedná o
základní vìc, kterou je nutné pøed pou¾itím nìjakého skriptu provést. Proces
registrace, který se ruènì, tj.&nbsp;z&nbsp;grafického u¾ivatelského rozhraní
editoru <i>GIMP</i>, spou¹tí pøíkazem <i>Script-Fu/Obnovit Skripty (Refresh
Scripts)</i>, slou¾í mj.&nbsp;i k&nbsp;tomu, aby editor <i>GIMP</i> zajistil
správné vygenerování menu zobrazeného nad editovaným obrázkem, umo¾nil
zobrazení základních informací o skriptu (autorovi, datu vytvoøení, typu
obrázkù, se kterými skript doká¾e pracovat atd.) a v&nbsp;neposlední øadì té¾
zajistil vytvoøení dialogu, který se vyvolá ve chvíli, kdy je skript spu¹tìný.
Zdrojový soubor naprosté vìt¹iny skriptù obsahuje minimálnì tøi èásti &ndash;
vlastní funkci, která provádí v¹echny úkoly, jen¾ má skript vykonat (jméno této
funkce mù¾e být témìø libovolné), volání funkce
<strong>script-fu-menu-register</strong> pro vlo¾ení skriptu do vybraného menu
a nakonec i volání funkce <strong>script-fu-register</strong>, pomocí ní¾ se
skript zaregistruje a která takté¾ slou¾í ke specifikaci parametrù skriptu
(tyto parametry jsou nepovinné; pokud nejsou uvedeny, nezobrazí se dialog pro
jejich zadání).</p>

<a href="http://i.iinfo.cz/images/554/scheme4-3.png"><img src="http://i.iinfo.cz/images/554/scheme4-3-prev.png" width="292" height="270" alt=" " /></a>
<p><i>Obrázek 2: Spu¹tìní interaktivní konzole jazyka Scheme z&nbsp;grafického
editoru GIMP verze 2.4.5. U novìj¹ích verzí GIMPu je menu pøesunuto pøímo do
okna s&nbsp;editovaným obrázkem.</i></p>



<p><a name="k02"></a></p>
<h2>2. Registraèní funkce &bdquo;script-fu-register&ldquo; a &bdquo;script-fu-menu-register&ldquo;</h2>

<p>V&nbsp;této kapitole si popí¹eme dvojici &bdquo;registraèních&ldquo; funkcí
nazvaných <strong>script-fu-register</strong> a
<strong>script-fu-menu-register</strong>. Tyto funkce jsou volané samotným
<i>GIMPem</i> po spu¹tìní pøíkazu <i>Script>Script-Fu/Obnovit Skripty (Refresh
Scripts)</i>. První z&nbsp;tìchto funkcí slou¾í pro získání základních
informací o skriptu. Tyto informace jsou pøedávány formou øetìzcù, z&nbsp;nich¾
mnohé nemají ¾ádný pevnì daný formát (co¾ mù¾e být nìkdy problematické,
napøíklad pøi zpracovávání data vytvoøení skriptu, informace o copyrightu
atd.). Jedná se celkem o sedm parametrù, jejich¾ význam je vypsán
v&nbsp;následující tabulce:</p>

<table>
<tr><th>Poøadí parametru</th><th>Význam</th></tr>
<tr><td>1</td><td>jméno funkce, v&nbsp;ní¾ je zapsáno tìlo skriptu, tato funkce se pøi spu¹tìní skriptu zavolá</td></tr>
<tr><td>2</td><td>jméno skriptu v&nbsp;takové podobì, jak se má zobrazit v&nbsp;menu</td></tr>
<tr><td>3</td><td>nápovìda, která se zobrazuje napøíklad pøi zastavení kurzoru nad pøíkazem v&nbsp;menu nebo v&nbsp;browseru konzole jazyka Scheme</td></tr>
<tr><td>4</td><td>jméno autora skriptu</td></tr>
<tr><td>5</td><td>informace o copyrightu</td></tr>
<tr><td>6</td><td>datum vytvoøení/poslední úpravy skriptu</td></tr>
<tr><td>7</td><td>seznam typù obrázkù, na které lze skript pou¾ít</td></tr>
</table>

<p>Skript, který mù¾e být aplikován na plnobarevné obrázky, obrázky ve stupních
¹edi i obrázky s&nbsp;barvovou paletou, jen¾ navíc nemá ¾ádné u¾ivatelem
mìnitelné parametry, by mohl být zaregistrován následujícím pøíkazem
(pov¹imnìte si podtr¾ení pøed slovem &bdquo;Spirals&ldquo;, kterým je mo¾né
definovat klávesovou zkratku):</p>

<pre>
(script-fu-register
    "script-fu-spirals-1"
    "_Spirals-1"
    "Renders spiral with three spins to active layer using current brush"
    "Pavel Tisnovsky"
    "(c) Pavel Tisnovsky"
    "2010-05-11"
    "RGB*, INDEXED*, GRAY*"
)
</pre>

<p>Funkce <strong>script-fu-menu-register</strong> je volána s&nbsp;dvojicí
parametrù typu øetìzec. Prvním parametrem je název funkce, která provádí
vlastní skript (jedná se o stejnou funkci, jaká byla uvedena pøi volání
<strong>script-fu-register</strong>), druhým parametrem cesta ke skriptu
v&nbsp;menu. Zastavme se u toho, jakým zpùsobem se tato cesta zadává. Ji¾
v&nbsp;pøedchozí èásti tohoto seriálu jsme si øekli, ¾e <i>GIMP</i> rozeznává
dva typy skriptù. První typem jsou skripty, které lze volat pouze
v&nbsp;pøípadì, ¾e má u¾ivatel otevøený nìjaký obrázek, druhým typem skripty,
je¾ naopak nìjaký obrázek na základì údajù pøedaných u¾ivatelem vytváøí. U
prvního typu skriptù by mìla cesta zaèínat prefixem "&lt;Image&gt;/", u druhého
naopak prefixem "&lt;Toolbox&gt;/" (ve skuteènosti jsem situaci prozatím
ponìkud zjednodu¹il, proto¾e pou¾itelných prefixù a tím i typù skriptù existuje
více, napøíklad "&lt;Layers&gt;", "&lt;Channels&gt;" èi
"&lt;Patterns&gt;").</p>

<p>Za prefixem se nachází jméno polo¾ky umístìné v&nbsp;hlavním menu,
tj.&nbsp;buï se jedná o nìjaké ji¾ existující jméno (napøíklad
&bdquo;File&ldquo;, &bdquo;Select&ldquo;, &bdquo;Image&ldquo;,
&bdquo;Filters&ldquo; atd.) nebo o polo¾ku novou. Pokud se má skript nacházet
v&nbsp;nìjakém pod-menu (Filters/Render/Clouds), je nutné název èi názvy
jednotlivých úrovní menu od sebe oddìlit znakem / (lomítko), tak¾e se výsledná
cesta k&nbsp;pøíkazu podobá bì¾nému zpùsobu zadání cesty k&nbsp;souboru.
Následuje pøíklad zaøazení skriptu &bdquo;script-1&ldquo; do nového menu
nazvaného &bdquo;Root.cz&ldquo;, dal¹ího skriptu &bdquo;script-2&ldquo; do ji¾
existujícího menu &bdquo;Filters&ldquo; a tøetího skriptu
&bdquo;script-3&ldquo; do pod-pod-menu &bdquo;Filters/Render/Clouds&ldquo;:</p>

<pre>
(script-fu-menu-register "script-1"
                         "&lt;Image&gt;/Root.cz")

(script-fu-menu-register "script-2"
                         "&lt;Image&gt;/Filters")

(script-fu-menu-register "script-3"
                         "&lt;Image&gt;/Filters/Render/Clouds")
</pre>



<p><a name="k03"></a></p>
<h2>3. První demonstraèní pøíklad &ndash; vykreslení spirály</h2>

<p>Uka¾me si nyní, jakým zpùsobem mù¾eme vyu¾ít informace uvedené <a
href="#k01">v&nbsp;první</a> a <a href="#k02">ve druhé kapitole</a> pøi psaní
skuteèného GIMPovského skriptu, jen¾ po svém spu¹tìní vykreslí spirálu aktuálnì
nastaveným ¹tìtcem. Pøi zkoumání zdrojového kódu skriptu, jeho¾ zdrojový kód je
vypsán na konci této kapitoly, si mù¾eme v¹imnout, ¾e skript je rozdìlen na tøi
èásti &ndash; vlastní kód skriptu pøedstavovaný funkcí
<strong>script-fu-spirals-1</strong>, bloku s&nbsp;definicí základních
informací o skriptu pøedstavovaném funkcí <strong>script-fu-register</strong> a
koneènì tøetím blokem, který je tvoøen funkcí
<strong>script-fu-menu-register</strong>, v&nbsp;ní¾ je provedeno pøidání
skriptu do menu grafického editoru <i>GIMP</i>. Jak funkci
<strong>script-fu-register</strong>, tak i funkci
<strong>script-fu-menu-register</strong> volá samotný grafický editor a navíc
nejsou tyto dvì funkce ze skriptù dostupné (nejsou souèástí API <i>GIMPu</i>),
na rozdíl od funkce <strong>script-fu-spirals-1</strong>, kterou lze po
zaregistrování na¹eho skriptu volat prakticky odkudkoli.</p>

<a href="http://i.iinfo.cz/images/573/scheme5-1.png"><img src="http://i.iinfo.cz/images/573/scheme5-1-prev.png" width="325" height="270" alt=" " /></a>
<p><i>Obrázek 3: Po zaregistrování prvního demonstraèního pøíkladu vytvoøí GIMP
novou polo¾ku menu, která je na tomto screenshotu zvýraznìna èervenou
barvou.</i></p>

<p>Po spu¹tìní obnovy v¹ech skriptù u¾ivatelským pøíkazem <i>Script-Fu/Obnovit
Skripty (Refresh Scripts)</i> zaène grafický editor <i>GIMP</i> vyhledávat
v¹echny u¾ivatelské skripty (ulo¾ené v&nbsp;adresáøi
<i>~/.gimp-verze/script</i> i skripty spoleèné pro v¹echny u¾ivatele. Pro ka¾dý
nalezený skript je spu¹tìna jejich registrace a následnì jejich pøípadné
zaøazení do menu. Ná¹ první demonstraèní pøíklad je pod názvem <i>Spirals-1</i>
pøidán do (pravdìpodobnì je¹tì neexistujícího) menu pojmenovaného
<i>Root.cz</i>. Jedná se o koøenové menu zobrazené pøímo na panelu umístìného
nad obrázkem, co¾ je ostatnì patrné i ze screenshotu. Pokud u¾ivatel skript
z&nbsp;tohoto menu vybere, je zahájeno vykreslování spirály se støedem
v&nbsp;bodì [200, 200] aktuálnì nastaveným ¹tìtcem. Proto¾e není nadefinován
¾ádný dialog, v&nbsp;nìm¾ by u¾ivatel mohl zadat parametry skriptu, je skript
ihned spu¹tìn a proveden jako jeden editaèní krok (celou spirálu je tudí¾ mo¾né
vymazat pomocí klávesové zkratky <strong>CTRL+Z</strong> i kdy¾ byla ve
skuteènosti vykreslena v&nbsp;900 tazích ¹tìtcem). Následuje výpis zdrojového
kódu prvního demonstraèního pøíkladu:</p>

<pre>
; Èlánek "Tvoøíme skripty pro grafický editor GIMP (2)"
; Demonstraèní pøíklad èíslo 1

; Tato funkce je zavolána pøíkazem vyvolaným
; u¾ivatelem z grafického u¾ivatelského rozhraní GIMPu.
(define (script-fu-spirals-1
                             selected-image
                             selected-layer)

    ; definice lokálních promìnných
    (let*
        (
            ; konstanta - poèet vrcholù køivky
            ; na jednu otoèku spirály
            (vertexes-per-spin 300)

            ; poèet prvkù vektoru = (x1, y1, x2, y2)
            (npoint 4)

            ; vykreslovaná úseèka je pøedstavována vektorem
            ; (vektorem je v tomto kontextu my¹lena datová
            ; struktura programovacího jazyka Scheme)
            (segment (make-vector 4 ))

            ; úhly zvìt¹ující se pro ka¾dý dal¹í vykreslený úsek
            (alfa 0)
            (beta 0)

            ; konstanta - 2xPi
            (full-circle (* 3.1415927 2))

            ; poèet vykreslených segmentù
            (step (/ full-circle vertexes-per-spin))

            ; poèet otoèek spirály
            (spins 3)

            ; vzdálenost vykreslovaného úseku od støedu spirály
            (radius 20)
            (old-radius 20)

            ; zmìna vzdálenosti pro ka¾dý dal¹í úsek
            (radius-delta (/ (- 200 20) (* vertexes-per-spin spins 1)))
        )
        (gimp-undo-push-group-start selected-image)

        ; programová smyèka, v ní¾ se vykreslí úseèkové segmenty
        ; ze kterých se skládá aproximace spirály
        (while (&lt;= alfa (* full-circle spins 1))
            (set! beta (+ alfa step))
            (set! radius (+ radius radius-delta))
            ; vypoèet poèáteèní a koncové souøadice úseèky
            (vector-set! segment 0 (+ 200 (* old-radius (cos alfa ) )))
            (vector-set! segment 1 (+ 200 (* old-radius (sin alfa ) )))
            (vector-set! segment 2 (+ 200 (* radius (cos beta ) )))
            (vector-set! segment 3 (+ 200 (* radius (sin beta ) )))

            ; vykreslení úseèky ¹tìtcem
            (gimp-paintbrush selected-layer 100 npoint segment 0 10)

            ; pøinutíme GIMP, aby obrázek prùbì¾nì vykresloval
            (gimp-displays-flush)
            ; pøechod na dal¹í úsek
            (set! alfa beta)
            (set! old-radius radius)
        )
        ; ulo¾íme stav obrázku na zásobník
        (gimp-undo-push-group-end selected-image) 
    )
    ; naposledy pøinutíme GIMP, aby finální obrázek vykreslil
    (gimp-displays-flush)  
)


; základní informace o skriptu - v tomto pøípadì se zde nenachází
; ¾ádné mìnitelné polo¾ky, tudí¾ není ani zobrazen dialog
(script-fu-register "script-fu-spirals-1"
    "_Spirals-1"
    "Renders spiral with three spins to current layer using current brush"
    "Pavel Tisnovsky"
    "Pavel Tisnovsky"
    "2010-05-11"
    "RGB*, INDEXED*, GRAY*"
    SF-IMAGE       "Image"         0
    SF-DRAWABLE    "Drawable"      0
)


; registrace skriptu do menu
(script-fu-menu-register "script-fu-spirals-1"
                         "&lt;Image&gt;/Root.cz")

; finito
</pre>

<img src="http://i.iinfo.cz/images/573/scheme5-2.png" width="400" height="400" alt=" " />
<p><i>Obrázek 4: První demonstraèní pøíklad po svém spu¹tìní. Nejprve byl
vytvoøen obrázek s&nbsp;èerným pozadím, posléze vybrán ¹tìtec nazvaný
&bdquo;Circle Fuzzy 17&ldquo;, zvolena ¾lutá barva ¹tìtce a nakonec byl spu¹tìn
demonstraèní pøíklad.</i></p>



<p><a name="k04"></a></p>
<h2>4. Dialog vyvolaný pøed spu¹tìním skriptu</h2>

<p>Funkce <strong>script-fu-register</strong> akceptuje kromì sedmi povinných
parametrù popsaných <a href="#k02">ve druhé kapitole</a> i libovolné mno¾ství
dal¹ích parametrù, pomocí nich¾ je mo¾né specifikovat obsah dialogu zobrazeného
pøed vlastním provedením skriptu. Tento dialog mù¾e obsahovat prakticky
libovolnou kombinaci ovládacích prvkù, mezi nì¾ patøí napøíklad vstupní textová
èi èíselná pole, tlaèítka vyvolávající dal¹í specializované dialogy pro výbìr
fontu, souboru, barvy, vrstvy (hladiny), dále pak posuvníky (<i>slidery</i>)
atd. Ka¾dý ovládací prvek je popsán trojicí parametrù &ndash; typem ovládacího
prvku (jedná se o konstantu, napøíklad <strong>SF-ADJUSTMENT</strong>),
libovolným øetìzcem, který je v&nbsp;dialogu zobrazen vedle prvku (jedná se o
jeho popis &ndash; <i>label</i>) a tøetím parametrem, jeho¾ význam se li¹í
podle toho, o jaký ovládací prvek se jedná &ndash; mù¾e jít napøíklad o
implicitní barvu, jméno fontu, jméno ¹tìtce, obsah listboxu atd. Hodnoty zadané
u¾ivatelem se pøedávají do funkce pøedstavující tìlo skriptu jako její
parametry &ndash; musíme si tedy dát pozor na to, aby poèet parametrù odpovídal
poètu prvkù dialogu a takté¾ na jejich správnou posloupnost. Jména (konstanty)
v¹ech typù ovládacích prvkù, odpovídající datové typy jazyka <i>Scheme</i> i
jejich struèný popis, jsou uvedeny v&nbsp;následující tabulce:</p>

<table>
<tr><th>Pojmenování typu</th><th>Datový typ Scheme</th><th>Popis</th></tr>
<tr><td>SF-IMAGE     </td><td>Integer (id obrázku)            </td><td>nabídne seznam otevøených obrázkù</td></tr>
<tr><td>SF-DRAWABLE  </td><td>Integer (id masky, vrstvy...)   </td><td>nabídne seznam hladin v obrázku</td></tr>
<tr><td>SF-VALUE     </td><td>String                          </td><td>vstupní pole pro zadání èíselné hodnoty</td></tr>
<tr><td>SF-TOGGLE    </td><td>Boolean (TRUE nebo FALSE)       </td><td>vìt¹inou checkbox</td></tr>
<tr><td>SF-PATTERN   </td><td>String (jméno vzorku)           </td><td>nabídne výbìr vzorkù v&nbsp;novém dialogu</td></tr>
<tr><td>SF-ADJUSTMENT</td><td>(start min max step1 step2 typ) </td><td>podle specifikace typu zobrazí buï vstupní pole nebo posuvník</td></tr>
<tr><td>SF-FILENAME  </td><td>String (jméno souboru)          </td><td>nový dialog pro výbìr souboru</td></tr>
<tr><td>SF-STRING    </td><td>String                          </td><td>vstupní pole pro zadání øetìzce</td></tr>
<tr><td>SF-FONT      </td><td>String (jméno fontu)            </td><td>zobrazí dialog pro výbìr fontu</td></tr>
<tr><td>SF-COLOR     </td><td>List (seznam RGB, rozsah [0-255]</td><td>zobrazí dialog pro výbìr barvy</td></tr>
<tr><td>SF-OPTION    </td><td>List (seznam øetìzcù)           </td><td>seznam hodnot (lisbox)</td></tr>
<tr><td>SF-GRADIENT  </td><td>String (jméno gradientu)        </td><td>výbìr pøechodù (gradientù)</td></tr>
</table>



<p><a name="k05"></a></p>
<h2>5. Druhý demonstraèní pøíklad &ndash; zobrazení dialogu se v¹emi vstupními prvky</h2>

<p>Ve druhém demonstraèním pøíkladu je ukázáno pou¾ití v¹ech dostupných typù
vstupních prvkù. Tento demonstraèní pøíklad, jen¾ je pou¾itelný (spustitelný) i
bez nutnosti otevøení èi vytvoøení nového obrázku, po svém vyvolání z&nbsp;menu
zobrazí dialog, v&nbsp;nìm¾ se nachází v¹echny ovládací prvky, které je mo¾né
pou¾ít v&nbsp;grafickém editoru <i>GIMP</i>. Samotný skript sice ve skuteènosti
nic neprovádí (zavolaná funkce <strong>demo-box</strong> pouze vypí¹e na
standardní výstup text "Do nothing"), ov¹em vzhledem ke zpùsobu volání této
funkce je nutné, aby akceptovala pøesnì takový poèet parametrù, jaký odpovídá
poètu ovládacích prvkù zobrazených na dialogu. Po spu¹tìní tohoto
demonstraèního pøíkladu a následném zobrazení dialogu si vyzkou¹ejte, jak se
chovají jednotlivé ovládací prvky. Uvidíte, ¾e aktivace nìkterých prvkù
(napøíklad kliknutím na nì) vede ke zobrazení specializovaných dialogù
samotného <i>GIMPu</i>, v&nbsp;nich¾ lze napøíklad vybrat barvu, barevný
pøechod atd.</p>

<img src="http://i.iinfo.cz/images/573/scheme5-3.png" width="369" height="540" alt=" " />
<p><i>Obrázek 5: Dialog zobrazený po spu¹tìní druhého demonstraèního
pøíkladu.</i></p>

<p>Následuje výpis zdrojového kódu druhého demonstraèního pøíkladu:</p>

<pre>
; Èlánek "Tvoøíme skripty pro grafický editor GIMP (2)"
; Demonstraèní pøíklad èíslo 2

; Tato funkce musí akceptovat takový poèet parametrù,
; aby odpovídal poètu ovládacích prvkù zobrazených
; na dialogu.
(define (demo-box
        value
        adj1
        adj2
        image
        drawable
        toggle
        pattern
        string
        font
        color
        option
        gradient)
    (print "Do nothing")
)

; základní informace o skriptu a souèasnì i definice obsahu dialogu
(script-fu-register "demo-box"
                    "Demo Box..."
                    "Do nothing, just show all input widgets available"
                    "Joe User"
                    "Joe User"
                    "August 2000"
                    ""
                    SF-ADJUSTMENT "SF-ADJUSTMENT (slider)" '( 30 1 2000 1 10 1 0)
                    SF-ADJUSTMENT "SF-ADJUSTMENT"         '(400 1 2000 1 10 1 1)
                    SF-COLOR      "SF-COLOR" '(255 0 255)
                    SF-DRAWABLE   "SF-DRAWABLE" 0
                    SF-FONT       "SF-FONT" ""
                    SF-GRADIENT   "SF-GRADIENT"  "Golden"
                    SF-IMAGE      "SF-IMAGE" 0
                    SF-OPTION     "SF-OPTION" '("Option 1" "Option 2" "Option 3")
                    SF-PATTERN    "SF-PATTERN" "Wood"
                    SF-STRING     "SF-STRING" "Test String"
                    SF-TOGGLE     "SF-TOGGLE" TRUE
                    SF-VALUE      "SF-VALUE" "0"
                    SF-FILENAME   "SF-FILENAME" "/"
)

; registrace skriptu do menu
(script-fu-menu-register "demo-box"
                         "&lt;Toolbox&gt;/Root.cz")

; finito
</pre>



<p><a name="k06"></a></p>
<h2>6. Tøetí demonstraèní pøíklad &ndash; nastavení vlastností vykreslované spirály</h2>

<p>Znalost funkce ovládacích prvkù, které je mo¾né vlo¾it do dialogu skriptu,
mù¾eme ihned vyu¾ít pro roz¹íøení mo¾ností prvního demonstraèního pøíkladu,
v&nbsp;nìm¾ se vykreslovala spirála bez mo¾nosti zmìny jejích vlastností. Ve
tøetím demonstraèním pøíkladu je pou¾it dialog, ve kterém mù¾e u¾ivatel zadat
pozici støedu spirály, její minimální a maximální polomìr (pøesnìji øeèeno
nejmen¹í a nejvìt¹í vzdálenost køivky pøedstavující spirálu, od jejího støedu),
poèáteèní úhel, od kterého se spirála zaène vykreslovat a takté¾ celkový poèet
otoèek spirály (ten se zadává výbìrem hodnoty z&nbsp;listboxu, pøièem¾ první
polo¾ka má index 0, druhá index 1 atd.). Zajímavá je funkce prvních dvou
ovládacích prvkù &ndash; výbìru obrázku a vrstvy, do které se má provést
vykreslování. Tyto ovládací prvky se bì¾nì nezobrazují, proto¾e se implicitnì
pou¾ívá aktivní obrázek a vybraná vrstva. Pokud tyto ovládací prvky potøebujeme
z&nbsp;nìjakého dùvodu zobrazit, je mo¾né toho docílit nejjednodu¹eji tak, ¾e
se tyto prvky v&nbsp;dialogu pøemístí na jiné místo (postaèuje pøed nì vlo¾it
jiný typ ovládacího prvku, co¾ si ostatnì  mù¾ete vyzkou¹et editací zdrojového
kódu a opìtovným naètením v¹ech skriptù).</p>

<img src="http://i.iinfo.cz/images/573/scheme5-4.png" width="374" height="324" alt=" " />
<p><i>Obrázek 6: Dialog zobrazený po spu¹tìní tøetího demonstraèního
pøíkladu.</i></p>

<p>Zdrojový kód dne¹ního tøetího demonstraèního pøíkladu má tvar:</p>

<pre>
; Èlánek "Tvoøíme skripty pro grafický editor GIMP (2)"
; Demonstraèní pøíklad èíslo 3

; Tato funkce je zavolána z dialogu vyvolaného u¾ivatelem
; z grafického u¾ivatelského rozhraní GIMPu.
(define (script-fu-spirals-2
                             selected-image
                             selected-layer
                             selected-spins
                             center-x center-y
                             start-radius
                             end-radius
                             start-angle)

    ; definice lokálních promìnných
    (let*
        (
            ; konstanta - poèet vrcholù køivky
            ; na jednu otoèku spirály
            (vertexes-per-spin 300)

            ; poèet prvkù vektoru = (x1, y1, x2, y2)
            (npoint 4)

            ; vykreslovaná úseèka je pøedstavována vektorem
            ; (vektorem je v tomto kontextu my¹lena datová
            ; struktura programovacího jazyka Scheme)
            (segment (make-vector 4 ))

            ; úhly zvìt¹ující se pro ka¾dý dal¹í vykreslený úsek
            (alfa 0)
            (beta 0)

            ; konstanta - 2xPi
            (full-circle (* 3.1415927 2))

            ; poèet vykreslených segmentù
            (step (/ full-circle vertexes-per-spin))

            ; úprava hodnoty zadané u¾ivatelem
            (spins (+ selected-spins 1))

            ; vzdálenost vykreslovaného úseku od støedu spirály
            (radius start-radius)
            (old-radius radius)

            ; zmìna vzdálenosti pro ka¾dý dal¹í úsek
            (radius-delta (/ (- end-radius start-radius) (* vertexes-per-spin spins 1)))
        )
        (gimp-undo-push-group-start selected-image)

        ; programová smyèka, v ní¾ se vykreslí úseèkové segmenty
        ; ze kterých se skládá aproximace spirály
        (while (&lt;= alfa (* full-circle spins 1))
            (set! beta (+ alfa step))
            (set! radius (+ radius radius-delta))
            ; vypoèet poèáteèní a koncové souøadice úseèky
            (vector-set! segment 0 (+ center-x (* old-radius (cos (+ alfa start-angle) ))))
            (vector-set! segment 1 (+ center-y (* old-radius (sin (+ alfa start-angle) ))))
            (vector-set! segment 2 (+ center-x (* radius (cos (+ beta start-angle) ))))
            (vector-set! segment 3 (+ center-y (* radius (sin (+ beta start-angle) ))))

            ; vykreslení úseèky ¹tìtcem
            (gimp-paintbrush selected-layer 100 npoint segment 0 10)

            ; pøinutíme GIMP, aby obrázek prùbì¾nì vykresloval
            (gimp-displays-flush)
            ; pøechod na dal¹í úsek
            (set! alfa beta)
            (set! old-radius radius)
        )
        ; ulo¾íme stav obrázku na zásobník
        (gimp-undo-push-group-end selected-image) 
    )
    ; naposledy pøinutíme GIMP, aby finální obrázek vykreslil
    (gimp-displays-flush)  
)


; základní informace o skriptu a definice dialogu
; zobrazeného u¾ivateli
(script-fu-register "script-fu-spirals-2"
    _"_Spirals-2"
    _"Renders various spirals to current layer"
    "Pavel Tisnovsky"
    "Pavel Tisnovsky"
    "2010-05-11"
    "RGB*, INDEXED*, GRAY*"
    SF-IMAGE       "Image"         0
    SF-DRAWABLE    "Drawable"      0
 
    SF-OPTION     _"Spins"        '(_"1"
                                    _"2"
                                    _"3"
                                    _"4")
    SF-ADJUSTMENT _"X center"     '(200 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Y center"     '(200 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Start radius" '(20  0 999 1 10 0 1)
    SF-ADJUSTMENT _"End radius"   '(180 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Start angle"  '(0 0 359 1 10 0 0)
)

; registrace skriptu do menu
(script-fu-menu-register "script-fu-spirals-2"
                         "&lt;Image&gt;/Root.cz")

; finito
</pre>

<img src="http://i.iinfo.cz/images/573/scheme5-5.png" width="400" height="400" alt=" " />
<p><i>Obrázek 7: Spirála vykreslená pomocí tøetího demonstraèního
skriptu.</i></p>



<p><a name="k07"></a></p>
<h2>7. Ètvrtý demonstraèní pøíklad &ndash; funkce jako parametr jiných funkcí</h2>

<p>Dal¹í, dnes ji¾ poslední demonstraèní pøíklad, neukazuje ¾ádnou novou
vlastnost grafického editoru <i>GIMP</i>, spí¹e se jedná o demonstraci jednoho
rysu programovacího jazyka <i>Scheme</i>. Ji¾ v&nbsp;úvodní èásti seriálu o
<i>Scheme</i> jsme si øekli, ¾e se jedná o programovací jazyk
s&nbsp;funkcionálními rysy, v&nbsp;nìm¾ jsou funkce pova¾ovány za objekty
prvního øádu &ndash; funkce lze pøedávat jiným funkcím jako parametry, ukládat
je do promìnných, vracet jako výsledek jiných funkcí atd. Právì tato vlastnost
programovacího jazyka <i>Scheme</i> je vyu¾ita ve ètvrtém demonstraèním
pøíkladu, konkrétnì v&nbsp;pomocné funkci <strong>coord</strong>, která slou¾í
pro výpoèet jedné ze souøadnic bodu le¾ícího na spirále. Této funkci se
pøedávají jak bì¾né parametry (polomìr, souøadnice støedu spirály, úhel), tak i
goniometrická funkce, která se má pou¾ít pro výpoèet souøadnic. Díky tomu bylo
mo¾né tìlo této pomocné funkce zapsat bez pou¾ití podmínìných blokù. Na tomto
místì mo¾ná stojí za pøipomenutí, ¾e podobným zpùsobem, konkrétnì
s&nbsp;vyu¾itím ukazatelù na funkce, lze tento problém øe¹it i napøíklad
v&nbsp;céèku, naopak v&nbsp;Javì by se musel pøedávat objekt implementující
nìjaké spoleèné rozhraní:</p>

<pre>
; Èlánek "Tvoøíme skripty pro grafický editor GIMP (2)"
; Demonstraèní pøíklad èíslo 4

; Tato funkce je zavolána z dialogu vyvolaného u¾ivatelem
; z grafického u¾ivatelského rozhraní GIMPu.
(define (script-fu-spirals-3
                             selected-image
                             selected-layer
                             selected-spins
                             center-x center-y
                             start-radius
                             end-radius
                             start-angle)

    ; pomocná funkce pro výpoèet jedné souøadnice
    ; bodu le¾ícího na spirále
    ; (pov¹imnìte si pøedev¹ím zpùsobu pou¾ití parametru function)
    (define (coord center radius function angle start-angle)
        (+ center (* radius (function (+ angle start-angle))))
    )

    ; definice lokálních promìnných
    (let*
        (
            ; konstanta - poèet vrcholù køivky
            ; na jednu otoèku spirály
            (vertexes-per-spin 300)

            ; poèet prvkù vektoru = (x1, y1, x2, y2)
            (npoint 4)

            ; vykreslovaná úseèka je pøedstavována vektorem
            ; (vektorem je v tomto kontextu my¹lena datová
            ; struktura programovacího jazyka Scheme)
            (segment (make-vector 4 ))

            ; úhly zvìt¹ující se pro ka¾dý dal¹í vykreslený úsek
            (alfa 0)
            (beta 0)

            ; konstanta - 2xPi
            (full-circle (* 3.1415927 2))

            ; poèet vykreslených segmentù
            (step (/ full-circle vertexes-per-spin))

            ; úprava hodnoty zadané u¾ivatelem
            (spins (+ selected-spins 1))

            ; vzdálenost vykreslovaného úseku od støedu spirály
            (radius start-radius)
            (old-radius radius)

            ; zmìna vzdálenosti pro ka¾dý dal¹í úsek
            (radius-delta (/ (- end-radius start-radius) (* vertexes-per-spin spins 1)))
        )
        (gimp-undo-push-group-start selected-image)

        ; programová smyèka, v ní¾ se vykreslí úseèkové segmenty
        ; ze kterých se skládá aproximace spirály
        (while (&lt;= alfa (* full-circle spins 1))
            (set! beta (+ alfa step))
            (set! radius (+ radius radius-delta))
            ; vypoèet poèáteèní a koncové souøadice úseèky
            (vector-set! segment 0 (coord center-x old-radius cos alfa start-angle) )
            (vector-set! segment 1 (coord center-y old-radius sin alfa start-angle) )
            (vector-set! segment 2 (coord center-x radius cos beta start-angle) )
            (vector-set! segment 3 (coord center-y radius sin beta start-angle) )

            ; vykreslení úseèky ¹tìtcem
            (gimp-paintbrush selected-layer 100 npoint segment 0 10)

            ; pøinutíme GIMP, aby obrázek prùbì¾nì vykresloval
            (gimp-displays-flush)
            ; pøechod na dal¹í úsek
            (set! alfa beta)
            (set! old-radius radius)
        )
        ; ulo¾íme stav obrázku na zásobník
        (gimp-undo-push-group-end selected-image) 
    )
    ; naposledy pøinutíme GIMP, aby finální obrázek vykreslil
    (gimp-displays-flush)  
)


; základní informace o skriptu a definice dialogu
; zobrazeného u¾ivateli
(script-fu-register "script-fu-spirals-3"
    _"_Spirals-3"
    _"Renders various spirals to current layer"
    "Pavel Tisnovsky"
    "Pavel Tisnovsky"
    "2010-05-11"
    "RGB*, INDEXED*, GRAY*"
    SF-IMAGE       "Image"         0
    SF-DRAWABLE    "Drawable"      0
 
    SF-OPTION     _"Spins"        '(_"1"
                                    _"2"
                                    _"3"
                                    _"4")
    SF-ADJUSTMENT _"X center"     '(200 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Y center"     '(200 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Start radius" '(20  0 999 1 10 0 1)
    SF-ADJUSTMENT _"End radius"   '(180 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Start angle"  '(0 0 359 1 10 0 0)
)

; registrace skriptu do menu
(script-fu-menu-register "script-fu-spirals-3"
                         "&lt;Image&gt;/Root.cz")

; finito
</pre>

<img src="http://i.iinfo.cz/images/573/scheme5-7.png" width="400" height="400" alt=" " />
<p><i>Obrázek 8: Spirála vykreslená pomocí ètvrtého demonstraèního
skriptu.</i></p>



<p><a name="k08"></a></p>
<h2>8. Obsah následující èásti seriálu</h2>

<p>V&nbsp;následující èásti seriálu o programovacím jazyce <i>Scheme</i> se ji¾
budeme zabývat ponìkud praktiètìj¹ími mo¾nostmi skriptù spou¹tìných
v&nbsp;rámci grafického editoru <i>GIMP</i>. Uká¾eme si zpùsob zadávání a zmìny
parametrù kreslicích nástrojù (vèetnì manipulace s&nbsp;barevnými pøechody),
pou¾ití vrstev (hladin) a takté¾ práci s&nbsp;cestami (<i>paths</i>).</p>

<img src="http://i.iinfo.cz/images/573/scheme5-9.png" width="400" height="400" alt=" " />
<p><i>Obrázek 9: Spirály vykreslené pomocí ètvrtého demonstraèního
skriptu.</i></p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>A Script-Fu Tutorial<br />
<a href="http://www.linuxtopia.org/online_books/graphics_tools/gimp_user_manual/en/gimp-using-script-fu-tutorial.html">http://www.linuxtopia.org/online_books/graphics_tools/gimp_user_manual/en/gimp-using-script-fu-tutorial.html</a>
</li>

<li>A Script-Fu Tutorial<br />
<a href="http://docs.gimp.org/en/gimp-using-script-fu-tutorial.html">http://docs.gimp.org/en/gimp-using-script-fu-tutorial.html</a>
</li>

<li>Script-fu Tutorial<br />
<a href="http://www.seul.org/~grumbel/gimp/script-fu/script-fu-tut.html">http://www.seul.org/~grumbel/gimp/script-fu/script-fu-tut.html</a>
</li>

<li>Lambda calculus<br />
<a href="http://en.wikipedia.org/wiki/Lambda_calculus">http://en.wikipedia.org/wiki/Lambda_calculus</a>
</li>

<li>A Short Introduction to the Lambda Calculus<br />
<a href="http://www.cs.bham.ac.uk/~axj/pub/papers/lambda-calculus.pdf">http://www.cs.bham.ac.uk/~axj/pub/papers/lambda-calculus.pdf</a>
</li>

<li>A Tutorial Introduction to the Lambda Calculus<br />
<a href="http://www.inf.fu-berlin.de/lehre/WS03/alpi/lambda.pdf">http://www.inf.fu-berlin.de/lehre/WS03/alpi/lambda.pdf</a>
</li>

<li>(welcome '(schemers . org))<br />
<a href="http://www.schemers.org/">http://www.schemers.org/</a>
</li>

<li>Revised<sup>5</sup> Report on the Algorithmic Language Scheme<br />
<a href="http://www.schemers.org/Documents/Standards/R5RS/">http://www.schemers.org/Documents/Standards/R5RS/</a>
</li>

<li>The Revised<sup>6</sup> Report on the Algorithmic Language Scheme<br />
<a href="http://www.r6rs.org/">http://www.r6rs.org/</a>
</li>

<li>Scheme<br />
<a href="http://groups.csail.mit.edu/mac/projects/scheme/">http://groups.csail.mit.edu/mac/projects/scheme/</a>
</li>

<li>The Kawa language framework<br />
<a href="http://www.gnu.org/software/kawa/">http://www.gnu.org/software/kawa/</a>
</li>

<li>Scheme 48<br />
<a href="http://s48.org/">http://s48.org/</a>
</li>

<li>Introductory textbooks for Schemers<br />
<a href="http://www.schemers.org/Documents/#intro-texts">http://www.schemers.org/Documents/#intro-texts</a>
</li>

<li>Scheme (programming language)<br />
<a href="http://en.wikipedia.org/wiki/Scheme_(programming_language)">http://en.wikipedia.org/wiki/Scheme_(programming_language)</a>
</li>

<li>Scheme<br />
<a href="http://cs.wikipedia.org/wiki/Scheme">http://cs.wikipedia.org/wiki/Scheme</a>
</li>

<li>Scheme-faq<br />
<a href="http://community.schemewiki.org/?scheme-faq">http://community.schemewiki.org/?scheme-faq</a>
</li>

<li>Scheme implementations<br />
<a href="http://community.schemewiki.org/?scheme-faq-standards#implementations">http://community.schemewiki.org/?scheme-faq-standards#implementations</a>
</li>

<li>Successful Scheme<br />
<a href="http://www.itworld.com/swol-1013-regex">http://www.itworld.com/swol-1013-regex</a>
</li>

<li>Guy L. Steele, Jr.<br />
<a href="http://en.wikipedia.org/wiki/Guy_L._Steele">http://en.wikipedia.org/wiki/Guy_L._Steele</a>
</li>

<li>Gerald Jay Sussman<br />
<a href="http://en.wikipedia.org/wiki/Gerald_Jay_Sussman">http://en.wikipedia.org/wiki/Gerald_Jay_Sussman</a>
</li>

<li>PLT Scheme<br />
<a href="http://www.plt-scheme.org/">http://www.plt-scheme.org/</a>
</li>

<li>Quick: An Introduction to PLT Scheme with Pictures<br />
<a href="http://docs.plt-scheme.org/quick/">http://docs.plt-scheme.org/quick/</a>
</li>

<li>PLT Scheme<br />
<a href="http://en.wikipedia.org/wiki/Plt_scheme">http://en.wikipedia.org/wiki/Plt_scheme</a>
</li>

<li>PLT Scheme Guide<br />
<a href="http://docs.plt-scheme.org/guide/">http://docs.plt-scheme.org/guide/</a>
</li>

<li>The DrScheme Project: An Overview<br />
<a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.9543">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.9543</a>
</li>

<li>DrScheme<br />
<a href="http://en.wikipedia.org/wiki/DrScheme">http://en.wikipedia.org/wiki/DrScheme</a>
</li>

<li>How to Design Programs<br />
<a href="http://www.htdp.org/">http://www.htdp.org/</a>
</li>

<li>An Introduction to Scheme<br />
<a href="http://www.acm.org/crossroads/xrds1-2/scheme.html">http://www.acm.org/crossroads/xrds1-2/scheme.html</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

