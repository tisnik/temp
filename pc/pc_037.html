<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Paralelní port a rozhraní Centronics</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Paralelní port a rozhraní Centronics</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dne¹ní èásti seriálu o architekturách poèítaèù si popí¹eme paralelní port. Uká¾eme si jak bì¾né zpùsoby pou¾ití tohoto portu pro komunikaci s tiskárnami a pøenos dat, tak i pøipojení rùzných typù vlastních zaøízení, napøíklad digitálních senzorù, A/D a D/A pøevodníkù èi textových a grafických LCD.</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. Paralelní port a rozhraní Centronics</a><br />
<a href="#k02">2. Historie rozhraní Centronics a paralelního portu na osobních poèítaèích</a><br />
<a href="#k03">3. Uspoøádání konektoru paralelního portu</a><br />
<a href="#k04">4. Elektrické charakteristiky a zpùsob napájení pøipojených zaøízení</a><br />
<a href="#k05">5. Standardní re¾im paralelního portu &ndash; jednosmìrný pøenos dat s&nbsp;handshakingem</a><br />
<a href="#k06">6. Dal¹í zpùsoby vyu¾ití paralelního portu</a><br />
<a href="#k07">7. Programové øízení paralelního portu</a><br />
<a href="#k08">8. Odkazy na Internetu</a><br />
<a href="#k09">9. Obsah dal¹í èásti seriálu</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. Paralelní port a rozhraní Centronics</h1>

<p>V&nbsp;pøedchozí èásti tohoto seriálu jsme si øekli, ¾e externí porty i
sbìrnice je mo¾né rozli¹it mj.&nbsp;i podle toho, zda se pøes nì data pøená¹í
sériovì, tj.&nbsp;bit po bitu, èi paralelnì (po bajtech nebo dokonce slovech
s&nbsp;je¹tì vìt¹í bitovou ¹íøkou). Pøi sériovém pøenosu dat jsou jednotlivé
bajty buï pomocí specializovaného èipu èi programovì rozdìleny na sekvence
bitù, které jsou postupnì pøeneseny sériovým zpùsobem (pro pøenos dat tímto
zpùsobem teoreticky postaèují pouze dva vodièe, popø.&nbsp;jeden vodiè a
spoleèná zem). Naproti tomu u paralelního pøenosu je pou¾ito vìt¹í mno¾ství
vodièù &ndash; nìkteré vodièe jsou rezervovány pro pøenos dat, dal¹í vodièe
jsou pou¾ity k&nbsp;øídicím úèelùm. Typickým zástupcem paralelního pøenosu dat
je <i>paralelní port</i>, který je na osobních poèítaèích také znám pod
zkratkou <i>LPT</i> (<i>Line Print Terminal</i>). Tento port byl od svého
uvedení firmou IBM koncipován tak, aby se k&nbsp;nìmu snadno pøipojovaly
tiskárny s&nbsp;rozhraním <i>Centronics</i>, ov¹em je ho mo¾né pou¾ít i pro
dal¹í úèely, z&nbsp;nich¾ nìkteré si popí¹eme v&nbsp;navazujících
kapitolách.</p>

<image id="7590" original="no" />
<p-center><i>Obrázek 1: Konektory umístìné na zadní stranì základní desky
osobního poèítaèe. Paralelní port je vyveden na konektor s&nbsp;25 kontakty.
Jedná se o rù¾ový konektor vlevo nahoøe, který je oznaèován symbolem
DB25.</i></p-center>

<p>V&nbsp;souèasnosti se døíve zcela standardnì dodávaný a ve své podstatì i
nezbytný paralelní port ji¾ pomalu pøestává pou¾ívat; napøíklad na nejnovìj¹ích
základních deskách urèených pro bì¾né osobní poèítaèe ho u¾ v&nbsp;nìkterých
pøípadech nenajdeme. Z&nbsp;hlediska studia funkce externích portù a sbìrnic je
to tro¹ku ¹koda, proto¾e pøipojení vlastních zaøízení na paralelní port je
zpravidla velmi jednoduché a i zpùsob ovládání paralelního portu (vìt¹inou se
jedná o pøímé ovládání jednotlivých vstupních a výstupních pinù) nepøedstavuje
ani pro zaèínající programátory ¾ádný vìt¹í problém, o èem¾ se budete moci
pøesvìdèit v&nbsp;sedmé kapitole. Stále je v¹ak mo¾né (dnes u¾ opravdu jen pro
úèely &bdquo;bastlení&ldquo; nebo pro pøipojení tiskárny èi skeneru) si
paralelní port poøídit ve formì zásuvné karty urèené pro interní sbìrnici
<i>PCI</i> èi <i>PCI Express</i>. Paralelní porty dostupné na zásuvných kartách
pøiná¹í dokonce nìkolik výhod &ndash; vìt¹inou mají jejich výstupy vìt¹í
proudovou zatí¾itelnost ne¾ uvádí norma a také bývají ve vìt¹inì pøípadù odolné
proti zkratu.</p>

<image id="7591" original="no" />
<p-center><i>Obrázek 2: Universální (prodlu¾ovací) kabel urèený pro pøenos dat
pøes paralelní port. Na jednom konci kabelu je umístìný konektor typu
&bdquo;samice&ldquo; (DB25F), na druhém typu &bdquo;samec&ldquo;
(DB25M).</i></p-center>



<p><a name="k02"></a></p>
<h1>2. Historie rozhraní Centronics a paralelního portu na osobních poèítaèích</h1>

<p>Pøi popisu paralelního portu se nemù¾eme nezmínit i o rozhraní
<i>Centronics</i>, které bylo a¾ do nedávné minulosti pou¾íváno pro pøipojení
prakticky v¹ech tiskáren k&nbsp;osobním poèítaèùm. Vznik rozhraní
<i>Centronics</i> je datován do roku 1970, kdy firma <i>Wang Laboratories</i>,
která se specializovala na výrobu zaøízení pro poøizování textù (jednalo se o
jakýsi hybrid mezi specializovaným poèítaèem a elektronickým psacím strojem),
vyrobila tiskárnu oznaèovanou jako <i>Model 101</i>. O komunikaci s&nbsp;touto
tiskárnou se starala technologie navr¾ená samotným Dr.&nbsp;Wangem, Robertem
Howardem a Prentice Robinsonem. V&nbsp;roce 1971 do¹lo k&nbsp;oddìlení jedné
divize firmy <i>Wang Laboratories</i>; tato divize byla nazvaná <i>Centronics
Corporation</i>. Rozhraní pou¾ité u <i>Modelu 101</i> se postupnì stalo sice
neoficiálním, ale o to více akceptovaným de facto standardem, pøedev¹ím od
chvíle, kdy firma IBM navrhla a pou¾ila paralelní port pro svoji novinku
&ndash; IBM PC. K&nbsp;tomuto portu bylo mo¾né zapojit kabel, který mìl na
jednom konci konektor DB25 a na druhém konci 36 pinový konektor polooficiálnì
nazývaný &bdquo;Centronics&ldquo;.</p>

<image id="7592" />
<p-center><i>Obrázek 3: Nová podoba loga firmy Centronics. Toto logo zaèalo být
pou¾íváno a¾ okolo roku 1986.</i></p-center>

<p>Zatímco v&nbsp;sedmdesátých letech minulého století byla divize
<i>Centronics Corporation</i> na trhu s&nbsp;tiskárnami velmi úspì¹ná
(pøedev¹ím se to týkalo návrhu nových modelù, samotná výroba byla pozdìji
pøesunuta mimo USA), v&nbsp;osmdesátých letech zaèaly tomuto segmentu dominovat
jiné firmy, zejména <i>Epson</i> a <i>Brothers</i>. V&nbsp;roce 1987 byla
divize <i>Centronics Corporation</i> prodána, nìkolikrát zmìnila majitele i
jméno, vyhrála nìkolik soudních sporù, dal¹í zase prohrála a následnì prakticky
zmizela z&nbsp;trhu s&nbsp;tiskárnami &ndash; pùvodní oznaèení rozhraní se v¹ak
pou¾ívá dodnes. Samotná mateøská firma <i>Wang Laboratories</i> mìla velké
problémy se svými novými produkty, pøedev¹ím po nástupu universálních domácích
a osobních poèítaèù, které se ukázaly být mnohem úspì¹nìj¹ími, ne¾
specializované pøístroje na poøizování textù. S&nbsp;trochou nadsázky je mo¾né
øíci, ¾e nepøizpùsobivý dinosaurus Wang Laboratories byl pøekonán mladým a
dravým WordPerfectem, který se &ndash; po celé dekádì prakticky
bezkonkurenèního panování na trhu s&nbsp;textovými procesory &ndash; sám stal
dinosaurem a podlehl firmì Microsoft s&nbsp;jejím balíkem Microsoft Office.</p>

<image id="7593" original="no" />
<p-center><i>Obrázek 4: Nahoøe: konektor rozhraní Centronics, dole: konektor
paralelního portu.</i></p-center>

<p>Konektor &bdquo;rozhraní Centronics&ldquo; je mo¾né doposud nalézt na mnoha
tiskárnách a dal¹ích podobných zaøízeních (jedná se o nìkteré rastrové plottery
apod.) &ndash; jeho tvar se v&nbsp;mnohém odli¹uje od ostatních konektorù
pou¾ívaných v&nbsp;souèasné výpoèetní technice. Pro tento konektor jsou typické
zejména dva drátové èi plastové &bdquo;zámky&ldquo;, kterými je mo¾né konektor
bezpeènì k&nbsp;tiskárnì pøipevnit bez nutnosti pou¾ití ¹roubkù (takto velký
konektor s&nbsp;tì¾kým a neohebným kabelem podobné masivní zámky skuteènì
potøebuje, na rozdíl od napøíklad stomegabitového <i>Ethernetu</i> èi
universální sériové sbìrnice <i>USB</i> &ndash; u¾ nìkolikrát jsem u známých
opravil &bdquo;vadnou&ldquo; tiskárnu tak, ¾e jsem dotlaèil napolo vysunutý
kabel <i>Centronics</i>). Mnoho výkonnìj¹ích tiskáren (urèených spí¹e do
vìt¹ích kanceláøí ne¾ domácností) stále obsahuje hned nìkolik mo¾ností
pøipojení k&nbsp;poèítaèi &ndash; pøes rozhraní <i>Centronics</i> (na stranì
poèítaèe se jedná o paralelní port, popø.&nbsp;o redukci z&nbsp;<i>USB</i>),
pøes externí sbìrnici <i>USB</i> èi pøes <i>Ethernet</i>.</p>



<p><a name="k03"></a></p>
<h1>3. Uspoøádání konektoru paralelního portu</h1>

<p>Standardní paralelní port pou¾ívá konektor s&nbsp;dvaceti pìti piny
uspoøádanými do dvou øad (13+12), který je oznaèován jako <i>DB25</i>
(&bdquo;samec&ldquo; nese znaèení <i>DB25M</i>, &bdquo;samice&ldquo;
<i>DB25F</i>). Význam jednotlivých pinù tohoto konektoru je vyobrazen na pátém
obrázku. Z&nbsp;tohoto obrázku je patrné, ¾e v¹echny piny (a jim odpovídající
signály) je mo¾né rozdìlit do ètyø skupin. V&nbsp;první skupinì se nachází osm
datových vodièù, pomocí nich¾ se posílají vlastní data &ndash; poèet osm zde
samozøejmì není náhodný, odpovídá jednomu bajtu (pùvodnì jednomu znaku èi
øídicímu kódu poslanému na tiskárnu). Dále na portu mù¾eme nalézt ètyøi øídicí
vodièe, pomocí nich¾ mù¾e poèítaè øídit ve¹kerou komunikaci se zaøízením. Tøetí
skupinu tvoøí pìt stavových vodièù, kterými naopak zaøízení (typicky tiskárna)
posílá poèítaèi zpìt informaci o svém stavu, pøipravenost pro pøíjem dal¹ího
bajtu (znaku) atd. Pøes ètvrtou skupinu pinù se pøipojují zemící vodièe
(<i>Ground, GND</i>) &ndash; propojovací kabely bývají konstruovány tak, aby
ka¾dému datovému vodièi odpovídal jeden vodiè zemící.</p>

<image id="7594" />
<p-center><i>Obrázek 5: Význam jednotlivých pinù konektoru DB25 a jejich
propojení s&nbsp;registry portu (registry mù¾e èíst a zapisovat mikroprocesor).
Rù¾ovou barvou je oznaèeno osm datových pinù, barvou modrou øídicí signály (ve
standardním re¾imu je ovládá poèítaè), barvou zelenou piny pro stavové signály
(ve standardním re¾imu tyto signály poèítaè mù¾e pouze èíst, nastavuje je
zaøízení &ndash; tiskárna) a barvou èernou piny urèené pro pøipojení zemicích
vodièù (GND). Pozor &ndash; nìkteré registry mají na tomto obrázku otoèené
poøadí bitù (zaèíná se LSB)!</i></p-center>

<p>Jména a významy v¹ech pinù (oèíslovaných, jak je zvykem, od 1 do 25) je
uveden v&nbsp;následující tabulce. U datových pinù je sice naznaèen obousmìrný
pøenos dat, ov¹em u pùvodního portu byl mo¾ný pouze pøenos smìrem od poèítaèe
k&nbsp;zaøízení (to v&nbsp;tabulce odpovídá smìru <i>Out</i>). Význam v¹ech tøí
uvedených registrù (<i>Data</i>, <i>Control</i>, <i>Status</i>), za jejich¾
jmény je uvedena váha bitu, bude vysvìtlen dále:</p>

<table>
<tr><th>Pin</th><th>Jméno signálu  </th><th>Smìr pøenosu</th><th>Registr</th><th>Invertovaný bit?</th></tr>
<tr><td>1  </td><td>nStrobe        </td><td>Out    </td><td>Control-0</td><td>ano</td></tr>
<tr><td>2  </td><td>Data0          </td><td>In/Out </td><td>Data-0   </td><td>ne </td></tr>
<tr><td>3  </td><td>Data1          </td><td>In/Out </td><td>Data-1   </td><td>ne </td></tr>
<tr><td>4  </td><td>Data2          </td><td>In/Out </td><td>Data-2   </td><td>ne </td></tr>
<tr><td>5  </td><td>Data3          </td><td>In/Out </td><td>Data-3   </td><td>ne </td></tr>
<tr><td>6  </td><td>Data4          </td><td>In/Out </td><td>Data-4   </td><td>ne </td></tr>
<tr><td>7  </td><td>Data5          </td><td>In/Out </td><td>Data-5   </td><td>ne </td></tr>
<tr><td>8  </td><td>Data6          </td><td>In/Out </td><td>Data-6   </td><td>ne </td></tr>
<tr><td>9  </td><td>Data7          </td><td>In/Out </td><td>Data-7   </td><td>ne </td></tr>
<tr><td>10 </td><td>nAck           </td><td>In     </td><td>Status-6 </td><td>ne </td></tr>
<tr><td>11 </td><td>Busy           </td><td>In     </td><td>Status-7 </td><td>ano</td></tr>
<tr><td>12 </td><td>Paper-Out      </td><td>In     </td><td>Status-5 </td><td>ne </td></tr>
<tr><td>13 </td><td>Select         </td><td>In     </td><td>Status-4 </td><td>ne </td></tr>
<tr><td>14 </td><td>Linefeed       </td><td>Out    </td><td>Control-1</td><td>ano</td></tr>
<tr><td>15 </td><td>nError         </td><td>In     </td><td>Status-3 </td><td>ne </td></tr>
<tr><td>16 </td><td>nInitialize    </td><td>Out    </td><td>Control-2</td><td>ne </td></tr>
<tr><td>17 </td><td>nSelect-Printer</td><td>Out    </td><td>Control-3</td><td>ano</td></tr>
<tr><td>18 </td><td>Ground         </td><td>&times;</td><td>&times;  </td><td>&times;</td></tr>
<tr><td>19 </td><td>Ground         </td><td>&times;</td><td>&times;  </td><td>&times;</td></tr>
<tr><td>20 </td><td>Ground         </td><td>&times;</td><td>&times;  </td><td>&times;</td></tr>
<tr><td>21 </td><td>Ground         </td><td>&times;</td><td>&times;  </td><td>&times;</td></tr>
<tr><td>22 </td><td>Ground         </td><td>&times;</td><td>&times;  </td><td>&times;</td></tr>
<tr><td>23 </td><td>Ground         </td><td>&times;</td><td>&times;  </td><td>&times;</td></tr>
<tr><td>24 </td><td>Ground         </td><td>&times;</td><td>&times;  </td><td>&times;</td></tr>
<tr><td>25 </td><td>Ground         </td><td>&times;</td><td>&times;  </td><td>&times;</td></tr>
</table>

<image id="7595" original="no" />
<p-center><i>Obrázek 6: Základní deska star¹ího typu (AT s&nbsp;volitelným ATX
napájením), která má paralelní port vyveden nikoli pøímo na externí konektor,
ale na skupinu pinù, které jsou s&nbsp;konektorem propojeny krátkým kabelem. Na
tomto obrázku jsou piny pro pøipojení paralelního portu oznaèeny zelenì, modøe
jsou orámovány piny pro dvojici sériových portù a èervenì piny pro gameport
(sem se pøipojuje joystick èi MIDI).</i></p-center>



<p><a name="k04"></a></p>
<h1>4. Elektrické charakteristiky a zpùsob napájení pøipojených zaøízení</h1>

<p>Vstupní i výstupní signály paralelního portu (a samozøejmì i rozhraní
<i>Centronics</i>) jsou v&nbsp;dostateèné míøe kompatibilní s&nbsp;TTL logikou,
i kdy¾ samotné èipy, které port øídí, ji¾ v&nbsp;souèasnosti nejsou v&nbsp;TTL
technologii vyrábìny. Logická jednièka odpovídá signálu o napìtí vìt¹ím ne¾ 2,4
V, logická nula je pøedstavována signálem s&nbsp;napìtím men¹ím ne¾ cca 0,4 V.
Pùvodní paralelní port mìl pomìrnì malou zatí¾itelnost datových výstupù: pøi
nastavení logické jednièky se mohl odebírat proud maximálnì 2,6 mA (nìkteré
èipy dokonce zaruèovaly pouze 2 mA), pøi nastavení logické nuly mohl vstupem
protékat proud a¾ 24 mA. Zatí¾itelnost øídicích výstupù byla je¹tì men¹í, cca 1
mA. V&nbsp;praxi to znamenalo, ¾e se na paralelní port vìt¹inou nedaly bezpeènì
pøipojit v&nbsp;té dobì bì¾né LED, musely se pou¾ít buï jednoduché
jednotranzistorové (invertující) zesilovaèe nebo logické invertory
s&nbsp;velkou zatí¾itelností (ostatnì zapojení invertorù èi záchytných registrù
na paralelní port bylo vcelku rozumné opatøení vedoucí k&nbsp;ochranì
paralelního portu pøed jeho znièením pøi &bdquo;bastlení&ldquo;).</p>

<image id="7596" />
<p-center><i>Obrázek 7: V&nbsp;pøípadì, ¾e konektor pro paralelní port není na
základní desce vyveden nebo je zapotøebí pou¾ít portù více (napøíklad pro
pøipojení mìøicích pøístrojù, skeneru nebo druhé tiskárny), lze do poèítaèe
pøidat roz¹iøující kartu. Karta zobrazená na ¹estém obrázku roz¹iøuje externí
rozhraní poèítaèe hned o dva paralelní porty &ndash; první konektor je umístìn
pøímo na kartì, druhý na &bdquo;èelíèku&ldquo; pøipojenému ke kartì pomocí
kabelu.</i></p-center>

<p>Pov¹imnìte si, ¾e na paralelní port není vyvedeno ¾ádné napájecí napìtí.
Vìt¹ina zaøízení pro svoji èinnost vy¾aduje napájení alespoò 5 V (jedná se
napøíklad o rùzné mikroøadièe, aktivní A/D a D/A pøevodníky, záchytné registry
atd.), to v¹ak na samotném paralelním portu nenajdeme (nutno øíci, ¾e nìkdy je
5 V vyvedeno na výstup <strong>nSelect-Printer</strong> (pull-up), av¹ak ne
v¾dy se na to dá spolehnout). Z&nbsp;tohoto dùvodu bývají zaøízení pøipojená na
paralelní port vybavena buï vlastním zdrojem nebo nábojovou pumpou (napøíklad
se jedná o nìkteré mobilní programátory pamìtí). U zaøízení vyrábìných pro
vlastní potøebu je také mo¾né vyu¾ít malého triku &ndash; napìtí 5 V lze získat
z&nbsp;joystickového portu (popí¹eme si ho nìkdy pøí¹tì), popø.&nbsp;lze získat
napìtí a¾ 12 V z&nbsp;portu sériového, i kdy¾ s&nbsp;ponìkud vy¹¹ím rizikem
(napøíklad u nìkterých notebookù je skuteèné napìtí pøivedené na piny sériového
portu ni¾¹í). Potí¾ s&nbsp;neexistencí napájecího napìtí se zaruèenou proudovou
zátì¾í byl uspokojivì vyøe¹en a¾ u sériové universální sbìrnice <i>USB</i>.</p>

<image id="7597" />
<p-center><i>Obrázek 8: Obì varianty konektorù paralelního portu &ndash; DB25F
i DB25M.</i></p-center>



<p><a name="k05"></a></p>
<h1>5. Standardní re¾im paralelního portu &ndash; jednosmìrný pøenos dat s&nbsp;handshakingem</h1>

<p>Nyní se koneènì dostáváme k&nbsp;popisu komunikace poèítaèe s&nbsp;nìjakým
zaøízením pøipojeným na paralelní port. Nejdøíve se zamìøíme na vysvìtlení,
jakým zpùsobem poèítaè posílá data na tiskárnu, která je vybavena standardním
rozhraním <i>Centronics</i>. Na devátém obrázku je zobrazeno schéma propojení
paralelního portu s&nbsp;konektorem <i>DB-25</i> s&nbsp;rozhraním
<i>Centronics</i>, které pou¾ívá konektor s&nbsp;36 piny. Ze schématu je
patrné, ¾e i kdy¾ jsou oba konektory konstrukènì zcela odli¹né a mají i
rozdílný poèet pinù, je propojení realizováno bez nutnosti pou¾ití slo¾itìj¹í
øídicí logiky, i napì»ové úrovnì jsou vzájemnì sluèitelné. Také mù¾eme vidìt,
¾e jsou vyu¾ity v¹echny piny paralelního portu. Pøes vodièe DATA 0 a¾ DATA 7 se
do tiskárny pøená¹í kódy jednotlivých znakù, které se mají tisknout, i øídicích
kódù (pøesun na nový øádek, pøesun na tabelaèní zará¾ku, pøechod na novou
stránku). Samotný význam posílaných znakù se li¹í podle toho, zda tiskárna
pracuje v&nbsp;re¾imu kompatibility s&nbsp;tiskárnami <i>Epson</i>, akceptuje
jazyk <i>PostScript</i>, <i>HP-GL</i>, surová bitmapová data atd. Dal¹í signály
mají následující význam:</p>

<table>
<tr><th>Pin</th><th>Jméno signálu  </th><th>Význam</th></tr>
<tr><td>1  </td><td>nStrobe        </td><td>inverzní puls o délce 500ns tiskárnì potvrzuje, ¾e na datových pinech jsou platná data</td></tr>
<tr><td>10 </td><td>nAck           </td><td>inverzním pulsem o délce cca 8ms tiskárna potvrdí, ¾e data pøijala, napojeno na pøeru¹ení</td></tr>
<tr><td>11 </td><td>Busy           </td><td>tento signál má úroveò logické jednièky po dobu pøenosu dat</td></tr>
<tr><td>12 </td><td>Paper-Out      </td><td>tímto signálem tiskárna posílá informaci o tom, ¾e nemá papír</td></tr>
<tr><td>13 </td><td>Select         </td><td>signál je nastaven na logickou jednièku, pokud je tiskárna pøipojena</td></tr>
<tr><td>14 </td><td>Linefeed       </td><td>rozli¹ení, zda poèítaè bude pro odøádkování posílat dvojici znakù CR a LF</td></tr>
<tr><td>15 </td><td>nError         </td><td>tímto signálem tiskárna posílá informaci o chybì (jakákoli chyba kromì do¹lého papíru)</td></tr>
<tr><td>16 </td><td>nInitialize    </td><td>inicializace tiskárny (reset)</td></tr>
<tr><td>17 </td><td>nSelect-Printer</td><td>výbìr tiskárny (signál je invertovaný, reaguje se na nulovou úroveò)</td></tr>
</table>

<image id="7598" />
<p-center><i>Obrázek 9: Propojení paralelního portu s&nbsp;konektorem Centronics.</i></p-center>

<p>Samotný pøenos dat je realizován zpùsobem, pro nìj¾ se v¾il termín
<i>handshaking</i> (&bdquo;potøásání rukou&ldquo;), který je zalo¾en na øízení
pøenosu poèítaèem, ov¹em s&nbsp;tím, ¾e tiskárna si sama podle své rychlosti
urèuje, kdy mù¾e pøijmout dal¹í znak. Pøedpokládejme, ¾e ji¾ pøed pøenosem dat
do¹lo k&nbsp;inicializaci tiskárny pomocí signálù <strong>nInitialize</strong>
a <strong>nSelect-Printer</strong>. Jeden znak èi bajt je pøenesen následující
sekvencí signálù:</p>

<ol>

<li>Poèítaè nejdøíve na datové vodièe po¹le v¹ech osm bitù a chvíli poèká na
ustálení úrovní.</li>

<li>Inverzním pulsem o délce cca 500ns na vodièi <strong>nStrobe</strong>
poèítaè tiskárnì signalizuje, ¾e data na datových vodièích jsou platná a
tiskárna mù¾e zahájit jejich ètení.</li>

<li>Tiskárna zaène data naèítat, co¾ zpìtnì poèítaèi signalizuje tak, ¾e
nastaví hodnotu na vodièi <strong>Busy</strong> do úrovnì logické jednièky. Èas
naèítání dat mù¾e být pomìrnì dlouhý v&nbsp;závislosti na kapacitì bufferu
tiskárny, rychlosti tisku apod.</li>

<li>Po pøeètení bajtu tiskárna nastaví na vodièi <strong>Busy</strong> logickou
nulu a zhruba ve stejné chvíli (èasování se mù¾e ponìkud li¹it) vy¹le na vodiè
<strong>nAck</strong> inverzní puls o délce cca 8ms &ndash; tím je pøenos bajtu
potvrzen a poèítaè mù¾e pokraèovat v&nbsp;zápisu dal¹ího bajtu. Zmìna logické
úrovnì na vodièi <strong>nAck</strong> se mù¾e projevit vyvoláním
pøeru¹ení.</li>

</ol>

<image id="7599" />
<p-center><i>Obrázek 10: Základní re¾im pøenosu dat po paralelním portu, který
je kompatibilní s&nbsp;rozhraním Centronics.</i></p-center>



<p><a name="k06"></a></p>
<h1>6. Dal¹í zpùsoby vyu¾ití paralelního portu</h1>

<p>Vý¹e popsaný zpùsob pøenosu dat vyhovuje pøedev¹ím potøebám tìch zaøízení,
které musí rozpoznávat jednotlivé znaky èi bajty, pøièem¾ je nutné rychlost
pøenosu dat adaptivnì mìnit. Je mo¾né ho pou¾ít napøíklad pro ovládání
znakového èi rastrového LCD, proto¾e rozhraní tìchto (pro mnoho aplikací velmi
u¾iteèných) displejù bývá pro paralelní pøenos dat uzpùsobeno. Na jedenáctém
obrázku je zobrazen velmi jednoduchý prototyp LCD ovládaného pøes paralelní
port. V¹imnìte si, ¾e vzhledem k&nbsp;neexistenci vyvedeného napájecího napìtí
na paralelním portu bylo nutné pou¾ít externí napájecí zdroj, zde konkrétnì
devítivoltovou baterii, její¾ napìtí se sni¾uje na po¾adovanou hodnotu pøes
odporový dìliè. Programové rozhraní podobných jedno a¾ ètyøøádkových LCD je
pomìrnì jednoduché &ndash; pomocí øídicích kódù posílaných po jednotlivých
bajtech je mo¾né celý displej smazat, vypisovat na nìj jednotlivé znaky, mazat
znaky a pohybovat kurzorem doleva a doprava.</p>

<image id="7600" />
<p-center><i>Obrázek 11: Ovládání dvouøádkového LCD pøes paralelní port.</i></p-center>

<p>V&nbsp;nìkterých pøípadech v¹ak není nutné rozeznávat jednotlivé bajty
posílané na paralelní port jako samostatné entity, ale je mo¾né pova¾ovat
hodnoty na datových vodièích za v&nbsp;èase promìnný digitální signál.
Pøíkladem mù¾e být napøíklad &bdquo;zvuková karta&ldquo;, která je známá pod
oznaèením <i>Covox</i>. Ve skuteènosti se o ¾ádnou kartu nejedná, jde o velmi
jednoduchý osmibitový digitálnì-analogový pøevodník (A/D) realizovaný vìt¹inou
pomocí sady rezistorù pøipojených na datové piny paralelního portu &ndash; viz
obrázek 12. Jsou mo¾né i dal¹í zpùsoby zapojení, napøíklad se pou¾ijí rezistory
stejné hodnoty, které jsou zapojeny v¾dy mezi dvojici sousedních datových pinù,
lze pou¾ít ji¾ hotový A/D pøevodník atd.</p>

<image id="7601" />
<p-center><i>Obrázek 12: V&nbsp;minulosti velmi populární &bdquo;zvuková
karta&ldquo; Covox.</i></p-center>

<p>Princip práce <i>Covoxu</i> je velmi jednoduchý &ndash; digitální zvukový
signál pøivedený na datové piny je pøeveden na signál analogový (na rezistoru
R9 se seètou proudy odpovídající vahám a konkrétním hodnotám jednotlivých bitù;
proudu protékajícím tímto rezistorem samozøejmì odpovídá i napìtí na jeho
no¾kách) a na výstupu dostaneme pomìrnì kvalitní analogový signál pøipojitelný
do zesilovaèe. V&nbsp;dobách poèítaèù s&nbsp;procesory 286, kdy i ta
nejjednodu¹¹í zvuková karta stála nìkolik tisíc, se jednalo o schùdné øe¹ení,
ostatnì <i>Covox</i> byl podporovaný i v&nbsp;nìkterých hrách a pøehrávaèích
(na druhou stranu u mé 286 jsem po zesílení signálu z&nbsp;<i>Covoxu</i> sly¹el
i rozbíhání pevného disku, ru¹ení mohlo být velké a audiofilové by
z&nbsp;osmibitového zvuku také nebyli pøíli¹ nad¹eni). Existuje i stereo verze
zalo¾ená na dvojici A/D pøevodníkù doplnìných o záchytné registry, jejich¾
vstupy jsou pøepínané nìkterým z&nbsp;øídicích vodièù. Vzorkovací frekvence
mù¾e být vysoká, není problém dosáhnout obvyklých hodnot 44,1 èi 48 kHz.</p>



<p><a name="k07"></a></p>
<h1>7. Programové øízení paralelního portu</h1>

<p>Programové øízení paralelního portu je pomìrnì snadné a pøímoèaré. Port je
ovládán pomocí trojice osmibitových registrù, které jsou mapovány do I/O
oblasti procesoru. Ve standardním re¾imu je stavový registr urèený pouze pro
ètení (jeho obsah reflektuje logickou úroveò na pinech, které ovládá tiskárna)
a øídicí registr je naopak urèen pouze pro zápis. Jakýkoli zápis na datový èi
øídicí registr vede k&nbsp;tomu, ¾e se pøíslu¹né hodnoty objeví na pinech
portu. V&nbsp;závislosti na tom, o který port se jedná (v&nbsp;poèítaèi je
mo¾né mít paralelních portù více), se pou¾ívají následující adresy v&nbsp;I/O
oblasti:</p>

<table>
<tr><th>Registr</th><th>LPT1</th><th>LPT2</th></tr>
<tr><td>datový registr </td><td>0x378</td><td>0x278</td></tr>
<tr><td>stavový registr</td><td>0x379</td><td>0x279</td></tr>
<tr><td>øídicí registr </td><td>0x37a</td><td>0x27a</td></tr>
</table>

<image id="7602" />
<p-center><i>Obrázek 13: Vztah mezi piny paralelního portu a tøemi I/O
adresami, kterými se port øídí.</i></p-center>

<p>Pod MS-DOSem, Windows 95 èi Windows 98 je mo¾né s&nbsp;paralelním portem
pracovat pøímo pomocí instrukcí mikroprocesoru <strong>in</strong> a
<strong>out</strong> (v&nbsp;Céèku se jedná o funkce èi makra
<strong>inb()</strong> a <strong>outb()</strong>). V&nbsp;operaèním systému
Windows NT, Windows 2000 nebo Windows XP je nutné pro ovládání vlastního
zaøízení pou¾ít ovladaè bì¾ící v&nbsp;ringu 0, který bude vhodným zpùsobem
komunikovat s&nbsp;ovládací aplikací v&nbsp;u¾ivatelském prostoru. Tvorba
ovladaèe je pomìrnì slo¾itá (hotové ovladaèe jsou naproti tomu drahé). Pokud
pøipojené zaøízení komunikuje s&nbsp;poèítaèem stejným zpùsobem jako tiskárna
(viz pátá kapitola), je mo¾né si práci ulehèit a pou¾ít ovladaè generické
tiskárny (<i>Generic Printer</i>) a na ni posílat z&nbsp;u¾ivatelského prostoru
data (znaky, øetìzce) pomocí bì¾ných funkcí WinAPI.</p>

<p>Ètenáøe tohoto èlánku v¹ak pravdìpodobnì bude zajímat práce
s&nbsp;paralelním portem v&nbsp;Linuxu. Port je mo¾né ovládat i
z&nbsp;u¾ivatelského prostoru bez nutnosti psát si driver, ov¹em pouze
v&nbsp;pøípadì, ¾e daný program bude spou¹tìn pod rootem nebo bude mít pøi
spu¹tìní práva roota. Existuje je¹tì jedno omezení pro paralelní port ovládaný
z&nbsp;u¾ivatelského programu &ndash; nelze pou¾ít DMA (to si popí¹eme pøí¹tì)
ani pøeru¹ení, tak¾e komunikace musí probíhat v&nbsp;aktivním re¾imu
(s&nbsp;pøípadnými èekacími smyèkami).</p>

<p>První zpùsob ovládání spoèívá ve vyu¾ití funkcí deklarovaných
v&nbsp;hlavièkovém souboru <strong>asm/io.h</strong> (popø. pou¾ijte soubor
<strong>sys/io.h</strong>). Pøedev¹ím se jedná o funkci <strong>ioperm(from,
num, turn_on)</strong>, pomocí které si lze vynutit pøístup k&nbsp;I/O adresám
od hodnoty <i>from</i> (zde by se pou¾ila napøíklad adresa 0x378). Poèet
zpøístupnìných adres je dán hodnotou <i>num</i> (nám postaèují tøi za sebou
jdoucí adresy), parametrem <i>turn_on</i> se specifikuje, zda o pøístup k I/O
adresám ¾ádáme (hodnota odli¹ná od nuly) èi naopak daný rozsah I/O adres
uvolòujeme pro dal¹í aplikaci (nulová hodnota). Po získání pøístupu
k&nbsp;danému rozsahu I/O adres je mo¾né pou¾ít tyto funkce a makra
(v&nbsp;pøípadì paralelního portu bych doporuèil jen pøístup po bajtech):</p>

<code-area>
inb(adresa)
outb(osmibitová_hodnota, adresa) - pozor, parametry jsou oproti oèekávání otoèeny
inw(¹estnáctibitová_hodnota)
outw(hodnota, adresa)
inb_p(), outb_p(), inw_p(), and outw_p() - makra s krátkým èekáním (navíc se provádí ètení z portu 0x80, co¾ procesor nepatrnì zdr¾í)
</code-area>

<p>Druhý zpùsob práce s&nbsp;portem spoèívá v&nbsp;otevøení zaøízení
<i>dev/port</i> funkcí <strong>open()</strong>, provedení
<strong>fseek()</strong> na pøíslu¹nou I/O adresu (0x378 apod.)
s&nbsp;následným voláním klasických funkcí <strong>read()</strong> a
<strong>write()</strong>. Tento zpùsob je ponìkud pomalej¹í a navíc vy¾aduje
rootovská práva pro pøístup k&nbsp;zaøízení <i>/dev/port</i>. Tato práva je
velmi nebezpeèné nìkomu pøidìlit, proto¾e pøes I/O adresy je mo¾né ovládat
napøíklad sí»ové karty, øadièe pevných diskù atd., co¾ samozøejmì pøedstavuje
velké bezpeènostní riziko.</p>

<p>Tøetí zpùsob lze vyu¾ít v&nbsp;pøípadì, ¾e zaøízení komunikuje stejným
zpùsobem jako tiskárna (viz pátá kapitola). Zde je situace nejjednodu¹¹í
&ndash; skuteènì se budeme k&nbsp;zaøízení chovat jako k&nbsp;bì¾né tiskárnì a
ovládat ho tedy pomocí bì¾ných vstupnì-výstupních operací z&nbsp;prakticky
jakéhokoli jazyka èi aplikace. Jen je nutné dát pozor na to, aby port nebyl
nastaven do re¾imu ECP èi EPP, v&nbsp;tom pøípadì je toti¾ pøenosový protokol
odli¹ný od standardního protokolu popsaného v&nbsp;páté kapitole.</p>



<p><a name="k08"></a></p>
<h1>8. Odkazy na Internetu</h1>

<ol>

<li>Linux I/O port programming mini-HOWTO<br />
<a href="http://www.faqs.org/docs/Linux-mini/IO-Port-Programming.html">http://www.faqs.org/docs/Linux-mini/IO-Port-Programming.html</a></li>

<li>A tutorial on Parallel port Interfacing<br />
<a href="http://logix4u.net/Legacy_Ports/Parallel_Port/A_tutorial_on_Parallel_port_Interfacing.html">http://logix4u.net/Legacy_Ports/Parallel_Port/A_tutorial_on_Parallel_port_Interfacing.html</a></li>

<li>Introduction to the IEEE 1284-1994 Standard<br />
<a href="http://www.fapo.com/1284int.htm">http://www.fapo.com/1284int.htm</a></li>

<li>IEEE 1284<br />
<a href="http://en.wikipedia.org/wiki/IEEE_1284">http://en.wikipedia.org/wiki/IEEE_1284</a></li>

<li>Parallel port<br />
<a href="http://en.wikipedia.org/wiki/Parallel_port">http://en.wikipedia.org/wiki/Parallel_port</a></li>

<li>Interfacing the Standard Parallel Port<br />
<a href="http://www.beyondlogic.org/spp/parallel.htm">http://www.beyondlogic.org/spp/parallel.htm</a></li>

<li>LPT Line Print Terminal<br />
<a href="http://en.wikipedia.org/wiki/LPT">http://en.wikipedia.org/wiki/LPT</a></li>

<li>IEEE Standard 1284<br />
<a href="http://www.undocprint.org/formats/communication_protocols/ieee_1284">http://www.undocprint.org/formats/communication_protocols/ieee_1284</a></li>

<li>Jan's Parallel Port FAQ: Answers to some frequently asked questions about the PC's parallel port<br />
<a href="http://www.lvr.com/jansfaq.htm">http://www.lvr.com/jansfaq.htm</a></li>

<li>Powering devices from PC parallel port<br />
<a href="http://www.epanorama.net/circuits/lptpower.html">http://www.epanorama.net/circuits/lptpower.html</a></li>

</ol>



<p><a name="k09"></a></p>
<h1>9. Obsah dal¹í èásti seriálu</h1>

<p>V&nbsp;následující èásti seriálu o architekturách poèítaèù dokonèíme popis
práce s&nbsp;paralelním portem. Øekneme si, jakým zpùsobem je mo¾né paralelní
port pou¾ít pro obousmìrný pøenos dat (data lze pøená¹et buï po ètyøech bitech
nebo dokonce po celých bajtech, v&nbsp;tomto pøípadì je v¹ak nutné vyu¾ít
roz¹íøenou variantu paralelního portu) a jakou technologií jsou øe¹ené
paralelní porty <i>ECP</i> a <i>EPP</i>. Kromì toho si také popí¹eme sériový
port (<i>RS-232C</i>), který byl pùvodnì koncipován pro pøipojení terminálu
k&nbsp;modemu, posléze se v¹ak pùsobnost jeho nasazení dosti roz¹íøila &ndash;
na sériový port se pøipojovala svìtelná pera, my¹i, perové i øezací plottery,
vysokorychlostní modemy, propojovaly se s&nbsp;ním poèítaèe apod. Tento typ
portu je také podporován v&nbsp;mnoha dal¹ích zaøízeních, napøíklad se pomocí
nìho mohou programovat regulátory motorù, nastavují se pøes nìj aktivní sí»ové
prvky (Cisco), mnohé servery stále podporují terminály pøipojené
k&nbsp;sériovým portùm (i populární <i>Putty</i> tuto mo¾nost obsahuje!) atd.
Není tedy divu, ¾e nìkteré desktopy i notebooky tento port stále obsahují a pro
ty poèítaèe, které ho ji¾ nemají v&nbsp;základní výbavì, je mo¾né dokoupit
konvertor mezi USB a RS-232C èi PCMCIA a RS-232C.</p>

<image id="7603" />
<p-center><i>Obrázek 14: Konvertor mezi USB a RS-232C (ve vìt¹ím konektoru je
umístìn èip zaji¹»ující konverzi dat)</i></p-center>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2008</small></p>
</body>
</html>

