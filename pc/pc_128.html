<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Osmibitové mikroøadièe PIC (2)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Osmibitové mikroøadièe PIC (2)</h1>

<h3>Pavel Ti¹novský</h3>

<h1>Úvodník</h1>

<p>V&nbsp;dne¹ní èásti seriálu o architekturách poèítaèù budeme pokraèovat v&nbsp;popisu mo¾ností osmibitových mikroøadièù PIC vyrábìných firmou Microchip Technology. Zamìøíme se pøedev¹ím na rodinu PIC10 a PIC12, v&nbsp;ní¾ mù¾eme najít velmi malé mikroøadièe, z&nbsp;nich¾ nìkteré jsou umístìny v&nbsp;pouzdru s&nbsp;pouhými ¹esti èi osmi piny. Tyto mikroøadièe lze vyu¾ít napøíklad jako &bdquo;inteligentní&ldquo; èasovaèe, pro øídicí nebo mìøicí úèely, pøípravu èi konverzi dat vyu¾ívanou výkonnìj¹ími mikroøadièi atd.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Rodiny osmibitových mikroøadièù PIC10 a PIC12</a></p>
<p><a href="#k02">2. PIC10F2xx &ndash; pouhá elektronická souèástka nebo plnohodnotný mikroøadiè?</a></p>
<p><a href="#k03">3. Konfigurace pinù mikroøadièù PIC10F2xx</a></p>
<p><a href="#k04">4. Aritmetické a logické instrukce, instrukce pro pøenosy dat</a></p>
<p><a href="#k05">5. Bitové operace a instrukce pracující s&nbsp;osmibitovými konstantami</a></p>
<p><a href="#k06">6. Pamì» programu, skoky, podprogramy a pou¾ití zásobníku</a></p>
<p><a href="#k07">7. Pamì» dat, pøímé a nepøímé adresování pamìti dat</a></p>
<p><a href="#k08">8. Mikroøadièe z&nbsp;rodiny PIC12</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Rodiny osmibitových mikroøadièù PIC10 a PIC12</h2>

<p>V&nbsp;pøedchozí èásti tohoto seriálu jsme si øekli základní informace o
osmibitových mikroøadièích <i>PIC</i> vyrábìných firmou <i>Microchip
Technology</i>. Víme ji¾, ¾e se jedná o mikroøadièe s&nbsp;Harvardskou
architekturou charakteristickou pøedev¹ím oddìlením pamìti programu od pamìti
údajù. Díky této architektuøe a takté¾ díky tomu, ¾e oba typy pamìtí jsou u
vìt¹iny typù mikroøadièù <i>PIC</i> umístìny pøímo na èipu, bylo mo¾né
instrukèní sadu navrhnout takovým zpùsobem, aby délka v¹ech instrukcí byla
konstantní (co¾ zjednodu¹uje návrh programového øadièe) a aby tato délka
nemusela být násobkem osmi bitù, tak jako je tomu u mnoha jiných
mikroøadièových a mikroprocesorových architektur, zejména u tìch architektur,
které vyu¾ívají externí pamì»ové moduly. Nejmen¹í mikroøadièe <i>PIC</i>
pou¾ívají instrukèní sadu se ¹íøkou instrukèního kódu dvanáct bitù, mikroøadièe
spadající do støedního výkonnostního (a samozøejmì i cenového) segmentu mají
instrukce ¹iroké ètrnáct bitù a koneènì nejvýkonnìj¹í øadièe s&nbsp;nejvìt¹ím
mno¾stvím registrù mají instrukèní sadu s&nbsp;instrukcemi, jejich¾ operaèní
kód má ¹íøku ¹estnáct bitù (jak uvidíme dále, ¹íøka instrukcí je z&nbsp;velké
èásti odvozena od kapacity pamìti programu a pamìti údajù).</p>

<img src="http://i.iinfo.cz/images/77/pc12801.png" width="250" height="179" alt=" " />
<p><i>Obrázek 1: Mikroøadiè PIC10F2xx umístìný v&nbsp;pouzdru SOT-23. Celkové
rozmìry tohoto èipu jsou minimální: ¹íøka 2,2mm, délka 2,7mm a vý¹ka
0,9mm.<br />(zdroj: PIC10F200/202/204/206 Data Sheet)</i></p>

<p>Pro ilustraci toho, jak rozdílné technické parametry mohou mít jednotlivé
mikroøadièe <i>PIC</i>, si v&nbsp;následujícím textu popí¹eme dvì rodiny tìchto
mikroøadièù; nejdøíve rodinu <i>PIC10</i> a posléze jeden mikroøadiè
zastupující èipy z&nbsp;rodiny <i>PIC12</i> (o dal¹ích rodinách se zmíníme
pøí¹tì). V&nbsp;rodinì <i>PIC10</i> se nachází nejmen¹í a v&nbsp;mnoha ohledech
i nejménì výkonné typy mikroøadièù <i>PIC</i>. Jedná se o èipy pou¾ívané
vìt¹inou v&nbsp;zaøízeních vyrábìných ve velkých sériích, proto¾e pro amatérské
konstrukce se více pou¾ívají èipy z&nbsp;výkonnìj¹í rodiny <i>PIC16</i>,
proto¾e u konstrukcí vyrábìných v&nbsp;malých sériích nehraje vìt¹í cena,
velikost/obsazená plocha plo¹ného spoje a nároky na pøíkon tak velkou roli,
jako v&nbsp;tìch pøípadech, kdy je zaøízení vyrábìno
v&nbsp;mnoha(set)tisícových sériích. Mikroøadièe <i>PIC10</i> jsou vìt¹inou
umístìny do pouzdra s&nbsp;pouhými ¹esti èi osmi piny (pøipomeòme, ¾e napøíklad
známý èip <i>7400</i> obsahující ètveøici hradel typu NAND, je umístìn
v&nbsp;pouzdru se ètrnácti piny). Nízký poèet pinù na jednu stranu znamená
men¹í cenu výsledného zaøízení i jeho ni¾¹í poruchovost, ov¹em mnohé piny musí
mít pøiøazeno více funkcí, u¾ jen z&nbsp;toho dùvodu, ¾e musí existovat zpùsob
naprogramování interní pamì» EEPROM èi Flash.</p>

<img src="http://i.iinfo.cz/images/495/pc12802.png" width="450" height="150" alt=" " />
<p><i>Obrázek 2: Zapojení pinù mikroøadièù PIC10F200 a PIC10F202 pøi pou¾ití
pouzdra typu SOT-23. Jak je z&nbsp;obrázku patrné, mají nìkteré piny pøiøazeno
více funkcí, které lze samozøejmì u¾ivatelsky konfigurovat.<br />(zdroj: PIC10F200/202/204/206 Data Sheet)</i></p>



<p><a name="k02"></a></p>
<h2>2. PIC10F2xx &ndash; pouhá elektronická souèástka nebo plnohodnotný mikroøadiè?</h2>

<p>V&nbsp;následujících odstavcích se zamìøíme na popis mikroøadièù
<i>PIC10F200</i>, <i>PIC10F202</i>, <i>PIC10F204</i> a <i>PIC10F206</i>,
jejich¾ základní charakteristiky jsou vypsány v&nbsp;následující tabulce.
Pov¹imnìte si, ¾e se tyto mikroøadièe od sebe odli¹ují pøedev¹ím kapacitou
pamìti pro ulo¾ení programu, kapacitou pamìti dat (tuto pamì» lze pøímo
adresovat) a takté¾ tím, zda èip obsahuje napì»ový komparátor, který je mo¾né
v&nbsp;mnoha zapojeních pou¾ít namísto u tìchto èipù neexistujícího
analogovì-digitálního pøevodníku. Poznámka: kapacita pamìti programu znaèí
celkový poèet dvanáctibitových slov, tj.&nbsp;nejedná se o obvyklé bajty, co¾
mj.&nbsp;znamená, ¾e uvedená èíslovka odpovídá maximálnímu poètu instrukcí,
které lze do pamìti programu ulo¾it:</p>

<table>
<tr><th>Mikroøadiè</th><th>Maximální frekvence</th><th>Doba trvání instrukce</th><th>Pamì» programu</th><th>Datová pamì»</th><th>Komparátor</th><th>Èítaè</th><th>I/O pinù</th><th>Poèet instrukcí</th></tr>
<tr><td>PIC10F200</td><td>4 MHz</td><td>1&micro;s</td><td>256</td><td>16</td><td>0</td><td>1&times; osmibitový</td><td>4, z&nbsp;toho 1 pouze vstupní</td><td>33</td></tr>
<tr><td>PIC10F202</td><td>4 MHz</td><td>1&micro;s</td><td>512</td><td>24</td><td>0</td><td>1&times; osmibitový</td><td>4, z&nbsp;toho 1 pouze vstupní</td><td>33</td></tr>
<tr><td>PIC10F204</td><td>4 MHz</td><td>1&micro;s</td><td>256</td><td>16</td><td>1</td><td>1&times; osmibitový</td><td>4, z&nbsp;toho 1 pouze vstupní</td><td>33</td></tr>
<tr><td>PIC10F206</td><td>4 MHz</td><td>1&micro;s</td><td>512</td><td>24</td><td>1</td><td>1&times; osmibitový</td><td>4, z&nbsp;toho 1 pouze vstupní</td><td>33</td></tr>
</table>

<img src="http://i.iinfo.cz/images/92/pc12803.png" width="450" height="150" alt=" " />
<p><i>Obrázek 3: Zapojení pinù mikroøadièù PIC10F204 a PIC10F206 pøi pou¾ití
pouzdra typu SOT-23. Pov¹imnìte si, ¾e oproti pøedchozímu obrázku se u tøí pinù
objevují nové funkce napì»ového komparátoru: CIN+, CIN-, COUT.<br />(zdroj: PIC10F200/202/204/206 Data Sheet)</i></p>

<p>Mezi vlastnosti, které jsou v¹em ètyøem typùm vý¹e uvedených osmibitových
mikroøadièù <i>PIC</i> spoleèné, patøí napøíklad existence interního oscilátoru
s&nbsp;kmitoètem 4 MHz (není tedy nutné pou¾ít externí krystal), doba trvání
ka¾dé instrukce jedna mikrosekunda v&nbsp;pøípadì pou¾ití interního oscilátoru,
automatický reset mikroøadièe pøi pøipojení externího napájení (u nìkterých
mikroøadièù, napøíklad u ji¾ popsané øady <i>MCS-48</i> a <i>MCS-51</i>, je
naproti tomu nutné signál RESET pøivádìt na zvlá¹tní pin), interní
programovatelný osmibitový èítaè, konfigurovatelný watchdog a v&nbsp;neposlední
øadì takté¾ podpora pro programování mikroøadièe pomocí protokolu <i>In-Circuit
Serial Programming (ICSP)</i> vyvinutého samotnou firmou Microchip Technology.
Tento protokol, jak ji¾ ostatnì jeho název napovídá, umo¾òuje zápis dat do
pamìti programu pomocí tøívodièového sériového kanálu &ndash; jedním vodièem se
pøená¹í data a øídicí pøíkazy, druhý vodiè slou¾í pro pøenos hodinového signálu
a tøetí vodiè je spoleèná (datová) zem pro vysílaè (napøíklad osobní poèítaè) i
pøijímaè (kterým je mikroøadiè).</p>

<img src="http://i.iinfo.cz/images/362/pc12804.png" width="450" height="150" alt=" " />
<p><i>Obrázek 4: Zapojení pinù mikroøadièù PIC10F200 a PIC10F202 pøi pou¾ití
pouzdra typu PDIP. Pov¹imnìte si, ¾e i kdy¾ má toto pouzdro osm vývodù, pouze
¹est z&nbsp;nich je skuteènì vyu¾ito (N/C &ndash; not connected).<br />(zdroj: PIC10F200/202/204/206 Data Sheet)</i></p>



<p><a name="k03"></a></p>
<h2>3. Konfigurace pinù mikroøadièù PIC10F2xx</h2>

<p>Na obrázcích 2 a¾ 5 je zobrazena funkce jednotlivých pinù mikroøadièù
<i>PIC10F2xx</i> pøi pou¾ití rùzných typù pouzder. Nezávisle na tom, jaké
pouzdro je pou¾ito, vyu¾ívá mikroøadiè v¾dy pouze ¹est pinù, z&nbsp;nich¾ dva
mají pevnou funkci (jedná se o <strong>Uss</strong> a <strong>Udd</strong>
pou¾ité pro napájení) a funkce dal¹í ètveøice pinù se li¹í podle toho, jakým
zpùsobem je mikroøadiè nakonfigurován. V&nbsp;nejjednodu¹¹ím pøípadì mohou být
tyto ètyøi piny ovládány pomocí dolních ètyø bitù speciálního funkèního
registru (<i>SFR</i>) nazvaného pøíznaènì <strong>GPIO</strong>. Pøes tento
registr lze nastavovat výstupní logickou hodnotu na pinech
<strong>GP0</strong>, <strong>GP1</strong> a <strong>GP2</strong> a takté¾ lze
èíst aktuální hodnotu na v¹ech ètyøech I/O pinech <strong>GP0</strong> a¾
<strong>GP3</strong> (pov¹imnìte si, ¾e <strong>GP3</strong> je jen vstupním
pinem). Ètení aktuální hodnoty v¹ech ètyø pinù lze provádìt nezávisle na tom,
jakou mají aktuálnì nastavenou funkci &ndash; viz té¾ obrázek èíslo 6 (ov¹em
v&nbsp;nìkterých pøípadech nebudou mít pøeètené údaje ¾ádnou vypovídající
hodnotu).</p>

<img src="http://i.iinfo.cz/images/672/pc12805.png" width="450" height="150" alt=" " />
<p><i>Obrázek 5: Zapojení pinù mikroøadièù PIC10F204 a PIC10F206 pøi pou¾ití
pouzdra typu PDIP. I zde je pou¾ito pouze ¹est vývodù, proto¾e dva zbývající
vývody jsou nezapojeny.<br />(zdroj: PIC10F200/202/204/206 Data Sheet)</i></p>

<p>Pomocí speciálního funkèního registru <strong>TRIS</strong> naplòovaného
stejnojmennou instrukcí lze libovolný ze vstupnì/výstupních pinù nastavit do
re¾imu vysoké impedance. V&nbsp;tomto pøípadì se mù¾e stát, ¾e i kdy¾ je daný
pin nastaven na logickou jednièku, je mo¾né, ¾e se pøi jeho ètení naète logická
nula (v&nbsp;pøípadì, ¾e dal¹í obvod &bdquo;stahuje&ldquo; napì»ovou úroveò na
logickou nulu). Dal¹í funkce v¹ech ètyø vstupnì/výstupních pinù jsou vypsány
v&nbsp;následující tabulce. Nìkteré funkce uvedené v&nbsp;této tabulce, zejména
oba vstupy a jeden výstup napì»ového komparátoru (<strong>CIN+</strong>,
<strong>CIN-</strong> a <strong>COUT</strong>):, jsou dostupné pouze na
mikroøadièích <i>PIC10F204</i> a <i>PIC10F206</i>:</p>

<table>
<tr><th>Pin</th><th>Funkce</th><th>Popis</th></tr>
<tr><td>GP0</td><td>GP0</td><td>obousmìrný vstupnì/výstupní pin ovládaný programovì</td></tr>
<tr><td>GP0</td><td>ICSPDAT</td><td>pou¾ito pøi programování pro pøenos dat do mikroøadièe</td></tr>
<tr><td>GP0</td><td>CIN+</td><td>jeden ze vstupù napì»ového komparátoru</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>GP1</td><td>GP1</td><td>obousmìrný vstupnì/výstupní pin ovládaný programovì</td></tr>
<tr><td>GP1</td><td>ICSPCLK</td><td>pou¾ito pøi programování pro pøenos hodinového signálu</td></tr>
<tr><td>GP1</td><td>CIN-</td><td>jeden ze vstupù napì»ového komparátoru</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>GP2</td><td>GP2</td><td>obousmìrný vstupnì/výstupní pin ovládaný programovì</td></tr>
<tr><td>GP2</td><td>T0CKI</td><td>vstup pro èasovaè TMR0</td></tr>
<tr><td>GP2</td><td>COUT</td><td>výstup napì»ového komparátoru</td></tr>
<tr><td>GP2</td><td>FOSC4</td><td>výstup hodinového signálu z&nbsp;oscilátoru</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>GP3</td><td>GP3</td><td>jednosmìrný vstupní pin ovládaný programovì (ètení)</td></tr>
<tr><td>GP3</td><td>MCLR</td><td>Master Clear (Reset)</td></tr>
<tr><td>GP3</td><td>Vpp</td><td>napìtí (pou¾ívané pøi programování)</td></tr>
</table>

<img src="http://i.iinfo.cz/images/242/pc12806.png" width="450" height="450" alt=" " />
<p><i>Obrázek 6: Obvodová funkce pinù GP0 a¾ GP2 pøi jejich programovém
ovládání.  Pov¹imnìte si, ¾e napì»ovou logickou úroveò na pinu lze kdykoli
pøeèíst (hradlo 1) a takté¾ toho, ¾e data zapsaná na pin jsou zapamatována a¾
do jejich dal¹ího pøepsání v&nbsp;klopném obvodu typu D.<br />(zdroj: PIC10F200/202/204/206 Data Sheet)</i></p>



<p><a name="k04"></a></p>
<h2>4. Aritmetické a logické instrukce, instrukce pro pøenosy dat</h2>

<p>Osmibitové mikroøadièe <i>PIC10F2xx</i> pou¾ívají, jak jsme si ji¾ ostatnì
øekli v&nbsp;úvodních kapitolách tohoto èlánku, dvanáctibitovou instrukèní
sadu, v&nbsp;ní¾ se nachází pouze 33 instrukcí. V¹echny instrukce lze na
základì jejich formátu rozdìlit do nìkolika skupin. V&nbsp;první skupinì se
nachází vìt¹ina aritmetických a logických instrukcí, které vìt¹inou pracují
s&nbsp;jedním bajtem operaèní pamìti (jednotlivé bajty se té¾ nazývají
universální registry neboli <i>GPR</i>) nebo s&nbsp;jedním registrem
speciálních funkcí a dále s&nbsp;pracovním registrem <strong>W</strong>, který
je obdobou akumulátoru u jiných typù mikroøadièù a mikroprocesorù. Vzhledem
k&nbsp;tomu, ¾e do adresového rozsahu operaèní pamìti jsou mapovány i registry
speciálních funkcí (<i>SFR</i>), je nutné pro tuto adresu rezervovat pìt bitù
instrukèního slova, který v&nbsp;bitovì rozepsaném operaèním kódu (viz dal¹í
tabulky) znaèíme pìticí znakù <strong>fffff</strong>.</p>

<p>Dal¹í bit <strong>d</strong> v&nbsp;operaèním kódu instrukce u vìt¹iny dále
vypsaných instrukcí urèuje, zda se má výsledek operace ulo¾it do operaèní
pamìti (popø.&nbsp;do SFR) nebo do pracovního registru <strong>W</strong>
(akumulátoru). Pokud je tento bit nastavený na nulu, bude výsledek ulo¾en do
pracovního registru <strong>W</strong>, v&nbsp;opaèném pøípadì bude výsledek
ulo¾en do toho GPR nebo SFR, který je urèen posledními pìti bity instrukèního
slova. V&nbsp;následující tabulce jsou vypsány ty instrukce, které dodr¾ují
(nìkdy ov¹em ne zcela pøesnì) vý¹e popsaný formát. Pov¹imnìte si toho, ¾e
v¹echny instrukce mají stejný prefix:</p>

<table>
<tr><th>Operaèní kód</th><th>Jméno instrukce</th><th>Struèný popis instrukce</th></tr>
<tr><td>0000 001 fffff</td><td>MOVWF f   </td><td>pøenos akumulátoru do GPR nebo SFR</td></tr>
<tr><td>0000 010 xxxxx</td><td>CLRW      </td><td>vynulování akumulátoru</td></tr>
<tr><td>0000 011 fffff</td><td>CLRF f    </td><td>vynulování GPR nebo SFR</td></tr>
<tr><td>0000 10d fffff</td><td>SUBWF f,d </td><td>d = f - W</td></tr>
<tr><td>0000 11d fffff</td><td>DECF f,d  </td><td>d = f - 1</td></tr>
<tr><td>0001 00d fffff</td><td>IORWF f,d </td><td>d = f OR W</td></tr>
<tr><td>0001 01d fffff</td><td>ANDWF f,d </td><td>d = f AND W</td></tr>
<tr><td>0001 10d fffff</td><td>XORWF f,d </td><td>d = f XOR W</td></tr>
<tr><td>0001 11d fffff</td><td>ADDWF f,d </td><td>d = f + W</td></tr>
<tr><td>0010 00d fffff</td><td>MOVF f,d  </td><td>d = f</td></tr>
<tr><td>0010 01d fffff</td><td>COMF f,d  </td><td>d = NOT f</td></tr>
<tr><td>0010 10d fffff</td><td>INCF f,d  </td><td>d = f + 1</td></tr>
<tr><td>0010 11d fffff</td><td>DECFSZ f,d</td><td>d = f - 1, vynechání následující instrukce pøi nulovém výsledku</td></tr>
<tr><td>0011 00d fffff</td><td>RRF f,d   </td><td>rotace doprava pøes carry</td></tr>
<tr><td>0011 01d fffff</td><td>RLF f,d   </td><td>rotace doleva pøes carry</td></tr>
<tr><td>0011 10d fffff</td><td>SWAPF f,d </td><td>prohození nibblù GPR nebo SFR</td></tr>
<tr><td>0011 11d fffff</td><td>INCFSZ f,d</td><td>d = f + 1, vynechání následující instrukce pøi nulovém výsledku</td></tr>
</table>

<a href="http://i.iinfo.cz/images/197/pc127-3.png"><img src="http://i.iinfo.cz/images/197/pc127-3-prev.png" width="328" height="270" alt=" " /></a>
<p><i>Obrázek 7: Zapojení vývodù mikroøadièe PIC16F88, který bude popsán pøí¹tì.</i></p>



<p><a name="k05"></a></p>
<h2>5. Bitové operace a instrukce pracující s&nbsp;osmibitovými konstantami</h2>

<p>Druhá skupina instrukcí sice takté¾ pracuje s&nbsp;vybraným <i>GPR</i>,
neboli obecným registrem &ndash; bajtem v&nbsp;operaèní pamìti, popø.&nbsp;se
<i>SFR</i> (registrem speciálních funkcí), ov¹em na bitové úrovni. Pomocí
tìchto instrukcí lze nastavit èi naopak vynulovat vybraný bit, popø.&nbsp;zcela
vynechat následující instrukci (<i>SKIP</i>) na základì aktuální hodnoty
vybraného bitu (pokud se <i>SKIP</i> skuteènì provede, bude to bì¾ící program
stát jednu mikrosekundu èasu navíc, proto¾e instrukce jsou zpracovávány
v&nbsp;pipeline, která musí být pøi <i>SKIP</i> nejprve vyprázdnìna a posléze
znovu naplnìna). Vzhledem k&nbsp;tomu, ¾e v¹echny <i>GPR</i> i <i>SFR</i> jsou
osmibitové, postaèuje v&nbsp;operaèním kódu instrukce pro index bitu,
s&nbsp;ním¾ má instrukce pracovat, rezervovat pouhé tøi bity, co¾ je ostatnì
patrné z&nbsp;následující tabulky (mimochodem, pomocí tìchto ètyø instrukcí byl
velmi elegantnì implementován takzvaný booleovský procesor, o nìm¾ jsme si ji¾
zmiòovali pøi popisu mikroøadièù <i>MCS-51</i>):</p>

<table>
<tr><th>Operaèní kód</th><th>Jméno instrukce</th><th>Struèný popis instrukce</th></tr>
<tr><td>0100 bbb fffff</td><td>BCF f,b   </td><td>vynulování jednoho bitu universálního registru</td></tr>
<tr><td>0101 bbb fffff</td><td>BSF f,b   </td><td>nastavení (na 1) jednoho bitu universálního registru</td></tr>
<tr><td>0110 bbb fffff</td><td>BTFSC f,b </td><td>Bit test f, vynechání následující instrukce pokud je bit nulový</td></tr>
<tr><td>0111 bbb fffff</td><td>BTFSS f,b </td><td>Bit test f, vynechání následující instrukce pokud je bit jednièkový</td></tr>
</table>

<p>Dal¹í pìtice instrukcí obsahuje ve svém operaèním kódu osmibitovou
konstantu, co¾ mj.&nbsp;znamená, ¾e na samotný kód instrukce zbývají pouhé
ètyøi bity. Osmibitová konstanta je pou¾ita pro naplnìní akumulátoru
(pracovního registru <strong>W</strong>) èi pro provedení nìjaké logické
operace s&nbsp;obsahem akumulátoru bit po bitu. Zajímavá je té¾ instrukce
<strong>RETLW k</strong>, pomocí ní¾ lze provést návrat z&nbsp;podprogramu
spolu s&nbsp;nastavením akumulátoru na specifikovanou hodnotu. Tato instrukce
tedy v&nbsp;céèku odpovídá pøíkazu <i>return k;</i>:</p>

<table>
<tr><th>Operaèní kód</th><th>Jméno instrukce</th><th>Struèný popis instrukce</th></tr>
<tr><td>1000 kkkkkkkk </td><td>RETLW k   </td><td>návrat z&nbsp;podprogramu s&nbsp;nastavením akumulátoru</td></tr>
<tr><td>1100 kkkkkkkk </td><td>MOVLW k   </td><td>W = k</td></tr>
<tr><td>1101 kkkkkkkk </td><td>IORLW k   </td><td>W = k OR W</td></tr>
<tr><td>1110 kkkkkkkk </td><td>ANDLW k   </td><td>W = k AND W</td></tr>
<tr><td>1111 kkkkkkkk </td><td>XORLW k   </td><td>W = k XOR W</td></tr>
</table>

<a href="http://i.iinfo.cz/images/197/pc127-10.png"><img src="http://i.iinfo.cz/images/197/pc127-10-prev.png" width="370" height="213" alt=" " /></a>
<p><i>Obrázek 8: Základní rozdìlení osmibitových mikroøadièù PIC.<br />
(zdroj: firma Microchip Technology).</i></p>



<p><a name="k06"></a></p>
<h2>6. Pamì» programu, skoky, podprogramy a pou¾ití zásobníku</h2>

<p>Ve druhé kapitole jsme si øekli, ¾e pamì» programu má u osmibitových
mikroøadièù <i>PIC10F2xx</i> kapacitu pro ulo¾ení 256 nebo 512 dvanáctibitových
slov. Mikroøadièe <i>PIC10F200</i> a <i>PIC10F204</i> mají pamì» programu
organizovanou jako matici 256&times;12 bitù, zatímco mikroøadièe
<i>PIC10F202</i> a <i>PIC10F206</i> mají pamì» programu organizovanou do
struktury 512&times;12 bitù. V&nbsp;praxi je tedy nutné, aby programový èítaè
<strong>PC</strong> mìl ¹íøku alespoò devìt bitù. Jedinou instrukcí, která
doká¾e zmìnit v¹ech devìt bitù programového èítaèe, a tím pádem provést skok do
jakéhokoli místa pamìti programu, je instrukce nazvaná pøíznaènì
<strong>GOTO</strong>, v&nbsp;jejím¾ operaèním kódu je devìt bitù
z&nbsp;dvanácti urèeno pro uchování adresy. Druhá instrukce, která doká¾e
zmìnit hodnotu programového èítaèe, je instrukce skoku do podprogramu
<strong>CALL</strong>, ov¹em vzhledem k&nbsp;tomu, ¾e v&nbsp;operaèním kódu
této instrukce je ulo¾eno jen osm bitù adresy, mohou být podprogramy umístìny
pouze v&nbsp;prvních 256 slovech pamìti programu (devátý bit
<strong>PC</strong> je pøi provedení této instrukce nastaven na nulu):</p>

<table>
<tr><th>Operaèní kód</th><th>Jméno instrukce</th><th>Struèný popis instrukce</th></tr>
<tr><td>1001 kkkkkkkk </td><td>CALL k</td><td>zavolání podprogramu na adrese k</td></tr>
<tr><td>101 kkkkkkkkk </td><td>GOTO k</td><td>skok na adresu specifikovanou devíti bity</td></tr>
</table>

<p>Se skokem do podprogramu pomocí instrukce <strong>CALL</strong> a návratem
z&nbsp;podprogramu s&nbsp;vyu¾itím instrukce <strong>RETLW</strong> samozøejmì
souvisí i zásobník návratových adres (<i>stack</i>). Tento zásobník je, na
rozdíl od nìkterých dal¹ích mikroøadièù, umístìn mimo pamì» údajù a jeho
kapacita je pouhé dvì adresy. U èipù <i>PIC10F200</i> a <i>PIC10F204</i> mù¾e
být v&nbsp;ka¾dé buòce zásobníku ulo¾ena osmibitová návratová adresa a u
mikroøadièù <i>PIC10F202</i> a <i>PIC10F206</i> adresa devítibitová. To
znamená, ¾e i kdy¾ je cíl skoku do podprogramu omezen na prvních 256 adres,
mù¾e být oblast, ze které se podprogramy volají, umístìna kdekoli, tj.&nbsp;i
nad adresou 0x100 (samozøejmì pouze u èipù s&nbsp;pamìtí programu o kapacitì
512&times;12 bitù). S&nbsp;velikostí zásobníku omezenou na pouhé dvì buòky
souvisí i to, ¾e u mikroøadièù <i>PIC10F2xx</i> není mo¾né zjistit, zda do¹lo
èi nedo¹lo k&nbsp;pøeteèení nebo naopak podteèení zásobníku, co¾ znamená, ¾e si
programátoøi musí dát na práci se zásobníkem pomìrnì velký pozor, zejména pøi
pøevodu programù z&nbsp;mikroøadièù <i>PIC</i> vy¹¹ích øad, které mají zásobník
ponìkud vìt¹í.</p>

<img src="http://i.iinfo.cz/images/213/pc128-9.png" width="250" height="373" alt=" " />
<p><i>Obrázek 9: Uspoøádání pamìti programu a zásobníku u mikroøadièù PIC10F200
a PIC10F204.</i></p>



<p><a name="k07"></a></p>
<h2>7. Pamì» dat, pøímé a nepøímé adresování pamìti dat</h2>

<p>Z&nbsp;popisu mikroøadièù <i>PIC10F2xx</i> uvedeného ve druhé kapitole
takté¾ víme, ¾e kapacita pamìti údajù (<i>RAM</i>) je pouze ¹estnáct nebo 24
bajtù. K&nbsp;této pamìti je pøipojeno sedm registrù speciálních funkcí
(<i>SFR</i>) a jeden pseudoregistr, jeho¾ pou¾ití bude vysvìtleno
v&nbsp;následujícím odstavci. Celkem je tedy nutné adresovat 16(RAM)+8(SFR)=24
bajtù popø.&nbsp;24(RAM)+8(SFR)=32 pamì»ových míst. Jak ji¾ víme
z&nbsp;pøedchozího textu, mnohé instrukce obsahují pøímo ve svém instrukèním
slovì adresu pamì»ového místa, pøièem¾ takto adresovaný obsah pamìti údajù èi
<i>SFR</i> je vyu¾íván jako jeden z&nbsp;operandù instrukce (napøíklad sèítání)
a v&nbsp;závislosti na hodnotì bitu <strong>d</strong> se mù¾e výsledek
instrukce zapsat na toto pamì»ové místo (popø.&nbsp;do akumulátoru
<strong>W</strong>). Tímto zpùsobem sice lze pøímo adresovat libovolný bajt
v&nbsp;pamìti údajù a libovolný registr speciálních funkcí, ov¹em pro nìkteré
operace není pøímá adresace vhodná (pov¹imnìte si, ¾e øadièe <i>PIC</i>
neobsahují ¾ádný index registr).</p>

<p>Aby bylo mo¾né provádìt nepøímou adresaci, pøidali konstruktéøi do
mikroøadièù <i>PIC10F2xx</i> registr nazvaný <strong>FSR</strong> (jedná se o
jeden ze sedmi zmínìných registrù speciálních funkcí) a pseudoregistr nazvaný
<strong>INDF</strong>. Do registru <strong>FSR</strong> se zapisuje adresa,
pøièem¾ význam má pouze nejni¾¹ích pìt bitù této adresy. Pokud je provedeno
ètení hodnoty pseudoregistru <strong>INDF</strong>, pøeète se ve skuteènosti
bajt, jeho¾ adresa je ulo¾ená v&nbsp;<strong>FSR</strong>. To stejné platí i
pøi zápisu do pseudoregistru <strong>INDF</strong> &ndash; zápis se provede na
adresu ulo¾enou ve <strong>FSR</strong>. Následující velmi jednoduchý
podprogram ukazuje, jakým zpùsobem je mo¾né nepøímé adresování pou¾ít pro
vymazání pamì»ových bunìk RAM v&nbsp;rozsahu 0x10 a¾ 0x1f:</p>

<pre>
        MOVLW 0x10   ; adresa první pamì»ové buòky, která se má vymazat
        MOVWF FSR    ; ulo¾ení adresy buòky do registru FSR
LOOP    CLRF  INDF   ; zápis nuly do pseudoregistru INDF:
                     ; ve skuteènosti tedy vynulování pamìti na adrese [FSR]
        INCF  FSR,F  ; zvý¹ení ukazatele o jednièku
        BTFSC FSR,4  ; test na ukonèení smyèky (pokud je splnìno, pøeskoèí se GOTO)
        GOTO  LOOP   ; dal¹í iterace
        ...
</pre>

<p>I kdy¾ se v&nbsp;pøedchozím podprogramu u ka¾dé instrukce pou¾ívá alespoò
jeden operand, ve skuteènosti má celý program délku pouze ¹est dvanáctibitových
instrukèních slov (devìt bajtù), a to díky tomu, ¾e v¹echny operandy jsou
ulo¾eny pøímo v&nbsp;instrukèním slovu. V&nbsp;mnoha pøípadech tak mohou být
programy urèené pro øadu <i>PIC10F2xx</i> krat¹í, ne¾ obdobné programy napsané
napøíklad pro mikroøadièe <i>MCS-51</i> s&nbsp;&bdquo;úspornou&ldquo;
instrukèní sadou s&nbsp;operaèními kódy ¹irokými jeden bajt.</p>

<a href="http://i.iinfo.cz/images/363/pc128-10.jpg"><img src="http://i.iinfo.cz/images/363/pc128-10-prev.jpg" width="270" height="270" alt=" " /></a>
<p><i>Obrázek 10: Mikroøadièe PIC10F2xx v&nbsp;pouzdru SOT-23
(zvìt¹eno).</i></p>



<p><a name="k08"></a></p>
<h2>8. Mikroøadièe z&nbsp;rodiny PIC12</h2>

<p>Osmibitové mikroøadièe <i>PIC</i> z&nbsp;rodiny <i>PIC10</i>, kterým jsme se
vìnovali v&nbsp;pøedchozích kapitolách, sice mají pomìrnì ¹irokou oblast
pou¾ití (ostatnì právì proto byly relativnì nedávno firmou Microchip dodány na
trh), ov¹em pro mnoho úèelù je vhodnìj¹í pou¾ít mikroøadièe výkonnìj¹í &ndash;
a» ji¾ se jedná o mikroøadièe s&nbsp;vìt¹í kapacitou pamìti programu èi pamìti
údajù, tak o mikroøadièe s&nbsp;dal¹ími pøídavnými moduly, napøíklad
plnohodnotným analogovì-digitálním pøevodníkem, modulem pro PWM (pulsní
¹íøkovou modulaci), asynchronním èi synchronním sériovým portem atd. Dal¹í
rodinou mikroøadièù <i>PIC</i> jsou èipy øady <i>PIC12</i>, které jsou ji¾
v&nbsp;mnoha ohledech lépe vybavené ne¾ mikroøadièe <i>PIC10</i>, a to pøi
zachování pøíznivé ceny a v&nbsp;mnoha pøípadech i zachování malého pouzdra,
v&nbsp;nìm¾ jsou tyto mikroøadièe umístìny (víme ji¾, ¾e s&nbsp;rostoucím
poètem pinù roste i cena, spotøeba a poruchovost celého zaøízení, a to sice ne
výraznì, ale pøi sériové výrobì se ji¾ mù¾e jednat o polo¾ku ovlivòující
napøíklad koncovou cenu zaøízení).</p>

<img src="http://i.iinfo.cz/images/89/pc128-11.jpg" width="150" height="93" alt=" " />
<p><i>Obrázek 11: Adaptér umo¾òující pøipojení napájecích a signálových vodièù
k&nbsp;mikroøadièùm PIC10F2xx umístìných v&nbsp;pouzdru SOT-23.</i></p>

<p>Zástupcem rodiny <i>PIC12</i> je mikroøadiè <i>PIC12F675</i>, který
prakticky ve v¹ech ohledech pøekonává èipy <i>PIC10F2xx</i> popsané vý¹e. Tento
mikroøadiè obsahuje interní pamì» programu schopnou ulo¾it a¾ 1024 instrukcí.
Pamì» dat je roz¹íøena na 64 bajtù, k&nbsp;nim¾ je navíc pøidáno 128 bajtù
pamìti EEPROM, její¾ buòky by mìly umo¾nit a¾ jeden milion pøepisù (to
napøíklad znamená, ¾e pokud se výsledek nìjakého mìøení zapí¹e do stejné buòky
EEPROM jednou za ètvrt hodiny, pøekraèuje ¾ivotnost této pamìti 28 let,
tj.&nbsp;mnohonásobnì plánovanou ¾ivotnost celého zaøízení). Tato pamì» je
samozøejmì nevolatilní, tudí¾ &bdquo;pøe¾ije&ldquo; i výpadky napájení. I dal¹í
technické parametry tohoto mikroøadièe jsou oproti øadì <i>PIC10</i> vylep¹eny
&ndash; poèet vstupnì/výstupních pinù se zvý¹il na ¹est (celkem èip pou¾ívá 8
pinù), èasovaè byl roz¹íøen na ¹estnáct bitù a navíc byl pøidán i ètyøkanálový
analogovì-digitální pøevodník, co¾ mj.&nbsp;znamená, ¾e ètyøi vstupní piny
mohou být vyu¾ity pro ètení analogových údajù, co¾ je na osmipinový èip pomìrnì
zajímavá hodnota. Takté¾ výpoèetní rychlost se zvý¹ila, a to pìtkrát &ndash;
ov¹em za pøedpokladu, ¾e je pou¾it externí oscilátor. Konkrétními rozdíly mezi
èipy øady <i>PIC10F2xx</i> a <i>PIC12F675</i>, jako¾to i velmi známou rodinou
<i>PIC16F</i>, se budeme zabývat pøí¹tì.</p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>Stránky firmy Microchip Technology<br />
<a href="http://www.microchip.com/">http://www.microchip.com/</a>
</li>

<li>Výbìr z&nbsp;rùzných modelù (osmibitových) mikroøadièù PIC<br />
<a href="http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=2661">http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=2661</a>
</li>

<li>Øada (rodina) osmibitových mikroøadièù PIC 10<br />
<a href="http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1009&mid=10&lang=en&pageId=74">http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1009&mid=10&lang=en&pageId=74</a>
</li>

<li>Øada (rodina) osmibitových mikroøadièù PIC 12<br />
<a href="http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1001&mid=10&lang=en&pageId=74">http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1001&mid=10&lang=en&pageId=74</a>
</li>

<li>Øada (rodina) osmibitových mikroøadièù PIC 14<br />
<a href="http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1008&mid=10&lang=en&pageId=74">http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1008&mid=10&lang=en&pageId=74</a>
</li>

<li>Øada (rodina) osmibitových mikroøadièù PIC 16<br />
<a href="http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1002&mid=10&lang=en&pageId=74">http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1002&mid=10&lang=en&pageId=74</a>
</li>

<li>Dal¹í výbìr z&nbsp;rùzných modelù mikroøadièù PIC<br />
<a href="http://www.microchip.com/maps/microcontroller.aspx">http://www.microchip.com/maps/microcontroller.aspx</a>
</li>

<li>PIC microcontroller (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/PIC_microcontroller">http://en.wikipedia.org/wiki/PIC_microcontroller</a>
</li>

<li>Mikrokontrolér PIC (Wikipedia CZ)<br />
<a href="http://cs.wikipedia.org/wiki/Mikrokontrolér_PIC">http://cs.wikipedia.org/wiki/Mikrokontrolér_PIC</a>
</li>

<li>FLASHFORTH for the PIC18F and the dsPIC30F<br />
<a href="http://flashforth.sourceforge.net/">http://flashforth.sourceforge.net/</a>
</li>

<li>FlashForth<br />
<a href="http://www.sourceforge.net/projects/flashforth">http://www.sourceforge.net/projects/flashforth</a>
</li>

<li>Free Pic software tools<br />
<a href="http://softwarepic.50webs.com/freesoft.html">http://softwarepic.50webs.com/freesoft.html</a>
</li>

<li>What is Amicus?<br />
<a href="http://www.picbasic.org/proton_lite.php">http://www.picbasic.org/proton_lite.php</a>
</li>

<li>Amicus FAQ<br />
<a href="http://www.myamicus.co.uk/faq.php?s=2e8d12e7f4c23e775776f4916876354b&">http://www.myamicus.co.uk/faq.php?s=2e8d12e7f4c23e775776f4916876354b&</a>
</li>

<li>Microcontrollers development tools<br />
<a href="http://www.gnupic.dds.nl/">http://www.gnupic.dds.nl/</a>
</li>

<li>gpsim (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/Gpsim">http://en.wikipedia.org/wiki/Gpsim</a>
</li>

<li>gpsim home page<br />
<a href="http://gpsim.sourceforge.net/gpsim.html">http://gpsim.sourceforge.net/gpsim.html</a>
</li>

<li>The FreeRTOS Project<br />
<a href="http://www.freertos.org/">http://www.freertos.org/</a>
</li>

<li>FreeRTOS (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/FreeRTOS">http://en.wikipedia.org/wiki/FreeRTOS</a>
</li>

<li>Serial EEPROM (93C46 / 93CS46) Routines<br />
<a href="http://www.pjrc.com/tech/8051/serial-eeprom.html">http://www.pjrc.com/tech/8051/serial-eeprom.html</a>
</li>

<li>Great Microprocessors of the Past and Present (V 13.4.0)<br />
<a href="http://jbayko.sasktelwebsite.net/cpu.html">http://jbayko.sasktelwebsite.net/cpu.html</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

