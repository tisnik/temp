<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Lokální sbìrnice VESA Local Bus a universální sbìrnice PCI</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Lokální sbìrnice VESA Local Bus a universální sbìrnice PCI</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Ve tøicáté druhé èásti seriálu o architekturách poèítaèù si popí¹eme nechvalnì známou lokální sbìrnici VESA Local Bus a pøedev¹ím pak velmi úspì¹nou universální sbìrnici PCI i koncept Plug and Play, který se na bì¾né pracovní poèítaèe dostal právì díky tomuto typu sbìrnice.</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. Lokální sbìrnice VESA Local Bus a universální sbìrnice PCI</a><br />
<a href="#k02">2. Lokální sbìrnice VESA Local Bus</a><br />
<a href="#k03">3. Univerzální sbìrnice PCI se pøedstavuje</a><br />
<a href="#k04">4. Pøenosové rychlosti sbìrnice PCI</a><br />
<a href="#k05">5. Koncept <i>Plug and Play</i></a><br />
<a href="#k06">6. Komunikace mikroprocesoru s&nbsp;zaøízením pøipojeným na PCI</a><br />
<a href="#k07">7. Obsah dal¹í èásti tohoto seriálu</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. Lokální sbìrnice VESA Local Bus a universální sbìrnice PCI</h1>

<p>V&nbsp;pøedchozí èásti tohoto seriálu byla popsána osmibitová i
¹estnáctibitová varianta universální sbìrnice <i>ISA</i> (<i>Industrial
Standard Architecture</i>). Tato sbìrnice se v&nbsp;osobních poèítaèích
kompatibilních s&nbsp;IBM PC pou¾ívala po velmi dlouhou dobu, prakticky od
samotného vzniku PC a¾ do cca roku 2003. Dokonce i modernìj¹í základní desky,
které ji¾ podporovaly nìkterou z&nbsp;novìj¹ích sbìrnic (<i>EISA</i>, <i>VESA
Local Bus</i> èi <i>PCI</i>), toti¾ &ndash; pøevá¾nì z&nbsp;historických dùvodù
a pro zachování kompatibility se speciálními zaøízeními &ndash; alespoò jeden
konektor urèený pro sbìrnici <i>ISA</i> stále mìly nainstalovaný, co¾
samozøejmì znamenalo vìt¹í náklady na vývoj základní desky (mezi
&bdquo;rychlou&ldquo; sbìrnicí a <i>ISA</i> musel být øadiè, který zaji¹»oval
mj.&nbsp;i øízení pøeru¹ení, DMA pøenosy atd). V&nbsp;mnohých prùmyslových
poèítaèích zalo¾ených na architektuøe PC se se sbìrnicí <i>ISA</i> dokonce
mù¾eme setkat i dnes, mnoho mìøicích desek èi jednoúèelových øídicích desek je
urèeno právì pro <i>ISA</i>.</p>

<image id="7340" />
<p-center><i>Obrázek 1: Schematické tvary pøídavných karet upravených pro rùzné
typy sbìrnic, které se pou¾ívaly èi dodnes pou¾ívají na desktopových
PC</i></p-center>

<p>Pøi pohledu zpìt do historie mù¾eme øíci, ¾e sbìrnice <i>ISA</i> byla jednou
z&nbsp;hlavních pøíèin velkého roz¹íøení poèítaèù kompatibilních s&nbsp;IBM PC,
XT èi AT &ndash; jednalo se o skuteèný prùmyslový standard, pro nìj¾ mnoho
výrobcù vytváøelo rùzné typy pøídavných karet, od øadièù sériových a
paralelních portù pøes sí»ové karty a specializované karty urèené napøíklad pro
skenery a¾ po karty zvukové a grafické. Ov¹em právì fakt, ¾e se ke sbìrnici
musely pøipojovat i pøídavné karty, které mìly vysoké nároky na pøenosové
rychlosti (zejména se jednalo o grafické karty), vedl k&nbsp;tomu, ¾e spolu
s&nbsp;rostoucím výkonem mikroprocesorù i zvìt¹ující se kapacitou operaèní
pamìti sbìrnice <i>ISA</i> postupnì zastarala.</p>

<image id="7341" original="no" />
<p-center><i>Obrázek 2: Na tomto snímku je opravdová rarita &ndash; grafická
karta kompatibilní s&nbsp;CGA, urèená pro osmibitovou sbìrnici ISA, která byla
vyrobena v&nbsp;Bulharsku. Nutno podotknout, ¾e originální CGA od firmy IBM
obsahovala ménì souèástek o vìt¹í integraci. Nìkteré integrované obvody
na zobrazené kartì mo¾ná velmi dobøe znáte :-)</i></p-center>

<p>Zatímco u prvních typù poèítaèù kompatibilních s&nbsp;IBM PC se pomìrnì
bì¾nì operaèní pamì», její¾ maximální kapacita byla 640 kB, doplòovala o
takzvanou expandovanou pamì» (<i>expanded memory &ndash; EMS</i>), její¾
pamì»ové èipy byly skuteènì umístìny na roz¹iøující kartì urèené pro
osmibitovou èi ¹estnáctibitovou sbìrnici <i>ISA</i>, stalo se toto ve své
podstatì nouzové øe¹ení ji¾ u poèítaèù s&nbsp;procesorem 80286 rychlostnì
neúnosné. Rychlostní omezení sbìrnice <i>ISA</i> se negativnì projevovalo i pøi
pøipojení grafické karty na sbìrnici. Pro star¹í grafické karty typu
<i>CGA</i>, <i>EGA</i> a <i>Hercules</i> sice rychlost sbìrnice <i>ISA</i>
dostaèovala (v&nbsp;textových i grafických re¾imech; napøíklad libovolný
grafický re¾im u karty <i>CGA</i> vy¾adoval pouze necelých 16 kB obrazové
pamìti), ov¹em s&nbsp;pøíchodem populární grafické karty <i>VGA</i> a pøedev¹ím
jejích následovníkù (<i>SVGA</i>) bylo pro pøesuny obrazových dat zapotøebí
mnohem ¹ir¹ího pøenosového pásma, ne¾ jaké mohla sbìrnice <i>ISA</i>
poskytnout.</p>

<image id="7342" />
<p-center><i>Obrázek 3: Populární hra King's Quest zobrazená v&nbsp;grafickém
re¾imu karty CGA, který umo¾òoval zobrazení celých ètyø barev v&nbsp;rozli¹ení
320&times;200 pixelù. Pamì»ové nároky na framebuffer dosahují 16 kB (pøesnìji
16000 bytù).</i></p-center>

<p>Øe¹ení grafického subsystému formou vymìnitelné grafické karty, které bylo
pou¾ito právì u osobních poèítaèù kompatibilních s&nbsp;IBM PC, má nìkteré
nesporné výhody, ale samozøejmì i nevýhody. Proto se v minulosti objevily (a
s&nbsp;nejvìt¹í pravdìpodobností i v&nbsp;budoucnosti budou objevovat) snahy o
zaji¹tìní u¾¹í spolupráce mezi mikroprocesorem, operaèní pamìtí a grafickou
kartou. Mezi relativnì úspì¹ná øe¹ení patøilo pou¾ití lokálních sbìrnic
(napøíklad sbìrnice <i>VESA Local Bus</i>) èi portù vymezených pouze pro
grafickou kartu (<i>Advanced Graphics Port</i>). Opaèné snahy vedou
k&nbsp;unifikaci pøístupu ke v¹em zaøízením, vèetnì grafické karty (viz ji¾
popsaná sbìrnice <i>ISA</i>, ní¾e popsaná sbìrnice <i>PCI</i> èi <i>PCI
Express</i>).</p>

<image id="7343" />
<p-center><i>Obrázek 4: Tatá¾ hra (King's Quest), zde ov¹em zobrazená
v&nbsp;grafickém re¾imu karty Tandy, jen¾ pøi stejném rozli¹ení 320&times;200
pixelù dokázal pracovat ji¾ se ¹estnácti souèasnì zobrazitelnými barvami.
Pamì»ové nároky na framebuffer byly dvojnásobné, tj. 32 kB.</i></p-center>

<p>Na tomto místì by bylo vhodné podotknout, ¾e sbìrnicová architektura je sice
pro osobní poèítaèe (stále zalo¾ené na staøièkém návrhu od IBM) typická, ale
není jediná mo¾ná. Napøíklad v&nbsp;grafických stanicích firmy <i>SGI</i> se
ji¾ v&nbsp;dávné minulosti místo sbìrnice pou¾ívaly odli¹né topologie,
napøíklad møí¾ka, hierarchická møí¾ka, torus èi &bdquo;tlustý&ldquo; strom.
Tyto topologie jsou sice na jednu stranu dra¾¹í, na stranu druhou je v¹ak mo¾né
dosáhnout mnohem vy¹¹ích tokù dat (pøenosy lze provádìt paralelnì a nezávisle
na sobì). Bariéru lineární &bdquo;sbìrnicové&ldquo; topologie na PC èásteènì
pøekraèuje a¾ <i>PCI Express</i>.</p>

<image id="7344" />
<p-center><i>Obrázek 5: Jedna z&nbsp;výkonných grafických stanic od firmy SGI.
Za nìkolik let budeme mít podobný výpoèetní výkon i v&nbsp;bì¾ných
noteboocích.</i></p-center>



<p><a name="k02"></a></p>
<h1>2. Lokální sbìrnice VESA Local Bus</h1>

<p>Sbìrnice <i>VESA Local Bus</i> (zkrácenì <i>VLB</i>) byla navr¾ena sdru¾ením
VESA jako rychlej¹í doplnìk k&nbsp;výkonnostnì nedostateèné sbìrnici
<i>ISA</i>. Zatímco je sbìrnice <i>ISA</i> urèena pro prakticky libovolné
zaøízení, u sbìrnice <i>VESA Local Bus</i> se pøedpokládalo její pou¾ití
zejména pro grafické karty, øadièe rychlých pevných diskù a sí»ové karty. Tato
sbìrnice byla pou¾ívána pouze na osobních poèítaèích typu PC; podpora pro jiné
výpoèetní systémy prakticky neexistuje, proto¾e architektura sbìrnice je
pomìrnì úzce svázána se strukturou a funkcí vývodù mikroprocesoru 486. Nejvìt¹í
roz¹íøení této sbìrnice bylo, jak se ostatnì dá oèekávat, v&nbsp;dobách
osobních poèítaèù s&nbsp;procesory øady 486, u kterých rostla poptávka po
rychlých grafických kartách a pevných discích s&nbsp;vìt¹ími pøenosovými
rychlostmi. S&nbsp;dal¹ím vývojem poèítaèù (zejména tìch s&nbsp;procesory Intel
Pentium, AMD K6 atd.) je zøetelný znaèný ústup v&nbsp;pou¾ívání sbìrnice
<i>VLB</i>, naopak se zaèíná prosazovat perspektivní sbìrnice <i>PCI</i> a
v&nbsp;posledních letech i její nástupce <i>PCI Express</i>.</p>

<image id="7345" original="no" />
<p-center><i>Obrázek 6: Grafická karta urèená do sbìrnice VESA Local Bus.
Pomìrnì typické je pøidru¾ení i dal¹ích funkcí na jednu kartu &ndash; zde
sériových a paralelních portù, IDE rozhraní atd. Pokud se taková karta zapojila
do základní desky, která ji¾ tyto obvody obsahovala, vìt¹inou do¹lo ke
konfliktu a pomocí jumperù se musely pøídavné funkce opìt zakázat. Podobná
obludná karta dodnes spolehlivì funguje v&nbsp;mém starém poèítaèi
s&nbsp;procesorem IBM Blue Lightning, co¾ je jedna z&nbsp;variant procesoru
486.</i></p-center>

<p>Jak ji¾ název sbìrnice <i>VESA Local Bus</i> napovídá, jedná se o sbìrnici
lokální, tj.&nbsp;sbìrnici, která pøímo sdílí datovou a adresovou èást
s&nbsp;mikroprocesorem poèítaèe (z&nbsp;toho také vychází ¹íøka datové èásti
&ndash; 32 bitù). To má mimo jiné za následek omezení maximálního poètu
pøipojených zaøízení na dvì, maximálnì a¾ na tøi, proto¾e vìt¹í poèet zaøízení
by pøíli¹ proudovì a impedanènì zatì¾oval procesorovou sbìrnici. Mohlo by
docházet i k&nbsp;odrazùm na adresových/datových vodièích, proto jsou konektory
lokální sbìrnice umístìny co nejblí¾e k&nbsp;mikroprocesoru. Také frekvence
sbìrnice je odvozena z&nbsp;vnìj¹í taktovací frekvence mikroprocesoru a mù¾e se
pohybovat v&nbsp;hodnotách od 33 MHz a¾ do 50 MHz (popravdì øeèeno jsem v¹ak
nevidìl kartu urèenou pro <i>VLB</i>, která by spolehlivì na 50 MHz pracovala,
mezní frekvence spolehlivé funkce vìt¹inou byla 40 MHz, co¾ odpovídá procesoru
486DX2 pracujícího na interní frekvenci 80 MHz èi 486DX4, který pracuje a¾ na
120 MHz).</p>

<image id="7346" original="no" />
<p-center><i>Obrázek 7: Pohled do vzdálené minulosti &ndash; karty urèené pro
¹estnáctibitovou sbìrnici ISA (nahoøe) a sbìrnici EISA (dole).</i></p-center>

<p>Sbìrnice <i>VESA Local Bus</i> podporovala takzvaný <i>burst re¾im</i>
pøenosu blokových dat. Jednalo se o zvlá¹tní mód, ve kterém se pøenesla v¾dy
jedna adresa a po ní ètyøi datová slova. Bylo tak mo¾né jednodu¹e a rychle
pøenést 4&times;32 bitù pouze v&nbsp;pìti sbìrnicových cyklech oproti osmi
cyklùm nutným pro pøenos ètyø dvojic adresa-data. Jak se budete moci doèíst
v&nbsp;dal¹ích kapitolách, je mo¾né u pokroèilej¹ích sbìrnic pou¾ít vylep¹enou
variantu <i>burst re¾imu</i>, ve kterém se po zadání jedné adresy a poètu
opakování mù¾e pøenést mnohem více dat, co¾ ve svém dùsledku vede k&nbsp;vy¹¹í
pøenosové rychlosti, nebo» se u¹etøí cykly nutné pro pøenos a dekódování
adresy.</p>

<p>Prakticky jedinou výhodou sbìrnice <i>VESA Local Bus</i> oproti dále popsané
sbìrnici <i>PCI</i> a <i>PCI Express</i>, je v&nbsp;nìkterých pøípadech vy¹¹í
pøenosová rychlost, zejména v&nbsp;tìch poèítaèích, kde je pou¾ita taktovací
frekvence sbìrnice 40 MHz a 50 MHz (pøi pou¾ití frekvence 40 MHz je mo¾né na
sbìrnici pøipojit maximálnì tøi zaøízení, na sbìrnici VLB o frekvenci 50 MHz je
v¹ak poèet teoreticky pøipojitelných zaøízení omezen na dvì, viz v¹ak poznámka
v&nbsp;pøedchozích odstavcích). Pøeva¾ují v¹ak nevýhody, mezi nì¾ patøí
zejména: dnes ji¾ prakticky neexistující podpora jak u výrobcù zaøízení pro
tuto sbìrnici, tak u producentù èipových sad základních desek (dnes se sbìrnice
<i>VLB</i> vyskytuje prakticky pouze v&nbsp;malém mno¾ství v&nbsp;prùmyslových
poèítaèích, ale i tam se jedná spí¹e o raritu), mo¾nost pøipojení omezeného
mno¾ství zaøízení a rùznorodá taktovací frekvence (která zpùsobuje komplikace
návrhu pøídavné karty). Po pøíchodu mikroprocesoru Intel Pentium na trh,
s&nbsp;ním¾ Intel uvedl také sbìrnici <i>PCI</i>, pøestává být o <i>VESA Local
Bus</i> zájem.</p>



<p><a name="k03"></a></p>
<h1>3. Univerzální sbìrnice PCI se pøedstavuje</h1>

<p>Sbìrnice <i>PCI</i> je v&nbsp;souèasné dobì stále (i pøes nástup
výkonnìj¹ích typù sbìrnic) nejpou¾ívanìj¹í sbìrnicí jak na osobních poèítaèích
typu IBM PC tak i na pracovních stanicích a serverech, které s&nbsp;IBM PC
kompatibilní nejsou. Tato sbìrnice byla navr¾ena firmou Intel ji¾ v&nbsp;roce
1992 a od té doby se stala oficiálním prùmyslovým standardem, který je
podporovaný mnoha výrobci periferních zaøízení i èipových sad základních desek
poèítaèù. Název sbìrnice <i>PCI</i> vznikl ze slovního spojení <i>Peripheral
Component Interface</i>. Dùvodem velké úspì¹nosti <i>PCI</i> na platformì PC
byly pøedev¹ím nevyhovující parametry pøedchozích sbìrnic: pùvodní osmibitová i
¹estnáctibitová sbìrnice <i>ISA</i> byla velmi pomalá s&nbsp;omezeným poètem
pøeru¹ení a nevyhovujícím DMA, <i>MCA</i> byla proprietárním øe¹ením od
konkurenèní a pomìrnì rigidní firmy IBM a <i>VESA Local Bus</i> byla pouze
sbìrnicí lokální (s&nbsp;mo¾ností pøipojení omezeného mno¾ství zaøízení) a
orientovanou pøedev¹ím na mikroprocesory øady 486. Pøedností <i>PCI</i> je i
podpora <i>Plug and Play</i>, tedy dynamické detekce a konfigurace zaøízení po
startu poèítaèe.</p>

<image id="7347" />
<p-center><i>Obrázek 8: Karty urèené pro sbìrnici PCI pravdìpodobnì není nutné
podrobnì pøedstavovat, setkal se s&nbsp;nimi prakticky ka¾dý u¾ivatel
poèítaèe.</i></p-center>

<p>Tato sbìrnice pou¾ívá multiplexované adresové a datové vodièe,
tj.&nbsp;podle momentálního stavu vybraných øídicích signálù se na jednìch
vodièích støídavì vystavuje adresa a posílají data nebo pøíkazy pro pøipojená
zaøízení. Tento (pro nìkteré úèely ponìkud diskutabilní) princip byl u
<i>PCI</i> pou¾it pøedev¹ím kvùli zachování ni¾¹í ceny celého systému, jeliko¾
vy¹¹í poèet vodièù by znamenal také nárùst komplikovanosti jak sbìrnice, tak i
pøipojených zaøízení. Se zvìt¹ujícím se poètem vodièù by samozøejmì souviselo i
zvìt¹ení konektorù a plo¹ných obvodù zaøízení, co¾ by mohlo vést i
k&nbsp;mechanickým problémùm pøi pøipojování karet (viz <i>VESA Local Bus</i>,
kde zastrèení karty do konektoru vy¾adovalo velkou sílu a trpìlivost, problémy
nìkdy bývají i s&nbsp;kartami urèenými do portu <i>AGP</i>, proto¾e jeho
konektor je více vzdálený od místa mechanického uchycení karty, ne¾ je tomu u
<i>PCI</i>).</p>



<p><a name="k04"></a></p>
<h1>4. Pøenosové rychlosti sbìrnice PCI</h1>

<p>Sbìrnice <i>PCI</i> existuje v&nbsp;nìkolika rùzných variantách, které se
li¹í pøedev¹ím úrovnìmi logických signálù, taktovací frekvencí
(tj.&nbsp;frekvencí hodinových pulsù sbìrnice) a ¹íøkou datové èásti sbìrnice.
Úroveò logických signálù (tj.&nbsp;napìtí logické jednièky &ndash; logická nula
se od tohoto napìtí odvozuje) mù¾e nabývat hodnoty buï 5 V nebo 3,3 V.
Taktovací frekvence a ¹íøka datové sbìrnice pøímo urèují maximální datový tok,
jak je ostatnì naznaèeno v&nbsp;následující tabulce. Zde je nutné upozornit na
fakt, ¾e u osobních poèítaèù typu IBM PC se v&nbsp;naprosté vìt¹inì pøípadù
vyskytuje nejpomalej¹í verze sbìrnice PCI, která je taktovaná na 33 MHz
s&nbsp;¹íøkou datové èásti sbìrnice 32 bitù a datovým tokem rovným 33 MHz
&times; 4B=132 MB.s<sup>-1</sup> (pro mnoho aplikací je to velmi rozumná
rychlost, a to i v&nbsp;pøípadì, ¾e se o ni dìlí více zaøízení). Rychlej¹í
varianty sbìrnice <i>PCI</i> na¹ly své uplatnìní ve specializovaných systémech,
které jsou orientovány zejména na zpracování vysokých datových tokù, napøíklad
pøi práci s&nbsp;videem èi komunikaci nìkolika rychlých diskù:</p>

<table>
<tr><th>Taktovací frekvence</th><th>©íøka datové èásti</th><th>Maximální datový tok</th></tr>
<tr><td> 33 MHz</td><td>32 bitù</td><td> 132 MB.s<sup>-1</sup></td></tr>
<tr><td> 33 MHz</td><td>64 bitù</td><td> 264 MB.s<sup>-1</sup></td></tr>
<tr><td> 66 MHz</td><td>32 bitù</td><td> 264 MB.s<sup>-1</sup></td></tr>
<tr><td> 66 MHz</td><td>64 bitù</td><td> 532 MB.s<sup>-1</sup></td></tr>
<tr><td>133 MHz</td><td>32 bitù</td><td> 532 MB.s<sup>-1</sup></td></tr>
<tr><td>133 MHz</td><td>64 bitù</td><td>1066 MB.s<sup>-1</sup></td></tr>
</table>

<p>Sbìrnice <i>PCI</i> tvoøí spolu s&nbsp;rychlou adresovou a datovou lokální
sbìrnicí mikroprocesoru, popø. i se star¹í sbìrnicí <i>ISA</i>, hierarchickou
strukturu, ve které jsou jednotlivé sbìrnice vzájemnì uspoøádány podle své
rychlosti a vzdálenosti (ve smyslu øídicích, oddìlovacích a budících obvodù) od
centrální procesorové jednotky &ndash; CPU. Kombinace <i>PCI+ISA</i> se ve
star¹ích poèítaèích vyskytuje pomìrnì èasto, nìkteré základní desky nabízí i
trojkombinaci <i>AGP+PCI+ISA</i>, dal¹í kombinace (napøíklad <i>PCI+VLB</i>) se
prakticky nevyskytují a ani nemají praktický význam.</p>

<image id="7348" />
<p-center><i>Obrázek 9: Ji¾ dvakrát prezentované schéma typického poèítaèe
s&nbsp;hierarchicky uspoøádanými sbìrnicemi.</i></p-center>



<p><a name="k05"></a></p>
<h1>5. Koncept <i>Plug and Play</i></h1>

<p>Z&nbsp;hlediska u¾ivatele poèítaèe èi programátora ovladaèù je pomìrnì velmi
dùle¾itý také koncept nazvaný <i>Plug and Play</i>, který se zaèal ve velké
míøe vyu¾ívat právì u <i>PCI</i> sbìrnice (díky problémùm s&nbsp;nìkterými
zaøízeními, BIOSy i operaèními systémy se tento koncept také nazýval <i>Plug
and Pray</i> :-). Koncepce <i>Plug and Play</i> je zalo¾ena na pou¾ití
takzvaných konfiguraèních registrù, jejich¾ obsah se pøi startu systému nastaví
programovì podle zji¹tìných typù a modifikací jednotlivých zaøízení pøipojených
na <i>PCI</i> sbìrnici. Odpadá tak mnohdy velmi slo¾ité øe¹ení konfliktù
vzniklých pou¾itím shodného pøeru¹ení èi stejné adresy v&nbsp;adresovém
prostoru zaøízení &ndash; nìkteré kombinace zaøízení dokonce ne¹ly na sbìrnici
ISA vyøe¹it (pamìtníci se jistì podìlí o zku¹enosti). Pomocí konfiguraèních
registrù je také mo¾né zjistit typ zaøízení (zvukové zaøízení, grafická karta,
ovladaè podøízené sbìrnice, LAN adaptér apod., skupiny zaøízení lze vyèíst ze
specifikace) a kód výrobce zaøízení &ndash; v¹echna zaøízení jsou uspoøádána do
stromové struktury, která obsahuje napøíklad vìtve pro grafické karty, zvukové
karty, sí»ová zaøízení, øadièe periferních zaøízení apod.</p>

<p>Kódy výrobcù, které by (teoreticky) mìly být certifikované, jsou
specifikovány ¹estnáctibitovým èíslem (Intel má napøíklad pøidìlené pìkné èíslo
8086), které je, spoleènì s&nbsp;èíslem zaøízení a pøidìlenými prostøedky,
zobrazené pøi inicializaci poèítaèe (druhá obrazovka, která dnes bohu¾el pouze
problikne, proto¾e zavadìèe moderních OS mají nepøíjemnou vlastnost, ¾e
zobrazují vlastní menu). Svoji konfiguraci, tj.&nbsp;zaøazení do stromu
zaøízení a rozsah adres èi I/O prostoru, si zaøízení uchovává buï v&nbsp;pamìti
ROM, EPROM èi nejèastìji v&nbsp;EEROM èi Flash pamìti. Zajímavì je øe¹en rozsah
adres, který dané zaøízení pro svoji èinnost potøebuje. Tento rozsah (èi
rozsahy) jsou takté¾ uchovány v&nbsp;konfiguraèních registrech (nazývaných
<i>BADRn</i>, neboli <i>Base Address n</i>, <i>n</i> je typicky èíslo od jedné
do pìti), ale konkrétní adresu zaøízení pøidìlí a¾ BIOS pøípadnì operaèní
systém. To mimo jiné znamená, ¾e pøi ka¾dém startu poèítaèe mù¾e být zaøízení
mapované do jiné oblasti èi oblastí pamìti. Pro samotné ovladaèe ani aplikace
to nepøedstavuje ¾ádný problém, proto¾e si mohou zjistit v¹echna zaøízení
pøipojená na sbìrnici a z&nbsp;nich si podle kódu výrobce, identifikace
zaøízení a dal¹í jednobytové polo¾ky (odli¹uje stejný typ zaøízení, napøíklad
dvì jinak zcela identické sí»ové karty) vybrat zaøízení se kterým budou
komunikovat.</p>



<p><a name="k06"></a></p>
<h1>6. Komunikace mikroprocesoru s&nbsp;zaøízením pøipojeným na PCI</h1>

<p>Mikroprocesor mù¾e k&nbsp;zaøízením pøipojeným ke sbìrnici <i>PCI</i>
pøistupovat pomocí nìkolika technologií. Na první pohled je nejjednodu¹¹í
pøístup pøes mapovanou pamì». Toto øe¹ení má nevýhodu v&nbsp;tom, ¾e se pøi
nesprávnì napsaném ovladaèi èi nekorektnì fungujícím zaøízení mù¾e celá
sbìrnice &bdquo;zaseknout&ldquo; a poèítaè pak pøestane reagovat. Dal¹í
mo¾ností je pou¾ití obousmìrné fronty (<i>FIFO</i>) nebo takzvaných
<i>mailboxù</i>, co¾ jsou registry, do kterých lze z&nbsp;jedné strany (CPU èi
zaøízení) informace zapisovat a z&nbsp;druhé strany tyto informace èíst.
K&nbsp;dispozici jsou samozøejmì pøíznaky ètení èi zápisu do mailboxù, stejnì
tak jako øízení pomocí pøeru¹ení, je¾ mù¾e být generováno jak pøi práci
s&nbsp;frontou FIFO, tak i pøi práci s&nbsp;mailboxy.</p>

<p>Nejrychlej¹ím typem pøenosu je <i>busmaster pøenos</i>, pøi kterém øízení
sbìrnice pøevezme samo zaøízení. Typicky se busmaster pøenos na stranì zaøízení
provádí pøes obousmìrné fronty a díky vyrovnávací pamìti, kterou fronty
pøedstavují (mohou mít kapacitu napøíklad ¹estnáct tøicetidvoubitových slov) se
reálná pøenosová rychlost mù¾e pøibli¾ovat rychlosti teoretické. Na PCI
kartách, pro které jsem vyvíjel ovládací programy, se tímto zpùsobem dosahovalo
reálné dlouhodobé (prùmìrné) pøenosové rychlosti cca 105 MB.s<sup>-1</sup>, co¾
se pøibli¾uje teoretické hranici (musíme vzít v&nbsp;úvahu to, ¾e se
zpracovávaná data pøená¹ela do operaèní pamìti, její¾ rychlost také není
nekoneèná, za sekundu probìhlo a bylo døíve èi pozdìji zpracováno nìkolik set
rùzných pøeru¹ení, samotný ovladaè také nebyl pøíli¹ optimálnì napsaný
atd.).</p>

<image id="7349" original="no" />
<p-center><i>Obrázek 10: Porovnání velikostí konektorù rùzných moderních
sbìrnic a portu AGP.</i></p-center>



<p><a name="k07"></a></p>
<h1>7. Obsah dal¹í èásti tohoto seriálu</h1>

<p>V&nbsp;následujícím pokraèování seriálu o architekturách poèítaèù si
popí¹eme pokraèovatele sbìrnice <i>PCI</i>. Jedná se o sbìrnici nazvanou <i>PCI
Express</i>, u ní¾ je mo¾né dosáhnout je¹tì vy¹¹ích pøenosových rychlostí, ne¾
u sbìrnice <i>PCI</i>. Také si popí¹eme princip práce interního portu
<i>AGP</i>, který slou¾í (èi pro nìkoho, kdo ji¾ pøe¹el na modernìj¹í
technologii, u¾ jen slou¾il) k&nbsp;pøipojení grafických karet a grafických
akcelerátorù. Øekneme si, jaké zvlá¹tní re¾imy port <i>AGP</i> obsahuje &ndash;
jedná se o re¾imy urèené pøevá¾nì pro &bdquo;grafické&ldquo; úèely, napøíklad
efektivní pøenos textur, sdílení grafických dat èi práce s&nbsp;videem.</p>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2008</small></p>
</body>
</html>

