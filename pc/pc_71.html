<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Osmibitové poèítaèe Commodore a èip VIC-II - dokonèení</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Osmibitové poèítaèe Commodore a èip VIC-II - dokonèení</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dne¹ním pokraèování seriálu o architekturách poèítaèù dokonèíme popis grafického èipu VIC-II. Øekneme si, jakým zpùsobem tento èip pracuje se sprity a takté¾ si uká¾eme nìkteré známé i ménì známé triky, které je mo¾né s tímto obvodem provádìt (napøíklad se jedná o zvý¹ení poètu barev èi souèasnì zobrazených spritù).</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. Spritová grafika na osmibitových poèítaèích</a><br />
<a href="#k02">2. Èip VIC-II a podpora zobrazení spritù</a><br />
<a href="#k03">3. Øídicí registry èipu VIC-II, pomocí nich¾ se øídí zobrazení spritù</a><br />
<a href="#k04">4. Sprity zobrazené v&nbsp;re¾imu hi-res</a><br />
<a href="#k05">5. Sprity zobrazené v&nbsp;re¾imu multi-color</a><br />
<a href="#k06">6. Zobrazení vìt¹ího mno¾ství spritù</a><br />
<a href="#k07">7. Dal¹í vlastnosti èipu VIC-II, zvý¹ení poètu barev v&nbsp;re¾imu FLI</a><br />
<a href="#k08">8. Re¾im IFLI</a><br />
<a href="#k09">9. Literatura a odkazy na Internetu</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. Spritová grafika na osmibitových poèítaèích</h1>

<p>Na nìkterých osmibitových domácích poèítaèích a takté¾ osmibitových herních
konzolích se ve hrách, ale i v&nbsp;dal¹ích aplikacích zamìøených na
poèítaèovou grafiku, èasto pou¾ívala mo¾nost zrychleného vykreslování
jednoduchých rastrových obrázkù nazývaných <i>sprity</i>. Generování obrazù
spritù na televizi èi obrazovce monitoru pøitom probíhalo nezávisle na
vykreslování ostatní scény (v&nbsp;tomto pøípadì nazývané pozadí &ndash;
<i>background</i>, popø.&nbsp;hrací plocha &ndash; <i>playground</i>), pøièem¾
bylo mo¾né definovat prioritu vykreslování, tj.&nbsp;zda bude ve výsledném
obrázku upøednostnìn pixel z&nbsp;pozadí nebo ze spritu. Grafické subsystémy
tìchto poèítaèù, které podporovaly práci se sprity, také vìt¹inou obsahovaly
takzvané <i>kolizní registry</i>, do kterých se ukládaly pøíznaky pøekryvu
pozadí se sprity (kolize spritu s&nbsp;barvou pozadí) nebo mezi nìkolika sprity
navzájem (kolize spritù). Tím se pøi práci s&nbsp;pohyblivými obrazy pøedmìtù
nemusely provádìt zdlouhavé testy mezi v¹emi zobrazovanými pixely, postaèilo
pouze pøeèíst stav z&nbsp;kolizních registrù.</p>

<img src="http://i.iinfo.cz/images/488/pc7101.png" width="336" height="240" alt="pc7101" />
<p><i>Obrázek 1: Screenshot ze hry Starquake ve verzi pro osmibitové poèítaèe
Atari. Tyto poèítaèe podporovaly vykreslování ètyø jednobarevných spritù (ka¾dý
sprite samozøejmì mohl mít jinou barvu), jejich¾ rozli¹ení bylo 8&times;128
resp.&nbsp;8&times;256 pixelù a dále ètyø takzvaných støel, co¾ byly sprity
zú¾ené na 2&times;128 nebo 2&times;256 pixelù (v¹echny støely se navíc mohly
spojit do pátého spritu). Hrací plocha hry Starquake je vytvoøena
v&nbsp;monochromatickém grafickém re¾imu èíslo ANTIC 15 (GRAPHICS 8), ov¹em
hráè je vykreslen pomocí spritu, tj.&nbsp;mù¾e mít barvu odli¹nou od okolní
scény a mù¾e se pohybovat v&nbsp;horizontálním i vertikálním smìru bez nutnosti
pøesunù dat v&nbsp;obrazové pamìti.</i></p>

<p>U vìt¹iny osmibitových poèítaèù, které podporovaly vykreslování spritù, byly
video pamìti urèené pro ulo¾ení pozadí (hrací plochy) a pamìti pro ulo¾ení
rastrových dat spritù od sebe oddìleny a teprve a¾ v&nbsp;prùbìhu vykreslování
na obrazovku se provedla kombinace pixelù pozadí a pixelù ulo¾ených ve spritech
&ndash; viz druhý obrázek. Sprity byly poprvé pou¾ity v&nbsp;dnes ji¾
zapomenutém poèítaèi <i>Elektor TV Games Computer</i> z&nbsp;roku 1979. Pozdìji
byly podporovány napøíklad na ji¾ popsaných osmibitových poèítaèích Atari, na
poèítaèi Commodore C64 (viz dal¹í kapitoly) a v&nbsp;pozdìj¹í dobì i na
slavných poèítaèích Amiga. U prvních typù grafických karet pro personální
poèítaèe (IBM PC) se podpora spritù zcela vytratila, aby se s&nbsp;velkou
slávou (jako pøevratná novinka :-) objevila u nìkterých karet typu SVGA, kde se
sprity pou¾ívaly pøedev¹ím pro zobrazení kurzoru my¹i nezávisle na zobrazeném
pozadí. S&nbsp;nástupem 2D a 3D akcelerátorù bylo mo¾né sprity nahradit obrázky
èi texturami s&nbsp;alfa kanálem, tj.&nbsp;s&nbsp;mo¾ností pøiøazení
prùhlednosti nìkterým pixelùm èi texelùm. Je zde v¹ak jeden dùle¾itý rozdíl:
zatímco u osmibitových poèítaèù se sprity vytváøely zcela nezávisle na pozadí a
vykreslovaly se a¾ kombinací barev pixelù pøi jejich ètení z&nbsp;pamìti, u
moderních grafických akcelerátorù jsou v¹echny grafické údaje zapsány spoleènì
do <i>framebufferu</i>, ze kterého mohou být následnì pøeèteny a
vykresleny.</p>

<img src="http://i.iinfo.cz/images/182/pc6904.png" width="400" height="350" alt="pc6904" />
<p><i>Obrázek 2: Tok dat mezi operaèní pamìtí, mikroprocesorem a èipy ANTIC i
GTIA pøi generování video signálu na osmibitových poèítaèích Atari.</i></p>



<p><a name="k02"></a></p>
<h1>2. Èip VIC-II a podpora zobrazení spritù</h1>

<p>Grafický èip <i>VIC-II</i> pou¾itý v&nbsp;poèítaèi Commodore C64 podporuje,
podobnì jako obvod <i>GTIA</i> u osmibitových Atari, práci se sprity. Spritù
mù¾e být (pokud není pou¾ita nìkterá z&nbsp;technik popsaných v&nbsp;dal¹ím
textu) souèasnì zobrazeno osm, pøièem¾ ka¾dý sprite má velikost 24&times;21
pixelù v&nbsp;monochromatickém (<i>hi-res</i>) re¾imu nebo 12&times;21 pixelù
v&nbsp;re¾imu <i>multi-color</i>. Pomocí vhodnì naprogramované pøeru¹ovací
rutiny je v¹ak mo¾né zobrazit i více spritù &ndash; vyu¾ívá se zmìna vertikální
polohy nìkterého ji¾ vykresleného spritu, co¾ znamená, ¾e omezení na osm spritù
ve skuteènosti platí pouze pro jeden obrazový øádek. Ze ètyøiceti sedmi
øídicích osmibitových registrù èipu <i>VIC-II</i> je jich plných 34 urèeno pro
ovládání spritù. U spritù je mo¾né nastavovat jejich horizontální i vertikální
polohu, barvu, velikost (zvìt¹ení ve smìru horizontální a/nebo vertikální osy),
grafický re¾im (<i>hi-res</i>, <i>multi-color</i>) a kolize typu sprite-sprite
a sprite-bitmapa. Také je mo¾né mìnit prioritu spritù vùèi pozadí, vzájemná
priorita spritù je v¹ak nemìnná a je urèena èíslem spritu.</p>

<img src="http://i.iinfo.cz/images/574/pc7103.jpg" width="370" height="261" alt="pc7103" />
<p><i>Obrázek 3: Osm ètyøbarevných spritù zobrazených v&nbsp;re¾imu
multi-color.</i></p>

<p>Zpùsob zobrazení spritù nezávisle na pozadí je v&nbsp;èipu <i>VIC-II</i>
øe¹en podobným zpùsobem, jako u ji¾ popsaného èipu <i>GTIA</i> pou¾ívaného u
osmibitových poèítaèù Atari. Hlavní rozdíl (spí¹e roz¹íøení) spoèívá
v&nbsp;mo¾nosti vertikálního posunu spritù a takté¾ v&nbsp;mo¾nosti jejich
zobrazení ve více barvách.</p>

<pre>
 IRQ &lt;---------------------------------+
                                       |
            +---------------+ +-----------------+
            |Refresh counter| | Interrupt logic |&lt;----------------------+
            +---------------+ +-----------------+                       |
        +-+    |               ^                                        |
  A     |M|    v               |                                        |
  d     |e|   +-+    +--------------+  +-------+                        |
  d     |m|   |A|    |Raster counter|-&gt;| VC/RC |                        |
  r     |o|   |d| +-&gt;|      X/Y     |  +-------+                        |
  . &lt;==&gt;|r|   |d| |  +--------------+      |                            |
  +     |y|   |r| |     | | |              |                            |
  d     | |   |.|&lt;--------+----------------+ +------------------------+ |
  a     |i|   |g|===========================&gt;|40×12 bit video matrix-/| |
  t     |n|&lt;=&gt;|e| |     |   |                |       color line       | |
  a     |t|   |n| |     |   |                +------------------------+ |
        |e|   |e| |     |   |                            ||             |
        |r|   |r| |     |   | +----------------+         ||             |
 BA  &lt;--|f|   |a|============&gt;|8×24 bit sprite |         ||             |
        |a|   |t|&lt;----+ |   | |  data buffers  |         ||             |
 AEC &lt;--|c|   |o| |   | v   | +----------------+         ||             |
        |e|   |r| | +-----+ |         ||                 ||             |
        +-+   +-+ | |MC0-7| |         \/                 \/             |
                  | +-----+ |  +--------------+   +--------------+      |
                  |         |  | Sprite data  |   |Graphics data |      |
        +---------------+   |  |  sequencer   |   |  sequencer   |      |
 RAS &lt;--|               |   |  +--------------+   +--------------+      |
 CAS &lt;--|Clock generator|   |              |         |                  |
 &Phi;0  &lt;--|               |   |              v         v                  |
        +---------------+   |       +-----------------------+           |
                ^           |       |          MUX          |           |
                |           |       | Sprite priorities and |-----------+
 &Phi;IN -----------+           |       |  collision detection  |
                            |       +-----------------------+
   VC: Video Matrix Counter |                   |
                            |                   v
   RC: Row Counter          |            +-------------+
                            +-----------&gt;| Border unit |
   MC: MOB Data Counter     |            +-------------+
                            |                   |
                            v                   v
                    +----------------+  +----------------+
                    |Sync generation |  |Color generation|&lt;-------- øCOLOR
                    +----------------+  +----------------+
                                   |      |
                                   v      v
                                 Video output
                               (S/LUM and COLOR)
</pre>



<p><a name="k03"></a></p>
<h1>3. Øídicí registry èipu VIC-II, pomocí nich¾ se øídí zobrazení spritù</h1>

<p>V&nbsp;následující tabulce jsou vypsány ty øídicí registry èipu
<i>VIC-II</i>, pomocí nich¾ je mo¾né zvolit zpùsob zobrazení spritù na
obrazovce, mìnit souøadnice spritù (registry 0 a¾ 16) a popø.&nbsp;pøeèíst
pøíznaky kolize spritù (registr 30 a 31). Pov¹imnìte si, ¾e vzhledem
k&nbsp;horizontálnímu rozli¹ení èipu <i>VIC-II</i>, tj.&nbsp;320 pixelùm, je
nutné horizontální souøadnice spritù ulo¾it do devíti bitù, pøièem¾ hodnoty
nejvy¹¹ích bitù jsou pro v¹echny sprity sdru¾eny do øídicího registru èíslo 16.
Takté¾ je mo¾né pro ka¾dý sprite zvolit barvu nezávisle na barvách ostatních
spritù (a samozøejmì nezávisle na barvì pozadí) èi zvìt¹it sprite
v&nbsp;horizontálním èi vertikálním smìru (registr 23 a 29). Zmìnou hodnoty
ulo¾ené v&nbsp;registru èíslo 21 lze libovolný sprite povolit èi zakázat.
Význam nìkterých øídicích registrù bude popsán v&nbsp;navazujících
kapitolách.</p>

<pre>
 #| Adr.  |Bit7|Bit6|Bit5|Bit4|Bit3|Bit2|Bit1|Bit0| Function
--+-------+----+----+----+----+----+----+----+----+------------------------
 0| $d000 |                  M0X                  | X coordinate sprite 0
--+-------+---------------------------------------+------------------------
 1| $d001 |                  M0Y                  | Y coordinate sprite 0
--+-------+---------------------------------------+------------------------
 2| $d002 |                  M1X                  | X coordinate sprite 1
--+-------+---------------------------------------+------------------------
 3| $d003 |                  M1Y                  | Y coordinate sprite 1
--+-------+---------------------------------------+------------------------
 4| $d004 |                  M2X                  | X coordinate sprite 2
--+-------+---------------------------------------+------------------------
 5| $d005 |                  M2Y                  | Y coordinate sprite 2
--+-------+---------------------------------------+------------------------
 6| $d006 |                  M3X                  | X coordinate sprite 3
--+-------+---------------------------------------+------------------------
 7| $d007 |                  M3Y                  | Y coordinate sprite 3
--+-------+---------------------------------------+------------------------
 8| $d008 |                  M4X                  | X coordinate sprite 4
--+-------+---------------------------------------+------------------------
 9| $d009 |                  M4Y                  | Y coordinate sprite 4
--+-------+---------------------------------------+------------------------
10| $d00a |                  M5X                  | X coordinate sprite 5
--+-------+---------------------------------------+------------------------
11| $d00b |                  M5Y                  | Y coordinate sprite 5
--+-------+---------------------------------------+------------------------
12| $d00c |                  M6X                  | X coordinate sprite 6
--+-------+---------------------------------------+------------------------
13| $d00d |                  M6Y                  | Y coordinate sprite 6
--+-------+---------------------------------------+------------------------
14| $d00e |                  M7X                  | X coordinate sprite 7
--+-------+---------------------------------------+------------------------
15| $d00f |                  M7Y                  | Y coordinate sprite 7
--+-------+----+----+----+----+----+----+----+----+------------------------
16| $d010 |M7X8|M6X8|M5X8|M4X8|M3X8|M2X8|M1X8|M0X8| MSBs of X coordinates
--+-------+----+----+----+----+----+----+----+----+------------------------
21| $d015 | M7E| M6E| M5E| M4E| M3E| M2E| M1E| M0E| Sprite enabled
--+-------+----+----+----+----+----+----+----+----+------------------------
23| $d017 |M7YE|M6YE|M5YE|M4YE|M3YE|M2YE|M1YE|M0YE| Sprite Y expansion
--+-------+----+----+----+----+----+----+----+----+------------------------
27| $d01b |M7DP|M6DP|M5DP|M4DP|M3DP|M2DP|M1DP|M0DP| Sprite data priority
--+-------+----+----+----+----+----+----+----+----+------------------------
28| $d01c |M7MC|M6MC|M5MC|M4MC|M3MC|M2MC|M1MC|M0MC| Sprite multicolor
--+-------+----+----+----+----+----+----+----+----+------------------------
29| $d01d |M7XE|M6XE|M5XE|M4XE|M3XE|M2XE|M1XE|M0XE| Sprite X expansion
--+-------+----+----+----+----+----+----+----+----+------------------------
30| $d01e | M7M| M6M| M5M| M4M| M3M| M2M| M1M| M0M| Sprite-sprite collision
--+-------+----+----+----+----+----+----+----+----+------------------------
31| $d01f | M7D| M6D| M5D| M4D| M3D| M2D| M1D| M0D| Sprite-data collision
--+-------+----+----+----+----+----+----+----+----+------------------------
37| $d025 |  - |  - |  - |  - |        MM0        | Sprite multicolor 0
--+-------+----+----+----+----+-------------------+------------------------
38| $d026 |  - |  - |  - |  - |        MM1        | Sprite multicolor 1
--+-------+----+----+----+----+-------------------+------------------------
39| $d027 |  - |  - |  - |  - |        M0C        | Color sprite 0
--+-------+----+----+----+----+-------------------+------------------------
40| $d028 |  - |  - |  - |  - |        M1C        | Color sprite 1
--+-------+----+----+----+----+-------------------+------------------------
41| $d029 |  - |  - |  - |  - |        M2C        | Color sprite 2
--+-------+----+----+----+----+-------------------+------------------------
42| $d02a |  - |  - |  - |  - |        M3C        | Color sprite 3
--+-------+----+----+----+----+-------------------+------------------------
43| $d02b |  - |  - |  - |  - |        M4C        | Color sprite 4
--+-------+----+----+----+----+-------------------+------------------------
44| $d02c |  - |  - |  - |  - |        M5C        | Color sprite 5
--+-------+----+----+----+----+-------------------+------------------------
45| $d02d |  - |  - |  - |  - |        M6C        | Color sprite 6
--+-------+----+----+----+----+-------------------+------------------------
46| $d02e |  - |  - |  - |  - |        M7C        | Color sprite 7
--+-------+----+----+----+----+-------------------+------------------------
</pre>

<img src="http://i.iinfo.cz/images/669/pc7104.png" width="368" height="270" alt="pc7104" />
<p><i>Obrázek 4: S&nbsp;vyu¾itím jednoduchého triku je mo¾né zobrazit i více
spritù ne¾ osm, jak je ukázáno na tomto screenshotu. Jediné omezení spoèívá
v&nbsp;tom, ¾e se na jednom obrazovém øádku nesmí vyskytovat více ne¾ osm
spritù, jejich celkový poèet je limitován pouze výpoèetním výkonem
mikroprocesoru.</i></p>



<p><a name="k04"></a></p>
<h1>4. Sprity zobrazené v&nbsp;re¾imu hi-res</h1>

<p>Sprity podporované èipem <i>VIC-II</i> mohou být zobrazeny, podobnì jako
pozadí (viz pøedchozí èást tohoto seriálu), buï v&nbsp;re¾imu <i>hi-res</i>
(vy¹¹í horizontální rozli¹ení, jeden bit na pixel) nebo <i>multi-color</i>
(polovièní horizontální rozli¹ení, dva bity na pixel). Re¾im zobrazení ka¾dého
spritu lze nastavit pøíslu¹ným bitem v&nbsp;registru 28 (sprite multicolor).
Nejprve si popí¹eme zpùsob zobrazení spritu v&nbsp;re¾imu <i>hi-res</i>.
V&nbsp;tomto re¾imu má sprite rozli¹ení 24&times;21 pixelù, pøièem¾ ka¾dý pixel
je reprezentován pouze jediným bitem. Z&nbsp;toho vyplývá, ¾e bitmapa se
spritem má velikost 63 bytù, proto¾e 24&times;21/8=63. V&nbsp;pøípadì, ¾e má
bit odpovídající pixelu ve spritu hodnotu 0, jedná se o prùhledný pixel,
tj.&nbsp;pøíslu¹ným pixelem mù¾e prosvítat buï jiný sprite nebo pozadí
(v&nbsp;závislosti na tom, o který sprite se jedná). Pokud je bit odpovídající
danému pixelu nastavený na hodnotu 1, je pixel vybarven barvou pøeètenou
z&nbsp;øídicího registru 39-46, opìt v&nbsp;závislosti na tom, o který sprite
0-7 se jedná. Pomocí øídicího registru 23 a 29 je mo¾né zvolit zvìt¹ení spritu
v&nbsp;horizontální èi vertikální ose. Pokud je bit pøíslu¹ný danému spritu
nastaven na jednièku, je sprite 2&times; zvìt¹en buï v&nbsp;horizontální
(registr 29) èi vertikální (registr 23) ose, tj.&nbsp;nezmìní se rozli¹ení
spritu ale velikost jeho pixelù.</p>

<img src="http://i.iinfo.cz/images/287/pc7105.png" width="320" height="200" alt="pc7105" />
<p>&nbsp;</p>



<p><a name="k05"></a></p>
<h1>5. Sprity zobrazené v&nbsp;re¾imu multi-color</h1>

<p>V&nbsp;pøípadì, ¾e je mód zobrazení spritu nastavený do re¾imu
<i>multi-color</i>, jsou pro ka¾dý pixel ve spritu vyhrazeny dva bity. Velikost
obsazené pamìti zùstává zachována &ndash; 63 bajtù, ov¹em horizontální
rozli¹ení spritu se v&nbsp;tomto re¾imu sni¾uje na 12 pixelù a pixely mají
dvojnásobnou ¹íøku oproti re¾imu <i>hi-res</i>. Vzhledem k&nbsp;tomu, ¾e je
pomocí dvou bitù mo¾né zakódovat celkem ètyøi stavy, je urèení barvy pixelu
zajímavìj¹í ne¾ v&nbsp;re¾imu <i>hi-res</i>. V¹echny sprity spolu sdílí dvì
spoleèné barvy z&nbsp;barvové palety, pøièem¾ indexy tìchto barev jsou ulo¾eny
v&nbsp;øídicích registrech 37 a 38. Tøetí barva je pro ka¾dý sprite
individuální &ndash; viz øídicí registry 39-46. Poslední bitová kombinace
odpovídá pozadí, tj.&nbsp;v&nbsp;tomto pøípadì je pixel spritu prùhledný. I
v&nbsp;re¾imu <i>multi-color</i> je mo¾né sprity zvìt¹it v&nbsp;horizontální i
vertikální ose, ov¹em s&nbsp;tím rozdílem, ¾e zvìt¹ení v&nbsp;ose horizontální
je buï dvojnásobné nebo ètyønásobné oproti základní velikosti pixelu
(odpovídající grafickému re¾imu <i>hi-res</i>).</p>

<img src="http://i.iinfo.cz/images/87/pc7106.png" width="320" height="200" alt="pc7106" />
<p>&nbsp;</p>



<p><a name="k06"></a></p>
<h1>6. Zobrazení vìt¹ího mno¾ství spritù</h1>

<p>V&nbsp;pøedchozích kapitolách jsme si øekli, ¾e bitmapa ka¾dého spritu je
v¾dy ulo¾ena v&nbsp;63 bajtech, bez ohledu na to, zda se jedná o sprite
zobrazovaný v&nbsp;re¾imu <i>hi-res</i> èi <i>multi-color</i>. Tìchto 63 bajtù
je umístìno v&nbsp;adresovém prostoru o velikosti 16 kB, do kterého má
v&nbsp;daném okam¾iku èip <i>VIC-II</i> pøístup (minule jsme si øekli, ¾e tento
èip doká¾e pøímo adresovat pouze 16 kB pamìti, jeliko¾ má na adresovou sbìrnici
vyvedeno pouze 14 vodièù). Mikroprocesor mù¾e zmìnit poèáteèní adresu bitmapy
reprezentující sprite v&nbsp;krocích po 64 bajtech, co¾ mj.&nbsp;znamená, ¾e
zmìna zobrazovaného tvaru je velmi rychlá &ndash; jedná se o pøepis jediného
bajtu. Pokud programátor doká¾e ve chvíli, kdy elektronový paprsek neprovádí
vykreslování, zmìnit adresu, na které se nachází bitmapa spritu, souøadnice
spritu a popø.&nbsp;i jeho barvu (barvy), je mo¾né zvý¹it celkový poèet
zobrazitelných spritù z&nbsp;pùvodních osmi a¾ na øádovì stovky. Platí zde
jediné omezení &ndash; na jednom obrazovém øádku se vykreslí pouze osm pixelù,
jejich¾ podobu není mo¾né mìnit. Dùvodem je to, ¾e <i>VIC-II</i> si na zaèátku
ka¾dého obrazového øádku pøeète aktuální øádek ka¾dého spritu (tj.&nbsp;tøi
bajty) do svých interních bufferù, které jsou na vý¹e zobrazeném blokovém
schématu oznaèeny &bdquo;8x24 bit sprite data buffers&ldquo;. Právì díky tomu,
¾e je obsah tìchto bufferù obnovován v&nbsp;ka¾dém obrazovém øádku, je umo¾nìno
zvý¹ení celkového poètu spritù i postupná zmìna jejich souøadnic.</p>

<img src="http://i.iinfo.cz/images/613/pc7107.gif" width="370" height="262" alt="pc7107" />
<p><i>Obrázek 7: Demo, ve kterém se souèasnì (na jedné obrazovce) zobrazuje 144
spritù.</i></p>



<p><a name="k07"></a></p>
<h1>7. Dal¹í vlastnosti èipu VIC-II, zvý¹ení poètu barev v&nbsp;re¾imu FLI</h1>

<p>Ke grafickému èipu <i>VIC-II</i> bylo mo¾né pøipojit svìtelné pero. Pøi
stisku tlaèítka na svìtelném peru se na základì výpoètu souøadnic elektronového
paprsku, který vykresluje obraz, zaznamenala <i>x</i>-ová a <i>y</i>-ová
souøadnice pera. Obì souøadnice se v¹ak ukládaly pouze do osmi bitù, to
znamená, ¾e <i>x</i>-ová souøadnice mìla polovièní pøesnost ne¾ rozli¹ení
obrazovky. Jinými slovy &ndash; horizontální souøadnici bylo mo¾né zjistit
s&nbsp;pøesností na dva pixely. Ov¹em pro vìt¹inu u¾ivatelù byly dùle¾itìj¹í
jiné vlastnosti èipu <i>VIC-II</i>, které do znaèné míry zapøíèinily úspì¹nost
a oblíbenost C64. Tyto vlastnosti budou popsány v&nbsp;následujících
odstavcích.</p>

<img src="http://i.iinfo.cz/images/519/pc7108-prev.png" width="370" height="261" alt="pc7108" />
<p><i>Obrázek 8: Statický obrázek vytvoøený v&nbsp;re¾imu FLI.</i></p>

<p>Pomocí podprogramù spou¹tìných pøi pøeru¹ení (<i>interrupt</i>) vyvolávaného
v&nbsp;prùbìhu zpìtného horizontálního a vertikálního bìhu elektronového
paprsku obrazovky, tj.&nbsp;v&nbsp;dobì, kdy nedocházelo k&nbsp;pøímým zmìnám
obrazu, bylo mo¾né vytváøet rùzné grafické efekty, napøíklad vý¹e popsané
zobrazení více spritù. Pravdìpodobnì nejzajímavìj¹ím efektem byl trik takzvaný
<i>FLI &ndash; Flexible Line Interpretation</i>, ve kterém se vyu¾ívalo
pøeprogramování èipu <i>VIC-II</i> tak, aby se barvové atributy nenaèítaly a¾
po zobrazení osmi øádkù, ale na ka¾dém obrazovém øádku zvlá¹» (barvové atributy
si èip uchovával v&nbsp;bloku 40&times;12 bitù, který je zobrazený na vý¹e
uvedeném blokovém schématu). Tímto zpùsobem bylo mo¾né mìnit barvovou paletu
(pøesnìji ètyøi souèasnì pou¾itelné dostupné barvy) nikoli v&nbsp;blocích
8&times;8 resp. 4&times;8 pixelù, ale v&nbsp;bloku 8&times;1 resp. 4&times;1
pixelù. Zvý¹ilo se tak barevné rozli¹ení rastrové grafiky. Tento trik byl
pou¾íván ve velké míøe pro statické obrazy a podporovaly ho i nìkteré grafické
editory &ndash; viz té¾ screenshoty 8 a 9.</p>

<img src="http://i.iinfo.cz/images/18/pc7109.png" width="370" height="264" alt="pc7109" />
<p><i>Obrázek 9: Dal¹í statický obrázek, pro jeho¾ zobrazení byl pou¾it re¾im
FLI.</i></p>



<p><a name="k08"></a></p>
<h1>8. Re¾im IFLI</h1>

<p>Dal¹ím re¾imem, který se pou¾íval pro zvý¹ení poètu souèasnì zobrazených
barev, se nazýval <i>IFLI</i>, co¾ je zkratka celého názvu <i>Interlaced
Flexible Line Interpretation</i>. Ve své podstatì se jedná o kombinaci dvou
grafických efektù. První efekt &ndash; <i>FLI</i> &ndash; jsme si ve struènosti
popsali v&nbsp;pøedchozí kapitole. Druhý souèasnì aplikovaný efekt spoèívá ve
vyu¾ití dvou samostatných obrázkù, které jsou pøi vykreslování na obrazovce
neustále pøepínány &ndash; v&nbsp;sudém pùlsnímku je vykreslen první obrázek,
v&nbsp;pùlsnímku lichém obrázek sudý, navíc jsou snímky oproti sobì posunuty o
jeden pixel (pøepínání snímkù je snadné &ndash; pøes I/O port je mo¾né zmìnit
pamì»ovou banku, ze které èip <i>VIC-II</i> naèítá barvové atributy i vlastní
bitmapu). Tento efekt je tedy nutné naèasovat pøesnì na dobu, kdy probíhá
vertikální zpìtný bìh elektronového paprsku. Vlivem rychlého pøepínání mezi
dvojicí barev na plo¹e jednoho pixelu je mo¾né dosáhnout zdánlivého výskytu
tøetí barvy, která dokonce ani nemusí le¾et v&nbsp;barvové paletì standardních
¹estnácti barev C64. Tento re¾im samozøejmì vy¾aduje dvojnásobné mno¾ství
obrazové pamìti a v&nbsp;pøípadì, ¾e na obou obrázcích jsou rozdíly vìt¹í ne¾
nìkolik desítek pixelù, mù¾e být poblikávání nepøíjemné.</p>

<img src="http://i.iinfo.cz/images/608/pc7110.gif" width="273" height="200" alt="pc7110" />
<p><i>Obrázek 10: Statický obrázek vykreslený v&nbsp;re¾imu IFLI.</i></p>



<p><a name="k09"></a></p>
<h1>9. Literatura a odkazy na Internetu</h1>

<ol>

<li>Sprite (computer graphics)<br />
<a href="http://en.wikipedia.org/wiki/Sprite_(computer_graphics)">http://en.wikipedia.org/wiki/Sprite_(computer_graphics)</a>
</li>

<li>Sprite (poèítaèová grafika)<br />
<a href="http://cs.wikipedia.org/wiki/Sprite_(poèítaèová_grafika)">http://cs.wikipedia.org/wiki/Sprite_(poèítaèová_grafika)</a>
</li>

<li>Elektor TV Games Computer<br />
<a href="http://en.wikipedia.org/wiki/Elektor_TV_Games_Computer">http://en.wikipedia.org/wiki/Elektor_TV_Games_Computer</a>
</li>

<li>C64.com<br />
<a href="http://www.c64.com/">http://www.c64.com/</a>
</li>

<li>C64 Wiki<br />
<a href="http://www.c64-wiki.com/index.php/C64">http://www.c64-wiki.com/index.php/C64</a>
</li>

<li>The MOS 6567/6569 video controller (VIC-II) and its application in the Commodore 64<br />
<a href="http://www.zimmers.net/cbmpics/cbm/c64/vic-ii.txt">http://www.zimmers.net/cbmpics/cbm/c64/vic-ii.txt</a>
</li>

<li>Wikipedia: Commodore 64<br />
<a href="http://en.wikipedia.org/wiki/C64">http://en.wikipedia.org/wiki/C64</a>
</li>

<li>Wikipedia: Video Display Controller<br />
<a href="http://en.wikipedia.org/wiki/Video_Display_Controller">http://en.wikipedia.org/wiki/Video_Display_Controller</a>
</li>

<li>Wikipedia: MOS Technology VIC-II<br />
<a href="http://en.wikipedia.org/wiki/MOS_Technology_VIC-II">http://en.wikipedia.org/wiki/MOS_Technology_VIC-II</a>
</li>

<li>Wikipedia: List of Commodore 64 games<br />
<a href="http://en.wikipedia.org/wiki/List_of_Commodore_64_games">http://en.wikipedia.org/wiki/List_of_Commodore_64_games</a>
</li>

<li>Wikipedia: Commodore 64 demos<br />
<a href="http://en.wikipedia.org/wiki/Commodore_64_demos">http://en.wikipedia.org/wiki/Commodore_64_demos</a>
</li>

</ol>

<img src="http://i.iinfo.cz/images/129/pc7111.gif" width="288" height="188" alt="pc7111" />
<p><i>Obrázek 11: Dal¹í statický obrázek vykreslený v&nbsp;re¾imu IFLI.</i></p>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2009</small></p>
</body>
</html>

