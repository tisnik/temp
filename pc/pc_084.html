<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Poèátky grafiky na PC: grafické karty CGA a Hercules</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Poèátky grafiky na PC: grafické karty CGA a Hercules</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h2>Úvodník</h2>

<p></p>



<h2>Obsah</h2>

<p><a href="#k01">1. Standardní monochromatický grafický re¾im karty CGA: 640&times;200</a></p>
<p><a href="#k02">2. Standardní ètyøbarevný grafický re¾im karty CGA: 320&times;200</a></p>
<p><a href="#k03">3. Zmìna øídicích registrù karty CGA a nestandardní re¾imy zobrazování</a></p>
<p><a href="#k04">4. Grafická karta Hercules &ndash; první vá¾nìj¹í konkurence IBM</a></p>
<p><a href="#k05">5. Technické parametry karty Hercules</a></p>
<p><a href="#k06">6. Textový re¾im karty Hercules</a></p>
<p><a href="#k07">7. Grafický re¾im karty Hercules</a></p>
<p><a href="#k08">8. Hercules GRAFIX BIOS interface</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Standardní monochromatický grafický re¾im karty CGA: 640&times;200</h2>

<p>V&nbsp;pøedchozí èásti seriálu o architekturách poèítaèù jsme si popsali
základní parametry grafických karet <i>MDA</i> (<i>Monochrome Display
Adapter</i>) a <i>CGA</i> (<i>Color Graphics Adapter</i>). Víme ji¾, ¾e se
jedná o první grafické karty urèené pro poèítaèe PC, které v&nbsp;roce 1981
zaèala zákazníkùm nabízet firma IBM. Zatímco karta <i>MDA</i> podporovala pouze
textový re¾im s&nbsp;25 øádky a 80 znaky na øádek, lze na kartì <i>CGA</i>
pracovat i s&nbsp;grafickými re¾imy, pøièem¾ parametry tìchto re¾imù
(rozli¹ení, poèet obrazových øádkù, èasování synchronizaèních signálù) bylo
mo¾né nastavovat pomocí konfiguraèních registrù èipu <i>Motorola MC6845</i> a
pomocného obvodu, který pøevádìl hodnoty naèítané z&nbsp;video pamìti na barvy
pixelù.</p>

<a href="http://i.iinfo.cz/images/360/pc84-1.png"><img src="http://i.iinfo.cz/images/360/pc84-1-prev.png" alt="pc84" height="231" width="370" /></a>
<p><i>Obrázek 1: Hra Spacewar (resp.&nbsp;její úprava pro IBM PC) bì¾ící
v&nbsp;grafickém re¾imu 640&times;200 pixelù karty CGA.</i></p>

<p>Vzhledem k&nbsp;tomu, ¾e pøímá zmìna hodnot konfiguraèních registrù pøi
nastavování grafického re¾imu je pomìrnì slo¾itá a nìkteré hodnoty dokonce
mohly vést ke znièení pøipojeného monitoru (elektronika tehdej¹ích monitorù
byla velmi jednoduchá a pøedev¹ím &ndash; nejednalo se o multifrekvenèní
monitory, které jsou vùèi nekorektnímu nastavení ji¾ odolnìj¹í), byly do BIOSu
zavedeny slu¾by urèené jak pro nastavení grafických èi textových re¾imù, tak i
slu¾by umo¾òující provádìní základních grafických operací &ndash; výpis znaku,
vykreslení pixelu, posun kurzoru, pøeètení hodnoty pixelu atd. V&nbsp;pøípadì
grafické karty <i>CGA</i> byly pomocí slu¾eb BIOSu dostupné dva re¾imy &ndash;
monochromatický re¾im s&nbsp;rozli¹ením 640&times;200 pixelù a ètyøbarevný
re¾im, který nabízel rozli¹ení 320&times;200 pixelù. Nejprve si popí¹eme práci
v&nbsp;monochromatickém re¾imu, která nebyla zcela jednoduchá, aè by se na
první pohled mohlo znát, ¾e v&nbsp;tomto pøípadì bude situace velmi
jednoduchá.</p>

<img src="http://i.iinfo.cz/images/360/pc84-2.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 2: Úvodní obrazovka hry Golden Axe spu¹tìná v&nbsp;grafickém
re¾imu karty CGA. Jedná se o ètyøbarevný re¾im s&nbsp;rozli¹ením 320&times;200
pixelù.</i></p>

<p>V&nbsp;monochromatickém re¾imu karty <i>CGA</i> s&nbsp;rozli¹ením
640&times;200 pixelù se na obrazovce pracovalo s&nbsp;celkem 128000 pixely, pro
jejich¾ ulo¾ení ve video pamìti bylo nutné alokovat 16000 bajtù. Ov¹em pøístup
k&nbsp;jednotlivým pixelùm nebyl zcela pøímoèarý, proto¾e celá obrazová pamì»
byla rozdìlena na dvì podoblasti. První podoblast byla (z&nbsp;hlediska
mikroprocesoru) mapována na adresy
<strong>0xb800:0x0000-0xb900:0xffff</strong>, druhá oblast na adresy
<strong>0xba00:0x0000-0xbb00:0xffff</strong> (opìt je pou¾ito adresování
segment:offset). V&nbsp;první oblasti obrazové pamìti byly umístìny sudé
obrazové øádky, ve druhé oblasti øádky liché; v¾dy osmdesát bajtù na øádek
(80&times;8=640). Z&nbsp;této organizace obrazové pamìti, která byla pou¾ita
kvùli omezené rychlosti pou¾itých pamì»ových èipù, vyplývá, ¾e i na první
pohled pomìrnì jednoduché operace, jako je vykreslení úseèky, se implementovaly
pomìrnì obtí¾nì a byly z&nbsp;tohoto dùvodu také pomalé.</p>

<img src="http://i.iinfo.cz/images/360/pc84-3.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 3: Pro porovnání &ndash; tentý¾ obrázek, ov¹em spu¹tìný
v&nbsp;¹estnáctibarevném re¾imu karty EGA. Rozli¹ení sice zùstalo zachováno,
ale vìt¹í poèet barev je na první pohled patrný.</i></p>



<p><a name="k02"></a></p>
<h2>2. Standardní ètyøbarevný grafický re¾im karty CGA: 320&times;200</h2>

<p>Druhým standardním grafickým re¾imem podporovaným kartou <i>CGA</i>, který
bylo mo¾né nastavit pomocí slu¾eb BIOSu, byl ètyøbarevný re¾im nabízející
rozli¹ení 320&times;200 pixelù. V&nbsp;tomto re¾imu je ka¾dý pixel
v&nbsp;obrazové pamìti ulo¾en ve dvou bitech (ètyøi pixely v&nbsp;ka¾dém
bajtu), co¾ znamená, ¾e je opìt vyu¾ito celkem 16000 bajtù video pamìti
z&nbsp;dostupných 16 kB. Obrazová pamì» je rozdìlena podobným zpùsobem
(sudé/liché øádky) jako u re¾imu monochromatického, co¾ je pochopitelné,
proto¾e z&nbsp;hlediska èipu <i>MC6845</i> se jedná o naprosto stejný mód, li¹í
se jen zpùsob interpretace naètených dat. U v¹ech re¾imù karty <i>CGA</i> se
v¹ak vyskytuje jeden fenomén, který u¾ivatelé jiných poèítaèù neznali &ndash;
soubì¾ný pøístup mikroprocesoru a grafického øadièe do obrazové pamìti nebyl
kupodivu nijak o¹etøen, co¾ zpùsobovalo nechvalnì známé &bdquo;snì¾ení&ldquo;.
Jediná mo¾nost, jak zabránit &bdquo;snì¾ení&ldquo;, byl zápis do obrazové
pamìti pøi vertikálním zatemnìní elektronového paprsku (horizontální zatemnìní
má pøíli¹ krátký interval).</p>

<img src="http://i.iinfo.cz/images/360/pc84-4.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 4: Teprve s&nbsp;256 barvami (grafická karta VGA) bylo mo¾né
odstranit dithering.</i></p>



<p><a name="k03"></a></p>
<h2>3. Zmìna øídicích registrù karty CGA a nestandardní re¾imy zobrazování</h2>

<p>Kromì základních (øeknìme standardních) grafických re¾imù, které se
nastavovaly pomocí slu¾eb BIOSu, byly díky pomìrnì ¹irokým mo¾nostem èipu
<i>MC6845</i> podporovány i mnohé dal¹í grafické módy. První z&nbsp;tìchto módù
je &bdquo;legální&ldquo; tj.&nbsp;zmiòuje se o nìm i dokumentace firmy IBM (ale
napøíklad ná¹ <i>SYSMAN</i> ji¾ nikoli, co¾ je v¹ak pochopitelné &ndash; viz
dal¹í text). V&nbsp;tomto re¾imu bylo mo¾né zobrazit rastrový obraz o rozmìrech
160&times;200 pixelù, pøièem¾ ka¾dý pixel mohl nabývat jedné ze ¹estnácti
barev, podobnì jako v&nbsp;textovém re¾imu. Potøebná kapacita video pamìti je
stejná, jako v&nbsp;pøípadì re¾imu monochromatického &ndash; 16000 bajtù. Tento
re¾im v¹ak byl pou¾itelný pouze pro kompozitní video, tj.&nbsp;napøíklad pro
televizory pøipojené ke grafické kartì pomocí konektoru RCA. Vzhledem
k&nbsp;tomu, ¾e obrazová frekvence je rovna 60Hz, nemìl tento re¾im pro na¹i
oblast (ÈR, Evropa) velký smysl, proto¾e tento kmitoèet je urèen pro televizory
podporující normu NTSC.</p>

<img src="http://i.iinfo.cz/images/360/pc84-5.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 5: Dal¹í porovnání &ndash; screenshot ze hry Golden Axe spu¹tìné
ve ètyøbarevném re¾imu grafické karty CGA.</i></p>

<p>Druhý nestandardní mód je ji¾ mo¾né pou¾ít na jakémkoli monitoru. Ve své
podstatì se jedná o re¾im textový, u nìj¾ je pomocí øídicích registrù èipu
<i>MC6845</i> upravena vý¹ka znakù na pouhé dva skenovací øádky. Z&nbsp;toho
vyplývá, ¾e se zobrazuje 80 znakù na 100 textových øádkù (u <i>CGA</i> je poèet
skenovacích øádkù v¾dy roven 200, a to i v&nbsp;textových re¾imech). Pokud se
bude zobrazovat pouze znak ve tvaru polovièního obdélníku (viz roz¹íøená
tabulka ASCII), zvy¹uje se rozli¹ení tohoto pseudografického re¾imu na
160&times;100 &bdquo;pixelù&ldquo;, pøièem¾ ka¾dý pixel mù¾e nabývat jedné
z&nbsp;¹estnácti barev (programátor tedy mìní pouze barvové atributy znakù,
tj.&nbsp;ka¾dý lichý bajt). Z&nbsp;jakého dùvodu se v¹ak nemù¾e zvý¹it
vertikální rozli¹ení na plných 200 øádkù, tj.&nbsp;sní¾it vý¹ku znaku na jeden
skenovací øádek? V&nbsp;tomto pøípadì toti¾ nará¾íme na neefektivní práci
s&nbsp;obrazovou pamìtí, proto¾e pro ka¾dý znak se musí ulo¾it i jeho barvový
atribut (dva bajty). Pro rozli¹ení 160&times;100 pixelù je zapotøebí alokovat:
80&times;100 znakù=8000&times;2 bytù=16000 bytù, tj.&nbsp;dostáváme se na horní
mez kapacity obrazové pamìti.</p>

<img src="http://i.iinfo.cz/images/360/pc84-6.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 6: Tá¾ scéna, ov¹em zobrazená kartou EGA v&nbsp;¹estnácti
barvách.</i></p>

<p>Tento pomìrnì zajímavý re¾im, pou¾itý napøíklad i v&nbsp;nìkolika hrách, je
mo¾né nastavit i u dal¹ích grafických karet, pøesnìji øeèeno u v¹ech karet,
které emulují funkce èipu <i>MC6845</i>, tj.&nbsp;napøíklad u karty <i>EGA</i>
i <i>VGA</i>. Ve vìt¹inì pøípadù to ale postrádá smysl, proto¾e jejich grafické
re¾imy ji¾ nejsou omezeny malým poètem barev tak, jak je tomu u grafické karty
<i>CGA</i>. Programátoøi se v&nbsp;minulosti pokou¹eli nastavovat i dal¹í
grafické re¾imy. Teoreticky to není problematické, proto¾e èip <i>MC6845</i> je
velmi flexibilní, ale mnohé monitory nedokázaly korektnì pracovat v&nbsp;tìch
pøípadech, kdy se zmìnilo èasování horizontálních a vertikálních
synchronizaèních signálù &ndash; grafická karta <i>CGA</i> mìla pouze jeden
krystal slou¾ící ke generování hodinového signálu (vstup do èipu
<i>MC6845</i>), tak¾e napøíklad pøi zmìnì horizontálního rozli¹ení (poètu
pixelù na obrazovém øádku) se buï musel sní¾it poèet obrazových øádkù, nebo
muselo dojít ke zmìnì obrazové frekvence.</p>

<img src="http://i.iinfo.cz/images/360/pc84-7.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 7: Stejná scéna zobrazená kartou VGA (256 barev).</i></p>

<p>Pro doplnìní pøidávám vzpomínky jednoho u¾ivatele grafické karty
<i>CGA</i>:</p>

<p><i>Sending random bytes to the video registers, by the way, was
<strong>extremely</strong> dangerous. If I had known that then, I wouldn't have
even tried at all; I was lucky I didn't break anything. The monitors back then
(1987 and earlier) were fixed frequency monitors, and ran at low frequencies.
If you told the video card to do something outside of those frequencies, you
stood an excellent change of damaging the monitor. A friend of mine was trying
to get the rumored CGA 16-color mode to work and <strong>destroyed</strong> his
Compaq's build-in monitor, a small monochrome monitor that emulated color with
different shades of gray. He went to nearest Compaq dealership to get it
replaced, and when they refused to fix it, he answered with something like,
"Well, I could demonstrate how easy it is to break the monitor to your
customers by typing a three-line BASIC program on, oh... this machine over
here," and pointed to their top-of-the-line machine that some customers were
huddled around. They quickly replaced his monitor to shut him up.</i> :-)</p>



<p><a name="k04"></a></p>
<h2>4. Grafická karta Hercules &ndash; první vá¾nìj¹í konkurence IBM</h2>

<p>V&nbsp;minulé èásti seriálu o architekturách poèítaèù jsme si popsali
grafický adaptér <i>MDA</i> a v&nbsp;pøedchozích kapitolách i parametry
grafické karty <i>CGA</i>. Obì zmínìné karty mají i pøes mnohé rozdíly nìkolik
spoleèných vlastností. Jedná se o karty navr¾ené a prodávané (od roku 1981)
firmou IBM, které jsou vybavené rozhraním pro osmibitovou variantu universální
interní sbìrnice ISA (<i>Industry Standard Architecture</i>). Obì karty jsou
takté¾ zalo¾eny na minule popsaném grafickém øadièi <i>Motorola MC6845</i>, co¾
by sice na první pohled mohlo znamenat urèitou míru kompatibility, ale pøesný
opak byl pravdou &ndash; firma IBM u obou karet zvolila odli¹né øádkové
frekvence (18,432 kHz u karty <i>MDA</i> a 15,75 kHz u karty <i>CGA</i>) i jiný
typ videosignálù, co¾ ve výsledku vedlo k&nbsp;tomu, ¾e pro ka¾dou kartu musel
být pou¾itý odli¹ný monitor. Zatímco grafická karta <i>CGA</i> nabízela mo¾nost
barevného zobrazení (viz pøedchozí kapitoly) na úkor men¹ího &ndash; pro mnohé
u¾ivatele neakceptovatelného &ndash; horizontálního i vertikálního zobrazení,
umo¾òovala sice karta <i>MDA</i> zobrazení èitelného textu, ov¹em bez mo¾nosti
pou¾ití jakéhokoli grafického re¾imu.</p>

<a href="http://i.iinfo.cz/images/360/pc84-8.png"><img src="http://i.iinfo.cz/images/360/pc84-8-prev.png" alt="pc84" height="181" width="370" /></a>
<p><i>Obrázek 8: Slavný textový editor T602 spu¹tìný na poèítaèi
s&nbsp;grafickou kartou Hercules.</i></p>

<p>V&nbsp;této situaci se, pravdìpodobnì poprvé, projevila jedna
z&nbsp;nejvìt¹ích pøedností architektury IBM PC &ndash; modularita. Zatímco
firma IBM nereagovala na oprávnìné výtky, které od u¾ivatelù pøicházely
pøedev¹ím kvùli vlastnostem grafické karty <i>CGA</i> (i mnohé osmibitové
poèítaèe toti¾ mìly grafický subsystém vyøe¹ený mnohem elegantnìji), objevil se
v&nbsp;roce 1982 konkurenèní výrobek &ndash; grafická karta <i>Hercules
Graphics Card (HGC)</i> firmy <i>Hercules Computer Technology</i>. Výrobce tuto
grafickou kartu navrhl tak, aby ji bylo mo¾né pou¾ít s&nbsp;monitorem urèeným
pro kartu <i>MDA</i>, ov¹em vèetnì mo¾nosti pøepnutí do monochromatického
grafického re¾imu s&nbsp;relativnì vysokým rozli¹ením 720&times;348 pixelù.
Dodr¾ení zpìtné kompatibility s&nbsp;kartou <i>MDA</i> nebylo slo¾ité &ndash;
v&nbsp;textovém i grafickém re¾imu (viz dal¹í text) byly pou¾ity takové
frekvence synchronizaèních signálù (øádková a snímková frekvence), která
odpovídaly signálùm generovaným kartou <i>MDA</i>.</p>

<a href="http://i.iinfo.cz/images/360/pc84-9.png"><img src="http://i.iinfo.cz/images/360/pc84-9-prev.png" alt="pc84" height="231" width="370" /></a>
<p><i>Obrázek 9: T602 zobrazený kartou CGA (skuteèný obraz má ve skuteènosti
jen 200 øádkù, nikoli 400).</i></p>

<p>I zpùsob práce v&nbsp;textovém re¾imu se od karty <i>MDA</i> témìø neli¹il,
co¾ znamenalo, ¾e na této kartì bylo mo¾né provozovat v¹echny aplikace
pracující v&nbsp;textovém re¾imu (navíc bylo mo¾né s&nbsp;vyu¾itím rezidentních
programù simulovat i grafické re¾imy karty <i>CGA</i>, pøièem¾ se jednotlivé
barevné odstíny nahrazovaly ditheringem). Pøedev¹ím z&nbsp;tìchto dùvodù byla
grafická karta <i>Hercules</i> v&nbsp;první polovinì osmdesátých let minulého
století velmi oblíbená a do svých sestav ji instalovali i tehdej¹í pøední
výrobci osobních poèítaèù. K&nbsp;velké oblíbenosti pøispìla i pomìrnì nízká
cena, tak¾e se karta <i>Hercules</i> pou¾ívala i v&nbsp;dobì nástupu grafické
karty <i>EGA</i>, jejím¾ popisem se budeme zabývat a¾ v&nbsp;následující èásti
tohoto seriálu. Firma <i>Hercules Computer Technology</i> vytvoøila i
následníka této grafické karty &ndash; <i>Hercules Plus</i> &ndash; jen¾ se
odli¹oval pøedev¹ím v&nbsp;tom, ¾e bylo mo¾né programovì mìnit znakovou sadu
v&nbsp;textovém re¾imu a docílit tak napøíklad zobrazení èeských znakù (u
pùvodního <i>Herculesu</i> èi <i>MDA</i> se znaková sada mìnila
pøeprogramováním pamìti EPROM).</p>

<a href="http://i.iinfo.cz/images/360/pc84-10.png"><img src="http://i.iinfo.cz/images/360/pc84-10-prev.png" alt="pc84" height="202" width="370" /></a>
<p><i>Obrázek 10: T602 zobrazený kartou EGA v&nbsp;rozli¹ení 640&times;350
v&nbsp;¹estnácti barvách.</i></p>



<p><a name="k05"></a></p>
<h2>5. Technické parametry karty Hercules</h2>

<p>Grafická karta <i>Hercules</i> je zalo¾ena, podobnì jako oba ji¾ popsané
grafické adaptéry firmy IBM, na èipu <i>Motorola MC6845</i>, nebo
(v&nbsp;pøípadì klonù) na VLSI obvodu se stejnými vlastnostmi i významem
øídicích portù. Jak bude z&nbsp;dal¹ího popisu patrné, je èip <i>MC6845</i>
v&nbsp;této kartì zapojen a naprogramován ponìkud jiným zpùsobem ne¾ tomu bylo
u grafické karty <i>CGA</i> i <i>MDA</i>. Kartu <i>Hercules</i> lze pøipojit do
osmibitové sbìrnice ISA (v&nbsp;dokumentaci firmy IBM také oznaèované termínem
PC-BUS), pøièem¾ se pøedpokládalo, ¾e frekvence hodinových signálù této
sbìrnice bude rovna 4,77 MHz (frekvence základního oscilátoru 14,285 MHz je pøi
generování hodinových signálù dìlená tøemi). Modernìj¹í osobní poèítaèe mìly
frekvenci hodinových signálù sbìrnice ISA zvý¹enou na 8, 8.33, 10 èi 12 MHz,
ov¹em pøi takto vysokých frekvencích mohlo na kartì <i>Hercules</i> docházet
k&nbsp;výpadkùm dat pøi zápisu do video pamìti. Na grafické kartì byl kromì
øadièe, podpùrných obvodù a video pamìti pøítomný i jeden paralelní port, co¾
také pøispívalo k&nbsp;oblíbenosti <i>Herculesu</i> mezi zákazníky, proto¾e
první personální poèítaèe typu IBM PC tyto porty nemìly nainstalovány pøímo na
základní desce a bylo je zapotøebí zvlá¹» dokupovat (a tím mimo jiné pøicházet
o jednu pozici na ISA sbìrnici).</p>

<a href="http://i.iinfo.cz/images/360/pc84-11.png"><img src="http://i.iinfo.cz/images/360/pc84-11-prev.png" alt="pc84" height="270" width="360" /></a>
<p><i>Obrázek 11: Textový editor T602 zobrazený pomìrnì neznámou kartou MCGA,
která v&nbsp;re¾imu nejvy¹¹ího rozli¹ení 640&times;480 mìla jen jednu bitovou
rovinu a tím pádem podporovala pouze dvì barvy.</i></p>

<p>Kapacita obrazové pamìti byla oproti kartì <i>CGA</i> zvý¹ena na
dvojnásobek, tj.&nbsp;na 32&nbsp;kB. Kromì pamì»ových modulù tvoøících
obrazovou pamì» byla na kartì nainstalována i pamì» typu ROM popø.&nbsp;EPROM,
ve které byla ulo¾ena znaková sada. tj.&nbsp;bitové podoby znakù (viz dal¹í
kapitola). Ovládání grafického èipu bylo provádìno pomocí parametrù ukládaných
pøes vstupnì/výstupní porty umístìné na adresách <strong>0x3b0</strong> a¾
<strong>0x3bf</strong>, pøièem¾ na adresy <strong>0x3b4</strong> a
<strong>0x3b5</strong> byly namapovány øídicí registry èipu <i>MC6845</i>
(tìchto registrù je, jak ji¾ víme z&nbsp;pøedchozí èásti tohoto seriálu, celkem
osmnáct). Vhodnou zmìnou parametrù docházelo k&nbsp;pøepínání mezi textovým a
grafickým re¾imem, bylo v¹ak mo¾né také mìnit parametry zobrazení grafiky
(rozli¹ení, zpo¾dìní synchronizaèních signálù, pozice hardwarového textového
kurzoru, mikroposun textových øádkù apod.), èeho¾ se èasto pou¾ívalo pøi
emulaci grafických re¾imù karty <i>CGA</i>.</p>

<a href="http://i.iinfo.cz/images/360/pc84-12.png"><img src="http://i.iinfo.cz/images/360/pc84-12-prev.png" alt="pc84" height="270" width="360" /></a>
<p><i>Obrázek 12: Nejlep¹í rozli¹ení i nejvìt¹í poèet barev pro textový editor
T602 nabízela grafická karta VGA &ndash; 640&times;480 pixelù v&nbsp;¹estnácti
barvách (editor v¹ak vyu¾il jen podmno¾inu barvové palety).</i></p>

<p>Ètením stavových bitù z&nbsp;portu <strong>0x3ba</strong> bylo mo¾né
testovat prùbìh horizontálního i vertikálního zatemnìní (synchronizace
pou¾ívaná napøíklad ve hrách) a èíst polohu hrotu svìtelného pera. Vzhledem
k&nbsp;tomu, ¾e grafická pamì» byla z&nbsp;hlediska mikroprocesoru mapována od
adresy <strong>b000:0000</strong> do adresy <strong>b000:7fff</strong> (zpùsob
adresování segment:offset), nedocházelo k&nbsp;pøekryvu s&nbsp;obrazovou pamìtí
grafické karty <i>CGA</i> a proto lze tyto dvì karty provozovat souèasnì i na
jednom poèítaèi. Takté¾ nedochází k&nbsp;pøekryvùm vstupnì/výstupních portù,
nebo» ty jsou v&nbsp;pøípadì karty <i>CGA</i> umístìny o 16 bajtù vý¹e.
<i>Hercules</i> je v&nbsp;pøípadì pou¾ití této kombinace vyu¾it pro kvalitní
zobrazování textu a monochromatické grafiky, <i>CGA</i> pro zobrazení barevné
(ehm :-) grafiky. Dal¹í pomìrnì oblíbenou kombinací z&nbsp;pozdìj¹í doby byla
<i>VGA</i>+<i>Hercules</i>, ov¹em v&nbsp;tomto pøípadì <i>Hercules</i> vìt¹inou
slou¾il pro práci v&nbsp;textovém re¾imu (IDE firmy Borland, AutoCAD atd.).</p>



<p><a name="k06"></a></p>
<h2>6. Textový re¾im karty Hercules</h2>

<p>V&times;textovém re¾imu je grafická karta <i>Hercules</i> prakticky
stoprocentnì kompatibilní s&nbsp;kartou <i>MDA</i>, tj.&nbsp;pracuje se
s&nbsp;textem o 80 sloupcích a 25 øádcích, vèetnì stejného zpùsobu práce
s&nbsp;atributy jednotlivých znakù (podtr¾ení apod.). Text je zobrazován
v&nbsp;rozli¹ení 720&nbsp;350 pixelù, co¾ umo¾òuje na jeden znak pou¾ít masku o
velikosti 9&times;14 pixelù. Textovou obrazovku lze mapovat buï od adresy
<strong>b000:0000</strong> nebo od adresy <strong>b800:0000</strong>. Jedinou
nevýhodou textového re¾imu grafické karty <i>Hercules</i> je fakt, ¾e znaková
sada je ulo¾ena v&nbsp;pamìti EPROM typu 27C64 a nelze ji tedy programovì
zmìnit, pouze &bdquo;pøepálit&ldquo; (pro zajímavost &ndash; v¹echny
<i>Herculesy</i> s&nbsp;&bdquo;pøepálenou&ldquo; znakovou sadou, které jsem
vidìl, pou¾ívaly kódování Kamenických, viz dal¹í odstavec). Tvary znakù jsou
v&nbsp;pamìti EPROM ulo¾eny tak, jakoby jejich maska mìla velikost 8&times;16
pixelù, av¹ak pro ka¾dý znak se pøi jeho vykreslování dva øádky ignorují a
podle pozice znaku v&nbsp;ASCII tabulce se doplòuje devátý sloupec pixelù, èím¾
se dostáváme k&nbsp;výsledné masce 9&times;14 pixelù (devátý sloupec vzniká
kopií osmého sloupce u znakù pøedstavujících rámeèky).</p>

<p>Z&nbsp;vý¹e uvedených informací vyplývá, ¾e pro ulo¾ení celé znakové sady by
mìly dostaèovat pouhé ètyøi kilobajty, nebo» 16 øádkù&times;1 bajt&times;256
znakù=4096 bajtù. Ov¹em vzhledem k&nbsp;tomu, ¾e pamì» EPROM 27C64 má kapacitu
8&nbsp;kB, jsou horní 4&nbsp;kB nevyu¾ity. Vhodnou hardwarovou úpravou je v¹ak
mo¾né implementovat dvì znakové sady &ndash; u nás se vìt¹inou pou¾ívala
originální sada US-ASCII a ji¾ zmínìné èeské znaky v&nbsp;kódu Kamenických.
Kromì pùvodní karty <i>Hercules</i> se vyrábìla takté¾ ji¾ zmínìná karta
<i>Hercules Plus</i>, která se od pùvodního modelu odli¹uje pøedev¹ím
v&nbsp;tom, ¾e znakovou sadu ukládá do pamìti typu (D)RAM a umo¾òuje tak
programovì mìnit pou¾ívanou znakovou sadu. U této karty je dokonce mo¾né
roz¹íøit poèet znakù ve znakové sadì a¾ na teoretickou hodnotu
2<sup>12</sup>=4096 tím zpùsobem, ¾e se ètyøi bity v&nbsp;atributovém bajtu
pou¾ijí na definici atributù znakù a zbylé ètyøi bity se pøipojí
k&nbsp;osmibitovému ASCII kódu znaku. Ne v¹echny kódy v¹ak mohou být skuteènì
vyu¾ity, proto¾e velikost pamìti vyhrazené pro znakovou sadu dosahuje 48 kB a
ne 64 kB.</p>



<p><a name="k07"></a></p>
<h2>7. Grafický re¾im karty Hercules</h2>

<p>Grafický re¾im karty <i>Hercules</i> je, ostatnì jako témìø ve v¹ech
obdobných pøípadech, mnohem zajímavìj¹í a flexibilnìj¹í, ne¾ re¾im textový.
<i>Hercules</i> podporoval na svou dobu pomìrnì vysoké rozli¹ení 720&times;348
obrazových bodù zobrazovaných èernobíle nebo dvoubarevnì. Konkrétní barvy
pou¾ité pøi zobrazování byly závislé na typu obrazovky monitoru; kromì
obligátní kombinace èerná+zelená byla mezi výrobci obrazovek oblíbená napøíklad
kombinace tmavì modrá a svìtle èervená nebo tmavì modrá a ¾lutá. Horizontální
rozli¹ení grafického re¾imu je stejné, jako v&nbsp;pøípadì re¾imu textového,
proto¾e platí 80 znakù na øádku &times; 9 horizontálních pixelù na znak = 720
pixelù. Vertikální rozli¹ení se v¹ak li¹í o dva skenovací øádky.
V&nbsp;textovém re¾imu je vertikální rozli¹ení, tj.&nbsp;poèet obrazových
øádkù, rovno 350 pixelùm, proto¾e platí vztah: 25 textových øádkù &times; 14
skenovacích/obrazových øádkù na vý¹ku znaku=350 skenovacích øádkù celkem.
V&nbsp;grafickém re¾imu je zvolena hodnota 348 skenovacích øádkù proto, ¾e je
toto èíslo dìlitelné ètyømi, co¾ souvisí s&nbsp;re¾imem pøístupu do obrazové
pamìti, jeho¾ princip bude popsán v&nbsp;následujícím odstavci (ostatnì zmìnou
øídicích registrù èipu <i>MC6845</i> lze poèet obrazových øádkù v&nbsp;urèitém
rozsahu mìnit).</p>

<p>Pokud porovnáme signálové pomìry obou podporovaných re¾imù, je grafický
re¾im toto¾ný s&nbsp;re¾imem textovým. Sní¾ení poètu skenovacích øádkù se
projeví pouze del¹ím èasovým okam¾ikem vertikálního zpìtného bìhu elektronového
paprsku. Obrazová pamì» je pøi zapnutí grafického re¾imu rozdìlena do ètyøech
oblastí. V&nbsp;pamì»ové oblasti <strong>b000:0000-b000:1fff</strong> se
nachází skenovací øádky 0, 4, 8,..., v&nbsp;oblasti
<strong>b000:2000-b000:3fff</strong> øádky 1, 5, 9,..., na adresách
<strong>b000:4000-b000:5fff</strong> øádky 2, 6, 10, ... a koneènì
v&nbsp;pamì»ové oblasti <strong>b000:6000-b000:7fff</strong> skenovací øádky 3,
7, 11, ... . Pøístup k&nbsp;jednotlivým pixelùm je tak pomìrnì komplikovaný,
co¾ umocòuje také fakt, ¾e v&nbsp;jednom bytu je ulo¾ena v¾dy osmice pixelù.
Celková spotøeba pamìti pro grafický re¾im karty <i>Hercules</i> se dá
vypoèítat snadno. Na jeden øádek je zapotøebí alokovat 720/8=90 bytù, na celý
snímek pak 90&times;348 = 31320 bajtù. Zbylých 1440 bajtù obrazové pamìti,
která má, jak ji¾ víme z&nbsp;pøedchozího textu kapacitu 32 kB, zùstává
nevyu¾ito.</p>

<p>Adresa pro operaci zápisu èi ètení pixelu zadaného souøadnicemi <i>x, y</i>
se vypoète následovnì:</p>

<pre>
offset = 0x2000 * (y % 4) + 90 * (y &gt;&gt; 2) + (x &gt;&gt; 3)
</pre>

<p>Index bitu, který se má zapsat èi pøeèíst na vý¹e vypoètené adrese, lze
vyjádøit takto:</p>

<pre>
offset bit = 7 - (x % 8)
</pre>

<a href="http://i.iinfo.cz/images/360/pc84-13.png"><img src="http://i.iinfo.cz/images/360/pc84-13-prev.png" alt="pc84" height="231" width="370" /></a>
<p><i>Obrázek 13: Porovnání textových re¾imù: Volkov Commander na kartì
CGA.</i></p>

<a href="http://i.iinfo.cz/images/360/pc84-14.png"><img src="http://i.iinfo.cz/images/360/pc84-14-prev.png" alt="pc84" height="231" width="370" /></a>
<p><i>Obrázek 14: Volkov Commander na kartì VGA pøi pøepnutí textového re¾imu
tak, aby ¹íøka znakù byla 8 pixelù (standardnì se vykreslují znaky o ¹íøce 9
pixelù).</i></p>



<p><a name="k08"></a></p>
<h2>8. Hercules GRAFIX BIOS interface</h2>

<p>Vzhledem k&nbsp;tomu, ¾e grafická karta <i>Hercules</i> byla od roku 1982
pøímým konkurentem grafických karet <i>MDA</i> i <i>CGA</i>, není podporována
BIOSem poèítaèù PC, co¾ pravdìpodobnì mìlo (alespoò podle mínìní firmy IBM)
zbrzdit úspìch této karty. Pøipomeòme si, ¾e BIOS byl jednou z&nbsp;mála vìcí
osobních poèítaèù (PC), kterou nemohli dal¹í výrobci jednodu¹e kopírovat ani
modifikovat (pøesnìji øeèeno &ndash; technicky je kopie BIOSu samozøejmì velmi
jednoduchá, právnì v¹ak nikoli, proto se také BIOSy u nìkterých firem znovu
pøepisovaly tak, aby odpovídaly chování pùvodního IBM BIOSu). Ve skuteènosti se
v¹ak BIOSové slu¾by pro obsluhu grafiky v&nbsp;reálných aplikacích stejnì
pøíli¹ èasto nepou¾ívaly, proto¾e byly pomalé a neefektivní (ve¹kerá obsluha
grafiky implementovaná v&nbsp;BIOSu spoèívá na ètyøech slu¾bách &ndash;
nastavení textového èi grafického re¾imu, ètení pixelu, zápis pixelu a výpis
øetìzce). Ke kartì <i>Hercules</i> v¹ak existovalo roz¹íøení BIOSu nazvané
<i>Hercules GRAFIX BIOS interface</i>, které podporovalo zejména následující
(mnohdy netriviální) èinnosti a algoritmy:</p>

<table>
<tr><th>Grafická operace</th></tr>
<tr><th>nastavení textového re¾imu</td></tr>
<tr><th>nastavení grafického re¾imu</td></tr>
<tr><th>operace putpixel (zápis barvy pixelu)</td></tr>
<tr><th>operace getpixel (ètení barvy pixelu)</td></tr>
<tr><th>moveto (pøesun grafického kurzoru)</td></tr>
<tr><th>drawto (vykreslení úseèky)</td></tr>
<tr><th>draw arc (vykreslení oblouku)</td></tr>
<tr><th>draw circle (vykreslení kru¾nice)</td></tr>
<tr><th>block fill (vyplnìní obdélníkové oblasti)</td></tr>
<tr><th>fill area (vyplnìní obecné oblasti)</td></tr>
</table>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>Support/peripheral/other chips - 6800 family<br />
<a href="http://www.cpu-world.com/Support/6800.html">http://www.cpu-world.com/Support/6800.html</a>
</li>

<li>Motorola 6845<br />
<a href="http://en.wikipedia.org/wiki/Motorola_6845">http://en.wikipedia.org/wiki/Motorola_6845</a>
</li>

<li>The 6845 Cathode Ray Tube Controller (CRTC)<br />
<a href="http://www.tinyvga.com/6845">http://www.tinyvga.com/6845</a>
</li>

<li>IBM Monochrome Display Adapter<br />
<a href="http://en.wikipedia.org/wiki/Monochrome_Display_Adapter">http://en.wikipedia.org/wiki/Monochrome_Display_Adapter</a>
</li>

<li>Color Graphics Adapter<br />
<a href="http://en.wikipedia.org/wiki/Color_Graphics_Adapter">http://en.wikipedia.org/wiki/Color_Graphics_Adapter</a>
</li>

<li>Wikipedia CZ: Sbìrnice:<br />
<a href="http://cs.wikipedia.org/wiki/Sb%C4%9Brnice">http://cs.wikipedia.org/wiki/Sb%C4%9Brnice</a></li>

<li>Wikipedia EN: Industry Standard Architecture:<br />
<a href="http://en.wikipedia.org/wiki/Industry_Standard_Architecture">http://en.wikipedia.org/wiki/Industry_Standard_Architecture</a></li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2009</small></p>
</body>
</html>

