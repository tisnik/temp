<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Tvoøíme skripty pro grafický editor GIMP (3)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Tvoøíme skripty pro grafický editor GIMP (3)</h1>

<h3></h3>

<p></p>

<h1>Úvodník</h1>

<p>V&nbsp;dne¹ní èásti seriálu o programovacím jazyku Scheme si uká¾eme nìkteré pokroèilej¹í techniky skriptování v&nbsp;grafickém rastrovém editoru GIMP. Øekneme si, jak lze mìnit parametry kreslicích nástrojù a jak se pou¾ívají výbìry (selections) pøi kreslení i implementaci nìkterých grafických efektù.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Zmìna základních parametrù kreslicích nástrojù</a></p>
<p><a href="#k02">2. Práce s&nbsp;vlastnostmi vybraného kreslicího nástroje ve skriptech</a></p>
<p><a href="#k03">3. První demonstraèní pøíklad &ndash; výbìr kreslicího nástroje a jeho parametrù</a></p>
<p><a href="#k04">4. Pou¾ití výbìrù pøi kreslení a editaci obrázkù</a></p>
<p><a href="#k05">5. Definice hranice výbìru pomocí mno¾inových operací a rozmazání jeho hranice</a></p>
<p><a href="#k06">6. Práce s&nbsp;výbìry ve skriptu</a></p>
<p><a href="#k07">7. Druhý demonstraèní pøíklad &ndash; vybarvení vybrané oblasti</a></p>
<p><a href="#k08">8. Obsah dal¹ího pokraèování seriálu</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Zmìna základních parametrù kreslicích nástrojù</h2>

<p>V&nbsp;dne¹ní èásti seriálu o programovacím jazyce <i>Scheme</i> i o jeho
pou¾ití ve funkci skriptovacího jazyka grafického rastrového editoru
<i>GIMP</i> navá¾eme na obì èásti pøedchozí, v&nbsp;nich¾ jsme si vysvìtlili,
jakým zpùsobem je mo¾né ve skriptech pou¾ívat základní kreslicí nástroje
<i>GIMPu</i> i to, jak se tvoøí dialogy (formuláøe) zobrazené u¾ivateli pøed
vlastním spu¹tìním skriptu. V&nbsp;tìchto dialozích, je¾ slou¾í pro
interaktivní specifikaci parametrù pou¾itých skriptem, lze pou¾ívat pomìrnì
velké mno¾ství rùzných ovládacích prvkù, jak tìch &bdquo;obyèejných&ldquo;
(vstupní textové pole, rozbalovací výbìrový seznam, checkbox), tak i prvkù
dostupných pouze v&nbsp;samotném rastrovém editoru <i>GIMP</i> (namíchání barvy
z&nbsp;barvové palety, nastavení vlastností kreslicího nástroje atd.). Nejprve
si øeknìme, jakým zpùsobem lze ve skriptech vyu¾ít vlastnosti kreslicích
nástrojù zadané u¾ivatelem s&nbsp;vyu¾itím dialogù <i>GIMPu</i>.</p>

<a href="http://i.iinfo.cz/images/277/scheme6a-1.png"><img src="http://i.iinfo.cz/images/277/scheme6a-1-prev.png" width="370" height="217" alt=" " /></a>
<p><i>Obrázek 1: Úvodní dialog prvního demonstraèního pøíkladu popsaného
ve tøetí kapitole, z&nbsp;nìho¾ je patrné, ¾e lze vybrat jak pou¾itý
kreslicí nástroj (listbox Tool), tak i styl kreslení (výbìrové tlaèítko Browse)
a barvu (Color).</i></p>

<p>V&nbsp;pøípadì, ¾e je do dialogu (formuláøe) pøiøazeného ke skriptu vlo¾en
ovládací prvek typu <strong>SF-BRUSH</strong>, zobrazí se ve formuláøi jako
tlaèítko s&nbsp;textem &bdquo;Browse&ldquo; nebo lokalizovaným textem
s&nbsp;podobným významem, vedle nìho¾ se nachází malý obrázek pøedstavující
stopu vybraného kreslicího nástroje. Pokud u¾ivatel toto tlaèítko stiskne,
zobrazí se nový dialog, v&nbsp;nìm¾ lze zadat parametry vybraného kreslicího
nástroje, pøedev¹ím tvar stopy (jedná se o bitmapu pomocí ní¾ je stopa
kreslena), pøítlak, prùhlednost, postupné blednutí barvy s&nbsp;rostoucí délkou
stopy atd. Podobným zpùsobem se chová i ovládací prvek
<strong>SF-COLOR</strong>, po jeho¾ aktivaci se zobrazí nový dialog
s&nbsp;mo¾ností namíchání barvy z&nbsp;barvové palety. Samotná definice
ovládacích prvkù v&nbsp;dialogu i zpùsob jejich ovládání u¾ivatelem je tedy
pomìrnì jednoduchá.</p>

<a href="http://i.iinfo.cz/images/277/scheme6a-2.png"><img src="http://i.iinfo.cz/images/277/scheme6a-2-prev.png" width="370" height="217" alt=" " /></a>
<p><i>Obrázek 2: Po stisku tlaèítka Browse se zobrazí nový dialog
s&nbsp;výbìrem vlastností kreslicího nástroje.</i></p>



<p><a name="k02"></a></p>
<h2>2. Práce s&nbsp;vlastnostmi vybraného kreslicího nástroje ve skriptech</h2>

<p>Ponìkud slo¾itìj¹í je v¹ak zpracování parametrù zadaných u¾ivatelem po
zavolání skriptu, pøedev¹ím v&nbsp;pøípadì ovládacího prvku
<strong>SF-BRUSH</strong>, proto¾e v&nbsp;pøíslu¹ném parametru musí být ve
strukturované podobì pøedány v¹echny zvolené vlastnosti kreslicího nástroje
(pøipomeòme, ¾e ka¾dému ovládacímu prvku na formuláøi odpovídá pouze jeden
parametr skriptu). Barva vybraná ovládacím prvkem <strong>SF-COLOR</strong> se
do skriptu pøedává jako bì¾ný seznam celoèíselných hodnot s&nbsp;rozsahem 0 a¾
255, tak¾e je velmi jednoduché získat hodnotu jednotlivých barvových slo¾ek
&ndash; èervené, zelené a modré (podpora pro dal¹í barvové modely je prozatím
je¹tì ponìkud problematická). Pokud je napøíklad barva pøedaná v&nbsp;parametru
<strong>selected-color</strong>, lze její jednotlivé barvové slo¾ky získat
následujícím zpùsobem:</p>

<pre>
(set red   (car selected-color))
(set green (car (cdr selected-color)))
(set blue  (car (cdr (cdr selected-color))))
</pre>

<p>nebo té¾ zkrácenì:</p>

<pre>
(set red   (car selected-color))
(set green (cadr selected-color))
(set blue  (caddr selected-color))
</pre>

<p>Ovládací prvek <strong>SF-BRUSH</strong> takté¾ do skriptu pøedává
u¾ivatelem vybrané hodnoty v&nbsp;datové struktuøe seznam, ov¹em jeho struktura
je ponìkud slo¾itìj¹í. První prvek seznamu obsahuje øetìzec s&nbsp;názvem
vybrané stopy; tuto hodnotu lze pou¾ít napøíklad pøi volání funkce
<strong>gimp-context-set-brush</strong>. Druhým prvkem seznamu je èíselná
hodnota s&nbsp;prùhledností kreslené stopy za ní¾ následují dal¹í parametry,
pøedev¹ím mìøítko stopy (jak jsme si ji¾ øekli v&nbsp;pøedchozí kapitole, jedná
se o bitmapu, kterou lze v&nbsp;urèitém rozsahu zvìt¹ovat a zmen¹ovat),
kreslicí re¾im aj. Pro pøístup k&nbsp;tìmto prvkùm seznamu lze pou¾ít napøíklad
klasické &bdquo;lispovské&ldquo; funkce typu <strong>car</strong> a
<strong>cdr</strong>, s&nbsp;nimi¾ jsme se v&nbsp;tomto seriálu ji¾ seznámili
pøi zmínce o historii programovacího jazyka <i>LISP</i>. Ov¹em ovládací prvek
<strong>SF-BRUSH</strong> neumo¾òuje výbìr kreslicího nástroje, dovoluje pouze
mìnit vlastnosti nástroje ji¾ vybraného. Pro výbìr kreslicího nástroje tedy
musíme v&nbsp;dialogu pou¾ít jiný ovládací prvek, napøíklad bì¾ný výbìrový
seznam (listbox).</p>

<img src="http://i.iinfo.cz/images/277/scheme6a-3.png" width="400" height="400" alt=" " />
<p><i>Obrázek 3: Spirála vykreslená prvním demonstraèním pøíkladem pomocí
kreslicího nástroje tu¾ka (Pencil).</i></p>



<p><a name="k03"></a></p>
<h2>3. První demonstraèní pøíklad &ndash; výbìr kreslicího nástroje a jeho parametrù</h2>

<p>V&nbsp;dne¹ním prvním demonstraèním pøíkladu je mj.&nbsp;ukázán zpùsob
pou¾ití ovládacích prvkù <strong>SF-COLOR</strong> (výbìr barvy
v&nbsp;samostatném dialogu), <strong>SF-BRUSH</strong> (výbìr vlastností
¹tìtce, takté¾ v&nbsp;samostatném dialogu) a <strong>SF-OPTION</strong> (výbìr
jedné hodnoty ze seznamu). S&nbsp;vyu¾itím prvku <strong>SF-OPTION</strong> je
u¾ivateli nabídnut seznam tøí základních kreslicích nástrojù, tj.&nbsp;tu¾ky
(<i>pencil</i>), ¹tìtce (<i>brush</i>) a rozpra¹ovaèe (<i>airbrush</i>).
Vlastní vykreslení úseèky, ze které se skládá spirála, podobnì jako
v&nbsp;demonstraèních pøíkladech uvedených v&nbsp;pøedchozí èásti tohoto
seriálu, je realizováno v&nbsp;pomocné funkci <strong>draw-line</strong> na
základì poøadového èísla vybraného kreslicího nástroje. Vzhledem k&nbsp;tomu,
¾e polo¾ky ve výbìrovém seznamu <strong>SF-OPTION</strong> jsou èíslovány od
nuly, odpovídá tu¾ka hodnotì nula, ¹tìtec hodnotì jedna a rozpra¹ovaè hodnotì
dvì. Pov¹imnìte si, ¾e pro ka¾dý kreslicí nástroj existuje samostatná funkce,
která kreslení provádí &ndash; <strong>gimp-pencil</strong>,
<strong>gimp-paintbrush-default</strong> a
<strong>gimp-airbrush-default</strong>:</p>

<pre>
; vykreslení úseèky vybraným kreslicím nástrojem
; 0 - tu¾ka
; 1 - ¹tìtec
; 2 - rozpra¹ovaè
(define (draw-line tool selected-layer npoint segment)
    (if (= tool 0)
        (gimp-pencil selected-layer npoint segment)
        (if (= tool 1)
            (gimp-paintbrush-default selected-layer npoint segment)
            (gimp-airbrush-default selected-layer npoint segment)
        )
    )
)
</pre>

<img src="http://i.iinfo.cz/images/277/scheme6a-4.png" width="400" height="400" alt=" " />
<p><i>Obrázek 4: Spirála vykreslená nástrojem ¹tìtec (Brush).</i></p>

<p>Následuje výpis zdrojového kódu prvního demonstraèního pøíkladu:</p>

<pre>
; Skriptování v GIMPu (3)
; Demonstraèní pøíklad èíslo 1

; Tato funkce je zavolána z dialogu vyvolaného u¾ivatelem
; z grafického u¾ivatelského rozhraní GIMPu.
(define (script-fu-spirals-4
                             selected-image
                             selected-layer
                             selected-spins
                             center-x center-y
                             start-radius
                             end-radius
                             start-angle
                             tool
                             selected-brush
                             selected-color)

    ; pomocná funkce pro výpoèet jedné souøadnice
    ; bodu le¾ícího na spirále
    (define (coord center radius function angle start-angle)
        (+ center (* radius (function (+ angle start-angle))))
    )

    ; vykreslení úseèky vybraným kreslicím nástrojem
    (define (draw-line tool selected-layer npoint segment)
        (if (= tool 0)
            (gimp-pencil selected-layer npoint segment)
            (if (= tool 1)
                (gimp-paintbrush-default selected-layer npoint segment)
                (gimp-airbrush-default selected-layer npoint segment)
            )
        )
    )

    ; definice lokálních promìnných
    (let*
        (
            ; konstanta - poèet vrcholù køivky
            ; na jednu otoèku spirály
            (vertexes-per-spin 100)

            ; poèet prvkù vektoru = (x1, y1, x2, y2)
            (npoint 4)

            ; vykreslovaná úseèka je pøedstavována vektorem
            ; (vektorem je v tomto kontextu my¹lena datová
            ; struktura programovacího jazyka Scheme)
            (segment (make-vector 4 ))

            ; úhly zvìt¹ující se pro ka¾dý dal¹í vykreslený úsek
            (alfa 0)
            (beta 0)

            ; konstanta - 2xPi
            (full-circle (* 3.1415927 2))

            ; poèet vykreslených segmentù
            (step (/ full-circle vertexes-per-spin))

            ; úprava hodnoty zadané u¾ivatelem
            (spins (+ selected-spins 1))

            ; vzdálenost vykreslovaného úseku od støedu spirály
            (radius start-radius)
            (old-radius radius)

            ; zmìna vzdálenosti pro ka¾dý dal¹í úsek
            (radius-delta (/ (- end-radius start-radius) (* vertexes-per-spin spins 1)))
        )

        (gimp-context-push)
        (gimp-undo-push-group-start selected-image)

        ; nastavení zpùsobu kreslení na základì údajù zadaných u¾ivatelem
        (gimp-context-set-foreground selected-color)
        (gimp-context-set-brush (car selected-brush))
        (gimp-context-set-opacity (car (cdr selected-brush)))
        (gimp-context-set-paint-mode (car (cdr (cdr (cdr selected-brush)))))

        ; programová smyèka, v ní¾ se vykreslí úseèkové segmenty
        ; ze kterých se skládá aproximace spirály
        (while (&lt;= alfa (* full-circle spins 1))
            (set! beta (+ alfa step))
            (set! radius (+ radius radius-delta))
            ; vypoèet poèáteèní a koncové souøadice úseèky
            (vector-set! segment 0 (coord center-x old-radius cos alfa start-angle) )
            (vector-set! segment 1 (coord center-y old-radius sin alfa start-angle) )
            (vector-set! segment 2 (coord center-x radius cos beta start-angle) )
            (vector-set! segment 3 (coord center-y radius sin beta start-angle) )

            ; vykreslení úseèky vybraným kreslicím nástrojem
            (draw-line tool selected-layer npoint segment)

            ; pøinutíme GIMP, aby obrázek prùbì¾nì vykresloval
            (gimp-displays-flush)
            ; pøechod na dal¹í úsek
            (set! alfa beta)
            (set! old-radius radius)
        )
        ; ulo¾íme stav obrázku na zásobník
        (gimp-undo-push-group-end selected-image) 
    )
    (gimp-context-pop)
    ; naposledy pøinutíme GIMP, aby finální obrázek vykreslil
    (gimp-displays-flush)  
)


; základní informace o skriptu a definice dialogu
; zobrazeného u¾ivateli
(script-fu-register "script-fu-spirals-4"
    _"_Spirals-4"
    _"Renders various spirals to current layer"
    "Pavel Tisnovsky"
    "Pavel Tisnovsky"
    "2010-05-18"
    "RGB*, INDEXED*, GRAY*"
    SF-IMAGE       "Image"         0
    SF-DRAWABLE    "Drawable"      0
 
    SF-OPTION     _"Spins"        '(_"1"
                                    _"2"
                                    _"3"
                                    _"4")
    SF-ADJUSTMENT _"X center"     '(200 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Y center"     '(200 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Start radius" '(20  0 999 1 10 0 1)
    SF-ADJUSTMENT _"End radius"   '(180 0 999 1 10 0 1)
    SF-ADJUSTMENT _"Start angle"  '(0 0 359 1 10 0 0)

    SF-OPTION     _"Tool"          '(_"Pencil"
                                     _"Brush"
                                     _"Airbrush")
    SF-BRUSH      _"Brush"         '("Circle (01)" 1.0 -1 0)
 
    SF-COLOR      _"Color"          "black"
)

; registrace skriptu do menu
(script-fu-menu-register "script-fu-spirals-4"
                         "&lt;Image&gt;/Root.cz")

; finito
</pre>

<img src="http://i.iinfo.cz/images/277/scheme6a-5.png" width="400" height="400" alt=" " />
<p><i>Obrázek 5: Spirála vykreslená nástrojem rozpra¹ovaè (Airbrush).</i></p>



<p><a name="k04"></a></p>
<h2>4. Pou¾ití výbìrù pøi kreslení a editaci obrázkù</h2>

<p>Pøi kreslení slo¾itìj¹ích objektù v&nbsp;grafickém editoru <i>GIMP</i> nebo
pøi editacích obrázkù (vèetnì aplikace filtrù) je mo¾né vyu¾ívat i takzvané
výbìry (<i>selection</i>) nebo cesty (<i>paths</i>). Nejprve si uka¾me, jakým
zpùsobem je mo¾né pracovat s&nbsp;výbìry. U¾ivatel má pøi interaktivní editaci
obrázkù k&nbsp;dispozici hned nìkolik nástrojù, pomocí kterých mù¾e vybírat a
následnì upravovat oblasti v&nbsp;rastrovém obrázku, se kterými je
mo¾né posléze provádìt pomìrnì velké mno¾ství editaèních operací &ndash;
napøíklad je lze pou¾ít jako masku pøi v¹ech editaèních operacích (tuto masku
lze zobrazit a popø.&nbsp;zase skrýt pøíkazem <i>Select/Toggle Quick Mask</i>
nebo klávesovou zkratkou <i>CTRL+Q</i>), výbìry je mo¾né zkonvertovat na cesty
(<i>Select/To Path</i>) nebo je pøevést na kanály (<i>Select/Save to
Channel</i>) a následnì ulo¾it do seznamu kanálù pøiøazených ke zpracovávanému
obrázku. Hranici výbìru je mo¾né takté¾ pøímo vykreslit právì nastaveným
kreslicím nástrojem (<i>Selection Editor/Stroke</i>).</p>

<img src="http://i.iinfo.cz/images/277/scheme6a-6.png" width="456" height="529" alt=" " />
<p><i>Obrázek 6: Vytvoøení výbìru ze dvou sjednocených kru¾nic, od nich¾ byla
odeètena plocha ve tvaru obdélníku.</i></p>



<p><a name="k05"></a></p>
<h2>5. Definice hranice výbìru pomocí mno¾inových operací a rozmazání jeho hranice</h2>

<p>Samotné výbìry se definují pomocí základních geometrických tvarù
(obdélník/ètverec, elipsa/kru¾nice), ruèním nakreslením hranice výbìru,
nástrojem, který automaticky vybere oblast podle barevných ploch v&nbsp;obrázku
nebo podle zmìny kontrastu atd. To ov¹em není zdaleka v¹e &ndash; pøi tvorbì
výbìrù lze aplikovat i základní mno¾inové operace (sjednocení, rozdíl,
doplnìk), tak¾e je napøíklad mo¾né vytvoøit výbìr ze dvou sjednocených kruhù,
od nich¾ je &bdquo;odeètena&ldquo; plocha ve tvaru obdélníka &ndash; viz té¾
obrázek èíslo 6 i obrázek èíslo 7. Pro volbu tìchto dvou mno¾inových operací se
pou¾ívají modifikátory <i>CTRL</i> a <i>SHIFT</i> (musí se stlaèit pøed
vlastním nakreslením hranice výbìru, v&nbsp;prùbìhu kreslení toti¾ mají tyto
klávesy jiný význam), doplnìk (inverzi) lze vyvolat buï klávesovou zkratkou
<i>CTRL+I</i> nebo pøíkazem <i>Select/Invert</i>.</p>

<img src="http://i.iinfo.cz/images/277/scheme6a-7.png" width="456" height="531" alt=" " />
<p><i>Obrázek 7: Zobrazení výbìru jako takzvané rychlé masky (quick mask).</i></p>

<p>Pøi úpravách plnobarevných obrázkù, zvlá¹tì pøi editaci fotografií, bývá
vhodné hranice výbìru rozmazat, tak¾e se napøíklad pøi vyplòování oblasti
výbìru pou¾ije v&nbsp;okolí jeho hranice postupný gradientní pøechod od
výplòové barvy k&nbsp;barvì pozadí (stejný pøechod je aplikován i pøi posunu
nebo kopii èásti obrázku). Internì je rozmazání hranice výbìru øe¹eno aplikací
Gaussovského filtru na bitmapu pøedstavující vybraný vzorek, co¾ je nejlépe
patrné pøi zobrazení výbìru jako rychlé masky (<i>Quick Mask</i>). Rozmazání
hranice výbìru je ukázáno na obrázku 8 a 9.</p>

<img src="http://i.iinfo.cz/images/277/scheme6a-8.png" width="456" height="530" alt=" " />
<p><i>Obrázek 8: Rozmazání hranice výbìru nástrojem Feather.</i></p>

<img src="http://i.iinfo.cz/images/277/scheme6a-9.png" width="456" height="530" alt=" " />
<p><i>Obrázek 9: Zobrazení výbìru s&nbsp;rozmazanou hranicí v&nbsp;re¾imu rychlé masky.</i></p>



<p><a name="k06"></a></p>
<h2>6. Práce s&nbsp;výbìry ve skriptu</h2>

<p>Prakticky v¹echny operace s&nbsp;výbìry, které mù¾e interaktivnì provádìt
u¾ivatel pøi úpravách obrázku, lze implementovat i ve skriptech. Pro tyto úèely
nabízí grafický editor <i>GIMP</i> pomìrnì velké mno¾ství rùzných funkcí,
z&nbsp;nich¾ nìkteré (pravdìpodobnì ty nejpou¾ívanìj¹í) jsou vypsány
v&nbsp;následujících tabulkách. V&nbsp;první tabulce jsou vypsány operace
pou¾itelné pro vlastní definici oblasti výbìru:</p>

<table>
<tr><th>Název funkce</th><th>Význam</th></tr>
<tr><td>gimp-rect-select</td><td>výbìr obdélníkové oblasti</td></tr>
<tr><td>gimp-round-rect-select</td><td>výbìr oblasti ve tvaru obdélníka se zaoblenými rohy</td></tr>
<tr><td>gimp-ellipse-select</td><td>výbìr oblasti ve tvaru elipsy nebo kru¾nice</td></tr>
<tr><td>gimp-free-select</td><td>výbìr polygonální oblasti</td></tr>
<tr><td>gimp-fuzzy-select</td><td>výbìr oblasti na základì podobnosti barev sousedních pixelù</td></tr>
<tr><td>gimp-by-color-select</td><td>výbìr v¹ech pixelù stejné èi podobné barvy</td></tr>
</table>

<a href="http://i.iinfo.cz/images/277/scheme6a-10.png"><img src="http://i.iinfo.cz/images/277/scheme6a-10-prev.png" width="370" height="217" alt=" " /></a>
<p><i>Obrázek 10: Dialog zobrazený pøi spu¹tìní druhého demonstraèního
pøíkladu.</i></p>

<p>Následuje výpis nìkterých funkcí, které je mo¾né aplikovat na ji¾ vytvoøený
výbìr:</p>

<table>
<tr><th>Název funkce</th><th>Význam</th></tr>
<tr><td>gimp-edit-clear</td><td>vymazání výbìru</td></tr>
<tr><td>gimp-edit-copy</td><td>kopie výbìru do interního bufferu</td></tr>
<tr><td>gimp-edit-cut</td><td>provedení pøedchozích dvou pøíkazù</td></tr>
<tr><td>gimp-edit-paste</td><td>vlo¾ení výbìru z&nbsp;interního bufferu do obrázku</td></tr>
<tr><td>gimp-edit-stroke</td><td>obta¾ení hranice výbìru zvoleným kreslicím nástrojem</td></tr>
<tr><td>gimp-edit-fill</td><td>vyplnìní vybrané oblasti</td></tr>
<tr><td>gimp-selection-save</td><td>ulo¾ení výbìru do kanálu</td></tr>
<tr><td>gimp-selection-none</td><td>zru¹ení výbìru</td></tr>
</table>

<img src="http://i.iinfo.cz/images/277/scheme6a-11.png" width="400" height="400" alt=" " />
<p><i>Obrázek 11: Pøed spu¹tìním druhého demonstraèního pøíkladu je obrázek
prázdný (tak¾e pokud zde vidíte prázdnou plochu, je to zcela v&nbsp;poøádku
:-).</i></p>



<p><a name="k07"></a></p>
<h2>7. Druhý demonstraèní pøíklad &ndash; vybarvení vybrané oblasti</h2>

<p>Nìkteré z&nbsp;funkcí, které byly vypsány v&nbsp;pøedchozí kapitole, jsou
pou¾ity i v&nbsp;dne¹ním druhém demonstraèním pøíkladu. Tento pøíklad po svém
spu¹tìní nabídne u¾ivateli dialog (formuláø), ve kterém je mo¾né zadat barvu
výplnì a ¹íøku oblasti rozmazání hranice výbìru (navíc lze pomocí checkboxu
povolit èi naopak zakázat pou¾ití rozmazání hranice výbìru). Po stisku tlaèítka
<strong>OK</strong> nejprve skript vytvoøí výbìr ve tvaru ètverce, jeho¾
protilehlé rohy le¾í na souøadnicích [150, 150] a [250, 250], tj.&nbsp;ve
støedu obrázku o rozmìrech 400&times;400 pixelù. Následnì se k&nbsp;tomuto
ètverci pomocí mno¾inové operace sjednocení pøidají dal¹í dvì oblasti, ka¾dá ve
tvaru kru¾nice o polomìru 100 pixelù. Posléze je plocha výbìru vybarvena barvou
vybranou na dialogu a v&nbsp;posledním kroku je výbìr z&nbsp;obrázku odstranìn
(ov¹em lze ho jednodu¹e obnovit klávesovou zkratkou <i>CTRL+Z</i>, která vrátí
poslední provedenou operaci). Pov¹imnìte si pøedev¹ím toho, jaké parametry jsou
pøedávány funkcím <strong>gimp-rect-select</strong> a
<strong>gimp-ellipse-select</strong>. Kromì samotného tvaru výbìru (jeho
rozmìrech a poloze poèáteèního bodu) je nutné specifikovat po¾adovanou
mno¾inovou operaci a takté¾ parametry pro rozmazání hranice výbìru.</p>

<img src="http://i.iinfo.cz/images/277/scheme6a-12.png" width="400" height="400" alt=" " />
<p><i>Obrázek 12: Vybarvení oblasti výbìru modrou barvou. ©íøka rozmazání
hranice výbìru byla nastavena na velmi vysokou hodnotu (více ne¾ 20
pixelù).</i></p>

<p>Zdrojový kód druhého demonstraèního pøíkladu má tvar:</p>

<pre>
; Skriptování v GIMPu (3)
; Demonstraèní pøíklad èíslo 2

; Tato funkce je zavolána z dialogu vyvolaného u¾ivatelem
; z grafického u¾ivatelského rozhraní GIMPu.
(define (script-draw-selection
                             selected-image
                             selected-layer
                             selected-color
                             use-feather
                             feather-radius)
    ; vytvoøení výbìru ve tvaru ètverce
    (gimp-rect-select
        selected-image       ; obrázek v nìm¾ se výbìr vytvoøí
        150 150 100 100      ; rozmìry výbìru
        REPLACE              ; pøepsání oblasti pùvodního výbìru
        use-feather feather-radius) ; rozmazání hranice výbìru
    ; pøidání dal¹ího výbìru ve tvaru kru¾nice
    (gimp-ellipse-select
        selected-image       ; obrázek v nìm¾ se výbìr vytvoøí
        80 80 100 100        ; rozmìry výbìru
        ADD FALSE            ; pøidání oblasti ke stávajícímu výbìru
        use-feather feather-radius) ; rozmazání hranice výbìru
    ; pøidání dal¹ího výbìru ve tvaru kru¾nice
    (gimp-ellipse-select
        selected-image       ; obrázek v nìm¾ se výbìr vytvoøí
        220 220 100 100      ; rozmìry výbìru
        ADD FALSE            ; pøidání oblasti ke stávajícímu výbìru
        use-feather feather-radius) ; rozmazání hranice výbìru
    ; volba barvy v paletì
    (gimp-palette-set-background selected-color)
    ; vykreslení obrazce - jeho výplò
    (gimp-edit-fill selected-layer BG-IMAGE-FILL)
    ; zru¹ení výbìru (lze vrátit pomocí CTRL+Z)
    (gimp-selection-none selected-image)
    ; pøinutíme GIMP, aby finální obrázek vykreslil
    (gimp-displays-flush)  
)

; základní informace o skriptu a definice dialogu
; zobrazeného u¾ivateli
(script-fu-register "script-draw-selection"
    _"_Draw selection"
    _"Draws geometric shape using selection to current layer"
    "Pavel Tisnovsky"
    "Pavel Tisnovsky"
    "2010-05-18"
    "RGB*, INDEXED*, GRAY*"
    SF-IMAGE       "Image"         0
    SF-DRAWABLE    "Drawable"      0
 
    SF-COLOR      _"Color"          "black"
    SF-TOGGLE     _"Feather"        FALSE
    SF-ADJUSTMENT _"Feather radius" '(10 1 100 1 10 0 0)
)

; registrace skriptu do menu
(script-fu-menu-register "script-draw-selection"
                         "&lt;Image&gt;/Root.cz")

; finito
</pre>

<img src="http://i.iinfo.cz/images/277/scheme6a-13.png" width="400" height="400" alt=" " />
<p><i>Obrázek 13: Druhý demonstraèní pøíklad byl spu¹tìn znovu na tom samém
obrázku. Druhá vyplnìná oblast (tentokrát s&nbsp;pou¾itím ¾luté barvy) má ¹íøku
rozmazané hranice ji¾ men¹í &ndash; 10 pixelù.</i></p>

<img src="http://i.iinfo.cz/images/277/scheme6a-14.png" width="400" height="400" alt=" " />
<p><i>Obrázek 14: Tøetí spu¹tìní demonstraèního pøíkladu &ndash; pøes ¾lutý
obrazec byl nakreslen obrazec modrý, ov¹em ¹íøka rozmazání hranice výbìru byla
sní¾ena na pìt pixelù.</i></p>



<p><a name="k08"></a></p>
<h2>8. Obsah dal¹ího pokraèování seriálu</h2>

<p>V&nbsp;následující èásti tohoto seriálu se zamìøíme na dvì pomìrnì rozsáhlé
a pøitom dùle¾ité oblasti funkcionality rastrového grafického editoru
<i>GIMP</i>. Jedná se o práci s&nbsp;vrstvami a takté¾ o pou¾ití rùzných
filtrù, které tento grafický editor svým u¾ivatelùm nabízí. Právì
s&nbsp;vyu¾itím tìchto dvou nástrojù lze tvoøit i velmi komplikované skripty,
z&nbsp;nich¾ mnohé jsou dostupné ji¾ v&nbsp;základní instalaci <i>GIMPu</i>
v&nbsp;menu <i>Filters</i>. Výsledek práce jednoho relativnì jednoduchého
skriptu vyu¾ívajícího vrstvy a filtry, je zobrazen na obrázku èíslo 15.</p>

<img src="http://i.iinfo.cz/images/554/scheme4-7.png" width="256" height="256"  alt=" " />
<p><i>Obrázek 15: Výsledek èinnosti pomìrnì jednoduchého skriptu, který nejprve
na náhodných pozicích vykreslil nìkolik hvìzd (modifikací barev jednotlivých
pixelù, tj.&nbsp;metodou, kterou jsme si ji¾ popsali pøedminule) a posléze
pou¾il Gaussovy filtry na jejich rozmazání.</i></p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>A Script-Fu Tutorial<br />
<a href="http://www.linuxtopia.org/online_books/graphics_tools/gimp_user_manual/en/gimp-using-script-fu-tutorial.html">http://www.linuxtopia.org/online_books/graphics_tools/gimp_user_manual/en/gimp-using-script-fu-tutorial.html</a>
</li>

<li>A Script-Fu Tutorial<br />
<a href="http://docs.gimp.org/en/gimp-using-script-fu-tutorial.html">http://docs.gimp.org/en/gimp-using-script-fu-tutorial.html</a>
</li>

<li>Script-fu Tutorial<br />
<a href="http://www.seul.org/~grumbel/gimp/script-fu/script-fu-tut.html">http://www.seul.org/~grumbel/gimp/script-fu/script-fu-tut.html</a>
</li>

<li>Lambda calculus<br />
<a href="http://en.wikipedia.org/wiki/Lambda_calculus">http://en.wikipedia.org/wiki/Lambda_calculus</a>
</li>

<li>A Short Introduction to the Lambda Calculus<br />
<a href="http://www.cs.bham.ac.uk/~axj/pub/papers/lambda-calculus.pdf">http://www.cs.bham.ac.uk/~axj/pub/papers/lambda-calculus.pdf</a>
</li>

<li>A Tutorial Introduction to the Lambda Calculus<br />
<a href="http://www.inf.fu-berlin.de/lehre/WS03/alpi/lambda.pdf">http://www.inf.fu-berlin.de/lehre/WS03/alpi/lambda.pdf</a>
</li>

<li>(welcome '(schemers . org))<br />
<a href="http://www.schemers.org/">http://www.schemers.org/</a>
</li>

<li>Revised<sup>5</sup> Report on the Algorithmic Language Scheme<br />
<a href="http://www.schemers.org/Documents/Standards/R5RS/">http://www.schemers.org/Documents/Standards/R5RS/</a>
</li>

<li>The Revised<sup>6</sup> Report on the Algorithmic Language Scheme<br />
<a href="http://www.r6rs.org/">http://www.r6rs.org/</a>
</li>

<li>Scheme<br />
<a href="http://groups.csail.mit.edu/mac/projects/scheme/">http://groups.csail.mit.edu/mac/projects/scheme/</a>
</li>

<li>The Kawa language framework<br />
<a href="http://www.gnu.org/software/kawa/">http://www.gnu.org/software/kawa/</a>
</li>

<li>Scheme 48<br />
<a href="http://s48.org/">http://s48.org/</a>
</li>

<li>Introductory textbooks for Schemers<br />
<a href="http://www.schemers.org/Documents/#intro-texts">http://www.schemers.org/Documents/#intro-texts</a>
</li>

<li>Scheme (programming language)<br />
<a href="http://en.wikipedia.org/wiki/Scheme_(programming_language)">http://en.wikipedia.org/wiki/Scheme_(programming_language)</a>
</li>

<li>Scheme<br />
<a href="http://cs.wikipedia.org/wiki/Scheme">http://cs.wikipedia.org/wiki/Scheme</a>
</li>

<li>Scheme-faq<br />
<a href="http://community.schemewiki.org/?scheme-faq">http://community.schemewiki.org/?scheme-faq</a>
</li>

<li>Scheme implementations<br />
<a href="http://community.schemewiki.org/?scheme-faq-standards#implementations">http://community.schemewiki.org/?scheme-faq-standards#implementations</a>
</li>

<li>Successful Scheme<br />
<a href="http://www.itworld.com/swol-1013-regex">http://www.itworld.com/swol-1013-regex</a>
</li>

<li>Guy L. Steele, Jr.<br />
<a href="http://en.wikipedia.org/wiki/Guy_L._Steele">http://en.wikipedia.org/wiki/Guy_L._Steele</a>
</li>

<li>Gerald Jay Sussman<br />
<a href="http://en.wikipedia.org/wiki/Gerald_Jay_Sussman">http://en.wikipedia.org/wiki/Gerald_Jay_Sussman</a>
</li>

<li>PLT Scheme<br />
<a href="http://www.plt-scheme.org/">http://www.plt-scheme.org/</a>
</li>

<li>Quick: An Introduction to PLT Scheme with Pictures<br />
<a href="http://docs.plt-scheme.org/quick/">http://docs.plt-scheme.org/quick/</a>
</li>

<li>PLT Scheme<br />
<a href="http://en.wikipedia.org/wiki/Plt_scheme">http://en.wikipedia.org/wiki/Plt_scheme</a>
</li>

<li>PLT Scheme Guide<br />
<a href="http://docs.plt-scheme.org/guide/">http://docs.plt-scheme.org/guide/</a>
</li>

<li>The DrScheme Project: An Overview<br />
<a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.9543">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.9543</a>
</li>

<li>DrScheme<br />
<a href="http://en.wikipedia.org/wiki/DrScheme">http://en.wikipedia.org/wiki/DrScheme</a>
</li>

<li>How to Design Programs<br />
<a href="http://www.htdp.org/">http://www.htdp.org/</a>
</li>

<li>An Introduction to Scheme<br />
<a href="http://www.acm.org/crossroads/xrds1-2/scheme.html">http://www.acm.org/crossroads/xrds1-2/scheme.html</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

