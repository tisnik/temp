<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Superpoèítaèe Cray (druhá èást)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Superpoèítaèe Cray (druhá èást)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V&nbsp;dne¹ní èásti seriálu o historii výpoèetní techniky si popí¹eme historii vývoje i základní technické parametry první generace superpoèítaèù Cray. Takté¾ se zmíníme o pøekladaèi programovacího jazyka FORTRAN, který se na tìchto poèítaèích pou¾íval jako¾to hlavní vývojový prostøedek.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Historie superpoèítaèe Cray-1</a></p>
<p><a href="#k02">2. Smaller means faster</a></p>
<p><a href="#k03">3. Konstrukce superpoèítaèe Cray-1</a></p>
<p><a href="#k04">4. Superpoèítaè sestavený z&nbsp;pouhých ètyø typù èipù?</a></p>
<p><a href="#k05">5. Pracovní registry a formát zpracovávaných numerických hodnot</a></p>
<p><a href="#k06">6. Cray-1 Fortran Compiler (CFT)</a></p>
<p><a href="#k07">7. Optimalizace operací provádìných s&nbsp;vektory</a></p>
<p><a href="#k08">8. Namìøené rychlosti provádìní vektorizovaných blokù kódu</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Historie superpoèítaèe Cray 1</h2>

<p>V&nbsp;pøedchozí èásti seriálu o historii výpoèetní techniky jsme si øekli
základní informace o superpoèítaèích <i>Cray</i>, zejména pak fakt, ¾e se
jednalo o stroje navr¾ené s&nbsp;ohledem na dosa¾ení co nejvy¹¹ího výpoèetního
výkonu pøi provádìní numerických operací s&nbsp;èíselnými hodnotami
reprezentovanými v&nbsp;systému plovoucí øádové teèky (<i>FP &ndash; floating
point</i>). Výpoèetní výkon poèítaèe se pøi provádìní tìchto operací vìt¹inou
mìøí a uvádí v&nbsp;<i>MFLOPS</i>, tj.&nbsp;milionech FP operací provedených za
sekundu. Dnes si øekneme, jak vlastnì první poèítaè <i>Cray</i> vznikl, jaké
byly jeho technické parametry a na závìr se zmíníme i o pøekladaèi
programovacího jazyka <i>FORTRAN</i>, který byl upravený takovým zpùsobem, aby
mohl provádìt nìkteré operace (zapisované ve <i>FORTRANU</i> formou programové
smyèky <strong>DO</strong>) s&nbsp;vyu¾itím rychlého
&bdquo;vektorizovaného&ldquo; kódu, pøi jeho¾ provádìní se výsledky operací
ukládaly do nìkterého z&nbsp;osmi vektorových registrù, z&nbsp;nich¾ ka¾dý mìl
kapacitu pro 64 numerických hodnot.</p>

<a href="http://i.iinfo.cz/images/489/38cray01.jpg"><img src="http://i.iinfo.cz/images/489/38cray01-prev.jpg" width="273" height="270" alt=" " /></a>
<p><i>Obrázek 1: Konstruktéøi superpoèítaèù v&nbsp;minulosti a vlastnì i
v&nbsp;souèasnosti ne¹etøili místem, jak je to ostatnì patrné z&nbsp;této
dobové fotografie. O to více Seymour Cray pøekvapil své souèasníky tím, ¾e
Cray-1 byl podle tehdej¹ích mìøítek velmi kompaktní.</i></p>

<p>Historie poèítaèù <i>Cray</i> zaèala ji¾ v&nbsp;letech 1968 a¾ 1972, bìhem
nich¾ Seymour Cray pracoval ve firmì <i>Control Data</i> na vývoji poèítaèù
øady <i>CDC</i>, konkrétnì na modelech <i>CDC 6600</i>, <i>CDC 7600</i> (ve své
dobì se jednalo o nejvýkonnìj¹í poèítaè na svìtì, jeho¾ cena v&nbsp;základním
vybavení pøekroèila pìt milionù dolarù) a posléze i na <i>CDC 8600</i>. Právì
na tìchto poèítaèích Seymour Cray se svými spolupracovníky implementoval
funkèní jednotky, které mohly zpracovávat data ulo¾ená ve vektorech &ndash;
díky upravené aritmeticko-logické jednotce bylo mo¾né nìkteré operace
s&nbsp;vektory urychlit dvakrát a¾ ètyøikrát oproti klasickému sekvenènímu
zpracování. Ov¹em firma <i>CDC</i> zaèala mít kvùli soudnímu sporu s&nbsp;IBM
finanèní problémy a i z&nbsp;tìchto dùvodù (navíc kvùli nespokojenosti
s&nbsp;bující byrokracií) Cray firmu <i>Control Data</i> nakonec v&nbsp;roce
1972 opustil a zalo¾il <i>Cray Research</i> a pozdìji i <i>Cray Computer
Corporation</i>.</p>

<a href="http://i.iinfo.cz/images/319/38cray02.jpg"><img src="http://i.iinfo.cz/images/319/38cray02-prev.jpg" width="292" height="270" alt=" " /></a>
<p><i>Obrázek 2: Superpoèítaè CDC 6600.</i></p>

<p><i>"The goal as you might imagine is for me to get rid of all the official
functions &ndash; paper signing and things. That was accomplished well with the
contract simply because I don't have to sign anything anymore. I'm still very
involved in the company, and I think there's a feeling that it's a mutually
satisfactory arrangement."</i></p>



<p><a name="k02"></a></p>
<h2>2. Smaller means faster</h2>

<p>Po odchodu Seymoura Craye z&nbsp;firmy <i>CDC</i> projekt poèítaèe <i>CDC
8600</i> je¹tì dva roky skomíral a nakonec byl v&nbsp;roce 1974 ukonèen a firma
<i>CDC</i> se namísto toho zamìøila na vývoj poèítaèù <i>CDC STAR-100</i>.
Seymour Cray se naproti tomu ve svém startupu koneènì mohl soustøedit na vývoj
nového typu vysnìného superpoèítaèe, pøièem¾ se pouèil z&nbsp;nedostatkù strojù
<i>CDC</i>. Samotný styl vývoje, který Seymour Cray preferoval byl pomìrnì
zajímavý &ndash; nejradìji pou¾íval tu¾ku a obyèejný ètvereèkovaný papír a
odmítal se zabývat (èi mo¾ná lépe øeèeno zdr¾ovat) v&nbsp;té dobì nepøíli¹
propracovanými systémy CAD pro návrh zapojení ani simulátory elektronických
obvodù. Ka¾dý jeho (papírový) návrh byl následnì prohlédnut tøicetièlenným
týmem jeho spolupracovníkù, kteøí samozøejmì mohli uplatòovat svoje zmìny
v&nbsp;zapojení. Jednou z&nbsp;pomìrnì podstatných zmìn navr¾ených a
implementovaných v&nbsp;<i>Cray-1</i> oproti <i>CDC</i> bylo zavedení nových
typù registrù, do nich¾ mohly být ulo¾eny výsledky vektorových operací.</p>

<a href="http://i.iinfo.cz/images/580/38cray03.jpg"><img src="http://i.iinfo.cz/images/580/38cray03-prev.jpg" width="364" height="270" alt=" " /></a>
<p><i>Obrázek 3: Superpoèítaè CDC 7600.</i></p>

<p>Ka¾dý z&nbsp;tìchto registrù mìl ¹íøku 4096 bitù a jejich pou¾ití mìlo za
výsledek mnohem vy¹¹í výpoèetní rychlost celého poèítaèe oproti jeho
pøedchùdcùm <i>CDC 6600</i> a <i>CDC 7600</i>, kde se výsledky v¹ech operací
musely ukládat pøímo do operaèní pamìti.</p>

<a href="http://i.iinfo.cz/images/282/38cray04.png"><img src="http://i.iinfo.cz/images/282/38cray04-prev.png" width="270" height="270" alt=" " /></a>
<p><i>Obrázek 4: Rozmìry superpoèítaèe Cray-1.</i></p>



<p><a name="k03"></a></p>
<h2>3. Konstrukce superpoèítaèe Cray-1</h2>

<p>Dal¹í zmìnou, která byla patrná na první pohled, byl naprosto nový (a velmi
pravdìpodobnì i unikátní) design celého superpoèítaèe. <i>Cray-1</i> byl toti¾
sestaven z&nbsp;dvanácti vysokých skøíní, které byly spojeny takovým zpùsobem,
¾e tvoøily tøíètvrteèní kruh (270&deg;), tj.&nbsp;pùdorys celého superpoèítaèe
mìl tvar velkého písmene C. Seymour Cray se dr¾el zásady, ¾e men¹í poèítaè
znamená &ndash; samozøejmì pøi jeho správném návrhu &ndash; i rychlej¹í poèítaè
(<i>smaller means faster</i>), tak¾e celkové rozmìry <i>Craye-1</i> byly
pomìrnì malé, pøedev¹ím pøi porovnání s&nbsp;mainframy firmy IBM nebo
s&nbsp;ji¾ nìkolikrát zmínìnými poèítaèi <i>CDC</i>. Men¹í rozmìry stroje a
takté¾ jeho rozdìlení do skøíní umístìných v&nbsp;kruhu mìly za cíl zmen¹it
vzdálenost, kterou musely binární signály urazit pøi vzájemné komunikaci
jednotlivých modulù. Navíc chybìjící ètvrtkruh umo¾òoval vstup &bdquo;do
poèítaèe&ldquo;, jak pro náv¹tìvníky (kteøí se po nìkolika krocích ocitli
uvnitø stroje za nìkolik milionù dolarù :-), tak i samozøejmì pro techniky.</p>

<img src="http://i.iinfo.cz/images/625/37cray-a-1.jpg" width="350" height="467" alt=" " />
<p><i>Obrázek 5: Celkový pohled na superpoèítaè Cray-1.</i></p>

<p>Pod dvanácti skøínìmi byly umístìny sedaèky, v&nbsp;nich¾ bylo zabudováno
kapalinové chlazení (pou¾ívající kombinaci vodního a freonového okruhu) a
takté¾ èást napájecího systému. Spotøeba poèítaèe byla &bdquo;pouze&ldquo;
115kW a i díky pou¾ité technologii ECL byla spotøeba témìø konstantní, bez
ohledu na to, zda se provádìly nìjaké výpoèty èi zda poèítaè èekal na vstup
dat. Pou¾ití sedaèek nám mimochodem nìco prozrazuje o filozofii Seymoura Craye
&ndash; zatímco mainframy firmy IBM byly jako témìø bo¾¹tí vladaøi uzavøeny ve
výpoèetních sálech a jejich u¾ivatelé (kromì nìkolika privilegovaných)
k&nbsp;nim nemìli pøístup (pouze pøes vzdálené terminály nebo dìrovaèky
¹títkù/pásek), Cray umo¾nil u¾ivatelùm pøímý kontakt s&nbsp;poèítaèem, i kdy¾
samotné poøizování dat, jejich dlouhodobá úschova a v&nbsp;neposlední øadì i
pøeklad programù musel být ve skuteènosti provádìn na jiném stroji, typicky na
mainframu IBM/370.</p>

<a href="http://i.iinfo.cz/images/625/37cray-a-4.jpg"><img src="http://i.iinfo.cz/images/625/37cray-a-4-prev.jpg" width="360" height="270" alt=" " /></a>
<p><i>Obrázek 6: Detail spodní èásti superpoèítaèe CRAY-1S, kde mù¾eme
mj.&nbsp;vidìt i jeho chladicí systém.</i></p>



<p><a name="k04"></a></p>
<h2>4. Superpoèítaè sestavený z&nbsp;pouhých ètyø typù èipù?</h2>

<p>Superpoèítaè <i>Cray-1</i> byl, co¾ je mo¾ná ponìkud pøekvapivé, sestaven
z&nbsp;pouhých ètyø typù integrovaných obvodù. Jednalo se o velmi rychlou
statickou pamì» (SRAM) s&nbsp;organizací 16&times;4 bity a dobou pøístupu
pouhých ¹est nanosekund, která byla pou¾ita pro konstrukci registrù procesoru.
Druhým typem èipù byla opìt statická, ale o øád (50 ns) pomalej¹í pamì»
s&nbsp;organizací 1024&times;1 bit, z&nbsp;nich¾ byla sestavena operaèní pamì».
Tøetí a ètvrtý typ èipù byla rùznì rychlá hradla typu <strong>NAND</strong>
implementovaná bipolární technologií <i>ECL</i>. Zatímco
&bdquo;konkurenèní&ldquo; technologie <i>TTL</i> pou¾ívá taková zapojení
hradel, v&nbsp;nich¾ jsou bipolární tranzistory buï uzavøeny nebo naopak
saturovány, v&nbsp;<i>ECL</i> pracují tranzistory ve své aktivní oblasti
(podobnì jako v&nbsp;zesilovaèích). To má tu výhodu, ¾e se obchází pomìrnì
pomalý pøechod tranzistoru do a ze saturace, na druhou stranu protékají hradly
vytvoøené technologií <i>ECL</i> vìt¹í proudy, co¾ mù¾e vést k&nbsp;potøebì
pou¾ití výkonnìj¹ího zdroje a takté¾ výkonnìj¹ího chlazení (ov¹em se zvy¹ujícím
se kmitoètem spotøeba <i>TTL</i> hradel roste, na rozdíl od <i>ECL</i>, kde je
závislost na kmitoètu men¹í).</p>

<a href="http://i.iinfo.cz/images/175/38cray07.jpg"><img src="http://i.iinfo.cz/images/175/38cray07-prev.jpg" width="370" height="264" alt=" " /></a>
<p><i>Obrázek 7: Jedno z&nbsp;mo¾ných zapojení hradla vytvoøeného technologií
ECL.</i></p>

<p>V¹echny ètyøi typy integrovaných obvodù byly napájeny na plo¹ných spojích
konstantních rozmìrù 6&times;8 palcù. Jednalo se o pìtivrstvé plo¹né spoje; obì
okrajové vrstvy slou¾ily pro pøenos binárních signálù a na tøech vnitøních
vrstvách bylo rozvedeno napájecí napìtí: -5,2V, -2,0V a 0V (dùvod, proè jsou
pou¾ita právì tato napìtí, hledejte v&nbsp;pou¾ité technologii <i>ECL</i>).
Ka¾dý plo¹ný spoj byl vybaven konektorem a byl tedy pomìrnì snadno vymìnitelný.
Celkem 288 èipù tvoøilo jeden modul (poèet rùzných modulù se ustálil na èísle
113, co¾ není mnoho, kdy¾ si uvìdomíme, ¾e z&nbsp;nich byly slo¾eny v¹echny
obvody poèítaèe) a 72 modulù se vkládalo do jednoho ¹asi. Vzhledem k&nbsp;tomu,
¾e v¹ech 12 skøíní bylo tvoøeno 24 ¹asi, skládal se celý <i>Cray-1</i>
v&nbsp;maximální mo¾né konfiguraci celkem z&nbsp;1662 modulù z&nbsp;celkového
teoretického poètu 1728 modulù. Dodávku potøebných èipù (snadno lze spoèítat,
¾e v&nbsp;maximální konfiguraci se jedná o nìkolik set tisíc kusù) zajistily
firmy Motorola a Fairchild (které se mimochodem obì anga¾ovaly i ve vývoji
vlastních mikroprocesorù).</p>

<a href="http://i.iinfo.cz/images/577/38cray08.jpg"><img src="http://i.iinfo.cz/images/577/38cray08-prev.jpg" width="196" height="270" alt=" " /></a>
<p><i>Obrázek 8: Deska plo¹ných spojù superpoèítaèe Cray-1.</i></p>



<p><a name="k05"></a></p>
<h2>5. Pracovní registry a formát zpracovávaných numerických hodnot</h2>

<p>Ji¾ v&nbsp;pøedchozí èásti tohoto seriálu jsme si øekli, ¾e Seymour Cray ve
svých poèítaèích ne¹etøil na poètu ani rozsahu pracovních registrù. Platí to
samozøejmì také pro poèítaè <i>Cray-1</i>, který obsahoval pomìrnì velké
mno¾ství rùzných typù registrù. Jednalo se pøedev¹ím o sadu osmi 24bitových
adresových registrù <strong>A0</strong> a¾ <strong>A7</strong>, osm registrù
urèených pro zpracování skalárních hodnot <strong>S0</strong> a¾
<strong>S7</strong>, 64 registrù pro uchování skalárních hodnot
<strong>Tx</strong> a v&nbsp;neposlední øadì té¾ o osm registrù, z&nbsp;nich¾
ka¾dý mohl uchovat ¹edesát ètyøi 64bitových hodnot (celkem tedy 4096 bitù).
Tyto takzvané vektorové registry se oznaèovaly symboly <strong>V0</strong> a¾
<strong>V7</strong>. Pokud bychom spoèítali celkovou kapacitu v¹ech registrù
(nìkolik jsem jich pro jednoduchost neuvedl), dojdeme k&nbsp;pøekvapivì velkému
èíslu 4888 bajtù. Porovnejte si tuto hodnotu s&nbsp;osmibitovými
mikroprocesory, které v&nbsp;té dobì kralovaly (7 bajtù u 6502, 10 bajtù u
8080)...</p>

<img src="http://i.iinfo.cz/images/625/37cray-a-3.jpg" width="405" height="540" alt=" " />
<p><i>Obrázek 9: Detail spodní èásti superpoèítaèe CRAY-1S. Na pravé stranì
fotografie je patrný &bdquo;vstup&ldquo; do vnitøního prostoru stroje.</i></p>

<p>Poèítaèe <i>Cray-1</i> pou¾ívaly pro skalární i vektorové operace numerické
hodnoty ulo¾ené v&nbsp;systému plovoucí øádové èárky (<i>FP</i>). Tyto hodnoty
byly sice ulo¾ené v&nbsp;64 bitech, podobnì jako je tomu u formátu
<i>double</i> v&nbsp;normì IEEE 754, ov¹em význam jednotlivých bitù je ponìkud
jiný, tak¾e se li¹í jak rozsah uchovávaných hodnot, tak i poèet platných míst,
co¾ je patrné z&nbsp;následující tabulky:</p>

<table>
<tr><th>&nbsp;</th><th>Min</th><th>Max</th><th>Poèet míst</th></tr>
<tr><td>IEEE single</td><td>1.17E-0038</td><td>3.40E+0038</td><td> 7</td></tr>
<tr><td>IEEE double</td><td>2.22E-0308</td><td>1.79E+0308</td><td>16</td></tr>
<tr><td>Cray single</td><td>3.67E-2466</td><td>2.73E+2465</td><td>15</td></tr>
</table>

<p>Obsazení bitù v&nbsp;64bitovém slovu (registru) je u poèítaèù <i>Cray-1</i>
následující:</p>

<pre>
 1 1      14                              48
+-+-+--------------+------------------------------------------------+
|s|t|      e       |                       m                        |
+-+-+--------------+------------------------------------------------+
</pre>

<p>kde:</p>

<ul>
<li><strong>s</strong>: znaménko mantisy</li>
<li><strong>t</strong>: znaménko exponentu</li>
<li><strong>e</strong>: exponent</li>
<li><strong>m</strong>: mantisa</li>
</ul>

<a href="http://i.iinfo.cz/images/632/38cray10.jpg"><img src="http://i.iinfo.cz/images/632/38cray10-prev.jpg" width="347" height="270" alt=" " /></a>
<p><i>Obrázek 10: Formuláø pou¾ívaný pro formalizovaný zápis programu ve
Fortranu. Tento zápis byl vydìrován na ¹títky/pásky a pøelo¾en, výsledkem byla
vìt¹inou opìt sada dìrných ¹títkù èi dìrných pásek.</i></p>



<p><a name="k06"></a></p>
<h2>6. Cray-1 Fortran Compiler (CFT)</h2>

<p><i>&bdquo;A computer without COBOL and FORTRAN is like a piece of chocolate
cake without ketchup or mustard.&ldquo;</i></p>

<p>Pro efektivní vyu¾ití v¹ech technických prostøedkù, které superpoèítaè
<i>Cray-1</i> svým u¾ivatelùm nabízel bylo nutné vytvoøit i vhodné základní
vývojové nástroje. Vzhledem k&nbsp;tomu, ¾e <i>Cray-1</i> byl urèen pøedev¹ím
pro provádìní numerických výpoètù a také kvùli tomu, ¾e se pro tyto úèely ji¾
od poloviny padesátých let minulého století pou¾íval programovací jazyk
<i>FORTRAN</i>, není divu, ¾e byl tento jazyk, navr¾ený a implementovaný poprvé
v&nbsp;IBM týmem Johna W.&nbsp;Backuse, portován i na superpoèítaèe
<i>Cray-1</i> pod názvem <i>CRAY-1 Fortran Compiler</i> neboli zkrácenì
<i>CFT</i>. <i>FORTRAN</i> byl ji¾ od svých prvních verzí, urèených pùvodnì pro
mainframy <i>IBM 704</i>, vybaven v¹emi základními aritmetickými i relaèními
operátory, mo¾ností práce s&nbsp;komplexními èísly, takzvaným
&bdquo;aritmetickým IF&ldquo; (variantou podmínìného pøíkazu
<strong>IF</strong>, v&nbsp;nìm¾ byla podmínka vyjádøena aritmetickým výrazem,
nikoli výrazem pravdivostním), pomìrnì bohatými mo¾nostmi formátování
numerických hodnot pøi jejich tisku atd., co¾ plnì vyhovovalo oboru, ve kterých
se mìly superpoèítaèe <i>Cray</i> pou¾ívat.</p>

<a href="http://i.iinfo.cz/images/38/ibm-5-3.jpg"><img src="http://i.iinfo.cz/images/38/ibm-5-3-prev.jpg" alt="ibm-5" height="270" width="211" /></a>
<p><i>Obrázek 11: Manuál k&nbsp;první verzi FORTRANu urèeného pro mainframy IBM
704.</i></p>

<p>Pøekladaè <i>CFT</i> byl zalo¾en na <i>FORTRANu IV</i> a posléze byl upraven
tak, aby odpovídal normì
ANSI z&nbsp;roku 66 (FORTRAN 66). Od mnoha ostatních pøekladaèù Fortranu se
<i>CFT</i> odli¹oval pøedev¹ím v&nbsp;tom ohledu, ¾e se sna¾il nìkteré
programové smyèky typu <strong>DO</strong> (jedná se o poèítané smyèky zhruba
odpovídající Céèkovým èi Javovským smyèkám typu <strong>FOR</strong>) pøekládat
do takové podoby, aby se pøi jejich provádìní vyu¾ilo zøetìzení výpoètù a
vyu¾ití vektorových registrù <strong>V0</strong> a¾ <strong>V7</strong>,
z&nbsp;nich¾ ka¾dý, jak ji¾ víme z&nbsp;pøedchozích kapitol, dokázal uchovat 64
prvkù (numerických hodnot). První verze <i>CFT</i> sice dokázaly
&bdquo;vektorizovat&ldquo; pouze urèité pøíkazy v&nbsp;programových smyèkách
(viz té¾ dal¹í kapitolu), ov¹em pro dal¹í typy superpoèítaèù <i>Cray</i> byly
k&nbsp;dispozici pøekladaèe s&nbsp;vylep¹enými algoritmy pro rozpoznání
vektorizovatelných a nevektorizovatelných èástí kódu. V&nbsp;pøípadì, ¾e
strojový kód generovaný <i>CFT</i> programátorùm nevyhovoval, mohla být èást
programu (nebo i celý program) samozøejmì napsána i v&nbsp;jazyku symbolických
instrukcí a pøelo¾ena pomocí makro assembleru nazvaného pøímoèaøe <i>Cray
Assembler Language</i> neboli <i>CAL</i> (neplést s&nbsp;INTERCALem :-).</p>

<a href="http://i.iinfo.cz/images/38/ibm-5-4.jpg"><img src="http://i.iinfo.cz/images/38/ibm-5-4-prev.jpg" alt="ibm-5" height="270" width="191" /></a>
<p><i>Obrázek 12: Spolu s&nbsp;roz¹iøováním Fortranu z&nbsp;mainframù firmy IBM
na dal¹í architektury (pozdìji i na superpoèítaèe Cray) se zvy¹ovala potøeba
standardizace tohoto jazyka. Postupnì vzniklo nìkolik norem, napøíklad ANSI
norma FORTRAN 66, FORTRAN 77, èi ANSI/ISO standard Fortran 90 (názvy standardù
jsou uvedeny správnì &ndash; jméno jazyka se skuteènì postupem èasu zmìnilo z
&bdquo;FORTRAN&ldquo; na &bdquo;Fortran&ldquo;).</i></p>



<p><a name="k07"></a></p>
<h2>7. Optimalizace operací provádìných s&nbsp;vektory</h2>

<p><i>&bdquo;Real Programmers don't write in PL/I. PL/I is for programmers who
can't decide whether to write in COBOL or FORTRAN.&ldquo;</i></p>

<p>V&nbsp;pøedchozí kapitole jsme si øekli, ¾e první pøekladaè programovacího
jazyka FORTRAN pro superpoèítaèe <i>Cray-1</i>, který mìl zkratku <i>CFT</i>,
dokázal vektorizovat pouze nìkteré typy smyèek. Jednalo se o poèítané smyèky
typu <strong>DO</strong> obsahující takové výrazy, v&nbsp;nich¾ se manipulovalo
s&nbsp;poli a výsledky operací se takté¾ ukládaly do (obecnì jiného) pole.
Pou¾ité aritmetické výrazy mohly obsahovat volání nìkterých funkcí, o nich¾
pøekladaè pøedem vìdìl, ¾e je mo¾né je volat zøetìzenì (jednalo se napøíklad o
nìkteré goniometrické funkce, výpoèet absolutní hodnoty atd.). Aritmetických
výrazù mohlo být ve smyèce uvedeno vìt¹í mno¾ství, jejich maximální poèet
kolísal podle toho, jak se podaøilo obsadit vektorové registry
<strong>V0</strong> a¾ <strong>V7</strong> (to zále¾elo nejenom na poètu výrazù
v&nbsp;programové smyèce, ale i na jejich slo¾itosti, co¾ je ostatnì logické).
Ov¹em první verze <i>CFT</i> nedokázala plnì vektorizovat takové smyèky, které
obsahovaly podmínku (<strong>IF</strong>), pøíkaz pro provedení skoku
<strong>GOTO</strong> èi volání nevektorizovatelné funkce
(<strong>CALL</strong>).</p>

<img src="http://i.iinfo.cz/images/38/ibm-5-5.png" alt="ibm-5" height="193" width="336" />
<p><i>Obrázek 13: Ukázka programu napsaného ve FORTRANu II, ve kterém mù¾eme
mj.&nbsp;vidìt i pou¾ití aritmetického IF, formátování výsledkù, rozdìlení
øádkù zdrojového kódu do sekcí (návì¹tí, zaèátek komentáøe, zaèátek pøíkazu) a
takté¾ pou¾ití èísel øádkù (návì¹tí) v&nbsp;tìch pøípadech, kdy je øádek cílem
skoku.</i></p>

<p>Pøedev¹ím nemo¾nost pou¾ít pøíkaz <strong>IF</strong> uvnitø programové
smyèky ponìkud omezovala mo¾nosti efektivního pou¾ití <i>CFT</i> pro nìkteré
typy výpoètù, ov¹em na druhou stranu je vhodné øíci, ¾e v&nbsp;mnoha pøípadech
bylo mo¾né podmínìný pøíkaz nahradit výpoètem, který sice mohl na první pohled
vypadat slo¾itì, ale ve výsledku mohl být proveden mnohem rychleji ne¾
regulární podmínìný programový blok (popø.&nbsp;skok na základì splnìní èi
nesplnìní nìjaké podmínky). Pokud byly splnìny vý¹e uvedené podmínky pro
vektorizaci, byly výsledky ukládány do vektorových registrù <strong>V0</strong>
a¾ <strong>V7</strong>, popø.&nbsp;byly nìkteré tyto registry pou¾ity i pro
zdrojová data. A¾ po zpracování v¹ech 64 prvkù v&nbsp;registru se provedlo jeho
ulo¾ení do operaèní pamìti. Teoretický limit pro provedení jedné iterace smyèky
odpovídal poètu referencí do operaèní pamìtí (výraz <i>B(I)</i> je pøíkladem
provedení jednoho pøístupu do pamìti, naproti tomu <i>B(I)*C(I)</i> provádí dva
pøístupy) zvý¹ených o jeden cyklus, který trvá provedení po¾adované aritmetické
èi logické operace v&nbsp;jedné funkèní jednotce. Výsledky reálného mìøení
výkonnosti superpoèítaèe <i>Cray-1</i> a souèasnì i ukázky optimalizaèních
schopností první verze <i>CFT</i> jsou uvedeny v&nbsp;následující kapitole.</p>

<a href="http://i.iinfo.cz/images/314/38cray14.jpg"><img src="http://i.iinfo.cz/images/314/38cray14-prev.jpg" width="370" height="177" alt=" " /></a>
<p><i>Obrázek 14: Program ve Fortranu ulo¾ený na dìrném ¹títku (samotný pøíkaz
je nati¹tìný na horním okraji ¹títku).</i></p>



<p><a name="k08"></a></p>
<h2>8. Namìøené rychlosti provádìní vektorizovaných blokù kódu</h2>

<p>Pro ilustraci úèinnosti vektorizace podporované ji¾ od první verze
pøekladaèe FORTRANu na poèítaèi <i>Cray-1</i> pøi provádìní bì¾ných
aritmetických operací nad prvky vektoru (pøesnìji øeèeno FORTRANovského pole)
jsou v&nbsp;ní¾e uvedené tabulce zapsány namìøené èasy provedení jednoho kroku
jednoduché poèítané programové smyèky (tj.&nbsp;celkový èas výpoètu je vydìlen
poètem opakování smyèky), její¾ obecný tvar lze v&nbsp;klasickém FORTRANu
zapsat následujícím zpùsobem:</p>

<pre>
   DO 10 I=1,N
10 A(I)=B(I)
</pre>

<p>Tìlo smyèky, tj.&nbsp;pøedev¹ím pravá strana pøiøazovacího pøíkazu na øádku
s&nbsp;návì¹tím 10, je pro ka¾dý øádek tabulky odli¹né, stejnì jako je pro
ka¾dý sloupec odli¹ná mezní hodnota poèitadla smyèky <strong>I</strong>.
Výsledky jsou získány jak pro pøeklad s&nbsp;povolenou vektorizací (pro N=1,
10, 100 a 1000), tak i pro pøeklad, pøi nìm¾ je tìlo smyèky pøelo¾eno takovým
zpùsobem, ¾e je provádìno sekvenènì. Ve sloupci &bdquo;teoretický limit&ldquo;
je zapsán poèet cyklù pro ka¾dou iteraci, který by v&nbsp;nejlep¹ím mo¾ném
(ideálním) pøípadì mìl platit pro velmi velká N. Tato hodnota je získána na
základì poètu provádìných pamì»ových referencí v&nbsp;ka¾dém kroku smyèky, ke
kterému je pøiètena jednièka v&nbsp;pøípadì jednoduchých operací (pøiøazení,
základní aritmetické operace, ...). Výsledky uvedené v&nbsp;následující tabulce
jsou získány z&nbsp;èlánku &bdquo;The Cray-1 Computer System&ldquo;, jeho¾
autorem je Richard M.&nbsp;Russell z&nbsp;firmy Cray Research, Inc.:</p>

<table>
<tr><th>#</th><th>Tìlo smyèky</th><th>N=1</th><th>N=10</th><th>N=100</th><th>N=1000</th><th>teoretický limit</th><th>1000 skalárních operací</th></tr>
<tr><td>1</td><td>A(I)=1.0       </td><td> 41.0</td><td>  5.5</td><td>  2.6</td><td>  2.6</td><td>2</td><td> 22.5</td></tr>
<tr><td>2</td><td>A(I)=B(I)      </td><td> 44.0</td><td>  5.8</td><td>  2.7</td><td>  2.5</td><td>2</td><td> 31.0</td></tr>
<tr><td>3</td><td>A(I)=B(I)+10.0 </td><td> 55.0</td><td>  6.9</td><td>  2.9</td><td>  2.6</td><td>2</td><td> 37.0</td></tr>
<tr><td>4</td><td>A(I)=B(I)+C(I) </td><td> 59.0</td><td>  8.2</td><td>  3.9</td><td>  3.7</td><td>3</td><td> 41.0</td></tr>
<tr><td>5</td><td>A(I)=B(I)*C(I) </td><td> 60.0</td><td>  8.3</td><td>  4.0</td><td>  3.7</td><td>3</td><td> 42.0</td></tr>
<tr><td>6</td><td>A(I)=B(I)/C(I) </td><td> 94.0</td><td> 10.8</td><td>  4.1</td><td>  3.7</td><td>3</td><td> 52.0</td></tr>
<tr><td>7</td><td>A(I)=SIN(B(I)) </td><td>462.0</td><td> 61.0</td><td> 33.3</td><td> 31.4</td><td>?</td><td>198.1</td></tr>
<tr><td>8</td><td>A(I)=ASIN(B(I))</td><td>430.0</td><td>209.5</td><td>189.5</td><td>188.3</td><td>?</td><td>169.1</td></tr>
</table>

<p>V&nbsp;pøedchozí tabulce mù¾eme rozeznat ètyøi skupiny smyèek. Na prvních
tøech øádcích jsou operace, které vy¾adují jeden (nebo ¾ádný) pøístup do pole
B(I), tak¾e teoretický limit je v&nbsp;tomto pøípadì roven dvìma cyklùm pro
ka¾dou iteraci. Na øádcích 4, 5 a 6 se ji¾ provádí aritmetická operace v¾dy nad
prvky dvou vektorù (polí), co¾ výpoèet prodlu¾uje jak teoreticky, tak i
prakticky. Pov¹imnìte si ov¹em, ¾e zatímco jediná operace podílu trvá zhruba o
30% del¹í èas ne¾ operace souètu, po vektorizaci smyèky se pro dostateènì
dlouhé N doby provedení jedné iterace smyèky k&nbsp;sobì pøiblí¾í a pro N=1000
jsou dokonce toto¾né. Na øádku èíslo 7 je ukázáno, ¾e vektorizace mù¾e být
úèinná i v&nbsp;tìch pøípadech, kdy je volána nìjaká funkce (zde sinus), která
je sama o sobì vektorizovatelná. Ov¹em ji¾ øádek následující ukazuje, ¾e
v&nbsp;pøípadì volání nevektorizovatelné funkce (arkussinus skuteènì nelze na
<i>Crayi-1</i> vektorizovat) není vektorizace programové smyèky úèinná a doba
provedení jedné iterace je v&nbsp;tomto pøípadì dokonce del¹í (pro libovolné
N), ne¾ sekvenèní provádìní smyèky. Ov¹em pokud by programová smyèka obsahovala
i dal¹í operace, byl by výsledek pøívìtivìj¹í.</p>

<a href="http://i.iinfo.cz/images/277/c8cray15.png"><img src="http://i.iinfo.cz/images/277/c8cray15-prev.png" width="370" height="268" alt=" " /></a>
<p><i>Obrázek 15: Doba trvání jednoho kroku programové smyèky pro rùzné typy
operací a pro rùznou délku zpracovávaného vektoru. Pov¹imnìte si, ¾e pro malé N
(1,2) je vìt¹inou doba trvání &bdquo;vektorizované&ldquo; smyèky del¹í, ne¾
její sekvenèní provedení, co¾ je daò za pøípravu funkèních jednotek a pou¾ití
vektorových registrù. Pro rostoucí N je v¹ak výhoda vektorizace zøejmá.</i></p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>Cray History<br />
<a href="http://www.cray.com/About/History.aspx?404;http://www.cray.com:80/about_cray/history.html">http://www.cray.com/About/History.aspx?404;http://www.cray.com:80/about_cray/history.html</a>
</li>

<li>Cray Historical Timeline<br />
<a href="http://www.cray.com/Assets/PDF/about/CrayTimeline.pdf">http://www.cray.com/Assets/PDF/about/CrayTimeline.pdf</a>
</li>

<li>Seymour Cray Biography<br />
<a href="http://www.cray.com/Assets/PDF/about/SeymourCray.pdf">http://www.cray.com/Assets/PDF/about/SeymourCray.pdf</a>
</li>

<li>Company: Cray Research, Inc. (Computer History)<br />
<a href="http://www.computerhistory.org/brochures/companies.php?alpha=a-c&amp;company=com-42b9d5d68b216">http://www.computerhistory.org/brochures/companies.php?alpha=a-c&amp;company=com-42b9d5d68b216</a>
</li>

<li>Cray Wiki<br />
<a href="http://www.craywiki.com/index.php?title=Main_Page">http://www.craywiki.com/index.php?title=Main_Page</a>
</li>

<li>Seymour Cray<br />
<a href="http://www.craywiki.com/index.php?title=Seymour_Cray">http://www.craywiki.com/index.php?title=Seymour_Cray</a>
</li>

<li>Cray (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Cray">http://en.wikipedia.org/wiki/Cray</a>
</li>

<li>Cray-1 (Cray Wiki)<br />
<a href="http://www.craywiki.com/index.php?title=Cray_1S">http://www.craywiki.com/index.php?title=Cray_1S</a>
</li>

<li>Cray-1 (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Cray-1">http://en.wikipedia.org/wiki/Cray-1</a>
</li>

<li>Cray X-MP (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Cray_X-MP">http://en.wikipedia.org/wiki/Cray_X-MP</a>
</li>

<li>Cray-2 (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Cray-2">http://en.wikipedia.org/wiki/Cray-2</a>
</li>

<li>What Limits Forecast Accuracy?<br />
<a href="http://weather.mailasail.com/Franks-Weather/Forecast-Accuracy-Limitations">http://weather.mailasail.com/Franks-Weather/Forecast-Accuracy-Limitations</a>
</li>

<li>Remembering the Cray-1<br />
<a href="http://www.theregister.co.uk/2008/01/05/tob_cray1/">http://www.theregister.co.uk/2008/01/05/tob_cray1/</a>
</li>

<li>Cray Supercomputer FAQ and other documents<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/index.html">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/index.html</a>
</li>

<li>Cray Research and Cray computers FAQ Part 1<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp1.html#TOC">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp1.html#TOC</a>
</li>

<li>Cray Research and Cray computers FAQ Part 2<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp2.html#TOC1">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp2.html#TOC1</a>
</li>

<li>Cray Research and Cray computers FAQ Part 3<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp3.html#TOC1">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp3.html#TOC1</a>
</li>

<li>Cray Research and Cray computers FAQ Part 4<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp4.html#TOC1">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp4.html#TOC1</a>
</li>

<li>Cray Research and Cray computers FAQ Part 5<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp5.html#TOC1">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp5.html#TOC1</a>
</li>

<li>The making of a CRAY-3<br />
<a href="http://www.cisl.ucar.edu/docs/SCD_Newsletter/News_summer93/04e.cray3.html">http://www.cisl.ucar.edu/docs/SCD_Newsletter/News_summer93/04e.cray3.html</a>
</li>

<li>Computer Speed Claims 1980 to 1996<br />
<a href="http://homepage.virgin.net/roy.longbottom/mips.htm">http://homepage.virgin.net/roy.longbottom/mips.htm</a>
</li>

<li>Speed of Intel 8087 co-processor in FLOPS ($100)<br />
<a href="http://answers.google.com/answers/threadview/id/542435.html">http://answers.google.com/answers/threadview/id/542435.html</a>
</li>

<li>Million instructions per second<br />
<a href="http://en.wikipedia.org/wiki/Mflops">http://en.wikipedia.org/wiki/Mflops</a>
</li>

<li>Million instructions per second<br />
<a href="http://en.wikipedia.org/wiki/Million_instructions_per_second#Million_instructions_per_second">http://en.wikipedia.org/wiki/Million_instructions_per_second#Million_instructions_per_second</a>
</li>

<li>Rosetta Code &ndash; Category:Fortran<br />
<a href="http://rosettacode.org/wiki/Fortran">http://rosettacode.org/wiki/Fortran</a>
</li>

<li>IBM 36-bit computers<br />
<a href="http://www.36bit.org/ibm/">http://www.36bit.org/ibm/</a>
</li>

<li>Symbolics 36-bit computers<br />
<a href="http://www.36bit.org/symbolics/">http://www.36bit.org/symbolics/</a>
</li>

<li>IBM System 360/370 Compiler and Historical Documentation<br />
<a href="http://www.edelweb.fr/Simula/">http://www.edelweb.fr/Simula/</a>
</li>

<li>Who Was Who in IBM's Programming Research? Early FORTRAN Days<br />
<a href="http://www.trailing-edge.com/~bobbemer/PRORES.HTM">http://www.trailing-edge.com/~bobbemer/PRORES.HTM</a>
</li>

<li>Emitter-coupled logic<br />
<a href="http://en.wikipedia.org/wiki/Emitter-coupled_logic">http://en.wikipedia.org/wiki/Emitter-coupled_logic</a>
</li>

<li>ECL &ndash; Emitter Coupled Logic<br />
<a href="http://ppd.fnal.gov/elec/ecl/ecl.html">http://ppd.fnal.gov/elec/ecl/ecl.html</a>
</li>

<li>Cray's Mark Remains Speed With Simplicity<br />
<a href="http://www.mbbnet.umn.edu/hoff/hoff_sc.html">http://www.mbbnet.umn.edu/hoff/hoff_sc.html</a>
</li>

<li>Control Data Corporation (CDC) 6600: 1966-1977<br />
<a href="http://www.cisl.ucar.edu/computers/gallery/cdc/6600.jsp">http://www.cisl.ucar.edu/computers/gallery/cdc/6600.jsp</a>
</li>

<li>Control Data Corporation (CDC) 7600: 1971-1983<br />
<a href="http://www.cisl.ucar.edu/computers/gallery/cdc/7600.jsp">http://www.cisl.ucar.edu/computers/gallery/cdc/7600.jsp</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

