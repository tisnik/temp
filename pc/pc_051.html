<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>General MIDI a formát souborù SMF</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         /*
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         */
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>General MIDI a formát souborù SMF</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dne¹ní èásti seriálu o architekturách poèítaèù si popí¹eme interní strukturu formátu souborù SMF, které vìt¹inou mívají koncovku .mid. Tyto soubory jsou pou¾ívané pro ukládání, pøenos a pøehrávání jednostopé i vícestopé hudby na rùzných systémech, vèetnì bì¾ných osobních poèítaèù vybavených zvukovým èipem.</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. General MIDI a formát souborù SMF</a><br />
<a href="#k02">2. Typy souborù SMF</a><br />
<a href="#k03">3. Hlavièka souborù SMF</a><br />
<a href="#k04">4. Hudební data (stopy)</a><br />
<a href="#k05">5. Èasové znaèky</a><br />
<a href="#k06">6. Literatura</a><br />
<a href="#k07">7. Odkazy na Internetu</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. General MIDI a formát souborù SMF</h1>

<p>Ve standardu <i>General MIDI</i> je kromì dal¹ích po¾adavkù specifikován i
formát souborù oznaèovaných zkratkou <i>SMF</i>, neboli <i>Standard MIDI
File</i>. Jedná se o binární soubory, které mají vìt¹inou pøíponu
<strong>.mid</strong>; u nìkterých roz¹íøených verzí se v¹ak koncovka mù¾e
li¹it. Tyto soubory se díky své pomìrnì jednoduché struktuøe, úspornému záznamu
hudby a otevøenosti formátu hojnì roz¹íøily, a to jak mezi hudebníky (mnohé
klávesy napøíklad obsahují disketovou jednotku nebo USB rozhraní, ze kterých je
mo¾né <i>SMF</i> soubory pøehrávat), tak i mezi majiteli osobních poèítaèù.
V&nbsp;<i>SMF</i> souborech mù¾e být ulo¾ena buï jedna hudební stopa, nebo
&ndash; v&nbsp;pøípadì pou¾ití vìt¹ího mno¾ství hudebních nástrojù &ndash; stop
více. Hudba pøitom není ulo¾ena ve formì samplù, jak je tomu napøíklad
v&nbsp;pøípadì formátu <i>WAVE (RIFF)</i> èi <i>MP3</i>, ale jako posloupnost
takzvaných událostí (<i>events</i>), co¾ jsou ve svém principu MIDI zprávy
(popsané v&nbsp;pøedchozí èásti seriálu) doplnìné o èasovou znaèku tak, aby
bylo mo¾né pøesnì zaznamenat i zaèátek a konec pøehrávání urèitého tónu nebo
celého akordu. Vzhledem k&nbsp;tomu, ¾e ka¾dá událost je ulo¾ená pouze na
nìkolika bajtech, bývají soubory <i>SMF</i> velmi malé &ndash; celá
nìkolikaminutová skladba se mù¾e zapsat do souboru majícího velikost jen
nìkolik málo kilobajtù.</p>

<image id="8475" original="no" />
<p-center><i>Obrázek 1: Pøehrávání hudby ulo¾ené ve formátu SMF
(s&nbsp;koncovkou MIDI) pomocí u¾iteèné aplikace &bdquo;timidity&ldquo; na
poèítaèi s&nbsp;Linuxem. MIDI lze samozøejmì pøehrát i s&nbsp;vyu¾itím aplikací
s&nbsp;grafickým u¾ivatelským rozhraním, napøíklad XMMS.</i></p-center>



<p><a name="k02"></a></p>
<h1>2. Typy souborù SMF</h1>

<p>Ve standardu jsou popsány tøi typy (subformáty) souborù <i>SMF</i>, které
jsou oznaèovány jako <i>Type-0</i>, <i>Type-1</i> a <i>Type-2</i>.
V&nbsp;minulosti se velmi èasto pou¾íval typ 0, jeho¾ interní struktura je
nejjednodu¹¹í (obsahuje toti¾ jen jednu hudební stopu), ov¹em napøíklad záznam
vícehlasé hudby musí být øe¹en pomocí triku. Dnes se mù¾eme èasto setkat
s&nbsp;typem 1, jeho¾ pøednost spoèívá v&nbsp;mo¾nosti pou¾ití vìt¹ího mno¾ství
hudebních stop (1 a¾ 65535), pøièem¾ události pro ka¾dý hudební nástroj jsou
ulo¾eny v&nbsp;samostatné stopì. Typ 2 se prozatím pøíli¹ neroz¹íøil.
Z&nbsp;tohoto dùvodu bude dal¹í popis zamìøen pøedev¹ím na subformáty
<i>Type-0</i> a <i>Type-1</i>. Pøed podrobnìj¹ím popisem interní struktury
souborù <i>SMF</i> si pøipomeòme, ¾e v&nbsp;General MIDI jsou pøesnì stanovena
èísla pro jednotlivé typy hudebních nástrojù (viz zpráva typu <strong>Program
Change</strong>) a desátý kanál je vyhrazen pro bicí (perkusní) nástroje, u
nich¾ se vìt¹inou nezaznamenává vý¹ka jimi generovaného zvuku (pøehrávaná
nota).</p>

<p>Vlastní zvuky hudebních nástrojù v&nbsp;souborech <i>SMF</i> ulo¾eny nejsou,
co¾ pøedstavuje pomìrnì velký rozdíl oproti formátùm typu <i>MOD</i> (Amiga
Module) èi <i>XM</i>, v&nbsp;nich¾ jsou ulo¾eny jak hudební stopy, tak i samply
nástrojù èi jiných zvukù (u <i>SMF</i> se o pøehrávání stará samotné cílové
hudební zaøízení, které musí zvuky v¹ech nástrojù pøehrát &ndash; jak praví
norma &ndash; &bdquo;s&nbsp;dostateènou kvalitou&ldquo;). Následuje výpis
jednotlivých skupin hudebních nástrojù tak, jak jsou popsány v&nbsp;General
MIDI. Pro vlastní pokusy doporuèuji pou¾ít hned skupinu první, ve které jsou
akustická piana, které pøehrají prakticky libovolné klávesy:</p>

<table>
<tr><th>Èíslo programu/nástroje</th><th>Skupina nástrojù</th></tr>
<tr><td> 01 &ndash; 08 </td><td>klavíry                      </td></tr>
<tr><td> 09 &ndash; 16 </td><td>ladìné bicí                  </td></tr>
<tr><td> 17 &ndash; 24 </td><td>varhany                      </td></tr>
<tr><td> 25 &ndash; 32 </td><td>kytary                       </td></tr>
<tr><td> 33 &ndash; 40 </td><td>basové zvuky                 </td></tr>
<tr><td> 41 &ndash; 48 </td><td>smyèce                       </td></tr>
<tr><td> 49 &ndash; 56 </td><td>ansáblové zvuky              </td></tr>
<tr><td> 57 &ndash; 64 </td><td>¾estì                        </td></tr>
<tr><td> 65 &ndash; 72 </td><td>plátkové                     </td></tr>
<tr><td> 73 &ndash; 80 </td><td>pí¹»aly                      </td></tr>
<tr><td> 81 &ndash; 88 </td><td>elektronické sólové zvuky    </td></tr>
<tr><td> 89 &ndash; 96 </td><td>elektronické doprovodné zvuky</td></tr>
<tr><td> 97 &ndash; 104</td><td>elektronické zvukové efekty  </td></tr>
<tr><td>105 &ndash; 112</td><td>etnické                      </td></tr>
<tr><td>113 &ndash; 120</td><td>perkusivní                   </td></tr>
<tr><td>121 &ndash; 128</td><td>zvukové efekty               </td></tr>
</table>

<image id="8476" />
<p-center><i>Obrázek 2: Nejjednodu¹¹í MIDI rozhraní pro poèítaèe Amiga. MIDI
konektor je pøímo zapojen na sériový port, co¾ sice není zcela korektní, ale
vìt¹ina MIDI zaøízení obsahuje na svém vstupu optoèlen, který obvody zaøízení
ochrání.</i></p-center>



<p><a name="k03"></a></p>
<h1>3. Hlavièka souborù SMF</h1>

<p>Soubory <i>SMF</i> na svém zaèátku obsahují hlavièku, po které následují
data jednotlivých hudebních stop s&nbsp;ukonèovací znaèkou. Ka¾dá èást souboru
(hlavièka, stopa) zaèíná ètyømi bajty, které lze chápat jako ètyøi ASCII znaky
textu (v&nbsp;tomto ohledu se <i>SMF</i> pøibli¾uje napøíklad populárnímu
grafickému formátu <i>PNG</i>, v&nbsp;nìm¾ jednotlivé <i>chunky</i> takté¾
zaèínají ètveøicí ASCII znakù). Ostatní data jsou vìt¹inou ulo¾ena
v&nbsp;binární podobì, pøièem¾ hodnoty, které se kvùli svému maximálnímu
rozsahu nevejdou do jednoho bajtu, jsou ulo¾eny systémem ni¾¹í bajt&ndash;vy¹¹í
bajt (toté¾ platí i v&nbsp;pøípadì, ¾e je hodnota ulo¾ena na ètyøech bajtech).
Hlavièka obsahuje základní informace o souboru <i>SMF</i>, pøedev¹ím jeho
typ (viz pøedchozí kapitola), poèet hudebních stop a základní rychlost
pøehrávání. Délka hlavièky je u standardních souborù rovna ètrnácti bajtùm
s&nbsp;následujícím významem:</p>

<table>
<tr><th>Offset</th><th>Délka (bajty)</th><th>Význam</th></tr>
<tr><td>00</td><td>4</td><td>ASCII text 'MThd' &ndash; MIDI header</td></tr>
<tr><td>04</td><td>4</td><td>délka zbytku hlavièky, pro standardní soubory je zde hodnota 6</td></tr>
<tr><td>08</td><td>2</td><td>typ (subformát) SMF souboru &ndash; 0000=Type-0, 0001=Type-1</td></tr>
<tr><td>10</td><td>2</td><td>poèet stop, 1 a¾ 65535 (pro subformát 1)</td></tr>
<tr><td>12</td><td>2</td><td>rychlost pøehrávání hudby (poèet tikù na pøehrání
ètvr»ové noty; èím vy¹¹í hodnota, tím rychleji se hudba pøehrává)</td></tr>
</table>

<p>Následuje ukázka formátu hlavièky skuteèného (dosti známého) souboru
<i>DukeNukem_Level1.mid</i> ulo¾eného ve formátu <i>SMF</i> (viz té¾ první
obrázek, na kterém je patrné, ¾e i pøehrávaè <i>timidity</i> vypisuje nìkteré
základní informace o právì zpracovávaném hudebním souboru):</p>

<table>
<tr><th>Offset</th><th>Obsah (hexa)</th><th>Význam</th></tr>
<tr><td>00</td><td>4d 54 68 64</td><td>ASCII text 'MThd' &ndash; MIDI header</td></tr>
<tr><td>04</td><td>00 00 00 06</td><td>délka zbytku hlavièky je rovna ¹esti bajtùm</td></tr>
<tr><td>08</td><td>00 01</td><td>typ souboru = Type-1</td></tr>
<tr><td>10</td><td>00 0d</td><td>poèet stop je roven tøinácti</td></tr>
<tr><td>12</td><td>00 90</td><td>rychlost pøehrávání hudby je nastavena na 0x90 (0x80 odpovídá ètvrtinové notì)</td></tr>
</table>

<image id="8477" original="no" />
<p-center><i>Obrázek 3: Vylep¹ené MIDI rozhraní na poèítaèi Amiga. Zde se ji¾
nachází oddìlovací vstupní optoèlen (pøedchozí zapojení bylo urèeno pouze pro
výstup dat na MIDI zaøízení), èleny zaji¹»ující vytvoøení proudové smyèky
atd.</i></p-center>



<p><a name="k04"></a></p>
<h1>4. Hudební data (stopy)</h1>

<p>Ihned po hlavièce souboru <i>SMF</i> následují hudební data,
tj.&nbsp;informace o jednotlivých hudebních stopách, pøièem¾ ka¾dá hudební stopa
zaèíná ètveøicí bajtù s&nbsp;hodnotami 0x4D, 0x54, 0x72 a 0x6B, co¾ odpovídá
ASCII znakùm "MTrk" &ndash; <i>MIDI track</i>. Jak jsme si ji¾ øekli
v&nbsp;úvodních odstavcích, je hudba zaznamenána ve formì takzvaných událostí
(<i>events</i>), pøièem¾ ka¾dá událost odpovídá MIDI zprávì doplnìné o èasovou
znaèku. Nejjednodu¹¹í události mají délku ètyøi bajty, pøièem¾ v&nbsp;prvním
bajtu je zaznamenána èasová znaèka (viz následující kapitola), po ní¾ následuje
klasická tøíbajtová MIDI zpráva. Pokud napøíklad budeme chtít postupnì pøehrát
tøi noty <i>C</i>, <i>D</i> a <i>E</i>, postaèuje pou¾ít tøi události
odpovídající zprávám <strong>Note On</strong>, za nimi¾ budou následovat tøi
zprávy <strong>Note Off</strong> &ndash; viz následující fragment obsahu
<i>SMF</i> souboru:</p>

<table>
<tr><th>Bajty v&nbsp;souboru</th><th>Událost</th><th>Význam</th></tr>
<tr><td>00 90 3C 60</td><td>Note On</td><td>Zaène se pøehrávat nota <i>C</i>, rychlost nábìhu je rovna 0x60</td></tr>
<tr><td>7F 90 3E 60</td><td>Note On</td><td>Zaène se pøehrávat nota <i>D</i>, rychlost nábìhu je rovna 0x60</td></tr>
<tr><td>7F 90 40 60</td><td>Note On</td><td>Zaène se pøehrávat nota <i>E</i>, rychlost nábìhu je rovna 0x60</td></tr>
<tr><td>7F 80 3C 00</td><td>Note Off</td><td>Konec pøehrávání noty <i>C</i></td></tr>
<tr><td>00 80 3E 00</td><td>Note Off</td><td>Konec pøehrávání noty <i>D</i></td></tr>
<tr><td>00 80 40 00</td><td>Note Off</td><td>Konec pøehrávání noty <i>E</i></td></tr>
</table>

<p>Ka¾dá stopa musí být ukonèena ètveøicí bajtù s&nbsp;hodnotami 0x00, 0xFF,
0x2F a 0x00.</p>

<image id="8478" original="no" />
<p-center><i>Obrázek 4: První verze legendárního programu Cubase byly urèeny
pro poèítaèe Atari ST, které byly vybaveny MIDI rozhraním.</i></p-center>

<p>Vztah mezi èíslem noty, jejím znaèením a vý¹kou tónu platný pro temperovanou
stupnici odvozenou od komorního <i>a</i> s&nbsp;frekvencí 440 Hz:</p>

<table>
<tr><th>Oktáva (MIDI)</th><th>Kód noty</th><th>Oznaèení noty</th><th>Frekvence (Hz)</th></tr>
<tr><td>-5</td><td>0</td><td>C</td><td>8,1757989156</td></tr>
<tr><td>-5</td><td>1</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>8,6619572180</td></tr>
<tr><td>-5</td><td>2</td><td>D</td><td>9,1770239974</td></tr>
<tr><td>-5</td><td>3</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>10,3008611535</td></tr>
<tr><td>-5</td><td>4</td><td>E</td><td>10,3008611535</td></tr>
<tr><td>-5</td><td>5</td><td>F</td><td>10,9133822323</td></tr>
<tr><td>-5</td><td>6</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>11,5623257097</td></tr>
<tr><td>-5</td><td>7</td><td>G</td><td>12,2498573744</td></tr>
<tr><td>-5</td><td>8</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>12,9782717994</td></tr>
<tr><td>-5</td><td>9</td><td>A</td><td>13,7500000000</td></tr>
<tr><td>-5</td><td>10</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>14,5676175474</td></tr>
<tr><td>-5</td><td>11</td><td>B</td><td>15,4338531643</td></tr>
<tr><td>-4</td><td>12</td><td>C</td><td>16,3515978313</td></tr>
<tr><td>-4</td><td>13</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>17,3239144361</td></tr>
<tr><td>-4</td><td>14</td><td>D</td><td>18,3540479948</td></tr>
<tr><td>-4</td><td>15</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>19,4454364826</td></tr>
<tr><td>-4</td><td>16</td><td>E</td><td>20,6017223071</td></tr>
<tr><td>-4</td><td>17</td><td>F</td><td>21,8267644646</td></tr>
<tr><td>-4</td><td>18</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>23,1246514195</td></tr>
<tr><td>-4</td><td>19</td><td>G</td><td>24,4997147489</td></tr>
<tr><td>-4</td><td>20</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>25,9565435987</td></tr>
<tr><td>-4</td><td>21</td><td>A</td><td>27,5000000000</td></tr>
<tr><td>-4</td><td>22</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>29,1352350949</td></tr>
<tr><td>-4</td><td>23</td><td>B</td><td>30,8677063285</td></tr>
<tr><td>-3</td><td>24</td><td>C</td><td>32,7031956626</td></tr>
<tr><td>-3</td><td>25</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>34,6478288721</td></tr>
<tr><td>-3</td><td>26</td><td>D</td><td>36,7080959897</td></tr>
<tr><td>-3</td><td>27</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>38,8908729653</td></tr>
<tr><td>-3</td><td>28</td><td>E</td><td>41,2034446141</td></tr>
<tr><td>-3</td><td>29</td><td>F</td><td>43,6535289291</td></tr>
<tr><td>-3</td><td>30</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>46,2493028390</td></tr>
<tr><td>-3</td><td>31</td><td>G</td><td>48,9994294977</td></tr>
<tr><td>-3</td><td>32</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>51,9130871975</td></tr>
<tr><td>-3</td><td>33</td><td>A</td><td>55,0000000000</td></tr>
<tr><td>-3</td><td>34</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>58,2704701898</td></tr>
<tr><td>-3</td><td>35</td><td>B</td><td>61,7354126570</td></tr>
<tr><td>-2</td><td>36</td><td>C</td><td>65,4063913251</td></tr>
<tr><td>-2</td><td>37</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>69,2956577442</td></tr>
<tr><td>-2</td><td>38</td><td>D</td><td>73,4161919794</td></tr>
<tr><td>-2</td><td>39</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>77,7817459305</td></tr>
<tr><td>-2</td><td>40</td><td>E</td><td>82,4068892282</td></tr>
<tr><td>-2</td><td>41</td><td>F</td><td>87,3070578583</td></tr>
<tr><td>-2</td><td>42</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>92,4986056779</td></tr>
<tr><td>-2</td><td>43</td><td>G</td><td>97,9988589954</td></tr>
<tr><td>-2</td><td>44</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>103,8261743950</td></tr>
<tr><td>-2</td><td>45</td><td>A</td><td>110,0000000000</td></tr>
<tr><td>-2</td><td>46</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>116,5409403795</td></tr>
<tr><td>-2</td><td>47</td><td>B</td><td>123,4708253140</td></tr>
<tr><td>-1</td><td>48</td><td>C</td><td>130,8127826503</td></tr>
<tr><td>-1</td><td>49</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>138,5913154884</td></tr>
<tr><td>-1</td><td>50</td><td>D</td><td>146,8323839587</td></tr>
<tr><td>-1</td><td>51</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>155,5634918610</td></tr>
<tr><td>-1</td><td>52</td><td>E</td><td>164,8137784564</td></tr>
<tr><td>-1</td><td>53</td><td>F</td><td>174,6141157165</td></tr>
<tr><td>-1</td><td>54</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>184,9972113558</td></tr>
<tr><td>-1</td><td>55</td><td>G</td><td>195,9977179909</td></tr>
<tr><td>-1</td><td>56</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>207,6523487900</td></tr>
<tr><td>-1</td><td>57</td><td>A</td><td>220,0000000000</td></tr>
<tr><td>-1</td><td>58</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>233,0818807590</td></tr>
<tr><td>-1</td><td>59</td><td>B</td><td>246,9416506281</td></tr>
<tr><td>0</td><td>60</td><td>C</td><td>261,6255653006</td></tr>
<tr><td>0</td><td>61</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>277,1826309769</td></tr>
<tr><td>0</td><td>62</td><td>D</td><td>293,6647679174</td></tr>
<tr><td>0</td><td>63</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>311,1269837221</td></tr>
<tr><td>0</td><td>64</td><td>E</td><td>329,6275569129</td></tr>
<tr><td>0</td><td>65</td><td>F</td><td>349,2282314330</td></tr>
<tr><td>0</td><td>66</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>369,9944227116</td></tr>
<tr><td>0</td><td>67</td><td>G</td><td>391,9954359817</td></tr>
<tr><td>0</td><td>68</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>415,3046975799</td></tr>
<tr><td>0</td><td>69</td><td>A</td><td><strong>440,0000000000</strong></td></tr>
<tr><td>0</td><td>70</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>466,1637615181</td></tr>
<tr><td>0</td><td>71</td><td>B</td><td>493,8833012561</td></tr>
<tr><td>1</td><td>72</td><td>C</td><td>523,2511306012</td></tr>
<tr><td>1</td><td>73</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>554,3652619537</td></tr>
<tr><td>1</td><td>74</td><td>D</td><td>587,3295358348</td></tr>
<tr><td>1</td><td>75</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>622,2539674442</td></tr>
<tr><td>1</td><td>76</td><td>E</td><td>659,2551138257</td></tr>
<tr><td>1</td><td>77</td><td>F</td><td>698,4564628660</td></tr>
<tr><td>1</td><td>78</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>739,9888454233</td></tr>
<tr><td>1</td><td>79</td><td>G</td><td>783,9908719635</td></tr>
<tr><td>1</td><td>80</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>830,6093951599</td></tr>
<tr><td>1</td><td>81</td><td>A</td><td>880,0000000000</td></tr>
<tr><td>1</td><td>82</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>932,3275230362</td></tr>
<tr><td>1</td><td>83</td><td>B</td><td>987,7666025122</td></tr>
<tr><td>2</td><td>84</td><td>C</td><td>1&nbsp;046,5022612024</td></tr>
<tr><td>2</td><td>85</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>1&nbsp;108,7305239075</td></tr>
<tr><td>2</td><td>86</td><td>D</td><td>1&nbsp;174,6590716696</td></tr>
<tr><td>2</td><td>87</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>1&nbsp;244,5079348883</td></tr>
<tr><td>2</td><td>88</td><td>E</td><td>1&nbsp;318,5102276515</td></tr>
<tr><td>2</td><td>89</td><td>F</td><td>1&nbsp;396,9129257320</td></tr>
<tr><td>2</td><td>90</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>1&nbsp;479,9776908465</td></tr>
<tr><td>2</td><td>91</td><td>G</td><td>1&nbsp;567,9817439270</td></tr>
<tr><td>2</td><td>92</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>1&nbsp;661,2187903198</td></tr>
<tr><td>2</td><td>93</td><td>A</td><td>1&nbsp;760,0000000000</td></tr>
<tr><td>2</td><td>94</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>1&nbsp;864,6550460724</td></tr>
<tr><td>2</td><td>95</td><td>B</td><td>1&nbsp;975,5332050245</td></tr>
<tr><td>3</td><td>96</td><td>C</td><td>2&nbsp;093,0045224048</td></tr>
<tr><td>3</td><td>97</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>2&nbsp;217,4610478150</td></tr>
<tr><td>3</td><td>98</td><td>D</td><td>2&nbsp;349,3181433393</td></tr>
<tr><td>3</td><td>99</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>2&nbsp;489,0158697766</td></tr>
<tr><td>3</td><td>100</td><td>E</td><td>2&nbsp;637,0204553030</td></tr>
<tr><td>3</td><td>101</td><td>F</td><td>2&nbsp;793,8258514640</td></tr>
<tr><td>3</td><td>102</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>2&nbsp;959,9553816931</td></tr>
<tr><td>3</td><td>103</td><td>G</td><td>3&nbsp;135,9634878540</td></tr>
<tr><td>3</td><td>104</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>3&nbsp;322,4375806396</td></tr>
<tr><td>3</td><td>105</td><td>A</td><td>3&nbsp;520,0000000000</td></tr>
<tr><td>3</td><td>106</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>3&nbsp;729,3100921447</td></tr>
<tr><td>3</td><td>107</td><td>B</td><td>3&nbsp;951,0664100490</td></tr>
<tr><td>4</td><td>108</td><td>C</td><td>4&nbsp;186,0090448096</td></tr>
<tr><td>4</td><td>109</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>4&nbsp;434,9220956300</td></tr>
<tr><td>4</td><td>110</td><td>D</td><td>4&nbsp;698,6362866785</td></tr>
<tr><td>4</td><td>111</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>4&nbsp;978,0317395533</td></tr>
<tr><td>4</td><td>112</td><td>E</td><td>5&nbsp;274,0409106059</td></tr>
<tr><td>4</td><td>113</td><td>F</td><td>5&nbsp;587,6517029281</td></tr>
<tr><td>4</td><td>114</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>5&nbsp;919,9107633862</td></tr>
<tr><td>4</td><td>115</td><td>G</td><td>5&nbsp;919,9107633862</td></tr>
<tr><td>4</td><td>116</td><td>G<sup>#</sup>/A<sup>b</sup></td><td>6&nbsp;644,8751612791</td></tr>
<tr><td>4</td><td>117</td><td>A</td><td>7&nbsp;040,0000000000</td></tr>
<tr><td>4</td><td>118</td><td>A<sup>#</sup>/B<sup>b</sup></td><td>7&nbsp;458,6201842894</td></tr>
<tr><td>4</td><td>119</td><td>B</td><td>7&nbsp;902,1328200980</td></tr>
<tr><td>5</td><td>120</td><td>C</td><td>8&nbsp;372,0180896192</td></tr>
<tr><td>5</td><td>121</td><td>C<sup>#</sup>/D<sup>b</sup></td><td>8&nbsp;869,8441912599</td></tr>
<tr><td>5</td><td>122</td><td>D</td><td>9&nbsp;397,2725733570</td></tr>
<tr><td>5</td><td>123</td><td>D<sup>#</sup>/E<sup>b</sup></td><td>9&nbsp;956,0634791066</td></tr>
<tr><td>5</td><td>124</td><td>E</td><td>10&nbsp;548,0818212118</td></tr>
<tr><td>5</td><td>125</td><td>F</td><td>11&nbsp;175,3034058561</td></tr>
<tr><td>5</td><td>126</td><td>F<sup>#</sup>/G<sup>b</sup></td><td>11&nbsp;839,8215267723</td></tr>
<tr><td>5</td><td>127</td><td>G</td><td>12&nbsp;543,8539514160</td></tr>
</table>



<p><a name="k05"></a></p>
<h1>5. Èasové znaèky</h1>

<p>Ka¾dá událost zaèíná èasovou znaèkou. Nejedná se o absolutnì zapsaný èas,
ale o èasový rozdíl mezi okam¾ikem poslední události a události, která právì
zaèíná probíhat (poèet tikù trvání jedné ètvr»ové noty je ulo¾en
v&nbsp;hlavièce). Napøíklad pokud potøebujeme pøehrávat tóny v&nbsp;pravidelném
rytmu, tj.&nbsp;jednotlivé noty mají zaznít po 00, 10, 20, 30, 40 a 50 èasových
jednotkách, budou mít èasové znaèky hodnoty 00, 10, 10, 10, 10, 10, proto¾e
10-0=10, 20-10=10, 30-20=10 atd. Hodnota 00 znaèí nulovou pauzu, tj.&nbsp;dvì
nebo více událostí mohou probìhnout pøesnì v&nbsp;tom samém èasovém okam¾iku.
V&nbsp;pøípadì, ¾e je èasový rozdíl reprezentován hodnotu men¹í ne¾ 0x7f (127
dekadicky), je situace velmi jednoduchá &ndash; èasová znaèka má délku jednoho
bajtu, který je zapsán jako první bajt dané události.</p>

<p>Ov¹em ve skuteènosti je nìkdy nutné zadávat i mnohem del¹í èasové rozdíly.
Ty se ukládají do vìt¹ího poètu bajtù (poèet bajtù je promìnlivý od jednoho do
ètyø), pøièem¾ v¹echny bajty kromì posledního mají hodnotu vìt¹í ne¾ 0x7f (127
dekadicky), proto¾e je u nich umìle nastaven nejvy¹¹í bit a pouze do posledního
bajtu je zapsána hodnota men¹í ne¾ 0x7f. Maximální èas, který lze tímto
zpùsobem reprezentovat, lze ulo¾it jako sekvenci bajtù 0xff 0xff 0xff 0x7f.
Pøi pøekódování na hexadecimální èíslo dojdeme k&nbsp;hodnotì 0x0fffffff
(nesmíme zapomenout na to, ¾e se v&nbsp;souborech <i>SMF</i> nejdøíve ukládá
bajt s&nbsp;nejni¾¹í váhou), co¾ v&nbsp;desítkové èíselné soustavì odpovídá
2<sup>28</sup>=268435456. Pøíklad záznamu nìkterých hodnot èasových znaèek:</p>

<table>
<tr><th>Ukládaná hodnota (desítkovì)</th><th>Sekvence bajtù (hex)</th></tr>
<tr><td>1</td><td>01</td></tr>
<tr><td>127</td><td>7f</td></tr>
<tr><td>128</td><td>81 00</td></tr>
<tr><td>129</td><td>81 01</td></tr>
<tr><td>255</td><td>81 7f</td></tr>
<tr><td>256</td><td>82 00</td></tr>
</table>

<p>Pro naètení hodnoty èasové znaèky lze pou¾ít následující algoritmus:</p>

<code-area>
int midiDecTime2normalTime(int[] n)
{
    int l=n.length;
    int t=0;
    for (int i=0 ; i&lt;l-1 ; i++)
    {
        t += (n[i]-128) * Math.pow(2,7 * (l-i-1)) ;
    }
    t += n[l-1];
    return t;
}
</code-area>

<image id="8479" />
<p-center><i>Obrázek 5: Osobní poèítaè Atari 520 ST, který je vybaven MIDI
rozhraním.</i></p-center>



<p><a name="k06"></a></p>
<h1>6. Literatura</h1>

<ol>

<li>Arnell, Billy. "McScope: System." Music, Computers, and Software,<br />
April 1988: 58-60. Conger, Jim. C Programming for MIDI.<br />
Redwood City: M &amp; T Books, 1988.
</li>

<li>Cooper, Jim. "Mind Over MIDI: Information Sources and System-exclusive Data Formats.",<br />
Keyboard October, 1986: 110-111.
</li>

<li>Enders, Bernd and Wolfgang Klemme. MIDI and Sound Book for the Atari ST.<br />
Redwood City: M &amp; T Books, 1989.
</li>

<li>Matzkin, Jonathan. "A MIDI Musical Offering."<br />
PC Magazine 29 Nov. 1988: 229+.
</li>

<li>Peters, Constantine. "Reading up on MIDI for the Novice and the Pro."<br />
PC Magazine 29 Nov. 1988: 258.
</li>

<li>Basic MIDI, Paul White,<br />
Sanctuary Publishing Ltd, London 1999.<br />
ISBN 1 86074 262 9
</li>

<li>A Beginner's Guide to MIDI,<br />
R A Penfold, Babani Publishing Ltd,<br />
London 1993.  ISBN 0 85934 331 6
</li>

<li>MIDI for Organists,<br />
C E Pykett
</li>

</ol>

<image id="8480" original="no" />
<p-center><i>Obrázek 6: Osobní poèítaè Atari 1040 STf, který je takté¾ vybaven MIDI
rozhraním.</i></p-center>



<p><a name="k07"></a></p>
<h1>7. Odkazy na Internetu</h1>

<ol>

<li>Musical Instrument Digital Interface<br />
<a href="http://cs.wikipedia.org/wiki/MIDI">http://cs.wikipedia.org/wiki/MIDI</a>
</li>

<li>Introduction to MIDI<br />
<a href="http://www.chrisbsmusic.com/howmidiworks.html">http://www.chrisbsmusic.com/howmidiworks.html</a>
</li>

<li>P. Herout: Obecné MIDI (General MIDI)<br />
<a href="http://www-kiv.zcu.cz/~herout/html_sbo/midi/5.html">http://www-kiv.zcu.cz/~herout/html_sbo/midi/5.html</a>
</li>

<li>(.mid) Standard MIDI File Format<br />
<a href="http://faydoc.tripod.com/formats/mid.htm">http://faydoc.tripod.com/formats/mid.htm</a>
</li>

<li>A crash course on the standard MIDI specification<br />
<a href="http://www.skytopia.com/project/articles/midi.html">http://www.skytopia.com/project/articles/midi.html</a>
</li>

<li>MIDI transform V1.1<br />
<a href="http://www.skytopia.com/software/midi">http://www.skytopia.com/software/midi</a>
</li>

<li>MIDI File Parsing<br />
<a href="http://www.ccarh.org/courses/253/assignment/midifile/">http://www.ccarh.org/courses/253/assignment/midifile/</a>
</li>

<li>Grafické karty a grafické akcelerátory (6) - Struèná historie poèítaèù Atari ST<br />
<a href="http://www.root.cz/clanky/graficke-karty-a-graficke-akceleratory-6/">http://www.root.cz/clanky/graficke-karty-a-graficke-akceleratory-6/</a>
</li>

<li>Amiga Midi HOST Adapter<br />
<a href="http://amigareview.amiga.sk/amiga-review-21/amiga-midi-host-adapter">http://amigareview.amiga.sk/amiga-review-21/amiga-midi-host-adapter</a>
</li>

<li>Atari.org<br />
<a href="http://www.atari.org/">http://www.atari.org/</a>
</li>

<li>Atari 520ST/ST+/STM<br />
<a href="http://www.old-computers.com/museum/computer.asp?c=20">http://www.old-computers.com/museum/computer.asp?c=20</a>
</li>

<li>Atari ST (CZ)<br />
<a href="http://cs.wikipedia.org/wiki/Atari_ST">http://cs.wikipedia.org/wiki/Atari_ST</a>
</li>

<li>Atari ST (EN)<br />
<a href="http://en.wikipedia.org/wiki/Atari_ST">http://en.wikipedia.org/wiki/Atari_ST</a>
</li>

<li>MIDI Maze,<br />
<a href="http://en.wikipedia.org/wiki/MIDI_Maze">http://en.wikipedia.org/wiki/MIDI_Maze</a>
</li>

<li>HoofJaw &amp; MIDI.com - Your MIDI File Center!,<br />
<a href="http://www.hoofjaw.com/Default.aspx">http://www.hoofjaw.com/Default.aspx</a>
</li>

<li>Kenton Releases New MIDI Merge Box,<br />
<a href="http://www.dolphinmusic.co.uk/news/news-story/news_id/1925">http://www.dolphinmusic.co.uk/news/news-story/news_id/1925</a>
</li>

<li>How Optical Isolation Works (with Switching Power Supply) &ndash; Illustration,<br />
<a href="http://www.bb-elec.com/tech_articles/optical_isolation_illustration.asp">http://www.bb-elec.com/tech_articles/optical_isolation_illustration.asp</a>
</li>

<li>Opto-isolator,<br />
<a href="http://en.wikipedia.org/wiki/Opto-isolator">http://en.wikipedia.org/wiki/Opto-isolator</a>
</li>

<li>Musical Instrument Digital Interface,<br />
<a href="http://en.wikipedia.org/wiki/Musical_Instrument_Digital_Interface">http://en.wikipedia.org/wiki/Musical_Instrument_Digital_Interface</a>
</li>

<li>Daves Old Computers &ndash; Atari ST,<br />
<a href="http://www.classiccmp.org/dunfield/atarist/index.htm">http://www.classiccmp.org/dunfield/atarist/index.htm</a>
</li>

<li>A MIDI Pedalboard Encode,<br />
<a href="http://www.pykett.org.uk/a_midi_pedalboard_encoder.htm">http://www.pykett.org.uk/a_midi_pedalboard_encoder.htm</a>
</li>

<li>MIDI Note Number, Frequency Table,<br />
<a href="http://tonalsoft.com/pub/news/pitch-bend.aspx">http://tonalsoft.com/pub/news/pitch-bend.aspx</a>
</li>

<li>Note names, MIDI numbers and frequencies,<br />
<a href="http://www.phys.unsw.edu.au/jw/notes.html">http://www.phys.unsw.edu.au/jw/notes.html</a>
</li>

<li>The MIDI Specification,<br />
<a href="http://www.gweep.net/~prefect/eng/reference/protocol/midispec.html">http://www.gweep.net/~prefect/eng/reference/protocol/midispec.html</a>
</li>

<li>Essentials of the MIDI protocol,<br />
<a href="http://ccrma.stanford.edu/~craig/articles/linuxmidi/misc/essenmidi.html">http://ccrma.stanford.edu/~craig/articles/linuxmidi/misc/essenmidi.html</a>
</li>

<li>Veni, MIDI, Vici: Generating a simple MIDI file using VB, part 1,<br />
<a href="http://blogs.msdn.com/vbteam/archive/2009/02/27/veni-midi-vici-generating-a-simple-midi-file-using-vb-part-1-matt-gertz.aspx">http://blogs.msdn.com/vbteam/archive/2009/02/27/veni-midi-vici-generating-a-simple-midi-file-using-vb-part-1-matt-gertz.aspx</a></li>
</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2008</small></p>
</body>
</html>

