<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Superpoèítaèe Cray (ètvrtá èást)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Superpoèítaèe Cray (ètvrtá èást)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V&nbsp;dne¹ní èásti seriálu o historii výpoèetní techniky si podrobnìji popí¹eme architekturu superpoèítaèe Cray-2. Zamìøíme se pøedev¹ím na to, proè byla pùvodnì homogenní pamì» rozdìlena na èást globální a lokální, popí¹eme si èinnost nìkterých instrukcí pracujících s&nbsp;vektory a takté¾ si øekneme, jakým zpùsobem se mohly jednotlivé výkonné jednotky (procesory) mezi sebou synchronizovat pomocí takzvaných semaforù.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Moduly superpoèítaèe Cray-2 a metody zvý¹ení jeho výpoèetního výkonu</a></p>
<p><a href="#k02">2. Malé ohlédnutí do minulosti: registrová sada poèítaèù Cray 1, Cray X-MP a Cray Y-MP</a></p>
<p><a href="#k03">3. Lokální pamìti poèítaèe Cray-2 a jeho upravená registrová sada</a></p>
<p><a href="#k04">4. Synchronizace procesorových jednotek pomocí semaforù</a></p>
<p><a href="#k05">5. Základní operace s&nbsp;registrem VM</a></p>
<p><a href="#k06">6. Pøiøazení hodnoty do vektorového registru s&nbsp;vyu¾itím masky</a></p>
<p><a href="#k07">7. Malý úkol pro ètenáøe</a></p>
<p><a href="#k08">8. Dal¹í operace s&nbsp;vektory</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Moduly superpoèítaèe Cray-2 a metody zvý¹ení jeho výpoèetního výkonu</h2>

<p>V&nbsp;pøedchozí èásti seriálu o historii vývoje výpoèetní techniky jsme si
popsali funkce základních prvkù (modulù), ze kterých byl sestaven superpoèítaè
<i>Cray-2</i>. Víme ji¾, ¾e ka¾dý modul byl zkonstruován z&nbsp;osmi plo¹ných
spojù vzájemnì propojených pomocí takzvaných z-pinù (<i>z-pins</i>), které
mù¾eme vidìt i na prvních dvou fotografiích. Na plo¹ných spojích se nacházely
pøevá¾nì integrované obvody rùzného typu, z&nbsp;nich¾ byla sestavena jak
operaèní pamì» (rozdìlená na nìkolik samostatných oblastí popsaných dále), tak
i vlastní procesorové jednotky. V¹echny èipy osazené na osmici plo¹ných spojù
tvoøily møí¾ku o rozmìrech 8&times;8&times;12 èipù. Vzhledem k&nbsp;tomu, ¾e se
superpoèítaè <i>Cray 2</i> skládal z&nbsp;320 takovýchto modulù, lze jednodu¹e
vypoèítat, ¾e celkový poèet èipù pøesáhl hodnotu ètvrt milionu
(8&times;8&times;12&times;320), které spoleènì tvoøily systém se ¹pièkovým
výpoèetním výkonem témìø 1,9 GFLOPS, který byl více ne¾ desetinásobný oproti
výpoèetnímu výkonu <i>Craye-1</i> se 160 MFLOPS.</p>

<a href="http://i.iinfo.cz/images/130/hist3907.jpg"><img src="http://i.iinfo.cz/images/130/hist3907-prev.jpg" width="370" height="110" alt=" " /></a>
<p><i>Obrázek 1: Osm plo¹ných spojù osazených èipy, které tvoøí jeden modul
poèítaèe Cray-2. Mezi plo¹nými spoji jsou vytvoøeny propojky &ndash; takzvané
z-piny (z-pins).<br />
(zdroj: http://bobodyne.com/web-docs/robots/cray2/)</i></p>

<p>Tohoto výkonu, který pøekonal v¹echny tehdej¹í poèítaèe, bylo dosa¾eno
(samozøejmì kromì zkrácení hodinového cyklu) jak pou¾itím vìt¹ího mno¾ství
jednotek umo¾òujících provádìní výpoètù se skalárními hodnotami i
s&nbsp;vektory, tak i rozdìlením pùvodnì monolitické operaèní pamìti, která
zaèala tvoøit úzké hrdlo celého systému, na nìkolik èástí. Obì metody zvý¹ení
výpoèetního výkonu si popí¹eme v&nbsp;následujícím textu. Aby Seymour Cray
dosáhl alespoò plánovaného desetinásobného urychlení výpoèetního výkonu oproti
pùvodnímu <i>Crayi 1</i>, pou¾il ve svém novém stroji ètyøi samostatnì
pracující procesorové jednotky, které byly specializovány na provádìní výpoètù
s&nbsp;numerickými hodnotami ulo¾enými v&nbsp;systému plovoucí øádové teèky a
na manipulaci s&nbsp;daty. Tyto procesorové jednotky, nazývané také
<i>background processors</i>, byly øízeny pátým procesorem nazývaným
<i>foreground processor</i>. Zajímavé bylo, ¾e ka¾dý typ procesorové jednotky
mìl vlastní instrukèní sadu a pracoval s&nbsp;odli¹nými registry. <i>Background
procesory</i> mìly k&nbsp;dispozici skalární, vektorové a adresové registry
popsané <a href="#k03">ve tøetí kapitole</a>, <i>foreground procesor</i>
naproti tomu pou¾íval nìkolik registrù øídicích pøístup do hlavní pamìti a
takté¾ vzájemnou synchronizaci <i>background procesorù</i>.</p>

<a href="http://i.iinfo.cz/images/277/hist3915.jpg"><img src="http://i.iinfo.cz/images/277/hist3915-prev.jpg" width="338" height="270" alt=" " /></a>
<p><i>Obrázek 2: Jeden z&nbsp;plo¹ných spojù obsahujících pamì»ové èipy, mezi
nimi¾ mù¾eme vidìt z-piny slou¾ící k&nbsp;propojení jednotlivých plo¹ných spojù
v&nbsp;rámci jednoho modulu.</i></p>

<p><i>Foreground procesor</i> celý poèítaè v&nbsp;podstatì ovládal &ndash;
spou¹tìl naèítání a ukládání dat, øídil pøístup ke kanálùm umo¾òujícím pøenos
slov mezi hlavní pamìtí a pamì»mi lokálními (pøenosy bylo mo¾né provádìt pøes
skalární registry <strong>S</strong> nebo vektorové registry
<strong>V</strong>; viz dal¹í text) a takté¾ posílal jednotlivým <i>background
procesorùm</i> instrukce pøes nìkolik bufferù, z&nbsp;nich¾ ka¾dý mìl kapacitu
¹estnácti slov (základní instrukce mìly vìt¹inou délku právì jednoho slova).
Hlavní úlohou <i>foreground procesoru</i> bylo efektivní rozdìlení práce
jednotlivým <i>background procesorùm</i> takovým zpùsobem, aby byly vektorové
výpoèetní jednotky optimálnì vytí¾eny, ale aby souèasnì nedocházelo ke
zbyteèným pøenosùm dat mezi hlavní pamìtí a pamì»mi lokálními.
V&nbsp;neposlední øadì takté¾ bylo nutné zabránit konfliktùm pøi pøístupu do
stejné oblasti hlavní pamìti (ostatnì velmi podobné problémy musejí být øe¹eny
na architekturách NUMA, s&nbsp;nimi¾ má poèítaè <i>Cray 2</i> velmi mnoho
spoleèných vlastností).</p>



<p><a name="k02"></a></p>
<h2>2. Malé ohlédnutí do minulosti: registrová sada poèítaèù Cray 1, Cray X-MP a Cray Y-MP</h2>

<p>V&nbsp;pøedchozích èláncích, v&nbsp;nich¾ byla popsána architektura poèítaèe
<i>Cray-1</i>, tj.&nbsp;nepøímého pøedchùdce <i>Craye-2</i>, jsme si
mj.&nbsp;øekli, ¾e tento poèítaè dával programátorùm k&nbsp;dispozici velmi
rozsáhlou sadu pracovních registrù, z&nbsp;nich¾ mnohé mìly speciální pou¾ití.
Z&nbsp;tohoto dùvodu byly registry podle své funkce rozdìleny do nìkolika
kategorií, pøièem¾ ka¾dá kategorie byla oznaèena jedním písmenem
(v&nbsp;assembleru se jména konkrétních registrù doplòovala jejich indexem:
<strong>S0</strong>, <strong>V8</strong>, <strong>T42</strong> atd.). Jedná se
pøedev¹ím o vektorové registry <strong>V</strong>, skalární registry
<strong>S</strong> a registry <strong>A</strong> pou¾ívané pro adresování
operandù. Skalární registry <strong>S</strong> byly navíc doplnìny sadou
¹edesáti ètyø &bdquo;zálo¾ních&ldquo; registrù <strong>T</strong> a adresní
registry <strong>A</strong> sadou 64 &bdquo;zálo¾ních&ldquo; registrù
<strong>B</strong>. Tyto zálo¾ní sady registrù slou¾ily jako rychlá mezipamì»,
co¾ se v&nbsp;plné míøe ukázalo a¾ u <i>Craye 2</i>, kde byly tyto registry
nahrazeny skuteènou lokální pamìtí s&nbsp;mnohem vìt¹í (256&times;)
kapacitou.</p>

<a href="http://i.iinfo.cz/images/192/hist3908.jpg"><img src="http://i.iinfo.cz/images/192/hist3908-prev.jpg" width="370" height="174" alt=" " /></a>
<p><i>Obrázek 3: Pohled na jeden modul (osmici plo¹ných spojù) ze strany
konektoru. Pøes tyto piny komunikoval modul s&nbsp;ostatními moduly
nainstalovanými v&nbsp;superpoèítaèi.<br />
(zdroj: http://bobodyne.com/web-docs/robots/cray2/)</i></p>

<p>Registry z&nbsp;odli¹ných kategorií byly zpracovávány rùznými funkèními
jednotkami, co¾ mj.&nbsp;znamená, ¾e napøíklad s&nbsp;registry pou¾ívanými pro
adresování bylo mo¾né provádìt operace souètu, rozdílu èi násobení konstantou,
nikoli v¹ak kupøíkladu výpoèet pøevrácené hodnoty, co¾ je naopak operace
dostupná pro registry spadající do kategorie <strong>S</strong> (skalární
registry). Zcela speciální kategorií pak byla osmice registrù
<strong>V</strong>, proto¾e ka¾dý z&nbsp;tìchto registrù mohl obsahovat vektor
¹edesáti ètyø numerických hodnot ulo¾ených ve formátu plovoucí øádové teèky
(neodpovídajících v¹ak pøesnì normì IEEE 754, ale speciálnímu &bdquo;Cray
formátu&ldquo;). V&nbsp;následující tabulce jsou pro pøipomenutí vypsány
v¹echny registry dostupné assemblerovským programátorùm poèítaèù <i>Cray 1</i>
a jeho pøímých následovníkù <i>Cray X-MP</i> a <i>Cray Y-MP</i>:</p>

<table>
<tr><th>Oznaèení</th><th>Poèet registrù v&nbsp;sadì</th><th>Bitová ¹íøka</th><th>Poznámka</th></tr>
<tr><td>S</td><td> 8</td><td>64 bitù</td><td>sada registrù pro bì¾né skalární operace</td></tr>
<tr><td>T</td><td>64</td><td>64 bitù</td><td>tyto registry mají funkci mezipamìti pro registry S</td></tr>
<tr><td>A</td><td> 8</td><td>32 bitù</td><td>registry pou¾ité pøi adresování (u pùvodního <i>Craye 1</i> je bitová ¹íøka adresových registrù zmen¹ena na 24 bitù)</td></tr>
<tr><td>B</td><td>64</td><td>32 bitù</td><td>tyto registry mají funkci mezipamìti pro registry A</td></tr>
<tr><td>I</td><td> 4</td><td>32&times;64-bitová slova</td><td>té¾ se zpracovávají jako 128&times;16-bitová slova</td></tr>
<tr><td>V</td><td> 8</td><td>64&times;64 bitù</td><td>vektorové registry; ka¾dý registr je ve skuteènosti 64prvkovým vektorem</td></tr>
<tr><td>VM</td><td>  1</td><td>64 bitù</td><td>vector mask (pou¾ito spolu s&nbsp;vektorovými registry pro nìkteré operace)</td></tr>
<tr><td>VL</td><td>  6</td><td>6 bitù</td><td>vector length (pou¾ito spolu s&nbsp;vektorovými registry pro nìkteré operace)</td></tr>
</table>



<p><a name="k03"></a></p>
<h2>3. Lokální pamìti poèítaèe Cray 2 a jeho upravená registrová sada</h2>

<p>Sada registrù popsaná <a href="#k02">v&nbsp;pøedchozí kapitole</a> i jejich
rozmístìní v&nbsp;jednotlivých funkèních modulech sice bylo plnì dostaèující
v&nbsp;dobách poèítaèe <i>Cray-1</i>, ale pro novì zkonstruovaný superpoèítaè
<i>Cray-2</i> bylo nutné provést nìkolik zásadních úprav souvisejících
pøedev¹ím s&nbsp;tím, ¾e v&nbsp;<i>Crayi-2</i> byly instalovány ètyøi relativnì
samostatnì pracující procesorové jednotky. Z&nbsp;tohoto dùvodu byly dvì sady
registrù, konkrétnì registry spadající do kategorií <strong>B</strong> a
<strong>T</strong> (tj.&nbsp;v¹echny vý¹e zmínìné &bdquo;zálo¾ní&ldquo;
registry), nahrazeny lokální pamìtí o kapacitì 16 kiloslov (slovo mìlo ¹íøku 64
bitù), pøièem¾ pøi konstrukci této pamìti byly vyu¾ity ty nejrychlej¹í
v&nbsp;dané dobì dostupné pamì»ové souèástky, aby nebyly procesorové jednotky
zdr¾ovány pomalej¹ím pøístupem k&nbsp;pamìti. Superpoèítaèe <i>Cray 2</i> toti¾
nemìly ¾ádnou obdobu automaticky spravované vyrovnávací pamìti, resp.&nbsp;to,
co dnes nazýváme vyrovnávacími pamì»mi (<i>cache</i>), je obdobou lokálních
pamìtí u poèítaèe <i>Cray 2</i>, ov¹em s&nbsp;tím rozdílem, ¾e pøesuny dat mezi
hlavní pamìtí a lokálními pamì»mi byly provádìny pøes pracovní registry.</p>

<a href="http://i.iinfo.cz/images/630/hist3913.png"><img src="http://i.iinfo.cz/images/630/hist3913-prev.png" width="243" height="270" alt=" " /></a>
<p><i>Obrázek 4: Architektura superpoèítaèe Cray-2.</i></p>

<p>Ka¾dá procesorová jednotka (<i>background procesor</i>) poèítaèe <i>Cray
2</i> mìla k&nbsp;dispozici následující registry (pov¹imnìte si zejména øádku
<strong>LM</strong>, co¾ není nic jiného ne¾ vý¹e zmínìná lokální pamì»):</p>

<table>
<tr><th>Oznaèení</th><th>Poèet registrù v&nbsp;sadì</th><th>Bitová ¹íøka</th><th>Poznámka</th></tr>
<tr><td>A </td><td>  8</td><td>32 bitù</td><td>registry pou¾ité pøi adresování</td></tr>
<tr><td>S </td><td>  8</td><td>64 bitù</td><td>sada registrù pro bì¾né skalární operace</td></tr>
<tr><td>V </td><td>  8</td><td>64&times;64 bitù</td><td>vektorové registry; ka¾dý registr je ve skuteènosti 64prvkovým vektorem</td></tr>
<tr><td>VM</td><td>  1</td><td>64 bitù</td><td>vector mask (pou¾ito spolu s&nbsp;vektorovými registry pro nìkteré operace)</td></tr>
<tr><td>VL</td><td>  6</td><td>6 bitù</td><td>vector length (pou¾ito spolu s&nbsp;vektorovými registry pro nìkteré operace)</td></tr>
<tr><td>LM</td><td>16k</td><td>64 bitù</td><td>lokální pamì» pøímo pøístupná pro výpoèty</td></tr>
<tr><td>Semaphore</td><td>1</td><td>1 bit</td><td>semafor, který mù¾e být sdílený mezi v¹emi ètyømi procesorovými jednotkami</td></tr>
</table>

<p><i>Poznámka:</i> mezi hlavní pamìtí a pamìtí lokální (<strong>VM</strong>)
nebylo mo¾né pøímo pøená¹et data &ndash; jediné operace, které umo¾òovaly ètení
a zápis do hlavní pamìti, byly operace typu load a store se skalárními registry
<strong>S</strong> nebo s&nbsp;vektorovými registry <strong>V</strong>. Pokud
tedy bylo nutné pracovat s&nbsp;daty ulo¾enými v&nbsp;hlavní pamìti, musel se
nejdøíve provést &bdquo;blokový pøenos&ldquo;, ideálnì s&nbsp;vyu¾itím
nìkterého z&nbsp;vektorových registrù <strong>V</strong>, proto¾e ten dokázal
v&nbsp;jediném kroku (nikoli v¹ak v&nbsp;jediném strojovém taktu) pøenést
64&times;64=4096 bitù, tj.&nbsp;pùl kilobajtu dat!</p>

<img src="http://i.iinfo.cz/images/279/hist3905.jpg" width="355" height="412" alt=" " />
<p><i>Obrázek 5: Superpoèítaè Cray-2 &ndash; pohled na výpoèetní moduly a moduly
s&nbsp;operaèní pamìtí.<br />
(zdroj: Cray Research)</i></p>



<p><a name="k04"></a></p>
<h2>4. Synchronizace procesorových jednotek pomocí semaforù</h2>

<p>V&nbsp;registrové sadì pøedstavené v&nbsp;pøedchozí kapitole se
mj.&nbsp;nachází dva registry, které se u pùvodního <i>Craye 1</i>
nevyskytovaly, ov¹em u <i>Craye 2</i> plní pomìrnì dùle¾ité funkce. Jedná se o
jednobitový <i>semafor</i> a o 64bitový registr <strong>VM</strong> (<i>vector
mask</i>), s&nbsp;jeho¾ pomocí lze nahradit nìkteré typy programových smyèek
s&nbsp;podmínkou za sadu &bdquo;vektorových&ldquo; operací (dnes se spí¹e mluví
o operacích SIMD &ndash; single instruction, multiple data). Nejprve si popi¹me
funkci semaforu. Tento jednobitový registr mù¾e být sdílený mezi v¹emi ètyømi
procesorovými jednotkami (<i>background processors</i>) a slou¾í pøedev¹ím pro
jejich vzájemnou synchronizaci; ostatnì název &bdquo;semafor&ldquo; je
v&nbsp;informatice pou¾íván právì v&nbsp;kontextu synchronizace mezi více
paralelnì bì¾ícími procesy èi vlákny.</p>

<p>Jednobitových semaforù bylo v&nbsp;superpoèítaèi <i>Cray-2</i>
implementováno celkem osm, ov¹em ka¾dý <i>background procesor</i> mìl
v&nbsp;daném okam¾iku pøístup pouze k&nbsp;jednomu z&nbsp;tìchto semaforù.
Pøiøazení semaforù jednotlivým <i>background procesorùm</i> provádìl
<i>foreground procesor</i>, co¾ napøíklad umo¾nilo, aby se první a druhý
<i>background procesor</i> vzájemnì synchronizovaly s&nbsp;vyu¾itím semaforu
èíslo 1 a tøetí <i>background procesor</i> nezávisle na tom synchronizoval
svoji èinnost s&nbsp;procesorem ètvrtým s&nbsp;vyu¾itím semaforu èíslo 2.
Indexy semaforù pøiøazených <i>background procesorùm</i> byly ulo¾eny ve
<i>status registru</i> dostupného pouze s&nbsp;vyu¾itím instrukcí
z&nbsp;instrukèní sady <i>foreground procesoru</i>. Pro vlastní synchronizaci
byly v&nbsp;instrukèní sadì <i>background procesorù</i> superpoèítaèe <i>Cray
2</i> vyhrazeny pouhé ètyøi instrukce, které jsou vypsány v&nbsp;následující
tabulce. Z&nbsp;této tabulky mj.&nbsp;plyne, ¾e napøíklad operaci èekání na
nastavení èi naopak vynulování semaforu je mo¾né implementovat pomocí
jednoduché programové smyèky (samozøejmì je dùle¾ité, aby operace skoku a
souèasnì nastavení èi vynulování semaforu byla atomická, co¾ musí zajistit
obvodové øe¹ení procesorových jednotek):</p>

<table>
<tr><th>Instrukce</th><th>Popis</th></tr>
<tr><td>CSM</td><td>vynulování semaforu, tj.&nbsp;nastavení jeho bitu na logickou nulu</td></tr>
<tr><td>SSM</td><td>nastavení semaforu na logickou jednièku</td></tr>
<tr><td>JCS xxx</td><td>pokud je semafor nastaven na logickou nulu, provede se skok na adresu xxx a souèasnì je semafor nastaven na jednièku</td></tr>
<tr><td>JSS xxx</td><td>pokud je semafor nastaven na logickou jednièku, provede se skok, jinak se nastaví na jednièku (nejde o opak pøedchozí instrukce)</td></tr>
</table>

<a href="http://i.iinfo.cz/images/299/cray4-06.png"><img src="http://i.iinfo.cz/images/299/cray4-06-prev.png" width="370" height="238" alt=" " /></a>
<p><i>Obrázek 6: Schéma vzájemného propojení background procesorù
s&nbsp;foreground procesorem a hlavní pamìtí (¾lutý obdélník nalevo).
K&nbsp;hlavní pamìti je pøipojen i modul pro naèítání instrukcí a jejich
rozdìlování do jednotlivých instrukèních bufferù (pøesnìji øeèeno front), odkud
jsou ji¾ instrukce vybírány a provádìny samotnými background procesory.<br />
(zdroj: Cray Research; kvalita obrázku je kvùli nízkému rozli¹ení pøi skenování
a pou¾ití JPEG komprimace ponìkud nízká)</i></i></p>



<p><a name="k05"></a></p>
<h2>5. Základní operace s&nbsp;registrem VM</h2>

<p>Dal¹ím registrem, který je v&nbsp;jednotlivých procesorových jednotkách
poèítaèe <i>Cray 2</i> k&nbsp;dispozici, je registr nazvaný
<strong>VM</strong>, co¾ je zkratka sousloví &bdquo;vector mask&ldquo;. Název
tohoto registru skuteènì odpovídá jeho funkci, proto¾e s&nbsp;ním lze provádìt
nìkolik operací, které &bdquo;maskují&ldquo; jednotlivé numerické hodnoty
ulo¾ené v&nbsp;nìkterém z&nbsp;vektorových registrù <strong>Vk</strong> (k=0 a¾
7). Zdánlivì nadbyteèná funkce tohoto registru je v¹ak ve svém dùsledku velmi
u¾iteèná, proto¾e umo¾òuje nahradit nìkteré typy programových smyèek
(pracujících s&nbsp;jednorozmìrnými nebo dvourozmìrnými poli), v&nbsp;nich¾ se
vyskytuje podmínka, za nìkolik jednoduchých a pøedev¹ím velmi rychlých operací
provádìných nad celým vektorem èi vektory ulo¾enými v&nbsp;nìkterém registru
<strong>Vk</strong>. Bitová ¹íøka registru <strong>VM</strong> je rovna 64
bitùm, tak¾e ka¾dý jeho bit odpovídá jednomu prvku vektoru, jen¾ je ulo¾ený
v&nbsp;registrech <strong>V</strong>. Obsah tohoto registru je mo¾né pøenést
z&nbsp;nebo do nìkterého skalárního registru <strong>Si</strong> (i=0 a¾ 7),
jejich¾ bitová ¹íøka je shodná s&nbsp;¹íøkou registru <strong>VM</strong>:</p>

<table>
<tr><th>Instrukce</th><th>Popis instrukce</th></tr>
<tr><td>VM &lt;- Si</td><td>pøenesení obsahu skalárního registru <strong>Si</strong> do registru <strong>VM</strong></td></tr>
<tr><td>Si &lt;- VM</td><td>opak pøedchozí instrukce: pøenesení obsahu <strong>VM</strong> do registru <strong>Si</strong></td></tr>
</table>

<p>(jak jste si zajisté pov¹imli, jsou mnemonické kódy instrukcí ponìkud
neobvyklé, ale mo¾ná pøehlednìj¹í, ne¾ kódy vyu¾ívající pouze alfanumerické
znaky). Mnohem dùle¾itìj¹í a takté¾ zajímavìj¹í jsou v¹ak instrukce, které
naplòují registr <strong>VM</strong> na základì aktuálních hodnot prvkù
ulo¾ených v&nbsp;nìkterém vektorovém registru <strong>Vk</strong> (k=0 a¾ 7).
Tyto instrukce, které ka¾dý bit registru <strong>VM</strong> nastavují podle
hodnoty v&nbsp;pøíslu¹ném prvku vybraného vektorového registru
<strong>Vk</strong>, jsou vypsány v&nbsp;následující tabulce:</p>

<table>
<tr><th>Instrukce</th><th>Popis instrukce</th></tr>
<tr><td>VM &lt;-&nbsp;Vk,Z</td><td>nastavení tìch bitù registru <strong>VM</strong> na jednièku v&nbsp;pøípadì, ¾e korespondující prvek <strong>Vk</strong> je nulový</td></tr>
<tr><td>VM &lt;-&nbsp;Vk,N</td><td>nastavení tìch bitù registru <strong>VM</strong> na jednièku v&nbsp;pøípadì, ¾e korespondující prvek <strong>Vk</strong> je nenulový</td></tr>
<tr><td>VM &lt;-&nbsp;Vk,P</td><td>dtto pro prvky <strong>Vk</strong> vìt¹í nebo rovny nule (bit znaménka prvky je nulový)</td></tr>
<tr><td>VM &lt;-&nbsp;Vk,M</td><td>dtto pro záporné prvky <strong>Vk</strong> (bit znaménka prvku je nastavený na jednièku)</td></tr>
</table>

<a href="http://i.iinfo.cz/images/541/cray4-07-orig.png"><img src="http://i.iinfo.cz/images/541/cray4-07-prev.png" width="291" height="270" alt=" " /></a>
<p><i>Obrázek 7: Sada registrù dostupných programátorùm v&nbsp;ka¾dém
background procesoru. V&nbsp;horní èásti je osmice vektorových registrù
<strong>V</strong> doplnìná registrem <strong>VM</strong> (Vector Mask) a
<strong>VL</strong> (Vector Length), pod nimi je osmice skalárních registrù
<strong>S</strong> a nejní¾e pak adresové registry <strong>A</strong>.
Pov¹imnìte si, ¾e obsah adresových registrù není mo¾né naèítat ani ukládat z/do
operaèní pamìti &ndash; pro tuto èinnost je nutné pou¾ít registry vektorové
nebo skalární. Naopak pro pøenos dat mezi registry a lokální pamìtí (èervený
obdélník) lze pou¾ít v¹echny registry, vèetnì registrù speciálních.<br />
(zdroj: Cray Research; kvalita obrázku je kvùli nízkému rozli¹ení pøi skenování
a pou¾ití JPEG komprimace ponìkud nízká))</i></i></p>



<p><a name="k06"></a></p>
<h2>6. Pøiøazení hodnoty do vektorového registru s&nbsp;vyu¾itím masky</h2>

<p>V&nbsp;pøípadì, ¾e jsou v¹echny bity maskovacího registru
<strong>VM</strong> správnì nastaveny pomocí nìkteré z&nbsp;instrukcí zmínìných
<a href="#k05">v&nbsp;pøedcházející kapitole</a>, lze s&nbsp;vyu¾itím tohoto
registru provádìt následující operace, v&nbsp;nich¾ se ji¾ vyu¾ívá efektu
&bdquo;maskování&ldquo;:</p>

<table>
<tr><th>Instrukce</th><th>Popis instrukce</th></tr>
<tr><td>Vi &lt;-&nbsp;Sj!Vk&amp;VM</td><td>kombinace prvkù vektorového registru <strong>Vk</strong> se skalárním registrem <strong>Sj</strong> s&nbsp;ulo¾ením výsledku do vektorového registru <strong>Vi</strong></td></tr>
<tr><td>Vi &lt;-&nbsp;Vj!Vk&amp;VM</td><td>kombinace prvkù vektorového registru <strong>Vj</strong> s registrem <strong>Vk</strong> s&nbsp;ulo¾ením výsledku do vektorového registru <strong>Vi</strong></td></tr>
</table>

<p>První instrukce pracuje následujícím zpùsobem: pokud je bit <i>n</i>
registru <strong>VM</strong> (n=0 a¾ 63) nastavený na logickou jednièku, je do
n-tého prvku vektorového registru <strong>Vi</strong> vlo¾ena hodnota
skalárního registru <strong>Sj</strong>. Ov¹em v&nbsp;pøípadì, ¾e je bit
<i>n</i> registru <strong>VM</strong> nastavený na logickou nulu, je do n-tého
prvku vektorového registru <strong>Vi</strong> zkopírován n-tý prvek
z&nbsp;vektorového registru <strong>Vk</strong>. Obdobným zpùsobem pracuje i
druhá instrukce: pokud je bit <i>n</i> registru <strong>VM</strong> jednièkový,
provede se pøiøazení <strong>Vi(n)=Vj(n)</strong>, jinak pøiøazení
<strong>Vi(n)=Vk(n)</strong>. Obì operace jsou samozøejmì provedeny pro v¹echna
n=0 a¾ 63, navíc je vyhodnocení jednotlivých bitù masky a pøenosy provádìno
paralelnì pro v¹echny prvky vektorových registrù. Vzájemnou kombinací tìchto
dvou instrukcí a instrukcí popsaných v&nbsp;pøedchozí kapitole lze
implementovat velkou èást programových smyèek, v&nbsp;jejich¾ tìle se vyskytuje
jeden neúplný pøíkaz <strong>IF-THEN</strong>, jeden úplný pøíkaz
<strong>IF-THEN-ELSE</strong> a v&nbsp;nìkterých (nikoli v¹ak v¹ech) pøípadech
i vlo¾ené pøíkazy <strong>IF</strong>.</p>

<img src="http://i.iinfo.cz/images/554/hist3909.jpg" width="357" height="414"   alt=" " />
<p><i>Obrázek 8: Detailní pohled na funkèní moduly superpoèítaèe Cray-2
ponoøené do chladicí kapaliny.<br />
(zdroj: Cray Research)</i></p>



<p><a name="k07"></a></p>
<h2>7. Malý úkol pro ètenáøe</h2>

<p>V&nbsp;této kapitole se mù¾e pozorný ètenáø pokusit o simulaci
optimalizujícího pøekladaèe urèeného pro superpoèítaè <i>Cray-2</i>.
Následující pøíklady, v&nbsp;nich¾ jsou pou¾ity programové smyèky a
jednorozmìrná pole, lze pøelo¾it takovým zpùsobem, ¾e se smyèky nahradí
nìkterou vektorovou operací nebo nìkolika vektorovými operacemi. Pro
jednoduchost pøedpokládejme, ¾e v¹echna pou¾itá pole mají maximální velikost 64
prvkù, aby je bylo mo¾né ulo¾it do vektorových registrù. Pus»me se tedy do
øe¹ení. Jakým zpùsobem by bylo mo¾né pøelo¾it následující programovou smyèku
napsanou v&nbsp;pseudokódu (pøedpokládejme, ¾e umíme naplnit libovolný skalární
registr konstantou pomocí instrukce <strong>Si&lt;n</strong>)?</p>

<pre>
for i = 0 to 63
    a[i] = 42
end
</pre>

<p>I tento kód lze optimalizovat a nahradit pouhou sekvencí instrukcí bez
programové smyèky:</p>

<pre>
for i = 0 to 63
    if a[i] == 0 then
        b[i] = c[i]
    else
        b[i] = 42
end
</pre>

<p>Popø.&nbsp;jak by bylo mo¾né pøelo¾it následující programovou smyèku?
(poznámka: <i>Cray 2</i> obsahuje instrukci <strong>Vj-Vk</strong>, která
odeète v¹echny prvky vektoru <strong>Vk</strong> od odpovídajících prvkù
vektoru <strong>Vj</strong>, co¾ se vám mù¾e pøi øe¹ení hodit):</p>

<pre>
for i = 0 to 7
    if a[i] &gt; b[i] then
        c[i] = a[i]
    else
        c[i] = b[i]
end

// nyní bude pole "c" obsahovat ve svých prvcích
// v¾dy vìt¹í korespondující prvek z pole "a" a "b"
</pre>

<a href="http://i.iinfo.cz/images/111/hist3916.png"><img src="http://i.iinfo.cz/images/111/hist3916-prev.png" width="370" height="153" alt=" " /></a>
<p><i>Obrázek 9: Nìkteré typy programových smyèek optimalizovaných pøekladaèem FORTRANu 77 pro poèítaèe Cray-2.<br />
(zdroj: materiály firmy Cray Research)</i></p>



<p><a name="k08"></a></p>
<h2>8. Dal¹í operace s&nbsp;vektory</h2>

<p>Kromì pou¾ití registru <strong>VM</strong> lze s&nbsp;vektory, pøesnìji
øeèeno s&nbsp;numerickými hodnotami ulo¾enými do nìkterého z&nbsp;vektorových
registrù <strong>Vi</strong>, provádìt i mnoho dal¹ích aritmetických operací.
V&nbsp;následující tabulce jsou vypsány nìkteré instrukce, které tyto operace
implementují. Pov¹imnìte si, ¾e tyto instrukce lze rozdìlit do nìkolika
kategorií: operace provádìné se skalárem a vektorem, operace provádìné mezi
dvojicí vektorù, konverze dat a naèítání èi ukládání dat do hlavní pamìti
popø.&nbsp;do pamìti lokální:</p>

<table>
<tr><th>Instrukce</th><th>Popis instrukce</th></tr>
<tr><td>Vi&lt;-Sj&amp;Vk</td><td>bitová operace AND (bit po bitu)              </td></tr>
<tr><td>Vi&lt;-Vj&amp;Vk</td><td>dtto ale pro dvojici vektorù                  </td></tr>
<tr><td>Vi&lt;-Sj\Vk    </td><td>bitová operace XOR (bit po bitu)              </td></tr>
<tr><td>Vi&lt;-Vj\Vk    </td><td>dtto ale pro dvojici vektorù                  </td></tr>
<tr><td>Vi&lt;-Sj!Vk    </td><td>bitová operace XOR (bit po bitu)              </td></tr>
<tr><td>Vi&lt;-Vj!Vk    </td><td>dtto ale pro dvojici vektorù                  </td></tr>
<tr><td>Vi&lt;-Vj&lt;Ak </td><td>bitový posun doleva o Ak bitù                 </td></tr>
<tr><td>Vi&lt;-Vj&gt;Ak </td><td>bitový posun doprava o Ak bitù                </td></tr>
<tr><td>&nbsp;          </td><td>&nbsp;                                        </td></tr>
<tr><td>Vi&lt;-Sj+Vk    </td><td>pøiètení skaláru ke ka¾dému prvku vektoru     </td></tr>
<tr><td>Vi&lt;-Vj+Vk    </td><td>souèet dvou vektorù (celá èísla)              </td></tr>
<tr><td>Vi&lt;-Sj+FVk   </td><td>pøiètení skaláru ke ka¾dému prvku vektoru     </td></tr>
<tr><td>Vi&lt;-Vj+FVk   </td><td>souèet dvou vektorù (FP èísla)                </td></tr>
<tr><td>Vi&lt;-Sj-Vk    </td><td>odeètení prvku vektoru od skaláru             </td></tr>
<tr><td>Vi&lt;-Vj-Vk    </td><td>rozdíl dvou vektorù (celá èísla)              </td></tr>
<tr><td>Vi&lt;-Sj-FVk   </td><td>odeètení prvku vektoru od skaláru             </td></tr>
<tr><td>Vi&lt;-Vj-FVk   </td><td>rozdíl dvou vektorù (FP èísla)                </td></tr>
<tr><td>&nbsp;          </td><td>&nbsp;                                        </td></tr>
<tr><td>Vi&lt;-Sj*FVk   </td><td>násobení vektoru skalárem                     </td></tr>
<tr><td>Vi&lt;-Vj*FVk   </td><td>násobení odpovídajících prvkù vektorù         </td></tr>
<tr><td>Vi&lt;-Vj*IVk   </td><td>jeden krok výpoètu pøevrácené hodnoty (2-Vj*Vk)</td></tr>
<tr><td>Vi&lt;-Vj*QSk   </td><td>jeden krok výpoètu odmocniny (3-Vj*Vk)/2      </td></tr>
<tr><td>&nbsp;          </td><td>&nbsp;                                        </td></tr>
<tr><td>Vi&lt;-FIX,Vk   </td><td>konverze z FP na celá èísla (celého vektoru   </td></tr>
<tr><td>Vi&lt;-FLT,Vk   </td><td>konverze celých èísel na FP (celý vektor)     </td></tr>
<tr><td>&nbsp;          </td><td>&nbsp;                                        </td></tr>
<tr><td>Vi&lt;-(Aj,Ak)  </td><td>naètení vektoru z globální pamìti od adresy Aj, v Ak je krok mezi sousedními prvky (vhodné napøíklad pro naèítání sloupcù matice)</td></tr>
<tr><td>(Aj,Ak)&lt;- Vi </td><td>ulo¾ení vektoru do globální pamìti od adresy Aj</td></tr>
<tr><td>Vi&lt;-(Ak,Vj)  </td><td>naètení vektoru z globální pamìti od adresy Aj, ve Vj jsou offsety prvkù</td></tr>
<tr><td>(Ak,Vj)&lt;Vi   </td><td>dtto, ale ulo¾ení do pamìti</td></tr>
<tr><td>Vi&lt;-[Ak]     </td><td>naètení vektoru z lokální pamìti od adresy Ak </td></tr>
<tr><td>[Ak]&lt;-Vi     </td><td>ulo¾ení vektoru do lokální pamìti od adresy Ak</td></tr>
</table>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>Cray History<br />
<a href="http://www.cray.com/About/History.aspx?404;http://www.cray.com:80/about_cray/history.html">http://www.cray.com/About/History.aspx?404;http://www.cray.com:80/about_cray/history.html</a>
</li>

<li>Cray Historical Timeline<br />
<a href="http://www.cray.com/Assets/PDF/about/CrayTimeline.pdf">http://www.cray.com/Assets/PDF/about/CrayTimeline.pdf</a>
</li>

<li>Company: Cray Research, Inc. (Computer History)<br />
<a href="http://www.computerhistory.org/brochures/companies.php?alpha=a-c&amp;company=com-42b9d5d68b216">http://www.computerhistory.org/brochures/companies.php?alpha=a-c&amp;company=com-42b9d5d68b216</a>
</li>

<li>Cray Wiki<br />
<a href="http://www.craywiki.com/index.php?title=Main_Page">http://www.craywiki.com/index.php?title=Main_Page</a>
</li>

<li>Cray (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Cray">http://en.wikipedia.org/wiki/Cray</a>
</li>

<li>Cray-1 (Cray Wiki)<br />
<a href="http://www.craywiki.com/index.php?title=Cray_1S">http://www.craywiki.com/index.php?title=Cray_1S</a>
</li>

<li>Cray-1 (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Cray-1">http://en.wikipedia.org/wiki/Cray-1</a>
</li>

<li>Cray X-MP (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Cray_X-MP">http://en.wikipedia.org/wiki/Cray_X-MP</a>
</li>

<li>Cray-2 (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Cray-2">http://en.wikipedia.org/wiki/Cray-2</a>
</li>

<li>What Limits Forecast Accuracy?<br />
<a href="http://weather.mailasail.com/Franks-Weather/Forecast-Accuracy-Limitations">http://weather.mailasail.com/Franks-Weather/Forecast-Accuracy-Limitations</a>
</li>

<li>Remembering the Cray-1<br />
<a href="http://www.theregister.co.uk/2008/01/05/tob_cray1/">http://www.theregister.co.uk/2008/01/05/tob_cray1/</a>
</li>

<li>Cray Supercomputer FAQ and other documents<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/index.html">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/index.html</a>
</li>

<li>Cray Research and Cray computers FAQ Part 1<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp1.html#TOC">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp1.html#TOC</a>
</li>

<li>Cray Research and Cray computers FAQ Part 2<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp2.html#TOC1">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp2.html#TOC1</a>
</li>

<li>Cray Research and Cray computers FAQ Part 3<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp3.html#TOC1">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp3.html#TOC1</a>
</li>

<li>Cray Research and Cray computers FAQ Part 4<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp4.html#TOC1">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp4.html#TOC1</a>
</li>

<li>Cray Research and Cray computers FAQ Part 5<br />
<a href="http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp5.html#TOC1">http://www.spikynorman.dsl.pipex.com/CrayWWWStuff/Cfaqp5.html#TOC1</a>
</li>

<li>Seymour Cray<br />
<a href="http://www.craywiki.com/index.php?title=Seymour_Cray">http://www.craywiki.com/index.php?title=Seymour_Cray</a>
</li>

<li>Seymour Cray Biography<br />
<a href="http://www.cray.com/Assets/PDF/about/SeymourCray.pdf">http://www.cray.com/Assets/PDF/about/SeymourCray.pdf</a>
</li>

<li>Fluorinert<br />
<a href="http://solutions.3m.com/wps/portal/3M/en_US/electronics/home/productsandservices/products/chemicals/ElectronicLiquids/?WT.mc_id=keymatch">http://solutions.3m.com/wps/portal/3M/en_US/electronics/home/productsandservices/products/chemicals/ElectronicLiquids/?WT.mc_id=keymatch</a>
</li>

<li>Fluorinert<br />
<a href="http://en.wikipedia.org/wiki/Fluorinert">http://en.wikipedia.org/wiki/Fluorinert</a>
</li>

<li>Historic Computer Images<br />
<a href="http://ftp.arl.army.mil/ftp/historic-computers/">http://ftp.arl.army.mil/ftp/historic-computers/</a>
</li>

<li>Cray-2 logic module<br />
<a href="http://bobodyne.com/web-docs/robots/cray2/">http://bobodyne.com/web-docs/robots/cray2/</a>
</li>

<li>The making of a CRAY-3<br />
<a href="http://www.cisl.ucar.edu/docs/SCD_Newsletter/News_summer93/04e.cray3.html">http://www.cisl.ucar.edu/docs/SCD_Newsletter/News_summer93/04e.cray3.html</a>
</li>

<li>Computer Speed Claims 1980 to 1996<br />
<a href="http://homepage.virgin.net/roy.longbottom/mips.htm">http://homepage.virgin.net/roy.longbottom/mips.htm</a>
</li>

<li>Speed of Intel 8087 co-processor in FLOPS ($100)<br />
<a href="http://answers.google.com/answers/threadview/id/542435.html">http://answers.google.com/answers/threadview/id/542435.html</a>
</li>

<li>Million instructions per second<br />
<a href="http://en.wikipedia.org/wiki/Mflops">http://en.wikipedia.org/wiki/Mflops</a>
</li>

<li>Million instructions per second<br />
<a href="http://en.wikipedia.org/wiki/Million_instructions_per_second#Million_instructions_per_second">http://en.wikipedia.org/wiki/Million_instructions_per_second#Million_instructions_per_second</a>
</li>

<li>Rosetta Code &ndash; Category:Fortran<br />
<a href="http://rosettacode.org/wiki/Fortran">http://rosettacode.org/wiki/Fortran</a>
</li>

<li>IBM 36-bit computers<br />
<a href="http://www.36bit.org/ibm/">http://www.36bit.org/ibm/</a>
</li>

<li>Symbolics 36-bit computers<br />
<a href="http://www.36bit.org/symbolics/">http://www.36bit.org/symbolics/</a>
</li>

<li>IBM System 360/370 Compiler and Historical Documentation<br />
<a href="http://www.edelweb.fr/Simula/">http://www.edelweb.fr/Simula/</a>
</li>

<li>Who Was Who in IBM's Programming Research? Early FORTRAN Days<br />
<a href="http://www.trailing-edge.com/~bobbemer/PRORES.HTM">http://www.trailing-edge.com/~bobbemer/PRORES.HTM</a>
</li>

<li>Emitter-coupled logic<br />
<a href="http://en.wikipedia.org/wiki/Emitter-coupled_logic">http://en.wikipedia.org/wiki/Emitter-coupled_logic</a>
</li>

<li>ECL &ndash; Emitter Coupled Logic<br />
<a href="http://ppd.fnal.gov/elec/ecl/ecl.html">http://ppd.fnal.gov/elec/ecl/ecl.html</a>
</li>

<li>Cray's Mark Remains Speed With Simplicity<br />
<a href="http://www.mbbnet.umn.edu/hoff/hoff_sc.html">http://www.mbbnet.umn.edu/hoff/hoff_sc.html</a>
</li>

<li>Control Data Corporation (CDC) 6600: 1966-1977<br />
<a href="http://www.cisl.ucar.edu/computers/gallery/cdc/6600.jsp">http://www.cisl.ucar.edu/computers/gallery/cdc/6600.jsp</a>
</li>

<li>Control Data Corporation (CDC) 7600: 1971-1983<br />
<a href="http://www.cisl.ucar.edu/computers/gallery/cdc/7600.jsp">http://www.cisl.ucar.edu/computers/gallery/cdc/7600.jsp</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

