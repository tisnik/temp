<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Osmibitové mikroøadièe PIC (1)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Osmibitové mikroøadièe PIC (1)</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V&nbsp;dne¹ní èásti seriálu o architekturách poèítaèù budeme pokraèovat v&nbsp;popisu osmibitových mikroøadièù. Zamìøíme se na známé a roz¹íøené mikroøadièe z&nbsp;rodiny PIC, zpoèátku pøedev¹ím na ty typy èipù, které pou¾ívají dvanáctibitovou a ètrnáctibitovou instrukèní sadu.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Osmibitové mikroøadièe PIC</a></p>
<p><a href="#k02">2. Struèná historie mikroøadièù PIC</a></p>
<p><a href="#k03">3. Spoleèné vlastnosti a rozdíly mezi mikroøadièi PIC a MCS-51</a></p>
<p><a href="#k04">4. Rozdìlení osmibitových mikroøadièù PIC do rodin</a></p>
<p><a href="#k05">5. Instrukèní sady mikroøadièù PIC</a></p>
<p><a href="#k06">6. Skoky a instrukce typu SKIP</a></p>
<p><a href="#k07">7. Seznam instrukcí dvanáctibitové instrukèní sady</a></p>
<p><a href="#k08">8. Obsah následující èásti seriálu</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Osmibitové mikroøadièe PIC</h2>

<p>V&nbsp;pøedchozích pìti èástech seriálu o architekturách poèítaèù jsme si
struènì popsali historii vzniku osmibitových mikroøadièù <i>Intel 8048</i>
(oznaèovaných té¾ jako <i>MCS-48</i>) a <i>Intel 8051</i> (<i>MCS-51</i>) i
nìkteré aplikaèní oblasti, ve kterých se tyto mikroøadièe vyu¾ívaly èi stále
vyu¾ívají. Ov¹em nabídka mikroøadièù, které je v&nbsp;souèasnosti mo¾né pro
amatérské èi profesionální elektronická zaøízení vyu¾ít, není v&nbsp;¾ádném
pøípadì omezena pouze na èipy z&nbsp;rodiny <i>MCS-48</i> a <i>MCS-51</i>.
Jedním z&nbsp;alternativních typù mikroøadièù jsou &ndash; pokud prozatím
zùstaneme u osmibitových architektur &ndash; i mikroøadièe <i>PIC</i> firmy
<i>Microchip Technology</i>. Tato firma dnes nabízí nìkolik set(!) rùzných typù
tìchto èipù, které se od sebe odli¹ují jak poètem vyu¾itelných
vstupnì/výstupních pinù, tak i kapacitou interní pamìti dat (RAM) a takté¾
interní pamìti programu (ROM), poètem a typem modulù, které jsou na mikroøadièi
implementovány, rozsahem povoleného napájecího napìtí, rozsahem frekvencí
hodinového signálu, kterým se èip øídí atd.</p>

<a href="http://i.iinfo.cz/images/197/pc127-1.png"><img src="http://i.iinfo.cz/images/197/pc127-1-prev.png" width="338" height="270" alt=" " /></a>
<p><i>Obrázek 1: Pro vývoj aplikací urèených pro osmibitové mikroøadièe PIC lze
pou¾ít i mnoho open source nástrojù. Na tomto screenshotu jsou zobrazena
nìkterá okna nástroje gpsim (simulátoru mikroøadièù).</i></p>

<p>V&nbsp;následujícím textu se zamìøíme pøedev¹ím na popis tìch
nejjednodu¹¹ích mikroøadièù firmy <i>Microchip Technology</i>, konkrétnì èipù
pou¾ívajících dvanáctibitovou èi ètrnáctibitovou instrukèní sadu (rozdíl mezi
nimi si vysvìtlíme dále). Nìkteré z&nbsp;tìchto èipù, napøíklad celá øada
<strong>PIC10F</strong>, se díky své nízké cenì a malému poètu vývodù
z&nbsp;pouzdra podobá spí¹e (programovatelným) logickým obvodùm ne¾
plnohodnotným mikroøadièùm, ov¹em právì to je jeden z&nbsp;dùvodù, proè jsou
mikroøadièe <i>PIC</i> tak oblíbené, jak mezi konstruktéry amatérských zaøízení
(nízká cena <i>PICù</i> a hlavnì existence interní pamìti typu EPROM/Flash),
tak i mezi konstruktéry profesionálních výrobkù, proto¾e existence
programovatelného èipu umo¾òuje, aby se zmìny v&nbsp;zapojení èi zmìny
funkcionality nìjakého výrobku provádìly i v&nbsp;pomìrnì pozdních stadiích
vývoje, bez nutnosti zmìny návrhu plo¹ného spoje a dal¹ích s&nbsp;tím
souvisejících èinností. Výkonnìj¹í typy mikroøadièù <i>PIC</i>, které ji¾
v&nbsp;mnoha ohledech konkurují platformì <i>MCS-51</i> èi <i>AVR</i>, budou
popsány v&nbsp;následujících èástech seriálu, spolu s&nbsp;popisem vhodných
vývojových nástrojù, kitù pro odzkou¹ení tìchto mikroøadièù v&nbsp;praxi
atd.</p>

<a href="http://i.iinfo.cz/images/197/pc127-2.png"><img src="http://i.iinfo.cz/images/197/pc127-2-prev.png" width="370" height="168" alt=" " /></a>
<p><i>Obrázek 2: Mezi jedny z&nbsp;nejpou¾ívanìj¹ích mikroøadièù PIC patøí øada
PIC16F87, která konstruktérùm nabízí pøíznivý pomìr mezi cenou a velikostí èipu
na jedné stranì a jeho mo¾nostmi na stranì druhé.</i></p>



<p><a name="k02"></a></p>
<h2>2. Struèná historie mikroøadièù PIC</h2>

<p>Mikroøadièe <i>PIC</i> mají za sebou velmi dlouhý a v&nbsp;nìkolika ohledech
i zajímavý vývoj. Ten vlastnì zaèal ji¾ v&nbsp;polovinì sedmdesátých let
minulého století, kdy vznikl mikroøadiè <i>Signetics 8x300</i>. Jednalo se o
jeden z&nbsp;prvních mikroøadièù zalo¾ených na Harvardské architektuøe
(tj.&nbsp;s&nbsp;oddìlenou pamìtí pro data a pamìtí pro program), který byl
vytvoøený na bázi bipolárních tranzistorù, podobnì jako napøíklad logické
obvody øady TTL. Tento mikroøadiè ov¹em postrádal nìkteré dùle¾ité vlastnosti,
napøíklad nemìl zásobník, indexové registry a dokonce ani mo¾nost zpracovávat
pøeru¹ení (co¾ souviselo, i kdy¾ jen okrajovì, s&nbsp;neexistencí zásobníku).
Takté¾ adresování pamìti programu bylo ponìkud slo¾ité &ndash; provádìlo se
pøes osmibitový registr <strong>IVB</strong>, navíc aritmeticko-logická
jednotka dokázala provádìt pouze instrukce <strong>MOV</strong>,
<strong>ADD</strong>, <strong>AND</strong>, <strong>XOR</strong> a bitové
posuny. Z&nbsp;vý¹e uvedených dùvodù se mikroøadiè <i>Signetics 8x300</i>
v&nbsp;praxi pøíli¹ neroz¹íøil.</p>

<a href="http://i.iinfo.cz/images/197/pc127-3.png"><img src="http://i.iinfo.cz/images/197/pc127-3-prev.png" width="328" height="270" alt=" " /></a>
<p><i>Obrázek 3: Zapojení vývodù mikroøadièe PIC16F88.</i></p>

<p>V&nbsp;sedmdesátých letech minulého století ov¹em vznikl i ¹estnáctibitový
mikroprocesor s&nbsp;oznaèením <i>CP1600</i> firmy <i>General Instruments</i>
(s&nbsp;touto firmou jsme se ji¾ ostatnì v&nbsp;tomto seriálu setkali, proto¾e
stojí i za vznikem slavného zvukového èipu <i>AY-3-8910</i>, lidovì
&bdquo;áýèka&ldquo;). Aby se vylep¹ila výkonnost tohoto nepøíli¹ úspì¹ného
mikroprocesoru pøi provádìní rùzných vstupnì/výstupních operací, byl vytvoøen
pomocný èip nesoucí oznaèení <i>PIC1640</i>, kde první tøi písmena
&bdquo;PIC&ldquo; znamenala &bdquo;Programmable Interface Controller&ldquo;.
Úkolem tohoto èipu byla skuteènì komunikace s&nbsp;periferními zaøízeními,
kterou tak nemusel obstarávat mikroprocesor <i>CP1600</i>. Pùvodní
<i>PIC1640</i> a na nìj navazující èip <i>PIC1650</i> obsahoval interní pamì»
ROM programovanou pomocí poslední masky pøímo pøi výrobì èipu. Ov¹em vìt¹ího
roz¹íøení se mikroøadièe <i>PIC</i> doèkaly a¾ po oddìlení divize
mikroelektroniky z&nbsp;firmy <i>General Instruments</i> do novì vzniklé firmy
s&nbsp;názvem <i>Microchip Technology</i>.</p>

<a href="http://i.iinfo.cz/images/197/pc127-4.png"><img src="http://i.iinfo.cz/images/197/pc127-4-prev.png" width="370" height="85" alt=" " /></a>
<p><i>Obrázek 4: Hlavní okno simulátoru mikroøadièù PIC &ndash; aplikace
gpsim.</i></p>

<p>Právì v&nbsp;této nové firmì do¹lo k&nbsp;zásadní promìnì mikroøadièe
&ndash; náhradì nemìnné ROM za pamì» EPROM (mazatelné ultrafialovým záøením
pøes okénko na èipu) a posléze i náhradì EPROM za EEPROM (elektronicky
mazatelnou pamì») a Flash (vylep¹enou EEPROM s&nbsp;vìt¹ím mno¾stvím zápisù a
rychlej¹ím blokovým algoritmem pøepisu dat). Mimochodem &ndash; první
mikroøadiè <i>PIC</i> s&nbsp;EEPROM nesoucí jméno <strong>PIC 16C84</strong> se
díky svému významu pro dal¹í vývoj celého odvìtví dostal i mezi 25 èipù, které
(podle autora tohoto ¾ebøíèku) nejvíce zmìnily svìt: &bdquo;25 Microchips That
Shoot The World&ldquo;. <i>PIC 16C84</i> je zde zmínìn napøíklad vedle známého
èasovaèe <i>555</i>, osmibitového mikroprocesoru <i>MOS 6502</i>, 8/16bitového
mikroprocesoru <i>Intel 8088</i> (právì ten stál u vzniku platformy IBM PC,
nikoli jeho výkonnìj¹í brá¹ka <i>Intel 8086</i>) èi 16/32bitového
mikroprocesoru <i>Motorola 68000</i> (majitelùm osobních mikropoèítaèù znaèek
Atari ST, Amiga èi Macintosh 68k zajisté netøeba zdlouhavì pøedstavovat).</p>

<a href="http://i.iinfo.cz/images/197/pc127-5.png"><img src="http://i.iinfo.cz/images/197/pc127-5-prev.png" width="264" height="270" alt=" " /></a>
<p><i>Obrázek 5: Editor pamìti programu v&nbsp;simulátoru gpsim.</i></p>



<p><a name="k03"></a></p>
<h2>3. Spoleèné vlastnosti a rozdíly mezi mikroøadièi PIC a MCS-51</h2>

<p>Pojïme si nyní øíci základní technické informace o osmibitových
mikroøadièích <i>PIC</i>. Mo¾ná bude zajímavé i jejich porovnání s&nbsp;ji¾
popsanou øadou mikroøadièù <i>MCS-51</i>, s&nbsp;ní¾ mají <i>PIC</i> nìkteré
vlastnosti témìø shodné a v&nbsp;nìkterých vlastnostech se naopak obì øady èipù
zcela odli¹ují. Z&nbsp;pøedchozích èástí tohoto seriálu ji¾ víme, ¾e
mikroøadièe <i>MCS-51</i> jsou zalo¾eny na osmibitové aritmeticko-logické
jednotce (ALU), interní pamìti údajù (RAM) o velikosti typicky 128 nebo 256
bajtù, sadì registrù speciálních funkcí (SFR), interní pamìti programu (ROM),
dvojici èi trojici konfigurovatelných èítaèù/èasovaèù, øadièem pøeru¹ení a
takté¾ konfigurovatelným synchronním i asynchronním sériovým portem. Jak pamì»
RAM, tak i pamì» ROM je adresována po bajtech a vzhledem k&nbsp;tomu, ¾e se
jedná o mikroøadièe zalo¾ené na Harvardské architektuøe, jsou obì pamìti od
sebe striktnì oddìleny a pro pøístup k&nbsp;jednotlivým pamì»ovým buòkám RAM a
ROM jsou pou¾ity zcela jiné instrukce. Navíc je mo¾né k&nbsp;<i>MCS-51</i>
pøipojit i externí pamìti RAM a ROM a vytvoøit tak vlastnì základ
mikropoèítaèového systému.</p>

<a href="http://i.iinfo.cz/images/197/pc127-6.png"><img src="http://i.iinfo.cz/images/197/pc127-6-prev.png" width="263" height="270" alt=" " /></a>
<p><i>Obrázek 6: Nástroj gpsim obsahuje i disassembler.</i></p>

<p>Osmibitové mikroøadièe <i>PIC</i> jsou takté¾ zalo¾eny na Harvardské
architektuøe s&nbsp;oddìlenou pamìtí údajù od pamìti programu. Pamì» údajù o
kapacitì øádovì desítky a¾ stovky bajtù je adresovatelná po jednotlivých
bajtech, stejnì jako v&nbsp;pøípadì <i>MCS-51</i> (i kdy¾ se v&nbsp;pøípadì
mikroøadièù PIC hovoøí o sadì universálních a speciálních registrù, jedná se o
obdobu RAM u èipù 8051). Ov¹em struktura pamìti programu je v&nbsp;pøípadì
mikroøadièù <i>PIC</i> zcela odli¹ná. Namísto organizace této pamìti po bajtech
se pou¾ívají slova o ¹íøce 12, 14 èi 16 bitù (v&nbsp;závislosti na verzi
pou¾itého èipu, resp.&nbsp;na jeho rodinì). Na první pohled netypická velikost
zpracovávaných slov je ov¹em umo¾nìna dvìma fakty: ji¾ zmínìnou Harvardskou
architekturou (která zcela oddìluje ROM od RAM) a takté¾ tím, ¾e se u vìt¹iny
mikroøadièù <i>PIC</i> (kromì nìkterých modelù z&nbsp;rodiny <i>PIC17</i> a
<i>PIC18</i>) vyu¾ívá pouze interní pamì» programu, nikoli pamì» externí, tak¾e
není zapotøebí, aby se mikroøadièe <i>PIC</i> musely pøi práci s&nbsp;externí
pamìtí &bdquo;podøizovat&ldquo; okolnímu osmibitovému èi ¹estnáctibitovému
svìtu.</p>

<a href="http://i.iinfo.cz/images/197/pc127-7.png"><img src="http://i.iinfo.cz/images/197/pc127-7-prev.png" width="304" height="270" alt=" " /></a>
<p><i>Obrázek 7: Krokování programu v&nbsp;nástroji gpsim.</i></p>

<p>Na tomto místì je mo¾ná vhodné se zmínit o tom, ¾e dal¹ím konstruktérem
mikroprocesorù a mikroøadièù, který se odmítl smíøit s&nbsp;tím, ¾e pamìti musí
mít ¹íøku datové sbìrnice 8, 16 èi 32 bitù, byl <i>Chuck Moore</i>
(mj.&nbsp;tvùrce programovacího jazyka <strong>FORTH</strong>), který napøíklad
u svého mikroøadièe <i>F21</i> zvolil dvacetibitovou architekturu pamìtí i
aritmeticko-logické jednotky. Vra»me se v¹ak k&nbsp;mikroøadièùm <i>PIC</i>:
díky vìt¹í bitové ¹íøce instrukcí bylo mo¾né zjednodu¹it instrukèní sadu
takovým zpùsobem, ¾e vìt¹ina instrukcí má délku pouze jednoho slova,
tj.&nbsp;12, 14 nebo 16 bitù, a navíc je poèet instrukcí zredukován,
v&nbsp;nìkterých pøípadech pouze na 33 instrukcí (viz následující kapitoly).
Mikroøadièe <i>MCS-51</i> a <i>PIC</i> se odli¹ují je¹tì v&nbsp;jednom detailu:
zatímco zásobník je u <i>MCS-51</i> umístìn pøímo v&nbsp;pamìti údajù (tak¾e ho
lze modifikovat a navíc je jeho velikost teoreticky omezena na velikost celé
RAM), u mikroøadièù <i>PIC</i> se zásobník nachází mimo adresovatelnou oblast a
u vìt¹iny èipù je pomìrnì malý, co¾ ponìkud komplikuje práci programátorù
napøíklad pøi zpracování pøeru¹ení nebo pøi pøepínání úloh. Ov¹em souèasnì je
nutné øíci, ¾e na tuto èinnost nejsou mikroøadièe <i>PIC</i>, zejména rodiny
<i>PIC10</i> a¾ <i>PIC16</i>, urèeny a u rodiny <i>PIC18</i> má ji¾ zásobník
vìt¹í kapacitu.</p>

<img src="http://i.iinfo.cz/images/197/pc127-8.png" width="433" height="540" alt=" " />
<p><i>Obrázek 8: Editace obsahu pamìti RAM v&nbsp;nástroji gpsim.</i></p>



<p><a name="k04"></a></p>
<h2>4. Rozdìlení osmibitových mikroøadièù PIC do rodin</h2>

<p>V&nbsp;pøedchozích kapitolách jsme se prozatím bez vysvìtlování dal¹ích
podrobností zmínili o tom, ¾e osmibitové mikroøadièe <i>PIC</i> jsou rozdìleny
do takzvaných rodin. Èipy z&nbsp;jednotlivých rodin se od sebe odli¹ují
pøedev¹ím poètem vstupnì/výstupních portù (a tím pádem i pinù), poètem
universálních registrù (neboli kapacitou pamìti údajù), kapacitou pamìti
programu a v&nbsp;neposlední øadì také instrukèní sadou &ndash; nejjednodu¹¹í
mikroøadièe, konkrétnì se jedná o mikroøadièe spadající do rodiny <i>PIC10</i>,
mají ve své instrukèní sadì pouze 33 instrukcí, pouzdra tìchto èipù mají
v&nbsp;extrémním pøípadì jen ¹est vývodù (co¾ je napøíklad ménì ne¾ poèet
vývodù známého obvodu 555), kapacita pamìti programu dosahuje 256 nebo 512
bajtù a poèet universálních registrù je roven 16 nebo 24 (tak¾e kapacita
interní RAM je 16 èi 24 bajtù). Naproti tomu nìkteré mikroøadièe z&nbsp;rodiny
<i>PIC18</i> jsou umístìny v&nbsp;pouzdøe s&nbsp;28 a¾ 40 piny, jejich
instrukèní sada má 75 instrukcí, pamì» pro ulo¾ení programu mù¾e mít kapacitu 8
kB a poèet universálních registrù dosahuje typicky 256 bajtù.</p>

<img src="http://i.iinfo.cz/images/197/pc127-9.jpg" width="220" height="169" alt=" " />
<p><i>Obrázek 9: Èasovaè 555 má více pinù ne¾ nejjednodu¹¹í mikroøadièe PIC.</i></p>

<p>Základní rozdìlení osmibitových mikroøadièù <i>PIC</i> je znázornìno na
následujícím obrázku. Pov¹imnìte si, ¾e jedním z&nbsp;hlavních ukazatelù je
nejenom poèet pinù (který omezuje i poèet modulù, napøíklad pøítomnost
sériového portu, A/D pøevodníku èi PWM) ale i bitová ¹íøka instrukcí, proto¾e u
èipù s&nbsp;vìt¹ím poètem universálních registrù (RAM) i vìt¹í kapacitou pamìti
programu (ROM) je nutné v&nbsp;instrukèním slovì rezervovat vìt¹í mno¾ství bitù
pro ulo¾ení indexu universálního registru nebo adresy, na které se má provést
skok:</p>

<a href="http://i.iinfo.cz/images/197/pc127-10.png"><img src="http://i.iinfo.cz/images/197/pc127-10-prev.png" width="370" height="213" alt=" " /></a>
<p><i>Obrázek 10: Základní rozdìlení osmibitových mikroøadièù PIC. Zdroj: firma
Microchip Technology.</i></p>

<p>Pro lep¹í porovnání mo¾ností mikroøadièù z&nbsp;jednotlivých rodin jsou
v&nbsp;následující tabulce vypsány parametry nìkterých vybraných mikroøadièù
<i>PIC</i>:</p>

<table>
<tr><th>Mikroøadiè</th><th>Frekvence (MHz)</th><th>Pinù</th><th>RAM (poèet registrù)</th><th>ROM (slov)</th><th>Instrukèní sada &ndash; bitù</th><th>Poèet instrukcí</th></tr>
<tr><td>PIC10F200 </td><td>4</td><td>6-8</td><td>16</td><td>256</td><td>12</td><td>33</td></tr>
<tr><td>PIC10F206 </td><td>4</td><td>6-8</td><td>16</td><td>512</td><td>12</td><td>33</td></tr>
<tr><td>PIC12F683 </td><td>8</td><td>14</td><td>128</td><td>2048</td><td>14</td><td>35</td></tr>
<tr><td>PIC16F87  </td><td>a¾ 20</td><td>18</td><td>368</td><td>4096</td><td>14</td><td>35</td></tr>
<tr><td>PIC18F1220</td><td>a¾ 40</td><td>18-28</td><td>256</td><td>2048</td><td>16</td><td>78</td></tr>
<tr><td>PIC18F1320</td><td>a¾ 40</td><td>18-28</td><td>256</td><td>4096</td><td>16</td><td>78</td></tr>
</table>



<p><a name="k05"></a></p>
<h2>5. Instrukèní sady mikroøadièù PIC</h2>

<p>Instrukèní sada osmibitových mikroøadièù <i>PIC</i> se v&nbsp;nìkolika
ohledech odli¹uje od instrukèní sady, se kterou jsme se seznámili pøi popisu
mikroøadièù <i>MCS-48</i> a <i>MCS-51</i>. Zatímco u zmínìných dvou typù
mikroøadièù byla pamì» programu organizována po jednotlivých bajtech a
instrukce mìly promìnlivou délku jeden a¾ dva bajty i promìnlivou dobu trvání,
u mikroøadièù <i>PIC</i> je díky ¹ir¹ímu instrukènímu slovu o velikosti dvanáct
a¾ ¹estnáct bitù naprostá vìt¹ina instrukcí ulo¾ena pouze v&nbsp;jednom
slovu.</p>

<a href="http://i.iinfo.cz/images/197/pc127-11.jpg"><img src="http://i.iinfo.cz/images/197/pc127-11-prev.jpg" width="345" height="270" alt=" " /></a>
<p><i>Obrázek 11: Source browser &ndash; souèást nástroje gpsim.</i></p>

<p>Navíc je instrukèní sada velmi pravidelná (v&nbsp;mnoha ohledech
ortogonální) a s&nbsp;malým poètem instrukcí (nejmen¹í mikroøadièe mají pouze
33 instrukcí), co¾ na jednu stranu usnadòuje ¾ivot programátorùm, na stranu
druhou vede malá a pravidelná instrukèní sada k&nbsp;návrhu jednodu¹¹ího
øadièe, který je mo¾né implementovat na men¹í plo¹e èipu, co¾ je jak levnìj¹í,
tak i výhodnìj¹í z&nbsp;hlediska pøíkonu celého mikroøadièe. Kromì operaèního
kódu instrukce se do zmínìných dvanácti a¾ ¹estnácti bitù ukládá i adresa
universálního registru (druhým registrem instrukce je vìt¹inou akumulátor
<strong>W</strong>), index bitu u bitových operací, èi èást adresy, na kterou
se má øízení programu pøenést instrukcí skoku.</p>



<p><a name="k06"></a></p>
<h2>6. Skoky a instrukce typu SKIP</h2>

<p>U instrukcí skoku se na chvíli zastavme &ndash; zatímco u naprosté vìt¹iny
ostatních mikroprocesorù i mikroøadièù se v&nbsp;jejich instrukèní sadì nachází
i instrukce umo¾òující provádìní podmínìných skokù, tj.&nbsp;skokù provedených
po splnìní nìjaké podmínky (nulový, kladný èi záporný výsledek pøedchozí
aritmetické èi logické operace, pøeteèení pøedchozí aritmetické operace, atd.),
obsahují osmibitové mikroøadièe <i>PIC</i> (kromì nejvy¹¹í øady) pouze
instrukci pro provedení nepodmínìného skoku <strong>GOTO</strong> a nìkolik
instrukcí, které po splnìní nìjaké podmínky zmìní programový èítaè takovým
zpùsobem, ¾e je následující instrukce pøeskoèena (<i>skip</i>). Podmínìný skok
se tedy implementuje pomocí dvojice instrukcí &ndash; nìkteré instrukce typu
<strong>SKIP</strong> s&nbsp;opaènou podmínkou následovanou nepodmínìným
skokem. Ov¹em v&nbsp;nìkterých pøípadech se skok vùbec nemusí provádìt, proto¾e
ona jediná instrukce nacházející se za <strong>SKIP</strong> mù¾e nahradit celý
podmínìný blok (vyslání bitu na externí port, pokud je splnìna nìjaká podmínka,
reset watchdogu atd.). Ve dvanáctibitové instrukèní sadì se nachází následující
instrukce umo¾òující provedení skokù popø.&nbsp;pøeskoèení jedné instrukce:</p>

<table>
<tr><th>Operaèní kód (bin)</th><th>Jméno instrukce</th><th>Struèný popis instrukce</th></tr>
<tr><td>0010 11d fffff</td><td>DECFSZ f,d</td><td>d = f - 1, vynechání následující instrukce pokud je výsledek nula</td></tr>
<tr><td>0011 11d fffff</td><td>INCFSZ f,d</td><td>d = f + 1, vynechání následující instrukce pokud je výsledek nula</td></tr>
<tr><td>0110 bbb fffff</td><td>BTFSC f,b </td><td>Bit test f, vynechání následující instrukce pokud je bit nulový</td></tr>
<tr><td>0111 bbb fffff</td><td>BTFSS f,b </td><td>Bit test f, vynechání následující instrukce pokud je bit jednièkový</td></tr>
<tr><td>1001 kkkkkkkk </td><td>CALL k    </td><td>zavolání podprogramu na adrese k</td></tr>
<tr><td>1000 kkkkkkkk </td><td>RETLW k   </td><td>návrat z&nbsp;podprogramu s&nbsp;nastavením akumulátoru</td></tr>
<tr><td>101 kkkkkkkkk </td><td>GOTO k    </td><td>skok na adresu specifikovanou devíti bity</td></tr>
</table>

<img src="http://i.iinfo.cz/images/197/pc127-12.png" width="268" height="173" alt=" " />
<p><i>Obrázek 12: V&nbsp;nìkterých zaøízeních s&nbsp;mikroøadièi se vyu¾ívají
jednoduché pamì»ové moduly se sériovým pøenosem adres i dat.</i></p>



<p><a name="k07"></a></p>
<h2>7. Seznam instrukcí dvanáctibitové instrukèní sady</h2>

<p>V&nbsp;následující tabulce je vypsána instrukèní sada mikroøadièù <i>PIC</i>
s&nbsp;pamìtí programu organizovanou po dvanácti bitech. Pov¹imnìte si, ¾e
instrukce lze rozdìlit do ètyø kategorií, pøièem¾ instrukce v&nbsp;ka¾dé
kategorii mají jednotný formát. Konkrétními vlastnostmi této instrukèní sady,
napøíklad tím, jak jsou adresovány universální registry, se budeme zabývat
v&nbsp;pøí¹tí èásti tohoto seriálu:</p>

<table>
<tr><th>#</th><th>Operaèní kód</th><th>Jméno instrukce</th><th>Struèný popis instrukce</th></tr>
<tr><td>01</td><td>0000 0000 0000</td><td>NOP       </td><td>neprovede se ¾ádná operace</td></tr>
<tr><td>02</td><td>0000 0000 0010</td><td>OPTION    </td><td>obsah akumulátoru se pøesune do speciálního registru OPTION</td></tr>
<tr><td>03</td><td>0000 0000 0011</td><td>SLEEP     </td><td>pøechod do re¾imu spánku</td></tr>
<tr><td>04</td><td>0000 0000 0100</td><td>CLRWDT    </td><td>reset watchdogu</td></tr>
<tr><td>05</td><td>0000 0000 01ff</td><td>TRIS f    </td><td>zápis akumulátoru na port (f=1..3)</td></tr>
<tr><td>06</td><td>0000 001 fffff</td><td>MOVWF f   </td><td>pøenos akumulátoru to do universálního registru 0-31</td></tr>
<tr><td>07</td><td>0000 010 xxxxx</td><td>CLRW      </td><td>vynulování akumulátoru</td></tr>
<tr><td>08</td><td>0000 011 fffff</td><td>CLRF f    </td><td>vynulování universálního registru 0-31</td></tr>
<tr><td>09</td><td>0000 10d fffff</td><td>SUBWF f,d </td><td>d = f - W</td></tr>
<tr><td>10</td><td>0000 11d fffff</td><td>DECF f,d  </td><td>d = f - 1</td></tr>
<tr><td>11</td><td>0001 00d fffff</td><td>IORWF f,d </td><td>d = f OR W</td></tr>
<tr><td>12</td><td>0001 01d fffff</td><td>ANDWF f,d </td><td>d = f AND W</td></tr>
<tr><td>13</td><td>0001 10d fffff</td><td>XORWF f,d </td><td>d = f XOR W</td></tr>
<tr><td>14</td><td>0001 11d fffff</td><td>ADDWF f,d </td><td>d = f + W</td></tr>
<tr><td>15</td><td>0010 00d fffff</td><td>MOVF f,d  </td><td>d = f</td></tr>
<tr><td>16</td><td>0010 01d fffff</td><td>COMF f,d  </td><td>d = NOT f</td></tr>
<tr><td>17</td><td>0010 10d fffff</td><td>INCF f,d  </td><td>d = f + 1</td></tr>
<tr><td>18</td><td>0010 11d fffff</td><td>DECFSZ f,d</td><td>d = f - 1, vynechání následující instrukce pøi nulovém výsledku</td></tr>
<tr><td>19</td><td>0011 00d fffff</td><td>RRF f,d   </td><td>rotace doprava pøes carry</td></tr>
<tr><td>20</td><td>0011 01d fffff</td><td>RLF f,d   </td><td>rotace doleva pøes carry</td></tr>
<tr><td>21</td><td>0011 10d fffff</td><td>SWAPF f,d </td><td>prohození nibblù universálního registru</td></tr>
<tr><td>22</td><td>0011 11d fffff</td><td>INCFSZ f,d</td><td>d = f + 1, vynechání následující instrukce pøi nulovém výsledku</td></tr>
<tr><td>23</td><td>0100 bbb fffff</td><td>BCF f,b   </td><td>vynulování jednoho bitu universálního registru</td></tr>
<tr><td>24</td><td>0101 bbb fffff</td><td>BSF f,b   </td><td>nastavení (na 1) jednoho bitu universálního registru</td></tr>
<tr><td>25</td><td>0110 bbb fffff</td><td>BTFSC f,b </td><td>Bit test f, vynechání následující instrukce pokud je bit nulový</td></tr>
<tr><td>26</td><td>0111 bbb fffff</td><td>BTFSS f,b </td><td>Bit test f, vynechání následující instrukce pokud je bit jednièkový</td></tr>
<tr><td>27</td><td>1000 kkkkkkkk </td><td>RETLW k   </td><td>návrat z&nbsp;podprogramu s&nbsp;nastavením akumulátoru</td></tr>
<tr><td>28</td><td>1001 kkkkkkkk </td><td>CALL k    </td><td>zavolání podprogramu na adrese k</td></tr>
<tr><td>29</td><td>101 kkkkkkkkk </td><td>GOTO k    </td><td>skok na adresu specifikovanou devíti bity</td></tr>
<tr><td>30</td><td>1100 kkkkkkkk </td><td>MOVLW k   </td><td>W = k</td></tr>
<tr><td>31</td><td>1101 kkkkkkkk </td><td>IORLW k   </td><td>W = k OR W</td></tr>
<tr><td>32</td><td>1110 kkkkkkkk </td><td>ANDLW k   </td><td>W = k AND W</td></tr>
<tr><td>33</td><td>1111 kkkkkkkk </td><td>XORLW k   </td><td>W = k XOR W</td></tr>
</table>



<p><a name="k08"></a></p>
<h2>8. Obsah následující èásti seriálu</h2>

<p>V&nbsp;následující èásti seriálu o architekturách poèítaèù si popí¹eme tøi
øady osmibitových mikroøadièù firmy <i>Microchip Technology</i>. Bude se jednat
o øady <i>PIC10F</i>, <i>PIC12F</i> a pøedev¹ím o velmi populární øadu
<i>PIC16F</i>, která pro mnoho typù zapojení pøedstavuje takøka ideální pomìr
mezi mo¾nostmi tohoto mikroøadièe (rychlosti, kapacity obou pamìtí,
instalovaných modulù) a jeho velikostí (vìt¹inou se jedná o èipy
s&nbsp;osmnácti piny), spotøebou a v&nbsp;neposlední øadì i jeho pøíznivou
cenou. Takté¾ si popí¹eme nìkteré vývojové a simulaèní nástroje, které je mo¾né
pro vývoj aplikací pro mikroøadièe <i>PIC</i> pou¾ít. Zamìøíme se samozøejmì
pøedev¹ím na nástroje ¹íøené ve formì open source, napøíklad na projekt
<i>picasm</i> (assembler pou¾itelný pro vìt¹inu typù mikroøadièù <i>PIC</i>),
<i>gpsim</i> (simulátor tìchto mikroøadièù), <i>gputils</i> (assembler,
disassembler a nìkolik dal¹ích u¾iteèných utilit pro vývoj) a <i>FlashForth</i>
(de facto ucelené vývojové prostøedí a souèasnì i operaèní systém zalo¾ený na
programovacím jazyce Forth).</p>

<a href="http://i.iinfo.cz/images/197/pc127-13.jpg"><img src="http://i.iinfo.cz/images/197/pc127-13-prev.jpg" width="332" height="270" alt=" " /></a>
<p><i>Obrázek 13: Vývojový kit BASIC Stamp ve verzi vybavené rozhraním
universální sériové sbìrnice (USB).</i></p>

<a href="http://i.iinfo.cz/images/692/pc126-14.png"><img src="http://i.iinfo.cz/images/692/pc126-14-prev.png" width="370" height="205" alt=" " /></a>
<p><i>Obrázek 14: Vývojový kit Amicus s&nbsp;mikroøadièem PIC. Tento vývojový
kit byl inspirován kitem Arduino urèeným pro mikroøadièe Atmel AVR.</i></p

<p>Nesmíme takté¾ zapomenout ani na nìkteré zajímavé aplikace, které ve svém
zapojení vyu¾ívají osmibitové mikroøadièe <i>PIC</i>. Jedním z&nbsp;tìchto
zaøízení, které mù¾e být zajímavé napøíklad i z&nbsp;hlediska výuky
programování, je jednoduchá vývojová deska nazvaná <i>BASIC Stamp</i>, její¾
souèástí je jeden z&nbsp;èipù <i>PIC</i> (konkrétní verze závisí na variantì
<i>BASIC Stampu</i>) a takté¾ externí sériová pamì», v&nbsp;ní¾ je ulo¾ený
tokenizovaný BASICový program, jeho¾ délka mù¾e pro variantu s&nbsp;256 bajty
externí pamìti dosahovat cca 80 programových øádkù (viz té¾ obrázek èíslo 13).
Dal¹í verze <i>BASIC Stampu</i> je ji¾ vybavena i rozhraním universální sériové
sbìrnice (<i>USB</i>). Dal¹í zajímavou aplikací s&nbsp;èipy <i>PIC</i> je
vývojový kit <i>Amicus</i> inspirovaný známìj¹ím kitem <i>Arduino</i> urèeným
pro zmìnu pro vývoj s&nbsp;vyu¾itím mikroøadièù <i>Atmel AVR</i>. Nákres
vývojového kitu <i>Amicus</i> je uveden na ètrnáctém obrázku.</p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>Microchip Technology<br />
<a href="http://www.microchip.com/">http://www.microchip.com/</a>
</li>

<li>Výbìr z&nbsp;rùzných modelù mikroøadièù PIC<br />
<a href="http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=2661">http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=2661</a>
</li>

<li>Øada mikroøadièù PIC 10<br />
<a href="http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1009&mid=10&lang=en&pageId=74">http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1009&mid=10&lang=en&pageId=74</a>
</li>

<li>Øada mikroøadièù PIC 12<br />
<a href="http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1001&mid=10&lang=en&pageId=74">http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1001&mid=10&lang=en&pageId=74</a>
</li>

<li>Øada mikroøadièù PIC 14<br />
<a href="http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1008&mid=10&lang=en&pageId=74">http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1008&mid=10&lang=en&pageId=74</a>
</li>

<li>Øada mikroøadièù PIC 16<br />
<a href="http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1002&mid=10&lang=en&pageId=74">http://www.microchip.com/ParamChartSearch/chart.aspx?branchID=1002&mid=10&lang=en&pageId=74</a>
</li>

<li>Dal¹í výbìr z&nbsp;rùzných modelù mikroøadièù PIC<br />
<a href="http://www.microchip.com/maps/microcontroller.aspx">http://www.microchip.com/maps/microcontroller.aspx</a>
</li>

<li>PIC microcontroller (Wikipedia EN)<br />
<a href="http://en.wikipedia.org/wiki/PIC_microcontroller">http://en.wikipedia.org/wiki/PIC_microcontroller</a>
</li>

<li>Mikrokontrolér PIC (Wikipedia CZ)<br />
<a href="http://cs.wikipedia.org/wiki/Mikrokontrolér_PIC">http://cs.wikipedia.org/wiki/Mikrokontrolér_PIC</a>
</li>

<li>FLASHFORTH for the PIC18F and the dsPIC30F<br />
<a href="http://flashforth.sourceforge.net/">http://flashforth.sourceforge.net/</a>
</li>

<li>FlashForth<br />
<a href="http://www.sourceforge.net/projects/flashforth">http://www.sourceforge.net/projects/flashforth</a>
</li>

<li>Free Pic software tools<br />
<a href="http://softwarepic.50webs.com/freesoft.html">http://softwarepic.50webs.com/freesoft.html</a>
</li>

<li>What is Amicus?<br />
<a href="http://www.picbasic.org/proton_lite.php">http://www.picbasic.org/proton_lite.php</a>
</li>

<li>Amicus FAQ<br />
<a href="http://www.myamicus.co.uk/faq.php?s=2e8d12e7f4c23e775776f4916876354b&">http://www.myamicus.co.uk/faq.php?s=2e8d12e7f4c23e775776f4916876354b&</a>
</li>

<li>Microcontrollers development tools<br />
<a href="http://www.gnupic.dds.nl/">http://www.gnupic.dds.nl/</a>
</li>

<li>gpsim (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/Gpsim">http://en.wikipedia.org/wiki/Gpsim</a>
</li>

<li>gpsim home page<br />
<a href="http://gpsim.sourceforge.net/gpsim.html">http://gpsim.sourceforge.net/gpsim.html</a>
</li>

<li>The FreeRTOS Project<br />
<a href="http://www.freertos.org/">http://www.freertos.org/</a>
</li>

<li>FreeRTOS (Wikipedia)<br />
<a href="http://en.wikipedia.org/wiki/FreeRTOS">http://en.wikipedia.org/wiki/FreeRTOS</a>
</li>

<li>Serial EEPROM (93C46 / 93CS46) Routines<br />
<a href="http://www.pjrc.com/tech/8051/serial-eeprom.html">http://www.pjrc.com/tech/8051/serial-eeprom.html</a>
</li>

<li>Great Microprocessors of the Past and Present (V 13.4.0)<br />
<a href="http://jbayko.sasktelwebsite.net/cpu.html">http://jbayko.sasktelwebsite.net/cpu.html</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

