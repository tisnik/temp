<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Hudba a zvuk na PC: PC Speaker, Covox a Adlib</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Hudba a zvuk na PC: PC Speaker, Covox a Adlib</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dne¹ní èásti seriálu o architekturách poèítaèù si popí¹eme skromné zaèátky rozvoje zvukových zaøízení na poèítaèích kompatibilních s IBM PC, tj. PC XT, PC AT, PS-2 atd. Tyto poèítaèe se z kanceláøí postupnì roz¹íøily i do domácností a spoleènì s vývojem her se i pro nì zaèaly vyrábìt rozlièné zvukové karty.</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. Hudba a zvuk na PC: PC Speaker, Covox a Adlib</a><br />
<a href="#k02">2. Prehistorie: PC Speaker</a><br />
<a href="#k03">3. Pøehrávání samplované hudby na PC Speakeru</a><br />
<a href="#k04">4. Pulsní ¹íøková modulace s&nbsp;PC Speakarem</a><br />
<a href="#k05">5. Malá revoluce na PC: zvuková karta Adlib</a><br />
<a href="#k06">6. Princip OPL</a><br />
<a href="#k07">7. Zvukový systém Covox: D/A pøevodník pøipojený na paralelní port</a><br />
<a href="#k08">8. Odkazy na Internetu</a><br />
<a href="#k09">9. Obsah dal¹í èásti seriálu</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. Hudba a zvuk na PC: PC Speaker, Covox a Adlib</h1>

<p>Osmibitové domácí poèítaèe i osobní ¹estnácti- a tøicetidvoubitové poèítaèe
popisované v&nbsp;pøedchozích èástech tohoto seriálu mìly jednu spoleènou
vlastnost &ndash; obsahovaly více èi ménì sofistikovaný èip urèený pro tvorbu
zvukù a hudby. Domácí osmibitové poèítaèe Atari mìly èip <i>POKEY</i>, poèítaèe
Commodore èip <i>SID</i>, v&nbsp;ZX Spectru 128+ a Atari ST byl zabudovaný èip
<i>AY-3-8910</i> (nebo té¾ plnì kompatibilní <i>YM2149</i>), poèítaèe Sharp
pou¾ívaly integrovaný obvod <i>SN76489</i> a koneènì ve slavných osobních
poèítaèích Amiga byl nainstalovaný zvukový èip <i>Paula</i>. Z&nbsp;pohledu
tvorby zvuku byly osobní poèítaèe IBM PC jen chudými pøíbuznými (jak po
zvukové, tak i z&nbsp;velké míry po grafické stránce je pøekonávaly i mnohé
levné osmibitové poèítaèe), proto¾e ve standardních poèítaèových sestavách byl
zvuk vytváøen pouze pomocí takzvaného <i>PC Speakeru</i>, co¾ byl
(resp.&nbsp;doposud je) reproduktor pøipojený pøes jednoduchý zesilovaè na
binární (dvoustavový) výstup èasovaèe tvoøeného obvodem <i>8253</i>,
popø.&nbsp;v&nbsp;pozdìj¹ích poèítaèových sestavách modernìj¹ím obvodem
<i>8254</i>.</p>

<image id="8905" original="no" />
<p-center><i>Obrázek 1: Program FastTracker II doká¾e pøehrávat hudbu ulo¾enou
v&nbsp;modulech jak na PC Speakeru (zde nazývaném IBM Sound Technology :-) èi
zvukovém systému Covox (pojmenovaný jako Soundplayer), tak i na
&bdquo;skuteèných&ldquo; zvukových kartách typu Sound Blaster èi Gravis
Ultrasound. Pøi pøehrávání na PC Speakeru lze zvolit mezi jednobitovou PCM
(pulsní kódovou modulací) èi PWM (pulsní ¹íøkovou modulací) &ndash; viz
zobrazená konfiguraèní obrazovka.</i></p-center>

<p>Zvuk generovaný <i>PC Speakerem</i> má mnoho nedostatkù, zvukový signál
dokonce není ani vyvedený na externí konektor, co¾ bylo minimálnì neobvyklé.
Z&nbsp;tohoto dùvodu se v&nbsp;pozdìj¹í dobì &ndash; spolu s&nbsp;vývojem
kvalitnìj¹ích her &ndash; zaèaly i pro osobní poèítaèe IBM PC objevovat první
zvukové karty urèené buï pro sbìrnici <i>ISA</i> (viz pøedchozí èásti tohoto
seriálu zamìøené na popis interních i externích sbìrnic) nebo jednoduché
digitálnì-analogové pøevodníky zapojené na paralelní port. Dnes si popí¹eme jak
starodávný <i>PC Speaker</i>, u¾ jen z&nbsp;toho dùvodu, ¾e ho velmi
pravdìpodobnì máte i ve svém desktopu :-) &ndash; to je ta vìc, která ohavnì
pípá pøi startu poèítaèe nebo pøi pøeplnìní bufferu klávesnice &ndash;, tak i
ve své dobì oblíbený digitálnì-analogový pøevodník <i>Covox</i> a zvukovou
kartu <i>Adlib</i>. Kromì toho si podrobnìji vysvìtlíme princip pulsní ¹íøkové
modulace pou¾ívané zejména na <i>PC Speakeru</i> pro pøehrávání samplované
hudby, vèetnì hudebních modulù, jimi¾ jsme se zabývali v&nbsp;pøedchozí èásti
tohoto seriálu.</p>

<image id="8906" original="no" />
<p-center><i>Obrázek 2: Po heslem &bdquo;v¹echno je lep¹í ne¾ PC-Speaker&ldquo;
se v&nbsp;domácích podmínkách stavìly jednoduché D/A pøevodníky zapojované do
paralelního portu, kterým byly vybaveny takøka v¹echny osobní poèítaèe
kompatibilní s&nbsp;IBM PC. Tyto pøevodníky se souhrnnì nazývaly Covox, i kdy¾
zpùsoby jejich konkrétního zapojení se navzájem li¹ily.</i></p-center>



<p><a name="k02"></a></p>
<h1>2. Prehistorie: PC Speaker</h1>

<p>V¹echny osobní poèítaèe IBM PC pùvodnì obsahovaly jako jediný zdroj zvuku a
&bdquo;hudby&ldquo; <i>PC Speaker</i>. Ten je tvoøen, jak jsme si ji¾ ostatnì
øekli v&nbsp;úvodní kapitole, reproduktorem pøipojeným na jednoduchý zesilovaè,
jeho¾ vstup je pøipojen na èítaè/èasovaè <i>8253</i> nebo <i>8254</i>
(v&nbsp;moderních PC ji¾ není èasovaè tvoøen samostatným èipem, ale je souèástí
èipové sady základní desky, vìt¹inou southbridge). Èasovaè <i>8253</i> obsahuje
tøi samostatnì nastavovatelné ¹estnáctibitové kanály, pøièem¾ pro generování
zvuku je pou¾it kanál tøetí, který je doposud namapován na I/O port 0x42. Tøetí
kanál èasovaèe <i>8253</i> vìt¹inou pracuje v&nbsp;re¾imu generátoru
obdélníkových pulsù se støídou 1:1. Na vstup èasovaèe je pøipojen hodinový
signál s&nbsp;frekvencí 1193180 Hz, co¾ je tøetina nominální frekvence IBM XT,
tj.&nbsp;4,77 MHz. Tento signál je dìlen nastavenou ¹estnáctibitovou hodnotou,
tj.&nbsp;minimální frekvence zvuku vytváøená èítaèem/èasovaèem je rovna 18,2 Hz
(1193180/65536) a maximální frekvence dosahuje úrovnì ultrazvuku (otázkou
samozøejmì je, jaká je mezní frekvence samotného reproduktoru).</p>

<image id="8907" />
<p-center><i>Obrázek 3: Slavná hra Duna II, která pøi pøehrávání zvukù a hudby
podporovala jak PC Speaker, tak i zvukovou kartu Adlib, Adlib Gold a Sound
Blaster.</i></p-center>



<p><a name="k03"></a></p>
<h1>3. Pøehrávání samplované hudby na PC Speakeru</h1>

<p>S&nbsp;vyu¾itím èítaèe/èasovaèe <i>8253</i> je mo¾né na <i>PC Speaker</i>
posílat pravidelný obdélníkový signál, co¾ postaèuje pouze pro pøehrávání velmi
jednoduchých jednohlasých melodií. V&nbsp;pøípadì po¾adavku na pøehrání
samplované hudby èi slo¾itìj¹ích zvukù (vèetnì napodobení hudebních nástrojù èi
mluveného slova) se proto na PC Speakeru vyu¾ívala pulsní ¹íøková modulace,
neboli <i>PWM</i>. Na I/O portu 0x61 se nachází øídicí registr druhé osmibitové
brány (B) obvodu <i>8255</i>. Nultým bitem lze nastavit stav øídicího signálu
(GATE) èasovaèe <i>8253</i>. Pokud je tento bit nulový, èítaè/èasovaè je
pozastaven a tím pádem na reproduktor neposílá ¾ádný signál. První bit I/O
portu 0x61 v&nbsp;tomto pøípadì pøímo øídí binární výstup, na nìj¾ je pøipojen
reproduktor. To znamená, ¾e programovou zmìnou prvního bitu portu 0x61 lze
generovat dvoustavový signál posílaný na reproduktor, nezávisle na èítaèi.
Pøehrávací rutina je vìt¹inou napojena na pøeru¹ení od èasovaèe (mù¾e být
pou¾it i jeho tøetí kanál, nebo» ten je pøi této konfiguraci odpojen od
reproduktoru), jeho¾ frekvence musí být nìkolikanásobnì vìt¹í, ne¾ pùvodní
vzorkovací frekvence pøehrávaných samplù. Pøi dobrém èasování lze na PC
Speakeru pomocí <i>PWM</i> pøehrávat cca pìti èi ¹estibitové samply, co¾
odpovídá dynamickému rozsahu 30 resp. 36 dB (pøipomeòme, ¾e CD-Audio má
dynamický rozsah 96 dB).</p>

<image id="8908" />
<p-center><i>Obrázek 4: Pulsní ¹íøková modulace sinusové vlny (èervená barva),
která je porovnávána s&nbsp;referenèním trojúhelníkovým signálem (modrá barva).
Výsledný binární signál je zobrazen ¾lutou barvou.</i></p-center>



<p><a name="k04"></a></p>
<h1>4. Pulsní ¹íøková modulace s&nbsp;PC Speakarem</h1>

<p>Na obrázcích 4 a¾ 8 je naznaèen jeden ze zpùsobù pøevodu analogového signálu
(popø.&nbsp;i signálu navzorkovaného) na signál binární (dvoustavový) pomocí
pulsní ¹íøkové modulace. Princip je jednoduchý &ndash; pùvodní analogový signál
je kontinuálnì porovnáván s&nbsp;trojúhelníkovým signálem o vy¹¹í frekvenci,
jeho¾ amplituda je shodná s&nbsp;amplitudou (resp.&nbsp;maximální absolutní
hodnotou) pùvodního analogového signálu. V&nbsp;pøípadì, ¾e je aktuální hodnota
pùvodního modulovaného signálu vy¹¹í, ne¾ je hodnota trojúhelníkového
referenèního signálu, je na výstupu vysoká úroveò (vìt¹inou kladné napìtí),
v&nbsp;opaèném pøípadì nízká úroveò (záporné napìtí o stejné absolutní
hodnotì). Pokud je pulsní ¹íøková modulace implementována v&nbsp;elektronickém
obvodu, jsou oba signály porovnávány pomocí operaèního zesilovaèe, na nìj¾ je
zapojený Schmittùv klopný obvod, který zajistí kolmost hran výsledného
binárního signálu. Programová implementace je zalo¾ena na výpoètu referenèního
signálu v&nbsp;diskrétních krocích a jeho jednoduchém porovnání
s&nbsp;pùvodními vzorky.</p>

<image id="8909" />
<p-center><i>Obrázek 5: Pulsní ¹íøková modulace &ndash; frekvence referenèního
trojúhelníkového signálu je dvojnásobná oproti signálu zobrazeném na ètvrtém
obrázku, výstup by v¹ak stále nebyl (pøi pøehrání na reproduktoru) dostateènì
kvalitní.</i></p-center>

<p>Aby byl výsledek <i>PWM</i> kvalitní, je nutné, aby frekvence
trojúhelníkového referenèního signálu byla mnohonásobnì vy¹¹í, ne¾ frekvence
signálu vstupního. V&nbsp;pøípadì, ¾e se pomocí PWM pøevádí navzorkovaný
(digitální) zvuk s&nbsp;urèitou vzorkovací frekvencí, je vhodné, aby frekvence
referenèního signálu byla minimálnì 10&times; vy¹¹í ne¾ frekvence vzorkovací,
co¾ ov¹em klade vy¹¹í nároky na pøesnost èasování pøi pøehrávání zvuku (tato
situace zhruba odpovídá ¹estému obrázku). Pokud byl napøíklad pùvodní zvuk
navzorkován s&nbsp;frekvencí 22 kHz, co¾ odpovídá spí¹e men¹í kvalitì (ztrácí
se vy¹¹í sly¹itelné frekvence), tak by se mìla PWM provádìt s&nbsp;frekvencí
220 kHz, tj.&nbsp;pøi programové implementaci by se mìla pøeru¹ovací rutina
volat 220000&times; za sekundu. Kdy¾ uvá¾íme, ¾e tato rutina musí pøed vlastní
<i>PWM</i> provést i mixá¾ v¹ech zvukových kanálù, zjistíme, ¾e na pùvodních
IBM PC (a dokonce i modelech XT a AT) bylo pøehrávání tak nároèné, ¾e ho nebylo
mo¾né pou¾ít pøímo ve hrách (tam nejvíce èasu zabralo pøepoèítání obrázkù,
proto¾e grafické karty CGA/EGA/Hercules prakticky ¾ádnou podporu programátorùm
nenabízely), ale pouze na úvodních obrazovkách èi specializovaných pøehrávaèích
(napøíklad <i>Visual Player</i> èi <i>Mod Player</i> &ndash; ty pracovaly i
na ¹estnáctibitových mikroprocesorech).</p>

<image id="8910" />
<p-center><i>Obrázek 6: Pulsní ¹íøková modulace &ndash; frekvence referenèního
trojúhelníkového signálu je dvojnásobná oproti signálu zobrazeném na pátém
obrázku.</i></p-center>

<p>V&nbsp;pøípadì, ¾e má být signál modulovaný pomocí <i>PWM</i> pøehráván
pomocí reproduktoru, je nutné dodr¾et nìkolik podmínek, které v¹ak u pùvodního
<i>PC Speakeru</i> nebyly v¹echny splnìny. Vhodné je, aby vy¹¹í úroveò byla
reprezentována kladným napìtím urèité hodnoty a ni¾¹í úroveò záporným napìtím o
stejné absolutní hodnotì. Tím je zaji¹tìno optimální vyu¾ití výkonu
reproduktoru, proto¾e se jeho membrána mù¾e z&nbsp;klidové polohy vychylovat na
obì strany. U pùvodního <i>PC-Speakeru</i> sice byla vy¹¹í úroveò
reprezentována kladným napìtím, ale ni¾¹í úroveò byla rovna 0V,
tj.&nbsp;membrána reproduktoru se vychylovala pouze jedním smìrem. Tím se
vlastnì výkon reproduktoru sní¾il, co¾ sice nevadí pøi bì¾ném
&bdquo;pípání&ldquo; (spí¹e naopak), ale samplovaná hudba byla z&nbsp;tohoto
dùvodu pøehrávána pomìrnì potichu. Dále je vhodné, aby byl pøed reproduktorem
zapojen integraèní RC èlánek, který dvoustavový signál zrekonstruuje do pùvodní
analogové podoby (samozøejmì s&nbsp;vìt¹í èi men¹í chybou, v&nbsp;závislosti na
provedení <i>PWM</i>). Tato podmínka takté¾ nebyla u pùvodního <i>PC
Speakeru</i> splnìna, co¾ nemuselo být kritické, proto¾e ji¾ samotný
reproduktor (obsahující cívku) urèitou integraci vstupního signálu
provádìl.</p>

<image id="8911" />
<p-center><i>Obrázek 7: Na tomto grafu je frekvence referenèní trojúhelníkové
vlny cca 10&times; vy¹¹í, ne¾ frekvence pøevádìného signálu, co¾ je ji¾ pro
mnoho aplikací dostateèné.</i></p-center>

<p>Problém v¹ak nastal u pozdìj¹ích osobních poèítaèù, zejména laptopù, ve
kterých se mnohdy pùvodní reproduktory (s&nbsp;cívkou) zaèaly nahrazovat
piezoelektrickými rezonátory, známými napøíklad z&nbsp;digitálních hodinek. Tam
ji¾ k&nbsp;integraci dvoustavového signálu nedocházelo, tak¾e se
v&nbsp;pøehrávané hudbì zaèalo objevovat ne¾ádoucí pískání, pøedev¹ím tehdy,
pokud byla pulsní ¹íøková modulace provádìna s&nbsp;ni¾¹í frekvencí. Zajímavé
je, ¾e v¹echny zmínìné nevýhody <i>PC Speakeru</i> bylo mo¾né obejít vyu¾itím
sériového portu RS-232C, na nìj¾ bylo mo¾né pøipojit napì»ový dìliè s&nbsp;RC
èlánkem a výstup vést buï do zesilovaèe nebo pøímo reproduktoru &ndash; toto
velmi jednoduché øe¹ení se v¹ak, pokud vím, nikdy neujalo. Pro pøedstavu, jakou
hudbu bylo mo¾né s&nbsp;<i>PC Speakerem</i> vytvoøit, si poslechnìte
následující dva odkazy. Pod <a
href="http://www.crossfire-designs.de/download/articles/soundcards/speaker_mushroom_converted.mp3">prvním
odkazem</a> najdete pùvodní skladbu zdigitalizovanou moderním A/D pøevodníkem,
pod <a
href="http://www.crossfire-designs.de/download/articles/soundcards/speaker_mushroom_speaker.mp3">odkazem
druhým</a> je tatá¾ skladba pøehrávaná <i>PC Speakerem</i> v&nbsp;DOSovém demu
nazvaném <i>Magic Mushroom</i>. Podotýkám, ¾e na vìt¹inì tehdej¹ích PCèek byla
skladba pøehrávaná v&nbsp;hor¹í kvalitì, zejména byla mnohem ti¹¹í, co¾ si
majitelé starých PC mohou odzkou¹et &ndash; <a
href="http://www.crossfire-designs.de/download/articles/soundcards//mushroom.rar">http://www.crossfire-designs.de/download/articles/soundcards//mushroom.rar</a>
(pozor &ndash; v&nbsp;DOSboxu není výsledek autentický).</p>

<image id="8912" />
<p-center><i>Obrázek 8: Dal¹í zdvojnásobení frekvence referenèní trojúhelníkové
vlny. Výsledný graf je ji¾ èásteènì zkreslen vlivem pøevodu pùvodních
analogových prùbìhù do rastrového obrázku (ji¾ se pøibli¾ujeme k&nbsp;hranici,
pøi ní¾ vzniká obrazový alias).</i></p-center>



<p><a name="k05"></a></p>
<h1>5. Malá revoluce na PC: zvuková karta Adlib</h1>

<p>V&nbsp;roce 1988 zalo¾it Martin Prevel v&nbsp;Quebecu firmu <i>Adlib</i>
zamìøenou na vývoj periferních zaøízení pro tehdy ji¾ notnì roz¹íøené osobní
poèítaèe kompatibilní s&nbsp;IBM PC. Jedním z&nbsp;prvních zaøízení &ndash; a
nutno øíci, ¾e také nejúspì¹nìj¹ích &ndash; byla zvuková karta <i>Adlib</i>
postavená na èipu <i>YM3812</i> (oznaèovaném také jako <i>OPL2</i>) vyrábìném
firmou <i>Yamaha</i>. <i>Yamaha</i>, která se na hudební syntézu zalo¾enou na
fázové èi frekvenèní modulaci specializovala, pùvodnì tento èip dodávala pouze
firmì <i>Adlib</i>, pozdìji v¹ak firma Microsoft (!) po¾ádala, aby se tyto èipy
nabízely i dal¹ím výrobcùm periferních zaøízení. Výsledek na sebe nenechal
dlouho èekat &ndash; jednou z&nbsp;prvních firem, které zaèaly èip
<i>YM3812</i> pou¾ívat ve svých zvukových kartách, byla <i>Creative
Technology</i> se svými kartami <i>Sound Blaster</i>. Na jednu stranu to sice
znamenalo, ¾e se <i>Adlib</i> stal ve své dobì de facto standardem pro syntézu
hudby (karty Sound Blaster s&nbsp;ním byly zpìtnì kompatibilní), ale samozøejmì
se také jednalo o konkurenci, která po nìkolika letech dovedla firmu
<i>Adlib</i> ke krachu, proto¾e nedokázala konkurovat relativnì levným Sound
Blasterùm (které vlastnì ve¹kerou funkcionalitu <i>Adlibu</i> obsahovaly) a
zvukovým kartám Pro Audio Spectrum.</p>

<image id="8913" />
<p-center><i>Obrázek 9: Zvuková karta Adlib urèená do osmibitové varianty
sbìrnice ISA (PC BUS).</i></p-center>

<p>Nicménì zvuková karta <i>Adlib</i> je oprávnìnì pova¾ována za mezník ve
vývoji osobních poèítaèù kompatibilních s&nbsp;IBM PC, proto¾e umo¾nila
relativnì snadnou tvorbu hudby s&nbsp;velmi malými nároky na výpoèetní výkon
pou¾itého mikroprocesoru (Adlib bylo mo¾né pou¾ít i v&nbsp;IBM XT) i nepatrnými
nároky na po¾adovanou kapacitu operaèní pamìti &ndash; øádovì se jednalo o
stovky bajtù na pøehrávací rutinu a nìkolik kilobajtù pro mnohaminutovou
skladbu. Pomìrnì brzy po vzniku prvních her, které èip <i>OPL2</i> zabudovaný
v&nbsp;<i>Adlibu</i> pou¾ívaly, se zaèaly objevovat i aplikace umo¾òující
tvorbu tónù napodobujících rùzné hudební nástroje (kolekce tìchto tónù se
nazývaly <i>banky</i>, soubory s&nbsp;banky byly v&nbsp;rùzných formátech
dostupné jak komerènì, tak i cestou freeware) i programy pro tvorbu hudby,
které byly v&nbsp;mnoha ohledech podobné <i>trackerùm</i> popsaných
v&nbsp;pøedchozí èásti tohoto seriálu. Nìkteré trackery, napøíklad <i>Scream
Tracker</i>, dokonce pozdìji umo¾òovaly kombinovat hudbu pro èip <i>OPL2</i> se
samplovanými zvuky. Bli¾¹í informace o <i>OPL2</i> i aplikacích pro nìj si
povíme v&nbsp;navazující èásti seriálu.</p>

<image id="8914" />
<p-center><i>Obrázek 10: Sanxion &ndash; program obsahující nìkolik skladeb pro
zvukové karty obsahující èip OPL2. Podobné programy nazývané musicdisky, které
kromì hudby vìt¹inou obsahovaly i grafické efekty, byly vytváøeny mnoha
demoskupinami.</i></p-center>



<p><a name="k06"></a></p>
<h1>6. Princip OPL</h1>

<p>V&nbsp;pøedchozí kapitole jsme si øekli, ¾e zvuková karta <i>Adlib</i> je
postavena na èipu <i>YM3812</i> neboli <i>OPL2</i> (zajímavé je, ¾e se jedná o
plnì digitální èip, ve své podstatì o jednoduchý signálový procesor doplnìný o
pamì» ROM, ve které jsou ulo¾eny vzorky první ètvrtiny periody sinusového
signálu). Oznaèení <i>OPL2</i> vzniklo ze zkratky <i>Operator Type L2</i>, co¾
v&nbsp;pojetí firmy <i>Yamaha</i> znamená, ¾e zvuk v&nbsp;ka¾dém hudebním
kanálu mù¾e být vytvoøen pomocí dvou <i>operátorù</i>, které mohou být
propojeny tak, jak je ukázáno na následujícím obrázku &ndash; buï se jedná o
aditivní syntézu (oba signály jsou jednodu¹e seèteny) nebo o fázovou modulaci
(<i>PM</i>), s&nbsp;volitelnou zpìtnou vazbou (v&nbsp;materiálech firmy
<i>Yamaha</i> se sice pí¹e, ¾e je pou¾ita frekvenèní modulace, ve skuteènosti
se v¹ak jedná o modulaci fázovou, i kdy¾ praktické rozdíly pøi generování zvuku
nejsou velké). Ka¾dý <i>operátor</i> je slo¾en ze tøí blokù &ndash; oscilátoru
(generátoru periodického signálu), generátoru obálky (<i>envelope</i>) a obvodu
pro øízení výstupní úrovnì.</p>

<image id="8915" />
<p-center><i>Obrázek 11: Zpùsob zapojení dvojice operátorù v&nbsp;jednom
hudebním kanálu v&nbsp;èipu OPL2.</i></p-center>

<p>Ka¾dý oscilátor mù¾e generovat periodický signál odvozený od klasické
sinusovky, její¾ podoba je ulo¾ena v&nbsp;ROM pøímo na hudebním èipu. V¹echny
ètyøi varianty signálu jsou zobrazeny na dal¹ím obrázku. Celkem je mo¾né vyu¾ít
osmnáct operátorù zapojených buï do devíti melodických hudebních kanálù (v¾dy
dvojice operátorù tvoøí jeden melodický hudební kanál) nebo do ¹esti
melodických kanálù (ka¾dý obsahuje dva operátory) a souèasnì pìti kanálù
pou¾itých pro bicí nástroje. Navíc jsou na èipu <i>OPL2</i> umístìny dva
èasovaèe s&nbsp;cyklem 80&micro;s a 320&micro;s, které mohou pøi správném
pøipojení obvodu na sbìrnici generovat pøeru¹ení, ale na pùvodní kartì
<i>Adlib</i> není pøeru¹ovací linka zapojena (mo¾ná z&nbsp;toho dùvodu, ¾e
pùvodní IBM PC i XT mìlo pouze osm zdrojù pøeru¹ení a ne 15, jak je tomu na
AT). Ov¹em pøíznak pøeteèení èasovaèù lze i bez pou¾ití pøeru¹ení pøeèíst
z&nbsp;øídicích registrù, co¾ je vlastnost vyu¾ívaná pøi automatické detekci
pøítomnosti této karty na sbìrnici ISA èi PC BUS &ndash; éra pøídavných karet
s&nbsp;podporou &bdquo;plug and play&ldquo; toti¾ zaèala a¾ o zhruba deset let
pozdìji. Podrobnìj¹í informace o funkcích èipu <i>OPL2</i> budou uvedeny
v&nbsp;následující èásti tohoto seriálu.</p>

<image id="8916" />
<p-center><i>Obrázek 12: Èip OPL2 umo¾òuje pro ka¾dý operátor pou¾ít jeden ze
ètyø tvarù vlny zalo¾ený na sinusovce o volitelné frekvenci.</i></p-center>



<p><a name="k07"></a></p>
<h1>7. Zvukový systém Covox: D/A pøevodník pøipojený na paralelní port</h1>

<p>Zvukové zaøízení <i>Covox Speech Thing</i>, jen¾ je známé spí¹e pod svým
zkráceným názvem <i>Covox</i>, bylo ve druhé polovinì devadesátých letech
minulého století pomìrnì populární, pøedev¹ím díky tomu, ¾e ho bylo velmi
snadné vyrobit i v&nbsp;domácích podmínkách. Ve své podstatì se jednalo o velmi
jednoduchý osmibitový digitálnì-analogový pøevodník (<i>DAC &ndash; Digital to
Audio Converter</i>) pøipojený na paralelní port. Pùvodní <i>Covox Speech
Thing</i> byl vyrábìný firmou <i>Covox Tympanum Corporation</i>, ov¹em jeho
cena byla velmi vysoká &ndash; celých 70 tehdej¹ích dolarù, co¾ odpovídá cca 80
souèasným dolarùm. Ov¹em vzhledem k&nbsp;tomu, ¾e digitálnì-analogový pøevodník
byl sestaven pouze z&nbsp;25pinového konektoru DB-25, nìkolika rezistorù a
jednoho kondenzátoru (bez zesilovaèe, proto¾e <i>Covox</i> se bì¾nì pøipojoval
do aktivních reproduktorových soustav), bylo ho mo¾né sestavit doslova za pár
korun. Existuje nìkolik variant systému <i>Covox</i>, z&nbsp;nich¾
nejjednodu¹¹í obsahuje pouze devìt rezistorù a jeden kondenzátor &ndash; viz
ní¾e zobrazené schéma:</p>

<image id="8917" original="no" />
<p-center><i>Obrázek 13: Jedno z&nbsp;nejjednodu¹¹ích zapojení Covoxu, které
ov¹em vy¾aduje pomìrnì pøesné hodnoty odporù &ndash; odpor ka¾dého rezistoru
pøipojeného na datový pin paralelního portu by mìl být ideálnì dvojnásobný
oproti rezistoru pøedchozímu.</i></p-center>

<p>Pùvodní <i>Covox</i> se pøipojoval vìt¹inou na první paralelní port, který
je pøístupný na I/O adrese 0x378 &ndash; viz èást tohoto seriálu, kde jsme si
princip paralelního portu pomìrnì podrobnì popsali. Data se na paralelní port
pøená¹í programovì, tj.&nbsp;vìt¹inou v&nbsp;pøeru¹ovací rutinì napojené na
èasovaè. Teoreticky je mo¾né pou¾ít jakoukoli vzorkovací frekvenci,
v&nbsp;praxi se ustálily bì¾né hodnoty 11025 Hz, 22050 Hz a 44100 Hz.
Existovaly i vylep¹ené varianty <i>Covoxu</i>, napøíklad <i>Disney Sound
Source</i> obsahoval vlastní zdroj pøeru¹ení. Nìkdy se také vyu¾ívaly rùzné
podoby zapojení <i>Covoxu</i> pro stereo výstup. Kromì velmi primitivních podob
(napøíklad pro ka¾dý kanál se vyu¾ily pouhé ètyøi bity nebo se pou¾ily dva
paralelní porty) se ujalo zapojení s&nbsp;dvojicí D/A pøevodníkù pøipojených na
výstupy dvou záchytných osmibitových registrù (postaèovaly obvody øady 7400,
proto¾e paralelní port je kompatibilní s&nbsp;TTL). Datové piny paralelního
portu byly zapojeny na vstupy obou tìchto registrù, volba levého èi pravého
kanálu se provádìla dal¹ím samostatnì ovládaným signálem, napøíklad
<i>Strobe</i>.</p>

<image id="8918" original="no" />
<p-center><i>Obrázek 14: Dal¹í zpùsob zapojení Covoxu, kde jsou vy¾adovány
pouze rezistory dvou typù. Vzhledem k&nbsp;vìt¹ímu proudovému zatí¾ení datových
pinù je vhodnìj¹í pou¾ít cca dvojnásobné hodnoty odporu ne¾ ty, které jsou
uvedeny na obrázku (zde je pin s&nbsp;nejni¾¹ím bitem zatì¾ován proudem 3,3 mA,
vhodnìj¹í je maximální proud omezit na cca 2 mA).</i></p-center>



<p><a name="k08"></a></p>
<h1>8. Odkazy na Internetu</h1>

<ol>

<li>Powering devices from PC parallel port<br />
<a href="http://www.epanorama.net/circuits/lptpower.html">http://www.epanorama.net/circuits/lptpower.html</a>
</li>

<li>Magic Mushroom (demo pro PC s DOSem)<br />
<a href="http://www.crossfire-designs.de/download/articles/soundcards//mushroom.rar">http://www.crossfire-designs.de/download/articles/soundcards//mushroom.rar</a>
</li>

<li>Píseò Magic Mushroom - originál<br />
<a href="http://www.crossfire-designs.de/download/articles/soundcards/speaker_mushroom_converted.mp3">http://www.crossfire-designs.de/download/articles/soundcards/speaker_mushroom_converted.mp3</a>
</li>

<li>Píseò Magic Mushroom - hráno na PC Speakeru<br />
<a href="http://www.crossfire-designs.de/download/articles/soundcards/speaker_mushroom_speaker.mp3">http://www.crossfire-designs.de/download/articles/soundcards/speaker_mushroom_speaker.mp3</a>
</li>

<li>Pulse Width Modulation (PWM) Simulation Example<br />
<a href="http://decibel.ni.com/content/docs/DOC-4599">http://decibel.ni.com/content/docs/DOC-4599</a>
</li>

<li>Resistor/Pulse Width Modulation DAC<br />
<a href="http://www.k9spud.com/traxmod/pwmdac.php">http://www.k9spud.com/traxmod/pwmdac.php</a>
</li>

<li>Class D Amplifier<br />
<a href="http://en.wikipedia.org/wiki/Electronic_amplifier#Class_D">http://en.wikipedia.org/wiki/Electronic_amplifier#Class_D</a>
</li>

<li>Covox Speech Thing / Disney Sound Source (1986)<br />
<a href="http://www.crossfire-designs.de/index.php?lang=en&amp;what=articles&amp;name=showarticle.htm&amp;article=soundcards/&amp;page=5">http://www.crossfire-designs.de/index.php?lang=en&amp;what=articles&amp;name=showarticle.htm&amp;article=soundcards/&amp;page=5</a>
</li>

<li>Covox Digital-Analog Converter (Rusky, obsahuje schémata)<br />
<a href="http://phantom.sannata.ru/konkurs/netskater002.shtml">http://phantom.sannata.ru/konkurs/netskater002.shtml</a>
</li>

<li>Wikipedia EN: PC speaker<br />
<a href="http://en.wikipedia.org/wiki/PC_speaker">http://en.wikipedia.org/wiki/PC_speaker</a>
</li>

<li>Wikipedia EN: Intel 8253<br />
<a href="http://en.wikipedia.org/wiki/Intel_8253">http://en.wikipedia.org/wiki/Intel_8253</a>
</li>

<li>Wikipedia EN: Intel 8255<br />
<a href="http://en.wikipedia.org/wiki/Intel_8255">http://en.wikipedia.org/wiki/Intel_8255</a>
</li>

<li>Wikipedia EN: Covox Speech Thing<br />
<a href="http://en.wikipedia.org/wiki/Disney_Sound_Source">http://en.wikipedia.org/wiki/Disney_Sound_Source</a>
</li>

<li>Memory mapped I/O<br />
<a href="http://www.sharpmz.org/mz-700/memio.htm">http://www.sharpmz.org/mz-700/memio.htm</a>
</li>

<li>Using an 8255 PPI chip<br />
<a href="http://drew.hickmans.net/8255.htm">http://drew.hickmans.net/8255.htm</a>
</li>

<li>Aktivní Covox (D/A pøevodník na paralelní port)<br />
<a href="http://rayer.ic.cz/elektro/covox.htm">http://rayer.ic.cz/elektro/covox.htm</a>
</li>

<li>Programming the PC Speaker<br />
<a href="http://www.gamedev.net/reference/articles/article442.asp">http://www.gamedev.net/reference/articles/article442.asp</a>
</li>

</ol>

<image id="8919" original="no" />
<p-center><i>Obrázek 15: Kompaktní verze Covoxu.</i></p-center>



<p><a name="k09"></a></p>
<h1>9. Obsah dal¹í èásti seriálu</h1>

<p>V&nbsp;následující èásti tohoto seriálu si podrobnìji popí¹eme, jakým
zpùsobem je mo¾né vytváøet hudbu s&nbsp;vyu¾itím zvukového èipu <i>Yamaha
YM3812</i>, známého té¾ pod oznaèením <i>OPL2</i>, a takté¾ pomocí èipu
<i>Yamaha YMF262</i>, neboli <i>OPL3</i>. Tyto digitální zvukové èipy byly
pou¾ity v&nbsp;mnoha zvukových kartách pro osobní poèítaèe, vèetnì dnes popsané
karty <i>Adlib</i> (pozdìji i <i>Adlib Gold</i>, <i>Sound Blaster</i> atd.), a
jejich do znaèné míry charakteristický zvuk je dodnes napodobován napøíklad
v&nbsp;nìkterých intrech (krat¹í dema).</p>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2009</small></p>
</body>
</html>

