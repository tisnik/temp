<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Programovací jazyk Scheme v&nbsp;praxi: psaní skriptù pro grafický editor GIMP</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Programovací jazyk Scheme v&nbsp;praxi: psaní skriptù pro grafický editor GIMP</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Ve ètvrté èásti èlánku o programovacím jazyce Scheme si uká¾eme jedno z mo¾ných praktických vyu¾ití tohoto jazyka. Scheme toti¾ bylo zvoleno jako skriptovací jazyk ve známém grafickém editoru GIMP. V dne¹ní dobì ji¾ existuje velké mno¾ství dostupných skriptù roz¹iøujících funkcionalitu GIMPu &ndash; od pomìrnì jednoduchých filtrù pøes rùzné pomocné utility (tvorba animací) a¾ po rozsáhlé skripty, které napøíklad doká¾ou pracovat s èásticovými systémy apod.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Grafický editor GIMP a programovací jazyk Scheme</a></p>
<p><a href="#k02">2. Základní typy objektù v&nbsp;GIMPu</a></p>
<p><a href="#k03">3. Interaktivní konzole jazyka Scheme</a></p>
<p><a href="#k04">4. Vytvoøení nového obrázku</a></p>
<p><a href="#k05">5. Pøidání hladiny do vytvoøeného obrázku</a></p>
<p><a href="#k06">6. Modifikace jednotlivých pixelù v&nbsp;obrázku</a></p>
<p><a href="#k07">7. První demonstraèní pøíklad &ndash; nový obrázek s&nbsp;RGB paletou</a></p>
<p><a href="#k08">8. Druhý demonstraèní pøíklad &ndash; vykreslení Lissajousových obrazcù</a></p>
<p><a href="#k09">9. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2>1. Grafický editor GIMP a programovací jazyk Scheme</h2>

<p>Rastrový grafický editor <i>GIMP</i> pravdìpodobnì není nutné ètenáøùm
serveru <a href="http://www.root.cz">Root.cz</a> nijak podrobnìji pøedstavovat.
Jedná se o známou aplikaci, kterou je mo¾né pou¾ít pro tvorbu rastrových
obrázkù s&nbsp;vyu¾itím velkého mno¾ství kreslicích, editaèních a retu¹ovacích
nástrojù (k&nbsp;dispozici jsou napøíklad nástroje typu &bdquo;tu¾ka&ldquo;,
&bdquo;¹tìtec&ldquo;, &bdquo;razítko&ldquo; èi &bdquo;rozpra¹ovaè&ldquo;),
úpravy fotografií (rozmazání oblasti, zaostøení oblasti, klonování, barevná
korekce), tvorbu jednoduchých animací, klikacích map urèených pro webové
stránky atd. Podobnì jako v&nbsp;mnohých dal¹ích vyspìlých grafických
editorech, existuje i v&nbsp;<i>GIMPu</i> mo¾nost práce s&nbsp;vrstvami
(<i>layers</i>), kanály (<i>channels</i>), cestami (<i>paths</i> &ndash;
s&nbsp;vyu¾itím cest lze provádìt i nìkteré jednoduché operace známé napøíklad
z&nbsp;grafických editorù pracujících s&nbsp;vektorovými výkresy) a výbìrovými
oblastmi (<i>selections</i>), které lze takté¾ pou¾ít pro kreslení slo¾itìj¹ích
geometrických obrazcù (výbìr lze pøevést na cestu nebo pøímo vykreslit zvoleným
kreslicím nástrojem).</p>

<img src="http://i.iinfo.cz/images/554/scheme4-1.png" width="339" height="412" alt=" " />
<p><i>Obrázek 1: Dvojice demonstraèních pøíkladù uvedených v&nbsp;dne¹ním
èlánku byla odladìna v&nbsp;GIMPu verze 2.4.5....</i></p>

<p>Ov¹em jednou z&nbsp;nejzajímavìj¹ích a takté¾ neju¾iteènìj¹ích vlastností
tohoto grafického editoru je jeho aplikaèní programové rozhraní (API)
zpøístupòující programátorùm prakticky ve¹kerou funkcionalitu <i>GIMPu</i> a
takté¾ podpora pro skriptování, pøièem¾ skripty mají pøístup k&nbsp;API,
nezávisle na tom, ve kterém programovacím jazyce byly vytvoøeny. Pùvodnì se
v&nbsp;<i>GIMPu</i> mohly psát skripty pouze v&nbsp;programovacím jazyce
<i>Scheme</i> (pro tyto skripty se pou¾ívá název <i>Script-Fu</i>), ov¹em
v&nbsp;souèasnosti existuje podpora i pro populární programovací jazyk
<i>Python</i>, který mimochodem nìkteré své vlastnosti pøevzal právì ze
<i>Scheme</i> a <i>LISPu</i>. V&nbsp;následujících kapitolách si øekneme, jakým
zpùsobem mohou skripty napsané v&nbsp;jazyce <i>Scheme</i> vytváøet nové
obrázky a provádìt nad nimi základní grafické operace &ndash; kreslení na
úrovni jednotlivých pixelù a takté¾ kreslení s&nbsp;vyu¾itím ji¾ existujících
kreslicích nástrojù, zejména tu¾ky (<i>pen</i>), ¹tìtce (<i>brush</i>) èi
rozpra¹ovaèe (<i>airbrush</i>).</p>

<img src="http://i.iinfo.cz/images/554/scheme4-2.png" width="389" height="395" alt=" " />
<p><i>Obrázek 2: ... a také ve verzi 2.6.8.</i></p>



<p><a name="k02"></a></p>
<h2>2. Základní typy objektù v&nbsp;GIMPu</h2>

<p>Programátor mù¾e pøi tvorbì skriptù urèených pro grafický editor <i>GIMP</i>
pou¾ívat ¹irokou paletu objektù spravovaných samotným editorem. Mnohé
z&nbsp;tìchto objektù jsou dostupné i u¾ivatelùm z&nbsp;grafického
u¾ivatelského rozhraní editoru, kde je s&nbsp;nimi mo¾né rùzným zpùsobem
manipulovat. Jedná se pøedev¹ím o samotné obrázky, dále pak hladiny umis»ované
do obrázkù (kreslení je provádìno do hladin), kanály, tu¾ky, ¹tìtce, barvové
palety, výbìry atd. Skripty psané v&nbsp;jazyce <i>Scheme</i> mohou buï pøi
svém bìhu vytvoøit objekty nové, co¾ napøíklad mù¾e vést ke skuteènému
vytvoøení nového obrázku, pøidání hladiny do obrázku atd., nebo mohou pomocí
rozlièných dotazovacích funkcí získat nìkterý z&nbsp;ji¾ existujících objektù.
Napøíklad skript, který má vykreslit nìjaký objekt do aktivního obrázku, musí
získat identifikátor tohoto obrázku (v¾dy se jedná o celé èíslo, proto¾e API
<i>GIMPu</i> je pomìrnì nízkoúrovòové), následnì identifikátor hladiny a teprve
poté je mo¾né provést po¾adovanou èinnost.</p>

<a href="http://i.iinfo.cz/images/554/scheme4-3.png"><img src="http://i.iinfo.cz/images/554/scheme4-3-prev.png" width="292" height="270" alt=" " /></a>
<p><i>Obrázek 3: Spu¹tìní interaktivní konzole jazyka Scheme z&nbsp;grafického
editoru GIMP verze 2.4.5.</i></p>



<p><a name="k03"></a></p>
<h2>3. Interaktivní konzole jazyka Scheme</h2>

<p>Pro základní seznámení s&nbsp;aplikaèním programovým rozhraním grafického
editoru <i>GIMP</i> je mo¾né pou¾ít interaktivní konzoli jazyka <i>Scheme</i>,
z&nbsp;ní¾ lze spou¹tìt (pøesnìji øeèeno vyhodnocovat) výrazy <i>Scheme</i>,
definovat nové funkce a promìnné, volat funkce API atd. Ka¾dý výraz zapsaný do
vstupního øádku interaktivní konzole je pøedán interpretru jazyka
<i>Scheme</i>, který výraz zpracuje a do textového pole umístìného nad vstupním
øádkem vypí¹e jeho návratovou hodnotu (popø.&nbsp;chybové hlá¹ení).
V&nbsp;mnoha pøípadech, zejména pøi kreslení do obrázku, je mnohem dùle¾itìj¹í
vedlej¹í efekt volané funkce èi funkcí ne¾ jejich návratová hodnota. Jak je
mo¾né interaktivní konzoli interpretru jazyka <i>Scheme</i> spustit, je
naznaèeno na tøetím a ètvrtém obrázku. Rozdíl mezi obìma screenshoty je
zpùsobem tím, ¾e u <i>GIMPu</i> verze 2.6 ji¾ není hlavní menu umístìné
v&nbsp;oknì nástrojù, ale pøímo v&nbsp;oknì s&nbsp;otevøeným obrázkem, co¾ mù¾e
být výhodné, proto¾e nìkteøí u¾ivatelé mají ve zvyku si pøi kreslení klávesou
<i>Tab</i> vypínat v¹echna &bdquo;zbyteèná&ldquo; okna a dialogy.</p>

<a href="http://i.iinfo.cz/images/554/scheme4-4.png"><img src="http://i.iinfo.cz/images/554/scheme4-4-prev.png" width="308" height="270" alt=" " /></a>
<p><i>Obrázek 4: Spu¹tìní interaktivní konzole jazyka Scheme z&nbsp;grafického
editoru GIMP verze 2.6.8.</i></p>

<p>V&nbsp;interaktivní konzoli interpretru jazyka <i>Scheme</i> lze tlaèítkem
<i>Procházet/Browse</i> spustit velmi u¾iteèný nástroj &ndash; prohlí¾eè
procedur. V&nbsp;tomto nástroji je mo¾né vyhledávat v¹echny procedury
pou¾itelné jak interaktivnì (tj.&nbsp;pøímo z&nbsp;okna konzole), tak i ze
skriptù &ndash; jedná se jak o procedury nabízené samotným <i>GIMPem</i>, tak i
procedury definované v&nbsp;externích souborech (skriptech), vèetnì skriptù
ulo¾ených v&nbsp;domácím adresáøi u¾ivatelù (vìt¹inou se jedná o adresáø
<i>~/.gimp-verze/scripts</i>). Procedury je mo¾né vyhledávat podle jejich jména
(nejenom prefixu, co¾ je dùle¾ité, proto¾e vìt¹ina interních procedur zaèíná
prefixem <i>gimp-</i>, který není nutné pøi vyhledávání zapisovat), autora,
typu atd. U nalezené procedury se zobrazí její popis, vèetnì seznamu a významu
v¹ech jejích parametrù. S&nbsp;vyu¾itím interaktivní konzole a prohlí¾eèe
procedur je mo¾né psát skripty pomìrnì rychle, vèetnì mo¾nosti jejich
okam¾itého testování.</p>

<a href="http://i.iinfo.cz/images/554/scheme4-5.png"><img src="http://i.iinfo.cz/images/554/scheme4-5-prev.png" width="257" height="270" alt=" " /></a>
<p><i>Obrázek 5: Konzole Script-Fu, do které lze zapisovat a interaktivnì
spou¹tìt (vyhodnocovat) výrazy jazyka Scheme.</i></p>



<p><a name="k04"></a></p>
<h2>4. Vytvoøení nového obrázku</h2>

<p>Zkusme si nyní ukázat, jakým zpùsobem se pou¾ívají nìkteré základní funkce
dostupné pøes aplikaèní programové rozhraní grafického editoru <i>GIMP</i>.
Uká¾eme si vytvoøení nového obrázku a pøidání jedné hladiny (<i>layer</i>) do
obrázku. Tuto operaci je nutné provést, proto¾e do obrázku bez hladiny není
mo¾né provádìt ¾ádné vykreslování. Pro vytvoøení nového obrázku se pou¾ívá
funkce nazvaná <strong>gimp-image-new</strong> jejími¾ parametry jsou rozmìry
obrázku a jeho typ, tj.&nbsp;symbol urèující, zda se jedná o obrázek
v&nbsp;barvovém prostoru RGB, obrázek ve stupních ¹edi (GRAYSCALE) atd. Tato
funkce vrací, mo¾ná ponìkud pøekvapivì, <i>seznam</i>, jeho¾ prvním prvkem je
celé èíslo, které pøedstavuje identifikátor obrázku. Toto èíslo, které je pro
daný typ objektu jedineèné, se pou¾ívá pøi ka¾dé dal¹í manipulaci
s&nbsp;obrázkem. Obrázek le¾ící v&nbsp;barvovém prostoru RGB, jeho¾ rozmìry
mají být 320&times;240 pixelù, se vytvoøí následujícím pøíkazem:</p>

<pre>
(gimp-image-new 320 320 RGB)
</pre>

<p>Pokud je tento pøíkaz zapsaný do vstupního øádku interaktivní konzoly,
vypí¹e po svém spu¹tìní, stejnì jako jakýkoli jiný pøíkaz, návratovou hodnotu,
napøíklad:</p>

<pre>
(1)
</pre>

<p>Skuteèná vrácená hodnota, tj.&nbsp;identifikátor obrázku, se mù¾e pøi ka¾dém
spu¹tìní pøíkazu li¹it, co¾ znamená, ¾e pøi va¹ich pokusech mù¾ete získat jiné
èíslo. Vidíme, ¾e funkce <strong>gimp-new-image</strong> skuteènì vrátila
jednoprvkový seznam, proto¾e èíselná hodnota je vypsaná v&nbsp;kulatých
závorkách. Ve skriptech se identifikátor obrázku z&nbsp;vráceného seznamu
získává napøíklad funkcí <i>car</i>. Vytvoøený obrázek je prozatím neviditelný
(<i>GIMP</i> pro nìj toti¾ neotevøel nové okno), ov¹em to se dá jednodu¹e
napravit zavoláním funkce <strong>gimp-display-new</strong>, jí¾ se pøedá
identifikátor obrázku (co¾ je jednièka nebo jiná hodnota vrácená funkcí
<strong>gimp-image-new</strong>):</p>

<pre>
(gimp-display-new 1)
</pre>

<a href="http://i.iinfo.cz/images/554/scheme4-6.png"><img src="http://i.iinfo.cz/images/554/scheme4-6-prev.png" width="370" height="197" alt=" " /></a>
<p><i>Obrázek 6: Prohlí¾eè procedur je velmi u¾iteèný nástroj, ve kterém se
mohou vyhledávat jak systémové, tak i u¾ivatelské funkce (procedury).</i></p>



<p><a name="k05"></a></p>
<h2>5. Pøidání hladiny do vytvoøeného obrázku</h2>

<p>Obrázek ji¾ máme vytvoøený, zbývá nám v¹ak je¹tì minimálnì jeden úkol
&ndash; vytvoøit novou hladinu a pøidat tuto hladinu do na¹eho obrázku. Nová
hladina se zkonstruuje pomocí funkce <strong>gimp-layer-new</strong> a pøidání
hladiny do obrázku zajistí funkce <strong>gimp-image-add-layer</strong>. Pøi
tvorbì hladiny je zapotøebí specifikovat obrázek, pro nìj¾ je hladina
vytváøena, její rozmìry (mohou se li¹it od rozmìrù obrázku, ve kterém hladina
le¾í), typ hladiny (RGB, RGB s&nbsp;alfa kanálem atd.), jméno hladiny (to uvidí
u¾ivatel v&nbsp;dialogu urèeném pro práci s&nbsp;hladinami), její prùhlednost a
takté¾ re¾im, který udává, jak jsou hodnoty jednotlivých pixelù zkombinovány
s&nbsp;hodnotami pixelù v&nbsp;ní¾e le¾ících hladinách. Nejprve tedy vytvoøíme
novou hladinu se stejnými rozmìry, jaké má obrázek. Hladina bude neprùhledná
(100% neprùhlednost), re¾im pøekreslení normální (zde to nehraje velkou roli,
proto¾e se jedná o první hladinu v&nbsp;obrázku, pod ní¾ ji¾ nic nele¾í):</p>

<pre>
(gimp-layer-new 1 320 240 RGB-IMAGE "layer-1" 100 NORMAL-MODE)
(2)
</pre>

<p>Vidíme, ¾e funkce <strong>gimp-layer-new</strong> opìt vrátila èíslo ulo¾ené
v&nbsp;jednoprvkovém seznamu. Jedná se o identifikátor hladiny, který vyu¾ijeme
v&nbsp;dal¹ím pøíkazu. Následnì je toti¾ nutné hladinu pomocí funkce
<strong>gimp-image-add-layer</strong> vlo¾it na zásobník hladin. Pro ka¾dý
obrázek existuje zásobník s&nbsp;jednotlivými hladinami, do nìho¾ je mo¾né
pøidávat dal¹í hladiny, mìnit jejich poøadí atd. Pokud se jako index hladiny
pøedá konstanta -1, bude nová hladina le¾et nad v¹emi ostatními hladinami.
V&nbsp;následujícím pøíkazu se pøedávají dva celoèíselné identifikátory:
<strong>1</strong> znaèí identifikátor obrázku, <strong>2</strong>
identifikátor hladiny (znovu pøipomínám, ¾e pøi Va¹ich pokusech se
pravdìpodobnì budou oba identifikátory li¹it):</p>

<pre>
(gimp-image-add-layer 1 2 -1)
(#t)
</pre>

<p>Nyní by mìl být obrázek pøipraven na dal¹í pokusy.</p>

<img src="http://i.iinfo.cz/images/554/scheme4-7.png" width="256" height="256" alt=" " />
<p><i>Obrázek 7: Výsledek èinnosti pomìrnì jednoduchého skriptu, který nejprve
na náhodných pozicích vykreslil nìkolik hvìzd (modifikací barev jednotlivých
pixelù, tj.&nbsp;pomocí funkce vysvìtlené v&nbsp;následující kapitole) a
posléze pou¾il Gaussovy filtry na jejich rozmazání.</i></p>



<p><a name="k06"></a></p>
<h2>6. Modifikace jednotlivých pixelù v&nbsp;obrázku</h2>

<p>Dal¹í funkcí dostupnou pøes aplikaèní programové rozhraní grafického editoru
<i>GIMP</i>, se kterou se v&nbsp;dne¹ním èlánku seznámíme, je funkce nazvaná
<strong>gimp-drawable-set-pixel</strong>. Tato funkce je urèena pro zmìnu barvy
pixelu objektù, které se souhrnnì nazývají <i>drawable</i>
(&bdquo;pokreslitelné&ldquo;). Jedná se o masky, kanály a vrstvy &ndash; do
v¹ech tøí typù objektù je mo¾né kreslit na té nejni¾¹í úrovni tím zpùsobem, ¾e
se mìní barvy jednotlivých pixelù. Funkce
<strong>gimp-drawable-set-pixel</strong> vy¾aduje pøi svém volání pøedání pìti
parametrù &ndash; objektu, jeho¾ pixel se má zmìnit (v&nbsp;na¹em pøípadì se
bude jednat o hladinu s&nbsp;identifikátorem <strong>2</strong>), x-ovou a
y-ovou souøadnici pixelu, poèet mìnìných kanálù (v&nbsp;pøípadì barvového
prostoru RGB se jedná o tøi kanály) a jako poslední parametr se pøedává pole
obsahující trojici bajtù (opìt v&nbsp;pøípadì barvového prostoru RGB), kde
ka¾dý bajt odpovídá jedné barvové slo¾ce modelu RGB. Pro vytvoøení tohoto pole
lze pou¾ít napøíklad následující výraz:</p>

<pre>
(cons-array 3 'byte)
</pre>

<p>Pokud je pole vytvoøeno pomocí pøedchozího pøíkazu a pøiøazeno napøíklad
promìnné nazvané <i>color</i>, mohou se jednotlivé bajty (prvky) pole nastavit
pomocí speciální formy <strong>aset</strong> (array set), které se pøedává
promìnná typu pole, index nastavovaného prvku a jeho nová hodnota:</p>

<pre>
(aset color 0 r)
(aset color 1 g)
(aset color 2 b)
</pre>

<p>Zmìna barvy pixelu na hladinì s&nbsp;identifikátorem <strong>2</strong> (viz
<a href="#k05">pøedchozí kapitolu</a>), jeho¾ souøadnice jsou [10, 20], se
provede následovnì:</p>

<pre>
(gimp-drawable-set-pixel 2 10 20 3 color)
</pre>

<a href="http://i.iinfo.cz/images/554/scheme4-8.png"><img src="http://i.iinfo.cz/images/554/scheme4-8-prev.png" width="370" height="177" alt=" " /></a>
<p><i>Obrázek 8: První demonstraèní pøíklad/skript, jen¾ je popsaný
v&nbsp;následující kapitole, po svém spu¹tìní.</i></p>



<p><a name="k07"></a></p>
<h2>7. První demonstraèní pøíklad &ndash; nový obrázek s&nbsp;RGB paletou</h2>

<p>Znalosti, které jsme se dozvìdìli v&nbsp;pøedchozích pìti kapitolách, si
mù¾eme ihned odzkou¹et na pomìrnì jednoduchém demonstraèním pøíkladu. Zdrojový
kód pøíkladu, který naleznete na konci této kapitoly, je nutné ulo¾it do
souboru s&nbsp;pøíponou <i>.scm</i> a zkopírovat do adresáøe
<i>~/.gimp-2.x/scripts</i> (za <i>n</i> je nutné dosadit èíslo aktuálnì
nainstalované podverze grafického editoru <i>GIMP</i>). Posléze je mo¾né
spustit grafický editor <i>GIMP</i> a po jeho spu¹tìní zvolit z&nbsp;menu
pøíkaz <i>Script-Fu/Obnovit Skripty (Refresh Scripts)</i>. Po zvolení tohoto
pøíkazu zaène <i>GIMP</i> hledat a naèítat skripty ze systémového adresáøe i
z&nbsp;adresáøe u¾ivatelského. Po naètení skriptù se v¹echny skripty vypí¹ou
v&nbsp;menu rozdìleném do skupin, odkud je lze vybrat a následnì spustit.
Nìkteré skripty vy¾adují, aby byly spu¹tìny nad otevøeným obrázkem, jiné ho
naopak vytvoøí samy, co¾ je i ná¹ pøípad (skripty, které se mají spou¹tìt nad
vytvoøeným obrázkem jsou v&nbsp;menu zakázané nebo zcela neviditelné
v&nbsp;pøípadì, ¾e ¾ádný obrázek není otevøen).</p>

<img src="http://i.iinfo.cz/images/554/scheme4-9.png" width="365" height="417" alt=" " />
<p><i>Obrázek 9: Výsledek bìhu prvního demonstraèního pøíkladu.</i></p>

<p>Ná¹ demonstraèní skript se po své registraci <i>GIMPem</i> nachází
v&nbsp;menu <i>Script-Fu/Patterns</i> pod názvem <i>RGB colors</i>. Po výbìru
skriptu z&nbsp;menu se otevøe dialog s&nbsp;mo¾ností zadání rozmìrù nového
obrázku. Vhodné hodnoty jsou napøíklad 128&times;128 pixelù nebo 256&times;256
pixelù, nebo» u vìt¹ích obrázkù trvá jejich vykreslení pomìrnì dlouho. Jakmile
jsou rozmìry obrázku zadány, skript vytvoøí nový plnobarevný (<i>truecolor</i>)
obrázek, v&nbsp;nìm zaregistruje jedinou hladinu pojmenovanou "Hladina-1" a do
této hladiny vykreslí RGB paletu (obdélník s&nbsp;postupnou zmìnou barvových
slo¾ek R, G a B). Vybarvení obrázku je provedeno tak, ¾e se ve dvojici
vnoøených smyèek se prochází v¹emi pixely obrázku (pøesnìji øeèeno v¹emi pixely
hladiny, proto¾e hladiny mohou mít obecnì jiné rozmìry ne¾ samotný obrázek) a
ka¾dý pixel je obarven na základì své x-ové a y-ové pozice v&nbsp;hladinì.
Pov¹imnìte si, ¾e pøed provádìním jakýchkoli slo¾itìj¹ích operací je zakázáno
ukládání tìchto operací do zásobníku, ve kterém si <i>GIMP</i> pamatuje
pøedchozí stavy obrázku. Dùvod je jednoduchý &ndash; urychlení bìhu skriptu,
které mù¾e být v&nbsp;tomto pøípadì dosti výrazné.</p>

<a href="http://i.iinfo.cz/images/554/scheme4-10.png"><img src="http://i.iinfo.cz/images/554/scheme4-10-prev.png" width="370" height="197" alt=" " /></a>
<p><i>Obrázek 10: Vytvoøený skript byl zaregistrován v&nbsp;GIMPu a jeho popis
se zobrazuje v&nbsp;prohlí¾eèi procedur.</i></p>

<p>Následuje slíbený výpis zdrojového kódu prvního demonstraèního pøíkladu:</p>

<pre>
; Funkce, která vytvoøí nový obrázek o zadané velikosti.
; V obrázku bude jedna hladina nazvaná "Hladina-1" a
; v této hladinì bude vykreslena RGB paleta.
(define (script-fu-rgb-colors width height)
    ; definice lokálních promìnných
    (let*
        (
            ; vytvoøení nového obrázku, jeho¾ ID se ulo¾í
            ; do promìnné nazvané "image"
            (image (car (gimp-image-new width height RGB)))
            ; vytvoøení nové hladiny, její¾ ID se ulo¾í
            ; do promìnné nazvané "layer"
            (layer (car (gimp-layer-new image width height RGB-IMAGE "Hladina-1" 100 NORMAL-MODE)))
            ; poèitadla smyèek
            (x 0)
            (y 0)
            ; pole s ulo¾enými RGB hodnotami pixelu
            (pixel (cons-array 3 'byte))
        )

        ; zákaz ukládání operací do zásobníku
        (gimp-image-undo-disable image)
        ; pøidání hladiny do vytvoøeného obrázku
        (gimp-image-add-layer image layer 0)

        ; zmìna barvy popøedí a pozadí
        (gimp-palette-set-foreground '(255 255 255))
        (gimp-context-set-background '(0 0 0))

        ; vyplnìní hladiny konstantní barvou
        (gimp-drawable-fill layer 1)  ;0 FG, 1 BG

        ; vnìj¹í smyèka pro v¹echny øádky obrázku
        (while (&lt; y height)
          ; nastavit poèitadlo vnitøní smyèky
          (set! x 0)
          ; vnitøní smyèka pro v¹echny pixely le¾ící na øádku
          (while (&lt; x width)
              (aset pixel 0 (* 256 (/ x width)))
              (aset pixel 1 (* 256 (/ y height)))
              (aset pixel 2 (* 256 (+ (/ x width) (/ y height))))
              ; vykreslení pixelu
              (gimp-drawable-set-pixel layer x y 3 pixel)
              ; zvý¹it hodnotu poèitadla vnitøní smyèky
              (set! x (+ x 1))
          )
          ; zvý¹it hodnotu poèitadla vnìj¹í smyèky
          (set! y (+ y 1))
        ) ; end of loop

        ; zobrazení právì vytvoøeného obrázku
        (gimp-display-new image)

        ; povolení ukládání operací do zásobníku
        (gimp-image-undo-enable image)
    )
)

; Registrace skriptu do prostøedí grafického editoru GIMP
; a specifikace promìnných nastavitelných u¾ivatelem,
; které se posléze pøenesou jako parametry skriptu.
(script-fu-register "script-fu-rgb-colors"
                    "&lt;Toolbox&gt;/Xtns/Script-Fu/Patterns/RGB colors"
                    "Vytvori obrazek s RGB paletou."
                    "Pavel Tisnovsky"
                    "Pavel Tisnovsky"
                    "2010.05.04"
                    ""
                    SF-ADJUSTMENT "Image width"  '(256 16 8192 16 64 0 1)
                    SF-ADJUSTMENT "Image height" '(256 16 8192 16 64 0 1)
)

; finito
</pre>

<img src="http://i.iinfo.cz/images/554/scheme4-11.png" width="310" height="495" alt=" " />
<p><i>Obrázek 11: Vý¹e uvedený skript pracuje korektnì i pro obrázky
s&nbsp;jinými rozmìry.</i></p>



<p><a name="k08"></a></p>
<h2>8. Druhý demonstraèní pøíklad &ndash; vykreslení Lissajousových obrazcù</h2>

<p>Kreslení na úrovni jednotlivých pixelù, které bylo ukázáno
v&nbsp;pøedchozích kapitolách, není typickou operací, kterou skripty urèené pro
grafický editor <i>GIMP</i> provádí. Mnohem èastìji se mù¾eme setkat se
skripty, které kreslí pomocí nástrojù dostupných samotným u¾ivatelùm
<i>GIMPu</i>, co¾ je samozøejmì mnohem zajímavìj¹í a u¾iteènìj¹í, nebo» tyto
nástroje jsou plnì konfigurovatelné, a to jak programovì (pøímo ze spu¹tìného
skriptu), tak i z&nbsp;grafického u¾ivatelského rozhraní <i>GIMPu</i>. Právì
tuto mo¾nost si uká¾eme v&nbsp;dne¹ním druhém demonstraèním pøíkladu,
v&nbsp;nìm¾ je pøedvedeno, jakým zpùsobem je mo¾né kreslit do ji¾ vytvoøeného
obrázku pomocí tu¾ky (kreslicí nástroj <i>pencil</i>) popø.&nbsp;¹tìtce
(kreslicí nástroj <i>brush</i>) nebo rozpra¹ovaèe (kreslicí nástroj
<i>airbrush</i>).</p>

<a href="http://i.iinfo.cz/images/554/scheme4-12.png"><img src="http://i.iinfo.cz/images/554/scheme4-12-prev.png" width="332" height="270" alt=" " /></a>
<p><i>Obrázek 12: Výsledek bìhu druhého demonstraèního pøíkladu pøi kreslení
tu¾kou (pencil).</i></p>

<p>Pro kreslení tu¾kou lze pou¾ít funkci <strong>gimp-pencil</strong>, pro
kresbu ¹tìtcem funkci <strong>gimp-paintbrush</strong>. Pøi volání tìchto
funkcí se pøedávají rùzné parametry, pøedev¹ím hladina, do ní¾ se má
vykreslování provést, poèet bodù tvoøících vrcholy polyèáry a poté vektor (zde
je my¹lena stejnì pojmenovaná datová struktura, nikoli geometrický vektor),
v&nbsp;nìm¾ jsou ulo¾eny x-ové a y-ové souøadnice vrcholù polyèáry. Navíc se
pøi kreslení ¹tìtcem pøedávají dal¹í parametry: kreslicí metoda (zda se barva
pøi kreslení na stejné místo slévá èi nikoli), délka barevného pøechodu
(<i>gradient</i>) a míra zeslabení pøi kresbì tlustým ¹tìtcem. Pokud tyto
parametry nepotøebujeme  èi nechceme zadávat, lze namísto funkce
<strong>gimp-paintbrush</strong> volat funkci
<strong>gimp-paintbrush-default</strong>.</p>

<a href="http://i.iinfo.cz/images/554/scheme4-13.png"><img src="http://i.iinfo.cz/images/554/scheme4-13-prev.png" width="239" height="270" alt=" " /></a>
<p><i>Obrázek 13: Výsledek bìhu druhého demonstraèního pøíkladu pøi malování
¹tìtcem (brush).</i></p>

<p>Druhý demonstraèní pøíklad po svém spu¹tìní zobrazí formuláø, do kterého je
mo¾né zadat základní parametry takzvaných <i>Lissajousových obrazcù</i> (které
jsou mj.&nbsp;vyu¾ívané napøíklad pøi mìøení rùzných parametrù signálù pomocí
osciloskopù). Jedná se o støed obrazce, polomìr obrazce v&nbsp;obou osách a
také dvojici parametrù, které urèují násobky základní frekvence. Tyto parametry
ovlivòují tvar obrazce; pro soumìrné tvary je napøíklad zajímavé pou¾ít dvojici
malých nesoudìlných celých èísel (2:3, 3:4, 3:5, 5:7 apod.). Pøi vykreslování
obrazce je pou¾it aktuálnì nastavený nástroj tu¾ka nebo ¹tìtec, pøièem¾
pøepínání mezi tìmito dvìma nástroji se pro jednoduchost provádí
zapoznámkováním jednoho z&nbsp;programových øádkù v&nbsp;oblasti omezené znaky
#######. Pov¹imnìte si takté¾ zpùsobu, jakým je do skriptu pøedán identifikátor
aktuálního obrázku a hladiny. Touto problematikou se budeme v&nbsp;pøípadì
zájmu vìnovat v&nbsp;následující èásti seriálu. Následuje výpis zdrojového
textu druhého demonstraèního pøíkladu, který se po zaregistrování <i>GIMPem</i>
(viz pøedchozí kapitoly) objeví v&nbsp;menu <i>Filtry
(Filters)/Decor/Lissajous</i>:</p>

<pre>
; Funkce, která do existujícího obrázku vykreslí
; Lissajousùv obrazec buï vybranou tu¾kou nebo ¹tìtcem.
(define (script-fu-draw-lissajous selected-image selected-layer cx cy rx ry dx dy)
    ; definice lokálních promìnných
    (let*
        (
            ; vykreslovaná úseèka je pøedstavována vektorem
            ; (vektorem je zde my¹lena datová struktura Scheme)
            (segment (make-vector 4 ))
            ; poèet prvkù vektoru
            (npoint 4)
            (alfa 0)
            (beta 0)
            ; 2xPi
            (full-circle (* 3.1415927 2))
            ; poèet vykreslených segmentù
            (step (/ full-circle 200))
        )
        (gimp-undo-push-group-start selected-image)
        ; programová smyèka, v ní¾ se vykreslí úseèkové segmenty
        ; ze kterých se skládá aproximace Lissajousovy køivky
        (while (&lt;= alfa full-circle)
            (set! beta (+ alfa step))
            ; výpoèet poèáteèní a koncové souøadnice úseèky
            (vector-set! segment 0 (+ cx (* rx (cos (* alfa dx )) )))
            (vector-set! segment 1 (+ cy (* ry (cos (* alfa dy )) )))
            (vector-set! segment 2 (+ cx (* rx (cos (* beta dx )) )))
            (vector-set! segment 3 (+ cy (* ry (cos (* beta dy )) )))

            ; na tomto místì je mo¾né vybrat buï kreslení
            ; tu¾kou (pencil) nebo ¹tìtcem (brush)
            ; #######
            ;(gimp-pencil selected-layer npoint segment )
            (gimp-paintbrush selected-layer 100 npoint segment 0 10)
            ; #######

            ; pøinutíme GIMP, aby obrázek vykreslil
            (gimp-displays-flush)
            (set! alfa beta)
        )
        ; ulo¾íme stav obrázku na zásobník
        (gimp-undo-push-group-end selected-image) 
    )
    ; naposledy pøinutíme GIMP, aby obrázek vykreslil
    ; po jeho dokonèení
    (gimp-displays-flush)  
)

; Registrace skriptu do prostøedí grafického editoru GIMP
; a specifikace promìnných nastavitelných u¾ivatelem,
; které se posléze pøenesou jako parametry skriptu.
(script-fu-register "script-fu-draw-lissajous"
                    _"&lt;Image&gt;/Filters/Decor/Lissajous"
                    "Vykresli Lissajousuv obrazec na zaklade zadanych parametru"
                    "Pavel Tisnovsky"
                    "Pavel Tisnovsky"
                    "2010-05-04"
                    "RGB* GRAY* INDEXED*"
                    SF-IMAGE "The Image" 0
                    SF-DRAWABLE "The Layer" 0
                    SF-ADJUSTMENT "X center" '(200 0 999 1 10 0 1)
                    SF-ADJUSTMENT "Y center" '(200 0 999 1 10 0 1)
                    SF-ADJUSTMENT "X radius" '(160 0 999 1 10 0 1)
                    SF-ADJUSTMENT "Y radius" '(160 0 999 1 10 0 1)
                    SF-ADJUSTMENT "Xd" '(2 0 10 1 10 0 1)
                    SF-ADJUSTMENT "Yd" '(3 0 10 1 10 0 1)
)

; finito
</pre>

<a href="http://i.iinfo.cz/images/554/scheme4-14.png"><img src="http://i.iinfo.cz/images/554/scheme4-14-prev.png" width="370" height="197" alt=" " /></a>
<p><i>Obrázek 14: Skript se opìt korektnì zaregistroval v&nbsp;grafickém
editoru GIMP a jeho popis je dostupný v&nbsp;prohlí¾eèi procedur.</i></p>



<p><a name="k09"></a></p>
<h2>9. Odkazy na Internetu</h2>

<ol>

<li>A Script-Fu Tutorial<br />
<a href="http://www.linuxtopia.org/online_books/graphics_tools/gimp_user_manual/en/gimp-using-script-fu-tutorial.html">http://www.linuxtopia.org/online_books/graphics_tools/gimp_user_manual/en/gimp-using-script-fu-tutorial.html</a>
</li>

<li>A Script-Fu Tutorial<br />
<a href="http://docs.gimp.org/en/gimp-using-script-fu-tutorial.html">http://docs.gimp.org/en/gimp-using-script-fu-tutorial.html</a>
</li>

<li>Script-fu Tutorial<br />
<a href="http://www.seul.org/~grumbel/gimp/script-fu/script-fu-tut.html">http://www.seul.org/~grumbel/gimp/script-fu/script-fu-tut.html</a>
</li>

<li>Lambda calculus<br />
<a href="http://en.wikipedia.org/wiki/Lambda_calculus">http://en.wikipedia.org/wiki/Lambda_calculus</a>
</li>

<li>A Short Introduction to the Lambda Calculus<br />
<a href="http://www.cs.bham.ac.uk/~axj/pub/papers/lambda-calculus.pdf">http://www.cs.bham.ac.uk/~axj/pub/papers/lambda-calculus.pdf</a>
</li>

<li>A Tutorial Introduction to the Lambda Calculus<br />
<a href="http://www.inf.fu-berlin.de/lehre/WS03/alpi/lambda.pdf">http://www.inf.fu-berlin.de/lehre/WS03/alpi/lambda.pdf</a>
</li>

<li>(welcome '(schemers . org))<br />
<a href="http://www.schemers.org/">http://www.schemers.org/</a>
</li>

<li>Revised<sup>5</sup> Report on the Algorithmic Language Scheme<br />
<a href="http://www.schemers.org/Documents/Standards/R5RS/">http://www.schemers.org/Documents/Standards/R5RS/</a>
</li>

<li>The Revised<sup>6</sup> Report on the Algorithmic Language Scheme<br />
<a href="http://www.r6rs.org/">http://www.r6rs.org/</a>
</li>

<li>Scheme<br />
<a href="http://groups.csail.mit.edu/mac/projects/scheme/">http://groups.csail.mit.edu/mac/projects/scheme/</a>
</li>

<li>The Kawa language framework<br />
<a href="http://www.gnu.org/software/kawa/">http://www.gnu.org/software/kawa/</a>
</li>

<li>Scheme 48<br />
<a href="http://s48.org/">http://s48.org/</a>
</li>

<li>Introductory textbooks for Schemers<br />
<a href="http://www.schemers.org/Documents/#intro-texts">http://www.schemers.org/Documents/#intro-texts</a>
</li>

<li>Scheme (programming language)<br />
<a href="http://en.wikipedia.org/wiki/Scheme_(programming_language)">http://en.wikipedia.org/wiki/Scheme_(programming_language)</a>
</li>

<li>Scheme<br />
<a href="http://cs.wikipedia.org/wiki/Scheme">http://cs.wikipedia.org/wiki/Scheme</a>
</li>

<li>Scheme-faq<br />
<a href="http://community.schemewiki.org/?scheme-faq">http://community.schemewiki.org/?scheme-faq</a>
</li>

<li>Scheme implementations<br />
<a href="http://community.schemewiki.org/?scheme-faq-standards#implementations">http://community.schemewiki.org/?scheme-faq-standards#implementations</a>
</li>

<li>Successful Scheme<br />
<a href="http://www.itworld.com/swol-1013-regex">http://www.itworld.com/swol-1013-regex</a>
</li>

<li>Guy L. Steele, Jr.<br />
<a href="http://en.wikipedia.org/wiki/Guy_L._Steele">http://en.wikipedia.org/wiki/Guy_L._Steele</a>
</li>

<li>Gerald Jay Sussman<br />
<a href="http://en.wikipedia.org/wiki/Gerald_Jay_Sussman">http://en.wikipedia.org/wiki/Gerald_Jay_Sussman</a>
</li>

<li>PLT Scheme<br />
<a href="http://www.plt-scheme.org/">http://www.plt-scheme.org/</a>
</li>

<li>Quick: An Introduction to PLT Scheme with Pictures<br />
<a href="http://docs.plt-scheme.org/quick/">http://docs.plt-scheme.org/quick/</a>
</li>

<li>PLT Scheme<br />
<a href="http://en.wikipedia.org/wiki/Plt_scheme">http://en.wikipedia.org/wiki/Plt_scheme</a>
</li>

<li>PLT Scheme Guide<br />
<a href="http://docs.plt-scheme.org/guide/">http://docs.plt-scheme.org/guide/</a>
</li>

<li>The DrScheme Project: An Overview<br />
<a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.9543">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.9543</a>
</li>

<li>DrScheme<br />
<a href="http://en.wikipedia.org/wiki/DrScheme">http://en.wikipedia.org/wiki/DrScheme</a>
</li>

<li>How to Design Programs<br />
<a href="http://www.htdp.org/">http://www.htdp.org/</a>
</li>

<li>An Introduction to Scheme<br />
<a href="http://www.acm.org/crossroads/xrds1-2/scheme.html">http://www.acm.org/crossroads/xrds1-2/scheme.html</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2010</small></p>
</body>
</html>

