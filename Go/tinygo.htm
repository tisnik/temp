<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title></title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1></h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p></p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. </a></p>
<p><a href="#k02">*** 2. </a></p>
<p><a href="#k03">*** 3. Instalace TinyGo</a></p>
<p><a href="#k04">*** 4. Podporované cílové platformy</a></p>
<p><a href="#k05">*** 5. Čas překladu a velikost výsledného souboru pro nejjednodušší variantu programu typu &bdquo;Hello world&ldquo;</a></p>
<p><a href="#k06">*** 6. Program typu &bdquo;Hello world&ldquo; volající funkci <strong>fmt.Println</strong></a></p>
<p><a href="#k07">*** 7. </a></p>
<p><a href="#k08">*** 8. </a></p>
<p><a href="#k09">*** 9. Benchmark pro zjištění rychlosti programů přeložených standardním překladačem Go a TinyGo</a></p>
<p><a href="#k10">*** 10. Výsledky změřené pro standardní překladač Go</a></p>
<p><a href="#k11">*** 11. Optimalizace na rychlost v&nbsp;TinyGo</a></p>
<p><a href="#k12">*** 12. Výsledky změřené pro TinyGo s&nbsp;různě nastavenými parametry překladu</a></p>
<p><a href="#k13">*** 13. Druhá varianta benchmarku: výpočet jednotlivých řádků v&nbsp;samostatných vláknech</a></p>
<p><a href="#k14">*** 14. </a></p>
<p><a href="#k15">*** 15. </a></p>
<p><a href="#k16">*** 16. </a></p>
<p><a href="#k17">*** 17. </a></p>
<p><a href="#k18">*** 18. </a></p>
<p><a href="#k19">*** 19. Repositář s&nbsp;demonstračními příklady</a></p>
<p><a href="#k20">*** 20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. </h2>

<p></p>



<p><a name="k02"></a></p>
<h2 id="k02">2. </h2>

<p></p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Instalace TinyGo</h2>

<pre>
$ <strong>tinygo</strong>
&nbsp;
bash: tinygo: command not found...
Install package 'tinygo' to provide command 'tinygo'? [N/y] y
</pre>

<pre>
 * Waiting in queue...
 * Loading list of packages....
The following packages have to be installed:
 clang17-libs-17.0.6-9.fc40.x86_64      Runtime library for clang
 clang17-resource-filesystem-17.0.6-9.fc40.x86_64       Filesystem package that owns the clang resource directory
 llvm17-libs-17.0.6-7.fc40.x86_64       LLVM shared libraries
 qemu-system-arm-core-2:8.2.9-1.fc40.x86_64     QEMU system emulator for ARM
 qemu-system-riscv-core-2:8.2.9-1.fc40.x86_64   QEMU system emulator for RISC-V
 qemu-user-2:8.2.9-1.fc40.x86_64        QEMU user mode emulation of qemu targets
 tinygo-0.30.0-4.fc40.x86_64    Go compiler for small places
Proceed with changes? [N/y] y
</pre>

<pre>
 * Waiting in queue...
 * Waiting for authentication...
 * Waiting in queue...
 * Downloading packages...
 * Requesting data...
 * Testing changes...
 * Installing packages...
</pre>


<pre>
$ <strong>tinygo</strong>
</pre>

<pre>
No command-line arguments supplied.
TinyGo is a Go compiler for small places.
version: 0.30.0
usage: tinygo &lt;command&gt; [arguments]
&nbsp;
commands:
  build:   compile packages and dependencies
  run:     compile and run immediately
  test:    test packages
  flash:   compile and flash to the device
  gdb:     run/flash and immediately enter GDB
  lldb:    run/flash and immediately enter LLDB
  monitor: open communication port
  env:     list environment variables used during build
  list:    run go list using the TinyGo root
  clean:   empty cache directory (/home/ptisnovs/.cache/tinygo)
  targets: list targets
  info:    show info for specified target
  version: show version
  help:    print this help text
&nbsp;
for more details, see https://tinygo.org/docs/reference/usage/
</pre>

<pre>
$ <strong>tinygo</strong>
&nbsp;
No command-line arguments supplied.
TinyGo is a Go compiler for small places.
version: 0.39.0
usage: tinygo <command> [arguments]
commands:
                build:          compile packages and dependencies
                run:            compile and run immediately
                test:           test packages
                flash:          compile and flash to the device
                gdb:            run/flash and immediately enter GDB
                lldb:           run/flash and immediately enter LLDB
                monitor:        open communication port
                ports:          list available serial ports
                env:            list environment variables used during build
                list:           run go list using the TinyGo root
                clean:          empty cache directory (/home/ptisnovs/.cache/tinygo)
                targets:        list targets
                info:           show info for specified target
                version:        show version
                help:           print this help text
for more details, see https://tinygo.org/docs/reference/usage/
</pre>

<pre>
$ <strong>./tinygo version</strong>
&nbsp;
tinygo version 0.39.0 linux/amd64 (using go version go1.23.8 and LLVM version 19.1.2)
</pre>



<p><a name="k04"></a></p>
<h2 id="k04">4. Podporované cílové platformy</h2>

<p></p>

<pre>
$ <strong>tinygo targets</strong>
</pre>

<p></p>

<pre>
adafruit-esp32-feather-v2
ae-rp2040
arduino
arduino-leonardo
arduino-mega1280
arduino-mega2560
arduino-mkr1000
arduino-mkrwifi1010
arduino-nano
arduino-nano-new
arduino-nano33
arduino-zero
atmega1284p
atsame54-xpro
attiny1616
badger2040
badger2040-w
bluemicro840
bluepill
bluepill-clone
btt-skr-pico
challenger-rp2040
circuitplay-bluefruit
circuitplay-express
clue
clue-alpha
cortex-m-qemu
d1mini
digispark
elecrow-rp2040
elecrow-rp2350
esp-c3-32s-kit
esp32
esp32-c3-devkit-rust-1
esp32-coreboard-v2
esp32-mini32
esp32c3
esp32c3-12f
esp32c3-supermini
esp8266
feather-m0
feather-m0-express
feather-m4
feather-m4-can
feather-nrf52840
feather-nrf52840-sense
feather-rp2040
feather-stm32f405
gameboy-advance
gemma-m0
gnse
gobadge
gopher-badge
gopherbot
gopherbot2
grandcentral-m4
hifive1b
hw-651
hw-651-s110v8
itsybitsy-m0
itsybitsy-m4
itsybitsy-nrf52840
kb2040
lgt92
lorae5
m5paper
m5stack
m5stack-core2
m5stamp-c3
m5stick-c
macropad-rp2040
maixbit
makerfabs-esp32c3spi35
matrixportal-m4
mch2022
mdbt50qrx-uf2
metro-m4-airlift
metro-rp2350
microbit
microbit-s110v8
microbit-v2
microbit-v2-s113v7
microbit-v2-s140v7
mksnanov3
nano-33-ble
nano-33-ble-s140v6-uf2
nano-33-ble-s140v7
nano-33-ble-s140v7-uf2
nano-rp2040
nicenano
nodemcu
nrf52840-mdk
nrf52840-mdk-usb-dongle
nrf52840-s140v6-uf2
nrf52840-s140v6-uf2-generic
nrf52840-s140v7-uf2
nucleo-f103rb
nucleo-f722ze
nucleo-l031k6
nucleo-l432kc
nucleo-l476rg
nucleo-l552ze
nucleo-wl55jc
p1am-100
particle-3rd-gen
particle-argon
particle-boron
particle-xenon
pca10031
pca10040
pca10040-s132v6
pca10056
pca10056-s140v6-uf2
pca10056-s140v7
pca10059
pca10059-s140v7
pga2350
pico
pico-plus2
pico-w
pico2
pico2-w
pinetime
pybadge
pygamer
pyportal
qtpy
qtpy-esp32c3
qtpy-rp2040
rak4631
reelboard
reelboard-s140v7
riscv-qemu
rp2040
rp2350
rp2350b
simavr
stm32f469disco
stm32f4disco
stm32f4disco-1
stm32l0x1
swan
teensy36
teensy40
teensy41
thingplus-rp2040
thumby
tiny2350
tkey
trinket-m0
trinkey-qt2040
tufty2040
wasi
wasip1
wasip2
wasm
wasm-unknown
waveshare-rp2040-tiny
waveshare-rp2040-zero
wioterminal
x9pro
xiao
xiao-ble
xiao-esp32c3
xiao-rp2040
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Čas překladu a velikost výsledného souboru pro nejjednodušší variantu programu typu &bdquo;Hello world&ldquo;</h2>

<p></p>

<pre>
package <strong>main</strong>

func <strong>main</strong>() {
        println("Go!")
}
</pre>


$ <strong>stat hello</strong>
  File: hello
  Size: 1519795         Blocks: 2976       IO Block: 4096   regular file
Device: 0,44    Inode: 657113      Links: 1
Access: (0755/-rwxr-xr-x)  Uid: (14282/ptisnovs)   Gid: (14282/ptisnovs)
Context: unconfined_u:object_r:user_tmp_t:s0
Access: 2025-11-28 16:32:51.751457255 +0100
Modify: 2025-11-28 16:32:51.695457298 +0100
Change: 2025-11-28 16:32:51.695457298 +0100
 Birth: 2025-11-28 16:32:51.694626885 +0100

$ <strong>stat hello</strong>
  File: hello
  Size: 542536          Blocks: 1064       IO Block: 4096   regular file
Device: 0,44    Inode: 657114      Links: 1
Access: (0755/-rwxr-xr-x)  Uid: (14282/ptisnovs)   Gid: (14282/ptisnovs)
Context: unconfined_u:object_r:user_tmp_t:s0
Access: 2025-11-28 16:35:03.068357976 +0100
Modify: 2025-11-28 16:35:02.877358121 +0100
Change: 2025-11-28 16:35:02.877358121 +0100
 Birth: 2025-11-28 16:35:02.877358121 +0100

<pre>
$ <strong>time go build hello.go</strong>
&nbsp;
real    0m0.161s
user    0m0.232s
sys     0m0.131s
</pre>

<pre>
$ <strong>time tinygo build hello.go</strong>
&nbsp;
real    0m0.441s
user    0m0.489s
sys     0m0.190s
</pre>

<pre>
for i in `seq 10`
do
    /usr/bin/time -f %E -o hello_go.txt -a go build hello.go
done
&nbsp;
for i in `seq 10`
do
    /usr/bin/time -f %E -o hello_tinygo.txt -a ./tinygo build hello.go
done
</pre>

<pre>
0:00.14
0:00.06
0:00.06
0:00.05
0:00.06
0:00.05
0:00.05
0:00.06
0:00.05
0:00.06
</pre>

<pre>
0:00.45
0:00.45
0:00.45
0:00.44
0:00.44
0:00.50
0:00.45
0:00.54
0:00.44
0:00.47
</pre>



<p><a name="k06"></a></p>
<h2 id="k06">6. Program typu &bdquo;Hello world&ldquo; volající funkci <strong>fmt.Println</strong></h2>

<p></p>

<pre>
package <strong>main</strong>
&nbsp;
import "fmt"
&nbsp;
func <strong>main</strong>() {
        fmt.Println("Go!")
}
</pre>

2130697
1074968

<p></p>

<pre>
0:00.20
0:00.08
0:00.09
0:00.09
0:00.08
0:00.07
0:00.08
0:00.07
0:00.08
0:00.07
</pre>

<p></p>

<pre>
0:03.14
0:03.18
0:03.06
0:03.06
0:03.18
0:03.06
0:03.03
0:03.21
0:03.01
0:03.12
</pre>



<p><a name="k07"></a></p>
<h2 id="k07">7. </h2>

<p></p>




<p><a name="k08"></a></p>
<h2 id="k08">8. </h2>

<p></p>

hello1.go

orig 1519795
542536
-no-debug 79584
-sheduler=none 73616
-gc=leaking 14464

hello2.go

2130697
1074968
243344
238448
169872



<p><a name="k09"></a></p>
<h2 id="k09">9. Benchmark pro zjištění rychlosti programů přeložených standardním překladačem Go a TinyGo</h2>

<p></p>

<p>Zápis (či lépe řečeno export) výsledné bitmapy je realizován v&nbsp;samostatné funkci pojmenované <strong>writeImage</strong>, které se předají rozměry bitmapy a hodnoty jednotlivých pixelů v&nbsp;poli typu <strong>[]byte</strong>:</p>

<pre>
func <strong>writeImage</strong>(width uint, height uint, image []byte) {
}
</pre>

<p>Funkce pro výpočet jediného řádku obrázku Mandelbrotovy množiny bude mít hlavičku:</p>

<pre>
func <strong>calcMandelbrot</strong>(width uint, height uint, maxiter uint, palette [][3]byte, image []byte, cy float64) {
}
</pre>

<p>Povšimněte si, že v&nbsp;posledním parametru předáváme hodnotu <strong>cy</strong>, která určuje imaginární složku komplexního čísla <strong>C</strong>, které vstupuje do iterativního výpočtu Mandelbrotovy množiny (viz odkazovaný článek s&nbsp;podrobnějším vysvětlením).</p>

<p>Volání této funkce a postupné skládání bitmapy tedy může vypadat například takto:</p>

<pre>
image := make([]byte, width*height*3)
offset := 0
delta := width * 3
&nbsp;
var cy float64 = -1.5
for y := 0; y &lt; height; y++ {
        calcMandelbrot(uint(width), uint(height), uint(maxiter), mandmap[:], image[offset:offset+delta], cy)
        offset += delta
        cy += 3.0 / float64(height)
}
</pre>

<p><a
href="https://github.com/tisnik/go-root/tree/master/benchmarks/mandelbrot/go-linewise">Úplný
zdrojový kód benchmarku</a> se tedy modifikuje následujícím způsobem:</p>

<pre>
package <strong>main</strong>
&nbsp;
import (
        "bufio"
        "fmt"
        "os"
        "strconv"
)
&nbsp;
func <strong>writeImage</strong>(width uint, height uint, image []byte) {
        w := bufio.NewWriter(os.Stdout)
        defer w.Flush()
&nbsp;
        fmt.Fprintln(w, "P3")
        fmt.Fprintf(w, "%d %d\n", width, height)
        fmt.Fprintln(w, "255")
&nbsp;
        for i := 0; i &lt; len(image); {
                r := image[i]
                i++
                g := image[i]
                i++
                b := image[i]
                i++
                fmt.Fprintf(w, "%d %d %d\n", r, g, b)
        }
}
&nbsp;
func <strong>calcMandelbrot</strong>(width uint, height uint, maxiter uint, palette [][3]byte, image []byte, cy float64) {
        var cx float64 = -2.0
        for x := uint(0); x &lt; width; x++ {
                var zx float64 = 0.0
                var zy float64 = 0.0
                var i uint = 0
                for i &lt; maxiter {
                        zx2 := zx * zx
                        zy2 := zy * zy
                        if zx2+zy2 &gt; 4.0 {
                                break
                        }
                        zy = 2.0*zx*zy + cy
                        zx = zx2 - zy2 + cx
                        i++
                }
                color := palette[i]
                image[3*x] = color[0]
                image[3*x+1] = color[1]
                image[3*x+2] = color[2]
                cx += 3.0 / float64(width)
        }
}
&nbsp;
func <strong>main</strong>() {
        if len(os.Args) &lt; 4 {
                println("usage: ./mandelbrot width height maxiter")
                os.Exit(1)
        }
&nbsp;
        width, err := strconv.Atoi(os.Args[1])
        if err != nil {
                fmt.Printf("Improper width parameter: '%s'\n", os.Args[1])
                os.Exit(1)
        }
&nbsp;
        height, err := strconv.Atoi(os.Args[2])
        if err != nil {
                fmt.Printf("Improper height parameter: '%s'\n", os.Args[2])
                os.Exit(1)
        }
&nbsp;
        maxiter, err := strconv.Atoi(os.Args[3])
        if err != nil {
                fmt.Printf("Improper maxiter parameter: '%s'\n", os.Args[3])
                os.Exit(1)
        }
&nbsp;
        image := make([]byte, width*height*3)
        offset := 0
        delta := width * 3
&nbsp;
        var cy float64 = -1.5
        for y := 0; y &lt; height; y++ {
                calcMandelbrot(uint(width), uint(height), uint(maxiter), mandmap[:], image[offset:offset+delta], cy)
                offset += delta
                cy += 3.0 / float64(height)
        }
        writeImage(uint(width), uint(height), image)
}
</pre>

<pre>
package main

/* taken from Fractint */

var mandmap = [...][3]byte{
        {255, 255, 255}, {224, 224, 224}, {216, 216, 216}, {208, 208, 208},
        {200, 200, 200}, {192, 192, 192}, {184, 184, 184}, {176, 176, 176},
        {168, 168, 168}, {160, 160, 160}, {152, 152, 152}, {144, 144, 144},
        {136, 136, 136}, {128, 128, 128}, {120, 120, 120}, {112, 112, 112},
        {104, 104, 104}, {96, 96, 96}, {88, 88, 88}, {80, 80, 80},
        {72, 72, 72}, {64, 64, 64}, {56, 56, 56}, {48, 48, 56},
        {40, 40, 56}, {32, 32, 56}, {24, 24, 56}, {16, 16, 56},
        {8, 8, 56}, {000, 000, 60}, {000, 000, 64}, {000, 000, 72},
        {000, 000, 80}, {000, 000, 88}, {000, 000, 96}, {000, 000, 104},
        {000, 000, 108}, {000, 000, 116}, {000, 000, 124}, {000, 000, 132},
        {000, 000, 140}, {000, 000, 148}, {000, 000, 156}, {000, 000, 160},
        {000, 000, 168}, {000, 000, 176}, {000, 000, 184}, {000, 000, 192},
        {000, 000, 200}, {000, 000, 204}, {000, 000, 212}, {000, 000, 220},
        {000, 000, 228}, {000, 000, 236}, {000, 000, 244}, {000, 000, 252},
        {000, 4, 252}, {4, 12, 252}, {8, 20, 252}, {12, 28, 252},
        {16, 36, 252}, {20, 44, 252}, {20, 52, 252}, {24, 60, 252},
        {28, 68, 252}, {32, 76, 252}, {36, 84, 252}, {40, 92, 252},
        {40, 100, 252}, {44, 108, 252}, {48, 116, 252}, {52, 120, 252},
        {56, 128, 252}, {60, 136, 252}, {60, 144, 252}, {64, 152, 252},
        {68, 160, 252}, {72, 168, 252}, {76, 176, 252}, {80, 184, 252},
        {80, 192, 252}, {84, 200, 252}, {88, 208, 252}, {92, 216, 252},
        {96, 224, 252}, {100, 232, 252}, {100, 228, 248}, {96, 224, 244},
        {92, 216, 240}, {88, 212, 236}, {88, 204, 232}, {84, 200, 228},
        {80, 192, 220}, {76, 188, 216}, {76, 180, 212}, {72, 176, 208},
        {68, 168, 204}, {64, 164, 200}, {64, 156, 196}, {60, 152, 188},
        {56, 144, 184}, {52, 140, 180}, {52, 132, 176}, {48, 128, 172},
        {44, 120, 168}, {40, 116, 160}, {40, 108, 156}, {36, 104, 152},
        {32, 96, 148}, {28, 92, 144}, {28, 84, 140}, {24, 80, 136},
        {20, 72, 128}, {16, 68, 124}, {16, 60, 120}, {12, 56, 116},
        {8, 48, 112}, {4, 44, 108}, {000, 36, 100}, {4, 36, 104},
        {12, 40, 108}, {16, 44, 116}, {24, 48, 120}, {28, 52, 128},
        {36, 56, 132}, {40, 60, 140}, {48, 64, 144}, {52, 64, 148},
        {60, 68, 156}, {64, 72, 160}, {72, 76, 168}, {76, 80, 172},
        {84, 84, 180}, {88, 88, 184}, {96, 92, 192}, {104, 100, 192},
        {112, 112, 196}, {124, 120, 200}, {132, 132, 204}, {144, 140, 208},
        {152, 152, 212}, {164, 160, 216}, {172, 172, 220}, {180, 180, 224},
        {192, 192, 228}, {200, 200, 232}, {212, 212, 236}, {220, 220, 240},
        {232, 232, 244}, {240, 240, 248}, {252, 252, 252}, {252, 240, 244},
        {252, 224, 232}, {252, 208, 224}, {252, 192, 212}, {252, 176, 204},
        {252, 160, 192}, {252, 144, 184}, {252, 128, 172}, {252, 112, 164},
        {252, 96, 152}, {252, 80, 144}, {252, 64, 132}, {252, 48, 124},
        {252, 32, 112}, {252, 16, 104}, {252, 000, 92}, {236, 000, 88},
        {228, 000, 88}, {216, 4, 84}, {204, 4, 80}, {192, 8, 76},
        {180, 8, 76}, {168, 12, 72}, {156, 16, 68}, {144, 16, 64},
        {132, 20, 60}, {124, 20, 60}, {112, 24, 56}, {100, 24, 52},
        {88, 28, 48}, {76, 32, 44}, {64, 32, 44}, {52, 36, 40},
        {40, 36, 36}, {28, 40, 32}, {16, 44, 28}, {20, 52, 32},
        {24, 60, 36}, {28, 68, 44}, {32, 76, 48}, {36, 88, 56},
        {40, 96, 60}, {44, 104, 64}, {48, 112, 72}, {52, 120, 76},
        {56, 132, 84}, {48, 136, 84}, {40, 144, 80}, {52, 148, 88},
        {68, 156, 100}, {80, 164, 112}, {96, 168, 124}, {108, 176, 136},
        {124, 184, 144}, {136, 192, 156}, {152, 196, 168}, {164, 204, 180},
        {180, 212, 192}, {192, 220, 200}, {208, 224, 212}, {220, 232, 224},
        {236, 240, 236}, {252, 248, 248}, {252, 252, 252}, {252, 252, 240},
        {252, 252, 228}, {252, 252, 216}, {248, 248, 204}, {248, 248, 192},
        {248, 248, 180}, {248, 248, 164}, {244, 244, 152}, {244, 244, 140},
        {244, 244, 128}, {244, 244, 116}, {240, 240, 104}, {240, 240, 92},
        {240, 240, 76}, {240, 240, 64}, {236, 236, 52}, {236, 236, 40},
        {236, 236, 28}, {236, 236, 16}, {232, 232, 0}, {232, 232, 12},
        {232, 232, 28}, {232, 232, 40}, {236, 236, 56}, {236, 236, 68},
        {236, 236, 84}, {236, 236, 96}, {240, 240, 112}, {240, 240, 124},
        {240, 240, 140}, {244, 244, 152}, {244, 244, 168}, {244, 244, 180},
        {244, 244, 196}, {248, 248, 208}, {248, 248, 224}, {248, 248, 236},
        {252, 252, 252}, {248, 248, 248}, {240, 240, 240}, {232, 232, 232}}
</pre>



<p><a name="k10"></a></p>
<h2 id="k10">10. Výsledky změřené pro standardní překladač Go</h2>

<p></p>



<p><a name="k11"></a></p>
<h2 id="k11">11. Optimalizace na rychlost v&nbsp;TinyGo</h2>

<p></p>



<p><a name="k12"></a></p>
<h2 id="k12">12. Výsledky změřené pro TinyGo s&nbsp;různě nastavenými parametry překladu</h2>

<p></p>



<p><a name="k13"></a></p>
<h2 id="k13">13. Druhá varianta benchmarku: výpočet jednotlivých řádků v&nbsp;samostatných vláknech</h2>

<p>Celý výpočet nyní upravíme tak, aby byly výpočty prováděny souběžně (a do určité míry i paralelně). Barvy pixelů na každém obrazovém řádku budou vypočteny v&nbsp;samostatné gorutině. Vzhledem k&nbsp;tomu, že gorutiny jsou interně reprezentovány úsporným způsobem, je možné tuto optimalizaci bez problémů provést a vytvořit jich tak i několik tisíc (v&nbsp;závislosti na rozlišení bitmapy, resp.&nbsp;přesněji řečeno na počtu obrazových řádků bitmapy).</p>

<p>O to, aby se počkalo na dokončení všech gorutin, se postará kanál pojmenovaný <strong>done</strong>, jehož kapacita přesně odpovídá počtu gorutin. Nejprve se kanál vytvoří, následně se všechny gorutiny spustí a na konci čtením z&nbsp;kanálu počkáme na dokončení všech <strong>height</strong> gorutin:</p>

<pre>
done := make(chan bool, height)
&nbsp;
<i>// na tomto místě bude umístěn vlastní výpočet</i>
&nbsp;
for i := 0; i &lt; height; i++ {
        &lt;-done
}
</pre>

<p>Jedinou další úpravou bude modifikace funkce <strong>calcMandelbrot</strong>, které se musí předat reference na kanál a do kterého se na konci výpočtu zapíše hodnota <strong>true</strong> (důležitý je zápis, nikoli vlastní hodnota):</p>

<pre>
func <strong>calcMandelbrot</strong>(width uint, height uint, maxiter uint, palette [][3]byte, image []byte, cy float64, <strong>done chan bool</strong>) {
        ...
        ...
        ...
        <strong>done &lt;- true</strong>
}
</pre>

<p></p>

<pre>
        for i := 0; i &lt; height; i++ {
                &lt;-done
        }
</pre>

<p></p>

<pre>
        writeImage(uint(width), uint(height), image)
</pre>

<pre>
package <strong>main</strong>
&nbsp;
import (
        "bufio"
        "fmt"
        "os"
        "strconv"
)
&nbsp;
func <strong>writeImage</strong>(width uint, height uint, image []byte) {
        w := bufio.NewWriter(os.Stdout)
        defer w.Flush()
&nbsp;
        fmt.Fprintln(w, "P3")
        fmt.Fprintf(w, "%d %d\n", width, height)
        fmt.Fprintln(w, "255")
&nbsp;
        for i := 0; i &lt; len(image); {
                r := image[i]
                i++
                g := image[i]
                i++
                b := image[i]
                i++
                fmt.Fprintf(w, "%d %d %d\n", r, g, b)
        }
}
&nbsp;
func <strong>calcMandelbrot</strong>(width uint, height uint, maxiter uint, palette [][3]byte, image []byte, cy float64, done chan bool) {
        var cx float64 = -2.0
        for x := uint(0); x &lt; width; x++ {
                var zx float64 = 0.0
                var zy float64 = 0.0
                var i uint = 0
                for i &lt; maxiter {
                        zx2 := zx * zx
                        zy2 := zy * zy
                        if zx2+zy2 &gt; 4.0 {
                                break
                        }
                        zy = 2.0*zx*zy + cy
                        zx = zx2 - zy2 + cx
                        i++
                }
                color := palette[i]
                image[3*x] = color[0]
                image[3*x+1] = color[1]
                image[3*x+2] = color[2]
                cx += 3.0 / float64(width)
        }
        done &lt;- true
}
&nbsp;
func <strong>main</strong>() {
        if len(os.Args) &lt; 4 {
                println("usage: ./mandelbrot width height maxiter")
                os.Exit(1)
        }
&nbsp;
        width, err := strconv.Atoi(os.Args[1])
        if err != nil {
                fmt.Printf("Improper width parameter: '%s'\n", os.Args[1])
                os.Exit(1)
        }
&nbsp;
        height, err := strconv.Atoi(os.Args[2])
        if err != nil {
                fmt.Printf("Improper height parameter: '%s'\n", os.Args[2])
                os.Exit(1)
        }
&nbsp;
        maxiter, err := strconv.Atoi(os.Args[3])
        if err != nil {
                fmt.Printf("Improper maxiter parameter: '%s'\n", os.Args[3])
                os.Exit(1)
        }
&nbsp;
        done := make(chan bool, height)
&nbsp;
        image := make([]byte, width*height*3)
        offset := 0
        delta := width * 3
&nbsp;
        var cy float64 = -1.5
        for y := 0; y &lt; height; y++ {
                go calcMandelbrot(uint(width), uint(height), uint(maxiter), mandmap[:], image[offset:offset+delta], cy, done)
                offset += delta
                cy += 3.0 / float64(height)
        }
        for i := 0; i &lt; height; i++ {
                &lt;-done
        }
        writeImage(uint(width), uint(height), image)
}
</pre>



<p><a name="k14"></a></p>
<h2 id="k14">14. </h2>

<p></p>



<p><a name="k15"></a></p>
<h2 id="k15">15. </h2>

<p></p>



<p><a name="k16"></a></p>
<h2 id="k16">16. </h2>

<p></p>



<p><a name="k17"></a></p>
<h2 id="k17">17. </h2>

<p></p>



<p><a name="k18"></a></p>
<h2 id="k18">18. </h2>

<p></p>



<p><a name="k19"></a></p>
<h2 id="k19">19. Repositář s&nbsp;demonstračními příklady</h2>

<p>Zdrojové kódy všech dnes použitých demonstračních příkladů byly uloženy do
Git repositáře, který je dostupný na adrese <a
href="https://github.com/tisnik/go-root">https://github.com/tisnik/go-root</a>
(stále na GitHubu :-). V&nbsp;případě, že nebudete chtít klonovat celý
repositář (ten je ovšem &ndash; alespoň prozatím &ndash; velmi malý, dnes má
přibližně pět až šest megabajtů), můžete namísto toho použít odkazy na
jednotlivé příklady, které naleznete v&nbsp;následující tabulce:</p>

<table>
<tr><th> #</th><th>Příklad</th><th>Stručný popis</th><th>Cesta</th></tr>
<tr><td> 1</td><td></td><td></td><td><a href="https://github.com/tisnik/go-root/blob/master/tinygo/">https://github.com/tisnik/go-root/blob/master/tinygo/</a></td></tr>
<tr><td> 2</td><td></td><td></td><td><a href="https://github.com/tisnik/go-root/blob/master/tinygo/">https://github.com/tisnik/go-root/blob/master/tinygo/</a></td></tr>
<tr><td> 3</td><td></td><td></td><td><a href="https://github.com/tisnik/go-root/blob/master/tinygo/">https://github.com/tisnik/go-root/blob/master/tinygo/</a></td></tr>
<tr><td> 4</td><td></td><td></td><td><a href="https://github.com/tisnik/go-root/blob/master/tinygo/">https://github.com/tisnik/go-root/blob/master/tinygo/</a></td></tr>
<tr><td> 5</td><td></td><td></td><td><a href="https://github.com/tisnik/go-root/blob/master/tinygo/">https://github.com/tisnik/go-root/blob/master/tinygo/</a></td></tr>
<tr><td> 6</td><td></td><td></td><td><a href="https://github.com/tisnik/go-root/blob/master/tinygo/">https://github.com/tisnik/go-root/blob/master/tinygo/</a></td></tr>
<tr><td> 7</td><td></td><td></td><td><a href="https://github.com/tisnik/go-root/blob/master/tinygo/">https://github.com/tisnik/go-root/blob/master/tinygo/</a></td></tr>
</table>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>TinyGo - A Go Compiler For Small Places<br />
<a href="https://tinygo.org/">https://tinygo.org/</a>
</li>

<li>Getting started<br />
<a href="https://tinygo.org/getting-started/">https://tinygo.org/getting-started/</a>
</li>

<li>Go.dev (klasická varianta překladače jazyka Go)<br />
<a href="https://go.dev/">https://go.dev/</a>
</li>

<li>gccgo<br />
<a href="https://gcc.gnu.org/onlinedocs/gccgo/">https://gcc.gnu.org/onlinedocs/gccgo/</a>
</li>

<li>Setting up and using gccgo<br />
<a href="https://go.dev/doc/install/gccgo">https://go.dev/doc/install/gccgo</a>
</li>

<li>Awesome Go<br />
<a href="https://github.com/avelino/awesome-go">https://github.com/avelino/awesome-go</a>
</li>

<li>TinyGo: Inline assembly<br />
<a href="https://tinygo.org/docs/concepts/compiler-internals/inline-assembly/">https://tinygo.org/docs/concepts/compiler-internals/inline-assembly/</a>
</li>

<li>Getting Started with TinyGo: Bringing Go to Microcontrollers and WebAssembly<br />
<a href="https://dev.to/ekwoster/getting-started-with-tinygo-bringing-go-to-microcontrollers-and-webassembly-2pp0">https://dev.to/ekwoster/getting-started-with-tinygo-bringing-go-to-microcontrollers-and-webassembly-2pp0</a>
</li>

<li>Optimizing Go code with GCCGO for improved performance<br />
<a href="https://dev.to/parmcoder/optimizing-go-code-with-gccgo-for-improved-performance-2d3d">https://dev.to/parmcoder/optimizing-go-code-with-gccgo-for-improved-performance-2d3d</a>
</li>

<li>The Untold Power of TinyGo: How to Run Go on Microcontrollers and Supercharge Embedded Development<br />
<a href="https://dev.to/ekwoster/the-untold-power-of-tinygo-how-to-run-go-on-microcontrollers-and-supercharge-embedded-development-2g7d">https://dev.to/ekwoster/the-untold-power-of-tinygo-how-to-run-go-on-microcontrollers-and-supercharge-embedded-development-2g7d</a>
</li>

<li>From Arduino to Mars: Why You Should Be Using TinyGo for Embedded Web Development<br />
<a href="https://dev.to/ekwoster/from-arduino-to-mars-why-you-should-be-using-tinygo-for-embedded-web-development-54od">https://dev.to/ekwoster/from-arduino-to-mars-why-you-should-be-using-tinygo-for-embedded-web-development-54od</a>
</li>

<li>Optimizing binaries<br />
<a href="https://tinygo.org/docs/guides/optimizing-binaries/">https://tinygo.org/docs/guides/optimizing-binaries/</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="https://github.com/tisnik/">Pavel Tišnovský</a> &nbsp; 2025</small></p>
</body>
</html>

