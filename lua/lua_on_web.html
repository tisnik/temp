<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Programovací jazyk Lua v roli skriptovacího jazyka pro WWW stránky</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Programovací jazyk Lua v roli skriptovacího jazyka pro WWW stránky</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>JavaScript jako¾to jazyk pou¾ívaný (nejenom) pro tvorbu skriptù spou¹tìných v rámci webových prohlí¾eèù, pravdìpodobnì není nutné ètenáøùm Roota pøedstavovat. Z technologického hlediska v¹ak pro mnoho vývojáøù mohou být zajímavé projekty umo¾òující tvorbu skriptù pro WWW stránky v odli¹ném programovacím jazyku (CoffeeScript, Dart, HAXE, TypeScript). Dnes se seznámíme s dvìma projekty urèenými pro jazyk Lua.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Programovací jazyk Lua v&nbsp;roli skriptovacího jazyka pro WWW stránky</a></p>
<p><a href="#k02">2. Zpùsob vyu¾ití rùzných programovacích jazykù na WWW stránkách</a></p>
<p><a href="#k03">3. Transcompilery do JavaScriptu</a></p>
<p><a href="#k04">4. Emscripten</a></p>
<p><a href="#k05">5. Virtuální stroj naprogramovaný v&nbsp;JavaScriptu</a></p>
<p><a href="#k06">6. Projekt <strong>lua2js</strong></a></p>
<p><a href="#k07">7. Projekt <strong>lua.vm.js</strong></a></p>
<p><a href="#k08">8. Pøíklady pou¾ití jazyka Lua na WWW stránkách</a></p>
<p><a href="#k09">9. &bdquo;Hello World&ldquo; v&nbsp;JavaScriptu a v&nbsp;Lue</a></p>
<p><a href="#k10">10. Pøeètení v¹ech atributù a metod objektu <strong>js</strong></a></p>
<p><a href="#k11">11. Globální objekty dostupné programátorùm</a></p>
<p><a href="#k12">12. Zmìna stylu (barvy) vybraného elementu</a></p>
<p><a href="#k13">13. Pou¾ití objektu typu <strong>canvas</strong> (2D) pro kreslení</a></p>
<p><a href="#k14">14. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Programovací jazyk Lua v&nbsp;roli skriptovacího jazyka pro WWW stránky</h2>

<p>V&nbsp;dne¹ním èlánku se seznámíme s&nbsp;dvojicí po technologické stránce
zajímavých projektù, které sice mají prakticky toto¾ný cíl, ov¹em jejich
implementace je zcela odli¹ná. Tyto projekty se jmenují <i>lua2js</i> a
<i>lua.vm.js</i>. Cíl obou zmínìných projektù je prakticky toto¾ný: umo¾nit
skriptování na stranì WWW klienta (tj.&nbsp;na stranì webového prohlí¾eèe)
s&nbsp;vyu¾itím programovacího jazyka <i>Lua</i>. Zatímco se v¹ak
v&nbsp;projektu <i>lua2js</i> pou¾ívá technologie takzvaného
&bdquo;transcompileru/transpøekladaèe&ldquo; (zjednodu¹enì øeèeno se jedná o
pøekladaè zdrojového kódu z&nbsp;jednoho programovacího jazyka do odli¹ného
programovacího jazyka a nikoli do bajtkódu èi do nativního strojového kódu), je
v&nbsp;rámci projektu <i>lua.vm.js</i> pou¾it zcela odli¹ný pøístup:
implementace celého virtuálního stroje programovacího jazyka <i>Lua</i>
v&nbsp;JavaScriptu. V&nbsp;obou projektech se tak vlastnì vyu¾ívá praktická
aplikace dnes ji¾ zcela vá¾nì pøijímané <strong>analogie</strong> tvrdící, ¾e
jazyk JavaScript pro webové aplikace je prakticky toté¾ co assembler pro
aplikace nativní (slovo analogie je zdùraznìno naschvál :-).</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Zpùsob vyu¾ití rùzných programovacích jazykù na WWW stránkách</h2>

<p><i>JavaScript is an assembly language. The JavaScript + HTML generate is
like a .NET assembly. The browser can execute it, but no human should really
care what's there.<br />
Erik Meijer</i></p>

<p>I pøes snahy nìkterých vývojáøù a softwarových spoleèností o zaèlenìní
dal¹ích skriptovacích jazykù do webových prohlí¾eèù (Tcl, VBScript, Dart
v&nbsp;Dartiu apod.) je patrné, ¾e v&nbsp;souèasnosti je jediným ¹iroce
akceptovaným skriptovacím jazykem na stranì webového prohlí¾eèe pouze
JavaScript. To v¹ak neznamená, ¾e by se aplikace, které mají být spou¹tìny na
stranì klienta, musely psát pouze v&nbsp;JavaScriptu, jen¾ nemusí zdaleka v¹em
vývojáøùm vyhovovat, a» ji¾ z&nbsp;objektivních èi ze subjektivních pøíèin.
V&nbsp;relativnì nedávné minulosti proto vzniklo a poøád je¹tì vzniká mnoho
projektù, jejich¾ cílem je umo¾nit tvorbu webových aplikací pro prohlí¾eè
v&nbsp;jiných programovacích jazycích. Zdrojové kódy je pak nutné nìjakým
zpùsobem zpracovat takovým zpùsobem, aby je bylo mo¾né ve webovém prohlí¾eèi
spustit. Mo¾ností je hned nìkolik &ndash; lze pou¾ít plugin (velmi
problematické a dnes znaènì nepopulární øe¹ení), transcompiler do JavaScriptu
èi virtuální stroj popø.&nbsp;interpret daného jazyka implementovaný opìt
v&nbsp;JavaScriptu. Právì posledními dvìma zmínìnými mo¾nostmi se budeme
zabývat v&nbsp;navazujících kapitolách.</p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Transcompilery do JavaScriptu</h2>

<p>Jednu z&nbsp;dnes velmi populárních technik umo¾òujících pou¾ití prakticky
libovolného programovacího jazyka pro tvorbu aplikací bì¾ících na stranì
webového prohlí¾eèe, pøedstavuje pou¾ití takzvaných <i>transcompilerù
(source-to-source compiler)</i> zaji¹»ujících pøeklad programu napsaného ve
zdrojovém programovacím jazyce do funkènì identického programu napsaného
v&nbsp;JavaScriptu. Transpøekladaè se vìt¹inou spou¹tí jen jednou na
vývojáøském poèítaèi, samotní klienti ji¾ mají k&nbsp;dispozici JavaScriptový
kód. Existuje v¹ak i druhá mo¾nost, kdy je transpøekladaè naprogramován
v&nbsp;JavaScriptu a spou¹tìn pøímo ve webovém prohlí¾eèi klientù. Oba pøístupy
mají své pøednosti, ale pochopitelnì i nìjaké zápory (napøíklad tvùrci
uzavøených aplikací pravdìpodobnì budou upøednostòovat první mo¾nost, proto¾e
výstupy transcompilerù jsou vìt¹inou dosti neèitelné). Z&nbsp;praxe mù¾eme
uvést napøíklad následující projekty zalo¾ené na transpøekladaèi:</p>:

<table>
<tr><th>#</th><th>Jazyk</th><th>Poznámka</th></tr>
<tr><td>1</td><td>CoffeeScript</td><td>pøidání syntaktického cukru do JavaScriptu</td></tr>
<tr><td>2</td><td>ClojureScript</td><td>pøeklad aplikací psaných v&nbsp;Clojure do JavaScriptu</td></tr>
<tr><td>3</td><td>Kaffeine</td><td>roz¹íøení JavaScriptu o nové vlastnosti</td></tr>
<tr><td>4</td><td>RedScript</td><td>jazyk inspirovaný Ruby</td></tr>
<tr><td>5</td><td>GorillaScript</td><td>dal¹í roz¹íøení JavaScriptu</td></tr>
<tr><td>6</td><td>ghcjs</td><td>transpøekladaè pro fanou¹ky programovacího jazyka Haskell</td></tr>
</table>



<p><a name="k04"></a></p>
<h2 id="k04">4. Emscripten</h2>

<p>Dal¹í alternativní technologii, která mi osobnì pøijde velmi zajímavá a
v&nbsp;budoucnu mo¾ná i pøelomová, pøedstavují transpøekladaèe provádìjící
pøeklad z&nbsp;bajtkódu èi mezikódu do JavaScriptu (vstupem zde tedy není
zdrojový kód v&nbsp;nìjakém lidsky èitelném programovacím jazyku, ale vìt¹inou
binárnì reprezentovaný výsledek pøedchozího pøekladu). Pøíkladem tohoto typu
transpøekladaèe je pøedev¹ím <i>Emscripten</i> umo¾òující pøeklad kódu
z&nbsp;libovolného jazyka podporovaného LLVM (C, C++, Objective C, D, Ada,
Fortran atd.) do JavaScriptu. Podívejme se nyní ve struènosti na kroky, které
je zapotøebí provést proto, aby se pùvodní kód napsaný napøíklad v&nbsp;Céèku,
mohl spustit ve webovém prohlí¾eèi:</p>

<ol>
<li>Na vstupu celého procesu je program napsaný v&nbsp;céèku</li>
<li>Nejprve je proveden pøeklad pomocí <strong>clang</strong> do mezikódu LLVM (<i>LLVM Intermediate Representation</i>)</li>
<li>Následnì je zavolán <strong>Fastcomp</strong> (jádro pøekladaèe Emscriptenu) pro pøeklad mezikódu z&nbsp;pøedchozího kroku do JavaScriptu</li>
<li>Výsledný JavaScriptový zdrojový kód je mo¾né vyu¾ít rùznými zpùsoby (node.js na serveru, na WWW stránce atd.)</li>
</ol>

<p>Poznámka: poslední pøeklad (do JavaScriptu) generuje kód kompatibilní
s&nbsp;<i>asm.js</i>, tj.&nbsp;pou¾ívá se zde cílenì omezená podmno¾ina
konstrukcí JavaScriptu.</p>



<p><a name="k05"></a></p>
<h2 id="k05">5. Virtuální stroj naprogramovaný v&nbsp;JavaScriptu</h2>

<p>Právì projekt <i>Emscripten</i> zmínìný <a href="#k04">v&nbsp;pøedchozí
kapitole</a> do znaèné míry usnadnil dal¹í zpùsob zaji¹tìní bìhu programù
napsaných v&nbsp;rùzných programovacích jazycích ve webovém prohlí¾eèi. Pokud
je toti¾ mo¾né pøelo¾it jakýkoli program napsaný v&nbsp;jazycích C èi C++ do
JavaScriptu (samozøejmì za pøedpokladu, ¾e se vhodným zpùsobem budou emulovat
pou¾ité knihovní funkce), proè by nebylo mo¾né do JavaScriptu rovnou pøelo¾it
celý virtuální stroj pou¾ívaný daným programovacím jazykem? Samozøejmì to mo¾né
je, a to zejména v&nbsp;pøípadech, kdy je pøekládaný virtuální stroj malý, co¾
je pøíklad VM pro jazyk Lua, tak i napøíklad ponìkud vìt¹ího virtuálního stroje
Pythonu (.NET resp.&nbsp;CLR èi Java VM u¾ je tì¾¹í oøí¹ek). Pøekladem VM do
JavaScriptu získáme pomìrnì mnoho výhod, zejména pak mo¾nost mít pøímo
v&nbsp;HTML stránkách pùvodní zdrojové kódy (Lua, Python atd.) a nikoli
neèitelný výstup z&nbsp;transpøekladaèù. Za tento postup v¹ak také zaplatíme,
zejména pomalej¹ím bìhem aplikací v&nbsp;porovnání s&nbsp;nativní VM.
V&nbsp;praxi se mù¾e jednat o výkonnostní propad zhruba na polovinu, co¾ ov¹em
v&nbsp;mnoha aplikacích vùbec není tak ¹patný výsledek.</p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Projekt <strong>lua2js</strong></h2>

<p>Prvním projektem urèeným pro pou¾ití programovacího jazyka <i>Lua</i> na
webových stránkách, kterým se dnes budeme zabývat, je projekt nazvaný jednodu¹e
<i>lua2js</i>. Ji¾ název tohoto projektu napovídá, ¾e se jedná o transpøekladaè
slou¾ící pro pøeklad zdrojových kódù z&nbsp;Luy do JavaScriptu. Samotný
transpøekladaè <i>lua2js</i> je kupodivu napsán také v&nbsp;JavaScriptu, tak¾e
se pro jeho instalaci pou¾ije správce JavaScriptových balíèkù nazvaný
<i>npm</i> (ten samozøejmì ji¾ musí být nainstalován) a pro spu¹tìní
transpøekladaèe je pou¾ita infrastruktura pro <i>node.js</i>. Samotnou
instalaci <i>lua2js</i> zajistí pøíkaz:</p>

<pre>
npm install lua2js
</pre>

<p>Pou¾ití je snadné:</p>

<pre>
nodejs lua2js [vstupní_soubor.lua] [výstupní_soubor.js]
</pre>

<p>Ve skriptech lze pou¾ívat základní funkce tvoøící jádro jazyka Lua, zejména
pak <i>pairs()</i> a <i>ipairs()</i>, dal¹í funkce a metody jsou dostupné pøes
objekty poskytované prohlí¾eèem.</p>

<a href="http://www.root.cz/obrazek/214752/"><img src="http://i.iinfo.cz/images/174/luaonweb1-prev.png" class="image-214752" alt="&#160;" height="212" width="370" /></a>
<p><i>Obrázek 1: Èást mimifikovaného zdrojového kódu projektu
<strong>lua2js</strong>.</i></p>

<p>Podívejme se na pøeklad jednoduchého pøíkladu:</p>

<pre>
local k = 0
for i = 1, 10 do
    for j = 1, 10 do
        k = k + 1
    end
end
</pre>

<p>Po pøekladu pomocí pøíkazu:</p>

<pre>
nodejs lua2js test.lua test.js
</pre>

<p>Získáme následující zdrojový soubor v&nbsp;JavaScriptu:</p>

<pre>
var lua_script = (function() {
  var tmp;
  var G = lua_newtable2(lua_core);
  for (var i in lua_libs) {
    G.str[i] = lua_newtable2(lua_libs[i]);
  }
  G.str['arg'] = lua_newtable();
  G.str['_G'] = G;
  G.str['module'] = function (name) {
    lua_createmodule(G, name, slice(arguments, 1));
  };
  G.str['require'] = function (name) {
    lua_require(G, name);
  };
  G.str['package'].str['seeall'] = function (module) {
    if (!module.metatable) {
      module.metatable = lua_newtable();
    }
    module.metatable.str['__index'] = G;
  };
  {
    var _k_1 = 0;
    var var_2 = 1, stop_2 = 10;
    for (; var_2 &lt;= stop_2; var_2++) {
      var _i_2 = var_2;
      var var_4 = 1, stop_4 = 10;
      for (; var_4 &lt;= stop_4; var_4++) {
        var _j_4 = var_4;
        _k_1 = lua_add(_k_1, 1);
      }
    }
  };
  return [G];
})()[0];
</pre>



<p><a name="k07"></a></p>
<h2 id="k07">7. Projekt <strong>lua.vm.js</strong></h2>

<p>Mnohem ambicióznìj¹ím a vlastnì i praktiètìj¹ím projektem je projekt nazvaný
<i>lua.vm.js</i>. Tento projekt je zalo¾en na vý¹e zmínìném <i>Emscriptenu</i>,
proto¾e <i>lua.vm.js</i> není nic jiného ne¾ virtuální stroj jazyka Lua
implementovaný v&nbsp;JavaScriptu. Autoøi <i>lua.vm.js</i> se v¹ak nesna¾ili o
znovuobjevení kola a o implementaci vlastního virtuálního stroje, ale pou¾ili
infrastrukturu <i>Clang+LLVM+Emscripten</i> pro pøeklad pùvodního virtuálního
stroje (ten je naprogramován v&nbsp;ANSI C) do JavaScriptu. Co to znamená
v&nbsp;praxi? Bìh skriptù je pøibli¾nì o polovinu pomalej¹í, ne¾ v&nbsp;pøípadì
pou¾ití nativního Lua VM (a je¹tì pomalej¹í v&nbsp;porovnání s&nbsp;<a
href="http://www.root.cz/clanky/luajit-just-in-time-prekladac-pro-programovaci-jazyk-lua/">LuaJITem</a>),
ov¹em programátoøi získávají stoprocentní kompatibilitu s&nbsp;pùvodní
implementací programovacího jazyka Lua. Navíc je tento projekt vytvoøen takovým
zpùsobem, ¾e se do WWW stránek pøímo vkládají skripty psané v&nbsp;Lue, co¾
ostatnì uvidíme na ètveøici demonstraèních pøíkladù uvedených
v&nbsp;následujících kapitolách.</p>

<a href="http://www.root.cz/obrazek/214753/"><img src="http://i.iinfo.cz/images/204/lw2-prev.png" class="image-214753" alt="&#160;" height="222" width="370" /></a>
<p><i>Obrázek 2: O tom, ¾e se JavaScript v&nbsp;souèasnosti pou¾ívá skuteènì
jako &bdquo;assembler pro webové aplikace&ldquo; vypovídá i výsledný kód
virtuálního stroje jazyka Lua po pøekladu do JavaScriptu.</i></p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Pøíklady pou¾ití jazyka Lua na WWW stránkách</h2>

<p>V&nbsp;následujících ètyøech kapitolách si uká¾eme pou¾ití programovacího
jazyka Lua na WWW stránkách. Pøitom bude vyu¾it <a href="#k07">vý¹e zmínìný
projekt lua.vm.js</a>, co¾ znamená, ¾e pøímo v&nbsp;kódu WWW stránky bude
umístìn zdrojový kód psaný v&nbsp;jazyce <i>Lua</i> a samozøejmì i link na
virtuální stroj Luy pøelo¾ený do JavaScriptu. Tento virtuální stroj získá ze
stránky pøíslu¹ný Lua skript a spustí ho prakticky stejným zpùsobem, jakoby se
jednalo o bì¾ný JavaScriptový program.</p>



<p><a name="k09"></a></p>
<h2 id="k09">9. &bdquo;Hello World&ldquo; v&nbsp;JavaScriptu a v&nbsp;Lue</h2>

<p>Zaènìme skuteènì tím nejjednodu¹¹ím pøíkladem, kterým je (alespoò vìt¹inou)
program vypisující na výstupní zaøízení (obrazovku, plochu prohlí¾eèe atd.)
nápis &bdquo;Hello world&ldquo;. Implementace takového programu ve WWW stránce
v&nbsp;JavaScriptu vypadá následovnì (text se schválnì odli¹uje):</p>

<pre>
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hello World JS&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;script type="text/javascript"&gt;
        document.write("JavaScript says: 'Hello world!'");
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<p>Vidíme zde pou¾ití objektu <a
href="http://www.w3resource.com/javascript/client-object-property-method/document.php">document</a>
a jeho metody <a
href="http://www.w3resource.com/javascript/client-object-property-method/document-write.php">write</a>
pro tisk øetìzce pøímo do tìla HTML stránky (tedy i renderovaného
dokumentu).</p>

<a href="http://www.root.cz/obrazek/214754/"><img src="http://i.iinfo.cz/images/643/lw3-prev.png" class="image-214754" alt="&#160;" height="270" width="346" /></a>
<p><i>Obrázek 3: JavaScript spu¹tìný v&nbsp;prohlí¾eèi.</i></p>

<p>Funkènì ne sice zcela toto¾ný, ale dosti podobný, pøíklad naprogramovaný
v&nbsp;jazyce <i>Lua</i> bude vypadat následovnì:</p>

<pre>
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hello World Lua&lt;/title&gt;
        &lt;script src="lua.vm.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;script type="text/lua"&gt;
        js.global.document:write("Lua says: 'Hello world!'")
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<p>Dùle¾ité zmìny:</p>

<ol>

<li>Na zaèátku, ideálnì v&nbsp;hlavièce HTML stránky, je nutné naèíst virtuální
stroj jazyka Lua pøelo¾ený do JavaScriptu [øádek èíslo 4]</li>

<li>Skript psaný v&nbsp;jazyku Lua má typ nastavený na &bdquo;text/lua&ldquo; a
nikoli &bdquo;text/javascript&ldquo; (co¾ je pochopitelné a souèasnì i nutné,
nebo» právì tento atribut Lua VM hledá!) [øádek èíslo 7]</li>

<li>Objekt <strong>document</strong> je dostupný pod
<strong>js.global.document</strong> [øádek èíslo 7]</li>

<li>Metoda objektu se volá s&nbsp;pou¾itím operátoru dvojteèky a ne teèky (viz
<a href="http://www.lua.org/pil/16.html">PIL</a>) [øádek èíslo 8].</li>

</ol>

<a href="http://www.root.cz/obrazek/214755/"><img src="http://i.iinfo.cz/images/529/lw4-prev.png" class="image-214755" alt="&#160;" height="270" width="346" /></a>
<p><i>Obrázek 4: Skript napsaný v&nbsp;jazyce Lua byl zpracován virtuálním
strojem implementovaným v&nbsp;JavaScriptu.</i></p>



<p><a name="k10"></a></p>
<h2 id="k10">10. Pøeètení v¹ech atributù a metod objektu <strong>js</strong></h2>

<p>Pro zajímavost se podívejme na jednoduchý skript slou¾ící pro výpis v¹ech
atributù a metod objektu <strong>js</strong>, který je z&nbsp;virtuálního
stroje jazyka Lua dostupný. Samotný skript je snadno pochopitelný &ndash;
mù¾eme zde vidìt ruèní konstrukci HTML tabulky obsahující název pøíslu¹ného
atributu/metody a hodnotu. Pro jednoduchost je výpis øetìzce do HTML stránky
realizován v&nbsp;samostatné funkci nazvané <strong>write</strong>:</p>

<pre>
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;js properties&lt;/title&gt;
        &lt;script src="lua.vm.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;script type="text/lua"&gt;
        function write(what)
            js.global.document:write(what)
        end
&nbsp;
        write("&lt;table border&gt;")
        for key, value in pairs(js) do
            write("&lt;tr&gt;&lt;td&gt;")
            write(key)
            write("&lt;/td&gt;&lt;td&gt;")
            write(value)
            write("&lt;/td&gt;&lt;/tr&gt;")
        end
        write("&lt;/table&gt;")
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<a href="http://www.root.cz/obrazek/214756/"><img src="http://i.iinfo.cz/images/395/lw5-prev.png" class="image-214756" alt="&#160;" height="270" width="346" /></a>
<p><i>Obrázek 5: Druhý demonstraèní pøíklad po svém spu¹tìní
v&nbsp;prohlí¾eèi.</i></p>



<p><a name="k11"></a></p>
<h2 id="k11">11. Globální objekty dostupné programátorùm</h2>

<p>Pøedchozí demonstraèní pøíklad je mo¾né roz¹íøit takovým zpùsobem, aby
skript po svém spu¹tìní vypsal v¹echny konstanty, atributy i metody a funkce
dostupné pøes objekt <strong>js.global</strong>. Pro ukázku mo¾ností základní
knihovny jazyka Lua jsou názvy symbolù abecednì setøídìny a navíc jsou vypsány
pouze ty hodnoty, které jsou typu <i>boolean</i>, <i>string</i> nebo
<i>number</i> (typ se samozøejmì vyhodnocuje a¾ v&nbsp;dobì bìhu skriptu).
Získání tabulky v¹ech symbolù a na nì navázaných hodnot zaji¹»uje funkce
<strong>getKeys()</strong>, výpis je proveden v&nbsp;hlavní èásti aplikace
v&nbsp;programové smyèce typu <i>for-each</i>:</p>

<pre>
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;js properties&lt;/title&gt;
        &lt;script src="lua.vm.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;script type="text/lua"&gt;
        function write(what)
            js.global.document:write(what)
        end
&nbsp;
        function getKeys(tbl)
            local keys = {}
            for key, _ in pairs(tbl) do
                table.insert(keys, key)
            end
            table.sort(keys)
            return keys
        end
&nbsp;
        write("&lt;table border&gt;")
        local keys = getKeys(js.global)
        for _, key in ipairs(keys) do
           write("&lt;tr&gt;&lt;td&gt;")
           write(key)
           write("&lt;/td&gt;&lt;td&gt;")
           local value = js.global[key]
           local valueType = type(value)
           write(valueType)
           write("&lt;/td&gt;&lt;td&gt;")
           if valueType == "boolean" or valueType == "string" or valueType == "number" then
               write(value)
           end
           write("&lt;/td&gt;&lt;/tr&gt;")
        end
        write("&lt;/table&gt;")
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<a href="http://www.root.cz/obrazek/214757/"><img src="http://i.iinfo.cz/images/9/lw6-prev.png" class="image-214757" alt="&#160;" height="270" width="346" /></a>
<p><i>Obrázek 6: Tøetí demonstraèní pøíklad po svém spu¹tìní
v&nbsp;prohlí¾eèi.</i></p>

<a href="http://www.root.cz/obrazek/214758/"><img src="http://i.iinfo.cz/images/632/lw7-prev.png" class="image-214758" alt="&#160;" height="270" width="346" /></a>
<p><i>Obrázek 7: Objekty pou¾ívané pøi práci s&nbsp;obsahem HTML
stránky.</i></p>



<p><a name="k12"></a></p>
<h2 id="k12">12. Zmìna stylu (barvy) vybraného elementu</h2>

<p>Jedna z&nbsp;nejpou¾ívanìj¹ích funkcí v&nbsp;JavaScriptu pøi práci
s&nbsp;DOMem HTML stránky je funkce <i>getElementById()</i>. Tuto funkci je
samozøejmì mo¾né volat i z&nbsp;programu psaného v&nbsp;programovacím jazyce
Lua, o èem¾ je mo¾né se snadno pøesvìdèit (jen se nesmí zapomenout na to, ¾e
pøi volání metod objektù se pou¾ívá dvojteèka). V&nbsp;následujícím pøíkladu se
zmìní barva nadpisu z&nbsp;výchozí èerné na èervenou:</p>

<pre>
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;SetColor.Lua&lt;/title&gt;
        &lt;script src="lua.vm.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1 id="nadpis"&gt;Text with changed color&lt;/h1&gt;
        &lt;script type="text/lua"&gt;
        local nadpis = js.global.document:getElementById("nadpis")
        nadpis.style.color="#ff0000"
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<a href="http://www.root.cz/obrazek/214759/"><img src="http://i.iinfo.cz/images/122/lw8-prev.png" class="image-214759" alt="&#160;" height="270" width="346" /></a>
<p><i>Obrázek 8: Ètvrtý demonstraèní pøíklad po svém spu¹tìní
v&nbsp;prohlí¾eèi.</i></p>



<p><a name="k13"></a></p>
<h2 id="k13">13. Pou¾ití objektu typu <strong>canvas</strong> (2D) pro kreslení</h2>

<p>Vzhledem k&nbsp;tomu, ¾e ve skriptech psaných v&nbsp;programovacím jazyku
Lua lze pou¾ívat v¹echny objekty dostupné i JavaScriptu, není velkým problémem
zaøídit i vykreslování pøes <i>canvas</i>, resp.&nbsp;pøesnìji øeèeno pøes 2D
kontext (samozøejmì by bylo mo¾né pou¾ít i 3D komplex, ov¹em netøeba vìci
komplikovat více, ne¾ je to pro demonstraci nutné). V&nbsp;dne¹ním posledním
demonstraèním pøíkladu se vykreslí èást barvové palety s&nbsp;vyu¾itím
rùznobarevných ètvercù. Pro pøevod èíselných hodnot barvových slo¾ek na
odpovídající kód je pro jednoduchost pou¾ita funkce
<strong>string:format</strong>:</p>

<pre>
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;CanvasTest.Lua&lt;/title&gt;
        &lt;script src="lua.vm.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;canvas id="canvas" width="400" height="400"&gt;&lt;/canvas&gt;
        &lt;script type="text/lua"&gt;
         local canvas = js.global.document:getElementById("canvas")
         local renderingContext = canvas:getContext("2d");
&nbsp;
         for i=0,8 do
             for j=0,8 do
                 local color = string.format("#%02x%02x%02x", i*31, j*31, 80)
                 renderingContext.fillStyle = color
                 renderingContext:fillRect(j*20, i*20, 20, 20)
             end
         end
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<p>Poznámka: pov¹imnìte si rozdílu mezi pou¾itím teèky (nastavení stylu
vykreslování) a dvojteèky (volání metody objektu, zde konkrétnì objektu
<strong>renderingContext</strong>).</p>

<a href="http://www.root.cz/obrazek/214760/"><img src="http://i.iinfo.cz/images/77/lw9-prev.png" class="image-214760" alt="&#160;" height="270" width="345" /></a>
<p><i>Obrázek 9: Pátý demonstraèní pøíklad po svém spu¹tìní
v&nbsp;prohlí¾eèi.</i></p>



<p><a name="k14"></a></p>
<h2 id="k14">14. Odkazy na Internetu</h2>

<ol>

<li>The Lua VM, on the Web<br />
<a href="https://kripken.github.io/lua.vm.js/lua.vm.js.html">https://kripken.github.io/lua.vm.js/lua.vm.js.html</a>
</li>

<li>Lua.vm.js REPL<br />
<a href="https://kripken.github.io/lua.vm.js/repl.html">https://kripken.github.io/lua.vm.js/repl.html</a>
</li>

<li>lua2js<br />
<a href="https://www.npmjs.com/package/lua2js">https://www.npmjs.com/package/lua2js</a>
</li>

<li>lua2js na GitHubu<br />
<a href="https://github.com/basicer/lua2js-dist">https://github.com/basicer/lua2js-dist</a>
</li>

<li>Seriál o programovacím jazyku Lua<br />
<a href="http://www.root.cz/serialy/programovaci-jazyk-lua/">http://www.root.cz/serialy/programovaci-jazyk-lua/</a>
</li>

<li>Source-to-source compiler<br />
<a href="https://en.wikipedia.org/wiki/Source-to-source_compiler">https://en.wikipedia.org/wiki/Source-to-source_compiler</a>
</li>

<li>JavaScript is Assembly Language for the Web: Sematic Markup is Dead! Clean vs. Machine-coded HTML<br />
<a href="http://www.hanselman.com/blog/JavaScriptIsAssemblyLanguageForTheWebSematicMarkupIsDeadCleanVsMachinecodedHTML.aspx">http://www.hanselman.com/blog/JavaScriptIsAssemblyLanguageForTheWebSematicMarkupIsDeadCleanVsMachinecodedHTML.aspx</a>
</li>

<li>JavaScript is Web Assembly Language and that's OK.<br />
<a href="http://www.hanselman.com/blog/JavaScriptIsWebAssemblyLanguageAndThatsOK.aspx">http://www.hanselman.com/blog/JavaScriptIsWebAssemblyLanguageAndThatsOK.aspx</a>
</li>

<li>Dart<br />
<a href="https://www.dartlang.org/">https://www.dartlang.org/</a>
</li>

<li>CoffeeScript<br />
<a href="http://coffeescript.org/">http://coffeescript.org/</a>
</li>

<li>TypeScript<br />
<a href="http://www.typescriptlang.org/">http://www.typescriptlang.org/</a>
</li>

<li>Lua (programming language)<br />
<a href="http://en.wikipedia.org/wiki/Lua_(programming_language)">http://en.wikipedia.org/wiki/Lua_(programming_language)</a>
</li>

<li>Static single assignment form (SSA)<br />
<a href="http://en.wikipedia.org/wiki/Static_single_assignment_form">http://en.wikipedia.org/wiki/Static_single_assignment_form</a>
</li>

<li>LuaJIT 2.0 SSA IR
<a href="http://wiki.luajit.org/SSA-IR-2.0">http://wiki.luajit.org/SSA-IR-2.0</a>
</li>

<li>The LuaJIT Project<br />
<a href="http://luajit.org/index.html">http://luajit.org/index.html</a>
</li>

<li>LuaJIT FAQ<br />
<a href="http://luajit.org/faq.html">http://luajit.org/faq.html</a>
</li>

<li>LuaJIT Performance Comparison<br />
<a href="http://luajit.org/performance.html">http://luajit.org/performance.html</a>
</li>

<li>LuaJIT 2.0 intellectual property disclosure and research opportunities<br />
<a href="http://article.gmane.org/gmane.comp.lang.lua.general/58908">http://article.gmane.org/gmane.comp.lang.lua.general/58908</a>
</li>

<li>LuaJIT Wiki<br />
<a href="http://wiki.luajit.org/Home">http://wiki.luajit.org/Home</a>
</li>

<li>LuaJIT 2.0 Bytecode Instructions<br />
<a href="http://wiki.luajit.org/Bytecode-2.0">http://wiki.luajit.org/Bytecode-2.0</a>
</li>

<li>Programming in Lua (first edition)<br />
<a href="http://www.lua.org/pil/contents.html">http://www.lua.org/pil/contents.html</a>
</li>

<li>Lua 5.2 sources<br />
<a href="http://www.lua.org/source/5.2/">http://www.lua.org/source/5.2/</a>
</li>

<li>Tcl Plugin Version 3<br />
<a href="http://www.tcl.tk/software/plugin/">http://www.tcl.tk/software/plugin/</a>
</li>

<li>JavaScript: The Web Assembly Language?<br />
<a href="http://www.informit.com/articles/article.aspx?p=1856657">http://www.informit.com/articles/article.aspx?p=1856657</a>
</li>

<li>asm.js<br />
<a href="http://asmjs.org/">http://asmjs.org/</a>
</li>

<li>List of languages that compile to JS<br />
<a href="https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS">https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS</a>
</li>

<li>REPL<br />
<a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop</a>
</li>

<li>The LLVM Compiler Infrastructure<br />
<a href="http://llvm.org/ProjectsWithLLVM/">http://llvm.org/ProjectsWithLLVM/</a>
</li>

<li>clang: a C language family frontend for LLVM<br />
<a href="http://clang.llvm.org/">http://clang.llvm.org/</a>
</li>

<li>emscripten<br />
<a href="http://kripken.github.io/emscripten-site/">http://kripken.github.io/emscripten-site/</a>
</li>

<li>LLVM Backend ("Fastcomp")<br />
<a href="http://kripken.github.io/emscripten-site/docs/building_from_source/LLVM-Backend.html#llvm-backend">http://kripken.github.io/emscripten-site/docs/building_from_source/LLVM-Backend.html#llvm-backend</a>
</li>

<li>Emscripten - Fastcomp na GitHubu<br />
<a href="https://github.com/kripken/emscripten-fastcomp">https://github.com/kripken/emscripten-fastcomp</a>
</li>

<li>Clang (pro Emscripten) na GitHubu<br />
<a href="https://github.com/kripken/emscripten-fastcomp-clang">https://github.com/kripken/emscripten-fastcomp-clang</a>
</li>

<li>Why not use JavaScript?<br />
<a href="https://ckknight.github.io/gorillascript/">https://ckknight.github.io/gorillascript/</a>
</li>

</ol>


<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2015</small></p>
</body>
</html>

