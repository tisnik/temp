<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Programujeme ve Factoru</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Programujeme ve Factoru</h1>

<h3>Pavel Ti¹novský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Ve druhé èásti èlánku o netradièním programovacím jazyce Factor si uká¾eme základní i pokroèilej¹í programátorské postupy, které je mo¾né v tomto jazyku pou¾ívat pøi tvorbì aplikací, zejména práci se zásobníkem operandù a úschovným zásobníkem. Také si popí¹eme zpùsob práce se základními datovými typy.</p>



<h1>Obsah</h1>
<p>
<a href="#k01">1. Zásobníkový efekt (stack effect)</a><br />
<a href="#k02">2. Operátory urèené pro manipulaci se zásobníkem</a><br />
<a href="#k03">3. Operátory slou¾ící pro odstranìní polo¾ek ze zásobníku</a><br />
<a href="#k04">4. Operátory slou¾ící pro vytvoøení kopie (duplikaci) polo¾ek na zásobníku</a><br />
<a href="#k05">5. Operátory slou¾ící pro zmìnu poøadí polo¾ek na zásobníku</a><br />
<a href="#k06">6. Operátory urèené pro manipulaci s&nbsp;úschovným zásobníkem</a><br />
<a href="#k07">7. Základní datové typy</a><br />
<a href="#k08">8. Matematické operace</a><br />
<a href="#k09">9. Obsah tøetí èásti èlánku o programovacím jazyku Factor</a><br />
</p>



<p><a name="k01"></a></p>
<h1>1. Zásobníkový efekt (stack effect)</h1>

<p>V&nbsp;prakticky v¹ech programovacích jazycích, které pro vyhodnocování
matematických, logických a dal¹ích výrazù pou¾ívají zásobník, se vyskytuje
mno¾ina pøíkazù (mù¾eme jim øíkat i <i>operátory</i> èi <i>slova</i>), které
slou¾í pro manipulaci se zásobníkem, resp.&nbsp;pro manipulaci s&nbsp;hodnotami
ulo¾enými na zásobníku, konkrétnì blízko jeho vrcholu. Vzhledem
k&nbsp;existenci tìchto operátorù se ji¾ nejedná o èistì postfixové jazyky. Ty
jsou samy o sobì sice dùle¾ité z&nbsp;teoretického hlediska (existují napøíklad
jednozásobníkové èi vícezásobníkové automaty), ov¹em z&nbsp;hlediska
praktického je dùle¾ité s&nbsp;polo¾kami ulo¾enými na zásobníku manipulovat,
zejména v&nbsp;jazycích, ve kterých se nepou¾ívají promìnné, nebo je vyu¾ití
promìnných z&nbsp;rùzných dùvodù omezeno, napøíklad kvùli vìt¹ím mo¾nostem
refaktoringu a jednotkových testù.</p>

<p>Dále popsaná skupina operátorù jazyka <strong>Factor</strong> je
z&nbsp;velké èásti inspirována <strong>Forthem</strong> Chucka Moorea a
èásteènì také <strong>PostScriptem</strong> (jazykem urèeným pro popis tiskové
stránky od firmy Adobe Systems). Bli¾¹í informace o tìchto jazycích je mo¾né
nalézt napøíklad v&nbsp;seriálu <a
href="http://www.root.cz/serialy/programovaci-jazyk-forth/">Programovací jazyk
Forth</a> a <a
href="http://www.root.cz/clanky/graficky-metaformat-postscript/">Grafické
formáty</a>. U¾ pøed nìkolika desítkami let programátoøi pí¹ící aplikace
v&nbsp;programovacím jazyce <strong>Forth</strong> pou¾ívali pro popis vlivu
slov (pøíkazù) na polo¾ky ulo¾ené na zásobníku takzvaný <i>zásobníkový efekt
(stack effect)</i>. Pro dal¹í ètení je dùle¾ité si ètení zásobníkového efektu
osvojit.</p>

<p>Nejedná se ve své podstatì o nic slo¾itého: uvnitø kulatých závorek, které
ve <strong>Forthu</strong> i <strong>Factoru</strong> znaèí zaèátek a konec
poznámky se zásobníkovým efektem, je symbolicky zapsán stav èásti zásobníku
<i>pøed</i> provedením operace a po dvojici znakù <strong>--</strong> stav
zásobníku <i>po</i> provedení dané operace. Vzhledem k&nbsp;tomu, ¾e na
zásobníku mù¾e být ulo¾eno teoreticky libovolné mno¾ství hodnot a daná operace
vìt¹inou ovlivòuje pouze hodnoty umístìné blízko jeho vrcholu, je
<i>zásobníkový efekt</i> zapsán pouze pro ty pozice na zásobníku, které jsou
operací nìjakým zpùsobem dotèeny, tj.&nbsp;operace tyto hodnoty pøeète, zru¹í
èi modifikuje. Polo¾ky umístìné ní¾e nemá cenu zapisovat, jen by zápis zbyteènì
komplikovaly. Polo¾ka umístìná nejvíce vlevo je ve skuteènosti ulo¾ena na
spodnìj¹ích místech zásobníku, ne¾ polo¾ky napravo od ní.</p>

<image id="5658" original="no" />
<p-center>Ve vývojovém prostøedí <strong>Factoru</strong> se zásobníkový efekt vypisuje pro ka¾dý známý operátor na informaèním øádku (ten je zobrazený v&nbsp;inverzních barvách ve spodní èásti okna)</p-center>

<p>Následuje jednoduchý pøíklad zápisu <i>zásobníkového efektu</i> pro operaci
souètu dvou èísel. Nejprve je zapsán název operace, v&nbsp;tomto pøípadì
nazvané <strong>plus</strong>. Poté je zapsána otevírací kulatá závorka znaèící
zaèátek poznámky, za ní¾ následuje stav nejvy¹¹ích polo¾ek zásobníku
<i>pøed</i> provedením operace. Po oddìlovaèi pøedstavovaném dvojicí znakù
<strong>--</strong> je uveden stav nejvy¹¹ích polo¾ek <i>po</i> provedení
operace, za ním¾ následuje uzavírací kulatá závorka znaèící konec poznámky (ve
skuteènosti jsou i kulaté závorky bì¾nými slovy jazyka a proto musí být od
okolních slov oddìleny alespoò jednou mezerou).</p>

<p>Vzhledem k&nbsp;tomu, ¾e operace sèítání naète dvì hodnoty ze zásobníku a
zpìt vlo¾í jejich souèet, jsou pou¾ity odli¹né symboly <strong>x</strong>,
<strong>y</strong> a <strong>z</strong>, pøièem¾ samozøejmì platí, ¾e
<i>z=x+y</i>:</p>

<code-area>! "hlavièka" operátoru plus
plus ( x y -- z )
</code-area>

<p>Pokud by nìjaká operace napøíklad prohazovala hodnoty ulo¾ené na zásobníku,
ale jinak by je ¾ádným zpùsobem nemìnila, byly by pou¾ity stejné symboly, co¾
je pøípad dále popsaného operátoru <strong>swap</strong> èi
<strong>rot</strong>.</p>

<code-area>! "hlavièka" operátorù swap a rot
swap ( x y -- y x )
rot  ( x y z -- y z x )
</code-area>



<p><a name="k02"></a></p>
<h1>2. Operátory urèené pro manipulaci se zásobníkem</h1>

<p>Prakticky ve v¹ech programech napsaných v&nbsp;programovacím jazyku
<strong>Factor</strong> se nevyhneme manipulaci s&nbsp;hodnotami ulo¾enými na
zásobníku. Je to pøedev¹ím z&nbsp;toho dùvodu, ¾e je sice mo¾né pro meziúschovu
hodnot pou¾ít promìnné (tak jako ve vìt¹inì imperativních jazycích), ale není
to pøíli¹ vhodné, a» u¾ z&nbsp;hlediska roz¹iøitelnosti nebo testovatelnosti
programu (kód mající za vstup i výstup pouze zásobník je od ostatního kódu
velmi izolovaný a tím pádem i pøenositelný a snadno testovatelný).</p>

<p>Mezi operátory, pomocí kterých lze v&nbsp;programovacím jazyce
<strong>Factor</strong> manipulovat se zásobníkem, patøí pøedev¹ím operátory
pro odstranìní polo¾ek ze zásobníku (<i>dropping</i>), operátory pro kopie
(duplikace) hodnot umístìných na zásobníku (<i>duplicating</i>), operátory pro
zmìnu poøadí polo¾ek umístìných na zásobníku a koneènì operátory, které
manipulují s&nbsp;takzvaným úschovným zásobníkem (<i>retain stack</i>), který
ve <strong>Factoru</strong> nahrazuje zásobník návratových adres (<i>return
stack</i>) známý pøedev¹ím z&nbsp;programovacího jazyka
<strong>Forth</strong>.</p>

<image id="5659" original="no" />
<p-center>Takzvaný <strong>browser</strong> ve vývojovém prostøedí <strong>Factoru</strong> slou¾í pøedev¹ím k&nbsp;procházení dokumentace</p-center>



<p><a name="k03"></a></p>
<h1>3. Operátory slou¾ící pro odstranìní polo¾ek ze zásobníku</h1>

<p>Tyto operátory slou¾í pro odstranìní jedné nebo více hodnot, je¾ se nachází
buï pøímo na vrcholu zásobníku (<i>TOS &ndash; Top Of Stack</i>) nebo na
nejbli¾¹ích ni¾¹ích místech. V&nbsp;mnoha pøípadech se pøi programování setkáme
s&nbsp;tím, ¾e nìjaká operace zanechala na zásobníku hodnotu, kterou ji¾ pro
dal¹í práci nepotøebujeme (také se mù¾e jednat o hodnotu, kterou tam
z&nbsp;urèitého dùvodu vlo¾il sám programátor). Z&nbsp;toho dùvodu je mo¾né
pou¾ít jeden z&nbsp;ní¾e uvedených "mazacích" operátorù nebo si napsat operátor
vlastní. Názvy tìchto operátorù se vyskytly ji¾ v&nbsp;jazyce
<strong>Forth</strong>. Operátory <strong>2drop</strong> a
<strong>3drop</strong> jsou vlastnì pouze zkratkami programù <strong>drop
drop</strong> a <strong>drop drop drop</strong>:</p>

<table>
<tr><th>Operace</th><th>Zásobníkový efekt</th><th>Popis</th></tr>
<tr><td>drop </td><td>( x -- )      </td><td>odstranìní hodnoty z&nbsp;vrcholu zásobníku (TOS)</td></tr>
<tr><td>2drop</td><td>( x y -- )    </td><td>odstranìní hodnot z&nbsp;vrcholu zásobníku (TOS) a místa pod vrcholem</td></tr>
<tr><td>3drop</td><td>( x y z -- )  </td><td>odstranìní tøí nejvy¹¹ích polo¾ek ze zásobníku</td></tr>
<tr><td>nip  </td><td>( x y -- y )  </td><td>odstranìní pouze druhé nejvy¹¹í polo¾ky ze zásobníku</td></tr>
<tr><td>2nip </td><td>( x y z -- z )</td><td>odstranìní druhé a tøetí nejvy¹¹í polo¾ky ze zásobníku</td></tr>
</table>

<image id="5660" original="no" />
<p-center>Trasování programu pøi výskytu chyby v&nbsp;integrovaném vývojovém prostøedí <strong>Factoru</strong></p-center>



<p><a name="k04"></a></p>
<h1>4. Operátory slou¾ící pro vytvoøení kopie (duplikaci) polo¾ek na zásobníku</h1>

<p>Prakticky stejnì èasto jako odstraòování polo¾ek ze zásobníku potøebujeme i
jejich kopii èili &ndash; øeèeno jazykem Chucka Moorea &ndash; duplikaci.
Napøíklad vìt¹ina aritmetických operací, mezi nì¾ patøí i operace
<strong>+</strong>, <strong>max</strong>, <strong>floor</strong> nebo
<strong>neg</strong>, automaticky odstraòuje své operandy a nìkdy nastane
situace, kdy je pùvodní hodnota dùle¾itá pro dal¹í výpoèet. Právì tehdy se
vyu¾ijí následující operace. V¹imnìte si odli¹nosti vlivu operátoru
<strong>2dup</strong> od kódu <strong>dup dup</strong>. V&nbsp;obou pøípadech
se sice na zásobníku objeví dvì dal¹í polo¾ky, ov¹em s&nbsp;rozdílnými
hodnotami.</p>

<table>
<tr><th>Operace</th><th>Zásobníkový efekt</th><th>Popis</th></tr>
<tr><td>dup </td><td>( x -- x x )            </td><td>duplikace hodnoty ulo¾ené na vrcholu zásobníku</td></tr>
<tr><td>2dup</td><td>( x y -- x y x y )      </td><td>duplikace dvou nejvy¹¹ích hodnot na zásobníku se zachováním poøadí</td></tr>
<tr><td>3dup</td><td>( x y z -- x y z x y z )</td><td>duplikace tøí nejvy¹¹ích hodnot na zásobníku se zachování jejich poøadí</td></tr>
<tr><td>dupd</td><td>( x y -- x x y )        </td><td>duplikace hodnoty ulo¾ené tìsnì pod vrcholem zásobníku</td></tr>
<tr><td>over</td><td>( x y -- x y x )        </td><td>hodnota ulo¾ená tìsnì pod vrcholem zásobníku je okopírována na jeho vrchol</td></tr>
<tr><td>pick</td><td>( x y z -- x y z x )    </td><td>podobné operaci <strong>over</strong>, ale vybírá se tøetí nejvy¹¹í hodnota</td></tr>
<tr><td>tuck</td><td>( x y -- y x y )        </td><td>polo¾ka le¾ící na vrcholu zásobníku je zduplikována na tøetí místo</td></tr>
</table>



<p><a name="k05"></a></p>
<h1>5. Operátory slou¾ící pro zmìnu poøadí polo¾ek na zásobníku</h1>

<p>Vzhledem k&nbsp;tomu, ¾e v&nbsp;programovacím jazyce <strong>Factor</strong>
se promìnné vyu¾ívají jen v&nbsp;minimální míøe, se mù¾e velmi èasto stát, ¾e
hodnoty na zásobníku jsou ulo¾eny v&nbsp;jiném poøadí, ne¾ je pro nìkteré
funkce ¾ádoucí. Zatímco napøíklad pøi pou¾ití operátoru <strong>+</strong>,
<strong>*</strong>, <strong>max</strong> èi <strong>min</strong> na poøadí
polo¾ek ve své podstatì vùbec nezále¾í, je tomu u operátoru <strong>-</strong>,
<strong>/</strong> èi dokonce <strong>^</strong> pøesnì naopak. Pro
"pøerovnání" zásobníku slou¾í následující operátory, které mù¾eme najít i ve
vìt¹inì implementací programovacího jazyka <strong>Forth</strong>.</p>

<table>
<tr><th>Operace</th><th>Zásobníkový efekt</th><th>Popis</th></tr>
<tr><td>swap </td><td>( x y -- y x )        </td><td>prohození dvou nejvy¹¹ích polo¾ek na zásobníku</td></tr>
<tr><td>swapd</td><td>( x y z -- y x z )    </td><td>prohození druhé a tøetí nejvy¹¹í polo¾ky</td></tr>
<tr><td>rot  </td><td>( x y z -- y z x )    </td><td>"rotace" tøí nejvy¹¹ích polo¾ek ulo¾ených na zásobníku</td></tr>
<tr><td>-rot </td><td>( x y z -- z x y )    </td><td>zpìtná "rotace" tøí nejvy¹¹ích polo¾ek ulo¾ených na zásobníku</td></tr>
<tr><td>roll </td><td>( x y z t -- y z t x )</td><td>podobné operaci <strong>rot</strong>, ale provádìné se ètyømi polo¾kami</td></tr>
<tr><td>-roll</td><td>( x y z t -- t x y z )</td><td>podobné operaci <strong>-rot</strong>, ale provádìné se ètyømi polo¾kami</td></tr>
</table>

<p>Operátory <strong>roll</strong> a <strong>-roll</strong> jsou ponìkud
výjimeèné tím, ¾e zasahují a¾ na ètvrtou nejvy¹¹í polo¾ku zásobníku a proto je
nìkteøí autoøi nedoporuèují pou¾ívat, pøedev¹ím z&nbsp;dùvodu relativní
slo¾itosti pochopení jejich funkce v&nbsp;programu.</p>

<image id="5661" original="no" />
<p-center><strong>Inspektor</strong> v&nbsp;integrovaném vývojovém prostøedí <strong>Factoru</strong> slou¾í pro výpis a navigaci mezi rùznými programovými objekty</p-center>



<p><a name="k06"></a></p>
<h1>6. Operátory urèené pro manipulaci s&nbsp;úschovným zásobníkem</h1>

<p>U¾ v&nbsp;programovacím jazyku <strong>Forth</strong> (<a
href="http://www.root.cz/serialy/programovaci-jazyk-forth/">http://www.root.cz/serialy/programovaci-jazyk-forth/</a>)
jsme se mohli setkat s&nbsp;dvojicí zásobníkù. Prvním zásobníkem je <i>zásobník
operandù (operand stack)</i>, druhým zásobníkem pak <i>zásobník návratových
adres (return stack)</i>. V¹echny operátory, které byly popsány
v&nbsp;pøedchozích kapitolách, manipulovaly s&nbsp;obsahem zásobníku operandù.
Stejnì tak i matematické operace popsané dále pracují se zásobníkem operandù.
To nám v&nbsp;naprosté vìt¹inì pøípadù vyhovuje.</p>

<p>Ov¹em v&nbsp;nìkterých pøípadech mù¾e být vhodné si nìkterou hodnotu ze
zásobníku operandù "odlo¾it" a po nìjakém èase zase vrátit na jeho vrchol.
Právì k&nbsp;tomuto úèelu bylo ve <strong>Forthu</strong> mo¾né pou¾ít zásobník
návratových adres, který kromì této funkcionality slou¾il &ndash; jak jeho
název napovídá &ndash; k&nbsp;ukládání návratových adres jednotlivých volaných
slov (operandù). Z&nbsp;tohoto dùvodu bylo absolutnì nutné pøed ukonèením
daného slova obnovit obsah zásobníku návratových adres, proto¾e jinak by
interpret pøi návratu skoèil na ¹patné místo v&nbsp;pamìti. Tomuto postupu se
nìkdy øíká <i>vyva¾ování zásobníku (stack ballancing)</i>.</p>

<p>Programovací jazyk <strong>Factor</strong> nám nedovolí pøímý pøístup
k&nbsp;návratovým adresám, pokud tedy nepou¾ijeme funkce pro práci s&nbsp;VM
(virtuálním strojem, i to je toti¾ mo¾né, i kdy¾ se u intepretovaného kódu
adresy mohou mìnit). Naproti tomu existuje velké mno¾ství algoritmù, které by
se vyu¾itím dal¹ího zásobníku do znaèné zpøehlednily, proto¾e by operátory
mohly pøímo pøistupovat k&nbsp;ní¾e polo¾eným hodnotám na zásobníku. Proto je
ve <strong>Factoru</strong> vytvoøen i takzvaný <i>úschovný zásobník (retain
stack)</i>, který plní pøi manipulaci s&nbsp;hodnotami podobnou funkci jako
Forthovský zásobník návratových adres. I tento zásobník je nutné vyva¾ovat, co¾
je èásteènì hlídáno samotným interpretrem. Vzhledem k&nbsp;vhodnì zvolenému
názvu &ndash; <i>retain stack</i> vs <i>return stack</i> &ndash; jsou i slova
pracující s&nbsp;tímto pomocným zásobníkem stejná, jako v&nbsp;pùvodním
<strong>Forthu</strong>:</p>

<table>
<tr><th>Operace</th><th>Zásobníkový efekt</th><th>Popis</th></tr>
<tr><td>&gt;r</td><td>( x -- )</td><td>hodnota ulo¾ená na vrcholu zásobníku (operandù) je pøenesena na úschovný zásobník</td></tr>
<tr><td>r&gt;</td><td>( -- x )</td><td>hodnota ulo¾ená na vrcholu úschovného zásobníku je pøenesena na vrchol zásobníku operandù</td></tr>
</table>

<p>V¹imnìte si, ¾e ¾ádné dal¹í operace není mo¾né s&nbsp;úschovným zásobníkem
pøímo provádìt, tj.&nbsp;není zde napøíklad pøíkaz podobný
<strong>dup</strong>, <strong>swap</strong> èi <strong>rot</strong>.
Z&nbsp;tohoto dùvodu je nutné se na úschovný zásobník dívat jako na skuteèný
zásobník, s&nbsp;jeho¾ polo¾kami se dá manipulovat pouze pomocí jejich vkládání
(<i>push</i>) èi naopak vyjímání (<i>pop</i>). V&nbsp;pøípadì, ¾e jste stejnì
jako já zvyklí spí¹e na "pøiøazovací" a ne "pøesunovací" operace, mù¾ete si
vytvoøit dvì nová slova pro pøesun hodnot z&nbsp;a na úschovný zásobník. Slova
se ve <strong>Factoru</strong> vytváøí naprosto stejným zpùsobem jako ve
<strong>Forthu</strong>, tj.&nbsp;znak <strong>:</strong> znaèí zaèátek
definice slova (pøepnutí do re¾imu pøekladu) a znak <strong>;</strong> znaèí
pøíkaz <strong>return</strong> a souèasnì také konec definice slova:</p>

<code-area>

: r&lt; &gt;r ;
: &lt;r r&gt; ;

</code-area>

<p>Nová slova si mù¾eme velmi snadno otestovat:</p>

<code-area>

<i>! ulo¾ení hodnoty 10 na zásobník operandù</i>
<strong>10</strong>

<i>! pøesun této hodnoty na úschovný zásobník</i>
<i>! (zásobník operandù se vyprázdní)</i>
<strong>r&lt;</strong>

<i>! tisk obsahu zásobníku operandù</i>
<strong>.s</strong>
_

<i>! pøesun hodnoty z úschovného zásobníku</i>
<i>! na vrchol zásobníku operandù</i>
<strong>&lt;r</strong>

<i>! tisk obsahu zásobníku operandù</i>
<strong>.s</strong>
10

</code-area>

<image id="5662" original="no" />
<p-center><strong>Walker</strong> v integrovaném vývojovém prostøedí <strong>Factoru</strong> vyu¾ívá ve vìt¹í míøe reflexe</p-center>



<p><a name="k07"></a></p>
<h1>7. Základní datové typy</h1>

<p>Mezi základní datové typy, které mohou být pøímo ukládány na zásobník
operandù i na úschovný zásobník, patøí samozøejmì numerické hodnoty, podobnì
jako v&nbsp;mnoha dal¹ích programovacích jazycích. Kromì datových typù
odpovídajících mo¾nostem daného procesoru èi matematického koprocesoru
(<i>fixnum</i>, <i>float</i>) jsou ve <strong>Factoru</strong> dostupné i
datové typy, které musí být internì zpracovávány slo¾itìj¹ím, a tím pádem i
pomalej¹ím, zpùsobem (<i>bignum</i>, <i>ratio</i>, <i>complex</i>):</p>

<table>
<tr><th>Název typu</th><th>Význam</th></tr>
<tr><td>fixnum</td><td>celé èíslo s&nbsp;velikostí odpovídající ¹íøce slova procesoru</td></tr>
<tr><td>bignum</td><td>celé èíslo s&nbsp;prakticky neomezeným rozsahem hodnot</td></tr>
<tr><td>ratio</td><td>racionální èísla zapisovaná ve formì zlomku m/n</td></tr>
<tr><td>float</td><td>obecnì iracionální èísla internì reprezentovaná ve formì mantissa&times;2<sup>exponent</sup></td></tr>
<tr><td>complex</td><td>komplexní èísla</td></tr>
</table>

<p>Ji¾ ze zápisu èíselného literálu (konstanty) interpretr pozná, o jaký typ se
jedná:</p>

<code-area>! rozli¹ení typu èíselné hodnoty
42           ! jedná se o numerický typ fixnum
123456789000 ! jedná se o numerický typ bignum
1/3          ! jedná se o numerický typ ratio
1.3          ! jedná se o numerický typ float
C{ 1 2 }     ! komplexní èíslo
</code-area>

<p>O objektech jsme si prozatím nic neøíkali, ale u¾ z&nbsp;pøedchozího zápisu
je zøejmé, ¾e komplexní èísla jsou pøedstavována zvlá¹tním typem zabudovaného
objektu. Zajímavý je také zápis racionálních èísel pomocí zlomku. To je
umo¾nìno mj.&nbsp;i díky tomu, ¾e pøi pou¾ití postfixové notace se prakticky
v¹echny ASCII znaky typu +, -, *, /, #, @ apod. mohou nacházet i uvnitø
identifikátorù, zatímco v&nbsp;jazycích pou¾ívajících infixovou notaci tomu tak
v&nbsp;naprosté vìt¹inì pøípadù být nemù¾e. Racionální èísla jsou automaticky
normalizována, tj.&nbsp;zlomek je do nejvy¹¹í mo¾né míry zjednodu¹en
(oblíbená èást støedo¹kolské matematiky :-) Tøídu, do které spadá hodnota
ulo¾ená na vrcholu zásobníku je mo¾né zjistit velmi jednodu¹e voláním operátoru
<strong>class</strong>, který na zásobník vrací jméno pøíslu¹né tøídy:</p>

<code-area>! rozli¹ení tøídy, do které spadá èíselná hodnota
<strong>42 class .</strong>
fixnum

<strong>123456789000 class .</strong>
bignum
</code-area>

<image id="5663" original="no" />
<p-center><strong>Listener</strong> v integrovaném vývojovém prostøedí <strong>Factoru</strong></p-center>



<p><a name="k08"></a></p>
<h1>8. Matematické operace</h1>

<p>S&nbsp;numerickými hodnotami ulo¾enými na zásobníku je mo¾né provádìt velké
mno¾ství matematických operací. Ve <strong>Factoru</strong> se do velké míry
pou¾ívá vlastnost typická i pro dal¹í zásobníkové jazyky &ndash; matematická
operace (funkce) mù¾e vracet více výsledkù, které jsou v&nbsp;pøesnì
definovaném poøadí ulo¾eny na zásobník. Jedná se napøíklad o následující
operace:</p>

<table>
<tr><th>Operace (slovo)</th><th>Zásobníkový efekt</th><th>Význam</th></tr>
<tr><td>&lt;        </td><td>( x y -- ? )        </td><td>porovnání dvou numerických hodnot</td></tr>
<tr><td>&lt;=       </td><td>( x y -- ? )        </td><td>porovnání dvou numerických hodnot</td></tr>
<tr><td>&gt;        </td><td>( x y -- ? )        </td><td>porovnání dvou numerických hodnot</td></tr>
<tr><td>&gt;=       </td><td>( x y -- ? )        </td><td>porovnání dvou numerických hodnot</td></tr>
<tr><td>~           </td><td>( x y epsilon -- ? )</td><td>porovnání, zda se reálná èísla li¹í o hodnotu vy¹¹í ne¾ epsilon</td></tr>
<tr><td>fixnum?     </td><td>( object -- ? )     </td><td>test, zda je objekt typu fixnum</td></tr>
<tr><td>bignum?     </td><td>( object -- ? )     </td><td>test, zda je objekt typu bignum</td></tr>
<tr><td>even?       </td><td>( n -- ? )          </td><td>test, zda je celé èíslo sudé</td></tr>
<tr><td>odd?        </td><td>( n -- ? )          </td><td>test, zda je celé èíslo liché</td></tr>
<tr><td>power-of-2? </td><td>( n -- ? )          </td><td>test, zda je celé èíslo mocninou dvou</td></tr>
<tr><td>zero?       </td><td>( x -- ? )          </td><td>test na nulovost hodnoty</td></tr>
<tr><td>between?    </td><td>( x y z -- ? )      </td><td>test, zda hodnota x le¾í v zadaném intervalu</td></tr>
<tr><td>+           </td><td>( x y -- z )        </td><td>souèet</td></tr>
<tr><td>-           </td><td>( x y -- z )        </td><td>rozdíl</td></tr>
<tr><td>*           </td><td>( x y -- z )        </td><td>souèin</td></tr>
<tr><td>/           </td><td>( x y -- z )        </td><td>podíl</td></tr>
<tr><td>/f          </td><td>( x y -- z )        </td><td>podíl dvou reálných èísel</td></tr>
<tr><td>mod         </td><td>( x y -- z )        </td><td>dìlení modulo</td></tr>
<tr><td>/mod        </td><td>( x y -- z w )      </td><td>podíl a zbytek po dìlení</td></tr>
<tr><td>neg         </td><td>( x -- -x )         </td><td>zmìna znaménka</td></tr>
<tr><td>recip       </td><td>( x -- y )          </td><td>výpoèet pøevrácené hodnoty</td></tr>
<tr><td>1+          </td><td>( x -- y )          </td><td>inkrementace (obdoba céèkového operátoru ++)</td></tr>
<tr><td>1-          </td><td>( x -- y )          </td><td>dekrementace (obdoba céèkového operátoru --)</td></tr>
<tr><td>min         </td><td>( x y -- z )        </td><td>výpoèet minima dvou hodnot</td></tr>
<tr><td>max         </td><td>( x y -- z )        </td><td>výpoèet maxima dvou hodnot</td></tr>
<tr><td>sgn         </td><td>( x -- n )          </td><td>vyjádøení znaménka èi nulovosti èísla</td></tr>
<tr><td>ceiling     </td><td>( x -- y )          </td><td>zaokrouhlení èísla smìrem nahoru</td></tr>
<tr><td>floor       </td><td>( x -- y )          </td><td>zaokrouhlení èísla smìrem dolù</td></tr>
<tr><td>truncate    </td><td>( x -- y )          </td><td>odøíznutí desetinné èásti</td></tr>
<tr><td>round       </td><td>( x -- y )          </td><td>zaokrouhlení èísla na nejbli¾¹í celé èíslo</td></tr>
<tr><td>&gt;fixnum  </td><td>( x -- n )          </td><td>pøevod objektu na èíslo typu fixnum</td></tr>
<tr><td>&gt;bignum  </td><td>( x -- n )          </td><td>pøevod objektu na èíslo typu bignum</td></tr>
<tr><td>&gt;fraction</td><td>( a/b -- a b )      </td><td>pøevod racionálního èísla na èitatele a jmenovatele</td></tr>
<tr><td>numerator   </td><td>( a/b -- a )        </td><td>získání hodnoty èitatele (celé èíslo)</td></tr>
<tr><td>denominator </td><td>( a/b -- b )        </td><td>získání hodnoty jmenovatele (celé kladné nenulové èíslo)</td></tr>
<tr><td>real        </td><td>( z -- x )          </td><td>získání reálné hodnoty komplexního èísla</td></tr>
<tr><td>imaginary   </td><td>( z -- y )          </td><td>získání imaginární hodnoty komplexního èísla</td></tr>
<tr><td>&gt;rect    </td><td>( z -- x y )        </td><td>pøevod komplexního èísla na reálnou a imaginární èást</td></tr>
<tr><td>rect&gt;    </td><td>( x y -- z )        </td><td>vytvoøení komplexního èísla ze dvou èísel reálných (slo¾ka 1 a i)</td></tr>
<tr><td>conjugate   </td><td>( z -- z* )         </td><td>výpoèet èísla komplexnì sdru¾eného</td></tr>
<tr><td>gcd         </td><td>( x y -- a d )      </td><td>výpoèet nejvìt¹ího spoleèného dìlitele, tak aby platilo a*y=d mod x</td></tr>
<tr><td>log         </td><td>( x -- n)           </td><td>výpoèet celoèíselného dvojkového logaritmu</td></tr>
</table>

<image id="5664" original="no" />
<p-center>Na posledním listu integrovaného vývojového prostøedí <strong>Factoru</strong> se nachází <strong>Listener</strong></p-center>



<p><a name="k09"></a></p>
<h1>9. Obsah tøetí èásti èlánku o programovacím jazyku Factor</h1>

<p>Ve tøetí èásti tohoto èlánku si uká¾eme pøedev¹ím práci s&nbsp;øetìzci a
kolekcemi (ve skuteènosti jsou i øetìzce zpracovávány jako kolekce, co¾ je
v&nbsp;nìkolika ohledech výhodné), citaci programù a jejich evaluaci, která je
podobná postupùm známým z&nbsp;programovacího jazyka <strong>Joy</strong>,
náhradu podmínkových pøíkazù a smyèek pomocí operátorù, práci s&nbsp;n-ticemi
(<i>tuples</i>) a dal¹í pokroèilej¹í metody pou¾ívané pøi programování
v&nbsp;jazyku <strong>Factor</strong>. Nezapomeneme ani na popis integrovaného
vývojového prostøedí.</p>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Ti¹novský</a> &nbsp; 2007</small></p>
</body>
</html>

