<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title></title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1></h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p></p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. </a></p>
<p><a href="#k02">*** 2. </a></p>
<p><a href="#k03">*** 3. Grafický řadič Motorola MC6845</a></p>
<p><a href="#k04">*** 4. Generování obrazu s&nbsp;podporou čipu MC6845</a></p>
<p><a href="#k05">*** 5. Typická konfigurace grafického subsystému</a></p>
<p><a href="#k06">*** 6. Podpora pro zobrazení textového kurzoru</a></p>
<p><a href="#k07">*** 7. Triky použité pro grafické režimy</a></p>
<p><a href="#k08">*** 8. Řídicí registry čipu MC6845</a></p>
<p><a href="#k09">*** 9. Grafická karta MDA &ndash; Monochrome Display Adapter</a></p>
<p><a href="#k10">*** 10. Standardní textový režim karty MDA</a></p>
<p><a href="#k11">*** 11. </a></p>
<p><a href="#k12">*** 12. </a></p>
<p><a href="#k13">*** 13. </a></p>
<p><a href="#k14">*** 14. </a></p>
<p><a href="#k15">*** 15. </a></p>
<p><a href="#k16">*** 16. </a></p>
<p><a href="#k17">*** 17. </a></p>
<p><a href="#k18">*** 18. </a></p>
<p><a href="#k19">*** 19. Repositář s&nbsp;demonstračními příklady</a></p>
<p><a href="#k20">*** 20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. </h2>



<p><a name="k02"></a></p>
<h2 id="k02">2. </h2>



<p><a name="k03"></a></p>
<h2 id="k03">3. Grafický řadič Motorola MC6845</h2>

<p>Grafický řadič <i>Motorola MC6845</i> byl navržen pro řízení jednoduchých počítačových monitorů či přímo jejich obrazovek (CRT), tj.&nbsp;jedná se o čip obecně nazývaný <i>CRTC &ndash; Cathode Ray Tube Controller</i>. Řízení obrazovek spočívá, zjednodušeně řečeno, v&nbsp;postupném načítání barev jednotlivých pixelů či kódů znaků (serializaci) z&nbsp;obrazové paměti, dále o převod načtených dat na výslednou grafickou informaci a následném poslání této informace na výstup &ndash; tedy buď přímo na monitor nebo do VF modulátoru v&nbsp;případě použití televizoru namísto monitoru. K&nbsp;vlastní obrazové informaci jsou navíc přidány i horizontální a vertikální synchronizační signály, o jejichž generování se taktéž stará grafický řadič. Tento čip byl používán už v&nbsp;sedmdesátých letech minulého století, zejména pro řízení obrazovek u počítačových terminálů (samozřejmě textových). Pro tento typ úloh byl řadič <i>MC6845</i> vybaven možností zobrazovat data v&nbsp;textové podobě, ve skutečnosti však bylo při vhodném nastavení řídicích registrů možné použít i různé více či méně komplikované grafické režimy, čehož bylo využito již u některých domácích osmibitových počítačů vybavených tímto čipem; později byl tento čip použit i u výkonnějších osobních mikropočítačů.</p>

<a href="http://i.iinfo.cz/images/559/pc83-1.png"><img src="http://i.iinfo.cz/images/559/pc83-1-prev.png" alt="pc83" height="180" width="370" /></a>
<p><i>Obrázek 1: Textový režim adaptéru MDA.</i></p>

<p><div class="rs-tip-major">Poznámka: ve skutečnosti provádí Motorola MC6845 pouze některé výše zmíněné operace. Například přímo neřeší způsob načítání pixelů či znaků z&nbsp;obrazové paměti; vlastně je do značné míry nezávislý na struktuře této paměti. Nejdůležitější prováděnou operací je časování, generování adres do obrazové paměti a podpora pro textový kurzor. Podrobnosti si ukážeme níže.</div></p>

<p>Kromě toho bylo možné k&nbsp;čipu <i>MC6845</i> připojit světelné pero, které mohlo s&nbsp;využitím poměrně přesného měření hodin řídicích výstup jednotlivých obrazových řádků a pixelů, lokalizovat umístění aktivního hrotu světelného pera na obrazovce (samozřejmě za předpokladu, že výrobce počítače vyvedl příslušné piny čipu <i>MC6845</i> přes zesilovač na konektor). Podpora pro textový režim byla u tohoto grafického řadiče na poměrně vysoké úrovni, zejména s&nbsp;ohledem na dobu vzniku čipu: znaky mohly mít proměnnou výšku a dokonce byl podporován takzvaný <i>hardwarový kurzor</i>, což není nic jiného, než ona známá blikající čárka či obdélník (většinou o šířce jednoho znaku) na obrazovce. Podpora spočívá ve zmíněném blikání, které nemuselo být řízeno programově, stejně tak jako přepis znaku, který se nachází pod kurzorem (to mimo jiné znamenalo, že i když počítač &bdquo;zamrzl&ldquo;, textový kurzor si dál vesele blikal, což spoustu lidí dokonale zmátlo, protože si mysleli, že počítač stále pracuje :-).</p>

<p>Celkem byly vyráběny tři základní verze tohoto čipu (MC6845 &ndash; 1 MHz, MC68A45 &ndash; 1,5 MHz, MC68B45 &ndash; 2 MHz), ovšem kromě původního výrobce (Motorola) se tento čip vyráběl v&nbsp;modifikované podobě i v&nbsp;několika dalších firmách. Mezi jednotlivými čipy existovaly větší i menší rozdíly, a to jak v&nbsp;časování signálů, tak i ve významu některých bitů řídicích registrů. Co se ovšem nezměnilo a později způsobilo odklon od tohoto čipu, bylo omezení na adresaci 16 kB obrazové paměti v&nbsp;grafickém (bitmapovém) režimu, což například dostačovalo pro potřeby karet CGA či Hercules, ovšem nikoli již pro grafické režimy karty EGA apod.</p>

<a href="http://i.iinfo.cz/images/559/pc83-2.png"><img src="http://i.iinfo.cz/images/559/pc83-2-prev.png" alt="pc83" height="135" width="370" /></a>
<p><i>Obrázek 2: Grafický řadič Motorola MC6845.</i></p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Generování obrazu s&nbsp;podporou čipu MC6845</h2>

<p>Rozlišení a barevná hloubka grafických režimů nebyly omezeny přímo čipem <i>MC6845</i>, ale dalšími obvody, které se k&nbsp;tomuto integrovanému obvodu připojovaly. Při použití vyšších frekvencí hodinových impulsů bylo možné používat stabilní grafické režimy o rozlišení 768&times;384 pixelů, teoretická hranice se pohybovala u rozlišení 800&times;400 pixelů; při &bdquo;přetaktování&ldquo; čipu však bylo možné použít i vyšších rozlišení, samozřejmě pouze za předpokladu, že se využily dostatečně rychlé paměťové čipy tvořící obrazovou paměť (a to nebylo, jak uvidíme dále, vůbec jednoduché nebo levné). Kromě přímého výstupu grafiky byl podporován i takzvaný <i>interlace</i> režim, tj.&nbsp;střídavé vykreslování lichých a sudých obrazových řádků, používaný zejména při zobrazování na televizorech. Čip <i>MC6845</i> dokázal adresovat až 2<sup>14</sup> textových řádků, přičemž každý řádek mohl mít výšku 2<sup>5</sup> obrazových řádků. Celková adresovatelná kapacita paměti byla rovna 2<sup>(14+5)</sup>=512 kB, čehož však žádná grafická karta nevyužívala. Pokud se šířka textového řádku snížila na jeden obrazový řádek, simuloval se grafický režim, ovšem velikost obrazové paměti byla pouhých 2<sup>14</sup>=16 kB (viz například dále popsaná karta <i>CGA</i>).</p>



<p><a name="k05"></a></p>
<h2 id="k05">5. Typická konfigurace grafického subsystému</h2>

<p></p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Podpora pro zobrazení textového kurzoru</h2>



<p><a name="k07"></a></p>
<h2 id="k07">7. Triky použité pro grafické režimy</h2>

<p>Z&nbsp;důvodu podpory jak textových tak i grafických režimů si právě tento řadič displeje vybrala firma IBM pro návrh grafických karet určených pro vznikající IBM PC a jeho následovníky (PC XT, PC AT), což je poněkud paradoxní, protože se jedná o čip navržený především pro použití s&nbsp;mikroprocesorovou řadou <i>Motorola M68xx</i> a firma IBM se při návrhu PC schválně orientovala především na obvody kompatibilní se stavebnicemi 8080 a 8085 (důvodů bylo více, některé si ještě řekneme).</p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Řídicí registry čipu MC6845</h2>

<p>Nastavení grafického řadiče <i>MC6845</i> se provádělo přes osmnáct osmibitových řídicích registrů. Některé z&nbsp;těchto registrů byly určeny pro zápis (počet znaků na řádek atd.), jiné zase pro čtení (pozice světelného pera). Číselné hodnoty, které mohly být větší než 2<sup>8</sup>, se musely ukládat do dvou sousedních registrů (poloha kurzoru atd.). Registry byly programátorům přístupné přes dvojici adres &ndash; zápis do první adresy vybíral příslušný řídicí registr, čtení či zápis do druhé adresy (o jedničku vyšší) již vedl ke čtení či zápisu do příslušného řídicího registru. O které adresy se konkrétně jedná záleželo na zapojení konkrétní grafické karty.  Například u dále popsané grafické karty <i>CGA</i> se jedná o I/O porty 0x3d4 a 0x3d5 a u grafické karty <i>Hercules</i> se naopak o I/O porty 0x3b4 a 0x3b5.  Význam jednotlivých řídicích registrů je uveden v&nbsp;následující tabulce (povšimněte si, že jednotkami při udávání horizontálních velikostí jsou znaky a nikoli pixely &ndash; přesné časování je odvozeno od externího hodinového signálu řízeného krystalem):</p>

<table>
<tr><th>Číslo registru</th><th>Význam</th></tr>
<tr><td>0 </td><td>celkový počet znaků horizontálně, včetně okrajů</td></tr>
<tr><td>1 </td><td>počet horizontálně zobrazených znaků (typicky 40 či 80)</td></tr>
<tr><td>2 </td><td>horizontální pozice synchronizačního signálu (lze posouvat obrazem na monitoru, ovšem omezeně)</td></tr>
<tr><td>3 </td><td>šířka horizontálního a vertikálního synchronizačního signálu</td></tr>
<tr><td>4 </td><td>celkový počet textových řádků (například 27)</td></tr>
<tr><td>5 </td><td>mikroposun textových řádků po jednotlivých obrazových řádcích</td></tr>
<tr><td>6 </td><td>zobrazený počet textových řádků (například 25)</td></tr>
<tr><td>7 </td><td>vertikální pozice synchronizačního signálu (lze posouvat obrazem, opět omezeně)</td></tr>
<tr><td>8 </td><td>mód prokládání (interlace) a posunutí</td></tr>
<tr><td>9 </td><td>počet obrazových řádků pro jeden textový řádek &ndash; výška znaku (většinou 8 či 14)</td></tr>
<tr><td>10</td><td>začátek hardwarového kurzoru (většinou výška_znaku-3)</td></tr>
<tr><td>11</td><td>konec hardwarového kurzoru (kurzor může mít například výšku dvou obrazových řádků)</td></tr>
<tr><td>12</td><td>počáteční adresa obrazové paměti (vyšší bajt)</td></tr>
<tr><td>13</td><td>počáteční adresa obrazové paměti (nižší bajt)</td></tr>
<tr><td>14</td><td>adresa kurzoru &ndash; vyšší bajt (klasický posun hardwarového kurzoru)</td></tr>
<tr><td>15</td><td>adresa kurzoru &ndash; nižší bajt</td></tr>
<tr><td>16</td><td>adresa světelného pera &ndash; vyšší bajt</td></tr>
<tr><td>17</td><td>adresa světelného pera &ndash; nižší bajt</td></tr>
</table>

<p>omezení</p>



<p><a name="k09"></a></p>
<h2 id="k09">9. Grafická karta MDA &ndash; Monochrome Display Adapter</h2>

<p>Jak jsme si již řekli v&nbsp;předchozích kapitolách, nabízela firma IBM do svých prvních počítačů PC buď grafickou kartu <i>MDA</i> (<i>Monochrome Display Adapter</i>), nebo grafickou kartu <i>CGA</i> (dokonce bylo možné, aby byly v&nbsp;jednom počítači současně nainstalovány obě zmíněné karty, protože ani adresy jejich řídicích registrů &ndash; portů, ani adresní rozsah video paměti, se nepřekrýval). Počátek výroby obou typů karet se datuje do roku 1981.  Grafická karta <i>MDA</i> se od prakticky všech dalších grafických adaptérů vyráběných pro počítače IBM PC odlišovala především v&nbsp;tom, že neumožňovala vykreslování rastrové grafiky (označení termínem &bdquo;grafická karta&ldquo; je tedy poněkud nepřesné), jelikož podporovala pouze textový režim 80&times;25 znaků, který je používán například při startu počítače či v&nbsp;operačním systému MS-DOS; teoreticky by však mělo být možné pracovat s&nbsp;graficko-textovou :-) kartou <i>MDA</i> i pod systémy Linux či Open/Free BSD, například pro řízení zobrazování na druhém monitoru u starších systémů vybavených sběrnicí ISA (v&nbsp;moderních PC se pro zobrazení na více monitorech využívá poněkud odlišná technologie). V&nbsp;minulosti se &ndash; zejména právě v&nbsp;dobách DOSu &ndash; pro tuto činnost nejčastěji používaly výprodejové karty typu <i>Hercules</i>, protože i ty byly navrženy tak, aby jejich řídicí porty ani adresy video paměti nekolidovaly s&nbsp;primární grafickou kartou.</p>

<a href="http://i.iinfo.cz/images/559/pc83-3.jpg"><img src="http://i.iinfo.cz/images/559/pc83-3-prev.jpg" alt="pc83" height="185" width="370" /></a>
<p><i>Obrázek 3: Grafická karta MDA s&nbsp;čipem MC6845.</i></p>

<p>Jednoznačnou předností této grafické karty je způsob namapování do adresního prostoru procesoru. Karta totiž využívala segment začínající adresou <strong>b000:0000</strong> (používám zde známé Intelovské šestnáctibitové adresování typu segment:offset), který nebyl na dalších grafických kartách využit. Proto bylo možné tuto kartu kombinovat s&nbsp;kartou jinou a vytvořit tak vícemonitorový systém, který využívaly aplikace jako <strong>AutoCAD</strong> (grafická plocha a terminál s&nbsp;příkazovým řádkem), <strong>Turbo Pascal</strong> (vývojové prostředí zobrazené spolu s&nbsp;laděnou aplikací), <strong>Turbo C++</strong>, <strong>Lotus 1-2-3</strong> apod. V&nbsp;praxi bylo možné použít například kombinace grafických karet <i>CGA+MDA</i>, <i>EGA+MDA</i> a později i <i>VGA+MDA</i>.  Vzhledem k&nbsp;tomu, že firma IBM tuto kartu přestala po několika letech vyrábět, převzal úlohu sekundární grafické karty její konkurent <i>Hercules</i> (viz další část tohoto seriálu), který kromě zobrazení textového režimu podporoval i režim grafický.</p>



<p><a name="k10"></a></p>
<h2 id="k10">10. Standardní textový režim karty MDA</h2>

<p>Při zobrazování znaků v&nbsp;textovém režimu <strong>80&times;25</strong> znaků byl každý znak definovaný v&times;masce 9&times;14 pixelů, což znamená, že rozlišení obrazovky bylo rovno 720&times;350 pixelům. Poměrně velké horizontální rozlišení (a tím i velmi dobře čitelný text) bylo dále použito až u grafických karet <i>Hercules</i> a <i>VGA</i> o několik let později (grafické karty <i>CGA</i> a <i>EGA</i> byly v&nbsp;tomto ohledu zklamáním, zejména pro uživatele pracující převážně v&nbsp;textovém režimu). Znaková sada byla na grafické kartě uložena v&nbsp;paměti ROM, což znamená, že se při požadavku na zobrazení textů v&nbsp;jazycích s&nbsp;nabodeníčky (jedná se o  prakticky všechny jazyky kromě angličtiny) musela tato paměť vyměnit za EPROM (typ 2764 případně 27C64) s&nbsp;vypálenou národní znakovou sadou (původní znaková sada dodávaná firmou IBM odpovídá kódové stránce 437, tj.&nbsp;jedná se o &bdquo;rozšířenou&ldquo; ASCII tabulku). Každý znak na obrazovce měl k&nbsp;dispozici i svůj atributový byte, ve kterém bylo specifikováno, zda se má tento znak zobrazit normálně, zvýrazněně (větší intenzita), s&nbsp;podtržením, inverzně či zda by měl blikat; dokonce bylo možné nastavit i některé kombinace těchto atributů. Barevné atributy znaků byly použity (i když s&nbsp;poněkud jiným významem) i u dalších grafických karet na PC.</p>

<p>Kapacita video paměti na této kartě byla rovna čtyřem kilobajtům, přičemž 2000 bytů bylo zapotřebí pro uložení všech 80&times;25 znaků a dalších 2000 bytů pro uložení jejich atributů (z&nbsp;pohledu PC se ukládala vždy dvojice znak-atribut, tj.&nbsp;jednalo se o souvislou oblast paměti), zbylých 96 bytů bylo nevyužito. Zajímavé jsou signálové poměry, kterými se musely řídit připojené monitory. Snímková frekvence byla rovna 50&nbsp;Hz, řádková frekvence 18,432&nbsp;kHz (tj.&nbsp;tato frekvence byla poněkud vyšší než u dále popisované grafické karty <i>CGA</i>). Při prvním pohledu na údaj o snímkovém kmitočtu to může vypadat tak, že 50&nbsp;Hz je pro práci na počítači naprosto nedostatečné, musíme si však uvědomit, že se ponejvíce používalo tmavé pozadí, na kterém není poblikávání obrazu tak patrné, jako na pozadí světlém či dokonce bílém.</p>



<p><a name="k11"></a></p>
<h2 id="k11">11. </h2>



<p><a name="k12"></a></p>
<h2 id="k12">12. </h2>



<p><a name="k13"></a></p>
<h2 id="k13">13. </h2>



<p><a name="k14"></a></p>
<h2 id="k14">14. </h2>



<p><a name="k15"></a></p>
<h2 id="k15">15. </h2>



<p><a name="k16"></a></p>
<h2 id="k16">16. </h2>



<p><a name="k17"></a></p>
<h2 id="k17">17. </h2>



<p><a name="k18"></a></p>
<h2 id="k18">18. </h2>



<p><a name="k19"></a></p>
<h2 id="k19">19. Repositář s&nbsp;demonstračními příklady</h2>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>Support/peripheral/other chips - 6800 family<br />
<a href="http://www.cpu-world.com/Support/6800.html">http://www.cpu-world.com/Support/6800.html</a>
</li>

<li>Motorola 6845<br />
<a href="http://en.wikipedia.org/wiki/Motorola_6845">http://en.wikipedia.org/wiki/Motorola_6845</a>
</li>

<li>The 6845 Cathode Ray Tube Controller (CRTC)<br />
<a href="http://www.tinyvga.com/6845">http://www.tinyvga.com/6845</a>
</li>

<li>IBM Monochrome Display Adapter<br />
<a href="http://en.wikipedia.org/wiki/Monochrome_Display_Adapter">http://en.wikipedia.org/wiki/Monochrome_Display_Adapter</a>
</li>

<li>Color Graphics Adapter<br />
<a href="http://en.wikipedia.org/wiki/Color_Graphics_Adapter">http://en.wikipedia.org/wiki/Color_Graphics_Adapter</a>
</li>

<li>Wikipedia CZ: Sběrnice:<br />
<a href="http://cs.wikipedia.org/wiki/Sb%C4%9Brnice">http://cs.wikipedia.org/wiki/Sb%C4%9Brnice</a></li>

<li>Wikipedia EN: Industry Standard Architecture:<br />
<a href="http://en.wikipedia.org/wiki/Industry_Standard_Architecture">http://en.wikipedia.org/wiki/Industry_Standard_Architecture</a></li>

<li>Macintosh 128K/512K technical details<br />
<a href="https://en.wikipedia.org/wiki/Macintosh_128K/512K_technical_details">https://en.wikipedia.org/wiki/Macintosh_128K/512K_technical_details</a>
</li>

<li>MOS Technology 6522<br />
<a href="https://en.wikipedia.org/wiki/MOS_Technology_6522">https://en.wikipedia.org/wiki/MOS_Technology_6522</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2021</small></p>
</body>
</html>

