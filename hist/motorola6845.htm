<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Co mají společného Commodore PET/4000, BBC Micro, Amstrad CPC i grafické karty MDA, CGA a Hercules?</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Co mají společného Commodore PET/4000, BBC Micro, Amstrad CPC i grafické karty MDA, CGA a Hercules?</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p></p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. Co mají společného Commodore PET/4000, BBC Micro, Amstrad CPC i grafické karty MDA, CGA a Hercules?</a></p>
<p><a href="#k02">2. Způsoby generování obrazu v&nbsp;dobách domácích a osobních mikropočítačů</a></p>
<p><a href="#k03">3. Grafický řadič Motorola MC6845</a></p>
<p><a href="#k04">4. Generování obrazu s&nbsp;podporou čipu MC6845</a></p>
<p><a href="#k05">5. Typická konfigurace grafického subsystému</a></p>
<p><a href="#k06">6. Podpora pro zobrazení textového kurzoru</a></p>
<p><a href="#k07">7. Triky použité pro grafické režimy</a></p>
<p><a href="#k08">8. Řídicí registry čipu MC6845</a></p>
<p><a href="#k09">9. Grafická karta MDA &ndash; Monochrome Display Adapter</a></p>
<p><a href="#k10">10. Standardní textový režim karty MDA</a></p>
<p><a href="#k11">11. Grafická karta CGA &ndash; Color Graphics Adapter</a></p>
<p><a href="#k12">12. Oficiální grafické režimy karty CGA</a></p>
<p><a href="#k13">13. Organizace paměti v&nbsp;monochromatickém režimu (hi-res)</a></p>
<p><a href="#k14">14. Standardní čtyřbarevný grafický režim karty CGA: 320&times;200</a></p>
<p><a href="#k15">15. Cílená modifikace řídicích registrů karty CGA a nestandardní režimy zobrazování</a></p>
<p><a href="#k16">16. Grafická karta Hercules &ndash; první vážnější konkurence IBM postavený opět na čipu 6845</a></p>
<p><a href="#k17">17. Základní technické parametry karty Hercules</a></p>
<p><a href="#k18">18. Textový režim karty Hercules</a></p>
<p><a href="#k19">19. Grafický režim karty Hercules</a></p>
<p><a href="#k20">20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Co mají společného Commodore PET/4000, BBC Micro, Amstrad CPC i grafické karty MDA, CGA a Hercules?</h2>

*** image ***
<p><i>Obrázek 1: Hra Overkill, která používá grafický režim 320&times;200 se
čtyřmi barvami grafické karty CGA.</i></p>

<p>Z&nbsp;důvodu podpory jak textových tak i grafických režimů si právě tento
řadič displeje vybrala firma IBM pro návrh grafických karet určených pro
vznikající IBM PC a jeho následovníky (PC XT, PC AT), což je poněkud paradoxní,
protože se jedná o čip navržený především pro použití s&nbsp;mikroprocesorovou
řadou <i>Motorola M68xx</i> a firma IBM se při návrhu PC schválně orientovala
především na obvody kompatibilní se stavebnicemi 8080 a 8085 (důvodů bylo více,
některé si ještě řekneme).</p>

*** image ***
<p><i>Obrázek 2: Další snímek ze hry Overkill.</i></p>

<p><div class="rs-tip-major">Poznámka: mimochodem &ndash; s&nbsp;tímto čipem si lze vyhrát i dnes, viz například <a href="https://hackaday.com/2017/05/14/the-modern-retrocomputer-an-arduino-driven-6845-crt-controller/">tento článeček</a>.</div></p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Způsoby generování obrazu v&nbsp;dobách domácích a osobních mikropočítačů</h2>

<p>Tématem grafických systémů mikropočítačů jsme se již na stránkách Roota
zabývali, takže si jen shrňme, že původním rozhraním (tehdejších) minipočítačů
byl textový terminál, jehož grafické schopnosti byly prakticky nulové (až na
pseudografiku, tedy použití znaků pro tvorbu obrazu). Výjimkou tvořilo několik
terminálů s&nbsp;podporou vektorové grafiky. Poměrně překotný vývoj
v&nbsp;oblasti grafického výstupu začal až s&nbsp;příchodem herních konzolí
druhé generace, především s&nbsp;konzolí VCS (Atari 2600) a taktéž
s&nbsp;&bdquo;1977 Trinity&ldquo;, což byla trojice domácích mikropočítačů
Apple II, Commodore PET 2001 a TRS-80. Z&nbsp;hlediska vývoje počítačové
grafiky je nejzajímavější právě herní konzole Atari 2600, protože se celý její
grafický systém skládal z&nbsp;několika čítačů (nebinárních!) a posuvných
registrů integrovaných do čipu nazvaného TIA, jehož účelem bylo generovat obraz
po jednotlivých řádcích a to navíc bez nutnosti použití framebufferu.</p>

*** image ***
<p><i>Obrázek 3: Dosti primitivní hra Turbo, opět určená pro grafickou kartu
CGA.</i></p>

<p>Každý obrazový řádek složený ze 160 viditelných pixelů, byl s&nbsp;využitím
čipu TIA generován na základě šestice údajů &ndash; horizontální pozice
takzvaného hráče 0, pozice hráče 1 (jednalo se o klasické osmipixelové sprity,
jejichž horizontální šířka mohla být vynásobena dvěma či čtyřmi), pozice střely
0, pozice střely 1 (jednopixelové sprity, opět s&nbsp;volitelnou šířkou a
barvou příslušného hráče), pozice míče/ball (jednopixelový sprite
s&nbsp;možností vertikálního posunu o jeden řádek) a konečně herního
pole/playfield. Herní pole bylo reprezentováno 20bitovým vzorkem, který mohl
být v&nbsp;pravé polovině obrazovky horizontálně zrcadlen nebo pouze zopakován
&ndash; horizontální rozlišení pozadí je tedy jen 40 pixelů, tj.&nbsp;jeho
pixely mají oproti hráčům čtyřnásobnou šířku. Programátor přitom mohl před
vykreslením každého obrazového řádku změnit horizontální pozice hráčů, střel i
míče, modifikovat jejich barvu, popř.&nbsp;i bitový vzorek hráčů a herního
pole. Všechny změny byly prováděny zápisem do řídicích registrů čipu TIA,
například herní pole bylo uloženo ve třech osmibitových registrech.</p>

<p>Vývoj grafických subsystémů ovšem směřoval nezadržitelně k&nbsp;využití
skutečného a plnohodnotného <i>framebufferu</i>, tj.&nbsp;obrazové paměti
(video paměti), ve které je uložena kopie rastrového obrázku zobrazovaného na
monitoru. Do framebufferu, založeného většinou na běžné dynamické paměti, má
buď přímo či nepřímo přístup i mikroprocesor, který může na základě programu
měnit jeho obsah. Navíc jsou z&nbsp;framebufferu pravidelně čteny informace
elektronickým obvodem (většinou jedním čipem), který se &ndash; z&nbsp;velké
části nezávisle na mikroprocesoru &ndash; stará o zobrazování grafiky. Tento
čip musel umět odpojit mikroprocesor od vstupů framebufferu (aby nedošlo při
kolizi během čtení a současného zápisu do obrazové paměti), generovat potřebné
adresy a posléze přečtené informace posílat do řadiče displeje. Takto pojatým
framebufferem byla vybavena podstatná část domácích osmibitových mikropočítačů
i počítačů osobních. A část těchto operací mohl provádět dále popisovaný čip
6845.</p>

<p>Jeden z&nbsp;nejjednodušších grafických subsystémů najdeme na původním
Macontoshi. K&nbsp;dispozici totiž byl pouze jediný grafický režim, ve kterém
bylo možné zobrazit rastr o rozlišení 512&times;342 pixelů monochromaticky. Na
první pohled netypické rozlišení má výhodu v&nbsp;tom, že zachovává poměr stran
3:2. Fyzické rozlišení přitom bylo v&nbsp;obou směrech (vertikálním i
horizontálním) rovno cca 72 DPI, což je výhodné zejména pro přesnou typografii.
Zvolené rozlišení navíc na interním devítipalcovém monitoru vypadalo velmi
pěkně a dodávalo grafickému uživatelskému rozhraní zdání velké profesionality
(dodnes si pamatuji ten zvláštní pocit, dělat na &bdquo;skutečném&ldquo;
Macintoshi v&nbsp;době, kdy jich bylo v&nbsp;ČR pouze několik desítek a ostatní
znali pouze PCčka s&nbsp;MS DOSem a textový režim). Samotná grafika není na
Macintoshi žádným zvláštním způsobem podporovaná. Grafická paměť je tvořena
kontinuálním blokem paměti o velikosti 21 kB, ze které se postupně čtou hodnoty
jednotlivých pixelů tak, jak se vykreslují na obrazovku. Přesněji řečeno
&ndash; hodnoty sousedních pixelů čte samotný procesor a ukládá je do posuvného
registru, z&nbsp;něhož se postupně přenáší na obrazovku. Celý grafický
subsystém je tedy založen na spolupráci CPU a primitivního posuvného
registru.</p>

<p>Poněkud odlišnou cestou se vydali tvůrci osobních mikropočítačů Atari ST,
který obsahuje čip nazvaný <i>Shifter</i>, což navozuje dojem, že se opět jedná
o primitivní posuvný registr. Ve skutečnosti si dokázal Shifter řídit přístup
do paměti automaticky s&nbsp;využitím DMA a navíc nebyla adresa video paměti
pevně nastavená, ale mohla se měnit podle požadavků daného software. Samozřejmě
ale existovaly i mnohem sofistikovanější systémy. Příkladem může být Amiga,
která již v&nbsp;původním (originálním) čipsetu obsahovala čipy specializované
pro práci s&nbsp;planární rastrovou grafikou: <i>Agnus</i> (obsahuje Blitter a
Copper) + <i>Denise</i>.</p>

*** image ***
<p><i>Obrázek 4: Hra Monuments of Mars určená opět pro kartu CGA.</i></p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Grafický řadič Motorola MC6845</h2>

<p>Konečně se dostáváme k&nbsp;čipu, kterému je věnován dnešní článek. Jedná se
o grafický řadič <i>Motorola MC6845</i>. Tento čip byl primárně navržen pro
řízení jednoduchých počítačových monitorů či přímo jejich obrazovek (<i>CRT</i>
&ndash; <i>Cathode Ray Tube</i>), tj.&nbsp;jedná se o čip obecně nazývaný
<i>CRTC</i> neboli <i>Cathode Ray Tube Controller</i>. Řízení obrazovek
spočívá, poněkud zjednodušeně řečeno, v&nbsp;postupném načítání barev
jednotlivých pixelů či kódů znaků (serializaci) z&nbsp;obrazové paměti, dále o
převod načtených dat na výslednou grafickou informaci a následném poslání této
informace na výstup ve formě signálu či signálů &ndash; tedy buď přímo na
monitor nebo do VF modulátoru v&nbsp;případě použití televizoru namísto
monitoru. K&nbsp;vlastní obrazové informaci jsou navíc přidány i nezbytné
horizontální a vertikální synchronizační signály, o jejichž generování se
taktéž do značné míry stará grafický řadič.</p>

<a href="http://i.iinfo.cz/images/559/pc83-1.png"><img src="http://i.iinfo.cz/images/559/pc83-1-prev.png" alt="pc83" height="180" width="370" /></a>
<p><i>Obrázek 5: Textový režim adaptéru MDA, kterému se budeme podrobněji
věnovat v&nbsp;dalším textu.</i></p>

<p>Čip <i>MC6845</i> začal být používán už v&nbsp;sedmdesátých letech minulého
století, zejména pro řízení obrazovek u počítačových terminálů (samozřejmě
textových, i když existovaly i terminály s&nbsp;podporou grafiky). Pro tento
typ úloh byl řadič <i>MC6845</i> vybaven možností zobrazovat data
v&nbsp;textové podobě (jinými slovy &ndash; byl podporován programovatelný
textový režim), ve skutečnosti však bylo při vhodném nastavení řídicích
registrů možné použít i různé více či méně komplikované grafické režimy, čehož
bylo využito již u některých domácích osmibitových počítačů vybavených tímto
čipem; později byl tento čip použit i u výkonnějších osobních mikropočítačů,
kde se ovšem začaly projevovat jeho limity.</p>

<p><div class="rs-tip-major">Poznámka: ve skutečnosti provádí <i>Motorola
MC6845</i> pouze některé výše zmíněné operace. Například přímo neřeší způsob
načítání pixelů či znaků z&nbsp;obrazové paměti; vlastně je do značné míry
nezávislý na struktuře této paměti. Nejdůležitější prováděnou operací je
časování všech signálů důležitých pro tvorbu video signálů, generování adres do
obrazové paměti (ať již s&nbsp;textem či pixely) a podpora pro textový kurzor.
Podrobnosti si ukážeme níže.</div></p>

<p>Kromě toho bylo možné k&nbsp;čipu <i>MC6845</i> připojit světelné pero,
které mohlo s&nbsp;využitím poměrně přesného měření hodin řídicích výstup
jednotlivých obrazových řádků a pixelů, lokalizovat umístění aktivního hrotu
světelného pera na obrazovce (samozřejmě za předpokladu, že výrobce počítače
vyvedl příslušné piny čipu <i>MC6845</i> přes zesilovač na konektor). Zastavme
se však na chvíli u textového režimu. Podpora pro textový režim byla u tohoto
grafického řadiče na poměrně vysoké úrovni, zejména s&nbsp;ohledem na dobu
vzniku čipu: znaky totiž mohly mít proměnnou výšku a dokonce byl podporován
takzvaný <i>hardwarový kurzor</i>, což není nic jiného, než ona známá blikající
čárka či obdélník (většinou o šířce jednoho znaku) na obrazovce. Podpora
spočívá ve zmíněném blikání, které nemuselo být řízeno programově, stejně tak
jako přepis znaku, který se nachází pod kurzorem (to mimo jiné znamenalo, že i
když počítač &bdquo;zamrzl&ldquo;, textový kurzor si dál vesele blikal, což
spoustu lidí dokonale zmátlo, protože si mysleli, že počítač stále pracuje
:-).</p>

<p>Celkem byly vyráběny tři základní verze tohoto čipu (MC6845 &ndash; 1 MHz,
MC68A45 &ndash; 1,5 MHz, MC68B45 &ndash; 2 MHz), ovšem kromě původního výrobce
(Motorola) se tento čip vyráběl v&nbsp;modifikované podobě i v&nbsp;několika
dalších firmách. Mezi jednotlivými čipy existovaly větší i menší rozdíly, a to
jak v&nbsp;časování signálů, tak i ve významu některých bitů řídicích registrů.
Co se ovšem nezměnilo a později způsobilo odklon od tohoto čipu, bylo omezení
na adresaci 16 kB textové paměti či obrazové paměti v&nbsp;grafickém
(bitmapovém) režimu, což například dostačovalo pro potřeby karet CGA či
Hercules, ovšem nikoli již pro grafické režimy karty EGA apod.</p>

<p><div class="rs-tip-major">Poznámka: jak uvidíme dále, dal se tento problém
minimálně obejít, ovšem za cenu toho, že struktura obrazové paměti byla
&bdquo;nestandardní&ldquo; &ndash; například byla paměť rozdělena na oblast se
sudými a lichými řádky, existovaly čtyři oblasti (Hercules) atd.</div></p>

<a href="http://i.iinfo.cz/images/559/pc83-2.png"><img src="http://i.iinfo.cz/images/559/pc83-2-prev.png" alt="pc83" height="135" width="370" /></a>
<p><i>Obrázek 6: Grafický řadič Motorola MC6845.</i></p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Generování obrazu s&nbsp;podporou čipu MC6845</h2>

<p>Podívejme se nyní to, jakým způsobem se čip 6845 používá pro zobrazení textů
na obrazovce &ndash; protože jeho primární použití je právě pro práci
s&nbsp;textovým režimem. Zjednodušené schéma zapojení 6845 je ukázáno na tomto
obrázku:</p>

*** image ***
<p><i>Obrázek 7: Zjednodušené schéma zapojení 6845.</i></p>

<p>Ze schématu je patrné, že pro komunikaci s&nbsp;počítačem se používá
klasická osmibitová datová sběrnice (tj.&nbsp;je kompatibilní i
s&nbsp;osmibitovými čipy) a jednobitová adresová sběrnice &ndash; 6845 totiž má
pouze dva osmibitové I/O porty &ndash; první pro výběr jednoho z&nbsp;osmnácti
řídicích a stavových registrů, druhý pro zápis dat do vybraného řídicího
registru nebo pro čtení dat z&nbsp;vybraného stavového registru. Čip 6845
generuje na základě své konfigurace několik signálů:</p>

<ul>

<li>Adresu znaku ve video RAM (teoreticky až 14 bitů, typicky ovšem méně)</li>

<li>Číslo obrazového řádku (mikrořádku) v&nbsp;daném textovém řádku. Typicky
hodnoty 0-7, 0-13 či 0-15.</li>

<li>Signály <strong>HSYNC</strong> a <strong>VSYNC</strong> pro řízení
horizontálního a vertikálního synchronizačního signálu pro monitor či
televizor.</li>

<li>Signál <strong>CURSOR</strong>, který je nastaven na logickou jedničku ve
chvíli, kdy se má zobrazit kurzor (co se s&nbsp;tímto signálem stane, již
závisí na konkrétním grafickém subsystému, typicky se mohou všechny barvy tímto
signálem ORovat).</li>

</ul>

<p>Předpokládejme nyní, že se má zobrazovat textový režim 80&times;25 znaků,
přičemž znaky budou vysoké 16 obrazových řádků (mikrořádků). Celý grafický
subsystém se bude chovat takto (poněkud zjednodušeno):</p>

<ol>

<li>6845 generuje přes sběrnici <strong>MA</strong> adresy znaků ve video RAM.
Pro první textový řádek to tedy budou adresy 0 až 79. Současně je
<strong>RA</strong> nastaveno na nulu.</li>

<li>Z&nbsp;video RAM jsou tedy postupně vybrány ASCII kódy znaků na prvním
textovém řádku. Ty jsou poslány na adresovou sběrnici paměti ROM, která
obsahuje font (bitmapy 8&times;16 pixelů). Sloupec je vybrán právě ASCII kódem,
řádek pak signály <strong>RA</strong> (na prvním mikrořádku je nastaven na
nulu, tedy se vybírá i první osmice bitů v&nbsp;bitmapách 8&times;16).</li>

<li>Hodnota všech osmi (někdy devíti) pixelů tvořících jeden mikrořádek znaku
je poslána do posuvného registru. Z&nbsp;něho se postupně jednotlivé bity (od
nejvyššího) vybírají a posílají do výstupní logiky. Posuvný registr je řízen
hodinovým signálem typicky označeným <strong>DOTCLK</strong>, který by měl mít
osmkrát větší frekvenci, než je frekvence výběru znaků.</li>

<li>Výstupní logika, což může být několik IO s&nbsp;malou integrací, pouze
připraví signály pro monitor, popř.&nbsp;provede výše zmíněný OR hodnoty pixelu
a hodnoty <strong>CURSOR</strong>.</li>

<li>Až se dojde na konec textu (adresa 79), tak 6845 chvíli počká (na monitoru
bude černý okraj) a poté vygeneruje <strong>HSYNC</strong> o naprogramované
délce. Tím se přejde na další řádek.</li>

<li>Čítač znaků se vynuluje, hodnota na <strong>RA</strong> zvýší o jedničku a
vše se bude opakovat pro další mikrořádek.</li>

<li>Po dosažení šestnácti mikrořádků se čítač znaků již NEnuluje, ovšem
<strong>RA</strong> se nastaví na nulu &ndash; pokračuje se dalším obrazovým
řádkem. Zvýší se čítač textových řádků.</li>

<li>Pokud se dosáhne maximálního počtu textových řádků, opět se bude generovat
několik prázdných řádků (BLANK) a následuje <strong>VSYNC</strong> pro začátek
vykreslování dalšího snímku.</li>

</ol>

*** image ***
<p><i>Obrázek 8: Aktivní plocha, černé okraje a horizontální i vertikální
synchronizační pulsy.</i></p>

<p><div class="rs-tip-major">Poznámka: vidíme, že samotný 6845 je interně
pravděpodobně relativně jednoduchý, protože obsahuje tři čítače (řádků,
mikrořádků, znaků na řádku) a sadu komparátorů (konec řádku, konec snímku,
pozice kurzoru, pozice světelného pera). Zbylá část logiky grafického
subsystému je ponechána na dalších IO, ovšem v&nbsp;tom nejjednodušším případě
se skutečně může použít pouze Video RAM, ROM s&nbsp;fontem, posuvný registr
(původně byl použit standardní registr z&nbsp;řady 7400, tedy žádný exotický
čip) a několik hradel.</div></p>



<p><a name="k05"></a></p>
<h2 id="k05">5. Typická konfigurace grafického subsystému</h2>

<p>Typická konfigurace grafického subsystému založeného na čipu 6845 je ukázána
na devátém obrázku:</p>

*** image ***
<p><i>Obrázek 9: Typická konfigurace grafického subsystému</i></p>

<p>Od zjednodušeného schématu zapojení z&nbsp;obrázku 7 se toto reálné schéma
karty MDA nepatrně odlišuje. Především je kromě textového bufferu použita i
paměť pro uložení atributů (vysoká intenzita písma, podtržení, inverze atd.).
Tato paměť je adresována stejně jako paměť s&nbsp;textem &ndash; a
z&nbsp;pohledu programátora jsou obě paměti proloženy tak, že dvojice
znak+atribut jsou uloženy vedle sebe (výběr nejnižším bitem adresy). Dále zde
vidíme pouze přidání &bdquo;oddělovacích&ldquo; obvodů, a to jak mezi CPU, 6845
a pamětí, tak i ve formě záchytných registrů. Mimochodem &ndash; blok
<i>Character generator</i> je ve skutečnosti obyčejná EPROM.</p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Podpora pro zobrazení textového kurzoru</h2>

<p>V&nbsp;předchozím textu jsme si řekli, že čip 6845 dokáže posílat signál o
tom, že se má zobrazit textový kurzor. Toto je velmi zajímavá a možná i
unikátní funkce, která je ovšem interně řešena velmi jednoduše. Adresu znaku,
na kterém je textový kurzor, je nutné zapsat do dvou řídicích registrů,
konkrétně do registrů R14 a R15. Dále se v&nbsp;registrech R10 a R11 nachází
číslo mikrořádku (v&nbsp;rámci textového řádku), kde se má kurzor zobrazit
&ndash; ten je totiž tvořen obdélníkem, který začíná (v&nbsp;rámci znaku) právě
na řádku v&nbsp;R10 a končí na řádku uloženého v&nbsp;R11 (řekneme, že se jedná
o hodnoty 12 a 14 pro znaky vysoké šestnáct mikrořádků).</p>

<p>Činnost 6845 je v&nbsp;tomto ohledu poměrně triviální &ndash;
v&nbsp;případě, že je <i>adresa</i> právě vybíraného znaku totožná
s&nbsp;adresou kurzoru, tak se provede porovnání interního počitadla mikrořádků
s&nbsp;hodnotami v&nbsp;registrech R10 a R11. V&nbsp;případě, že počitadlo leží
mezi těmito hodnotami (včetně obou mezí), je signál <strong>CURSOR</strong>
nastaven na logickou jedničku &ndash; a to je prakticky vše. Další operace
s&nbsp;tímto signálem může ale nemusí provést další (typicky diskrétní) logika.
Ta typicky pro textové režimy provede OR hodnoty pixelu posílaného na monitor
se signálem <strong>CURSOR</strong> a pro grafické režimy je hodnota zcela
ignorována.</p>

<p><div class="rs-tip-major">Poznámka: blikání kurzoru, pokud je podporováno,
je taktéž řízeno další logikou.</div></p>



<p><a name="k07"></a></p>
<h2 id="k07">7. Triky použité pro grafické režimy</h2>

<p>V&nbsp;předchozích kapitolách jsme si popsali, jakým způsobem dokáže čip
6845 spolupracovat s&nbsp;dalšími čipy tvořícími grafický subsystém počítače.
Jeho primární úlohou je generování adres do paměti RAM se znaky a paměti
(EP)ROM s&nbsp;bitovými maskami znaků. Údaje z&nbsp;této paměti jsou posléze
načteny do posuvného registru a postupně posílány do monitoru společně
s&nbsp;dalšími důležitými signály.</p>

<p>Jak se však pracuje s&nbsp;rastrovou grafikou?</p>

<p>Pro tento účel sice nebyl čip 6845 navržen, ovšem s&nbsp;rastrovou grafikou
do určité míry pracovat může. Podívejme se například na způsob generováni
monochromatického obrazu o rozlišení 640&times;100 pixelů. Čip 6845 může být
naprogramován tak, jakoby pracoval s&nbsp;textovou obrazovkou s&nbsp;80 znaky
na řádku a 100 textovými řádky (což je možné). Výška textových řádků bude rovna
přesně jednomu mikrořádku &ndash; což znamená, že adresy <strong>RA</strong>
lze zcela ignorovat. A adresy, které 6845 generuje na sběrnici
<strong>MA</strong> mohou být převedeny přímo na adresovou sběrnici paměti RAM.
Čip postupně projde všemi 100 &bdquo;textovými&ldquo; řádky a vzhledem
k&nbsp;tomu, že každý obsahuje 80 &bdquo;znaků&ldquo; (tedy 640) pixelů, je vše
v&nbsp;pořádku a vlastní <i>framebuffer</i> bude striktně lineární.</p>

<p>Pokud je nutné pracovat s&nbsp;více barvami pixelů, zkomplikuje se pouze
logika s&nbsp;posuvným registrem, protože bude například nutné generovat čtyři
barvy na základě dvou bitů. Nejedná se o součást 6845, který tedy vůbec
nedokáže rozlišit (například) mezi grafickými režimy karty CGA &ndash; se všemi
pracuje naprosto stejným způsobem.</p>

<p>Velké omezení spočívá v&nbsp;tom, že celková výška obrazu je omezena na 127
obrazových řádků a to včetně několika řádků pro vertikální synchronizační puls
(takže reálně ještě méně). Toto omezení se obchází například tím, že se použije
textový režim s&nbsp;písmem vysokým dva mikrořádky, čtyřmi mikrořádky atd. To
je technika použitá jak i karty CGA, tak i u grafické karty Hercules.</p>

<p>Na tomto místě je nutno zdůraznit, že rozlišení a barevná hloubka grafických
režimů nebyly prakticky vůbec omezeny přímo čipem <i>MC6845</i>, ale dalšími
obvody, které se k&nbsp;tomuto integrovanému obvodu připojovaly. Při použití
vyšších frekvencí hodinových impulsů bylo možné používat stabilní grafické
režimy o rozlišení 768&times;384 pixelů, teoretická hranice se pohybovala u
rozlišení 800&times;400 pixelů; při &bdquo;přetaktování&ldquo; čipu však bylo
možné použít i vyšších rozlišení, samozřejmě pouze za předpokladu, že se
využily dostatečně rychlé paměťové čipy tvořící obrazovou paměť (a to nebylo,
jak uvidíme dále, vůbec jednoduché nebo levné). Kromě přímého výstupu grafiky
byl podporován i takzvaný prokládaný (<i>interlace</i>) režim,
tj.&nbsp;střídavé vykreslování lichých a sudých obrazových řádků, používaný
zejména při zobrazování na televizorech (ovšem tento režim nebyl v&nbsp;kartách
popsaných níže použit). Čip <i>MC6845</i> dokázal adresovat až 2<sup>14</sup>
textových řádků, přičemž každý řádek mohl mít výšku 2<sup>5</sup> obrazových
řádků. Celková adresovatelná kapacita paměti byla rovna 2<sup>(14+5)</sup>=512
adres, čehož však žádná grafická karta nevyužívala. Pokud se šířka textového
řádku snížila na jeden obrazový řádek či na dva obrazové řádky (častěji),
simuloval se grafický režim, ovšem velikost obrazové paměti byla pouhých
2<sup>14</sup>=16 kB (viz například dále popsaná karta <i>CGA</i>).</p>

<p><div class="rs-tip-major">Poznámka: stále je nutné mít na paměti, že se
nejedná o plnohodnotný grafický subsystém, ale pouze o podporu pro přístup do
obrazové paměti, generování synchronizačních signálů a další maličkosti &ndash;
generování textového kurzoru apod.</div></p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Řídicí registry čipu MC6845</h2>

<p>Nastavení resp.&nbsp;přesněji řečeno konfigurace grafického řadiče
<i>MC6845</i> se provádělo přes celkem osmnáct osmibitových řídicích registrů.
Některé z&nbsp;těchto registrů byly určeny pro zápis (například registr
s&nbsp;počtem znaků na řádek atd.), jiné zase pro čtení (pozice světelného
pera). Číselné hodnoty, které mohly být větší než 2<sup>8</sup> (což je
počáteční adresa obrazové paměti, adresa kurzoru a adresa světelného pera), se
musely ukládat do dvou sousedních osmibitových registrů. Registry byly
programátorům přístupné nepřímo, konkrétně přes dvojici adres &ndash; zápis do
první adresy vybíral příslušný řídicí registr, čtení či zápis do druhé adresy
(o jedničku vyšší) již vedl ke čtení či zápisu do příslušného řídicího
registru. Díky tomu bylo možné <i>MC6845</i> použít v&nbsp;prakticky jakémkoli
počítačovém systému, a to i v&nbsp;případě, kdy je počet I/O portů zásadně
omezen (teoreticky lze tak zkombinovat MC6845 například s&nbsp;osmibitovým
mikrořadičem 8051). O které adresy oněch dvou registrů se konkrétně jedná
záleželo na zapojení konkrétní grafické karty. Například u dále popsané
grafické karty <i>CGA</i> (tedy karty určené pro IBM PC) se jedná o I/O porty
na adresách 0x3d4 a 0x3d5 a u grafické karty <i>Hercules</i> (taktéž IBM PC) se
naopak jednalo o I/O porty 0x3b4 a 0x3b5.</p>

<p>Význam jednotlivých řídicích registrů čipu 6845 je uveden v&nbsp;následující
tabulce. Povšimněte si, že jednotkami při udávání horizontálních velikostí jsou
vždy znaky a nikoli pixely &ndash; přesné časování je odvozeno od externího
hodinového signálu řízeného krystalem:</p>

<table>
<tr><th>Číslo registru</th><th>Šířka (b)</th><th>Význam</th></tr>
<tr><td> 0</td><td>8</td><td>celkový počet znaků horizontálně - 1, včetně okrajů (tedy nezobrazených znaků)</td></tr>
<tr><td> 1</td><td>8</td><td>počet horizontálně zobrazených znaků (typicky 40 či 80)</td></tr>
<tr><td> 2</td><td>8</td><td>horizontální pozice synchronizačního signálu (lze tedy posouvat obrazem na monitoru, ovšem omezeně)</td></tr>
<tr><td> 3</td><td>8</td><td>šířka horizontálního synchronizačního signálu (záleží na konkrétním monitoru, řádkové frekvenci atd.)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 4</td><td>7</td><td>celkový počet textových řádků, včetně okrajů (například 27, maximálně však 128)</td></tr>
<tr><td> 5</td><td>5</td><td>mikroposun textových řádků po jednotlivých obrazových řádcích</td></tr>
<tr><td> 6</td><td>7</td><td>zobrazený počet textových řádků (například 25)</td></tr>
<tr><td> 7</td><td>7</td><td>vertikální pozice synchronizačního signálu (lze posouvat obrazem, opět omezeně)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 8</td><td>8</td><td>režim prokládání (interlace) a posunutí</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 9</td><td>5</td><td>počet obrazových řádků pro jeden textový řádek - 1 &ndash; výška znaku (většinou 8 či 14)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>10</td><td>5+2</td><td>začátek hardwarového kurzoru (většinou výška_znaku-3)</td></tr>
<tr><td>11</td><td>5</td><td>konec hardwarového kurzoru (kurzor může mít například výšku dvou obrazových řádků)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>12</td><td>6</td><td>počáteční adresa obrazové paměti (vyšší bajt)</td></tr>
<tr><td>13</td><td>8</td><td>počáteční adresa obrazové paměti (nižší bajt)</td></tr>
<tr><td>14</td><td>6</td><td>adresa kurzoru &ndash; vyšší bajt (klasický posun hardwarového kurzoru)</td></tr>
<tr><td>15</td><td>8</td><td>adresa kurzoru &ndash; nižší bajt</td></tr>
<tr><td>16</td><td>6</td><td>adresa světelného pera &ndash; vyšší bajt</td></tr>
<tr><td>17</td><td>8</td><td>adresa světelného pera &ndash; nižší bajt</td></tr>
</table>

<p><div class="rs-tip-major">Poznámka: povšimněte si některých omezení
vyplývajících ze skutečné bitové šířky registrů, která je mnohdy menší, než by
odpovídalo maximální osmibitové šířce:</div></p>

<table>
<tr><th>Vlastnost</th><th>Omezení</th></tr>
<tr><td>celkový počet textových řádků</td><td>128</td></tr>
<tr><td>počet obrazových řádků pro řádek textový (výška textu)</td><td>32</td></tr>
<tr><td>výška kurzoru</td><td>32</td></tr>
<tr><td>adresa obrazové paměti</td><td>2<sup>14</sup></td></tr>
<tr><td>adresa kurzoru</td><td>2<sup>14</sup></td></tr>
<tr><td>adresa světelného pera</td><td>2<sup>14</sup></td></tr>
</table>

<p>Pro zajímavost se ještě podívejme, jaký je typický obsah řídicích registrů
pro textové režimy označované CO40 a CO80, tedy režimy pro grafické karty CGA
se čtyřiceti resp.&nbsp;osmdesáti znaky na řádku:</p>

<table>
<tr><th>Číslo registru</th><th>CO40</th><th>CO80</th><th>Význam</th></tr>
<tr><td> 0</td><td>56</td><td>113</td><td>celkový počet znaků horizontálně - 1, včetně okrajů (tedy nezobrazených znaků)</td></tr>
<tr><td> 1</td><td>40</td><td>80</td><td>počet horizontálně zobrazených znaků</td></tr>
<tr><td> 2</td><td>45</td><td>90</td><td>horizontální pozice synchronizačního signálu</td></tr>
<tr><td> 3</td><td>10</td><td>10</td><td>šířka horizontálního synchronizačního signálu</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 4</td><td>31</td><td>31</td><td>celkový počet textových řádků (včetně okrajů)</td></tr>
<tr><td> 5</td><td>6</td><td>6</td><td>mikroposun textových řádků po jednotlivých obrazových řádcích</td></tr>
<tr><td> 6</td><td>25</td><td>25</td><td>zobrazený počet textových řádků</td></tr>
<tr><td> 7</td><td>28</td><td>28</td><td>vertikální pozice synchronizačního signálu</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 8</td><td>2</td><td>2</td><td>režim prokládání (interlace) a posunutí</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 9</td><td>7</td><td>7</td><td>počet obrazových řádků pro jeden textový řádek - 1 &ndash; výška znaku</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>10</td><td>6</td><td>6</td><td>začátek hardwarového kurzoru</td></tr>
<tr><td>11</td><td>7</td><td>7</td><td>konec hardwarového kurzoru</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>12</td><td>0</td><td>0</td><td>počáteční adresa obrazové paměti (vyšší bajt)</td></tr>
<tr><td>13</td><td>0</td><td>0</td><td>počáteční adresa obrazové paměti (nižší bajt)</td></tr>
<tr><td>14</td><td>0</td><td>0</td><td>adresa kurzoru &ndash; vyšší bajt</td></tr>
<tr><td>15</td><td>0</td><td>0</td><td>adresa kurzoru &ndash; nižší bajt</td></tr>
<tr><td>16</td><td>0</td><td>0</td><td>adresa světelného pera &ndash; vyšší bajt</td></tr>
<tr><td>17</td><td>0</td><td>0</td><td>adresa světelného pera &ndash; nižší bajt</td></tr>
</table>

<p><div class="rs-tip-major">Poznámka: vidíme, že grafická karta CGA zobrazuje
znaky o výšce osmi obrazových řádků, přičemž kurzor je (na vybraném znaku)
zobrazen na obrazových řádcích 6 a 7. Počet viditelných textových řádků je
roven 25, což znamená, že se zobrazuje 25&times;8=200 obrazových řádků
z&nbsp;celkem 31&times;8=248 obrazových řádků (zbylých (28-25)&times;8=24
obrazových řádků tvoří okraj, zbytek je vyhrazen pro vertikální
synchronizaci.</div></p>



<p><a name="k09"></a></p>
<h2 id="k09">9. Grafická karta MDA &ndash; Monochrome Display Adapter</h2>

<p>Jak jsme si již řekli <a href="#k01">v&nbsp;úvodní kapitole</a>, nabízela
společnost IBM do svých prvních osobních počítačů (IBM) PC buď grafickou kartu
<i>MDA</i> (<i>Monochrome Display Adapter</i>), nebo grafickou kartu <i>CGA</i>
(<i>Color Graphics Adapter</i>). Dokonce bylo možné, aby byly v&nbsp;jednom
počítači současně nainstalovány obě zmíněné karty, protože ani adresy jejich
řídicích registrů &ndash; portů, ani adresní rozsah video paměti, se
nepřekrývaly &ndash; což ovšem byla v&nbsp;tehdejší době konfigurace
z&nbsp;říše snů vyžadující dva odlišné monitory. Počátek výroby obou zmíněných
typů karet se datuje do roku 1981, na což je důležité myslet především při
snaze o porovnání s&nbsp;počítači, které vyšly v&nbsp;roce 1984 a 1985: Atari
ST, Amiga a Macintosh a které tedy musely nabídnout mnohem lepší grafické
možnosti (je ostatně typické, že jen IBM PC mělo skutečný textový režim).</p>

<a href="http://i.iinfo.cz/images/559/pc83-3.jpg"><img src="http://i.iinfo.cz/images/559/pc83-3-prev.jpg" alt="pc83" height="185" width="370" /></a>
<p><i>Obrázek 10: Grafická karta MDA s&nbsp;čipem MC6845.</i></p>

<p>Grafická karta <i>MDA</i> se od prakticky všech dalších grafických adaptérů
vyráběných pro počítače IBM PC odlišovala především v&nbsp;tom, že
<strong>ne</strong>umožňovala vykreslování rastrové grafiky (označení termínem
&bdquo;grafická karta&ldquo; je tedy poněkud nepřesné nebo minimálně
zavádějící), jelikož podporovala pouze textový režim 80&times;25 znaků, který
je používán například při startu počítače či v&nbsp;operačním systému MS-DOS.
Teoreticky by však mělo být možné pracovat s&nbsp;graficko-textovou :-) kartou
<i>MDA</i> i pod systémy Linux či Open/Free BSD, například pro řízení
zobrazování na druhém monitoru u starších systémů vybavených sběrnicí ISA
(v&nbsp;moderních PC se pro zobrazení na více monitorech využívá poněkud
odlišná technologie, takže se dnes již jedná jen o teorii). V&nbsp;minulosti se
&ndash; zejména právě v&nbsp;dobách kralování DOSu &ndash; pro tuto činnost
nejčastěji používaly výprodejové karty typu <i>Hercules</i>, protože i ty byly
navrženy takovým způsobem, aby jejich řídicí porty ani adresy video paměti
nekolidovaly s&nbsp;primární grafickou kartou.</p>

<a href="http://i.iinfo.cz/images/354/pc120-1.jpg"><img src="http://i.iinfo.cz/images/354/pc120-1-prev.jpg" width="360" height="270" alt=" " /></a>
<p><i>Obrázek 11: Fotografie obrazovky počítače IBM PC se spuštěným
interpretrem BASICu, v&nbsp;němž je napsán velmi jednoduchý program.</i></p>

<p>Jednoznačnou (a kromě slušného rozlišení vlastně i jedinou) předností této
grafické karty je způsob namapování do adresního prostoru procesoru. Karta
totiž využívala segment začínající adresou <strong>b000:0000</strong> (používám
zde známé Intelovské šestnáctibitové adresování typu segment:offset), který
nebyl na dalších grafických kartách využit. Proto bylo možné tuto kartu
kombinovat s&nbsp;kartou jinou a vytvořit tak vícemonitorový systém, který
využívaly aplikace jako <strong>AutoCAD</strong> (grafická plocha a terminál
s&nbsp;příkazovým řádkem), <strong>Turbo Pascal</strong> (vývojové prostředí
zobrazené spolu s&nbsp;laděnou aplikací), <strong>Turbo C++</strong>,
<strong>Lotus 1-2-3</strong> apod. V&nbsp;praxi bylo možné použít například
kombinace grafických karet <i>CGA+MDA</i>, <i>EGA+MDA</i> a později i
<i>VGA+MDA</i>. Vzhledem k&nbsp;tomu, že firma IBM tuto kartu přestala po
několika letech vyrábět, převzal úlohu sekundární grafické karty její konkurent
<i>Hercules</i> (viz další kapitoly), který kromě zobrazení textového režimu
podporoval i režim grafický.</p>

<a href="http://i.iinfo.cz/images/354/pc120-4.png"><img src="http://i.iinfo.cz/images/354/pc120-4-prev.png" width="370" height="231" alt=" " /></a>
<p><i>Obrázek 12: Úvodní obrazovka GW-BASICu po jeho spuštění v&nbsp;emulátoru
PC (zde se konkrétně jedná o DOSBOX).</i></p>



<p><a name="k10"></a></p>
<h2 id="k10">10. Standardní textový režim karty MDA</h2>

<p>Při zobrazování znaků v&nbsp;textovém režimu <strong>80&times;25</strong>
znaků byl každý znak definovaný v&times;masce 9&times;14 pixelů, což znamená,
že rozlišení obrazovky bylo rovno 720&times;350 pixelům (samozřejmě ovšem
nebylo možné pixely přímo adresovat). Poměrně velké horizontální rozlišení (a
tím i velmi dobře čitelný text) bylo dále použito až u grafických karet
<i>Hercules</i> a <i>VGA</i> o několik let později (grafické karty <i>CGA</i> a
<i>EGA</i> byly v&nbsp;tomto ohledu zklamáním, zejména pro uživatele pracující
převážně v&nbsp;textovém režimu). Znaková sada byla na grafické kartě uložena
v&nbsp;paměti ROM, což znamená, že se při požadavku na zobrazení textů
v&nbsp;jazycích s&nbsp;nabodeníčky (jedná se o prakticky všechny jazyky kromě
angličtiny) musela tato paměť vyměnit za EPROM (typ 2764 případně 27C64)
s&nbsp;vypálenou národní znakovou sadou (původní znaková sada dodávaná firmou
IBM odpovídá kódové stránce 437, tj.&nbsp;jedná se o &bdquo;rozšířenou&ldquo;
ASCII tabulku). Každý znak na obrazovce měl k&nbsp;dispozici i svůj atributový
byte, ve kterém bylo specifikováno, zda se má tento znak zobrazit normálně,
zvýrazněně (větší intenzita), s&nbsp;podtržením, inverzně či zda by měl blikat;
dokonce bylo možné nastavit i některé kombinace těchto atributů. Barevné
atributy znaků byly použity (i když s&nbsp;poněkud jiným významem) i u dalších
grafických karet na PC.</p>

<a href="http://i.iinfo.cz/images/192/gui10-10.png"><img src="http://i.iinfo.cz/images/192/gui10-10-prev.png" width="370" height="231" alt=" " /></a>
<p><i>Obrázek 13: Tabulkový procesor VisiCalc spuštěný v&nbsp;DOSu
(resp.&nbsp;přesněji řečeno v&nbsp;jeho emulátoru). Jednalo se o jednu
z&nbsp;takzvaných &bdquo;killer application&ldquo; pro PC, která plně
podporovala i kartu MDA.</i></p>

<p>Kapacita video paměti (tedy vlastně &bdquo;textové&ldquo; paměti) na této
kartě byla rovna čtyřem kilobajtům, přičemž přesně 2000 bytů bylo zapotřebí pro
uložení všech 80&times;25 znaků a dalších 2000 bytů pro uložení jejich atributů
(z&nbsp;pohledu programátora se ukládala vždy dvojice znak-atribut,
tj.&nbsp;jednalo se o souvislou oblast paměti, i když fyzicky byly použity dva
oddělené paměťové čipy), zbylých 96 bytů bylo nevyužito. Zajímavé jsou
signálové poměry, kterými se musely řídit připojené monitory. Snímková
frekvence byla rovna 50&nbsp;Hz, řádková frekvence 18,432&nbsp;kHz
(tj.&nbsp;tato frekvence byla poněkud vyšší než u dále popisované grafické
karty <i>CGA</i>). Při prvním pohledu na údaj o snímkovém kmitočtu to může
vypadat tak, že 50&nbsp;Hz je pro práci na počítači naprosto nedostatečné,
musíme si však uvědomit, že se ponejvíce používalo tmavé pozadí, na kterém není
poblikávání obrazu tak patrné, jako na pozadí světlém či dokonce bílém.</p>

<img src="http://i.iinfo.cz/images/173/editors-3-2-13.png" class="image-214393" width="640" height="400" alt="&#160;" />
<p><i>Obrázek 14: Textový editor SpeedScript pro IBM PC (DOS).</i></p>

<p>Nastavení řídicích registrů karty MDA pro k&nbsp;tomu určený monitor:</p>

<table>
<tr><th>Číslo registru</th><th>Hodnota</th><th>Význam</th></tr>
<tr><td> 0</td><td>97</td><td>celkový počet znaků horizontálně - 1, včetně okrajů (tedy nezobrazených znaků)</td></tr>
<tr><td> 1</td><td>80</td><td>počet horizontálně zobrazených znaků</td></tr>
<tr><td> 2</td><td>82</td><td>horizontální pozice synchronizačního signálu</td></tr>
<tr><td> 3</td><td>15</td><td>šířka horizontálního synchronizačního signálu</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 4</td><td>25</td><td>celkový počet textových řádků (včetně okrajů)</td></tr>
<tr><td> 5</td><td>6</td><td>mikroposun textových řádků po jednotlivých obrazových řádcích</td></tr>
<tr><td> 6</td><td>25</td><td>zobrazený počet textových řádků</td></tr>
<tr><td> 7</td><td>25</td><td>vertikální pozice synchronizačního signálu</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 8</td><td>2</td><td>režim prokládání (interlace) a posunutí</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 9</td><td>13</td><td>počet obrazových řádků pro jeden textový řádek - 1 &ndash; výška znaku</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>10</td><td>11</td><td>začátek hardwarového kurzoru</td></tr>
<tr><td>11</td><td>12</td><td>konec hardwarového kurzoru</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>12</td><td>0</td><td>počáteční adresa obrazové paměti (vyšší bajt)</td></tr>
<tr><td>13</td><td>0</td><td>počáteční adresa obrazové paměti (nižší bajt)</td></tr>
<tr><td>14</td><td>0</td><td>adresa kurzoru &ndash; vyšší bajt</td></tr>
<tr><td>15</td><td>0</td><td>adresa kurzoru &ndash; nižší bajt</td></tr>
<tr><td>16</td><td>0</td><td>adresa světelného pera &ndash; vyšší bajt</td></tr>
<tr><td>17</td><td>0</td><td>adresa světelného pera &ndash; nižší bajt</td></tr>
</table>

<p><div class="rs-tip-major">Poznámka: vidíme, že výška znaků je skutečně rovna
14 (v&nbsp;registru R9 je hodnota o jedničku snížena) a zajímavé je, že není
určen žádný čas pro horní a dolní okraj, což plyne z&nbsp;vlastností
originálního monitoru IBM.</div></p>

<p>Na I/O portu 3B8 lze řídit způsob zobrazení:</p>

<pre>
|7|6|5|4|3|2|1|0|
 | | | | | | | `---- 1 = 80x25 text
 | | | | | `------- nepoužito
 | | | | `-------- 1 = povolení video signálu
 | | | `--------- nepoužito
 | | `---------- 1 = blikání kurzoru
 `------------- nepoužito
</pre>



<p><a name="k11"></a></p>
<h2 id="k11">11. Grafická karta CGA &ndash; Color Graphics Adapter</h2>

<p>První dostupnou grafickou kartou s&nbsp;oficiální podporou zobrazování
rastrové grafiky na osobních počítačích typu IBM PC byla grafická karta
<i>CGA</i>, což je označení, které vzniklo z&nbsp;celého názvu <i>Color
Graphics Adapter</i>. Tato karta, jež byla jako druhý standard uvedena (spolu
s&nbsp;výše popsanou kartou <i>MDA</i>) v&nbsp;roce 1981, oficiálně podporuje
celkem dva grafické režimy a dva režimy textové. Kromě toho je však pro
televizní výstup použit třetí grafický režim a vhodnou manipulací
s&nbsp;řídicími registry lze vytvořit i další textové, grafické či smíšené
režimy (v&nbsp;nichž je modifikovaný textový režim použitý pro zobrazení
rastrového obrazu, pochopitelně se sníženým horizontálním i vertikálním
rozlišením.</p>

<img src="http://i.iinfo.cz/images/559/pc83-4.png" alt="pc83" height="200" width="320" />
<p><i>Obrázek 15: Grafický režim 320&times;200 se čtyřmi barvami (známá hra
King's Quest). Jak je z&nbsp;tohoto obrázku patrné, je malý počet barev
kompenzován ditheringem, který ovšem při relativně malém rozlišení situaci snad
ještě více zhoršuje. Poněkud paradoxní je, že většina rozšířených osmibitových
počítačů dokáže &ndash; a to dokonce s&nbsp;poloviční velikostí obrazové paměti
&ndash; tento obrázek zobrazit mnohem lépe.</i></p>

<p>Vzhledem k&nbsp;omezení tohoto grafického adaptéru, který byl způsobem velmi
nízkou řádkovou frekvencí (pouhých 15,75&nbsp;kHz), bylo možné zobrazit pouze
200 obrazových řádků, a to i v&nbsp;textových režimech. Z&nbsp;tohoto důvodu
jsou jednotlivé masky znaků definovány v&nbsp;rastru pouhých 8&times;8 pixelů,
tedy podobně jako u mnohých osmibitových počítačů (<i>Atari</i>, <i>C64</i>
atd.). První znakový režim dokázal zobrazit 40 znaků na textovém řádku, počet
textových řádků byl roven 25. Ve druhém textovém režimu bylo možné zobrazit 80
znaků na řádku. Každý znak mohl mít přiřazenou jednu ze šestnácti
předdefinovaných barev, pozadí znaku bylo možné zvolit také ze šestnácti barev,
nebo pouze z&nbsp;osmi barev v&nbsp;případě, že se jeden bit atributu
rezervoval pro blikání (to bylo řešeno mimo 6845). Jak barva popředí, tak i
barva pozadí byly zapsány do takzvaného <i>atributu</i>, který měl velikost
jeden byte.</p>

<img src="http://i.iinfo.cz/images/559/pc83-5.png" alt="pc83" height="200" width="320" />
<p><i>Obrázek 16: Pro porovnání &ndash; tentýž obrázek, ovšem zobrazený
v&nbsp;grafickém režimu 320&times;200 s&nbsp;barvami šestnácti na modernější
grafické kartě (EGA, VGA).</i></p>

<p>Zajímavá je barvová paleta karty CGA. Ta obsahuje šestnáct barev, přičemž ze
základních osmi barev jsou odvozeny barvy s&nbsp;2/3 intenzitou složek (tedy
tmavší barvy). To však znamenalo, že existovaly dvě černé barvy (2/3
z&nbsp;černé je stále černá) a tmavě žlutá barva, která vypadala škaredě.
Z&nbsp;tohoto důvodu byla provedena úprava <i>v&nbsp;zapojení monitoru</i> tak,
že namísto druhé černé barvy je světle šedá a namísto tmavé žluté hnědá barva.
Tato úprava se (nyní již přímo na grafických kartách) dochovala dodnes.</p>

<p><div class="rs-tip-major">Poznámka: podobné <i>patche</i>, které provází
celou historii IBM PC, mě fascinují.</div></p>



<p><a name="k12"></a></p>
<h2 id="k12">12. Oficiální grafické režimy karty CGA</h2>

<p>Mnohem zajímavější a flexibilnější než textové režimy jsou (alespoň
zdánlivě) režimy grafické, která grafická karta <i>CGA</i> také podporovala.
Oficiálně jsou podle dokumentace IBM podporovány pouze dva grafické režimy.
V&nbsp;prvním grafickém režimu bylo možné zobrazit obraz v&nbsp;rastru
320&times;200 pixelů ve čtyřech barvách, druhý režim měl rozlišení
640&times;200 pixelů dvoubarevně. V&nbsp;grafickém režimu o rozlišení
320&times;200 pixelů mohl každý pixel nabývat jedné ze čtyř barev, které byly
vybrány z&nbsp;barvové palety. Tato paleta však nemohla být libovolná
(z&nbsp;předchozího textu víme, že v&nbsp;textovém režimu je možné použít
šestnáct barev), protože existovaly pouze dvě fixní barevné palety, přičemž při
výběru barev se IBM skutečně &bdquo;předvedla&ldquo;, protože její nevkusná
barevná schémata byla prakticky nepoužitelná :-) První paleta fixně obsahovala
barvy zelenou, červenou a hnědou (<i>red</i>, <i>green</i>, <i>brown</i>
&ndash; ovšem již víme, že hnědá byla tvořena speciálním obvodem
v&nbsp;monitoru z&nbsp;tmavě žluté), druhá paleta barvy azurovou, fialovou a
bílou (<i>cyan</i>, <i>magenta</i>, <i>white</i>). Je patrné, že obě palety se
liší pouze přidáním modré barvové složky.</p>

*** image ***
<p><i>Obrázek 17: Slavná hra Lemmings v&nbsp;režimu 320&times;200 se čtyřmi
barvami.</i></p>

<p>Čtvrtá barva byla při práci s&nbsp;BIOSem (přesněji řečeno při používání
služeb BIOSu, například přechodu do grafického režimu) vždy nastavena na
černou; ve skutečnosti se však přes řídicí registry grafické karty dala tato
barva (jako jediná) nastavit na jednu ze šestnácti předdefinovaných barev. Tuto
poměrně zajímavou možnost však, vzhledem k&nbsp;nedostupnosti technických
informací, mnoho aplikací nevyužívalo. Kapacita obrazové paměti v&nbsp;tomto
režimu byla rovna 320&times;200/8&times;2=16000 bytům, což znamenalo, že
adresovací schopnosti čipu <i>Motorola MC6845</i> byly využity jen částečně
&ndash; ve skutečnosti se v&nbsp;grafických režimech používalo pouze třináct
bitů adresy textových řádků (viz předchozí kapitoly s&nbsp;popisem tohoto
čipu), přičemž výška textových řádků musela být nastavena na dva obrazové
řádky. Ve druhém grafickém režimu o rozlišení 640&times;200 pixelů mohl každý
pixel nabývat pouze jedné ze dvou barev, které jsou při inicializaci tohoto
režimu pomocí BIOSu nastaveny na černou a bílou. S&nbsp;využitím služeb BIOSu
tyto barvy nastavit nelze, ale pomocí změny konfiguračních registrů je to možné
&ndash; lze tak generovat například zeleno-červený obraz či libovolnou jinou
kombinaci šestnácti základních barev (což opět nebylo využíváno). Kapacita
obrazové paměti byla při použití tohoto režimu rovna 640&times;200/8=16000
bytům, tj.&nbsp;naprosto stejně, jako v&nbsp;předchozím grafickém režimu.
Kapacita obrazové paměti byla z&nbsp;tohoto důvodu 16kB, přičemž posledních 384
bajtů nebylo grafickým systémem využíváno.</p>

<img src="http://i.iinfo.cz/images/407/p83-1.gif" alt="p83_" height="200" width="320" />
<p><i>Obrázek 18: Známá hra Arcade Voleyball pro dva hráče taktéž využívá
čtyřbarevný grafický režim karty CGA.</i></p>

<p>Nastavení řídicích registrů karty CGA pro oba grafické režimy (ty jsou totiž
z&nbsp;pohledu 6845 totožné):</p>

<table>
<tr><th>Číslo registru</th><th>Hodnota</th><th>Význam</th></tr>
<tr><td> 0</td><td>56</td><td>celkový počet znaků horizontálně - 1, včetně okrajů (tedy nezobrazených znaků)</td></tr>
<tr><td> 1</td><td>40</td><td>počet horizontálně zobrazených znaků</td></tr>
<tr><td> 2</td><td>45</td><td>horizontální pozice synchronizačního signálu</td></tr>
<tr><td> 3</td><td>10</td><td>šířka horizontálního synchronizačního signálu</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 4</td><td>127</td><td>celkový počet textových řádků (včetně okrajů)</td></tr>
<tr><td> 5</td><td>6</td><td>mikroposun textových řádků po jednotlivých obrazových řádcích</td></tr>
<tr><td> 6</td><td>100</td><td>zobrazený počet textových řádků</td></tr>
<tr><td> 7</td><td>112</td><td>vertikální pozice synchronizačního signálu</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 8</td><td>2</td><td>režim prokládání (interlace) a posunutí</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 9</td><td>1</td><td>počet obrazových řádků pro jeden textový řádek - 1 &ndash; výška znaku</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>10</td><td>6</td><td>začátek hardwarového kurzoru</td></tr>
<tr><td>11</td><td>7</td><td>konec hardwarového kurzoru</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>12</td><td>0</td><td>počáteční adresa obrazové paměti (vyšší bajt)</td></tr>
<tr><td>13</td><td>0</td><td>počáteční adresa obrazové paměti (nižší bajt)</td></tr>
<tr><td>14</td><td>0</td><td>adresa kurzoru &ndash; vyšší bajt</td></tr>
<tr><td>15</td><td>0</td><td>adresa kurzoru &ndash; nižší bajt</td></tr>
<tr><td>16</td><td>0</td><td>adresa světelného pera &ndash; vyšší bajt</td></tr>
<tr><td>17</td><td>0</td><td>adresa světelného pera &ndash; nižší bajt</td></tr>
</table>

<p><div class="rs-tip-major">Poznámka: z&nbsp;tabulky je patrné, že grafické
režimy jsou vlastně z&nbsp;pohledu 6845 režimy textovými se 100 textovými řádky
a znaky s&nbsp;výškou dvou mikrořádků.</div></p>

<p>Na I/O portu 3D8 lze řídit způsob zobrazení:</p>

<pre>
|7|6|5|4|3|2|1|0|  3D8 Mode Select Register
 | | | | | | | `---- 1 = 80x25 text, 0 = 40x25 text
 | | | | | | `----- 1 = 320x200 grafika, 0 = text
 | | | | | `------ 1 = monochrom, 0 = barevný výstup
 | | | | `------- 1 = povolení video signálu
 | | | `-------- 1 = 640x200 B/W grafika
 | | `--------- 1 = blikání kurzoru
 `------------ nepoužito
</pre>

<p>Další port slouží pro modifikaci barvové palety:</p>

<pre>
Text:
&nbsp;
|7|6|5|4|3|2|1|0|
 | | | | | `-------- okraj obrazovky (RGB)
 | | | | `--------- vyšší/nižší intenzita
 | | | `---------- intenzita pozadí
 `--------------- nepoužito
&nbsp;
Grafika:
&nbsp;
|7|6|5|4|3|2|1|0|
 | | | | | `-------- RGB for background
 | | | | | `-------- okraj obrazovky (RGB)
 | | | `---------- nepoužito
 | | `----------- 1 = paleta číslo 1, 0=paleta číslo 0
 `-------------- nepoužito
&nbsp;
Paleta číslo 0 = green, red, brown
Paleta číslo 1 = cyan, magenta, white
</pre>

<p>Vzhledem k&nbsp;tomu, že přímá změna hodnot konfiguračních registrů při
nastavování grafického režimu je poměrně složitá a některé hodnoty dokonce
mohly vést ke zničení připojeného monitoru (elektronika tehdejších monitorů
byla velmi jednoduchá a především &ndash; nejednalo se o multifrekvenční
monitory, které jsou vůči nekorektnímu nastavení již odolnější), byly do BIOSu
zavedeny služby určené jak pro nastavení grafických či textových režimů, tak i
služby umožňující provádění základních grafických operací &ndash; výpis znaku,
vykreslení pixelu, posun kurzoru, přečtení hodnoty pixelu atd. V&nbsp;případě
grafické karty <i>CGA</i> byly pomocí služeb BIOSu dostupné dva grafické režimy
&ndash; monochromatický režim s&nbsp;rozlišením 640&times;200 pixelů a
čtyřbarevný režim, který nabízel rozlišení 320&times;200 pixelů.</p>

<img src="http://i.iinfo.cz/images/407/p83-3.png" alt="p83_" height="200" width="320" />
<p><i>Obrázek 19: Další známá CGA hra &ndash; Paratroopers.</i></p>



<p><a name="k13"></a></p>
<h2 id="k13">13. Organizace paměti v&nbsp;monochromatickém režimu (hi-res)</h2>

<p>Nejprve si popíšeme práci v&nbsp;monochromatickém režimu, která nebyla zcela
jednoduchá, ač by se na první pohled mohlo znát, že v&nbsp;tomto případě bude
situace triviální &ndash; ostatně co může být jednoduššího, než obyčejná
pravidelná bitmapa? (v&nbsp;původním významu tohoto slova).</p>

*** image ***
<p><i>Obrázek 20: V&nbsp;hi-res režimu karty CGA mohla běžet například hra
Simcity.</i></p>

<p>V&nbsp;monochromatickém režimu grafické karty <i>CGA</i> s&nbsp;rozlišením
640&times;200 pixelů se na obrazovce pracovalo s&nbsp;celkem 128000 pixely, pro
jejichž uložení ve video paměti bylo nutné v&nbsp;grafické paměti alokovat
16000 bajtů. Ovšem přístup k&nbsp;jednotlivým pixelům nebyl zcela přímočarý,
protože celá obrazová paměť byla rozdělena na dvě podoblasti. První podoblast
byla (z&nbsp;hlediska mikroprocesoru) mapována na adresy
<strong>0xb800:0x0000-0xb900:0xffff</strong>, druhá oblast na adresy
<strong>0xba00:0x0000-0xbb00:0xffff</strong> (opět je použito adresování
segment:offset). V&nbsp;první oblasti obrazové paměti byly umístěny sudé
obrazové řádky, ve druhé oblasti řádky liché; vždy osmdesát bajtů na řádek
(80&times;8=640). Z&nbsp;této organizace obrazové paměti, která byla použita
kvůli omezeným možnostem Motoroly 6845, vyplývá, že i na první pohled poměrně
jednoduché operace, jako je vykreslení úsečky, se implementovaly poměrně
obtížně a byly z&nbsp;tohoto důvodu také pomalé.</p>

*** image ***
<p><i>Obrázek 21: Jedna z&nbsp;variant hry Simcity &ndash; Moonbase
(naprogramovaná v&nbsp;Turbo Pascalu).</i></p>

<p>Proč však byla organizace paměti tak složitá? Teoreticky by mělo být možné
čip 6845 naprogramovat tak, aby pracoval s&nbsp;200 <i>textovými</i> řádky,
přičemž každý textový řádek by byl vysoký přesně jeden obrazový řádek
(mikrořádek). Adresovací možnosti (šířka sběrnice) to umožňují, ovšem čip 6845
dokáže pracovat jen se 127 textovými řádky, což je značné omezení. Proto bylo
nutné použít triku &ndash; použije se jen 100 <i>textových</i> řádků, ale každý
bude vysoký dva mikrořádky. A pro adresaci pixelů (jejich osmic) se použije jak
adresovací sběrnice MA0 až MA12, tak i první bit z&nbsp;pětice RA0 až RA4
&ndash; a právě bit v&nbsp;RA0 vybíral horní či spodní oblast obrazové
paměti.</p>

<p><div class="rs-tip-major">Poznámka: lépe to udělat asi nešlo kvůli nutnosti
udržení kompatibility textového režimu.</div></p>



<p><a name="k14"></a></p>
<h2 id="k14">14. Standardní čtyřbarevný grafický režim karty CGA: 320&times;200</h2>

<p>Druhým standardním grafickým režimem podporovaným grafickou kartou
<i>CGA</i>, který bylo možné nastavit s&nbsp;využitím služeb BIOSu, byl
čtyřbarevný režim nabízející rozlišení 320&times;200 pixelů. V&nbsp;tomto
režimu je každý pixel v&nbsp;obrazové paměti uložen ve dvou bitech (čtyři
pixely v&nbsp;každém bajtu), což znamená, že je opět využito celkem 16000 bajtů
video paměti z&nbsp;dostupných 16 kB. Obrazová paměť je rozdělena podobným
způsobem (sudé/liché řádky) jako u režimu monochromatického, což je
pochopitelné, protože z&nbsp;hlediska čipu <i>MC6845</i> se jedná o naprosto
stejný mód, liší se jen způsob interpretace načtených dat (a ten je prováděn
v&nbsp;jiných obvodech).</p>

<img src="http://i.iinfo.cz/images/360/pc84-2.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 22: Úvodní obrazovka hry Golden Axe spuštěná v&nbsp;grafickém
režimu karty CGA. Jedná se o čtyřbarevný režim s&nbsp;rozlišením 320&times;200
pixelů.</i></p>

<p>U všech režimů karty <i>CGA</i> se však vyskytuje ještě jeden fenomén, který
uživatelé jiných počítačů neznali &ndash; souběžný přístup mikroprocesoru a
grafického řadiče do obrazové paměti nebyl kupodivu nijak ošetřen, což
způsobovalo nechvalně známé &bdquo;sněžení&ldquo;. Jediná možnost, jak zabránit
&bdquo;sněžení&ldquo;, byl zápis do obrazové paměti při vertikálním zatemnění
elektronového paprsku (horizontální zatemnění má příliš krátký interval). A to
byl další problém, protože karta CGA negenerovala přerušení před vertikálním
zatemněním &ndash; tedy něco, co uměly již osmibitové mikropočítače. Takže
čekání na zatemnění muselo probíhat tím nejhorším možným způsobem &ndash;
kontinuálním čtením příslušného bitu ze stavového registru karty CGA.</p>

<img src="http://i.iinfo.cz/images/360/pc84-3.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 23: Pro porovnání &ndash; tentýž obrázek, ovšem spuštěný
v&nbsp;šestnáctibarevném režimu karty EGA. Rozlišení sice zůstalo zachováno,
ale větší počet barev je na první pohled patrný.</i></p>

<p><div class="rs-tip-major">Poznámka: v&nbsp;počítači BBC Micro, který taktéž
používal čip 6845, se situace řešila jinak &ndash; paměti byly dostatečně
rychlé na to, aby se o přístup k&nbsp;nim spravedlivě dělil mikroprocesor i
6845. Díky tomu mohla být obrazová paměť alokována přímo v&nbsp;hlavní
RAM.</div></p>

<img src="http://i.iinfo.cz/images/360/pc84-4.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 24: Teprve s&nbsp;256 barvami (grafická karta VGA) bylo možné
odstranit dithering.</i></p>



<p><a name="k15"></a></p>
<h2 id="k15">15. Cílená modifikace řídicích registrů karty CGA a nestandardní režimy zobrazování</h2>

<p>Kromě základních (z&nbsp;pohledu programátorů <i>standardních</i>)
grafických režimů, které se nastavovaly s&nbsp;využitím služeb BIOSu, byly díky
poměrně širokým možnostem čipu <i>MC6845</i> podporovány i mnohé další grafické
módy. První z&nbsp;těchto módů je &bdquo;legální&ldquo; tj.&nbsp;zmiňuje se o
něm i oficiální dokumentace firmy IBM (ale například náš <i>SYSMAN</i> již
nikoli, což je však pochopitelné &ndash; viz další text). V&nbsp;tomto režimu
bylo možné zobrazit rastrový obraz o rozměrech 160&times;200 pixelů, přičemž
každý pixel mohl nabývat jedné ze šestnácti barev, podobně jako tomu
v&nbsp;textovém režimu (včetně výše zmíněných hacků hnědé a světle šedé barvy).
Potřebná kapacita video paměti je stejná, jako v&nbsp;případě režimu
monochromatického &ndash; tedy přesně 16000 bajtů. Tento režim však byl
použitelný pouze pro <i>kompozitní video</i>, tj.&nbsp;například pro televizory
připojené ke grafické kartě pomocí konektoru RCA. Vzhledem k&nbsp;tomu, že
obrazová frekvence je rovna 60Hz, neměl tento režim pro naši oblast (ČR,
Evropa) velký smysl, protože tento kmitočet je určen pro televizory podporující
normu NTSC.</p>

<p><div class="rs-tip-major">Poznámka: originální karta CGA skutečně kromě
konektoru pro připojení digitálního monitoru obsahovala i RCA
konektor.</div></p>

<img src="http://i.iinfo.cz/images/360/pc84-5.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 25: Další porovnání &ndash; screenshot ze hry Golden Axe spuštěné
ve čtyřbarevném režimu grafické karty CGA.</i></p>

<p>Druhý nestandardní mód je již možné použít na jakémkoli monitoru, tedy i na
originálním digitálním monitoru IBM i na jeho klonech. Ve své podstatě se jedná
o režim textový, u nějž je pomocí řídicích registrů čipu <i>MC6845</i> upravena
výška znaků na pouhé dva skenovací řádky (což již ostatně známe). Z&nbsp;toho
vyplývá, že se zobrazuje 80 znaků na 100 textových řádků (u <i>CGA</i> je počet
skenovacích řádků vždy roven 200, a to i v&nbsp;textových režimech). Pokud se
bude zobrazovat pouze znak ve tvaru polovičního obdélníku (viz rozšířená
tabulka ASCII), zvyšuje se rozlišení tohoto pseudografického režimu na
160&times;100 &bdquo;pixelů&ldquo;, přičemž každý pixel může nabývat jedné
z&nbsp;šestnácti barev (programátor tedy mění pouze barvové atributy znaků,
tj.&nbsp;každý lichý bajt). Z&nbsp;jakého důvodu se však nemůže zvýšit
vertikální rozlišení na plných 200 řádků, tj.&nbsp;snížit výšku znaku na jeden
skenovací řádek? V&nbsp;tomto případě totiž narážíme na neefektivní práci
s&nbsp;obrazovou pamětí, protože pro každý znak se musí uložit i jeho barvový
atribut (dva bajty). Pro rozlišení 160&times;100 pixelů je zapotřebí alokovat:
80&times;100 znaků=8000&times;2 bytů=16000 bytů, tj.&nbsp;dostáváme se na horní
mez kapacity obrazové paměti.</p>

<img src="http://i.iinfo.cz/images/360/pc84-6.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 26: Táž scéna, ovšem zobrazená kartou EGA v&nbsp;šestnácti barvách.</i></p>

<p>Tento poměrně zajímavý režim, použitý například i v&nbsp;několika hrách, je
možné nastavit i u dalších grafických karet, přesněji řečeno u všech karet,
které emulují funkce čipu <i>MC6845</i>, tj.&nbsp;například u karty <i>EGA</i>
i <i>VGA</i>. Ve většině případů to ale postrádá smysl, protože jejich grafické
režimy již nejsou omezeny malým počtem barev tak, jak je tomu u grafické karty
<i>CGA</i>. Programátoři se v&nbsp;minulosti pokoušeli nastavovat i další
grafické režimy. Teoreticky to není problematické, protože čip <i>MC6845</i> je
velmi flexibilní, ale mnohé monitory nedokázaly korektně pracovat v&nbsp;těch
případech, kdy se změnilo časování horizontálních a vertikálních
synchronizačních signálů &ndash; grafická karta <i>CGA</i> měla pouze jeden
krystal sloužící ke generování hodinového signálu (vstup do čipu
<i>MC6845</i>), takže například při změně horizontálního rozlišení (počtu
pixelů na obrazovém řádku) se buď musel snížit počet obrazových řádků, nebo
muselo dojít ke změně obrazové frekvence.</p>

<img src="http://i.iinfo.cz/images/360/pc84-7.png" alt="pc84" height="200" width="320" />
<p><i>Obrázek 27: Stejná scéna zobrazená kartou VGA (256 barev).</i></p>

<p>Pro doplnění přidávám vzpomínky jednoho uživatele grafické karty <i>CGA</i>:</p>

<p><i>Sending random bytes to the video registers, by the way, was
<strong>extremely</strong> dangerous. If I had known that then, I wouldn't have
even tried at all; I was lucky I didn't break anything. The monitors back then
(1987 and earlier) were fixed frequency monitors, and ran at low frequencies.
If you told the video card to do something outside of those frequencies, you
stood an excellent change of damaging the monitor. A friend of mine was trying
to get the rumored CGA 16-color mode to work and <strong>destroyed</strong> his
Compaq's build-in monitor, a small monochrome monitor that emulated color with
different shades of gray. He went to nearest Compaq dealership to get it
replaced, and when they refused to fix it, he answered with something like,
"Well, I could demonstrate how easy it is to break the monitor to your
customers by typing a three-line BASIC program on, oh... this machine over
here," and pointed to their top-of-the-line machine that some customers were
huddled around. They quickly replaced his monitor to shut him up.</i> :-)</p>



<p><a name="k16"></a></p>
<h2 id="k16">16. Grafická karta Hercules &ndash; první vážnější konkurence IBM postavený opět na čipu 6845</h2>

<p>Obě výše zmíněné grafické karty, tj.&nbsp;jak MDA, tak i CGA, mají i přes
mnohé rozdíly několik společných vlastností. Jedná se totiž v&nbsp;obou
případech o karty navržené a prodávané (od roku 1981) firmou IBM, které jsou
vybavené rozhraním pro osmibitovou variantu universální interní sběrnice ISA
(<i>Industry Standard Architecture</i>). Obě karty jsou taktéž založeny na již
popsaném grafickém řadiči <i>Motorola MC6845</i>, což by sice na první pohled
mohlo znamenat určitou míru kompatibility, ale přesný opak byl pravdou &ndash;
firma IBM u obou karet zvolila odlišné řádkové frekvence (18,432 kHz u karty
<i>MDA</i> a 15,75 kHz u karty <i>CGA</i>) i jiný typ videosignálů, což ve
výsledku vedlo k&nbsp;tomu, že pro každou kartu musel být použitý odlišný
monitor. Zatímco grafická karta <i>CGA</i> nabízela možnost barevného zobrazení
(viz předchozí kapitoly) na úkor menšího &ndash; pro mnohé uživatele
neakceptovatelného &ndash; horizontálního i vertikálního zobrazení, umožňovala
sice karta <i>MDA</i> zobrazení velmi dobře čitelného textu, ovšem bez možnosti
použití jakéhokoli grafického režimu (pochopitelně až ne pseudorežim založený
na znacích z&nbsp;rozšířené ASCII).</p>

<a href="http://i.iinfo.cz/images/360/pc84-8.png"><img src="http://i.iinfo.cz/images/360/pc84-8-prev.png" alt="pc84" height="181" width="370" /></a>
<p><i>Obrázek 28: Slavný textový editor T602 spuštěný na počítači
s&nbsp;grafickou kartou Hercules.</i></p>

<p>V&nbsp;této situaci se, pravděpodobně vůbec poprvé (z&nbsp;hlediska
koncového uživatele), projevila jedna z&nbsp;největších předností architektury
IBM PC &ndash; modularita. Zatímco firma IBM nereagovala na oprávněné výtky,
které od uživatelů přicházely především kvůli vlastnostem grafické karty
<i>CGA</i> (i mnohé osmibitové počítače totiž měly grafický subsystém vyřešený
mnohem elegantněji), objevil se v&nbsp;roce 1982 konkurenční výrobek &ndash;
grafická karta <i>Hercules Graphics Card (HGC)</i> firmy <i>Hercules Computer
Technology</i>. Výrobce tuto grafickou kartu navrhl tak, aby ji bylo možné
použít s&nbsp;monitorem určeným pro kartu <i>MDA</i>, ovšem včetně možnosti
přepnutí do monochromatického grafického režimu s&nbsp;relativně vysokým
rozlišením 720&times;348 pixelů (což je na dobu vzniku velmi slušné a dosti to
konkurovalo například Atari ST s&nbsp;monochromatickým monitorem a rozlišením
640&times;400 pixelů). Dodržení zpětné kompatibility s&nbsp;kartou <i>MDA</i>
nebylo složité &ndash; v&nbsp;textovém i grafickém režimu (viz další text) byly
použity takové frekvence synchronizačních signálů (řádková a snímková
frekvence), která odpovídaly signálům generovaným kartou <i>MDA</i>.</p>

<a href="http://i.iinfo.cz/images/360/pc84-9.png"><img src="http://i.iinfo.cz/images/360/pc84-9-prev.png" alt="pc84" height="231" width="370" /></a>
<p><i>Obrázek 29: T602 zobrazený kartou CGA (skutečný obraz má ve skutečnosti
jen 200 řádků, nikoli 400, ty byly uměle zvětšeny emulátorem).</i></p>

<p>I způsob práce v&nbsp;textovém režimu se od karty <i>MDA</i> téměř nelišil,
což znamenalo, že na této kartě bylo možné provozovat všechny aplikace
pracující v&nbsp;textovém režimu (navíc bylo možné s&nbsp;využitím rezidentních
programů simulovat i grafické režimy karty <i>CGA</i>, přičemž se jednotlivé
barevné odstíny nahrazovaly ditheringem). Především z&nbsp;těchto důvodů byla
grafická karta <i>Hercules</i> v&nbsp;první polovině osmdesátých let minulého
století velmi oblíbená a do svých sestav ji instalovali i tehdejší přední
výrobci osobních počítačů. K&nbsp;velké oblíbenosti přispěla i poměrně nízká
cena, takže se karta <i>Hercules</i> používala i v&nbsp;době nástupu grafické
karty <i>EGA</i>, jejímž popisem se ovšem dnes zabývat nebudeme (i když čip
6845 velmi zdárně emulovala!). Firma <i>Hercules Computer Technology</i>
vytvořila i následníka této grafické karty &ndash; <i>Hercules Plus</i> &ndash;
jenž se odlišoval především v&nbsp;tom, že bylo možné programově měnit znakovou
sadu v&nbsp;textovém režimu a docílit tak například zobrazení českých znaků (u
původního <i>Herculesu</i> či <i>MDA</i> se znaková sada měnila
přeprogramováním paměti EPROM).</p>

<a href="http://i.iinfo.cz/images/360/pc84-10.png"><img src="http://i.iinfo.cz/images/360/pc84-10-prev.png" alt="pc84" height="202" width="370" /></a>
<p><i>Obrázek 30: T602 zobrazený kartou EGA v&nbsp;rozlišení 640&times;350
v&nbsp;šestnácti barvách.</i></p>



<p><a name="k17"></a></p>
<h2 id="k17">17. Základní technické parametry karty Hercules</h2>

<p>Grafická karta <i>Hercules</i> je založena, podobně jako oba již popsané
grafické adaptéry firmy IBM, na čipu <i>Motorola MC6845</i>, nebo (konkrétně
v&nbsp;případě různých klonů) na VLSI obvodu se stejnými vlastnostmi i významem
řídicích portů. Jak bude z&nbsp;dalšího popisu patrné, je čip <i>MC6845</i>
v&nbsp;této kartě zapojen a naprogramován poněkud odlišným způsobem než tomu
bylo u grafické karty <i>CGA</i> i <i>MDA</i>. Kartu <i>Hercules</i> lze
připojit do standardní osmibitové sběrnice ISA (v&nbsp;dokumentaci firmy IBM
také označované termínem PC-BUS), přičemž se předpokládalo, že frekvence
hodinových signálů této sběrnice bude rovna 4,77 MHz (frekvence základního
oscilátoru 14,285 MHz je při generování hodinových signálů dělená třemi).
Modernější osobní počítače měly frekvenci hodinových signálů sběrnice ISA
zvýšenou na 8, 8.33, 10 či 12 MHz, ovšem při takto vysokých frekvencích mohlo
na kartě <i>Hercules</i> docházet k&nbsp;výpadkům dat při zápisu do video
paměti. Na grafické kartě byl kromě řadiče, podpůrných obvodů a video paměti
přítomný i jeden paralelní port, což také přispívalo k&nbsp;oblíbenosti
<i>Herculesu</i> mezi zákazníky, protože první personální počítače typu IBM PC
tyto porty neměly nainstalovány přímo na základní desce a bylo je zapotřebí
zvlášť dokupovat (a tím mimo jiné přicházet o jednu pozici na ISA sběrnici,
nehledě na relativně vysokou cenu jakýchkoli PC komponent).</p>

<a href="http://i.iinfo.cz/images/360/pc84-11.png"><img src="http://i.iinfo.cz/images/360/pc84-11-prev.png" alt="pc84" height="270" width="360" /></a>
<p><i>Obrázek 31: Textový editor T602 zobrazený poměrně neznámou kartou MCGA,
která v&nbsp;režimu nejvyššího rozlišení 640&times;480 měla jen jednu bitovou
rovinu a tím pádem podporovala pouze dvě barvy.</i></p>

<p>Kapacita obrazové paměti byla oproti kartě <i>CGA</i> zvýšena na
dvojnásobek, tj.&nbsp;na celých 32&nbsp;kB. Kromě paměťových modulů tvořících
obrazovou paměť byla na kartě nainstalována i paměť typu ROM popř.&nbsp;EPROM,
ve které byla uložena znaková sada, konkrétně bitové podoby znaků (viz další
kapitolu). Ovládání grafického čipu bylo prováděno s&nbsp;využitím parametrů
ukládaných přes vstupně/výstupní porty umístěné na adresách
<strong>0x3b0</strong> až <strong>0x3bf</strong>, přičemž na adresy
<strong>0x3b4</strong> a <strong>0x3b5</strong> byly namapovány řídicí registry
čipu <i>MC6845</i> (těchto registrů je, jak již víme z&nbsp;předchozích
kapitol, celkem osmnáct, ovšem poslední dva registry týkající se světelného
pera lze ignorovat). Vhodnou změnou parametrů docházelo k&nbsp;přepínání mezi
textovým a grafickým režimem, bylo však možné také měnit parametry zobrazení
grafiky (rozlišení, zpoždění synchronizačních signálů, pozice hardwarového
textového kurzoru, mikroposun textových řádků apod.), čehož se často používalo
při emulaci grafických režimů karty <i>CGA</i>.</p>

<a href="http://i.iinfo.cz/images/360/pc84-12.png"><img src="http://i.iinfo.cz/images/360/pc84-12-prev.png" alt="pc84" height="270" width="360" /></a>
<p><i>Obrázek 32: Nejlepší rozlišení i největší počet barev pro textový editor
T602 nabízela grafická karta VGA &ndash; 640&times;480 pixelů v&nbsp;šestnácti
barvách (editor však využil jen podmnožinu barvové palety, navíc obrazová
frekvence nebyla nijak ohromující).</i></p>

<p>Čtením stavových bitů z&nbsp;portu <strong>0x3ba</strong> bylo možné
testovat průběh horizontálního i vertikálního zatemnění (synchronizace
používaná například ve hrách) a číst polohu hrotu světelného pera. Vzhledem
k&nbsp;tomu, že grafická paměť byla z&nbsp;hlediska mikroprocesoru mapována od
adresy <strong>b000:0000</strong> do adresy <strong>b000:7fff</strong> (opět je
použit způsob adresování segment:offset), nedocházelo k&nbsp;překryvu
s&nbsp;obrazovou pamětí grafické karty <i>CGA</i> a proto lze tyto dvě karty
provozovat současně i na jednom počítači. Taktéž nedochází k&nbsp;překryvům
vstupně/výstupních portů, neboť ty jsou v&nbsp;případě karty <i>CGA</i>
umístěny o 16 bajtů výše. <i>Hercules</i> je v&nbsp;případě použití této
kombinace využit pro kvalitní zobrazování textu a monochromatické grafiky,
<i>CGA</i> pro zobrazení barevné (ehm :-) grafiky. Další poměrně oblíbenou
kombinací z&nbsp;pozdější doby byla <i>VGA</i>+<i>Hercules</i>, ovšem
v&nbsp;tomto případě <i>Hercules</i> většinou sloužil pro práci v&nbsp;textovém
režimu (čehož dokázaly využít IDE firmy Borland, AutoCAD atd.).</p>



<p><a name="k18"></a></p>
<h2 id="k18">18. Textový režim karty Hercules</h2>

<p>V&times;textovém režimu je grafická karta <i>Hercules</i> prakticky
stoprocentně kompatibilní s&nbsp;kartou <i>MDA</i>, tj.&nbsp;pracuje se
s&nbsp;textem o 80 sloupcích a 25 řádcích, včetně stejného způsobu práce
s&nbsp;atributy jednotlivých znaků (podtržení apod.). Text je zobrazován
v&nbsp;rozlišení 720&nbsp;350 pixelů, což umožňuje na jeden znak použít masku o
velikosti 9&times;14 pixelů. Textovou obrazovku lze mapovat buď od adresy
<strong>b000:0000</strong> nebo od adresy <strong>b800:0000</strong>. Jedinou
nevýhodou textového režimu grafické karty <i>Hercules</i> je fakt, že znaková
sada je uložena v&nbsp;paměti EPROM typu 27C64 a nelze ji tedy programově
změnit, pouze &bdquo;přepálit&ldquo; (pro zajímavost &ndash; všechny
<i>Herculesy</i> s&nbsp;&bdquo;přepálenou&ldquo; znakovou sadou, které jsem
viděl, používaly kódování Kamenických, viz další odstavec). Tvary znaků jsou
v&nbsp;paměti EPROM uloženy tak, jakoby jejich maska měla velikost 8&times;16
pixelů, avšak pro každý znak se při jeho vykreslování dva řádky ignorují a
podle pozice znaku v&nbsp;ASCII tabulce se doplňuje devátý sloupec pixelů, čímž
se dostáváme k&nbsp;výsledné masce 9&times;14 pixelů (devátý sloupec vzniká
kopií osmého sloupce u znaků představujících rámečky, jinak je tento sloupec
vždy prázdný).</p>

*** image ***
<p><i>Obrázek 33: Volkov Commander v&nbsp;režimu karty Hercules.</i></p>

<p>Z&nbsp;výše uvedených informací vyplývá, že pro uložení celé znakové sady by
měly dostačovat pouhé čtyři kilobajty, neboť 16 řádků&times;1 bajt&times;256
znaků=4096 bajtů. Ovšem vzhledem k&nbsp;tomu, že paměť EPROM 27C64 má kapacitu
8&nbsp;kB, jsou horní 4&nbsp;kB nevyužity. Vhodnou hardwarovou úpravou je však
možné implementovat dvě znakové sady &ndash; u nás se většinou používala
originální sada US-ASCII a již zmíněné české znaky v&nbsp;kódu Kamenických.
Kromě původní karty <i>Hercules</i> se vyráběla taktéž již zmíněná karta
<i>Hercules Plus</i>, která se od původního modelu odlišuje především
v&nbsp;tom, že znakovou sadu ukládá do paměti typu (D)RAM a umožňuje tak
programově měnit používanou znakovou sadu. U této karty je dokonce možné
rozšířit počet znaků ve znakové sadě až na teoretickou hodnotu
2<sup>12</sup>=4096 tím způsobem, že se čtyři bity v&nbsp;atributovém bajtu
použijí na definici atributů znaků a zbylé čtyři bity se připojí
k&nbsp;osmibitovému ASCII kódu znaku. Ne všechny kódy však mohou být skutečně
využity, protože velikost paměti vyhrazené pro znakovou sadu dosahuje 48 kB a
ne 64 kB.</p>

*** image ***
<p><i>Obrázek 34: QBasic v&nbsp;režimu karty Hercules.</i></p>



<p><a name="k19"></a></p>
<h2 id="k19">19. Grafický režim karty Hercules</h2>

<p>Grafický režim karty <i>Hercules</i> je, ostatně jako téměř ve všech
obdobných případech, mnohem zajímavější a flexibilnější, než režim textový.
<i>Hercules</i> podporoval na svou dobu poměrně vysoké rozlišení 720&times;348
obrazových bodů zobrazovaných černobíle nebo dvoubarevně. Konkrétní barvy
použité při zobrazování byly závislé na typu obrazovky monitoru; kromě
obligátní kombinace černá+zelená byla mezi výrobci obrazovek oblíbená například
kombinace tmavě modrá a světle červená nebo tmavě modrá a žlutá (je to možná
zvláštní kombinace, ovšem právě s&nbsp;tou jsme se mohli v&nbsp;tuzemsku setkat
poměrně často). Horizontální rozlišení grafického režimu je stejné, jako
v&nbsp;případě režimu textového, protože platí 80 znaků na řádku &times; 9
horizontálních pixelů na znak = 720 pixelů. Vertikální rozlišení se však liší o
dva skenovací řádky. V&nbsp;textovém režimu je vertikální rozlišení,
tj.&nbsp;počet obrazových řádků, rovno 350 pixelům, protože platí vztah: 25
textových řádků &times; 14 skenovacích/obrazových řádků na výšku znaku=350
skenovacích řádků celkem. V&nbsp;grafickém režimu je zvolena hodnota 348
skenovacích řádků především z&nbsp;toho důvodu, že je toto číslo dělitelné
čtyřmi, což souvisí s&nbsp;režimem přístupu do obrazové paměti, jehož princip
bude popsán v&nbsp;následujícím odstavci (ostatně změnou řídicích registrů čipu
<i>MC6845</i> lze počet obrazových řádků v&nbsp;určitém rozsahu měnit, takže
lze dosáhnout i 350 řádků &ndash; pokud vůbec někdo pozná vizuální rozdíl).</p>

*** image ***
<p><i>Obrázek 35: Hra Simcity v&nbsp;režimu grafické karty Hercules.
Z&nbsp;předchozího odstavce je patrné, že konkrétní barvové schéma se liší
podle typu monitoru (a mnohé monitory navíc měly tlačítko pro inverzní
zobrazení).</i></p>

<p>V&nbsp;případě, že porovnáme signálové poměry obou podporovaných režimů,
zjistíme, že grafický režim je prakticky totožný s&nbsp;režimem textovým.
Snížení počtu skenovacích řádků se projeví pouze delším časovým okamžikem BLANK
před vertikálním zpětným během elektronového paprsku. Obrazová paměť je při
zapnutí grafického režimu rozdělena do čtyřech oblastí. V&nbsp;paměťové oblasti
<strong>b000:0000-b000:1fff</strong> se nachází skenovací řádky 0, 4, 8,...,
v&nbsp;oblasti <strong>b000:2000-b000:3fff</strong> řádky 1, 5, 9,..., na
adresách <strong>b000:4000-b000:5fff</strong> řádky 2, 6, 10, ... a konečně
v&nbsp;paměťové oblasti <strong>b000:6000-b000:7fff</strong> skenovací řádky 3,
7, 11, ... . Přístup k&nbsp;jednotlivým pixelům je tak poměrně komplikovaný,
což umocňuje také fakt, že v&nbsp;jednom bytu je uložena vždy osmice pixelů
(proč tomu tak je již tušíme &ndash; omezení čipu 6845 v&nbsp;počtu
&bdquo;textových&ldquo; řádků &ndash; 348 je větší než 127, takže je zapotřebí
použít 348/4 textových řádků, každý s&nbsp;&bdquo;výškou&ldquo; čtyři
mikrořádky). Celková spotřeba paměti pro grafický režim karty <i>Hercules</i>
se dá vypočítat snadno. Na jeden řádek je zapotřebí alokovat 720/8=90 bytů, na
celý snímek pak 90&times;348 = 31320 bajtů. Zbylých 1440 bajtů obrazové paměti,
která má, jak již víme z&nbsp;předchozího textu kapacitu 32 kB, zůstává
nevyužito.</p>

<p>Nastavení řídicích registrů 6845:</p>

<table>
<tr><th>Číslo registru</th><th>Hodnota</th><th>Význam</th></tr>
<tr><td> 0</td><td>53</td><td>celkový počet znaků horizontálně - 1, včetně okrajů (tedy nezobrazených znaků)</td></tr>
<tr><td> 1</td><td>45</td><td>počet horizontálně zobrazených znaků</td></tr>
<tr><td> 2</td><td>46</td><td>horizontální pozice synchronizačního signálu</td></tr>
<tr><td> 3</td><td>7</td><td>šířka horizontálního synchronizačního signálu</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 4</td><td>91</td><td>celkový počet textových řádků (včetně okrajů)</td></tr>
<tr><td> 5</td><td>2</td><td>mikroposun textových řádků po jednotlivých obrazových řádcích</td></tr>
<tr><td> 6</td><td>87</td><td>zobrazený počet textových řádků (87*4=348 obrazových řádků celkem)</td></tr>
<tr><td> 7</td><td>87</td><td>vertikální pozice synchronizačního signálu</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 8</td><td>2</td><td>režim prokládání (interlace) a posunutí</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td> 9</td><td>3</td><td>počet obrazových řádků pro jeden textový řádek - 1 &ndash; výška znaku (tedy 4 mikrořádky)</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>10</td><td>0</td><td>začátek hardwarového kurzoru</td></tr>
<tr><td>11</td><td>0</td><td>konec hardwarového kurzoru</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>12</td><td>0</td><td>počáteční adresa obrazové paměti (vyšší bajt)</td></tr>
<tr><td>13</td><td>0</td><td>počáteční adresa obrazové paměti (nižší bajt)</td></tr>
<tr><td>14</td><td>0</td><td>adresa kurzoru &ndash; vyšší bajt</td></tr>
<tr><td>15</td><td>0</td><td>adresa kurzoru &ndash; nižší bajt</td></tr>
<tr><td>16</td><td>0</td><td>adresa světelného pera &ndash; vyšší bajt</td></tr>
<tr><td>17</td><td>0</td><td>adresa světelného pera &ndash; nižší bajt</td></tr>
</table>

<p>Adresa pro operaci zápisu či čtení pixelu zadaného souřadnicemi <i>x, y</i>
se vypočte následovně:</p>

<pre>
offset = 0x2000 * (y % 4) + 90 * (y &gt;&gt; 2) + (x &gt;&gt; 3)
</pre>

<p>Index bitu, který se má zapsat či přečíst na výše vypočtené adrese, lze
vyjádřit takto:</p>

<pre>
offset bit = 7 - (x % 8)
</pre>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>Support/peripheral/other chips - 6800 family<br />
<a href="http://www.cpu-world.com/Support/6800.html">http://www.cpu-world.com/Support/6800.html</a>
</li>

<li>Motorola 6845<br />
<a href="http://en.wikipedia.org/wiki/Motorola_6845">http://en.wikipedia.org/wiki/Motorola_6845</a>
</li>

<li>The 6845 Cathode Ray Tube Controller (CRTC)<br />
<a href="http://www.tinyvga.com/6845">http://www.tinyvga.com/6845</a>
</li>

<li>CRTC operation<br />
<a href="http://www.6502.org/users/andre/hwinfo/crtc/crtc.html">http://www.6502.org/users/andre/hwinfo/crtc/crtc.html</a>
</li>

<li>6845 - Motorola CRT Controller<br />
<a href="https://stanislavs.org/helppc/6845.html">https://stanislavs.org/helppc/6845.html</a>
</li>

<li>The 6845 Cathode Ray Tube Controller (CRTC)<br />
<a href="http://www.tinyvga.com/6845">http://www.tinyvga.com/6845</a>
</li>

<li>Motorola 6845 and bitwise graphics<br />
<a href="https://retrocomputing.stackexchange.com/questions/10996/motorola-6845-and-bitwise-graphics">https://retrocomputing.stackexchange.com/questions/10996/motorola-6845-and-bitwise-graphics</a>
</li>

<li>IBM Monochrome Display Adapter<br />
<a href="http://en.wikipedia.org/wiki/Monochrome_Display_Adapter">http://en.wikipedia.org/wiki/Monochrome_Display_Adapter</a>
</li>

<li>Color Graphics Adapter<br />
<a href="http://en.wikipedia.org/wiki/Color_Graphics_Adapter">http://en.wikipedia.org/wiki/Color_Graphics_Adapter</a>
</li>

<li>Wikipedia CZ: Sběrnice:<br />
<a href="http://cs.wikipedia.org/wiki/Sb%C4%9Brnice">http://cs.wikipedia.org/wiki/Sb%C4%9Brnice</a>
</li>

<li>Wikipedia EN: Industry Standard Architecture:<br />
<a href="http://en.wikipedia.org/wiki/Industry_Standard_Architecture">http://en.wikipedia.org/wiki/Industry_Standard_Architecture</a>
</li>

<li>Macintosh 128K/512K technical details<br />
<a href="https://en.wikipedia.org/wiki/Macintosh_128K/512K_technical_details">https://en.wikipedia.org/wiki/Macintosh_128K/512K_technical_details</a>
</li>

<li>MOS Technology 6522<br />
<a href="https://en.wikipedia.org/wiki/MOS_Technology_6522">https://en.wikipedia.org/wiki/MOS_Technology_6522</a>
</li>

<li>Color Graphics Adapter and the Brown color in IBM 5153 Color Display<br />
<a href="https://www.aceinnova.com/en/electronics/cga-and-the-brown-color-in-ibm-5153-color-display/">https://www.aceinnova.com/en/electronics/cga-and-the-brown-color-in-ibm-5153-color-display/</a>
</li>

<li>The Modern Retrocomputer: An Arduino Driven 6845 CRT Controller<br />
<a href="https://hackaday.com/2017/05/14/the-modern-retrocomputer-an-arduino-driven-6845-crt-controller/">https://hackaday.com/2017/05/14/the-modern-retrocomputer-an-arduino-driven-6845-crt-controller/</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2021</small></p>
</body>
</html>

