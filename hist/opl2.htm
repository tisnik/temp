<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title></title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1></h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p></p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. </a></p>
<p><a href="#k02">*** 2. Programovatelné zvukové generátory, čipy s&nbsp;FM syntézou a čipy s&nbsp;PCM</a></p>
<p><a href="#k03">*** 3. PSG &ndash; programovatelné zvukové generátory</a></p>
<p><a href="#k04">*** 4. Frekvenční modulace a její použití při zvukové syntéze</a></p>
<p><a href="#k05">*** 5. FM syntéza a hudební čipy Yamaha YM 3812 a YMF 262</a></p>
<p><a href="#k06">*** 6. Zvuková syntéza na čipu Yamaha YM 3812 (OPL2)</a></p>
<p><a href="#k07">*** 7. </a></p>
<p><a href="#k08">*** 8. </a></p>
<p><a href="#k09">*** 9. </a></p>
<p><a href="#k10">*** 10. </a></p>
<p><a href="#k11">*** 11. </a></p>
<p><a href="#k12">*** 12. </a></p>
<p><a href="#k13">*** 13. </a></p>
<p><a href="#k14">*** 14. </a></p>
<p><a href="#k15">*** 15. </a></p>
<p><a href="#k16">*** 16. </a></p>
<p><a href="#k17">*** 17. </a></p>
<p><a href="#k18">*** 18. </a></p>
<p><a href="#k19">*** 19. </a></p>
<p><a href="#k20">*** 20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. </h2>



<p><a name="k02"></a></p>
<h2 id="k02">2. Programovatelné zvukové generátory, čipy s&nbsp;FM syntézou a čipy s&nbsp;PCM</h2>

<p>Integrované obvody určené pro generování zvuků a hudby tvoří nedílnou a současně i velmi důležitou součást historie vývoje herních konzolí a samozřejmě i osmibitových domácích mikropočítačů; později též některých osobních počítačů (mezi něž patří IBM PC). Až na několik výjimek, mezi které patří především původní ZX Spectrum a vlastně i všechny počítače vyráběné v&nbsp;ČSSR, byly těmito čipy osazeny prakticky všechny úspěšné herní konzole a mikropočítače vyráběné od konce sedmdesátých let minulého století až po začátek let devadesátých, kdy již na trhu začaly převažovat šestnáctibitové a 32bitové stroje s&nbsp;mnohem většími možnostmi. A právě vlastnosti a nabízené možnosti zvukových čipů do značné míry určovaly oblíbenost dané platformy.</p>

<p>Ještě předtím, než začneme s&nbsp;popisem FM syntézy se zmiňme o tom, že pod termínem &bdquo;zvukový čip&ldquo; nebo &bdquo;hudební čip&ldquo; můžeme mít na mysli tři různé typy integrovaných obvodů. Nejjednodušší jsou obvody označované zkratkou <i>PSG</i> neboli <i>Programmable Sound Generator</i>. Interně mnohem komplikovanější jsou čipy s&nbsp;FM syntézou a později, se zvyšující se kapacitou RAM, se začaly více prosazovat i obvody určené především pro přehrávání a mixování samplů (<i>PCM</i>). Nás bude v&nbsp;kontextu dnešního článku zajímat především druhá skupina čipů, která je pro mnoho spíše hudebně zaměřených uživatelů v&nbsp;mnoha ohledech nejzajímavější.</p>



<p><a name="k03"></a></p>
<h2 id="k03">3. PSG &ndash; programovatelné zvukové generátory</h2>

<p>Všechny programovatelné zvukové čipy (PSG), které budou zmíněny v&nbsp;navazujících odstavcích, jsou založeny na zpracování vstupního hodinového signálu, kterým jsou řízeny interní moduly PSG. PSG mohou generovat obdélníkové signály s&nbsp;volitelnou frekvencí (a někdy i s&nbsp;konfigurovatelnou střídou), dále pak šum s&nbsp;volitelnou frekvencí a některé PSG navíc generují i trojúhelníkový a/nebo pilový signál (pro zvuk hudebních nástrojů je vhodnější pilový signál). Podle typu PSG můžeme na čipu očekávat i takzvaný generátor obálky (<i>envelope generator</i>), popř. i různé typy filtrů a propustí.</p>

<p>V&nbsp;případě, že je hodinový signál přiveden na běžný čítač s&nbsp;výstupem propojeným s&nbsp;klopným obvodem <strong>T</strong>, bude takto zapojený modul generovat obdélníkový výstupní signál s&nbsp;frekvencí určenou počáteční hodnotou čítače (samotná konstrukce čítačů se od sebe může odlišovat, většinou však čítají směrem k&nbsp;nule a při podtečení se na výstupu objeví impuls přivedený do klopného obvodu). Takto vytvořené obdélníkové vlny asi není zapotřebí zdlouhavě popisovat například Ataristům popř.&nbsp;majitelům PC Speakeru, ovšem zajímavé je zjistit, co se skrývá pod pojmem trojúhelníková vlna.</p>

<p>Několik PSG totiž používá pro generování trojúhelníkového nebo i pilového signálu čtyřbitový čítač (tedy 16 úrovní), jehož výstup je přes jednoduchý čtyřbitový D/A převodník přiváděn na reproduktor. To znamená, že na osciloskopu uvidíme spíše různé schůdky, ale určitě ne čistý trojúhelníkový průběh. Konkrétní tvar signálu je samozřejmě ovlivněn i filtry a zesilovačem, které &bdquo;schůdky&ldquo; do jisté míry vyhladí.</p>

<p>Generování šumu je u naprosté většiny PSG založeno na použití posuvného registru se zpětnou vazbou (<i>LSFR</i>, též <i>poly counter</i>), přičemž bitová délka tohoto registru určuje, jak bude šum znít &ndash; zda bude skutečně &bdquo;náhodný&ldquo;, nebo zda bude mít tak krátkou periodu, že vlastně vznikne pouze zkreslený tón. LSFR použité u zvukových generátorů mají mnoho podob a různou délku (od čtyř do sedmnácti bitů).</p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Frekvenční modulace a její použití při zvukové syntéze</h2>

<p>Využitím FM syntézy pro napodobení zvuku hudebních nástrojů se zabýval John Chowning, který již v&nbsp;roce 1967 učinil důležitý objev při pokusu o vygenerování zvukového efektu známého pod pojmem <i>vibrato</i>. Chowningův pokus byl založen na použití elektronického obvodu sestaveného z&nbsp;dvojice za sebe zapojených oscilátorů, tj.&nbsp;generátorů sinusových signálů, přičemž první oscilátor (s&nbsp;frekvencí cca 20 Hz) ovlivňoval frekvenci druhého oscilátoru, který generoval výsledný signál. Pomocí takto zapojené dvojice oscilátorů se Chowningovi podařilo vytvořit harmonický tón s&nbsp;celým spektrem vyšších frekvencí, přičemž změnou frekvence a amplitudy prvního oscilátoru se výška výsledného tónu neměnila, ale jeho zabarvení ano (přesněji řečeno se výška samozřejmě měnila, ale tak rychle, že lidské ucho v&nbsp;celém spektru frekvencí rozpozná právě frekvenci základní, jejíž výkon ve frekvenčním spektru je nejvyšší). Skutečné <i>vibrato</i> lze nasimulovat s&nbsp;použitím nižší frekvence prvního oscilátoru (nazývaného také <i>modulator</i>), naopak pro napodobení zvuku široké palety hudebních nástrojů je frekvence prvního modulátoru poněkud vyšší. Frekvence druhého oscilátoru (jenž se nazývá <i>carrier</i> &ndash; nosná) určuje základní frekvenci (výšku) vytvářeného tónu, přičemž podíl frekvencí obou oscilátorů lze v&nbsp;praxi vyjádřit jednoduchým zlomkem.</p>

<p>John Chowning, který v&nbsp;době svého objevu pracoval na universitě ve Stanfordu, se spojil s&nbsp;panem <i>Ishimurou</i> z&nbsp;firmy <i>Yamaha</i>, jenž při osobní návštěvě na Stanfordu po necelých deseti minutách princip FM, způsob jejího využití i důsledky pro další vývoj v&nbsp;celém oboru hudebních syntetizérů pochopil a doporučil svým nadřízeným, aby se <i>Yamaha</i> v&nbsp;této oblasti více angažovala. Důvod Ishimurova nadšení spočíval v&nbsp;tom, že pro napodobení zvuku nástrojů pomocí FM syntézy je zapotřebí pouze poměrně jednoduchý analogový či číslicový obvod (<i>Yamaha</i> se v&nbsp;tomto ohledu téměř výhradně zaměřila na číslicové&ndash;digitální zvukové obvody) a především je pro každý nástroj a tón nutné nastavovat relativně malé množství parametrů, pro jejichž uložení dostačuje pouze minimum paměti (doslova pár bajtů), takže čipy s&nbsp;FM syntézou bylo možné použít i v&nbsp;levnějších syntetizérech, na rozdíl od pozdější wavetable syntézy, která vyžaduje poměrně velké množství paměti a výkonnější procesory pro zpracování vzorků nástrojů (nehledě na to, že samotná wavetable syntéza nijak neřeší tvorbu nových zvuků, na rozdíl od FM syntézy doplněné o možnost ovlivnění obálky &ndash; <i>envelope</i> &ndash; editovaného tónu).</p>



<p><a name="k05"></a></p>
<h2 id="k05">5. FM syntéza a hudební čipy Yamaha YM 3812 a YMF 262</h2>

<p>Firma <i>Yamaha</i> si následně způsob tvorby hudby pomocí FM syntézy nechala licencovat a posléze zahájila vývoj a výrobu vlastních čipů pro syntézu hudby (původně měla tyto čipy pro <i>Yamahu</i> vyrábět firma <i>NEC</i>) a v&nbsp;roce 1983 prodala více než 200 000 kusů legendárního syntetizéru <i>Yamaha DX-7</i>, což bylo na tehdejší dobu (menší trh než dnes) považováno za velký úspěch následovaný po několika letech krachem firem, jenž vyráběly nyní již zastaralé elektromechanické a analogové syntetizéry (samotné obchodní značky těchto výrobců sice přežily, ale většinou patří jiným vlastníkům).  V&nbsp;roce 1994 dokonce přesahoval obrat trhu se zvukovými kartami s&nbsp;FM syntézou jednu miliardu dolarů &ndash; a naprostá většina těchto zvukových karet používala čip <i>OPL2</i> nebo později <i>OPL3</i>, kterými se dnes zabýváme. Zajímavé přitom je, že starší čipy vyráběné <i>Yamahou</i> ve skutečnosti používaly při zvukové syntéze fázovou modulaci (<i>PM</i>) a ne modulaci frekvenční (<i>FM</i>), přestože firma měla patent pouze na FM syntézu. I když mezi fázovou modulací a modulací frekvenční je pouze minimální rozdíl (záleží jen na tom, kdy se aktuální hodnota modulátoru použije ve výpočtu výsledného signálu), mohlo &ndash; i přes existenci patentu &ndash; na trhu vzniknout více konkurenčních řešení.</p> 



<p><a name="k06"></a></p>
<h2 id="k06">6. Zvuková syntéza na čipu Yamaha YM 3812 (OPL2)</h2>

<p>První takřka celosvětově rozšířenou zvukovou kartou na osobních počítačích kompatibilních s&nbsp;IBM PC, která obsahovala hudební čip <i>Yamaha YM 3812</i>, byla karta <i>AdLib</i>, později byl tento obvod použit i na <i>Sound Blasterech</i> a dalších typech zvukových karet (více či méně s&nbsp;<i>AdLibem</i> kompatibilních). Jedná se o plně digitální čip obsahující poměrně jednoduchý procesor doplněný o paměť ROM s&nbsp;kapacitou 512 bytů, která je rozdělena na dvě stejně velké části. V&nbsp;prvních 256 bajtech se nachází vzorky jedné čtvrtiny periody sinusového signálu uložené v&nbsp;logaritmické škále (výpočet sinusovky by byl zbytečně komplikovaný, navíc ze znalosti první čtvrtiny periody lze díky symetrii sinusovky odvodit její průběh pro celou periodu), druhých 256 bajtů obsahuje převodní hodnoty exponenciální funkce &ndash; veškeré výpočty na čipu <i>YM 3812</i> jsou totiž prováděny s&nbsp;hodnotami v&nbsp;logaritmické škále, protože nejčastější výpočty (především samotná fázová modulace, modifikace signálu obálkou pomocí amplitudové modulace, změna hlasitosti a aplikace zpětné vazby) jsou založeny na násobení, jež se v&nbsp;logaritmické škále převádí na sčítání, které je implementačně mnohem jednodušší než násobení.</p>

<p>Převod na lineární hodnoty je prováděn před posláním vypočteného signálu na externí digitálně-analogový převodník (většinou se jednalo o čip <i>YM3014B</i>, samplovací frekvence, tj.&nbsp;rychlost přenášení vzorků na D/A převodník, je poměrně vysoká &ndash; 49720 Hz). To, že je <i>YM 3812</i> plně digitálním čipem je výhodné pro jeho emulaci, protože není nutné složitě modelovat chování analogových oscilátorů či filtrů (to je mimochodem asi nejproblematičtější u slavného <i>SIDu</i>). Čip je vybaven piny pro připojení k&nbsp;osmibitové sběrnici řízené signály <strong>CS</strong>, <strong>RD</strong> a <strong>WR</strong>. Pro výběr adresy je vyveden pouze jeden pin &ndash; to je však dostačující, protože se rozlišují pouhé dvě adresy mapované do I/O prostoru 0x388 a 0x389 (tyto adresy byly z&nbsp;důvodu zpětné kompatibility použity i u modernějších zvukových karet). Na adrese 0x388 je umístěný indexový registr, do nějž se zapisuje index vybraného interního registru (0&ndash;255), a na adrese 0x389 je datový registr. Čip obsahuje 244 interních osmibitových registrů, pomocí nichž se řídí celý průběh zvukové syntézy &ndash; počet registrů je tedy mnohem vyšší, než u dříve popisovaných zvukových čipů (<i>POKEY:</i> 9 registrů, <i>SID:</i> 29 registrů, <i>AYčko:</i> 14 registrů). Zápis do interního registru musí být proveden ve dvou krocích &ndash; výběr registru zápisem jeho čísla na I/O adresu 0x388 a po malém zpoždění zápisem nové hodnoty interního registru na adresu 0x389.</p>



<p><a name="k07"></a></p>
<h2 id="k07">7. Základ OPL &ndash; operátory a jejich vzájemná vazba</h2>

<p>Čip <i>Yamaha YM 3812</i> generuje zvuk s&nbsp;využitím devíti samostatně nastavitelných hudebních kanálů, přičemž každý kanál obsahuje dvojici takzvaných <i>operátorů</i>, které mohou být navzájem propojeny buď tak, že se oba signály vytvářené v&nbsp;obou operátorech jednoduše sčítají nebo první operátor (<i>modulator</i>) ovlivňuje pomocí fázové modulace tvar signálu vytvářeného druhým operátorem (<i>carrier</i>) &ndash; viz následující obrázek.</p>

*** image ***
<p><i>Obrázek 6: Způsob zapojení dvojice operátorů v&nbsp;jednom hudebním kanálu v&nbsp;čipu OPL2. Naznačena je i zpětnovazební smyčka, která může dosti zásadním způsobem ovlivnit výsledný tón.</i></p>

<p>Každý operátor je složen ze tří bloků &ndash; oscilátoru (generátoru periodického signálu o zadané frekvenci), generátoru obálky (<i>envelope</i>) a obvodu pro řízení výstupní úrovně. Každý oscilátor může generovat periodický signál odvozený od klasické sinusovky, jejíž podoba je, jak již bylo řečeno v&nbsp;předchozím odstavci, uložena (v&nbsp;logaritmické škále) v&nbsp;256 bajtech paměti ROM přímo na hudebním čipu. Všechny čtyři varianty signálu jsou zobrazeny na následujícím obrázku. Jedná se samozřejmě již o signál převedený na lineární škálu, který lze zobrazit na osciloskopu připojeného na výstupu ze zvukové karty v&nbsp;případě, že se povolí pouze jeden z&nbsp;devíti hudebních kanálů, nastaví se sčítání výstupů obou operátorů a obálka bude obsahovat nenulovou hodnotu <i>sustain</i> (viz navazující odstavec). Na tomto místě je vhodné říci, že firma <i>Yamaha</i> vyráběla i &bdquo;originální&ldquo; čip <i>YM 3526 (OPL1)</i>, který se od <i>YM 3812</i> odlišoval prakticky pouze v&nbsp;tom, že dokázal pracovat jen se sinusovkou a nikoli s&nbsp;dalšími třemi tvary signálů (<i>OPL3</i> naopak další čtyři průběhy přidává, mezi jinými i oblíbený obdélníkový signál se širokým, teoreticky nekonečným spektrem).</p>

*** image ***
<p><i>Obrázek 7: Čip OPL2 umožňuje pro každý operátor použít jeden ze čtyř tvarů vlny založený na sinusovce o volitelné frekvenci.</i></p>



<p><a name="k08"></a></p>
<h2 id="k08">8. </h2>



<p><a name="k09"></a></p>
<h2 id="k09">9. </h2>



<p><a name="k10"></a></p>
<h2 id="k10">10. </h2>



<p><a name="k11"></a></p>
<h2 id="k11">11. </h2>



<p><a name="k12"></a></p>
<h2 id="k12">12. </h2>



<p><a name="k13"></a></p>
<h2 id="k13">13. </h2>



<p><a name="k14"></a></p>
<h2 id="k14">14. </h2>



<p><a name="k15"></a></p>
<h2 id="k15">15. </h2>



<p><a name="k16"></a></p>
<h2 id="k16">16. </h2>



<p><a name="k17"></a></p>
<h2 id="k17">17. </h2>



<p><a name="k18"></a></p>
<h2 id="k18">18. </h2>



<p><a name="k19"></a></p>
<h2 id="k19">19. </h2>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>Keyboard Synthesizer<br />
<a href="http://www.solarnavigator.net/music/instruments/keyboards.htm">http://www.solarnavigator.net/music/instruments/keyboards.htm</a>
</li>

<li>FMS - Fully Modular Synthesizer<br />
<a href="http://fmsynth.sourceforge.net/">http://fmsynth.sourceforge.net/</a>
</li>

<li>Javasynth<br />
<a href="http://javasynth.sourceforge.net/">http://javasynth.sourceforge.net/</a>
</li>

<li>Software Sound Synthesis &amp; Music Composition Packages<br />
<a href="http://www.linux-sound.org/swss.html">http://www.linux-sound.org/swss.html</a>
</li>

<li>Mx44.1 Download Page (software synthesizer for linux)<br />
<a href="http://hem.passagen.se/ja_linux/">http://hem.passagen.se/ja_linux/</a>
</li>

<li>Software synthesizer<br />
<a href="http://en.wikipedia.org/wiki/Software_synthesizer">http://en.wikipedia.org/wiki/Software_synthesizer</a>
</li>

<li>Frequency modulation synthesis<br />
<a href="http://en.wikipedia.org/wiki/Frequency_modulation_synthesis">http://en.wikipedia.org/wiki/Frequency_modulation_synthesis</a>
</li>

<li>Yamaha DX7<br />
<a href="http://en.wikipedia.org/wiki/Yamaha_DX7">http://en.wikipedia.org/wiki/Yamaha_DX7</a>
</li>

<li>Wave of the Future<br />
<a href="http://www.wired.com/wired/archive/2.03/waveguides_pr.html">http://www.wired.com/wired/archive/2.03/waveguides_pr.html</a>
</li>

<li>Analog synthesizer<br />
<a href="http://en.wikipedia.org/wiki/Analog_synthesizer">http://en.wikipedia.org/wiki/Analog_synthesizer</a>
</li>

<li>Minimoog<br />
<a href="http://en.wikipedia.org/wiki/Minimoog">http://en.wikipedia.org/wiki/Minimoog</a>
</li>

<li>Moog synthesizer<br />
<a href="http://en.wikipedia.org/wiki/Moog_synthesizer">http://en.wikipedia.org/wiki/Moog_synthesizer</a>
</li>

<li>Tutorial for Frequency Modulation Synthesis<br />
<a href="http://www.sfu.ca/~truax/fmtut.html">http://www.sfu.ca/~truax/fmtut.html</a>
</li>

<li>An Introduction To FM<br />
<a href="http://ccrma.stanford.edu/software/snd/snd/fm.html">http://ccrma.stanford.edu/software/snd/snd/fm.html</a>
</li>

<li>John Chowning<br />
<a href="http://en.wikipedia.org/wiki/John_Chowning">http://en.wikipedia.org/wiki/John_Chowning</a>
</li>

<li>Vladimir Arnost:<br />
Programmer's Guide to Yamaha YMF 262/OPL3 FM Music Synthesizer
</li>

<li>Yamaha LSI corp:<br />
YMF262, FM Operator Type L3 (OPL3)
</li>

<li>Tero T"tt":<br />
The Ad Lib Music Synthesizer Card Programming Guide
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2021</small></p>
</body>
</html>

