<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title></title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1></h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>Na sérii článků o vývoji her (či spíše hříček) pro osmibitovou herní konzoli Atari 2600 s využitím Batari Basicu dnes nepřímo navážeme. Řekneme si totiž, jak lze vyvíjet hry a dema pro slavnou a přelomovou herní konzoli NES (Nintendo Entertainment System).</p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. </a></p>
<p><a href="#k02">*** 2. </a></p>
<p><a href="#k03">*** 3. </a></p>
<p><a href="#k04">*** 4. Základní technické parametry herní konzole NES</a></p>
<p><a href="#k05">*** 5. </a></p>
<p><a href="#k06">*** 6. </a></p>
<p><a href="#k07">*** 7. </a></p>
<p><a href="#k08">*** 8. </a></p>
<p><a href="#k09">*** 9. </a></p>
<p><a href="#k10">*** 10. </a></p>
<p><a href="#k11">*** 11. </a></p>
<p><a href="#k12">*** 12. </a></p>
<p><a href="#k13">*** 13. </a></p>
<p><a href="#k14">*** 14. Základní programové vybavení pro vývoj her pro NE</a></p>
<p><a href="#k15">*** 15. Instalace <strong>ca65</strong> a <strong>cc65</strong></a></p>
<p><a href="#k16">*** 16. Instalace emulátoru NESu</a></p>
<p><a href="#k17">*** 17. Kostra programu pro NES vytvořená v&nbsp;céčku</a></p>
<p><a href="#k18">*** 18. Kostra programu pro NES vytvořená v&nbsp;assembleru</a></p>
<p><a href="#k19">*** 19. Repositář s&nbsp;demonstračními příklady</a></p>
<p><a href="#k20">*** 20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. </h2>



<p><a name="k02"></a></p>
<h2 id="k02">2. </h2>

<p>V&nbsp;úvodní části článku se budeme zabývat popisem osmibitové herní konzole nazvané <i>Nintendo Entertainment System</i>, zkráceně <i>NES</i>, která byla navržena a následně vyráběna společností <i>Nintendo Corporation</i>. Tato firma se již před uvedením <i>NESu</i> na trh zabývala konstrukcí video automatů a taktéž jednoúčelových herních konzolí s&nbsp;jedním či dvěma LCD (v&nbsp;našich zemích jsou známější podobné konzole vyráběné v&nbsp;SSSR a mnohdy upravované pro místní podmínky &ndash; odlišné postavičky atd.).  Stejně jako herní konzole firmy <i>Sega</i>, i konzole <i>NES</i> pochází z&nbsp;Japonska, kde se prodávala pod názvem <i>Family Computer</i> neboli <i>Famicom</i> (pod stejným názvem se ostatně tato konzole prodávala i v&nbsp;některých dalších asijských zemích).</p>

<img src="http://i.iinfo.cz/images/657/8203.jpg" width="450" height="289" alt="&#160;" />
<p><i>Obrázek 1: Osmibitová herní konzole Nintendo Entertainment System (NES).</i></p>

<p>Jedná se o nejúspěšnější osmibitovou herní konzoli vůbec, a to jak z&nbsp;pohledu celkového počtu prodaných kusů, tak i při pohledu na časové období, kdy byla tato konzole vyráběna a prodávána, protože se odhaduje, že bylo prodáno téměř 62 milionů kusů tohoto zařízení a navíc vzniklo přibližně padesát více či méně kompatibilních klonů NESu. A navíc byly pro tuto herní konzoli vyvinuty herní série, které vlastně pokračují dodnes (například ...). Mimochodem je 62 milionů v&nbsp;dobovém srovnání velmi vysoké číslo, a to například i v&nbsp;porovnání s&nbsp;další (již popsanou) úspěšnou herní konzolí <i>Atari 2600</i>, jíž bylo prodáno celkem 30 milionů (do obou čísel nejsou započítány klony konzole, které většinou nebyly korektně licencovány).</p>

<img src="http://i.iinfo.cz/images/234/8402-1.jpg" width="450" height="320" alt="&#160;" />
<p><i>Obrázek 2: K&nbsp;herní konzoli NES postupně vzniklo velké množství
různých přídavných zařízení a doplňků, například rozhraní pro MIDI či disketová
jednotka používající speciální diskety o průměru dva palce. Zajímavý byl taktéž
modem prodávaný zejména v&nbsp;Japonsku, který měl být používán především pro
hraní loterií.</i></p>

<p>Zajímavá je i &bdquo;morální životnost&ldquo; <i>NESu</i>, protože tato konzole byla představena již v&nbsp;roce 1983 v&nbsp;Japonsku a i když byl oficiálně prodej <i>NESu</i> ukončen &bdquo;již&ldquo; v&nbsp;roce 1995 (tj.&nbsp;po dvanácti letech), ve skutečnosti výroba pokračovala až do roku 2003 a ještě do roku 2007 nabízela firma <i>Nintendo</i> možnost oprav <i>NESu</i> (posléze byla tato nabídka stažena, protože již nebyly k&nbsp;dispozici příslušné náhradní díly). Právě na příkladu <i>NESu</i> a taktéž herní konzole <i>Atari 2600</i> je možné ukázat, že se vývoj herních konzolí poměrně podstatným způsobem odlišuje od vývoje osobních počítačů a je v&nbsp;ostrém kontrastu například s&nbsp;překotným &bdquo;morálním zastaráváním&ldquo; mobilních telefonů (kde je rozdíl asi nejvíce patrný).</p>

<p><div class="rs-tip-major">Poznámka: prodej konzole s&nbsp;osmibitovým mikroprocesorem a pouhými dvěma kilobajty operační paměti RAM v&nbsp;roce 2003 se totiž může zdát z&nbsp;technologického hlediska vlastně docela nesmyslný, z&nbsp;herního hlediska tomu však může být úplně jinak.</div></p>

<img src="http://i.iinfo.cz/images/313/8403-1.jpg" width="450" height="360" alt="&#160;" />
<p><i>Obrázek 3: Rozhraní pro MIDI určené pro NES.</i></p>

<p>Není tedy divu, že i přes některé problematické rysy NESu (ochranné prvky a zpočátku i striktní politika prodeje her třetích stran) se dosti úspěšně rozvinula tvorba &bdquo;moderních retroher&ldquo; určených právě pro tuto herní konzoli.</p>

<p><div class="rs-tip-major">Poznámka: pod pojmem &bdquo;retrohra&ldquo; se může skrývat buď hra vyvinutá skutečně pro dobové konzole (Atari 2600, Atari 5200, NES, SNES, Sega Master System, GameBoy atd.) popř.&nbsp;pro osmibitové domácí mikropočítače (), nebo naopak hra běžící na moderním hardware a využívající všechny poslední výkřiky techniky z&nbsp;oblasti CPU+GPU (a typicky programovaná ve vyšším programovacím jazyku), která pouze simuluje starší vzhled grafiky popř.&nbsp;zvuků. V&nbsp;tomto článku i v&nbsp;článcích navazujících nebudeme klamat ani hráče ani sami sebe a použijeme buď reálnou konzoli nebo alespoň její emulátor.</div></p>



<p><a name="k03"></a></p>
<h2 id="k03">3. </h2>

<p>Ještě předtím, než vykreslíme první snímek hry, je nutné alespoň do určité míry porozumět interní architektuře herní konzole NES. Interně se sice jedná o poměrně jednoduché zařízení s&nbsp;minimálním počtem čipů (což je s&nbsp;ohledem na tržní segment logické), ovšem zejména grafický subsystém může zpočátku vypadat poměrně komplikovaně, protože se v&nbsp;NESu nepoužívá přímočará bitmapová grafika, na jakou jsme zvyklí dnes například při použití knihoven SDL či SDL2. Samozřejmě je výsledkem činnosti grafického subsystému rastrový obrázek vykreslený na televizoru (či dnes spíše na monitoru připojeného k&nbsp;počítači s&nbsp;emulátorem NESu), ovšem tento rastrový obrázek vzniká interpretací (či zpracováním) několika tabulek, či možná lépe řečeno polí. Nicméně grafický subsystém NESu byl ve skutečnosti navržen velmi pečlivě a s&nbsp;ohledem na to, že se jedná o herní konzoli a nikoli o obecný domácí mikropočítač, který je sice univerzální, ovšem tato univerzalita znamená, že se prakticky v&nbsp;každém ohledu musely udělat ústupky (což je ovšem téma na samostatný článek).</p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Základní technické parametry herní konzole NES</h2>

<p>Konstruktéři herní konzole <i>NES</i> stáli před podobným problémem, jako konstruktéři všech dalších osmibitových konzolí: jakým způsobem dosáhnout uspokojivého výpočetního výkonu, dobrých grafických i zvukových schopností, a to za co nejnižší výrobní cenu, která je samozřejmě ve velmi konkurenčním prostředí herních konzolí jedním z&nbsp;nejdůležitějších parametrů. Na jednu stranu bylo snahou ušetřit co nejvíce systémových prostředků, na stranu druhou měla být <i>NES</i> minimálně o třídu lepší (z&nbsp;pohledu grafiky i zvuků) než konkurenční herní konzole, tedy především dosluhující <i>Atari 2600</i>, ale především <i></i>, <i></i> a <i></i>.</p>

<p>Výsledkem výše zmíněné snahy o dobré vybalancování výrobní ceny a schopností konzole byl systém se čtyřmi (pouhými čtyřmi!) hlavními čipy: osmibitovým mikroprocesorem <i>Ricoh 2A03</i> (<a href="#k03">kapitola 3</a>) obsahujícím i zvukový generátor (<a href="#k04">kapitola 4</a>), dále čipem <i>RP2C02</i> resp. <i>RP2C07 (PPU)</i> zajišťujícím generování grafického obrazu (<a href="#k06">kapitola 6</a>) a dvojicí paměťových čipů. Jeden z&nbsp;těchto paměťových přitom čipů tvořil programovou a datovou RAM, druhý čip sloužil grafickému procesoru pro uložení vzorků, z&nbsp;nichž se skládalo herní pole (<i>playfield</i>, ovšem nenechte se zmást i termínem <i>background</i>) a sprity, popř.&nbsp;i další důležité informace nutné pro vygenerování grafického obrazu.</p>

<p><div class="rs-tip-major">Poznámka: povšimněte si, že na rozdíl o domácích osmibitových mikropočítačů nebyla zařazena například ROM s&nbsp;operačním systémem (vše si řešil paměťový modul se hrou), ani takové &bdquo;maličkosti&ldquo; jako znaková sada apod. Na jednu stranu jsou tedy začátky programování NESu jednodušší, neboť mezi programátorem a hardwarem není umístěna žádná mezivrstva, ovšem minimálně grafický subsystém tvoří určitou vstupní bariéru.</div></p>

<img src="http://i.iinfo.cz/images/7/8404-1.png" width="256" height="224" alt="&#160;" />
<p><i>Obrázek 4: Herní série The Legend of Zelda</i></p>

<p>Systém <i>Nintendo Entertainment System</i> samozřejmě podporoval (přesněji řečeno přímo vyžadoval) použití zásuvných modulů s&nbsp;hrami či jinými aplikacemi. Tyto moduly mohly obsahovat jak paměť ROM/EPROM s&nbsp;binárním kódem hry i se všemi statickými daty (maximální adresovatelná kapacita dosahovala 32 kB, zvýšit ji bylo možné klasicky přes paměťové banky), tak i paměť RAM, jejíž typická kapacita byla 8 kB. Pomocí zásuvného modulu bylo možné rozšířit i kapacitu video paměti. Schéma zapojení jedné z&nbsp;variant herní konzole <i>Nintendo Entertainment System</i> je dostupné například na této adrese: <a href="http://nesdev.parodius.com/Ntd_8bit.jpg">http://nesdev.parodius.com/Ntd_8bit.jpg</a>.  Povšimněte si především způsobu vzájemného propojení mikroprocesoru (<i>CPU</i>) s&nbsp;grafickým procesorem (<i>PPU</i>) pomocí datové sběrnice a šesti bitů adresové sběrnice i toho, jak jsou od sebe odděleny oba čipy RAM (ve druhém případě je adresa zachycena do latche <i>LS 373</i> s&nbsp;využitím signálu <strong>ALE</strong>).</p>



<p><a name="k05"></a></p>
<h2 id="k05">5. </h2>



<p><a name="k06"></a></p>
<h2 id="k06">6. </h2>



<p><a name="k07"></a></p>
<h2 id="k07">7. </h2>



<p><a name="k08"></a></p>
<h2 id="k08">8. </h2>



<p><a name="k09"></a></p>
<h2 id="k09">9. </h2>



<p><a name="k10"></a></p>
<h2 id="k10">10. </h2>



<p><a name="k11"></a></p>
<h2 id="k11">11. Assemblery a překladače pro konzoli NES</h2>

<p>Vzhledem k&nbsp;tomu, že se mikroprocesor herní konzole <i>NES</i> lišil od původního čipu <i>MOS 6502</i> jen v&nbsp;několika málo instrukcích, je možné pro vývoj her pro <i>NES</i> používat assembler nazvaný <i>DASM</i>, o němž jsme se zmínili v&nbsp;článcích o <i>Batari BASICu</i>. Tento assembler (přesněji řečeno cross assembler) je v&nbsp;současnosti pravděpodobně nejpoužívanější, a to i v&nbsp;oblasti dalších zařízení založených na procesorech řady <i>MOS 6502</i>. Existují či v&nbsp;nedávné minulosti existovaly však i další assemblery, například starší <i>FASM</i>, v&nbsp;minulosti poměrně populární <i>X816</i> či <i>P65</i>, který je zajímavý především tím, že je naprogramován v&nbsp;Perlu a nikoli v&nbsp;jazyku C, podobně jako mnoho dalších assemblerů. Musím též doplnit informaci o disassemblerech: 6502 Simulator, TRaCER či NESrev &ndash; ten je psaný v&nbsp;Javě (v&nbsp;souvislosti s&nbsp;osmibitovými konzolemi jde o poměrně bizarní technologii :-) a jeho autorem je Kent Hansen.</p>



<p><a name="k12"></a></p>
<h2 id="k12">12. </h2>



<p><a name="k13"></a></p>
<h2 id="k13">13. </h2>



<p><a name="k14"></a></p>
<h2 id="k14">14. Základní programové vybavení pro vývoj her pro NES</h2>



<p><a name="k15"></a></p>
<h2 id="k15">15. Instalace <strong>ca65</strong> a <strong>cc65</strong></h2>

<pre>
$ <strong>sudo apt-get install cc65</strong>
&nbsp;
Reading package lists... Done
Building dependency tree
Reading state information... Done
Suggested packages:
  cc65-doc
The following NEW packages will be installed:
  cc65
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 2 162 kB of archives.
After this operation, 31,8 MB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu focal/universe amd64 cc65 amd64 2.18-1 [2 162 kB]
Fetched 2 162 kB in 5s (423 kB/s)
Selecting previously unselected package cc65.
(Reading database ... 291820 files and directories currently installed.)
Preparing to unpack .../archives/cc65_2.18-1_amd64.deb ...
Unpacking cc65 (2.18-1) ...
Setting up cc65 (2.18-1) ...
</pre>

$ <strong>cc65 --version</strong>
cc65 V2.18 - Ubuntu 2.18-1

$ <strong>ca65 --version</strong>
ca65 V2.18 - Ubuntu 2.18-1



<p><a name="k16"></a></p>
<h2 id="k16">16. Instalace emulátoru NESu</h2>

$ <strong>sudo apt-get install nestopia</strong>
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  nestopia
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 885 kB of archives.
After this operation, 3 933 kB of additional disk space will be used.
0% [Working]y
Get:1 http://archive.ubuntu.com/ubuntu focal/universe amd64 nestopia amd64 1.50-1build1 [885 kB]
Fetched 885 kB in 7s (119 kB/s)
Selecting previously unselected package nestopia.
(Reading database ... 292411 files and directories currently installed.)
Preparing to unpack .../nestopia_1.50-1build1_amd64.deb ...
Unpacking nestopia (1.50-1build1) ...
Setting up nestopia (1.50-1build1) ...
update-alternatives: using /usr/games/nestopia to provide /usr/bin/nes (nes) in auto mode
Processing triggers for desktop-file-utils (0.24+linuxmint1) ...
Processing triggers for mime-support (3.64ubuntu1) ...
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for doc-base (0.10.9) ...
Processing 1 added doc-base file...
Processing triggers for gnome-menus (3.36.0-1ubuntu1) ...
Processing triggers for man-db (2.9.1-1) ...



<p><a name="k17"></a></p>
<h2 id="k17">17. Kostra programu pro NES vytvořená v&nbsp;céčku</h2>



<p><a name="k18"></a></p>
<h2 id="k18">18. Kostra programu pro NES vytvořená v&nbsp;assembleru</h2>



<p><a name="k19"></a></p>
<h2 id="k19">19. Repositář s&nbsp;demonstračními příklady</h2>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>NesDev.org<br />
<a href="https://www.nesdev.org/">https://www.nesdev.org/</a>
</li>

<li>How to Program an NES game in C<br />
<a href="https://nesdoug.com/">https://nesdoug.com/</a>
</li>

<li>Getting Started Programming in C: Coding a Retro Game with C Part 2<br />
<a href="https://retrogamecoders.com/getting-started-with-c-cc65/">https://retrogamecoders.com/getting-started-with-c-cc65/</a>
</li>

<li>"Game Development in Eight Bits" by Kevin Zurawel<br />
<a href="https://www.youtube.com/watch?v=TPbroUDHG0s&amp;list=PLcGKfGEEONaBjSfQaSiU9yQsjPxxDQyV8&amp;index=4">https://www.youtube.com/watch?v=TPbroUDHG0s&amp;list=PLcGKfGEEONaBjSfQaSiU9yQsjPxxDQyV8&amp;index=4</a>
</li>

<li>Game Development for the 8-bit NES: A class by Bob Rost<br />
<a href="http://bobrost.com/nes/">http://bobrost.com/nes/</a>
</li>

<li>Game Development for the 8-bit NES: Lecture Notes<br />
<a href="http://bobrost.com/nes/lectures.php">http://bobrost.com/nes/lectures.php</a>
</li>

<li>NES Graphics Explained<br />
<a href="https://www.youtube.com/watch?v=7Co_8dC2zb8">https://www.youtube.com/watch?v=7Co_8dC2zb8</a>
</li>

<li>NES GAME PROGRAMMING PART 1<br />
<a href="https://rpgmaker.net/tutorials/227/?post=240020">https://rpgmaker.net/tutorials/227/?post=240020</a>
</li>

<li>NES 6502 Programming Tutorial - Part 1: Getting Started<br />
<a href="https://dev.xenforo.relay.cool/index.php?threads/nes-6502-programming-tutorial-part-1-getting-started.858389/">https://dev.xenforo.relay.cool/index.php?threads/nes-6502-programming-tutorial-part-1-getting-started.858389/</a>
</li>

<li>Minimal NES example using ca65<br />
<a href="https://github.com/bbbradsmith/NES-ca65-example">https://github.com/bbbradsmith/NES-ca65-example</a>
</li>

<li>List of 6502-based Computers and Consoles<br />
<a href="https://www.retrocompute.co.uk/list-of-6502-based-computers-and-consoles/">https://www.retrocompute.co.uk/list-of-6502-based-computers-and-consoles/</a>
</li>

<li>History of video game consoles (second generation): Wikipedia<br />
<a href="http://en.wikipedia.org/wiki/History_of_video_game_consoles_(second_generation)">http://en.wikipedia.org/wiki/History_of_video_game_consoles_(second_generation)</a>
</li>

<li>6502 - the first RISC &micro;P<br />
<a href="http://ericclever.com/6500/">http://ericclever.com/6500/</a>
</li>

<li>3 Generations of Game Machine Architecture<br />
<a href="http://www.atariarchives.org/dev/CGEXPO99.html">http://www.atariarchives.org/dev/CGEXPO99.html</a>
</li>

<li>bee - The Multi-Console Emulator<br />
<a href="http://www.thebeehive.ws/">http://www.thebeehive.ws/</a>
</li>

<li>Nerdy Nights Mirror<br />
<a href="https://nerdy-nights.nes.science/">https://nerdy-nights.nes.science/</a>
</li>

<li>NES Development Day 1: Creating a ROM<br />
<a href="https://www.moria.us/blog/2018/03/nes-development">https://www.moria.us/blog/2018/03/nes-development</a>
</li>

<li>How to Start Making NES Games<br />
<a href="https://www.matthughson.com/2021/11/17/how-to-start-making-nes-games/">https://www.matthughson.com/2021/11/17/how-to-start-making-nes-games/</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2022</small></p>
</body>
</html>

