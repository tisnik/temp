<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>MakeCode Arcade: další vizuální pomůcka pro výuku programování</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>MakeCode Arcade: další vizuální pomůcka pro výuku programování</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dnešním článku se seznámíme se základními možnostmi webového vývojového prostředí nazvaného poměrně přímočaře <i>MakeCode Arcade</i>. Jedná se o prostředí vycházející ze Scratche, ovšem s přidanými novými vlastnostmi, které oceníme nejenom při výuce.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. MakeCode Arcade: další vizuální pomůcka pro výuku programování</a></p>
<p><a href="#k02">2. Základní koncepty, s&nbsp;nimiž se v&nbsp;MakeCode Arcade pracuje</a></p>
<p><a href="#k03">3. Herní pozadí</a></p>
<p><a href="#k04">4. Rastrový obrázek zobrazený na herním pozadí</a></p>
<p><a href="#k05">5. Herní svět složený z&nbsp;dlaždic</a></p>
<p><a href="#k06">6. Sprity ve hře</a></p>
<p><a href="#k07">7. Pohyb spritu představujícího hráče</a></p>
<p><a href="#k08">8. Sprite představující protivníka</a></p>
<p><a href="#k09">9. Protivník sledující hráče</a></p>
<p><a href="#k10">10. Detekce kolize spritů a definice podmínky pro ukončení hry (game over)</a></p>
<p><a href="#k11">11. Přidání počitadla životů a počitadla dosaženého skóre</a></p>
<p><a href="#k12">*** 12. Závěrečné zhodnocení</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. MakeCode Arcade: další vizuální pomůcka pro výuku programování</h2>

<p>V&nbsp;dnešním článku se seznámíme se základními možnostmi webového
vývojového prostředí nazvaného poměrně přímočaře <i>MakeCode Arcade</i>, které
je dostupné na adrese <a
href="https://arcade.makecode.com/">https://arcade.makecode.com/</a>. Jedná se
o prostředí založené na podobném konceptu jako projekt <i>Scratch</i>, které je
primárně určeno pro tvorbu jednodušších &bdquo;arkád&ldquo;, tedy her, které si
mohou (nepatrně) starší čtenáři pamatovat z&nbsp;herních automatů. Příkladem
takového typu her může být například světově proslulý <i>PacMan</i>, herní
série s&nbsp;Mariem (<i>Mario Bros</i> atd.), herní série s&nbsp;Donkey Kongem,
nekonečná řada stříleček (zmiňme například <i>R-type</i>), bludišťové hry,
bojové sporty atd. Pro tyto účely nabízí <i>MakeCode Arcade</i> příslušné
pomocné objekty &ndash; herní pozadí, hráče, NPC, další sprity (pohyblivé
předměty), možnost ovládání hry různými ovladači, časovače atd.</p>

<a href="https://www.root.cz/obrazek/1102945/"><img src="https://i.iinfo.cz/images/36/makecodea-4-prev.png" class="image-1102945" width="370" height="198" data-prev-filename="https://i.iinfo.cz/images/36/makecodea-4-prev.png" data-prev-width="370" data-prev-height="198" data-large-filename="https://i.iinfo.cz/images/36/makecodea-4-large.png" data-large-width="720" data-large-height="386" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 1: Takto vypadá prostředí MakeCode Arcade.</i></p>

<p>Výsledná hra přitom může být spuštěna přímo v&nbsp;prostředí webového
prohlížeče (což bude nejčastější způsob) nebo ji lze nahrát do různých retro
herních konzolí, které jsou v&nbsp;MakeCode Arcade podporovány (popravdě řečeno
ale většinu těchto konzolí s&nbsp;velkou pravděpodobností nebudete znát, snad
až na herní konzoli postavenou na základě Raspberry Pi).</p>

*** image ***
<p><i>Obrázek 2: Nabídka herních konzolí, na kterých bude možné navrženou hru
přehrát.</i></p>

<p>MakeCode Arcade tedy může být druhou výukovou pomůckou ve chvíli, kdy již
možnosti projektu <i>Scratch</i> nedostačují pro tvorbu složitějších aplikací.
Důležitou novinkou je možnost přepínání mezi reprezentací programu
s&nbsp;využitím bloků a jeho zápisem v&nbsp;JavaScriptu či Pythonu, což opět
znamená, že MakeCode Arcade může být vhodným mezistupněm mezi vizuálním návrhem
programů a jejich zápisem ve skutečném programovacím jazyku.</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Základní koncepty, s&nbsp;nimiž se v&nbsp;MakeCode Arcade pracuje</h2>

<p>Ve výukovém vývojovém prostředí <i>MakeCode</i> se využívají následující
koncepty, které jsou běžně používané v&nbsp;počítačové grafice, ve hrách i
v&nbsp;interaktivních aplikacích:</p>

<ul>

<li>Herní scéna, což je buď statické pozadí (například nakreslený obrázek) nebo
pravidelné dlaždice, na které je herní svět rozdělen (podle typu hry).</li>

<li>Sprity, což jsou pohyblivé objekty ve hře (hráči, NPC, poklad atd.).
Koncept spritů je zde však oproti <i>Scratchi</i> poněkud rozšířen, jak ostatně
uvidíme dále.</li>

<li>Callback funkce volané při vzniku událostí (typicky se jedná o stisk
tlačítka ovladače či o zvolení jednoho ze směrů na ovladači, například na
klávesnici).</li>

<li>Úlohy s&nbsp;naplánovaným časem spuštění.</li>

</ul>

<p>Všechny tyto objekty, události a úlohy přitom mohou být reprezentovány jak
s&nbsp;využitím bloků, tak i ve formě programového kódu v&nbsp;Pythonu či
JavaScriptu (což je novinka, která nebyla ve standardním Scratchi použita).</p>

<a href="https://www.root.cz/obrazek/1102946/"><img src="https://i.iinfo.cz/images/36/makecodea-5-prev.png" class="image-1102946" width="192" height="270" data-prev-filename="https://i.iinfo.cz/images/36/makecodea-5-prev.png" data-prev-width="192" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/36/makecodea-5-large.png" data-large-width="373" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 3: Některé bloky, které související s&nbsp;herním prostředím
(scénou).</i></p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Herní pozadí</h2>

<p>Herní pozadí může být v&nbsp;tom nejjednodušším případě představováno
jednobarevnou plochou. Program (a jedná se o skutečně spustitelný program),
který pouze nastaví barvu pozadí, může v&nbsp;MakeCode Arcade vypadat
následovně:</p>

<a href="https://www.root.cz/obrazek/1102947/"><img src="https://i.iinfo.cz/images/36/makecodea-6.png" class="image-1102947" width="350" height="181" data-prev-filename="https://i.iinfo.cz/images/36/makecodea-6.png" data-prev-width="350" data-prev-height="181" data-large-filename="https://i.iinfo.cz/images/36/makecodea-6.png" data-large-width="350" data-large-height="181" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 4: Triviální program, který po svém spuštění pouze nastaví barvu
pozadí.</i></p>

<p>Samozřejmě můžeme barvu pozadí vybrat interaktivně z&nbsp;nabídnuté barvové
palety (která je naschvál omezena na několik barev):</p>

<a href="https://www.root.cz/obrazek/1102948/"><img src="https://i.iinfo.cz/images/36/makecodea-7.png" class="image-1102948" width="317" height="154" data-prev-filename="https://i.iinfo.cz/images/36/makecodea-7.png" data-prev-width="317" data-prev-height="154" data-large-filename="https://i.iinfo.cz/images/36/makecodea-7.png" data-large-width="317" data-large-height="154" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 5: Výběr barvy z&nbsp;barvové palety.</i></p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Rastrový obrázek zobrazený na herním pozadí</h2>

<p>Jednobarevné pozadí je nudné, ovšem MakeCode Arcade ve skutečnosti umožňuje
na pozadí vložit prakticky libovolný rastrový obrázek:</p>

<a href="https://www.root.cz/obrazek/1102949/"><img src="https://i.iinfo.cz/images/36/makecodea-8-prev.png" class="image-1102949" width="370" height="189" data-prev-filename="https://i.iinfo.cz/images/36/makecodea-8-prev.png" data-prev-width="370" data-prev-height="189" data-large-filename="https://i.iinfo.cz/images/36/makecodea-8.png" data-large-width="432" data-large-height="221" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 6: Program, který na pozadí vykreslí rastrový obrázek.</i></p>

<p>Samotný obrázek lze vybrat z&nbsp;galerie nebo si ho nakreslit v&nbsp;online
editoru (ten je dosti primitivní, ale pro dané účely dostačuje, obsahuje
operaci <i>undo</i> a triviálním způsobem &ndash; kolečkem myši &ndash;
umožňuje obrázek přiblížit a dělat v&nbsp;něm detailní změny):</p>

<a href="https://www.root.cz/obrazek/1102950/"><img src="https://i.iinfo.cz/images/36/makecodea-9-prev.png" class="image-1102950" width="370" height="196" data-prev-filename="https://i.iinfo.cz/images/36/makecodea-9-prev.png" data-prev-width="370" data-prev-height="196" data-large-filename="https://i.iinfo.cz/images/36/makecodea-9-large.png" data-large-width="720" data-large-height="382" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 7: Grafický (rastrový) editor obrázků pro herní pozadí.</i></p>

<p>Pro zpracování na detailech pozadí je možné si nechat obrázek přiblížit:</p>

<a href="https://www.root.cz/obrazek/1102951/"><img src="https://i.iinfo.cz/images/36/makecodea-10-prev.png" class="image-1102951" width="370" height="155" data-prev-filename="https://i.iinfo.cz/images/36/makecodea-10-prev.png" data-prev-width="370" data-prev-height="155" data-large-filename="https://i.iinfo.cz/images/36/makecodea-10-large.png" data-large-width="720" data-large-height="302" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 8: Přiblížení obrázku pro provedení detailních změn.</i></p>



<p><a name="k05"></a></p>
<h2 id="k05">5. Herní svět složený z&nbsp;dlaždic</h2>

<p>Mnoho klasických her používá pro reprezentaci herního světa pravidelné
dlaždice, přičemž každá dlaždice představuje určitou část světa s&nbsp;pevnou
(pravidelnou) velikostí. Velmi dobrým příkladem takové hry je například původní
hra <i>Legend of Zelda</i>, klasické plošinovky, ale i mnohé strategické hry
(pro ty se ovšem <i>MakeCode Arcade</i> příliš nehodí; tvorba strategické hry
vyžaduje dosti složitou programovou logiku):</p>

<img src="http://i.iinfo.cz/images/630/8411-1.png" alt="MarioBros" width="256" height="224">
<p><i>Obrázek 9: Screenshot hry Super Mario Bros. Celý herní svět je složen
z&nbsp;dlaždic.</i></p>

<p>Nakreslení herního světa (resp.&nbsp;přesněji řečeno jednotlivých úrovní
herního světa) je v&nbsp;MakeCode Arcade jednoduché, protože je
k&nbsp;dispozici k&nbsp;tomu určený specializovaný editor, který tyto operace
podporuje:</p>

<a href="https://www.root.cz/obrazek/1102952/"><img src="https://i.iinfo.cz/images/413/makecodeb-1-prev.png" class="image-1102952" width="370" height="180" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-1-prev.png" data-prev-width="370" data-prev-height="180" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-1-large.png" data-large-width="720" data-large-height="351" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 10: Editor herního světa složeného z&nbsp;dlaždic.</i></p>

<p>Nejkratší program (opět realizovaný s&nbsp;využitím specializovaných bloků),
který nastaví a vykreslí takto reprezentovaný herní svět, může vypadat
následovně:</p>

<a href="https://www.root.cz/obrazek/1102953/"><img src="https://i.iinfo.cz/images/413/makecodeb-2-prev.png" class="image-1102953" width="370" height="184" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-2-prev.png" data-prev-width="370" data-prev-height="184" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-2.png" data-large-width="406" data-large-height="202" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 11: Program pro vykreslení herního světa složeného z&nbsp;dlaždic.</i></p>

<p>A takto vypadá tento herní svět po spuštění v&nbsp;emulátoru herní konzole
v&nbsp;levé části okna MakeCode Arcade:</p>

<a href="https://www.root.cz/obrazek/1102954/"><img src="https://i.iinfo.cz/images/413/makecodeb-3-prev.png" class="image-1102954" width="201" height="270" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-3-prev.png" data-prev-width="201" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-3-large.png" data-large-width="390" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 12: Herní svět (zde jen jeho část) zobrazená v&nbsp;emulátoru
herní konzole.</i></p>

<p>Herní svět může být ve skutečnosti větší, než je velikost displeje
(emulované) herní konzole. V&nbsp;takovém případě je možné nastavit
&bdquo;sledování&ldquo; postavičky a automatický scrolling herního světa.</p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Sprity ve hře</h2>

<p>Nedílnou součástí naprosté většiny her jsou takzvané <i>sprity</i>, což je
(dnes již historické) označení objektů pohybujících se v&nbsp;herním světě.
Tyto objekty jsou buď přímo řízeny hráčem (postavička), nepřímo řízeny hráčem
(střela) nebo jsou řízeny programem (NPC, předměty, poklady, dnes tak
&bdquo;oblíbené&ldquo; loot boxy atd.). V&nbsp;projektu <i>MakeCode Arcade</i>
jsou sprity vykreslovány jako rastrové obrázky, z&nbsp;nichž některé pixely
mohou být průhledné; což je grafická technika používaná již několik
desetiletí.</p>

<p>V&nbsp;prostředí existuje galerie s&nbsp;výběrem spritů, ovšem nové sprity
je možné si nakreslit v&nbsp;již zmíněném vestavěném grafickém editoru:</p>

<a href="https://www.root.cz/obrazek/1102955/"><img src="https://i.iinfo.cz/images/413/makecodeb-4-prev.png" class="image-1102955" width="370" height="181" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-4-prev.png" data-prev-width="370" data-prev-height="181" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-4-large.png" data-large-width="720" data-large-height="352" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 13: Rastrový grafický editor, tentokrát při úpravě spritu.</i></p>

<p>Rozšíření programu, který původně pouze vykreslil pozadí, na program, který
vykreslí i sprite, bude vypadat následovně:</p>

<a href="https://www.root.cz/obrazek/1102956/"><img src="https://i.iinfo.cz/images/413/makecodeb-5-prev.png" class="image-1102956" width="370" height="159" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-5-prev.png" data-prev-width="370" data-prev-height="159" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-5.png" data-large-width="714" data-large-height="307" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 14: Program, který vykreslí pozadí i sprite.</i></p>

<p><div class="rs-tip-major">Poznámka: povšimněte si, že sprite je pojmenovaný
objekt. Toto jméno je vlastně i jménem proměnné, přes níž se sprite ovládá
z&nbsp;Pythonu a JavaScriptu.</div></p>

<p>A takto bude vypadat výsledek po zobrazení v&nbsp;emulátoru herní
konzole:</p>

<a href="https://www.root.cz/obrazek/1102957/"><img src="https://i.iinfo.cz/images/413/makecodeb-6-prev.png" class="image-1102957" width="201" height="270" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-6-prev.png" data-prev-width="201" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-6-large.png" data-large-width="392" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 15: Program zobrazující pozadí a sprite po zobrazení
v&nbsp;emulátoru herní konzole.</i></p>



<p><a name="k07"></a></p>
<h2 id="k07">7. Pohyb spritu představujícího hráče</h2>

<p>Typickou úlohou pro sprite představujícího hráče je jeho ovládání
s&nbsp;využitím směrového ovladače nebo kurzorových šipek. Emulátor herní
konzole směrový ovladač (zde ve tvaru kříže) má a ve webové verzi se ovládá buď
právě kurzorovými šipkami nebo přes klávesy WSAD. Jak se však řeší pohyb
spritu/hráče? Klasické řešení spočívá v&nbsp;implementaci těchto kroků:</p>

<ol>
<li>Přečtení stavu ovladače</li>
<li>Série (typicky čtyř) rozhodovacích konstrukcí typu &bdquo;pokud je stisknut směr doleva, změn x-ovou pozici hráče o -1&ldquo;</li>
</ol>

<p>Tento algoritmus byl v&nbsp;praxi realizován snad již milionkrát, ovšem v&nbsp;MakeCode
Arcade to není nutné dělat ještě jednou :-) K&nbsp;dispozici je totiž speciální
blok, který přímo propojí ovladač s&nbsp;daným spritem a dokonce umožní zvolit
si relativní rychlost posunu hráče. Vše, co je zapotřebí do hry přidat, aby se
začal hráč pohybovat, je právě tento jediný blok:</p>

<a href="https://www.root.cz/obrazek/1102958/"><img src="https://i.iinfo.cz/images/413/makecodeb-7-prev.png" class="image-1102958" width="370" height="194" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-7-prev.png" data-prev-width="370" data-prev-height="194" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-7.png" data-large-width="716" data-large-height="376" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 16 Rozšíření programu o zajištění pohybu hráče ve hře
s&nbsp;využitím ovládacích tlačítek (resp.&nbsp;ovladače na herní
konzoli).</i></p>

<p>Pokud nyní v&nbsp;levé části webové stránky emulátor herní konzole spustíme,
bude možné hráče ovládat přes klávesy WASD (jak je tomu v&nbsp;mnoha hrách) či
přes kurzorové šipky. Pokud tomu tak není, tedy v&nbsp;případě, že hráče nelze
takto ovládat, pokuste se získat fokus na tuto část webové stránky kliknutím
myší na libovolné místo na webové konzoli.</p>

<a href="https://www.root.cz/obrazek/1102959/"><img src="https://i.iinfo.cz/images/413/makecodeb-8-prev.png" class="image-1102959" width="203" height="270" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-8-prev.png" data-prev-width="203" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-8-large.png" data-large-width="395" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 17: Spuštění programu v&nbsp;emulátoru herní konzole.</i></p>

<p>A jak bude vypadat příslušný programový kód získaný transformací
z&nbsp;&bdquo;bloků&ldquo; do JavaScriptu nebo Pythonu?</p>

<p>Odpovídající kód v&nbsp;JavaScriptu:</p>

<pre>
scene.setBackgroundImage(img`
...
zkráceno
...
`)
let mySprite = sprites.create(img`
        . . . . . . f f f f . . . . . . 
            . . . . f f f 2 2 f f f . . . . 
            . . . f f f 2 2 2 2 f f f . . . 
            . . f f f e e e e e e f f f . . 
            . . f f e 2 2 2 2 2 2 e e f . . 
            . . f e 2 f f f f f f 2 e f . . 
            . . f f f f e e e e f f f f . . 
            . f f e f b f 4 4 f b f e f f . 
            . f e e 4 1 f d d f 1 4 e e f . 
            . . f e e d d d d d d e e f . . 
            . . . f e e 4 4 4 4 e e f . . . 
            . . e 4 f 2 2 2 2 2 2 f 4 e . . 
            . . 4 d f 2 2 2 2 2 2 f d 4 . . 
            . . 4 4 f 4 4 5 5 4 4 f 4 4 . . 
            . . . . . f f f f f f . . . . . 
            . . . . . f f . . f f . . . . .
    `, SpriteKind.Player)
controller.moveSprite(mySprite, 100, 100)
</pre>

<p>Odpovídající kód v&nbsp;Pythonu:</p>

<pre>
scene.set_background_image(img("""
...
zkráceno
...
"""))
mySprite = sprites.create(img("""
        . . . . . . f f f f . . . . . . 
            . . . . f f f 2 2 f f f . . . . 
            . . . f f f 2 2 2 2 f f f . . . 
            . . f f f e e e e e e f f f . . 
            . . f f e 2 2 2 2 2 2 e e f . . 
            . . f e 2 f f f f f f 2 e f . . 
            . . f f f f e e e e f f f f . . 
            . f f e f b f 4 4 f b f e f f . 
            . f e e 4 1 f d d f 1 4 e e f . 
            . . f e e d d d d d d e e f . . 
            . . . f e e 4 4 4 4 e e f . . . 
            . . e 4 f 2 2 2 2 2 2 f 4 e . . 
            . . 4 d f 2 2 2 2 2 2 f d 4 . . 
            . . 4 4 f 4 4 5 5 4 4 f 4 4 . . 
            . . . . . f f f f f f . . . . . 
            . . . . . f f . . f f . . . . .
    """),
    SpriteKind.player)
controller.move_sprite(mySprite, 100, 100)
</pre>

<p><div class="rs-tip-major">Poznámka: povšimněte si, že přímo
v&nbsp;programovém kódu je zakódován obrázek spritu.</div></p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Sprite představující protivníka</h2>

<p>V&nbsp;dalším kroku do programu se vznikající hrou přidáme nový sprite,
který bude v&nbsp;tomto případě představovat protivníka. Použijeme k&nbsp;tomu
stejný blok, jako byl blok pro přidání hráče, pouze se změní typ spritu
z&nbsp;<i>Player</i> na <i>Enemy</i> (a při změně typu spritu si povšimněte
dalších voleb typů spritu). Výsledný program by měl (v&nbsp;zobrazení založeném
na blocích) vypadat následovně:</p>

<a href="https://www.root.cz/obrazek/1102960/"><img src="https://i.iinfo.cz/images/413/makecodeb-9-prev.png" class="image-1102960" width="370" height="231" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-9-prev.png" data-prev-width="370" data-prev-height="231" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-9-large.png" data-large-width="720" data-large-height="450" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 18: Přidání druhého spritu představujícího protivníka do
programu.</i></p>

<p>Po spuštění hry je možné hráčem pohybovat (s&nbsp;využitím ovladače
resp.&nbsp;klávesnice), kdežto druhý sprite bude pouze zobrazen ve středu
herního pole a bude prozatím zcela nepohyblivý:</p>

<a href="https://www.root.cz/obrazek/1102961/"><img src="https://i.iinfo.cz/images/413/makecodeb-10-prev.png" class="image-1102961" width="228" height="270" data-prev-filename="https://i.iinfo.cz/images/413/makecodeb-10-prev.png" data-prev-width="228" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/413/makecodeb-10-large.png" data-large-width="443" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 19: Hráčem je možný pohybovat, druhý sprite zůstává na
místě.</i></p>



<p><a name="k09"></a></p>
<h2 id="k09">9. Protivník sledující hráče</h2>

<p>V&nbsp;dalším kroku se pokusíme protivníka ve hře rozpohybovat. MakeCode
Arcade nám v&nbsp;tomto případě dokonce nabízí jeden předpřipravený způsob
pohybu &ndash; NPC (neboli postavička řízená počítačem, nikoli hráčem) může
sledovat hráče resp.&nbsp;se může snažit se k&nbsp;němu přiblížit po nejkratší
možné dráze. Toto chování zajistíme přidáním bloku, který je na dalším
screenshotu zvýrazněn žlutou barvou:</p>

<a href="https://www.root.cz/obrazek/1102962/"><img src="https://i.iinfo.cz/images/634/makecodec-1-prev.png" class="image-1102962" width="370" height="258" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-1-prev.png" data-prev-width="370" data-prev-height="258" data-large-filename="https://i.iinfo.cz/images/634/makecodec-1-large.png" data-large-width="720" data-large-height="502" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 20: Nyní bude protivník, tedy postavička řízená počítačem,
sledovat hráče a pohybovat se jeho směrem relativní rychlosti 50 rychlostních
jednotek (tedy přibližně s&nbsp;poloviční rychlostí oproti hráči).</i></p>

<p>Povšimněte si, že se již na dvou místech pracuje s&nbsp;rychlostí. Prvně je
možné nastavit rychlost při ovládání hráče (výchozí hodnotou je 100
rychlostních jednotek) a podruhé jsme nastavili rychlost sledujícího NPC
(spritu). A samozřejmě na závěr si můžeme vše otestovat v&nbsp;emulátoru herní
konzole:</p>

<a href="https://www.root.cz/obrazek/1102963/"><img src="https://i.iinfo.cz/images/634/makecodec-2-prev.png" class="image-1102963" width="230" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-2-prev.png" data-prev-width="230" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-2-large.png" data-large-width="448" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 21: Protivník sledující hráče v&nbsp;emulátoru herní
konzole.</i></p>

<p>Do hry přidáme v&nbsp;rámci <a href="#k10">navazující kapitoly</a> test na
kolizi hráče s&nbsp;NPC. Ovšem tyto dva sprity ve skutečnosti kolidují již na
začátku hry, protože oba sprity jsou umístěny doprostřed herního světa. To
ovšem můžeme změnit, a to dosti triviálně &ndash; přidáním dvojice bloků
&bdquo;set sprite position&ldquo;, přičemž se x-ové a y-ové pozice spritů sice
zapisují číselně, ale vybírají se interaktivně v&nbsp;k&nbsp;tomu určených
dialozích. Podívejme se tedy, jak lze zajistit, aby se hráč objevil
v&nbsp;pravém dolním rohu zatímco NPC v&nbsp;levém horním rohu:</p>

<a href="https://www.root.cz/obrazek/1102964/"><img src="https://i.iinfo.cz/images/634/makecodec-3-prev.png" class="image-1102964" width="304" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-3-prev.png" data-prev-width="304" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-3-large.png" data-large-width="591" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 22: Přidání dvou bloků, které zajistí nastavení pozice hráče i
protivníka.</i></p>

<p>Přičemž výsledek by měl po zobrazení na herní konzoli vypadat
následovně:</p>

<a href="https://www.root.cz/obrazek/1102965/"><img src="https://i.iinfo.cz/images/634/makecodec-4-prev.png" class="image-1102965" width="231" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-4-prev.png" data-prev-width="231" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-4-large.png" data-large-width="450" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 23: Výchozí pozice obou spritů v&nbsp;herní scéně nyní bude
vypadat následovně.</i></p>



<p><a name="k10"></a></p>
<h2 id="k10">10. Detekce kolize spritů a definice podmínky pro ukončení hry (game over)</h2>

<p>Jména spritů zvolená prostředím MakeCode Arcade, tedy
<strong>mySprite</strong> a <strong>mySprite2</strong>, nejsou ideální. Ovšem
jejich přejmenování je snadné, postačuje k&nbsp;tomu vybrat položku
v&nbsp;kontextovém menu zobrazeném po kliknutí na jméno spritu. Zajímavé je, že
se sprite nemůže jmenovat ani <strong>Player</strong> ani
<strong>Enemy</strong>, protože tento identifikátor je použit v&nbsp;atributu
<strong>Kind</strong> (což znamená, že se interně používá jediný jmenný
prostor). Proto sprity přejmenujeme na <strong>player1</strong> a
<strong>enemy1</strong>. K&nbsp;přejmenování dojde automaticky ve všech
blocích, kde se dané jméno vyskytuje:</p>

<a href="https://www.root.cz/obrazek/1102966/"><img src="https://i.iinfo.cz/images/634/makecodec-5-prev.png" class="image-1102966" width="296" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-5-prev.png" data-prev-width="296" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-5-large.png" data-large-width="576" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 24 První sprite byl přejmenován na &bdquo;player1&ldquo;, druhý
sprite na &bdquo;enemy1&ldquo;.</i></p>

<p>Nyní se pokusíme o přidání sofistikovanější podmínky &ndash; budeme
detekovat situaci, kdy protivník dostihne hráče. V&nbsp;takovém případě by hra
měla skončit prohrou hráče. Pro detekci kolize spritů existuje v&nbsp;MakeCode
Arcade speciální blok, který vlastně představuje takzvaný <i>handler
události</i> typu &bdquo;kolize spritů&ldquo;. Akce definované v&nbsp;tomto
bloku budou zavolány po kolizi. My přidáme jedinou akci, a to konkrétně akci
pro ukončení hry, takže výsledek bude vypadat následovně:</p>

<a href="https://www.root.cz/obrazek/1102967/"><img src="https://i.iinfo.cz/images/634/makecodec-6-prev.png" class="image-1102967" width="370" height="88" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-6-prev.png" data-prev-width="370" data-prev-height="88" data-large-filename="https://i.iinfo.cz/images/634/makecodec-6-large.png" data-large-width="720" data-large-height="171" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 25: Blok, v&nbsp;němž lze reagovat na událost vzniklou ve chvíli,
kdy dojde k&nbsp;detekci kolize spritů.</i></p>

<p>A takto se bude chovat výsledná hra v&nbsp;emulátoru herní konzole:</p>

<a href="https://www.root.cz/obrazek/1102968/"><img src="https://i.iinfo.cz/images/634/makecodec-7-prev.png" class="image-1102968" width="226" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-7-prev.png" data-prev-width="226" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-7-large.png" data-large-width="439" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 26: Po srážce spritů se zobrazí informace o konci hry.</i></p>

<p><div class="rs-tip-major">Poznámka: povšimněte si, že prozatím náš
programový kód neobsahuje ani jedinou podmínku ani smyčku! Dokonce ani žádné
pomocné proměnné, jen objekty typu pozadí a sprite.</div></p>



<p><a name="k11"></a></p>
<h2 id="k11">11. Přidání počitadla životů a počitadla dosaženého skóre</h2>

<p>Pojďme v&nbsp;našich vylepšeních hry ještě dále. V&nbsp;následujícím kroku
upravíme program tak, aby po kolizi spritů došlo ke snížení počtu zbývajících
životů hráče a hra byla ukončena skutečně až po dosažení nuly. Počitadlo životů
je v&nbsp;MakeCode Arcade realizováno několika bloky, které použijeme nyní.
Především v&nbsp;inicializační části doplníme inicializaci počtu životů
(poslední blok):</p>

<a href="https://www.root.cz/obrazek/1102969/"><img src="https://i.iinfo.cz/images/634/makecodec-8-prev.png" class="image-1102969" width="268" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-8-prev.png" data-prev-width="268" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-8-large.png" data-large-width="522" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 27: Modifikace hlavního bloku hry &ndash; nastavení počtu
životů.</i></p>

<p>V&nbsp;navazujícím kroku upravíme handler události typu &bdquo;kolize
spritů&ldquo;. Počitadlo životů zde snížíme o jedničku, ovšem navíc posuneme
oba sprity (hráče i NPC) na výchozí pozice (jinak by se tento blok ihned
zavolal podruhé atd.):</p>

<a href="https://www.root.cz/obrazek/1102970/"><img src="https://i.iinfo.cz/images/634/makecodec-9-prev.png" class="image-1102970" width="370" height="137" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-9-prev.png" data-prev-width="370" data-prev-height="137" data-large-filename="https://i.iinfo.cz/images/634/makecodec-9-large.png" data-large-width="720" data-large-height="267" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 28: Po kolizi spritů se nejenom sníží počet životů, ale sprity se
posunou do výchozí pozice.</i></p>

<p>Ve třetím kroku přidáme <i>handler</i> další události, tentokrát události
typu &bdquo;dosaženo 0 životů&ldquo;. Zde je situace jednoduchá &ndash; hra
končí prohrou hráče:</p>

<a href="https://www.root.cz/obrazek/1102971/"><img src="https://i.iinfo.cz/images/634/makecodec-10.png" class="image-1102971" width="322" height="217" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-10.png" data-prev-width="322" data-prev-height="217" data-large-filename="https://i.iinfo.cz/images/634/makecodec-10.png" data-large-width="322" data-large-height="217" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 29: Blok, v&nbsp;němž lze reagovat na událost vzniklou ve chvíli,
kdy se dosáhne nulového počtu životů.</i></p>

<p>Samotné počitadlo životů se zobrazuje jako série srdíček v&nbsp;levém horním
rohu obrazovky emulátoru herní konzole:</p>

<a href="https://www.root.cz/obrazek/1102972/"><img src="https://i.iinfo.cz/images/634/makecodec-11-prev.png" class="image-1102972" width="225" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-11-prev.png" data-prev-width="225" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-11-large.png" data-large-width="437" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 30: Počitadlo životů je zobrazené v&nbsp;levém horním
rohu.</i></p>

<p>A konečně ještě do hry přidáme počitadlo skóre. Skóre se bude zvyšovat
postupně každých 100ms, což znamená, že skóre bude tím vyšší, čím déle se hráč
dokáže vyhnout NPC (což není příliš zajímavá hra, uznávám). Z&nbsp;tohoto
důvodu do kódu hry přidáme ještě jeden speciální blok, tentokrát se jedná o
handler události typu &bdquo;uběhlo dalších 100ms&ldquo;. Zde budeme skóre
zvyšovat:</p>

<a href="https://www.root.cz/obrazek/1102973/"><img src="https://i.iinfo.cz/images/634/makecodec-12-prev.png" class="image-1102973" width="370" height="105" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-12-prev.png" data-prev-width="370" data-prev-height="105" data-large-filename="https://i.iinfo.cz/images/634/makecodec-12-large.png" data-large-width="720" data-large-height="205" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 31: Další speciální blok, který je spuštěný každých 100ms.</i></p>

<p>Po spuštění hry v&nbsp;emulátoru herní konzole se skóre bude zobrazovat
v&nbsp;pravém horním rohu:</p>

<a href="https://www.root.cz/obrazek/1102974/"><img src="https://i.iinfo.cz/images/634/makecodec-13-prev.png" class="image-1102974" width="231" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-13-prev.png" data-prev-width="231" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-13-large.png" data-large-width="448" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 32: Skóre je zobrazeno v&nbsp;pravém horním rohu.</i></p>



<p><a name="k12"></a></p>
<h2 id="k12">12. Závěrečné zhodnocení</h2>

<p>Hra, kterou jsme v&nbsp;rámci předchozích kapitol vytvořili, stále nepoužívá
žádné podmínky ani programové smyčky. Zato uživatele naučila konceptu událostí
a reakcí na ně, tj.&nbsp;pravý opak, než klasické kurzy výuky programování.
Jedná se tedy o rozšíření možností projektu Scratch, s&nbsp;nímž jsme se
seznámili v&nbsp;úvodní dvojici článků.</p>

<p>Hra představená v&nbsp;rámci předchozích kapitol by například při použití
knihovy <i>PyGame</i> či <a
href="https://www.root.cz/clanky/prvni-miniaplikace-vytvorene-v-nastroji-pygame-zero/">PyGame
Zero</a> nebo <a
href="https://www.root.cz/clanky/lua-love-vytvorte-si-vlastni-hru/">LÖVE</a>
měla přibližně 60-80 řádků. Při použití nízkoúrovňovější knihovny typu
<i>SDL</i> je nutné počítat spíše se stovkami řádků. V&nbsp;MakeCode Arcade se
přitom vše vejde na jedinou obrazovku:</p>

<a href="https://www.root.cz/obrazek/1102975/"><img src="https://i.iinfo.cz/images/634/makecodec-14-prev.png" class="image-1102975" width="252" height="270" data-prev-filename="https://i.iinfo.cz/images/634/makecodec-14-prev.png" data-prev-width="252" data-prev-height="270" data-large-filename="https://i.iinfo.cz/images/634/makecodec-14-large.png" data-large-width="491" data-large-height="525" alt="&#160;" title="Autor: tisnik, podle licence: &lt;a href=&quot;http://en.wikipedia.org/wiki/Rights_Managed&quot;&gt;Rights Managed&lt;/a&gt;" /></a>
<p><i>Obrázek 33: Takto vypadá kód výsledné hry v&nbsp;&bdquo;blokové&ldquo; podobě.</i></p>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2023</small></p>
</body>
</html>


