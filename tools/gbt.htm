<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Nástroj Go Bullet Train (GBT)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Nástroj Go Bullet Train (GBT)</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>S novým rokem začíná na Rootu vycházet i nový seriál, v němž se postupně seznámíme s&nbsp;různými nástroji, s&nbsp;jejichž využitím je možné vylepšit klasickou příkazovou řádku o novou funkcionalitu. První z&nbsp;těchto nástrojů se jmenuje Go Bullet Train, zkráceně GBT.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Nástroj Go Bullet Train (GBT)</a></p>
<p><a href="#k02">2. Moderní shelly a proměnné prostředí <strong>PS1</strong> až <strong>PS4</strong></a></p>
<p><a href="#k03">3. Základní funkce nástroje GBT</a></p>
<p><a href="#k04">4. Instalace fontu DejaVu Sans Mono Nerd</a></p>
<p><a href="#k05">5. Konfigurace terminálu</a></p>
<p><a href="#k06">6. Instalace nástroje GBT</a></p>
<p><a href="#k07">7. Konfigurace nástroje GBT</a></p>
<p><a href="#k08">8. Délka cesty k&nbsp;aktuálnímu adresáři</a></p>
<p><a href="#k09">9. Specifikace, které informace se mají zobrazit</a></p>
<p><a href="#k10">10. Barva popředí a pozadí jednotlivých &bdquo;vagonů&ldquo;</a></p>
<p><a href="#k11">11. Volba ikony představující aktuálně používanou distribuci nebo prostředí</a></p>
<p><a href="#k12">12. Vagony používané v&nbsp;naklonovaném GIT repositáři</a></p>
<p><a href="#k13">13. Ikona s&nbsp;informací o skrytých změnách (stash)</a></p>
<p><a href="#k14">14. Informace o virtuálním prostředí Pythonu</a></p>
<p><a href="#k15">15. Vagon &bdquo;custom&ldquo;</a></p>
<p><a href="#k16">16. Obsah následující části seriálu</a></p>
<p><a href="#k17">17. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Nástroj Go Bullet Train (GBT)</h2>

<p>K&nbsp;unixovým systémům, mezi které patří <a
href="https://www.levenez.com/unix/">i Linux</a>, neodmyslitelně patří i
příkazová řádka zajišťující vstup uživatelem zapisovaných příkazů určených pro
<a href="https://en.wikipedia.org/wiki/Shell_(computing)">shell</a>. Vlastnosti
příkazové řádky v&nbsp;prvních interpretrech byly z&nbsp;dnešního pohledu dosti
omezené, což platí zejména pro původní <a
href="https://en.wikipedia.org/wiki/Bourne_shell">Bourne shell</a>, ovšem
postupně došlo k&nbsp;vylepšování jejich možností. Například v&nbsp;<a
href="http://www.kornshell.org/">Korn shellu</a> se objevila možnost editace
příkazové řádky, a to buď v&nbsp;režimu Emacsu či Vimu (což je vlastnost, která
je podporovaná dodnes), v&nbsp;<a
href="https://en.wikipedia.org/wiki/C_shell">C shellu</a> historie příkazů,
podpora aliasů atd. Pravděpodobně nejvíce možností v&nbsp;současnosti nabízí <a
href="http://fishshell.com/">FISH</a>, kterým se později budeme v&nbsp;tomto
seriálu zabývat. Existuje taktéž poměrně velké množství nástrojů, které dokáží
vylepšit vlastnosti příkazové řádky v&nbsp;dnes běžných shellech (BASH, DASH,
ZSH atd.). Jedním z&nbsp;těchto užitečných nástrojů je i <i>Go Bullet Train</i>
neboli zkráceně <i>GBT</i>, jemuž je věnován dnešní článek.</p>

<p><div class="rs-tip-major">Poznámka: nástroj <i>Go Bullet Train</i> je, jak
již ostatně jeho název napovídá, sice naprogramovaný <a
href="https://www.root.cz/serialy/programovaci-jazyk-go/">v&nbsp;jazyce Go</a>,
to ovšem v&nbsp;žádném případě neznamená, že se v&nbsp;tomto seriálu budeme
zabývat pouze utilitami vyvinutými v&nbsp;tomto jazyce. Například již příště se
seznámíme s&nbsp;nástrojem nazvaným <a
href="https://github.com/sharkdp/bat">bat</a>, jenž je pro změnu vytvořen <a
href="https://www.root.cz/serialy/programovaci-jazyk-rust/">v&nbsp;Rustu</a>
(který v&nbsp;určitých směrech, ovšem zdaleka ne ve všech, Go
konkuruje).</div></p>

<a href="https://www.root.cz/obrazek/400685/"><img src="https://i.iinfo.cz/images/129/gbt-1-prev.png" class="image-400685" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 1: Nástroj Go Bullet Train dokáže detekovat aktuálně používanou
distribuci a při korektním nastavení zobrazit její logo. Zde je ukázáno, že se
logo změní při nalogování na počítač s&nbsp;odlišnou distribucí, zde konkrétně
z&nbsp;distribuce založené na Ubuntu (Linux Mint) na Fedoru. Tato funkcionalita
však vyžaduje instalaci speciálního fontu.</i></p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Moderní shelly a proměnné prostředí <strong>PS1</strong> až <strong>PS4</strong></h2>

<p>Nástroj <i>Go Bullet Train</i> dokáže změnit informace zobrazované
v&nbsp;rámci takzvané &bdquo;výzvy&ldquo; (<i>prompt</i>).
V&nbsp;&bdquo;klasických&ldquo; shellech se obsah výzvy nastavuje
s&nbsp;využitím proměnné prostředí <strong>PS1</strong>, popř.&nbsp;dalších
proměnných <strong>PS2</strong> až <strong>PS4</strong> použitých ve
specifických případech (<strong>PS2</strong> pro víceřádkové příkazy,
<strong>PS3</strong> při čekání na vstup uživatele v&nbsp;interaktivních
skriptech, <strong>PS4</strong> v&nbsp;ladicím režimu). Tyto proměnné prostředí
mohou obsahovat jak běžný text (typicky znak $), tak i speciální znaky
začínající zpětným lomítkem. Tyto znaky jsou při konstrukci zprávy
představující výzvu nahrazeny jinou hodnotou zjištěnou z&nbsp;prostředí,
v&nbsp;rámci něhož je shell spuštěn. Například znak \u je nahrazen jménem
uživatele, znak \w je expandován na právě používaný adresář (<i>current working
directory</i>), znak \A je expandován na čas atd. Navíc je možné používat i
různé řídicí znaky, které mohou modifikovat barvu textu, barvu pozadí, styl
textu (podtržení, tučné písmo/vysvícení atd.). Tyto znaky lze zapisovat přímo
nebo je možné využít výstup z&nbsp;příkazu <strong>tput</strong>. Jedná se o
velmi užitečnou funkcionalitu a dokonce existuje i interaktivní nástroj, kterým
je možné proměnnou prostředí <strong>PS1</strong> až <strong>PS4</strong>
nastavit &ndash; viz též <a
href="https://www.kirsle.net/wizards/ps1.html">https://www.kirsle.net/wizards/ps1.html</a>.</p>

<a href="https://www.root.cz/obrazek/400703/"><img src="https://i.iinfo.cz/images/419/bash-prompt-1-prev.png" class="image-400703" alt="&#160;" width="359" height="270" /></a>
<p><i>Obrázek 2: Vytvoření obsahu proměnné <strong>PS1</strong>
v&nbsp;interaktivním editoru dostupném na adrese <a
href="https://www.kirsle.net/wizards/ps1.html">https://www.kirsle.net/wizards/ps1.html</a>.</i></p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Základní funkce nástroje GBT</h2>

<p>Základní funkcí nástroje <i>Go Bullet Train</i> je modifikace výzvy
(<i>prompt</i>), ovšem poněkud odlišným způsobem, než přímou ruční editací
obsahu proměnné prostředí <strong>PS1</strong>. Práce s&nbsp;proměnnou
prostředí <strong>PS1</strong> je totiž relativně složitá, a to mj.&nbsp;i
z&nbsp;toho důvodu, že se do jediného řetězce musí zapisovat vzájemně
nesouvisející údaje, pro některé složitější operace se volají funkce
naprogramované například přímo v&nbsp;shellu, znaky pro expanzi se kombinují
s&nbsp;běžnými znaky i znaky řídicími (terminálové sekvence) atd. Naproti tomu
při použití GBT je samotná výzva rozdělena do několika částí, které se
nastavují automaticky (jednotlivé části výzvy se za sebou skutečně vizuálně
napojují jako vagony v&nbsp;rychlovlacích). Navíc GBT podporuje zobrazování
ikon (to ovšem vyžaduje použití speciálně upraveného fontu), relativně snadnou
změnu barev popředí i pozadí textu, dobrou kooperaci s&nbsp;gitem (zjišťování
stavu lokálně naklonovaného repositáře), stejnou výzvu lze použít i na
vzdálených strojích (přes SSH) atd. A nesmíme zapomenout ani na to, že díky
tomu, že nástroj GBT je vyvinut v&nbsp;programovacím jazyce Go, je jeho
instalace snadná až triviální (jedná se o jediný spustitelný soubor).</p>

<p><div class="rs-tip-major">Poznámka: nástrojů, které umožňují modifikovat
obsah výzvy, existuje poměrně velké množství. Zmiňme například projekty <a
href="https://github.com/magicmonty/bash-git-prompt">bash-git-prompt</a>,
popř.&nbsp;na Rootu již zmíněný <a
href="https://www.root.cz/zpravicky/minimalisticka-a-rychla-prikazova-radka-pro-libovolny-shell-starship/">projekt
Starship</a>. Go Bullet Train nabízí ovšem větší možnosti
konfigurace.</div></p>

<a href="https://www.root.cz/obrazek/400687/"><img src="https://i.iinfo.cz/images/129/gbt-3-prev.png" class="image-400687" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 3: Uživatel je nalogován jako Root do operačního systému
RHEL.</i></p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Instalace fontu DejaVu Sans Mono Nerd</h2>

<p>Jak jsme si již řekli <a href="#k03">v&nbsp;předchozí kapitole</a>, umožňuje
<i>Go Bullet Train</i> zobrazení některých informací (stav repositáře, aktuálně
používaná distribuce, výsledek posledního spuštěného příkazu) ve formě ikon.
Ovšem tyto ikony je nutné nějakým způsobem zobrazit v&nbsp;&bdquo;pouhém&ldquo;
textovém terminálu. Jak toho dosáhnout? Prakticky všechny moderní terminály
podporují použití <a
href="https://en.wikipedia.org/wiki/Unicode_font#List_of_Unicode_fonts">Unicode
fontů</a>, v&nbsp;nichž je na určitých místech umístěna příslušná ikona. Tu
nakonec stačí pouze obarvit (volba barvy popředí popř.&nbsp;pozadí)
s&nbsp;využitím terminálových sekvencí. GBT používá ikony, které nalezneme ve
fontu <i>DejaVu Sans Mono Nerd</i>, který je nutné nainstalovat, což je velmi
ve skutečnosti snadné a nebudeme k&nbsp;tomu potřebovat ani práva roota.</p>

<p>Nejdříve je nutné vytvořit adresář <strong>.fonts</strong> umístěný
v&nbsp;domácím adresáři (pokud tento adresář existuje, ponecháme jeho obsah
nezměněný):</p>

<pre>
$ <strong>mkdir -p ~/.fonts</strong>
</pre>

<p>Následně stáhneme příslušný font (DejaVu Sans Mono Nerd) ve formátu TrueType
a uložíme ho do adresáře <strong>.fonts</strong> v&nbsp;domácím adresáři:</p>

<pre>
$ <strong>curl -L -o ~/.fonts/DejaVuSansMonoNerdFontCompleteMono.ttf https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/DejaVuSansMono/Regular/complete/DejaVu%20Sans%20Mono%20Nerd%20Font%20Complete%20Mono.ttf</strong>
</pre>

<p><div class="rs-tip-major">Poznámka: tato operace může trvat poměrně dlouho,
i když samotný soubor s&nbsp;fontem má velikost, která jen nepatrně přesahuje
jeden megabajt.</div></p>

<p>Poslední krok spočívá v&nbsp;novém vytvoření souborů s&nbsp;informacemi o
fontech, které mohou aplikace použít. Pro tento účel postačuje spustit příkaz
<strong>fc-cache</strong> (bez dalších parametrů):</p>

<pre>
$ <strong>fc-cache</strong>
</pre>

<p><div class="rs-tip-major">Poznámka: tento nástroj by měl vytvořit
popř.&nbsp;modifikovat soubory, které na většině linuxových distribucí
naleznete v&nbsp;adresáři <strong>~/cache/fontconfig</strong>.</div></p>

<p>Aktuálně dostupné fonty je možné vypsat nástrojem <strong>fc-list</strong>.
Například všechny fonty, v&nbsp;jejichž názvu se vyskytuje slovo
&bdquo;Nerd&ldquo; vypíšeme následujícím způsobem:</p>

<pre>
$ <strong>fc-list | grep Nerd</strong>
&nbsp;
/home/tester/.fonts/DejaVuSansMonoNerdFontCompleteMono.ttf: DejaVuSansMono Nerd Font Mono:style=Book
</pre>

<p>Jen pro zajímavost si můžeme vypsat podrobnější informace o právě
nainstalovaném fontu:</p>

<pre>
$ <strong>fc-query /home/tester/.fonts/DejaVuSansMonoNerdFontCompleteMono.ttf</strong>
&nbsp;
Pattern has 23 elts (size 32)
        family: "DejaVuSansMono Nerd Font Mono"(s)
        familylang: "en"(s)
        style: "Book"(s)
        stylelang: "en"(s)
        fullname: "DejaVu Sans Mono Nerd Font Complete Mono"(s)
        fullnamelang: "en"(s)
        slant: 0(i)(s)
        weight: 80(i)(s)
        width: 100(i)(s)
        spacing: 100(i)(s)
        foundry: "unknown"(s)
        file: "/home/tester/.fonts/DejaVuSansMonoNerdFontCompleteMono.ttf"(s)
        index: 0(i)(s)
        outline: True(s)
        scalable: True(s)
        ...
        ...
        ...
        lang: aa|af|ar|ast|av|ay|az-az|az-ir|bm|be|bg|bi|bin|br|bs|bua|ca|ce|ch|chm|co|cs|cv|cy|da|de|el|en|eo|es|et|eu|fa|fi|fj|fo|fr|ff|fur|fy|ga|gd|gl|gn|gv|ha|haw|ho|hr|hu|hy|ia|ig|id|ie|ik|io|is|it|ka|kaa|ki|kk|kl|ku-am|kum|kv|kw|ky|la|lb|lez|ln|lt|lv|mg|mh|mi|mk|mo|mt|nb|nds|nl|nn|no|nr|nso|ny|oc|om|os|pl|pt|rm|ro|ru|sah|sco|se|sel|shs|sk|sl|sm|sma|smj|smn|so|sq|sr|ss|st|sv|sw|tk|tl|tn|to|tr|ts|tt|tw|tyv|uk|uz|ve|vo|vot|wa|wen|wo|xh|yap|yo|zu|ak|an|ber-dz|crh|csb|ee|fat|fil|hsb|ht|hz|jv|kab|kj|kr|ku-tr|kwm|lg|li|mn-mn|ms|na|ng|nv|pap-an|pap-aw|qu|quz|rn|rw|sc|sg|sn|su|ty|za(s)
        fontversion: 155320(i)(s)
        capability: "otlayout:DFLT otlayout:arab otlayout:cyrl otlayout:grek otlayout:lao  otlayout:latn"(s)
        fontformat: "TrueType"(s)
        decorative: False(s)
        hash: "sha256:3d7584de56eebaed3262ec71670083aeb9fcb8ce0c8b6c3e2487f2aeb54660c7"(s)
        postscriptname: "DejaVuSansMonoNerdFontCompleteM-Book"(s)
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Konfigurace terminálu</h2>

<p>V&nbsp;dalším kroku je nutné nakonfigurovat terminál. Budeme potřebovat
nastavit minimálně dvě základní vlastnosti:</p>

<ol>

<li>Použitý font by měl být &bdquo;DejaVuSansMono Nerd Font Mono&ldquo;
nainstalovaný v&nbsp;rámci <a href="#k04">předchozí kapitoly</a></li>

<li>Barva pozadí by měla být tmavá (většina nastavení GBT totiž na světlém
pozadí špatně pracuje)</li>

</ol>

<p>U terminálů (přesněji řečeno emulátorů terminálu), které jsou vybaveny
grafickým uživatelským rozhraním s&nbsp;menu se toto nastavení provede přímo
z&nbsp;tohoto menu, typicky výběrem položky <i>Settings</i>. Poněkud složitější
je situace v&nbsp;případě použití terminálů <i>urxvt</i> a <i>xterm</i>.
Podívejme se na nastavení <i>xtermu</i>, které lze provést i bez toho, abychom
zasahovali do databáze <strong>xrdb</strong> (<i>X server resource
database</i>):</p>

<pre>
$ <strong>xterm -bg black -fg white -en en_US.UTF-8 -u8 -fa "DejaVuSansMono Nerd Font Mono" -fs 20</strong>
</pre>

<p>Výše uvedený příkaz používá přepínač <strong>-bg</strong> pro nastavení
barvy pozadí, <strong>-fg</strong> pro nastavení barvy popředí,
<strong>-fa</strong> pro volbu fontu (nikoli bitmapového), <strong>-fs</strong>
pro změnu velikosti písma a nakonec <strong>-u8</strong> a <strong>-en</strong>
pro povolení Unicode.</p>

<p><div class="rs-tip-major">Poznámka: screenshoty k&nbsp;tomuto článku byly
pořízeny právě z&nbsp;<i>xtermu</i>.</div></p>

<a href="https://www.root.cz/obrazek/400688/"><img src="https://i.iinfo.cz/images/129/gbt-4-prev.png" class="image-400688" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 4: V&nbsp;případě, že je návratová hodnota posledního příkazu
odlišná od nuly, je ve výchozím nastavení GBT tato skutečnost naznačena
červeným křížkem na začátku výzvy.</i></p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Instalace nástroje GBT</h2>

<p>Instalaci nástroje <i>Go Bullet Train</i> je možné provést několika způsoby.
Využít je možné balíčky dostupné na adrese <a
href="https://packagecloud.io/gbt/release">https://packagecloud.io/gbt/release</a>,
které jsou nabízeny ve formátech .deb i .rpm pro různé architektury.
Alternativně je možné nástroj GBT přeložit, k&nbsp;čemuž je pouze zapotřebí mít
nainstalovány <a
href="https://www.root.cz/clanky/go-minimalisticky-a-prekvapive-vykonny-programovaci-jazyk/#k04">základní
nástroje programovacího jazyka Go</a> a nastaveny proměnné prostředí
<strong>GOPATH</strong> a <strong>PATH</strong> (jinak nebude GBT
instalovatelný a spustitelný):</p>

<pre>
$ <strong>export GOPATH=~/go</strong>
$ <strong>export PATH="$PATH:$GOPATH/bin"</strong>
</pre>

<p>Samotnou instalaci GBT zajistí příkaz <strong>go get</strong>, který stáhne
potřebné knihovny a následně provede překlad a slinkování výsledné utility:</p>

<pre>
$ <strong>go get github.com/jtyr/gbt/cmd/gbt</strong>
</pre>

<p>Výsledkem předchozího příkazu by měl být spustitelný soubor se jménem
&bdquo;gbt&ldquo; umístěný v&nbsp;adresáři &bdquo;~/go/bin&ldquo;:</p>

<pre>
$ <strong>ls -l $GOPATH/bin</strong>
&nbsp;
total 14184
-rwxr-xr-x 1 tester tester  3002684 lis 29 19:02 gbt
-rwxr-xr-x 1 tester tester 11515559 lis 10 21:56 gocode
</pre>

<p><div class="rs-tip-major">Poznámka: povšimněte si, že velikost souboru
&bdquo;gbt&ldquo; je relativně malá (přibližně 3MB), zvláště když si uvědomíme,
že překladač a linker jazyka Go provádí ve standardním nastavení statické
slinkování.</div></p>

<p>Následně je nutné určit, že obsah proměnné <strong>PS1</strong> bude určen
právě příkazem GBT, což je již triviální operace:</p>

<pre>
$ <strong>PS1='$(gbt $?)'</strong>
</pre>

<p>V&nbsp;případě ZSH se nastavuje proměnná prostředí <strong>PROMPT</strong> a
nikoli <strong>PS1</strong>:</p>

<pre>
$ <strong>PROMPT='$(gbt $?)'</strong>
</pre>

<p>V&nbsp;případě, že používáte ZSH, je možné nastavit i &bdquo;pravou&ldquo;
výzvu, což je měnitelný text zobrazený na pravém okraji příkazového řádku:</p>

<pre>
$ <strong>RPROMPT='$(gbt -right)'</strong>
</pre>

<p>Ihned po spuštění by se měl změnit formát výzvy (promptu) v&nbsp;aktuálně
spuštěném emulátoru terminálu.</p>

<a href="https://www.root.cz/obrazek/400689/"><img src="https://i.iinfo.cz/images/129/gbt-5-prev.png" class="image-400689" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 5: Nastavení tří &bdquo;vagónů&ldquo;, z&nbsp;nichž se skládá
konfigurace výzvy (prompt).</i></p>



<p><a name="k07"></a></p>
<h2 id="k07">7. Konfigurace nástroje GBT</h2>

<p>Konfigurace nástroje <i>Go Bullet Train</i> se provádí s&nbsp;využitím
proměnných prostředí. Ty lze nastavovat interaktivně (změny jsou ihned
zapracovány a modifikují chování GBT), nebo je možné nastavení provést
například v&nbsp;souborech <strong>.profile</strong>, <strong>.bashrc</strong>
atd.</p>

<a href="https://www.root.cz/obrazek/400690/"><img src="https://i.iinfo.cz/images/129/gbt-6-prev.png" class="image-400690" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 6: Ukázka situace, kdy je cesta k&nbsp;aktuálnímu adresáři
poměrně dlouhá.</i></p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Délka cesty k&nbsp;aktuálnímu adresáři</h2>

<p>První nastavení se týká cesty k&nbsp;aktuálnímu adresáři. V&nbsp;některých
případech (domácí adresář, kořenový adresář) je tato cesta velmi krátká, ovšem
mnohdy se pohybujeme v&nbsp;tak košaté struktuře, že cesta k&nbsp;aktuálnímu
adresáři může překračovat šířku terminálu. K&nbsp;omezení počtu zobrazených
podadresářů slouží proměnná prostředí <strong>GBT_CAR_DIR_DEPTH</strong>. Pokud
je hodnotou této proměnné například řetězec &bdquo;3&ldquo;, budou zobrazeny
jen poslední tři podadresáře cesty:</p>

<pre>
$ <strong>export GBT_CAR_DIR_DEPTH='3'</strong>
</pre>

<p>nebo jen:</p>

<pre>
$ <strong>export GBT_CAR_DIR_DEPTH=3</strong>
</pre>

<p>Ve chvíli, kdy naopak použijeme například řetězec &bdquo;999&ldquo;, je
délka zobrazené cesty <i>prakticky</i> neomezená:</p>

<pre>
$ <strong>export GBT_CAR_DIR_DEPTH=999</strong>
</pre>

<p><div class="rs-tip-major">Poznámka: všechny proměnné prostředí obsahují vždy
jen řetězce, které je ovšem v&nbsp;některých případech možné interpretovat jako
čísla, data, seznamy atd.</div></p>



<p><a name="k09"></a></p>
<h2 id="k09">9. Specifikace, které informace se mají zobrazit</h2>

<p>Název projektu <i>Go Bullet Train</i> vychází z&nbsp;toho, že se zprávy,
z&nbsp;nichž je skládána výzva (<i>prompt</i>) vytváří z&nbsp;jednotlivých
&bdquo;vagonů&ldquo;, které jsou nezávisle na sobě konfigurovatelné a
spojitelné do jediného &bdquo;vlaku&ldquo;. A právě k&nbsp;určení, které
&bdquo;vagony&ldquo; a v&nbsp;jakém pořadí se mají ve výzvě použít, slouží
proměnná prostředí nazvaná <strong>GBT_CARS</strong>. Do této proměnné se
zapisuje řetězec se seznamem názvů jednotlivých vagonů, například:</p>

<pre>
$ <strong>GBT_CARS='Status, Os, Time, Hostname, Dir, Git, Sign'</strong>
</pre>

<p>K&nbsp;dispozici je několik typů &bdquo;vagonů&ldquo;:</p>

<table>
<tr><th>#</th><th>Jméno vagonu</th><th>Předpona proměnných prostředí</th></tr>
<tr><td> 1</td><td>Custom car</td><td>GBT_CAR_CUSTOM_</td></tr>
<tr><td> 2</td><td>Dir car</td><td>GBT_CAR_DIR_</td></tr>
<tr><td> 3</td><td>ExecTime car</td><td>GBT_CAR_EXECTIME_</td></tr>
<tr><td> 4</td><td>Git car</td><td>GBT_CAR_GIT_</td></tr>
<tr><td> 5</td><td>Hostname car</td><td>GBT_CAR_HOSTNAME_</td></tr>
<tr><td> 6</td><td>Kubectl car</td><td>GBT_CAR_KUBECTL_</td></tr>
<tr><td> 7</td><td>Os car</td><td>GBT_CAR_OS_</td></tr>
<tr><td> 8</td><td>PyVirtEnv car</td><td>GBT_CAR_PYVIRTENV_</td></tr>
<tr><td> 9</td><td>Sign car</td><td>GBT_CAR_SIGN_</td></tr>
<tr><td>10</td><td>Status car</td><td>GBT_CAR_STATUS_</td></tr>
<tr><td>11</td><td>Time car</td><td>GBT_CAR_TIME_</td></tr>
</table>

<p>S&nbsp;vybranými vagony se seznámíme v&nbsp;navazujících kapitolách.</p>

<a href="https://www.root.cz/obrazek/400691/"><img src="https://i.iinfo.cz/images/129/gbt-7-prev.png" class="image-400691" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 7: Nastavení, které informace se mají ve výzvě zobrazit.</i></p>



<p><a name="k10"></a></p>
<h2 id="k10">10. Barva popředí a pozadí jednotlivých &bdquo;vagonů&ldquo;</h2>

<p>U jednotlivých vagonů lze zvolit jejich barvu popředí a pozadí. K&nbsp;tomu
slouží proměnné prostředí začínající předponou vypsanou v&nbsp;tabulce
v&nbsp;předchozí kapitole a končící na <strong>_BG</strong> (barva pozadí,
<i>background</i>) či <strong>_FG</strong> (barva popředí, <i>foreground</i>).
Dále je možné proměnnou prostředí končící na <strong>_FM</strong> určit styl
písma (tučné atd.). Podívejme se na příklad, v&nbsp;němž nastavíme pozadí
vagonu zobrazujícího stav posledního provedeného příkazu (návratový kód je
roven nule či odlišný od nuly):</p>

<pre>
$ <strong>export GBT_CAR_STATUS_DISPLAY=1</strong>
$ <strong>export GBT_CAR_STATUS_OK_BG=green</strong>
$ <strong>export GBT_CAR_STATUS_ERROR_BG=green</strong>
</pre>

<a href="https://www.root.cz/obrazek/400692/"><img src="https://i.iinfo.cz/images/129/gbt-8-prev.png" class="image-400692" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 8: Změna barvy popředí a pozadí vybraných &bdquo;vagonů&ldquo;</i></p>

<p>Pro popředí popř.&nbsp;pozadí lze zvolit následující barvy:</p>

<table>
<tr><th> #</th><th>Barva</th></tr>
<tr><td> 1</td><td>black</td></tr>
<tr><td> 2</td><td>red</td></tr>
<tr><td> 3</td><td>green</td></tr>
<tr><td> 4</td><td>yellow</td></tr>
<tr><td> 5</td><td>blue</td></tr>
<tr><td> 6</td><td>magenta</td></tr>
<tr><td> 7</td><td>cyan</td></tr>
<tr><td> 8</td><td>light_gray</td></tr>
<tr><td> 9</td><td>dark_gray</td></tr>
<tr><td>10</td><td>light_red</td></tr>
<tr><td>11</td><td>light_green</td></tr>
<tr><td>12</td><td>light_yellow</td></tr>
<tr><td>13</td><td>light_blue</td></tr>
<tr><td>14</td><td>light_magenta</td></tr>
<tr><td>15</td><td>light_cyan</td></tr>
<tr><td>16</td><td>white white</td></tr>
</table>

<p><div class="rs-tip-major">Poznámka: ve skutečnosti se jedná o názvy
<i>logických barev</i>, přičemž jejich mapování na <i>fyzické barvy</i> je
možné provést v&nbsp;nastavení terminálu. Pokud například specifikujeme, že se
má logická barva &bdquo;red&ldquo; mapovat na fyzickou barvu &bdquo;světle
žlutá&ldquo;, nemá nástroj GBT žádné prostředky, jak toho nastavení
změnit.</div></p>



<p><a name="k11"></a></p>
<h2 id="k11">11. Volba ikony představující aktuálně používanou distribuci nebo prostředí</h2>

<p>V&nbsp;případě, že je nainstalován font &bdquo;DejaVu Sans Mono Nerd&ldquo;,
je možné proměnnou prostředí <strong>GBT_CAR_OS_NAME</strong> zvolit, jaká
ikona distribuce popř.&nbsp;prostředí se má zobrazit ve vagonu
&bdquo;Os&ldquo;. Některé příklady jsou ukázány na následujícím
screenshotu:</p>

<a href="https://www.root.cz/obrazek/400693/"><img src="https://i.iinfo.cz/images/129/gbt-9-prev.png" class="image-400693" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 9: Volba ikony představující aktuálně používanou distribuci nebo prostředí.</i></p>

<p><div class="rs-tip-major">Poznámka: pokud tuto proměnnou prostředí nebudete
měnit, použije se ikona odpovídající detekované distribuci.</div></p>

<p>Ikony, které je možné použít (sami můžete vidět, že ne vždy se jedná pouze o
názvy distribucí Linuxu):</p>

<table>
<tr><td>amzn   </td><td>cloud </td><td>elementary</td><td>linuxmint</td><td>redhat   </td></tr>
<tr><td>android</td><td>coreos</td><td>fedora    </td><td>mageia   </td><td>sabayon  </td></tr>
<tr><td>arch   </td><td>darwin</td><td>freebsd   </td><td>mandriva </td><td>slackware</td></tr>
<tr><td>archarm</td><td>debian</td><td>gentoo    </td><td>opensuse </td><td>ubuntu   </td></tr>
<tr><td>centos </td><td>docker</td><td>linux     </td><td>raspbian </td><td>windows  </td></tr>
</table>



<p><a name="k12"></a></p>
<h2 id="k12">12. Vagony používané v&nbsp;naklonovaném GIT repositáři</h2>

<p>Ve chvíli, kdy aktuální adresář leží v&nbsp;naklonovaném GIT repositáři, je
možné zobrazit informace o aktuálním stavu tohoto repositáře,
tj.&nbsp;například používanou větev, stav větve (počet souborů, které je možné
zařadit do změn) atd. K&nbsp;tomuto účelu slouží vagon &bdquo;git&ldquo;
konfigurovatelný s&nbsp;využitím proměnných prostředí, které všechny &ndash;
podle očekávání &ndash; začínají na <strong>GBT_CAR_GIT_</strong>. Kromě již
popsaných proměnných určujících barvu popředí, barvu pozadí a typ písma je
důležitá především proměnná <strong>GBT_CAR_GIT_FORMAT</strong> určující, jaké
informace a v&nbsp;jakém formátu se vlastně mají zobrazit.</p>

<p>Zobrazení ikony s&nbsp;informací, že se jedná o GIT repositář:</p>

<pre>
$ <strong>GBT_CAR_GIT_FORMAT='{{ Icon }}'</strong>
</pre>

<p>Přidání jména větve, tagu, commitu:</p>

<pre>
$ <strong>GBT_CAR_GIT_FORMAT='{{ Icon }} {{ Head }}'</strong>
</pre>

<p>Přidání ikony informující o stavu repositáře (synchronizován atd.):</p>

<pre>
$ <strong>GBT_CAR_GIT_FORMAT=' {{ Icon }} {{ Head }} {{ Status }}'</strong>
</pre>

<p>Další ikony popř.&nbsp;text s&nbsp;informací o tom, jaký je stav repositáře
v&nbsp;porovnání se vzdáleným repositářem (typicky <i>origin</i>):</p>

<pre>
$ <strong>GBT_CAR_GIT_FORMAT=' {{ Icon }} {{ Head }} {{ Status }} {{ Ahead }} {{ Behind }} '</strong>
</pre>

<p>Mezery ve specifikaci formátu mají význam, takže pokud šetříte místem, lze
napsat:</p>

<pre>
$ <strong>GBT_CAR_GIT_FORMAT='{{ Icon }}{{ Head }}{{ Status }}{{ Ahead }}{{ Behind }} '</strong>
</pre>

<a href="https://www.root.cz/obrazek/400694/"><img src="https://i.iinfo.cz/images/129/gbt-10-prev.png" class="image-400694" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 10: Nastavení barvy pozadí vagonu s&nbsp;informacemi o GIT
repositáři.</i></p>

<a href="https://www.root.cz/obrazek/400695/"><img src="https://i.iinfo.cz/images/129/gbt-11-prev.png" class="image-400695" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 11: Vytvoření nové větve s&nbsp;přepnutím do této větve. Následně
se do repositáře zařadí nový soubor.</i></p>

<a href="https://www.root.cz/obrazek/400696/"><img src="https://i.iinfo.cz/images/129/gbt-12-prev.png" class="image-400696" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 12: Smazání nepoužité větve.</i></p>



<p><a name="k13"></a></p>
<h2 id="k13">13. Ikona s&nbsp;informací o skrytých změnách (stash)</h2>

<p>Užitečná je i informace o tom, že naklonovaný repositář obsahuje změny,
které byly skryty příkazem <strong>stash</strong>. Tuto ikonu do výzvy přidáte
snadno:</p>

<pre>
$ <strong>GBT_CAR_GIT_FORMAT='{{ Icon }}{{ Head }}{{ Status }}{{ Stash }} '</strong>
</pre>

<p>Výsledek je patrný na dalším screenshotu:</p>

<a href="https://www.root.cz/obrazek/400697/"><img src="https://i.iinfo.cz/images/129/gbt-13-prev.png" class="image-400697" alt="&#160;" width="370" height="260" /></a>
<p><i>Obrázek 13: Použití ikony &bdquo;stash&ldquo; informující (pokud je zobrazena)</i></p>

<p><div class="rs-tip-major">Poznámka: o jaké skryté změny se jedná zjistíte
příkazem <strong>git stash show</strong>.</div></p>

<a href="https://www.root.cz/obrazek/400698/"><img src="https://i.iinfo.cz/images/129/gbt-14-prev.png" class="image-400698" alt="&#160;" width="370" height="232" /></a>
<p><i>Obrázek 14: Konfigurace zobrazení informací o stavu GITového repositáře,
v&nbsp;němž se nachází aktuální adresář.</i></p>



<p><a name="k14"></a></p>
<h2 id="k14">14. Informace o virtuálním prostředí Pythonu</h2>

<p>Zobrazit je možné i informace o aktivovaném virtuálním prostředí Pythonu.
Nejdříve je ovšem nutné zakázat, aby samotné virtuální prostředí Pythonu
(<strong>virtualenv</strong>) po své aktivaci příkazem
<strong>activate</strong> do výzvy přidávalo další informace. To se provede
nastavením následující proměnné prostředí:</p>

<pre>
$ <strong>export VIRTUAL_ENV_DISABLE_PROMPT='1'</strong>
</pre>

<p><div class="rs-tip-major">Poznámka: toto nastavení nebude mít vliv na
aktuálně spuštěné virtuální prostředí. To je nutno deaktivovat příkazem
<strong>deactivate</strong> a poté znovu aktivovat, aby se všechny změny
v&nbsp;konfiguraci projevily.</div></p>

<p>Následně lze nastavit formát vagonu s&nbsp;informacemi o virtuálním
prostředí:</p>

<pre>
$ <strong>export GBT_CAR_PYVIRTENV_FORMAT=' {{ Icon }} {{ Name }}</strong>
</pre>

<p>Vagon je nutné přidat do vlaku:</p>

<pre>
$ <strong>export GBT_CARS="Status, Os, Dir, PyVirtEnv"</strong>
</pre>

<p>Nyní je již možné prostředí aktivovat, což by se mělo projevit na zprávě
výzvy:</p>

<pre>
$ <strong>source bin/activate</strong>
</pre>



<p><a name="k16"></a></p>
<h2 id="k16">16. Vagon &bdquo;custom&ldquo;</h2>

<p>K&nbsp;dispozici je i vagon nazvaný jednoduše &bdquo;custom&ldquo;, který
může zobrazovat buď statický text, nebo výsledek nějakého příkazu. Povolení
použití tohoto vagonu:</p>

<pre>
$ <strong>export GBT_CARS="Custom, Status, Os, Dir, PyVirtEnv"</strong>
$ <strong>export GBT_CAR_CUSTOM_DISPLAY=1</strong>
</pre>

<p>Zobrazení statického textu:</p>

<pre>
$ <strong>export GBT_CAR_CUSTOM_TEXT_TEXT="&gt;"</strong>
</pre>

<p>Zobrazení výsledku prakticky libovolného příkazu namísto statického textu:</p>

<pre>
$ <strong>unset GBT_CAR_CUSTOM_TEXT_TEXT</strong>
</pre>

<p>Zobrazení volné kapacity paměti:</p>

<pre>
$ <strong>export GBT_CAR_CUSTOM_TEXT_CMD="cat /proc/meminfo | sed -n 2p | grep -o '[0-9]\+'"</strong>
</pre>

<p>Popř.&nbsp;přesnější příkaz, pokud se pořadí položek ve virtuálním souboru <strong>/proc/meminfo</strong> mění:</p>

<pre>
$ <strong>export GBT_CAR_CUSTOM_TEXT_CMD="cat /proc/meminfo | grep 'MemFree:' | grep -o '[0-9]\+'"</strong>
</pre>



<p><a name="k16"></a></p>
<h2 id="k16">16. Obsah následující části seriálu</h2>

<p>V&nbsp;navazující části právě vznikajícího seriálu o vylepšení vlastností
příkazové řádky si popíšeme nástroj <a
href="https://github.com/sharkdp/bat">bat</a>. Jedná se o utilitu doplňující
vlastnosti standardního nástroje <strong>cat</strong> o mnoho dalších
užitečných funkcí, zejména o zvýraznění zdrojových kódů. Tuto utilitu, která je
mimochodem naprogramovaná v&nbsp;Rustu, lze použít společně s&nbsp;dalším velmi
užitečným nástrojem <a href="https://github.com/junegunn/fzf">fzv</a>, jemuž
bude věnována celá třetí část seriálu (<i>fzv</i> neboli <i>command-line fuzzy
finder </i> navíc lze velmi dobře zkombinovat například <a
href="https://www.root.cz/n/vim/">s&nbsp;textovým editorem Vim</a>).</p>



<p><a name="k17"></a></p>
<h2 id="k17">17. Odkazy na Internetu</h2>

<ol>

<li>Go Bullet Train (GBT)<br />
<a href="https://github.com/tisnik/gbt">https://github.com/tisnik/gbt</a>
</li>

<li>bullettrain-sh<br />
<a href="https://github.com/caiogondim/bullet-train.zsh">https://github.com/caiogondim/bullet-train.zsh</a>
</li>

<li>An oh-my-zsh shell theme based on the Powerline Vim plugin<br />
<a href="https://github.com/caiogondim/bullet-train.zsh">https://github.com/caiogondim/bullet-train.zsh</a>
</li>

<li>Nerd fonts<br />
<a href="https://www.nerdfonts.com/">https://www.nerdfonts.com/</a>
</li>

<li>nerd-fonts (repositář)<br />
<a href="https://github.com/ryanoasis/nerd-fonts">https://github.com/ryanoasis/nerd-fonts</a>
</li>

<li>Repositář projektu bat<br />
<a href="https://github.com/sharkdp/bat">https://github.com/sharkdp/bat</a>
</li>

<li>bat releases<br />
<a href="https://github.com/sharkdp/bat/releases">https://github.com/sharkdp/bat/releases</a>
</li>

<li>Shell<br />
<a href="https://en.wikipedia.org/wiki/Shell_(computing)">https://en.wikipedia.org/wiki/Shell_(computing)</a>
</li>

<li>Minimalistická a rychlá příkazová řádka pro libovolný shell Starship<br />
<a href="https://www.root.cz/zpravicky/minimalisticka-a-rychla-prikazova-radka-pro-libovolny-shell-starship/">https://www.root.cz/zpravicky/minimalisticka-a-rychla-prikazova-radka-pro-libovolny-shell-starship/</a>
</li>

<li>Finally, a command line shell for the 90s<br />
<a href="http://fishshell.com/">http://fishshell.com/</a>
</li>

<li>Bourne shell<br />
<a href="https://en.wikipedia.org/wiki/Bourne_shell">https://en.wikipedia.org/wiki/Bourne_shell</a>
</li>

<li>Korn shell<br />
<a href="http://www.kornshell.org/">http://www.kornshell.org/</a>
</li>

<li>Prompt Expansion<br />
<a href="http://zsh.sourceforge.net/Doc/Release/Prompt-Expansion.html#Prompt-Expansion">http://zsh.sourceforge.net/Doc/Release/Prompt-Expansion.html#Prompt-Expansion</a>
</li>

<li>PS1 prompt explained for Linux/Unix<br />
<a href="https://www.linuxnix.com/linuxunix-shell-ps1-prompt-explained-in-detail/">https://www.linuxnix.com/linuxunix-shell-ps1-prompt-explained-in-detail/</a>
</li>

<li>Bash $PS1 Generator<u>2.0</u><br />
<a href="https://www.kirsle.net/wizards/ps1.html">https://www.kirsle.net/wizards/ps1.html</a>
</li>

<li>BASH Git Prompt<br />
<a href="https://github.com/magicmonty/bash-git-prompt">https://github.com/magicmonty/bash-git-prompt</a>
</li>

<li>Seznam vybraných Unicode fontů<br />
<a href="https://en.wikipedia.org/wiki/Unicode_font#List_of_Unicode_fonts">https://en.wikipedia.org/wiki/Unicode_font#List_of_Unicode_fonts</a>
</li>

<li>Unix History<br />
<a href="https://www.levenez.com/unix/">https://www.levenez.com/unix/</a>
</li>

<li>C shell<br />
<a href="https://en.wikipedia.org/wiki/C_shell">https://en.wikipedia.org/wiki/C_shell</a>
</li>

<li>tput(1) - Linux man page<br />
<a href="https://linux.die.net/man/1/tput">https://linux.die.net/man/1/tput</a>
</li>

<li>fc-list(1) - Linux man page<br />
<a href="https://linux.die.net/man/1/fc-list">https://linux.die.net/man/1/fc-list</a>
</li>

<li>fc-cache(1) - Linux man page<br />
<a href="https://linux.die.net/man/1/fc-cache">https://linux.die.net/man/1/fc-cache</a>
</li>

<li>fc-query(1) - Linux man page<br />
<a href="https://linux.die.net/man/1/fc-query">https://linux.die.net/man/1/fc-query</a>
</li>

<li>Unicode character recognition<br />
<a href="http://shapecatcher.com/">http://shapecatcher.com/</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2020</small></p>
</body>
</html>

