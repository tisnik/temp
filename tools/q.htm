<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title></title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1></h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V dnešní části poněkud nepravidelně vycházejícího seriálu o užitečných utilitách určených pro příkazovou řádku si popíšeme nástroj nazvaný &bdquo;q&ldquo;. Tento nástroj slouží pro spouštění SQL dotazů nikoli nad databází, ale přímo nad soubory CSV a TSV.</p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. </a></p>
<p><a href="#k02">*** 2. Formáty CSV a TSV i jejich derivace</a></p>
<p><a href="#k03">*** 3. Instalace nástroje <strong>q</strong></a></p>
<p><a href="#k04">*** 4. Lokální instalace, použití <strong>pip3</strong></a></p>
<p><a href="#k05">*** 5. Kontrola instalace nástroje <strong>q</strong></a></p>
<p><a href="#k06">*** 6. </a></p>
<p><a href="#k07">*** 7. </a></p>
<p><a href="#k08">*** 8. </a></p>
<p><a href="#k09">*** 9. </a></p>
<p><a href="#k10">*** 10. </a></p>
<p><a href="#k11">*** 11. </a></p>
<p><a href="#k12">*** 12. </a></p>
<p><a href="#k13">*** 13. </a></p>
<p><a href="#k14">*** 14. </a></p>
<p><a href="#k15">*** 15. </a></p>
<p><a href="#k16">*** 16. </a></p>
<p><a href="#k17">*** 17. </a></p>
<p><a href="#k18">*** 18. </a></p>
<p><a href="#k19">*** 19. </a></p>
<p><a href="#k20">*** 20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. </h2>



<p><a name="k02"></a></p>
<h2 id="k02">2. Formáty CSV a TSV i jejich derivace</h2>

<p><i>CSV</i> neboli <i>Comma-Separated Values</i> [<a href="https://en.wikipedia.org/wiki/Comma-separated_values">1</a>] je jedním z&nbsp;nejčastěji používaných souborových formátů v&nbsp;této oblasti, a to přesto, že je export a import CSV v&nbsp;některých případech problematický (například některé české mutace Excelu namísto čárek používají středníky, problémy nastávají s&nbsp;buňkami obsahujícími znaky pro konec řádku atd.).  Tyto soubory jsou mnohdy obrovské, ovšem s&nbsp;jejich zobrazením ve VisiData nebývají ani v&nbsp;tomto případě problémy. Pokud máte při importu či exportu potíže se zpracováním CSV, můžete použít několik přepínačů příkazového řádku s&nbsp;přesnou specifikací, jak se má konverze provést.</p>

<p><i>TSV</i> neboli <i>Tab-Separated Values</i> [<a href="https://en.wikipedia.org/wiki/Tab-separated_values">2</a>] [<a href="http://jkorpela.fi/TSV.html">3</a>] je velmi podobným formátem, ovšem s&nbsp;tím rozdílem, že oddělovačem jednotlivých buněk je znak tabulátoru.  Podobně jako v&nbsp;případě CSV i zde existuje několik voleb zadávaných na příkazovém řádku, které ovlivňují způsob importu (zda tabulka obsahuje hlavičky sloupců atd.).</p>

<p>Existuje i mnoho aplikací, v&nbsp;nichž jsou tabulková data uložena ve formě běžných textových souborů s&nbsp;nějakými oddělovači odlišnými od výše zmíněného tabulátoru (relativně často se jedná o středníky, dvojtečky nebo o znak |). Buď se jedná o zobecnění formátů CSV a TSV [<a href="https://en.wikipedia.org/wiki/Delimiter-separated_values">4</a>], nebo může mít textový soubor podobu naformátovaných sloupců s&nbsp;pevnou délkou (a tedy bez problémů čitelných uživatelem).</p>

<pre>
Sepal length    Sepal width     Petal length    Petal width     Species
5.1     3.5     1.4     0.2     I. setosa
4.9     3.0     1.4     0.2     I. setosa
4.7     3.2     1.3     0.2     I. setosa
4.6     3.1     1.5     0.2     I. setosa
5.0     3.6     1.4     0.2     I. setosa
</pre>

<pre>
Sepal length    Sepal width     Petal length    Petal width     Species
5.1             3.5             1.4             0.2             I. setosa
4.9             3.0             1.4             0.2             I. setosa
4.7             3.2             1.3             0.2             I. setosa
4.6             3.1             1.5             0.2             I. setosa
5.0             3.6             1.4             0.2             I. setosa
</pre>


<pre>
fips,name,total_population,margin_of_error
31001,"Adams County, NE",31299,0
31003,"Antelope County, NE",6655,0
31005,"Arthur County, NE",490,64
31007,"Banner County, NE",778,73
31009,"Blaine County, NE",584,76
31011,"Boone County, NE",5473,0
31013,"Box Butte County, NE",11345,0
31015,"Boyd County, NE",2025,114
31017,"Brown County, NE",3183,97
31019,"Buffalo County, NE",46330,0
31021,"Burt County, NE",6829,0
31023,"Butler County, NE",8345,0
31025,"Cass County, NE",25214,0
31027,"Cedar County, NE",8807,0
31029,"Chase County, NE",3964,0
31031,"Cherry County, NE",5722,0
31033,"Cheyenne County, NE",10038,0
31035,"Clay County, NE",6497,0
</pre>

<p>Příkladem takového souboru je například <a href="https://www.cnb.cz/cs/financni_trhy/devizovy_trh/kurzy_devizoveho_trhu/denni_kurz.txt">https://www.cnb.cz/cs/financni_trhy/devizovy_trh/kurzy_devizoveho_trhu/denni_kurz.txt</a>.

<pre>
09.10.2020 #196
země|měna|množství|kód|kurz
Austrálie|dolar|1|AUD|16,526
Brazílie|real|1|BRL|4,120
Bulharsko|lev|1|BGN|13,862
Čína|žen-min-pi|1|CNY|3,430
Dánsko|koruna|1|DKK|3,643
EMU|euro|1|EUR|27,110
Filipíny|peso|100|PHP|47,490
Hongkong|dolar|1|HKD|2,966
Chorvatsko|kuna|1|HRK|3,579
Indie|rupie|100|INR|31,449
Indonesie|rupie|1000|IDR|1,563
Island|koruna|100|ISK|16,652
Izrael|nový šekel|1|ILS|6,802
Japonsko|jen|100|JPY|21,694
Jižní Afrika|rand|1|ZAR|1,395
Kanada|dolar|1|CAD|17,443
Korejská republika|won|100|KRW|2,007
Maďarsko|forint|100|HUF|7,610
Malajsie|ringgit|1|MYR|5,554
Mexiko|peso|1|MXN|1,081
MMF|ZPČ|1|XDR|32,441
Norsko|koruna|1|NOK|2,496
Nový Zéland|dolar|1|NZD|15,212
Polsko|zlotý|1|PLN|6,065
Rumunsko|leu|1|RON|5,565
Rusko|rubl|100|RUB|29,811
Singapur|dolar|1|SGD|16,958
Švédsko|koruna|1|SEK|2,602
Švýcarsko|frank|1|CHF|25,162
Thajsko|baht|100|THB|74,009
Turecko|lira|1|TRY|2,908
USA|dolar|1|USD|22,983
Velká Británie|libra|1|GBP|29,737
</pre>

<pre>
Event Desc|En No|Site Name|Licensee Name|Region No|City Name|State Cd|County Name|License No|Agreement State Ind|Docket No|Unit Ind1|Unit Ind2|Unit Ind3|Reactor Type|Nrc Notified By|Ops Officer|Notification Dt|Notification Time|Event Dt|Event Time|Time Zone|Last Updated Dt|Emergency Class|Cfr Cd1|Cfr Descr1|Cfr Cd2|Cfr Descr2|Cfr Cd3|Cfr Descr3|Cfr Cd4|Cfr Descr4|Staff Name1|Org Abbrev1|Staff Name2|Org Abbrev2|Staff Name3|Org Abbrev3|Staff Name4|Org Abbrev4|Staff Name5|Org Abbrev5|Staff Name6|Org Abbrev6|Staff Name7|Org Abbrev7|Staff Name8|Org Abbrev8|Staff Name9|Org Abbrev9|Staff Name10|Org Abbrev10|Scram Code 1|RX CRIT 1|Initial PWR 1|Initial RX Mode1|Current PWR 1|Current RX Mode 1|Scram Code 2|RX CRIT 2|Initial PWR 2|Initial RX Mode 2|Current PWR 2|Current RX Mode 2|Scram Code 3|RX CRIT 3|Initial PWR 3|Initial RX Mode 3|Current PWR 3|Current RX Mode 3|Event Text|
</pre>


<p><a name="k03"></a></p>
<h2 id="k03">3. Instalace nástroje <strong>q</strong></h2>

<pre>
  Using cached https://files.pythonhosted.org/packages/34/a6/49e2849a0e5464e1b5d621f63bc8453066f0f367bb3b744a33fca0bc1ddd/flake8-3.6.0-py2.py3-none-any.whl                                                                                    
Requirement already satisfied: six&gt;=1.10.0 in /home/ptisnovs/.local/lib/python3.6/site-packages (from pytest==4.6.2-&gt;-r test-requirements.txt (line 1))                                                                                        
Requirement already satisfied: pluggy&lt;1.0,&gt;=0.12 in /home/ptisnovs/.local/lib/python3.6/site-packages (from pytest==4.6.2-&gt;-r test-requirements.txt (line 1))                                                                                  
Requirement already satisfied: py&gt;=1.5.0 in /usr/lib/python3.6/site-packages (from pytest==4.6.2-&gt;-r test-requirements.txt (line 1))                                                                                                           
Requirement already satisfied: importlib-metadata&gt;=0.12 in /home/ptisnovs/.local/lib/python3.6/site-packages (from pytest==4.6.2-&gt;-r test-requirements.txt (line                                                                                1))                                                                                            
Collecting atomicwrites&gt;=1.0 (from pytest==4.6.2-&gt;-r test-requirements.txt (line1))                                                                                            
  Using cached https://files.pythonhosted.org/packages/2c/a0/da5f49008ec6e9a658dbf5d7310a4debd397bce0b4db03cf8a410066bb87/atomicwrites-1.4.0-py2.py3-none-any.wh                                                                               l                                                                                   
Requirement already satisfied: packaging in /home/ptisnovs/.local/lib/python3.6/site-packages (from pytest==4.6.2-&gt;-r test-requirements.txt (line 1))                                                                                          
Requirement already satisfied: wcwidth in /home/ptisnovs/.local/lib/python3.6/site-packages (from pytest==4.6.2-&gt;-r test-requirements.txt (line 1))                                                                                            
Requirement already satisfied: attrs&gt;=17.4.0 in /home/ptisnovs/.local/lib/python3.6/site-packages (from pytest==4.6.2-&gt;-r test-requirements.txt (line 1))                                                                                      
Requirement already satisfied: more-itertools&gt;=4.0.0; python_version &gt; "2.7" in /home/ptisnovs/.local/lib/python3.6/site-packages (from pytest==4.6.2-&gt;-r test-r                                                                               equirements.txt (line 1))                                                                                                                                      
Requirement already satisfied: pyflakes&lt;2.1.0,&gt;=2.0.0 in /home/ptisnovs/.local/lib/python3.6/site-packages (from flake8==3.6.0-&gt;-r test-requirements.txt (line 2                                                                               ))                                                                                      
Collecting pycodestyle&lt;2.5.0,&gt;=2.4.0 (from flake8==3.6.0-&gt;-r test-requirements.txt (line 2))                                                                                                                    
  Using cached https://files.pythonhosted.org/packages/e5/c6/ce130213489969aa58610042dff1d908c25c731c9575af6935c2dfad03aa/pycodestyle-2.4.0-py2.py3-none-any.whl                                                                               
Requirement already satisfied: mccabe&lt;0.7.0,&gt;=0.6.0 in /usr/lib/python3.6/site-packages (from flake8==3.6.0-&gt;-r test-requirements.txt (line 2))                                                                                                
Requirement already satisfied: setuptools&gt;=30 in /usr/lib/python3.6/site-packages (from flake8==3.6.0-&gt;-r test-requirements.txt (line 2))                                                                                                      
Requirement already satisfied: zipp&gt;=0.5 in /home/ptisnovs/.local/lib/python3.6/site-packages (from importlib-metadata&gt;=0.12-&gt;pytest==4.6.2-&gt;-r test-requirement                                                                               s.txt (line 1))                                                                                                                             
Requirement already satisfied: pyparsing&gt;=2.0.2 in /usr/lib/python3.6/site-packages (from packaging-&gt;pytest==4.6.2-&gt;-r test-requirements.txt (line 1))                                                                                         
Installing collected packages: atomicwrites, pytest, pycodestyle, flake8
  Found existing installation: pytest 5.4.2
    Uninstalling pytest-5.4.2:
      Successfully uninstalled pytest-5.4.2
  Found existing installation: pycodestyle 2.3.1
    Uninstalling pycodestyle-2.3.1:
      Successfully uninstalled pycodestyle-2.3.1
  Found existing installation: flake8 3.5.0
    Uninstalling flake8-3.5.0:
      Successfully uninstalled flake8-3.5.0
Successfully installed atomicwrites-1.4.0 flake8-3.6.0 pycodestyle-2.4.0 pytest-4.6.2                                                                                               
pip3 install --user -e .
Obtaining file:///home/ptisnovs/temp/q-2.0.19
Collecting six==1.11.0 (from q==2.0.19)
  Downloading https://files.pythonhosted.org/packages/67/4b/141a581104b1f6397bfa78ac9d43d8ad29a7ca43ea90a2d863fe3056e86a/six-1.11.0-py2.py3-none-any.whl                                                                                       
Installing collected packages: six, q
  Found existing installation: six 1.12.0
    Uninstalling six-1.12.0:
      Successfully uninstalled six-1.12.0
  Running setup.py develop for q
Successfully installed q six-1.11.0
</pre>



<p><a name="k04"></a></p>
<h2 id="k04">4. Lokální instalace, použití <strong>pip3</strong></h2>

<p></p>

<pre>
--- Makefile    2020-09-22 16:20:00.000000001 +0200
+++ /home/ptisnovs/temp/q-2.0.19-/Makefile      2020-10-09 16:39:25.392295392 +0200
@@ -14,8 +14,8 @@
&nbsp;
 dep: ## Install the dependent libraries.
&nbsp;
-       pip install -r test-requirements.txt
-       pip install -e .
+       pip3 install --user -r test-requirements.txt
+       pip3 install --user -e .
&nbsp;
 lint: dep ## Run lint validations.
&nbsp;
@@ -28,10 +28,10 @@
        ## py.test -rs -c pytest.ini -s -v q/tests/suite.py --rootdir . 
&nbsp;
 release: ## Run release
-       pip install py-ci
+       pip3 install --user py-ci
        pyci release --no-wheel-publish --wheel-universal
&nbsp;
 local-release:
-       pip install py-ci
+       pip3 install --user py-ci
        ./do-manual-release.sh
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Kontrola instalace nástroje <strong>q</strong></h2>

<pre>
$ <strong>whereis q</strong>
&nbsp;
q: /home/ptisnovs/.local/bin/q
</pre>

<pre>
$ <strong>q --version</strong>
&nbsp;
q version 2.0.19
Python: 3.6.6 (default, Jul 19 2018, 16:29:00) // [GCC 7.3.1 20180303 (Red Hat 7.3.1-5)]
Copyright (C) 2012-2020 Harel Ben-Attia (harelba@gmail.com, @harelba on twitter)
http://harelba.github.io/q/
</pre>



<p><a name="k06"></a></p>
<h2 id="k06">6. </h2>

<p></p>



<p><a name="k07"></a></p>
<h2 id="k07">7. </h2>

<p></p>



<p><a name="k08"></a></p>
<h2 id="k08">8. </h2>

<p></p>



<p><a name="k09"></a></p>
<h2 id="k09">9. </h2>

<p></p>



<p><a name="k10"></a></p>
<h2 id="k10">10. </h2>

<p></p>



<p><a name="k11"></a></p>
<h2 id="k11">11. </h2>

<p></p>



<p><a name="k12"></a></p>
<h2 id="k12">12. </h2>

<p></p>



<p><a name="k13"></a></p>
<h2 id="k13">13. </h2>

<p></p>



<p><a name="k14"></a></p>
<h2 id="k14">14. </h2>

<p></p>



<p><a name="k15"></a></p>
<h2 id="k15">15. </h2>

<p></p>



<p><a name="k16"></a></p>
<h2 id="k16">16. </h2>

<p></p>



<p><a name="k17"></a></p>
<h2 id="k17">17. </h2>

<p></p>



<p><a name="k18"></a></p>
<h2 id="k18">18. </h2>

<p></p>



<p><a name="k19"></a></p>
<h2 id="k19">19. </h2>

<p></p>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>q - Run SQL directly on CSV or TSV files<br />
<a href="https://harelba.github.io/q/">https://harelba.github.io/q/</a>
</li>

<li>q - examples<br />
<a href="https://harelba.github.io/q/#examples">https://harelba.github.io/q/#examples</a>
</li>

<li>Repositář projektu q (GitHub)<br />
<a href="https://github.com/harelba/q">https://github.com/harelba/q</a>
</li>

<li>How to run SQL queries directly on CSV or TSV file<br />
<a href="https://computingforgeeks.com/run-sql-queries-directly-on-csv-files/">https://computingforgeeks.com/run-sql-queries-directly-on-csv-files/</a>
</li>

<li>Tab separated values<br />
<a href="https://datatables.net/extensions/buttons/examples/flash/tsv.html">https://datatables.net/extensions/buttons/examples/flash/tsv.html</a>
</li>

<li>csvkit 1.0.5 (dokumentace)<br />
<a href="https://csvkit.readthedocs.io/en/latest/#">https://csvkit.readthedocs.io/en/latest/#</a>
</li>

<li>Repositář projektu csvkit (GitHub)<br />
<a href="https://github.com/wireservice/csvkit">https://github.com/wireservice/csvkit</a>
</li>

<li>Příklad CSV schématu<br />
<a href="https://github.com/wireservice/ffs/blob/master/us/irs/irs_exempt_org_schema.csv">https://github.com/wireservice/ffs/blob/master/us/irs/irs_exempt_org_schema.csv</a>
</li>

<li>Repositář projektu jq (GitHub)<br />
<a href="https://github.com/stedolan/jq">https://github.com/stedolan/jq</a>
</li>

<li>GitHub stránky projektu jq<br />
<a href="https://stedolan.github.io/jq/">https://stedolan.github.io/jq/</a>
</li>

<li>5 modern alternatives to essential Linux command-line tools<br />
<a href="https://opensource.com/article/20/6/modern-linux-command-line-tools">https://opensource.com/article/20/6/modern-linux-command-line-tools</a>
</li>

<li>Návod k&nbsp;nástroji jq<br />
<a href="https://stedolan.github.io/jq/tutorial/">https://stedolan.github.io/jq/tutorial/</a>
</li>

<li>jq Manual (development version)<br />
<a href="https://stedolan.github.io/jq/manual/">https://stedolan.github.io/jq/manual/</a>
</li>

<li>Introducing JSON<br />
<a href="https://www.json.org/json-en.html">https://www.json.org/json-en.html</a>
</li>

<li>jq.py: a lightweight and flexible JSON processor<br />
<a href="https://github.com/mwilliamson/jq.py">https://github.com/mwilliamson/jq.py</a>
</li>

<li>Discover how to use jq, a JSON manipulation command line, with GeoJSON<br />
<a href="https://webgeodatavore.com/jq-json-manipulation-command-line-with-geojson.html">https://webgeodatavore.com/jq-json-manipulation-command-line-with-geojson.html</a>
</li>

<li>Reshaping JSON with jq<br />
<a href="https://programminghistorian.org/en/lessons/json-and-jq">https://programminghistorian.org/en/lessons/json-and-jq</a>
</li>

<li>Python bindings for jq<br />
<a href="https://pypi.org/project/jq/">https://pypi.org/project/jq/</a>
</li>

<li>edn<br />
<a href="https://github.com/edn-format/edn">https://github.com/edn-format/edn</a>
</li>

<li>Why use JSON over XML?<br />
<a href="https://www.sitepoint.com/json-vs-xml/">https://www.sitepoint.com/json-vs-xml/</a>
</li>

<li>XML and XPath<br />
<a href="https://www.w3schools.com/XML/xml_xpath.asp">https://www.w3schools.com/XML/xml_xpath.asp</a>
</li>

<li>XPath (Wikipedia)<br />
<a href="https://en.wikipedia.org/wiki/XPath">https://en.wikipedia.org/wiki/XPath</a>
</li>

<li>RFC7159<br />
<a href="https://www.ietf.org/rfc/rfc7159.txt">https://www.ietf.org/rfc/rfc7159.txt</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2020</small></p>
</body>
</html>

