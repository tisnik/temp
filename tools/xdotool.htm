<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Automatické ovládání aplikací s GUI využitím nástroje xdotool</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Automatické ovládání aplikací s GUI využitím nástroje xdotool</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p></p>



<h2>Obsah</h2>

<p><a href="#k01">1. Automatické ovládání aplikací s&nbsp;GUI využitím nástroje xdotool</a></p>
<p><a href="#k02">2. Instalace nástroje <strong>xdotool</strong></a></p>
<p><a href="#k03">3. Kontrola instalace</a></p>
<p><a href="#k04">4. Simulace stisku kláves</a></p>
<p><a href="#k05">5. Pouhý stisk či puštění klávesy</a></p>
<p><a href="#k06">6. Interaktivní výběr okna pro další operace</a></p>
<p><a href="#k07">7. Programový výběr okna na základě zadaných kritérií</a></p>
<p><a href="#k08">8. Simulace stisku kláves ve vybraném okně</a></p>
<p><a href="#k09">9. Otestování vybraných operací s&nbsp;využitím dalšího nástroje <strong>xev</strong></a></p>
<p><a href="#k10">10. Stisk kláves a nástroj <strong>xev</strong></a></p>
<p><a href="#k11">11. Kombinace několika operací</a></p>
<p><a href="#k12">12. Výběr okna pro provedení další operace</a></p>
<p><a href="#k13">13. Simulace práce s&nbsp;myší</a></p>
<p><a href="#k14">14. Přesun myši na zadané souřadnice</a></p>
<p><a href="#k15">*** 15. Příkazy provedené v&nbsp;případě změny stavu okna</a></p>
<p><a href="#k16">*** 16. </a></p>
<p><a href="#k17">*** 17. </a></p>
<p><a href="#k18">*** 18. </a></p>
<p><a href="#k19">*** 19. </a></p>
<p><a href="#k20">20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Automatické ovládání aplikací s&nbsp;GUI využitím nástroje xdotool</h2>

<p>Unixové systémy a od nich odvozené operační systémy (mezi něž patří
především Linux apod.) jsou používány mj.&nbsp;i z&nbsp;toho důvodu, že
umožňují relativně snadnou automatizaci mnoha operací s&nbsp;využitím skriptů,
které mohou nahradit ruční zadávání jednotlivých příkazů a popř.&nbsp;přenos
dat mezi nimi. Primárně je skriptování doménou takových nástrojů a utilit,
jejichž vstupní či výstupní data jsou reprezentována textovými či
(v&nbsp;poněkud menší míře) binárními daty. Mnohdy je však užitečné skriptovat
(či nějakým způsobem automatizovat) i ty aplikace, které jsou vybaveny
grafickým uživatelským rozhraním a ovládají se s&nbsp;využitím klávesnice a
myši popř.&nbsp;pomocí podobně koncipovaných vstupních zařízení (touchpad,
trackball atd.). Dnes se s&nbsp;jedním takovým nástrojem seznámíme. Jedná se o
univerzální nástroj, který nepředpokládá, že daná aplikace s&nbsp;GUI je
vybavena například rozhraním pro některé skriptovací jazyky (což je případ
GIMPu s&nbsp;rozhraním pro <a
href="https://www.root.cz/clanky/piseme-skripty-pro-graficky-editor-gimp-ve-scheme/">jazyk
Scheme</a> a taktéž <a
href="https://www.ibm.com/developerworks/library/os-autogimp/index.html">pro
Python</a>).</p>

<p>Pro automatizaci některých operací, které jsou běžně prováděny interaktivně
uživatelem (tedy primárně pomocí klávesnice a myši) je možné použít nástroj
nazvaný příznačně <strong>xdotool</strong>, s&nbsp;jehož jednotlivými operacemi
se seznámíme v&nbsp;dnešním článku. Tento nástroj <a
href="https://github.com/jordansissel/xdotool">naprogramovaný primárně
v&nbsp;C</a>, jenž je volatelný přímo z&nbsp;příkazové řádky a tím pádem i
z&nbsp;BASH skriptů atd., umožňuje provádět mj.&nbsp;i následující operace:</p>

<ol>

<li><a href="#k04">Simulace stisku klávesy popř.&nbsp;klávesy s&nbsp;modifikátorem</a></li>

<li><a href="#k05">Simulace buď pouze stisku či naopak puštění klávesy</a></li>

<li><a href="#k04">Simulace psaní delšího textu (tedy sekvence alfanumerických kláves)</a></li>

<li><a href="#k06">Interaktivní výběr okna pro prováděné operace</a></li>

<li><a href="#k07">Automatický výběr okna pro prováděné operace na základě zadaného kritéria</a></li>

<li><a href="#k13">Simulace stisku vybraného tlačítka myši</a></li>

<li><a href="#k14">Simulace pohybu ukazatelem myši</a></li>

<li>Další operace s&nbsp;vybraným oknem, například jeho minimalizace apod.</li>

<li>Naprogramování akce, která se má provést při změně stavu okna (najetí myší
apod.)</li>

</ol>

<p><div class="rs-tip-major">Poznámka: pokud budete potřebovat volat
<strong>xdotool</strong> z&nbsp;jiných programovacích jazyků (tedy nikoli pouze
ze shellu), je vhodné se poohlédnout po rozhraních k&nbsp;těmto jazykům.
V&nbsp;případě Pythonu se například jedná o dnes již poněkud zastaralou
knihovnu nazvanou <a
href="https://pypi.org/project/python-libxdo/">python-libxdo</a>.  Pro mnoho
účelů &ndash; zejména pro tvorbu testů &ndash; je však výhodnější použít
balíček <a href="https://pypi.org/project/PyAutoGUI/">PyAutoGUI</a>,
s&nbsp;nímž se pravděpodobně seznámíme v&nbsp;samostatném článku.</div></p>

<p>V&nbsp;navazujících kapitolách se sice zaměříme primárně na popis vybraných
možností nástroje <strong>xdotool</strong>, ovšem v&nbsp;souvislosti
s&nbsp;tímto nástrojem se seznámíme (i když pouze ve stručnosti)
s&nbsp;některými dalšími užitečnými nástroji, především s&nbsp;utilitami
nazvanými <strong>xwininfo</strong> a <strong>xev</strong>.</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Instalace nástroje <strong>xdotool</strong></h2>

<p>Před pokusy s&nbsp;nástrojem <strong>xdotool</strong> je pochopitelně nutné
ho nainstalovat. Jedná se o z&nbsp;dnešního pohledu velmi malý nástroj založený
na knihovně <strong>libxdo</strong> a na systémech založených na RPM ho můžeme
nainstalovat následovně:</p>

<pre>
# <strong>dnf install xdotool</strong>
&nbsp;
Last metadata expiration check: 2:51:10 ago on Sat 30 Jan 2021 07:43:07 AM EST.
Dependencies resolved.
===============================================================================================================================================================
 Package                       Architecture                 Version                                       Repository                                      Size
===============================================================================================================================================================
Installing:
 xdotool                       x86_64                       1:3.20150503.1-10.fc32                        beaker-Fedora-Everything                        52 k
Installing dependencies:
 libxdo                        x86_64                       1:3.20150503.1-10.fc32                        beaker-Fedora-Everything                        38 k
&nbsp;
Transaction Summary
===============================================================================================================================================================
Install  2 Packages
&nbsp;
Total download size: 90 k
Installed size: 175 k
Is this ok [y/N]: <strong>y</strong>
</pre>

<p>Druhá část instalace:</p>

<pre>
Downloading Packages:
(1/2): libxdo-3.20150503.1-10.fc32.x86_64.rpm                                                                                  684 kB/s |  38 kB     00:00
(2/2): xdotool-3.20150503.1-10.fc32.x86_64.rpm                                                                                 851 kB/s |  52 kB     00:00
---------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                          1.4 MB/s |  90 kB     00:00
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                                                                       1/1
  Installing       : libxdo-1:3.20150503.1-10.fc32.x86_64                                                                                                  1/2
  Installing       : xdotool-1:3.20150503.1-10.fc32.x86_64                                                                                                 2/2
  Running scriptlet: xdotool-1:3.20150503.1-10.fc32.x86_64                                                                                                 2/2
  Verifying        : libxdo-1:3.20150503.1-10.fc32.x86_64                                                                                                  1/2
  Verifying        : xdotool-1:3.20150503.1-10.fc32.x86_64                                                                                                 2/2
&nbsp;
Installed:
  libxdo-1:3.20150503.1-10.fc32.x86_64                                          xdotool-1:3.20150503.1-10.fc32.x86_64
&nbsp;
Complete!
</pre>

<p>Instalace na systémech založených na .deb balíčcích se provede sice jiným
příkazem, ale stejně přímočaře:</p>

<pre>
$ <strong>sudo apt-get install xdotool</strong>
&nbsp;
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  libxdo3
The following NEW packages will be installed:
  libxdo3 xdotool
0 upgraded, 2 newly installed, 0 to remove and 401 not upgraded.
Need to get 62,4 kB of archives.
After this operation, 204 kB of additional disk space will be used.
Do you want to continue? [Y/n] <strong>y</strong>
</pre>

<p>Druhá část instalace:</p>

<pre>
Get:1 http://archive.ubuntu.com/ubuntu focal/universe amd64 libxdo3 amd64 1:3.20160805.1-4 [21,0 kB]
Get:2 http://archive.ubuntu.com/ubuntu focal/universe amd64 xdotool amd64 1:3.20160805.1-4 [41,5 kB]
Fetched 62,4 kB in 1s (45,5 kB/s)   
Selecting previously unselected package libxdo3:amd64.
(Reading database ... 291087 files and directories currently installed.)
Preparing to unpack .../libxdo3_1%3a3.20160805.1-4_amd64.deb ...
Unpacking libxdo3:amd64 (1:3.20160805.1-4) ...
Selecting previously unselected package xdotool.
Preparing to unpack .../xdotool_1%3a3.20160805.1-4_amd64.deb ...
Unpacking xdotool (1:3.20160805.1-4) ...
Setting up libxdo3:amd64 (1:3.20160805.1-4) ...
Setting up xdotool (1:3.20160805.1-4) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for libc-bin (2.31-0ubuntu9) ...
</pre>



<p><a name="k03"></a></p>
<h2 id="k03">3. Kontrola instalace</h2>

<p>Po instalaci nástroje <strong>xdotool</strong> se pro jistotu přesvědčíme,
že je tento nástroj dostupný a že k&nbsp;němu existuje nápověda:</p>

<pre>
$ <strong>whereis xdotool</strong>
&nbsp;
xdotool: /usr/bin/xdotool /usr/share/man/man1/xdotool.1.gz
</pre>

<p>Seznam všech dostupných příkazů získáme takto:</p>

<pre>
$ <strong>xdotool --help</strong>
&nbsp;
Available commands:
  getactivewindow
  getwindowfocus
  ...
  ...
  ...
  exec
  sleep
</pre>

<p>Zobrazit je pochopitelně možné i nápovědu ve formě manuálových stránek,
která by taktéž měla být nainstalována:</p>

<pre>
$ <strong>man xdotool</strong>
&nbsp;
XDOTOOL(1)                                                          XDOTOOL(1)
&nbsp;
NAME
       xdotool - command-line X11 automation tool
&nbsp;
SYNOPSIS
       xdotool cmd args...
&nbsp;
       Notation: Some documentation uses [window] to denote an optional window
       argument. This case means that the argument, if not present, will
       default to "%1". See "WINDOW STACK" for what "%1" means.
&nbsp;
DESCRIPTION
       xdotool lets you programatically (or manually) simulate keyboard input
       and mouse activity, move and resize windows, etc. It does this using
       X11's XTEST extension and other Xlib functions.
&nbsp;
       There is some support for Extended Window Manager Hints (aka EWMH or
       NetWM).  See the "EXTENDED WINDOW MANAGER HINTS" section for more
       information.
&nbsp;
KEYBOARD COMMANDS
</pre>

<p>V&nbsp;navazujících kapitolách si ukážeme, jak lze tento nástroj využít, a
to i v&nbsp;prakticky zaměřených příkladech.</p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Simulace stisku kláves</h2>

<p>Prvním příkazem poskytovaným nástrojem <strong>xdotool</strong> je příkaz
simulující stisk (a opětovné puštění) klávesy. Tento příkaz se zadává
následovně:</p>

<pre>
$ <strong>xdootool key jméno-klávesy</strong>
</pre>

<p>Pokud například budeme chtít simulovat stisk klávesy <strong>A</strong>
(resp.&nbsp;přesněji řečeno <strong>Shift+A</strong> či <strong>a</strong>,
pokud je aktivní přepínač <strong>CapsLock</strong>), můžeme na příkazové řádce
zadat:</p>

<pre>
$ <strong>xdotool key A</strong>
</pre>

<p><div class="rs-tip-major">Poznámka: simulovaný stisk klávesy A se projeví
v&nbsp;aktivním terminálu, tedy na místě, kde je <strong>xdotool</strong>
zavolán. V&nbsp;praxi to tedy může vypadat následovně:</div></p>

<pre>
$ <strong>xdotool key A</strong>
&nbsp;
$ A &lt;- je zapsáno nástrojem xdotool a nikoli uživatelem
</pre>

<p>Lze ovšem použít i mnoho dalších (nealfanumerických) kláves a jejich
kombinací, například:</p>

<pre>
$ <strong>xdotool key Ctrl+M</strong>
</pre>

<p>Některá podporovaná jména kláves:</p>

<table>
<tr><td>alt+a</td></tr>
<tr><td>ctrl+a</td></tr>
<tr><td>Control_L+a</td></tr>
<tr><td>BackSpace</td></tr>
<tr><td>super+a (alias)</td></tr>
<tr><td>meta+a (alias)</td></tr>
<tr><td>F1</td></tr>
<tr><td>aacute (tedy &bdquo;á&ldquo;)</td></tr>
</table>

<p>Simulovat je možné i postupný stisk většího množství kláves:</p>

<pre>
$ <strong>xdotool key a b c</strong>
</pre>

<p>Zvětšení pauzy mezi jednotlivými simulovanými stisky (udáváno
v&nbsp;milisekundách):</p>

<pre>
$ <strong>xdotool key --delay 500 a b c aacute Ctrl+M</strong>
</pre>

<p><div class="rs-tip-major">Poznámka: velmi důležitý je přepínač
<strong>--window</strong>, který umožňuje specifikaci okna, do kterého se mají
informace o stisku kláves poslat. S&nbsp;tímto přepínačem se seznámíme později
v&nbsp;souvislosti s&nbsp;informacemi o ID oken.</div></p>

<p>Zajistit je možné i simulaci psaní delšího textu:</p>

<pre>
$ <strong>xdotool type Hello world!</strong>
</pre>

<p>Pomalejší psaní s&nbsp;půlsekundovými prodlevami mezi jednotlivými zapsanými
znaky:</p>

<pre>
$ <strong>xdotool type --delay 500 Hello world!</strong>
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Pouhý stisk či puštění klávesy</h2>

<p>V&nbsp;některých situacích je nutné klávesu či klávesy pouze stisknout a
nechat stisknutou/stisknuté. Až po provedení nějaké další operace se klávesa
pustí. I tyto dvě činnosti lze velmi snadno simulovat nástrojem
<strong>xdotool</strong>; pouze se namísto volání <strong>key
jméno-klávesy</strong> použije:</p>

<pre>
$ <strong>xdotool keydown jméno-klávesy</strong>
</pre>

<p>Resp.&nbsp;pro opětovné puštění klávesy:</p>

<pre>
$ <strong>xdotool keyup jméno-klávesy</strong>
</pre>

<p>Pokud například zadáme příkaz:</p>

<pre>
$ <strong>xdotool keydown alt</strong>
</pre>

<p>bude se aktivní terminál chovat tak, jakoby byla stále stisknuta klávesa
<strong>Alt</strong>. Mj.&nbsp;to znamená, že po stisku levého tlačítka myši
bude možné terminálem pohybovat, ovšem prakticky žádné další operace nebudou
plně funkční (až na zkratky vázané na klávesu <strong>Alt</strong>).</p> 

<p>Podobně lze držet stisknutou klávesu <strong>Shift</strong>:</p>

<pre>
$ <strong>xdotool keydown shift</strong>
</pre>

<p><div class="rs-tip-major">Poznámka: poměrně často se setkáme s&nbsp;tím, že
je klávesa stisknuta a současně se provádí nějaká operace s&nbsp;myší. I tohoto
lze dosáhnout s&nbsp;nástrojem <strong>xdotool</strong> s&nbsp;využitím
takzvaného zřetězení příkazů (<i>chaining</i>).</div></p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Interaktivní výběr okna pro další operace</h2>

<p>Všechny předchozí příklady simulovaly stisky i puštění kláves
popř.&nbsp;zápis delší sekvence znaků v&nbsp;okně, které bylo v&nbsp;dané
chvíli vybrané (mělo fokus). Typicky se jednalo o okno s&nbsp;terminálem,
v&nbsp;němž byl nástroj <strong>xdotool</strong> spouštěn. V&nbsp;naprosté
většině praktických použití <strong>xdotool</strong> však budeme potřebovat
ovládat odlišnou aplikaci resp.&nbsp;přesněji řečeno odlišné okno (protože
aplikace resp.&nbsp;proces může používat větší množství oken). Okno je možné
vybrat ručně nebo automaticky, například na základě jeho jména či dalších
kritérií, v&nbsp;každém případě je však výsledkem této operace celočíselný
identifikátor okna (<i>který je ovšem odlišný od PID</i>). Nejdříve si ukážeme,
jak se okno vybírá ručně. K&nbsp;tomu slouží příkaz:</p>

<pre>
$ <strong>xdotool selectwindow</strong>
</pre>

<p>Pokud tento příkaz zadáte, bude nástroj <strong>xdotool</strong> čekat na
to, až uživatel klikne do okna, jehož identifikátor potřebuje použít a následně
tento identifikátor zobrazí na standardním výstupu:</p>

<pre>
10485776
</pre>

<p>Podobného efektu můžeme dosáhnout i pomocí jiného nástroje, konkrétně
nástroje nazvaného <strong>xwininfo</strong>:</p>

<pre>
$ <strong>xwininfo</strong>
&nbsp;
xwininfo: Please select the window about which you
          would like information by clicking the
          mouse in that window.
</pre>

<p>Po výběru okna se vrátí podrobnější informace o vybraném oknu, například:</p>

<pre>
xwininfo: Window id: <u>0xa00010</u> "Xdotool - Keyboard | Linux.org - Mozilla Firefox"
&nbsp;
  Absolute upper-left X:  0
  Absolute upper-left Y:  22
  Relative upper-left X:  0
  Relative upper-left Y:  22
  Width: 1920
  Height: 1032
  Depth: 24
  Visual: 0x158
  Visual Class: TrueColor
  Border width: 0
  Class: InputOutput
  Colormap: 0xa00002 (not installed)
  Bit Gravity State: NorthWestGravity
  Window Gravity State: NorthWestGravity
  Backing Store State: NotUseful
  Save Under State: no
  Map State: IsViewable
  Override Redirect State: no
  Corners:  +0+22  -0+22  -0-26  +0-26
  -geometry 1920x1032+0+0
</pre>

<p>V&nbsp;tomto případě se vrátil identifikátor okna v&nbsp;hexadecimální
podobě, ovšem <strong>xwininfo</strong> lze přepnout do režimu, aby vrátil
identifikátor reprezentovaný v&nbsp;desítkové soustavě:</p>

<pre>
$ <strong>xwininfo -int</strong>
</pre>

<p>Příklad použití (opět s&nbsp;interaktivním výběrem okna):</p>

<pre>
$ <strong>xwininfo -int</strong>
&nbsp;
xwininfo: Please select the window about which you
          would like information by clicking the
          mouse in that window.
</pre>

<p>Výsledek nyní bude odlišný:</p>

<pre>
xwininfo: Window id: <u>10485776</u> "Xdotool - Keyboard | Linux.org - Mozilla Firefox"
&nbsp;
  Absolute upper-left X:  0
  Absolute upper-left Y:  22
  Relative upper-left X:  0
  Relative upper-left Y:  22
  Width: 1920
  Height: 1032
  Depth: 24
  Visual: 0x158
  Visual Class: TrueColor
  Border width: 0
  Class: InputOutput
  Colormap: 0xa00002 (not installed)
  Bit Gravity State: NorthWestGravity
  Window Gravity State: NorthWestGravity
  Backing Store State: NotUseful
  Save Under State: no
  Map State: IsViewable
  Override Redirect State: no
  Corners:  +0+22  -0+22  -0-26  +0-26
  -geometry 1920x1032+0+0
</pre>

<p>Zajímavé může být i stromové struktury oken, tedy ID nadřazených oken
(minimálně se jedná o &bdquo;kořenové&ldquo; okno):</p>

<pre>
$ <strong>xwininfo -tree</strong>
&nbsp;
xwininfo: Please select the window about which you
          would like information by clicking the
          mouse in that window.
&nbsp;
xwininfo: Window id: 0xa00010 "Automatické ovládání aplikací s GUI využitím nástroje xdotool - Mozilla Firefox"
&nbsp;
  Root window id: 0x190 (the root window) (has no name)
  Parent window id: 0x6bb4ea (has no name)
     1 child:
     0xa00011 (has no name): ()  1x1+-1+-1  +-1+21
</pre>

<p><div class="rs-tip-major">Poznámka: ve všech příkladech bylo vybráno totožné
okno, konkrétně okno Firefoxu. Proto jsou všechny ID totožné.</div></p>



<p><a name="k07"></a></p>
<h2 id="k07">7. Programový výběr okna na základě zadaných kritérií</h2>

<p>Častěji se ve skriptech setkáme s&nbsp;požadavkem na programový výběr okna
na základě nějakých kritérií. Nejjednodušší je výběr ve chvíli, kdy známe jméno
okna (ideálně pokud je jméno jednoznačné). Pokud například běží jediná instance
Firefoxu, lze ID okna získat takto:</p>

<pre>
$ xdotool search "Mozilla Firefox"
&nbsp;
Defaulting to search window name, class, and classname
<u>10485776</u>
</pre>

<p>Přesněji řečeno by se měl použít i přepínač <strong>--name</strong>:</p>

<pre>
$ xdotool search --name "Mozilla Firefox"
&nbsp;
Defaulting to search window name, class, and classname
<u>10485776</u>
</pre>

<p>V&nbsp;některých případech se vrátí více identifikátorů:</p>

<pre>
$ <strong>xdotool search "gvim"</strong>
&nbsp;
Defaulting to search window name, class, and classname
41943041
41943043
</pre>

<p>Tehdy musíme specifikovat, podle jakého kritéria se má okno vyhledat:</p>

<pre>
$ <strong>xdotool search --name "gvim"</strong>
&nbsp;
35651587
</pre>

<p>Použít lze i regulární výraz, takže můžeme najít okno GVimu, v&nbsp;němž je
editován text tohoto článku, tedy konkrétně soubor
&bdquo;xdotool.htm&ldquo;:</p>

<pre>
$ <strong>xdotool search --name "xdotool\.htm.*GVIM"</strong>
&nbsp;
35651587
</pre>

<p>Skutečnosti, že okna lze hledat podle titulku, lze pochopitelně využít,
například při vyhledání konkrétního terminálu:</p>

<pre>
$ <strong>xterm -title "Test"</strong>
</pre>

<p>Tento terminál, přesněji ID jeho okna, vyhledáme snadno:</p>

<pre>
$ <strong>xdotool search "Test"</strong>
&nbsp;
Defaulting to search window name, class, and classname
35651618
</pre>

<p>Nebo korektněji:</p>

<pre>
$ <strong>xdotool search --name "Test"</strong>
&nbsp;
35651618
</pre>



<p><a name="k08"></a></p>
<h2 id="k08">8. Simulace stisku kláves ve vybraném okně</h2>

<p>Nyní, když již máme k&nbsp;dispozici mechanismus pro výběr okna na základě
jeho celočíselného identifikátoru, můžeme oknu poslat zprávu o stisknuté
klávese. Pokud například je ID okna Firefoxu rovno <strong>10485776</strong>
(viz předchozí text), můžeme si vynutit překreslení aktuálně vybraného tabu
alespoň teoreticky takto:</p>

<pre>
$ <strong>xdotool key --window 10485776 F5</strong>
</pre>

<p>Ve skutečnosti však mnohé aplikace akceptují stisknuté klávesy jen ve
chvíli, kdy jsou aktivní. Z&nbsp;tohoto důvodu musíme předchozí příkaz upravit
takovým způsobem, aby se nejdříve okno aktivovalo a teprve poté se mu poslal
kód stisknuté klávesy:</p>

<pre>
$ <strong>xdotool windowactivate --sync 10485776 key F5</strong>
</pre>

<p>Někdy je zapotřebí po aktivaci okna pozastavit další operaci, například na
polovinu sekundy. Následující příkaz otevře v&nbsp;oknu Firefoxu nový prázdný
tab:</p>

<pre>
xdotool windowactivate --sync 10485776 sleep 0.5 key Ctrl+t
</pre>

<p><div class="rs-tip-major">Poznámka: pozor na rozdíl mezi kombinací kláves
<strong>Ctrl+t</strong> a <strong>Ctrl+T</strong>, které jak Firefox, tak i
nástroj <strong>xdotool</strong> rozlišuje!</div></p>



<p><a name="k09"></a></p>
<h2 id="k09">9. Otestování vybraných operací s&nbsp;využitím dalšího nástroje <strong>xev</strong></h2>

<p>Většinu funkcí nabízených nástrojem <strong>xdotool</strong> je možné
otestovat s&nbsp;využitím dalšího užitečného nástroje, který se jmenuje
<strong>xev</strong>. Tento nástroj dokáže zobrazit všechny události
(<i>event</i>), které jako aplikace běžící pod systémem X přijímá. Kromě
událostí, které souvisí s&nbsp;činností vlastního systému oken se jedná i o
události spojené s&nbsp;klávesnicí a myší.</p>

<p>Nástroj <strong>xev</strong> spustíme bez dalších parametrů v&nbsp;jednom
terminálu (do kterého se budou vypisovat podrobnější informace o
událostech):</p>

<pre>
$ <strong>xev</strong>
</pre>

<p>Mělo by se zobrazit okno přijímající události:</p>

*** image ***
<p><i>Obrázek 1: Okno nástroje <strong>xev</strong>.</i></p>

<p>Povšimněte si, že okno má nápis (titulek) &bdquo;Event Tester&ldquo;, takže
velmi snadno nalezneme jeho ID:</p>

<pre>
$ <strong>xdotool search "Event Tester"</strong>
&nbsp;
Defaulting to search window name, class, and classname
35651585
</pre>



<p><a name="k10"></a></p>
<h2 id="k10">10. Stisk kláves a nástroj <strong>xev</strong></h2>

<p>Následně můžeme tomuto oknu poslat informaci o stisku klávesy
&bdquo;a&ldquo;:</p>

<pre>
$ <strong>xdotool key --window 35651585 a</strong>
</pre>

<p>Ve skutečnosti tímto způsobem vznikne dvojice událostí &ndash; jedna o
stisku klávesy:</p>

<pre>
KeyPress event, serial 36, synthetic YES, window 0x2200001,
    root 0x4006f2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XmbLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

<p>A druhá o puštění klávesy:</p>

<pre>
KeyRelease event, serial 36, synthetic YES, window 0x2200001,
    root 0x4006f2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

<p>Můžeme ovšem poslat pouze informaci o stisku klávesy:</p>

<pre>
$ <strong>xdotool keydown --window 35651585 a</strong>
</pre>

<p>Což vede ke vzniku jediné události:</p>

<pre>
KeyPress event, serial 36, synthetic YES, window 0x2200001,
    root 0x626212c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XmbLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

<p>Puštění klávesy:</p>

<pre>
$ <strong>xdotool keyup --window 35651585 a</strong>
</pre>

<p>To naopak vede ke vzniku této události:</p>

<pre>
KeyRelease event, serial 36, synthetic YES, window 0x2200001,
    root 0x7d74e2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

<p>Stisk dvojice kláves, typicky <strong>Ctrl+klávesa</strong> nebo
<strong>Shift+klávesa</strong> se rozloží na několik událostí:</p>

<pre>
$ <strong>xdotool key --window 35651585 shift+a</strong>
</pre>

<p>S&nbsp;výsledkem:</p>

<pre>
KeyPress event, serial 36, synthetic YES, window 0x2600001,
    root 0xd392a2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 50 (keysym 0xffe1, Shift_L), same_screen YES,
    XLookupString gives 0 bytes: 
    XmbLookupString gives 0 bytes: 
    XFilterEvent returns: False
&nbsp;
KeyPress event, serial 36, synthetic YES, window 0x2600001,
    root 0xd392a2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XmbLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
&nbsp;
KeyRelease event, serial 36, synthetic YES, window 0x2600001,
    root 0xd392a2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 50 (keysym 0xffe1, Shift_L), same_screen YES,
    XLookupString gives 0 bytes: 
    XFilterEvent returns: False
&nbsp;
KeyRelease event, serial 36, synthetic YES, window 0x2600001,
    root 0xd392a2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

<p>Což je ovšem zcela rozdílné od stisku <strong>A</strong>:</p>

<pre>
$ <strong>xdotool key --window 35651585 A</strong>
</pre>
<p>S&nbsp;výsledkem:</p>

<pre>
KeyPress event, serial 36, synthetic YES, window 0x2600001,
    root 0x1345e2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x1, keycode 38 (keysym 0x41, A), same_screen YES,
    XLookupString gives 1 bytes: (41) "A"
    XmbLookupString gives 1 bytes: (41) "A"
    XFilterEvent returns: False
&nbsp;
KeyRelease event, serial 36, synthetic YES, window 0x2600001,
    root 0x1345e2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x1, keycode 38 (keysym 0x41, A), same_screen YES,
    XLookupString gives 1 bytes: (41) "A"
    XFilterEvent returns: False
</pre>



<p><a name="k11"></a></p>
<h2 id="k11">11. Kombinace několika operací</h2>

<p>Mnohdy je nutné vykonat větší množství operací, které spolu souvisí. Typicky
se jedná o získání fokusu okna v&nbsp;kombinaci s&nbsp;nějakou další operací,
například se stiskem klávesy. I takovéto kombinace jsou nástrojem
<strong>xdotool</strong> podporovány. Typickým příkladem může být:</p>

<pre>
$ <strong>xdotool windowfocus --sync 35651618 type exit</strong>
</pre>

<p>popř.</p>

<pre>
$ <strong>xdotool windowfocus --sync 35651618 key ctrl+m</strong>
</pre>

<p>Pokud operace <strong>windowfocus</strong> nepracuje korektně (záleží na
mnoha faktorech), lze alternativně vyzkoušet:</p>

<pre>
$ <strong>xdotool windowactivate --sync 41943043 key ctrl+m</strong>
</pre>

<p>Některé operace ovšem snadno zřetězit nelze, což souvisí se zápisem
parametrů předávaných nástroji <strong>xdotool</strong>. V&nbsp;takovém případě
se provede spojení na úrovni shellu:</p>

<pre>
$ <strong>xdotool windowfocus --sync 35651618 type exit; xdotool key ctrl+m</strong>
</pre>

<p>Zde není možné za <strong>exit</strong> přímo zapsat operaci
<strong>key</strong>, protože by byla považována za text (sekvenci znaků),
který se má aplikaci poslat.</p>



<p><a name="k12"></a></p>
<h2 id="k12">12. Výběr okna pro provedení další operace</h2>

<p>Prozatím jsme ID okna, kterého se nějaká operace týkala, zjišťovali
v&nbsp;samostatném příkazu, například následovně:</p>

<pre>
$ <strong>xdotool search --name "Event Tester"</strong>
39845889
</pre>

<p>Ve skutečnosti je však možné ID okna automaticky použít v&nbsp;navazujících
příkazech, což je umožněno díky vlastnosti nazvané &bdquo;window
chaining&ldquo;. Tato vlastnost umožňuje využít ID okna získaného nějakou
vyhledávací operací, typicky operací <strong>search</strong>:</p>

<pre>
$ <strong>xdotool search --name "Event Tester" windowactivate</strong>
$ <strong>xdotool search --name "Event Tester" key X</strong>
</pre>

<p>Stejně je však možné okno vybrat interaktivně a následně provést
naprogramovanou sekvenci příkazů:</p>

<pre>
$ <strong>xdotool selectwindow key X</strong>
</pre>

<p>K&nbsp;ID nalezeného okna je možné se vrátit pseudohodnotou %1:</p>

<pre>
$ <strong>xdotool search --name "Event Tester" key --window %1 X</strong>
</pre>

<p>Ve skutečnosti si nástroj <strong>xdotool</strong> udržuje zásobník
s&nbsp;ID oken odpovídajících vyhledávacím kritériím a hodnotou za % je možné
zvolit vhodné okno z&nbsp;tohoto zásobníku, ovšem většinou si vystačíme
s&nbsp;prvním nalezeným oknem.</p>

<p><div class="rs-tip-major">Poznámka: tato hodnota bude použita především při
posunu kurzoru myši.</div></p>



<p><a name="k13"></a></p>
<h2 id="k13">13. Simulace práce s&nbsp;myší</h2>

<p>Nástroj <strong>xdotool</strong> podporuje i simulaci práce s&nbsp;myší.
Nejjednodušší je operace napodobující kliknutí vybraným tlačítkem myši. Tato
operace se provede příkazem:</p>

<pre>
$ <strong>xdotool click kód-tlačítka-myši</strong>
</pre>

<p>Kde příslušný kód značí:</p>

<table>
<tr><th>Kód</th><th>Operace s&nbsp;myší</th></tr>
<tr><td>1</td><td>levé tlačítko myši</td></tr>
<tr><td>2</td><td>prostřední tlačítko myši</td></tr>
<tr><td>3</td><td>pravé tlačítko myši</td></tr>
<tr><td>4</td><td>skrolovací kolečko: směr nahoru</td></tr>
<tr><td>5</td><td>skrolovací kolečko: směr dolů</td></tr>
</table>

<p><div class="rs-tip-major">Poznámka: směr skrolování může být i opačný na
základě aktuálního nastavení systému.</div></p>

<p>Stisk pravého tlačítka myši v&nbsp;okně prohlížeče (a tím pádem
pravděpodobně zobrazení kontextového menu) zajistí příkaz:</p>

<pre>
$ <strong>xdotool search --name "Mozilla Firefox" windowactivate --sync click 3</strong>
</pre>

<p>Naprosto stejným způsobem je možné skrolovat aktuálně zobrazenou stránkou:</p>

<pre>
$ <strong>xdotool search --name "Mozilla Firefox" windowactivate --sync click 5 click 5</strong>
</pre>



<p><a name="k14"></a></p>
<h2 id="k14">14. Přesun myši na zadané souřadnice</h2>

<p>Myš, resp.&nbsp;přesněji řečeno ukazatel myši, je možné posunout na zadané
absolutní souřadnice vztažené k&nbsp;levému hornímu rohu desktopu:</p>

<pre>
$ <strong>xdotool mousemove 100 100</strong>
</pre>

<p>Pro posun v&nbsp;rámci nějakého okna je nutné specifikovat ID okna, takže
zde využijeme výše zmíněný pseudoparametr %1. Následující příkaz přesune kurzor
na souřadnice [100, 100] vztažené k&nbsp;levému hornímu rohu okna
prohlížeče:</p>

<pre>
$ <strong>xdotool search --name "Mozilla" mousemove --window %1 100 100</strong>
</pre>

<p>Relativní pohyb myši vztažený k&nbsp;aktuální pozici kurzoru, zajišťuje
příkaz <strong>mousemove_relative</strong>:</p>

<pre>
$ <strong>xdotool mousemove_relative 20 20</strong>
</pre>

<p>Většinou se však tento příkaz používá zřetězený s&nbsp;dalšími příkazy,
například:</p>

<pre>
$ <strong>xdotool search --name "Mozilla" mousemove --window %1 --sync 100 100 click --delay 300 3 mousemove_relative --sync 25 15 click --delay 300 1</strong>
</pre>



<p><a name="k15"></a></p>
<h2 id="k15">15. Příkazy provedené v&nbsp;případě změny stavu okna</h2>

<p>Zajímavá a potenciálně užitečná je i další vlastnost &ndash; možnost
specifikace příkazů, které se provedou ve chvíli, kdy se změní stav sledovaného
okna nebo oken. K&nbsp;tomuto účelu slouží příkaz <strong>behave</strong>, za
nějž je zapotřebí zapsat trojici parametrů:</p>

<ol>
<li>ID okna nebo oken, kterých se má příkaz týkat</li>
<li>Změna stavu okna (takzvaná akce)</li>
<li>Příkaz, který se provede ve chvíli, kdy se stav okna skutečně změní</li>
</ol>

<p>V&nbsp;současné verzi nástroje <strong>xdotool</strong> jsou podporovány následující změny (akce):</p>

<table>
<tr><th>#</th><th>Označení</th><th>Význam</th></tr>
<tr><td>1</td><td>mouse-enter</td><td>ukazatel myši najel do plochy okna</td></tr>
<tr><td>2</td><td>mouse-leave</td><td>ukazatel myši opustil plochu okna</td></tr>
<tr><td>3</td><td>mouse-click</td><td>kliknutí myší do plochy okna</td></tr>
<tr><td>4</td><td>focus</td><td>okno získalo fokus (je aktivní)</td></tr>
<tr><td>5</td><td>blur</td><td>okno ztratilo fokus (stává se neaktivní)</td></tr>
</table>

<p>Podívejme se nyní na některé možnosti použití příkazu
<strong>behave</strong>.  Můžeme například zajistit, aby se po najetí myší do
plochy okna toto okno automaticky aktivovalo (získalo fokus). To je
pochopitelně operace, kterou dokáže provádět mnoho správců oken, ovšem
s&nbsp;využitím nástroje <strong>xdotool</strong> se toto nastavení může
provést pouze pro jediné okno nebo pro sadu oken odpovídajících vyhledávacím
kritériím:</p>

<pre>
$ <strong>xdotool search --name "Mozilla" behave %1 mouse-enter windowfocus</strong>
</pre>

<p>Popř.&nbsp;totéž chování pro všechna viditelná okna:</p>

<pre>
$ <strong>xdotool search . behave %@ mouse-enter windowfocus</strong>
</pre>




<p><a name="k16"></a></p>
<h2 id="k16">16. </h2>



<p><a name="k17"></a></p>
<h2 id="k17">17. </h2>



<p><a name="k18"></a></p>
<h2 id="k18">18. </h2>



<p><a name="k19"></a></p>
<h2 id="k19">19. </h2>

xdotool search --onlyvisible --class 'gvim' getwindowpid %@ | uniq | xargs -I{} xdotool search --all --pid {} --name 'TODO' getwindowgeometry | sed -r -n 's/.*Position: ([-0-9,+x]+) .*/\1/p'


<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>Xdotool - Keyboard<br />
<a href="https://www.linux.org/threads/xdotool-keyboard.10528/">https://www.linux.org/threads/xdotool-keyboard.10528/</a>
</li>

<li>How to Use Xdotool to Stimulate Mouse Clicks and Keystrokes in Linux<br />
<a href="https://linuxhint.com/xdotool_stimulate_mouse_clicks_and_keystrokes/">https://linuxhint.com/xdotool_stimulate_mouse_clicks_and_keystrokes/</a>
</li>

<li>xdootool.1 (manuálová stránka)<br />
<a href="http://manpages.ubuntu.com/manpages/trusty/man1/xdotool.1.html">http://manpages.ubuntu.com/manpages/trusty/man1/xdotool.1.html</a>
</li>

<li>Repositář projektu xdotool<br />
<a href="https://github.com/jordansissel/xdotool">https://github.com/jordansissel/xdotool</a>
</li>

<li>Balíček python-libxdo<br />
<a href="https://pypi.org/project/python-libxdo/">https://pypi.org/project/python-libxdo/</a>
</li>

<li>Dokumentace k&nbsp;balíčku python-libxdo<br />
<a href="https://rshk.github.io/python-libxdo/library.html">https://rshk.github.io/python-libxdo/library.html</a>
</li>

<li>Balíček PyAutoGUI<br />
<a href="https://pypi.org/project/PyAutoGUI/">https://pypi.org/project/PyAutoGUI/</a>
</li>

<li>Dokumentace ke knihovně PyAutoGUI<br />
<a href="https://pyautogui.readthedocs.io/en/latest/">https://pyautogui.readthedocs.io/en/latest/</a>
</li>

<li>Píšeme skripty pro grafický editor GIMP (ve Scheme)<br />
<a href="https://www.root.cz/clanky/piseme-skripty-pro-graficky-editor-gimp-ve-scheme/">https://www.root.cz/clanky/piseme-skripty-pro-graficky-editor-gimp-ve-scheme/</a>
</li>

<li>Use Python to write plug-ins for GIMP<br />
<a href="https://www.ibm.com/developerworks/library/os-autogimp/index.html">https://www.ibm.com/developerworks/library/os-autogimp/index.html</a>
</li>

<li>How do I find the X window ID under the mouse pointer in bash?<br />
<a href="https://unix.stackexchange.com/questions/16131/how-do-i-find-the-x-window-id-under-the-mouse-pointer-in-bash">https://unix.stackexchange.com/questions/16131/how-do-i-find-the-x-window-id-under-the-mouse-pointer-in-bash</a>
</li>

<li>xwininfo (manuálová stránka)<br />
<a href="https://www.x.org/releases/X11R7.7/doc/man/man1/xwininfo.1.xhtml">https://www.x.org/releases/X11R7.7/doc/man/man1/xwininfo.1.xhtml</a>
</li>

<li>xev (manuálová stránka)<br />
<a href="http://manpages.ubuntu.com/manpages/xenial/en/man1/xev.1.html">http://manpages.ubuntu.com/manpages/xenial/en/man1/xev.1.html</a>
</li>

<li>X Window System (Wikipedia)<br />
<a href="https://en.wikipedia.org/wiki/X_Window_System">https://en.wikipedia.org/wiki/X_Window_System</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2021</small></p>
</body>
</html>

