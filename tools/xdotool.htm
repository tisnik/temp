<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title></title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1></h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p></p>



<h2>Obsah</h2>

<p><a href="#k01">*** 1. </a></p>
<p><a href="#k02">*** 2. Instalace nástroje <strong>xdotool</strong></a></p>
<p><a href="#k03">*** 3. Simulace stisku kláves</a></p>
<p><a href="#k04">*** 4. </a></p>
<p><a href="#k05">*** 5. </a></p>
<p><a href="#k06">*** 6. </a></p>
<p><a href="#k07">*** 7. </a></p>
<p><a href="#k08">*** 8. </a></p>
<p><a href="#k09">*** 9. </a></p>
<p><a href="#k10">*** 10. </a></p>
<p><a href="#k11">*** 11. </a></p>
<p><a href="#k12">*** 12. </a></p>
<p><a href="#k13">*** 13. </a></p>
<p><a href="#k14">*** 14. </a></p>
<p><a href="#k15">*** 15. </a></p>
<p><a href="#k16">*** 16. </a></p>
<p><a href="#k17">*** 17. </a></p>
<p><a href="#k18">*** 18. </a></p>
<p><a href="#k19">*** 19. </a></p>
<p><a href="#k20">*** 20. Odkazy na Internetu</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. </h2>

<p>Unixové systémy a od nich odvozené operační systémy (Linux apod.) jsou používány mj.&nbsp;i z&nbsp;toho důvodu, že umožňují relativně snadnou automatizaci mnoha operací s&nbsp;využitím skriptů, které mohou nahradit ruční zadávání jednotlivých příkazů a popř.&nbsp;přenos dat mezi nimi. Primárně je skriptování doménou takových nástrojů a utilit, jejichž vstupní či výstupní data jsou reprezentována textovými či (v&nbsp;menší míře) binárními daty. Mnohdy je však užitečné skriptovat (či nějakým způsobem automatizovat) i ty aplikace, které jsou vybaveny grafickým uživatelským rozhraním a ovládají se s&nbsp;využitím klávesnice a myši popř.&nbsp;podobně koncipovaných vstupních zařízení (touchpad, trackball atd.). Dnes se s&nbsp;jedním takovým nástrojem seznámíme. Jedná se o univerzální nástroj, který nepředpokládá, že daná aplikace s&nbsp;GUI je vybavena například rozhraním pro některé skriptovací jazyky (což je případ GIMPu s&nbsp;rozhraním pro <a href="">jazyk Scheme</a> a taktéž <a href="">pro Python</a>).</p>

<p>Pro automatizaci některých operací, které jsou běžně prováděny interaktivně uživatelem (tedy primárně pomocí klávesnice a myši) je možné použít nástroj nazvaný příznačně <strong>xdotool</strong>, s&nbsp;jehož využitím se seznámíme v&nbsp;dnešním článku. Tento nástroj <a href="https://github.com/jordansissel/xdotool">naprogramovaný primárně v&nbsp;C</a>, jenž je volatelný přímo z&nbsp;příkazové řádky a tím pádem i z&nbsp;BASH skriptů atd., umožňuje provádět mj.&nbsp;i následující operace:</p>

<ol>
</ol>

<p><div class="rs-tip-major">Poznámka: pokud budete potřebovat volat <strong>xdotool</strong> z&nbsp;jiných programovacích jazyků (tedy nikoli pouze ze shellu), je vhodné se poohlédnout po rozhraních k&nbsp;těmto jazykům. V&nbsp;případě Pythonu se například jedná o dnes již poněkud zastaralou knihovnu <a href="https://pypi.org/project/python-libxdo/">python-libxdo</a>. Pro mnoho účelů &ndash; zejména pro tvorbu testů &ndash; je však výhodnější použít balíček <a href="https://pypi.org/project/PyAutoGUI/">PyAutoGUI</a>.</div></p>

<p>V&nbsp;navazujících kapitolách se sice zaměříme primárně na popis vybraných možností nástroje <strong>xdotool</strong>, ovšem v&nbsp;souvislosti s&nbsp;tímto nástrojem se seznámíme (i když ve stručnosti) s&nbsp;některými dalšími užitečnými nástroji, především s&nbsp;utilitami nazvanými <strong>xwininfo</strong> a <strong>xev</strong>.</p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Instalace nástroje <strong>xdotool</strong></h2>

<p>Před pokusy s&nbsp;nástrojem <strong>xdotool</strong> je pochopitelně nutné ho nainstalovat. Jedná se o z&nbsp;dnešního pohledu velmi malý nástroj založený na knihovně <strong>libxdo</strong> a na systémech založených na RPM ho můžeme nainstalovat následovně:</p>

<pre>
# <strong>dnf install xdotool</strong>
&nbsp;
Last metadata expiration check: 2:51:10 ago on Sat 30 Jan 2021 07:43:07 AM EST.
Dependencies resolved.
===============================================================================================================================================================
 Package                       Architecture                 Version                                       Repository                                      Size
===============================================================================================================================================================
Installing:
 xdotool                       x86_64                       1:3.20150503.1-10.fc32                        beaker-Fedora-Everything                        52 k
Installing dependencies:
 libxdo                        x86_64                       1:3.20150503.1-10.fc32                        beaker-Fedora-Everything                        38 k
&nbsp;
Transaction Summary
===============================================================================================================================================================
Install  2 Packages
&nbsp;
Total download size: 90 k
Installed size: 175 k
Is this ok [y/N]: <strong>y</strong>
Downloading Packages:
(1/2): libxdo-3.20150503.1-10.fc32.x86_64.rpm                                                                                  684 kB/s |  38 kB     00:00
(2/2): xdotool-3.20150503.1-10.fc32.x86_64.rpm                                                                                 851 kB/s |  52 kB     00:00
---------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                          1.4 MB/s |  90 kB     00:00
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                                                                       1/1
  Installing       : libxdo-1:3.20150503.1-10.fc32.x86_64                                                                                                  1/2
  Installing       : xdotool-1:3.20150503.1-10.fc32.x86_64                                                                                                 2/2
  Running scriptlet: xdotool-1:3.20150503.1-10.fc32.x86_64                                                                                                 2/2
  Verifying        : libxdo-1:3.20150503.1-10.fc32.x86_64                                                                                                  1/2
  Verifying        : xdotool-1:3.20150503.1-10.fc32.x86_64                                                                                                 2/2
&nbsp;
Installed:
  libxdo-1:3.20150503.1-10.fc32.x86_64                                          xdotool-1:3.20150503.1-10.fc32.x86_64
&nbsp;
Complete!
</pre>

<p>Instalace na systémech založených na .deb balíčcích se provede sice jiným příkazem, ale stejně přímočaře:</p>

<pre>
</pre>

<p>Druhá část instalace:</p>

<pre>
</pre>

<p>Po instalaci <strong>xdotool</strong> se pro jistotu přesvědčíme, že je tento nástroj dostupný a že k&nbsp;němu existuje nápověda:</p>

<pre>
$ <strong>whereis xdotool</strong>
&nbsp;
xdotool: /usr/bin/xdotool /usr/share/man/man1/xdotool.1.gz
</pre>

<p>Seznam dostupných příkazů:</p>

<pre>
$ <strong>xdotool --help</strong>
&nbsp;
Available commands:
  getactivewindow
  getwindowfocus
  ...
  ...
  ...
  exec
  sleep
</pre>

<p>Zobrazit je pochopitelně možné i nápovědu ve formě manuálových stránek:</p>

<pre>
$ <strong>man xdotool</strong>
&nbsp;
XDOTOOL(1)                                                          XDOTOOL(1)
&nbsp;
NAME
       xdotool - command-line X11 automation tool
&nbsp;
SYNOPSIS
       xdotool cmd args...
&nbsp;
       Notation: Some documentation uses [window] to denote an optional window
       argument. This case means that the argument, if not present, will
       default to "%1". See "WINDOW STACK" for what "%1" means.
&nbsp;
DESCRIPTION
       xdotool lets you programatically (or manually) simulate keyboard input
       and mouse activity, move and resize windows, etc. It does this using
       X11's XTEST extension and other Xlib functions.
&nbsp;
       There is some support for Extended Window Manager Hints (aka EWMH or
       NetWM).  See the "EXTENDED WINDOW MANAGER HINTS" section for more
       information.
&nbsp;
KEYBOARD COMMANDS
</pre>

<p>V&nbsp;navazujících kapitolách si ukážeme, jak lze tento nástroj využít, a to i v&nbsp;prakticky zaměřených příkladech.</p>



<p><a name="k03"></a></p>
<h2 id="k03">3. Simulace stisku kláves</h2>

<p>Prvním příkazem poskytovaným nástrojem <strong>xdotool</strong> je příkaz simulující stisk (a opětovné puštění) klávesy. Tento příkaz se zadává následovně:</p>

<pre>
$ <strong>xdootool key jméno-klávesy</strong>
</pre>

<p>Pokud například budeme chtít simulovat stisk klávesy <strong>A</strong> (resp.&nbsp;přesněji řečeno <strong>Shift+A</strong> či <strong>a</strong>, pokud je aktivní <strong>CapsLock</strong>), můžeme na příkazové řádce zadat:</p>

<pre>
$ <strong>xdotool key A</strong>
</pre>

<p><div class="rs-tip-major">Poznámka: simulovaný stisk klávesy A se projeví v&nbsp;aktivním terminálu, tedy na místě, kde je <strong>xdotool</strong> zavolán. V&nbsp;praxi to tedy může vypadat následovně:</div></p>

<pre>
$ <strong>xdotool key A</strong>
&nbsp;
$ A &lt;- je zapsáno nástrojem xdotool a nikoli uživatelem
</pre>

<p>Lze ovšem použít i mnoho dalších (nealfanumerických) kláves a jejich kombinací, například:</p>

<pre>
$ <strong>xdotool key Ctrl+M</strong>
</pre>

<p>Některá podporovaná jména kláves:</p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Pouhý stisk či puštění klávesy</h2>

<p>V&nbsp;některých situacích je nutné klávesu pouze stisknout a nechat stisknutou. Až po provedení nějaké další operace se klávesa pustí. I tyto dvě činnosti lze simulovat nástrojem <strong>xdotool</strong>; pouze se namísto volání <strong>key jméno-klávesy</strong> použije:</p>

<pre>
$ <strong>xdotool keydown jméno-klávesy</strong>
</pre>

<p>Resp.:</p>

<pre>
$ <strong>xdotool keyup jméno-klávesy</strong>
</pre>

<p>Pokud například zadáme příkaz:</p>

<pre>
$ <strong>xdotool keydown alt</strong>
</pre>

<p>bude se aktivní terminál chovat tak, jakoby byla stále stisknuta klávesa <strong>Alt</strong>. Mj.&nbsp;to znamená, že po stisku levého tlačítka myši bude možné terminálem pohybovat, ovšem prakticky žádné další operace nebudou plně funkční (až na zkratky vázané na klávesu <strong>Alt</strong>).</p> 

<p>Podobně lze držet stisknutou klávesu <strong>Shift</strong>:</p>

<pre>
$ <strong>xdotool keydown shift</strong>
</pre>



<p><a name="k05"></a></p>
<h2 id="k05">5. Interaktivní výběr okna pro další operace</h2>

<p>Všechny předchozí příklady simulovaly stisky i puštění kláves v&nbsp;okně, které bylo v&nbsp;dané chvíli vybrané (mělo fokus). Typicky se jednalo o okno s&nbsp;terminálem, v&nbsp;němž byl nástroj <strong>xdotool</strong> spouštěn. V&nbsp;naprosté většině praktických použití <strong>xdotool</strong> však budeme potřebovat ovládat odlišnou aplikaci resp.&nbsp;přesněji řečeno odlišné okno (protože aplikace resp.&nbsp;proces může používat větší množství oken). Okno je možné vybrat ručně nebo automaticky, například na základě jeho jména či dalších kritérií, v&nbsp;každém případě je však výsledkem této operace celočíselný identifikátor okna (<i>který je ovšem odlišný od PID</i>). Nejdříve si ukážeme, jak se okno vybírá ručně. K&nbsp;tomu slouží příkaz:</p>

<pre>
$ <strong>xdotool selectwindow</strong>
</pre>

<p>Pokud tento příkaz zadáte, bude nástroj <strong>xdotool</strong> čekat na to, až uživatel klikne do okna, jehož identifikátor potřebuje použít.</p>

xwininfo -int

xdotool search --onlyvisible --class 'gvim' getwindowpid %@ | uniq | xargs -I{} xdotool search --all --pid {} --name 'TODO' getwindowgeometry | sed -r -n 's/.*Position: ([-0-9,+x]+) .*/\1/p'

<pre>
$ xdotool search "Mozilla Firefox"
&nbsp;
Defaulting to search window name, class, and classname
<u>10485776</u>
</pre>

<pre>
$ <strong>xwininfo</strong>
&nbsp;
xwininfo: Please select the window about which you
          would like information by clicking the
          mouse in that window.
</pre>

<pre>
xwininfo: Window id: <u>0xa00010</u> "Xdotool - Keyboard | Linux.org - Mozilla Firefox"

  Absolute upper-left X:  0
  Absolute upper-left Y:  22
  Relative upper-left X:  0
  Relative upper-left Y:  22
  Width: 1920
  Height: 1032
  Depth: 24
  Visual: 0x158
  Visual Class: TrueColor
  Border width: 0
  Class: InputOutput
  Colormap: 0xa00002 (not installed)
  Bit Gravity State: NorthWestGravity
  Window Gravity State: NorthWestGravity
  Backing Store State: NotUseful
  Save Under State: no
  Map State: IsViewable
  Override Redirect State: no
  Corners:  +0+22  -0+22  -0-26  +0-26
  -geometry 1920x1032+0+0
</pre>

<pre>
$ <strong>xwininfo -int</strong>
&nbsp;
xwininfo: Please select the window about which you
          would like information by clicking the
          mouse in that window.
</pre>

<pre>
xwininfo: Window id: <u>10485776</u> "Xdotool - Keyboard | Linux.org - Mozilla Firefox"

  Absolute upper-left X:  0
  Absolute upper-left Y:  22
  Relative upper-left X:  0
  Relative upper-left Y:  22
  Width: 1920
  Height: 1032
  Depth: 24
  Visual: 0x158
  Visual Class: TrueColor
  Border width: 0
  Class: InputOutput
  Colormap: 0xa00002 (not installed)
  Bit Gravity State: NorthWestGravity
  Window Gravity State: NorthWestGravity
  Backing Store State: NotUseful
  Save Under State: no
  Map State: IsViewable
  Override Redirect State: no
  Corners:  +0+22  -0+22  -0-26  +0-26
  -geometry 1920x1032+0+0
</pre>

bash-4.4$ xdotool search "gvim"
Defaulting to search window name, class, and classname
41943041
41943043
bash-4.4$ xdotool windowactivate --sync 41943043




xterm -title "Test"

xdotool search "Test"
Defaulting to search window name, class, and classname
35651618




<p><a name="k06"></a></p>
<h2 id="k06">6. Otestování vybraných operací s&nbsp;využitím dalšího nástroje <strong>xev</strong></h2>

<pre>
$ <strong>xdotool search "Event Tester"</strong>
&nbsp;
Defaulting to search window name, class, and classname
35651585
</pre>

<pre>
$ <strong>xdotool key --window 35651585 a</strong>
</pre>

<pre>
KeyPress event, serial 36, synthetic YES, window 0x2200001,
    root 0x4006f2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XmbLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

<pre>
KeyRelease event, serial 36, synthetic YES, window 0x2200001,
    root 0x4006f2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

<pre>
$ <strong>xdotool keydown --window 35651585 a</strong>
</pre>

<pre>
KeyPress event, serial 36, synthetic YES, window 0x2200001,
    root 0x626212c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XmbLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

<pre>
$ <strong>xdotool keyup --window 35651585 a</strong>
</pre>

<pre>
KeyRelease event, serial 36, synthetic YES, window 0x2200001,
    root 0x7d74e2c3, subw 0x0, time 0, (1,1), root:(1,1),
    state 0x0, keycode 38 (keysym 0x61, a), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>



<p><a name="k07"></a></p>
<h2 id="k07">7. Kombinace několika operací</h2>

<pre>
$ <strong>xdotool windowfocus --sync 35651618 type exit</strong>
</pre>

<pre>
$ <strong>xdotool windowfocus --sync 35651618 key ctrl+m</strong>
</pre>

<pre>
$ <strong>xdotool windowfocus --sync 35651618 type exit; xdotool key ctrl+m</strong>
</pre>



<p><a name="k08"></a></p>
<h3 id="k07">8. Výběr okna pro provedení další operace</h2>

<pre>
</pre>



<p><a name="k09"></a></p>
<h2 id="k09">9. </h2>



<p><a name="k10"></a></p>
<h2 id="k10">10. </h2>



<p><a name="k11"></a></p>
<h2 id="k11">11. </h2>



<p><a name="k12"></a></p>
<h2 id="k12">12. </h2>



<p><a name="k13"></a></p>
<h2 id="k13">13. </h2>



<p><a name="k14"></a></p>
<h2 id="k14">14. </h2>



<p><a name="k15"></a></p>
<h2 id="k15">15. </h2>



<p><a name="k16"></a></p>
<h2 id="k16">16. </h2>



<p><a name="k17"></a></p>
<h2 id="k17">17. </h2>



<p><a name="k18"></a></p>
<h2 id="k18">18. </h2>



<p><a name="k19"></a></p>
<h2 id="k19">19. </h2>



<p><a name="k20"></a></p>
<h2 id="k20">20. Odkazy na Internetu</h2>

<ol>

<li>Xdotool - Keyboard<br />
<a href="https://www.linux.org/threads/xdotool-keyboard.10528/">https://www.linux.org/threads/xdotool-keyboard.10528/</a>
</li>

<li>How to Use Xdotool to Stimulate Mouse Clicks and Keystrokes in Linux<br />
<a href="https://linuxhint.com/xdotool_stimulate_mouse_clicks_and_keystrokes/">https://linuxhint.com/xdotool_stimulate_mouse_clicks_and_keystrokes/</a>
</li>

<li>xdootool.1 (manuálová stránka)<br />
<a href="http://manpages.ubuntu.com/manpages/trusty/man1/xdotool.1.html">http://manpages.ubuntu.com/manpages/trusty/man1/xdotool.1.html</a>
</li>

<li>Repositář projektu xdotool<br />
<a href="https://github.com/jordansissel/xdotool">https://github.com/jordansissel/xdotool</a>
</li>

<li>Balíček python-libxdo<br />
<a href="https://pypi.org/project/python-libxdo/">https://pypi.org/project/python-libxdo/</a>
</li>

<li>Dokumentace k&nbsp;balíčku python-libxdo<br />
<a href="https://rshk.github.io/python-libxdo/library.html">https://rshk.github.io/python-libxdo/library.html</a>
</li>

<li>Balíček PyAutoGUI<br />
<a href="https://pypi.org/project/PyAutoGUI/">https://pypi.org/project/PyAutoGUI/</a>
</li>

<li>Dokumentace ke knihovně PyAutoGUI<br />
<a href="https://pyautogui.readthedocs.io/en/latest/">https://pyautogui.readthedocs.io/en/latest/</a>
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2021</small></p>
</body>
</html>

