<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Programovací jazyky a knihovny určené pro výuku základů počítačové grafiky (5)</title>
<meta name="Author" content="Pavel Tisnovsky" />
<meta name="Generator" content="vim" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">
         body {color:#000000; background:#ffffff;}
         h1  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#c00000; text-align:center; padding-left:1em}
         h2  {font-family: arial, helvetica, sans-serif; color:#ffffff; background-color:#0000c0; padding-left:1em; text-align:left}
         h3  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#c0c0c0; padding-left:1em; text-align:left}
         h4  {font-family: arial, helvetica, sans-serif; color:#000000; background-color:#e0e0e0; padding-left:1em; text-align:left}
         a   {font-family: arial, helvetica, sans-serif;}
         li  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ol  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         ul  {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify; width:450px;}
         p   {font-family: arial, helvetica, sans-serif; color:#000000; text-align:justify;}
         pre {background:#e0e0e0}
</style>
</head>

<body>

<h1>Programovací jazyky a knihovny určené pro výuku základů počítačové grafiky (5)</h1>

<h3>Pavel Tišnovský</h3>

<p></p>

<h1>Úvodník</h1>

<p>V&nbsp;pátém článku věnovaném programovacím jazykům a taktéž knihovnám, které mohou být vhodné pro výuku programování i základů počítačové grafiky, si ukážeme, jakým způsobem je možné v&nbsp;knihovně LÖVE vytvářet zajímavé grafické efekty s&nbsp;využitím takzvaných částicových systémů.</p>



<h2>Obsah</h2>

<p><a href="#k01">1. Programovací jazyky a knihovny určené pro výuku základů počítačové grafiky (5)</a></p>
<p><a href="#k02">2. Demonstrační příklad číslo 12: změna souřadnicového systému</a></p>
<p><a href="#k03">3. Částicové systémy v&nbsp;knihovně LÖVE</a></p>
<p><a href="#k04">4. Vytvoření a vykreslení jednoduchého částicového systému</a></p>
<p><a href="#k05">5. Parametry částicového systému</a></p>
<p><a href="#k06">6. Demonstrační příklad číslo 13: jednoduchý částicový systém</a></p>
<p><a href="#k07">7. Změna základních parametrů částicového systému: gravitace, změna velikosti částic</a></p>
<p><a href="#k08">8. Demonstrační příklad číslo 14: padající globusy</a></p>
<p><a href="#k09">9. Změna vlastností emitoru částic: počáteční směr a rozptyl</a></p>
<p><a href="#k10">10. Demonstrační příklad číslo 15: ohnivý déšť</a></p>
<p><a href="#k11">11. Změna barvy a rotace emitovaných částic</a></p>
<p><a href="#k12">12. Demonstrační příklad číslo 16: výbuch</a></p>
<p><a href="#k13">13. Repositář se zdrojovými kódy dnešních demonstračních příkladů</a></p>
<p><a href="#k14">14. Odkazy na Internetu</a></p>
<p><a href="#k15">15. Literatura, v&nbsp;níž jsou zmíněny částicové systémy</a></p>



<p><a name="k01"></a></p>
<h2 id="k01">1. Programovací jazyky a knihovny určené pro výuku základů počítačové grafiky (5)</h2>

<p>V&nbsp;předchozích dvou částech [<a href="http://fedora.cz/programovaci-jazyky-a-knihovny-urcene-pro-vyuku-zakladu-pocitacove-grafiky-3/">1</a>] [<a href="http://fedora.cz/programovaci-jazyky-a-knihovny-urcene-pro-vyuku-zakladu-pocitacove-grafiky-4/">2</a>] seriálu o <a href="http://fedora.cz/stitek/programovaci-jazyk/">programovacích jazycích</a> a taktéž o knihovnách, které mohou být <a href="http://fedora.cz/stitek/vyuka/">použity pro výuku programování</a> i základů počítačové grafiky, jsme se seznámili se základem tvorby aplikací s&nbsp;využitím programovacího jazyka Lua a knihovny LÖVE. I v&nbsp;dnešní části se budeme věnovat popisu možností nabízených touto knihovnou. Nejprve si řekneme základní informace o práci se souřadnicovým systémem (i když je nutné poznamenat, že v&nbsp;případě 2D grafiky se nejedná o tak důležité téma, jako by tomu bylo u &bdquo;plnohodnotné&ldquo; prostorové grafiky) a druhá část článku bude věnována zmínce o takzvaných částicových systémech (<i>particle systems</i>), které jsou v&nbsp;knihovně LÖVE taktéž k&nbsp;dispozici a s&nbsp;jejichž využitím je možné relativně snadným způsobem vytvářet různé grafické efekty a zejména pak animace.</p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/06.png"><img class="alignnone size-medium wp-image-5581" src="http://fedora.cz/wp-content/uploads/2015/09/06.png" alt="06" width="450" height="450" /></a>
<p><i>Obrázek 1: Screenshot z&nbsp;demonstračního příkladu (změna režimu směšování barev), který jsme si popsali minule.</i></p>



<p><a name="k02"></a></p>
<h2 id="k02">2. Demonstrační příklad číslo 12: změna souřadnicového systému</h2>

<p>Minule jsme se mj.&nbsp;zabývali i problematikou vykreslování a otáčení spritů (rastrových obrázků s&nbsp;průhlednými a poloprůhlednými pixely). Připomeňme si, že pro otáčení spritů je možné ve funkci <strong>love.graphics.draw</strong> předat i úhel otočení, ovšem vlastní otáčení je implicitně prováděno okolo bodu [0,0], tj.&nbsp;střed otáčení leží v&nbsp;levém horním rohu spritu. Většinou však vyžadujeme, aby se sprite otáčel okolo svého středu a nikoli okolo rohu. Problém s&nbsp;rotací obrázků je možné řešit minimálně dvěma způsoby: změnou souřadného systému, popř.&nbsp;použitím dalších parametrů již zmíněné funkce <strong>love.graphics.draw</strong>. Toto řešení již známe, takže nám zbývá si vysvětlit, jak je možné změnit souřadný systém (a taktéž jak nastavení vrátit do výchozí podoby, což je neméně důležité). Výchozí nastavení souřadného systému je snadno pochopitelné: jeho počátek leží v&nbsp;levém horním rohu okna, x-ová souřadnice roste v&nbsp;horizontálním směru (doprava), y-ová souřadnice ve směru vertikálním (dolů). Měřítko je nastaveno tak, že jednotka odpovídá jednomu pixelu.</p>

<p>Souřadný systém je interně reprezentován <i>transformační maticí</i>, pro jejíž změnu se používají tyto funkce:</p>

<table>
<tr><th>#</th><th>Funkce</th><th>Význam</th></tr>
<tr><td>1</td><td>love.graphics.push</td><td>uložení aktuální matice na zásobník (aby se dalo obnovit předchozí nastavení)</td></tr>
<tr><td>2</td><td>love.graphics.pop</td><td>obnovení předchozího nastavení ze zásobníku</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>3</td><td>love.graphics.rotate</td><td>rotace o zadaný úhel (v&nbsp;radiánech)</td></tr>
<tr><td>4</td><td>love.graphics.scale</td><td>změna měřítka (lze nastavit nezávisle v&nbsp;obou směrech)</td></tr>
<tr><td>5</td><td>love.graphics.translate</td><td>posun</td></tr>
</table>

<p>Manipulace se souřadným systémem je v&nbsp;demonstračním příkladu realizována ve funkci <strong>drawSprite</strong>, jejíž nová podoba vypadá následovně:</p>

<pre>
<i>--</i>
<i>-- Vykreslení spritu s jeho otočením.</i>
<i>--</i>
<strong>function</strong> drawSprite(sprite)
    <i>-- uložení transformační matice</i>
    love.graphics.push()
    <i>-- zajištění posunu a rotace</i>
    love.graphics.translate(sprite.x, sprite.y)
    love.graphics.translate(sprite.image:getWidth()/2, sprite.image:getHeight()/2)
    love.graphics.rotate(sprite.r)
    love.graphics.translate(-sprite.image:getWidth()/2, -sprite.image:getHeight()/2)
    <i>-- vykreslení spritu</i>
    love.graphics.draw(sprite.image, 0, 0)
    <i>-- obnovení původní transformační matice</i>
    love.graphics.pop()
<strong>end</strong>
</pre>

<p>V&nbsp;této funkci došlo k&nbsp;několika dílčím transformacím, které se postupně skládají (a to jakoby odzadu, protože nemanipulujeme se spritem, ale s&nbsp;plochou, na kterou se vykresluje):</p>

<ul>
<li>Na začátku leží <strong>levý horní roh spritu</strong> na souřadnicích [0,0]</li>
<li>Posun počátku na střed otáčení (nyní je <strong>střed spritu</strong> na souřadnicích [0,0])</li>
<li>Otočení (okolo počátku, tedy okolo středu spritu)</li>
<li>Posun zpět</li>
<li>Posun celého systému tak, aby se sprite vykreslil na pozici [sprite.x, sprite.y]</li>
</ul>

<a href="http://fedora.cz/wp-content/uploads/2015/09/02.jpg"><img class="alignnone size-full wp-image-5660" src="http://fedora.cz/wp-content/uploads/2015/09/02.jpg" alt="02" width="320" height="130" /></a>
<p><i>Obrázek 2: Scéna vykreslená demonstračním příkladem.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/03.jpg"><img class="alignnone size-medium wp-image-5661" src="http://fedora.cz/wp-content/uploads/2015/09/03.jpg" alt="03" width="320" height="130" /></a>
<p><i>Obrázek 3: Otočení spritů po uplynutí určitého časového úseku.</i></p>

<p>Úplný zdrojový kód tohoto demonstračního příkladu vypadá následovně:</p>

<pre>
<i>--</i>
<i>-- Knihovna LÖVE</i>
<i>--</i>
<i>-- Dvanáctý demonstrační příklad</i>
<i>--</i>
<i>-- Práce se sprity: zobrazení, otočení změnou souřadnicového systému.</i>
<i>--</i>
&nbsp;
&nbsp;
&nbsp;
<i>-- rozměry okna</i>
width = 450
height = 450
&nbsp;
&nbsp;
&nbsp;
<i>-- objekty představující sprity zobrazené v okně</i>
<strong>local</strong> sprite1 = {x=100, y=100, r=0, dr=-0.17}
<strong>local</strong> sprite2 = {x=185, y=80,  r=0, dr=0.1}
<strong>local</strong> sprite3 = {x=300, y=100, r=0, dr=0.05}
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná při inicializaci aplikace.</i>
<i>--</i>
<strong>function</strong> love.load()
    <i>-- načtení standardního fontu a nastavení grafického režimu</i>
    <strong>local</strong> font = love.graphics.newFont(love.default_font, 40)
    <i>-- načtení spritů</i>
    sprite1.image = love.graphics.newImage("sprite2.png")
    sprite2.image = love.graphics.newImage("sprite1.png")
    sprite3.image = love.graphics.newImage("sprite2.png")
    love.graphics.setMode(width, height, false, false, 0)
    <i>-- nastavení fontu</i>
    love.graphics.setFont(font)
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Vykreslení spritu s jeho otočením.</i>
<i>--</i>
<strong>function</strong> drawSprite(sprite)
    <i>-- uložení transformační matice</i>
    love.graphics.push()
    <i>-- zajištění posunu a rotace</i>
    love.graphics.translate(sprite.x, sprite.y)
    love.graphics.translate(sprite.image:getWidth()/2, sprite.image:getHeight()/2)
    love.graphics.rotate(sprite.r)
    love.graphics.translate(-sprite.image:getWidth()/2, -sprite.image:getHeight()/2)
    <i>-- vykreslení spritu</i>
    love.graphics.draw(sprite.image, 0, 0)
    <i>-- obnovení původní transformační matice</i>
    love.graphics.pop()
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Tato funkce je volána automaticky při překreslení obsahu</i>
<i>-- okna či obrazovky.</i>
<i>--</i>
<strong>function</strong> love.draw()
    <i>-- vykreslení prvního spritu přes ostatní sprity</i>
    drawSprite(sprite1)
    <i>-- vykreslení druhého spritu přes ostatní sprity</i>
    drawSprite(sprite2)
    <i>-- vykreslení třetího spritu přes ostatní sprity</i>
    drawSprite(sprite3)
&nbsp;
    love.graphics.print("Press escape to exit.", 30, 433)
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Změna rotace spritů v okně</i>
<i>--</i>
<strong>function</strong> updateSpriteAngle(sprite)
    sprite.r = sprite.r + sprite.dr
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná cca 30x za sekundu</i>
<i>--</i>
<strong>function</strong> love.update(dt)
    updateSpriteAngle(sprite1)
    updateSpriteAngle(sprite2)
    updateSpriteAngle(sprite3)
    <strong>local</strong> delay = 1/30
    <strong>if</strong> dt &lt; delay <strong>then</strong>
        love.timer.sleep(delay - dt)
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Callback funkce zavolaná při stisku klávesy.</i>
<i>--</i>
<strong>function</strong> love.keypressed(k)
    <strong>if</strong> k == 'escape' <strong>then</strong>
        love.event.quit()
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- finito</i>
<i>--</i>
</pre>



<p><a name="k03"></a></p>
<h2 id="k03">3. Částicové systémy v&nbsp;knihovně LÖVE</h2>

<p>V&nbsp;knihovně LÖVE nalezneme podporu i pro takzvané <i>částicové systémy</i> (někdy taktéž nazývané systémy částic, anglicky <i>particle systems</i>). Ty pro relativně velké množství aplikací představují velice silnou modelovací a současně i animační techniku určenou pro vytváření takových objektů, které není možné jednoduše reprezentovat svým povrchem nebo objemem. Jedná se například o&nbsp;objekty představující přírodní fenomény jakými jsou sníh, déšť, oheň, mlha, dým nebo tekoucí voda. Velikou předností částicových systémů je fakt, že se s&nbsp;jejich využitím dají jednoduše vytvářet animace. Při použití klasických modelovacích metod se při animování musí použít složitější techniky, například animační křivky, morfing, přímá kinematika nebo inverzní kinematika, což klade zvýšené požadavky jak na vlastní animační systém, tak i na znalosti a schopnosti uživatele obsluhujícího tento systém (i to je však v&nbsp;knihovně LÖVE alespoň částečně podporováno).</p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/04.jpg"><img class="alignnone size-medium wp-image-5662" src="http://fedora.cz/wp-content/uploads/2015/09/04.jpg" alt="04" width="400" height="300" /></a>
<p><i>Obrázek 4: Výbuch vytvořený pomocí částicových systémů. Rendering tohoto obrázku byl proveden v&nbsp;programu POVRay.</i></p>

<p>U&nbsp;částicových systémů se při animaci nemusí pracně zadávat jednotlivé polohy částic v&nbsp;čase, ale je možné jednoduše zadat počáteční polohu a rychlost částic (vlastnosti takzvaného <i>emitoru</i>) a poté nechat proběhnout simulaci, ve které se automaticky, podle zadaných fyzikálních vlastností, vypočítají nové polohy částic. Právě z&nbsp;tohoto důvodu jsou částicové systémy oblíbené například mezi tvůrci her. Celý částicový systém je modelován jako soubor určitých základních prvků &ndash;<i>částic</i> (particle)&ndash; jejichž vlastnosti se průběžně mění v&nbsp;čase. Mezi základní vlastnosti částice patří zejména:</p>

<ul>
<li>Poloha částice v&nbsp;rovině či prostoru (v&nbsp;případě knihovny LÖVE v&nbsp;rovině)</li>
<li>Vektor rychlosti částice (počítá se automaticky)</li>
<li>Zrychlení částice</li>
<li>Hmotnost částice</li>
</ul>

<p>K&nbsp;těmto základním vlastnostem většinou přidáváme i&nbsp;vizuální vlastnosti, například:</p>

<ul>
<li>Velikost částice a změna velikosti v&nbsp;čase</li>
<li>Tvar a způsob vykreslení částice (v&nbsp;knihovně LÖVE se jedná o sprite)</li>
<li>Barva částice</li>
<li>Obrázek představující částici</li>
<li>Průhlednost částice a změna průhlednosti v čase</li>
</ul>

<a href="http://fedora.cz/wp-content/uploads/2015/09/05.jpg"><img class="alignnone size-medium wp-image-5663" src="http://fedora.cz/wp-content/uploads/2015/09/05.jpg" alt="05" width="400" height="300" /></a>
<p><i>Obrázek 5: Částicové systémy lze použít i při simulaci tekoucí vody. Rendering tohoto obrázku byl opět proveden v&nbsp;programu POVRay. Výpočet tekoucí vody sice není přesný (voda je reprezentována množstvím jednodušších těles), nicméně po účely počítačové grafiky je přesnost dostačující.</i></p>

<p>Z&nbsp;důvodu vytváření a provádění animací se zavádí také vlastnost nazvaná &bdquo;doba života částice&ldquo;. Při simulacích se po uplynutí doby života částice může částice zrušit nebo se na místě zániku částice mohou generovat další částice (rozpad částice). U&nbsp;složitějších částicových systémů lze reagovat i na vzájemné střety částic nebo interakci částic se svým okolím, tj.&nbsp;s&nbsp;tělesy, které se ve scéně nachází (tyto vlastnosti jsou v&nbsp;systému <i>LÖVE</i> podporovány jen v&nbsp;omezeném rozsahu, zabývat se jimi budeme až příště).</p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/06.jpg"><img class="alignnone size-medium wp-image-5664" src="http://fedora.cz/wp-content/uploads/2015/09/06.jpg" alt="06" width="256" height="256" /></a>
<p><i>Obrázek 6: Poměrně jednoduchý dvoudimenzionální částicový systém, kde je každá částice reprezentována jediným pixelem.</i></p>



<p><a name="k04"></a></p>
<h2 id="k04">4. Vytvoření a vykreslení jednoduchého částicového systému</h2>

<p>V&nbsp;knihovně LÖVE jsou částicové systémy (v&nbsp;jednom okamžiku jich totiž může existovat větší množství) představovány objektem nazvaným <strong>ParticleSystem</strong>. Částicový systém lze vytvořit pomocí funkce (konstruktoru) <strong>love.graphics.newParticleSystem(image, buffer)</strong>, která má dva parametry &ndash; obrázek, pomocí něhož se vykreslují jednotlivé částice (typicky načtený z&nbsp;externího souboru) a numerickou hodnotu, kterou je možné omezit maximální celkový počet částic v&nbsp;částicovém systému. V&nbsp;závislosti na konfiguraci se totiž může počet částic v&nbsp;různých časových okamžicích lišit; na začátku &bdquo;života&ldquo; systému typicky ještě neexistují žádné částice.</p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/07.jpg"><img class="alignnone size-medium wp-image-5665" src="http://fedora.cz/wp-content/uploads/2015/09/07-450x338.jpg" alt="07" width="450" height="338" /></a>
<p><i>Obrázek 7: Velmi jednoduchý částicový systém vykreslený pomocí systému LÖVE. Vizuální podoba částic je uložena v&nbsp;rastrovém obrázku, na rozdíl od systému zobrazeného na obrázku číslo 7.</i></p>

<p>Po vytvoření částicového systému a nastavení jeho parametrů (viz též <a href="#k05">následující kapitolu</a>) lze částicový systém vykreslit do libovolného místa obrazovky (okna) pomocí přetížené funkce <strong>love.graphics.draw(particlesystem, x, y)</strong>, které se předává jak objekt představující částicový systém, tak i souřadnice na obrazovce, ve kterých se má nacházet střed částicového systému. Ovšem již z&nbsp;předchozího dílu víme, že tato funkce má i další volitelné parametry, například otáčení či změnu velikosti. Systém <i>LÖVE</i> neobsahuje žádné další funkce, které by pracovaly s&nbsp;objektem částicového systému, veškeré nastavení jeho parametrů se provádí přímo voláním jeho metod, které jsou popsány v&nbsp;navazující kapitole.</p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/08.jpg"><img class="alignnone size-medium wp-image-5666" src="http://fedora.cz/wp-content/uploads/2015/09/08-450x338.jpg" alt="08" width="450" height="338" /></a>
<p><i>Obrázek 8: Další částicový systém vykreslený pomocí systému LÖVE. Na částice sice nepůsobí gravitační síla, ale jejich radiální zrychlení je záporné, tj.&nbsp;částice jsou přitahovány zpět ke středu částicového systému.</i></p>



<p><a name="k05"></a></p>
<h2 id="k05">5. Parametry částicového systému</h2>

<p>Po vytvoření částicového systému výše popsanou funkcí <strong>love.graphics.newParticleSystem()</strong> je možné parametry částicového systému takřka libovolně měnit, spouštět či naopak zastavovat simulaci pohybu částic atd. V&nbsp;následující tabulce jsou vypsány některé vybrané metody ovlivňující parametry částicového systému &ndash; jedná se o metody použité v&nbsp;následujícím demonstračním příkladu:</p>

<table>
<tr><th>#</th><th>Metoda</th><th>Význam</th></tr>
<tr><td>1</td><td>setEmmisionRate()</td><td>Počet částic, které mají být vytvořeny (emitovány) za jednu sekundu. Skutečný počet emitovaných částic však může být nižší, v&nbsp;závislosti na jejich životnosti a maximálním povoleném počtu částic v&nbsp;systému.</td></tr>
<tr><td>2</td><td>setLifetime()</td><td>Životnost celého systému částic. Pokud je překročena doba života částicového systému, přestane emitor vytvářet další částice. Lze nastavit i hodnotu -1, která znamená neomezenou dobu života částicového systému.</td></tr>
<tr><td>3</td><td>setParticleLife()</td><td>Nastavení průměrné či minimální a maximální doby života částic. Buď je zadán pouze jeden údaj, který je chápán jako průměrná doba života částice v&nbsp;sekundách, nebo údaje dva &ndash; minimální a maximální doba, opět specifikovaná v&nbsp;sekundách.</td></tr>
<tr><td>4</td><td>setPosition()</td><td>Specifikace souřadnic emitoru částic v&nbsp;rovině.</td></tr>
<tr><td>5</td><td>setDirection()</td><td>Nastavení průměrné hodnoty úhlu, pod kterým částice vyletují ze svého zdroje (emitoru). Tento parametr má smysl nastavovat pouze v&nbsp;případě, že je rozptyl menší než 360&deg;.</td></tr>
<tr><td>6</td><td>setSpread()</td><td>Nastavení rozptylu vyletujících částic. Standardně je nastaven rozptyl 360&deg;, tj.&nbsp;částice jsou emitovány do všech směrů.</td></tr>
<tr><td>7</td><td>setSpeed()</td><td>Zadání průměrné, popř.&nbsp;minimální a maximální počáteční rychlosti částic.</td></tr>
<tr><td>8</td><td>setSizes()</td><td>Nastavení relativní velikosti částice popř.&nbsp;její počáteční a koncové velikosti. Částice může v&nbsp;průběhu svého života měnit velikost &ndash; růst či se naopak zmenšovat. Hodnota 1 značí původní velikost rastrového obrázku s&nbsp;předlohou částice, 2 dvojnásobnou velikost atd.</td></tr>
<tr><td>9</td><td>start()</td><td>Zapnutí emitoru částic. Po zavolání této metody vytváří emitor nové částice až do chvíle, než je zavolána metoda stop(), pause() či až do konce života částicového systému nastaveného metodou setLifetime().</td></tr>
<tr><td>10</td><td>stop()</td><td>Vypnutí emitoru částic a vymazání interního časovače, pomocí kterého se testuje, zda již není překročena doba života částicového systému.</td></tr>
<tr><td>11</td><td>update()</td><td>Po zavolání této metody se provede změna stavu částicového systému na základě jeho parametrů, tj.&nbsp;dojde k&nbsp;vytvoření (emitaci) nových částic, ke zrušení částic, které překročily dobu svého života i ke změně dalších parametrů částic (polohy, rychlosti, barvy, tvaru, natočení atd.). Tuto metodu je zapotřebí volat průběžně, ideálně z&nbsp;callback funkce <strong>draw()</strong> či <strong>update()</strong>.</td></tr>
</table>

<a href="http://fedora.cz/wp-content/uploads/2015/09/09.jpg"><img class="alignnone size-medium wp-image-5667" src="http://fedora.cz/wp-content/uploads/2015/09/09.jpg" alt="09" width="419" height="395" /></a>
<p><i>Obrázek 9: Částicové systémy je možné použít i pro vizualizaci různých fyzikálních simulací.</i></p>



<p><a name="k06"></a></p>
<h2 id="k06">6. Demonstrační příklad číslo 13: jednoduchý částicový systém</h2>

<p>Metody objektu typu <strong>ParticleSystem</strong>, o nichž jsme se zmínili <a href="#k05">v&nbsp;předchozí kapitole</a>, jsou použity v&nbsp;dalším demonstračním příkladu. Po spuštění tohoto příkladu je částicový systém vytvořen a následně jsou nastaveny jeho základní parametry. Následně aplikace čeká na stisk klávesy [Enter], která slouží pro &bdquo;nastartování&ldquo; částicového systému. Změna stavu částicového systému (vytvoření částic, zrušení starých částic, změna jejich polohy atd.) je provedena přibližně třicetkrát za sekundu v&nbsp;callback funkci <strong>love.update</strong>. Po stisku klávesy [Esc] se celá aplikace ukončí a zavře se její hlavní okno. Samotný částicový systém je představován emitorem umístěným ve středu obrazovky, z&nbsp;něhož vyletují částice na všechny strany (se stejnou pravděpodobností). Každá částice je představována obrázkem (spritem) globusu, který jsme využili i v&nbsp;demonstračních příkladech popsaných v&nbsp;předchozí části tohoto seriálu.</p>

<p>Podívejme se nyní na zdrojový kód tohoto demonstračního příkladu:</p>

<pre>
<i>--</i>
<i>-- Knihovna LÖVE</i>
<i>--</i>
<i>-- Třináctý demonstrační příklad</i>
<i>--</i>
<i>-- Použití jednoduchého částicového systému.</i>
<i>--</i>
&nbsp;
&nbsp;
<i>-- rozměry okna, do něhož se bude provádět vykreslování</i>
width = 450
height = 450
&nbsp;
<i>-- asociativní pole představující částicový systém</i>
<strong>local</strong> particleSystem = nil
&nbsp;
<i>-- maximální počet částic v částicovém systému</i>
particleCount = 1000
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná při inicializaci aplikace.</i>
<i>--</i>
<strong>function</strong> love.load()
    <i>-- načtení standardního fontu a nastavení grafického režimu</i>
    <strong>local</strong> font = love.graphics.newFont(love.default_font, 40)
&nbsp;
    <i>-- inicializace grafického režimu</i>
    love.graphics.setMode(width, height, false, false, 0)
&nbsp;
    <i>-- nastavení fontu</i>
    love.graphics.setFont(font)
&nbsp;
    <i>-- načtení obrázku představujícího jednu částici</i>
    <strong>local</strong> particleImage = love.graphics.newImage("sprite1.png")
&nbsp;
    <i>-- vytvoření částicového systému s jeho inicializací</i>
    particleSystem = love.graphics.newParticleSystem(particleImage, particleCount)
&nbsp;
    <i>-- kolik nových částic se průměrně vygeneruje za sekundu</i>
    particleSystem:setEmissionRate(4)
&nbsp;
    <i>-- životnost emitoru částic i jednotlivých částic vytvářených v emitoru</i>
    particleSystem:setLifetime(-1)
    particleSystem:setParticleLife(5)
&nbsp;
    <i>-- pozice emitoru na obrazovce</i>
    particleSystem:setPosition(width/2, height/2)
&nbsp;
    <i>-- počáteční rychlost částic</i>
    particleSystem:setSpeed(70, 100)
    particleSystem:setDirection(0)
    particleSystem:setSpread(360)
&nbsp;
    <i>-- další parametry systému</i>
    particleSystem:setSizes(1)
    particleSystem:stop()
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná cca 30x za sekundu</i>
<i>--</i>
<strong>function</strong> love.update(dt)
    <i>-- přepočítat parametry částicového systému</i>
    particleSystem:update(dt)
&nbsp;
    <strong>local</strong> delay = 1/30
    <strong>if</strong> dt &lt; delay <strong>then</strong>
        love.timer.sleep(delay - dt)
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Tato funkce je volána automaticky při překreslení obsahu</i>
<i>-- okna či obrazovky.</i>
<i>--</i>
<strong>function</strong> love.draw()
    <i>-- režim vykreslování</i>
    love.graphics.setBlendMode("alpha")
&nbsp;
    <i>-- vykreslení částicového systému na obrazovku</i>
    love.graphics.draw(particleSystem, 0, 0)
&nbsp;
    <i>-- zprávy vypsané na obrazovky</i>
    love.graphics.print("Press Enter to start particle emitter.", 30, 415)
    love.graphics.print("Press Escape to exit.", 30, 433)
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Callback funkce zavolaná při stisku klávesy.</i>
<i>--</i>
<strong>function</strong> love.keypressed(k)
    <i>-- klávesou "Return" či "Enter" se částicový systém zapne</i>
    <strong>if</strong> k == 'return' <strong>then</strong>
        particleSystem:start()
    <strong>end</strong>
    <i>-- klávesou "Escape" se aplikace ukončí</i>
    <strong>if</strong> k == 'escape' <strong>then</strong>
        love.event.quit()
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- finito</i>
<i>--</i>
</pre>

<a href="http://fedora.cz/wp-content/uploads/2015/09/10.jpg"><img class="alignnone size-medium wp-image-5668" src="http://fedora.cz/wp-content/uploads/2015/09/10.jpg" alt="10" width="450" height="450" /></a>
<p><i>Obrázek 10: Emitor částic je zastaven.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/11.jpg"><img class="alignnone size-medium wp-image-5669" src="http://fedora.cz/wp-content/uploads/2015/09/11.jpg" alt="11" width="450" height="450" /></a>
<p><i>Obrázek 11: Začátek emitování částic.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/12.jpg"><img class="alignnone size-medium wp-image-5670" src="http://fedora.cz/wp-content/uploads/2015/09/12.jpg" alt="12" width="450" height="450" /></a>
<p><i>Obrázek 12: Další stav částicového systému.</i></p>



<p><a name="k07"></a></p>
<h2 id="k07">7. Změna základních parametrů částicového systému: gravitace, změna velikosti částic</h2>

<p>V&nbsp;předchozím demonstračním příkladu byl emitor částic umístěn do středu obrazovky a částice z&nbsp;něj vylétaly ve všech směrech. Navíc na částice ani nepůsobila gravitace. Tento demonstrační příklad je samozřejmě možné upravit, a to hned několika způsoby. Asi největší změnou, která je po spuštění animace ihned viditelná, je nastavení gravitace, která má na částice působit. Vektor gravitační síly je orientován kolmo dolů a jeho velikost je určena metodou <strong>particleSystem:setGravity(min)</strong> popř.&nbsp;<strong>particleSystem:setGravity(min, max)</strong>. Další ihned viditelnou změnou je nastavení proměnné velikosti částic metodou <strong>particleSystem:setSizes(size1, size2, ...size8)</strong>. Tato metoda je v&nbsp;příkladu volána se dvěma parametry představujícími počáteční a koncovou relativní velikost částic, kde hodnota 1 znamená původní velikost spritu a hodnota (například) 0.25 čtvrtinovou velikost spritu v&nbsp;porovnání s&nbsp;původní velikostí. Ve skutečnosti je však možné metodě <strong>particleSystem:setSizes()</strong> předat až osm relativních velikostí a vytvořit tak relativně složitý částicový systém.</p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/13.jpg"><img class="alignnone size-medium wp-image-5671" src="http://fedora.cz/wp-content/uploads/2015/09/13.jpg" alt="13" width="450" height="450" /></a>
<p><i>Obrázek 13: Čtrnáctý demonstrační příklad: počáteční stav.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/14.jpg"><img class="alignnone size-medium wp-image-5672" src="http://fedora.cz/wp-content/uploads/2015/09/14.jpg" alt="14" width="450" height="450" /></a>
<p><i>Obrázek 14: Čtrnáctý demonstrační příklad krátce po svém spuštění.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/15.jpg"><img class="alignnone size-medium wp-image-5673" src="http://fedora.cz/wp-content/uploads/2015/09/15.jpg" alt="15" width="450" height="450" /></a>
<p><i>Obrázek 15: Další stav částicového systému.</i></p>



<p><a name="k08"></a></p>
<h2 id="k08">8. Demonstrační příklad číslo 14: padající globusy</h2>

<p>Změny, které byly popsány <a href="#k07">v&nbsp;sedmé kapitole</a>, jsou součástí následujícího demonstračního příkladu, jenž po svém spuštění a stisku klávesy [Enter] zobrazí padající globusy. Toto chování je zajištěno jednoduchým způsobem &ndash; emitor částic totiž není umístěn v&nbsp;oblasti okna aplikace, ale nad tímto oknem, takže není vidět místo, v&nbsp;němž částice vznikají. Navíc mají částice díky vysoko umístěnému emitoru dostatek času na to, aby na ně začala působit gravitace, takže vzniká efekt patrný na obrázcích 14 a 15. Následuje výpis zdrojového kódu demonstračního příkladu:</p>

<pre>
<i>--</i>
<i>-- Knihovna LÖVE</i>
<i>--</i>
<i>-- Čtrnáctý demonstrační příklad</i>
<i>--</i>
<i>-- Použití jednoduchého částicového systému na nějž působí gravitace.</i>
<i>--</i>
&nbsp;
&nbsp;
<i>-- rozměry okna, do něhož se bude provádět vykreslování</i>
width = 450
height = 450
&nbsp;
<i>-- asociativní pole představující částicový systém</i>
<strong>local</strong> particleSystem = nil
&nbsp;
<i>-- maximální počet částic v částicovém systému</i>
particleCount = 1000
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná při inicializaci aplikace.</i>
<i>--</i>
<strong>function</strong> love.load()
    <i>-- načtení standardního fontu a nastavení grafického režimu</i>
    <strong>local</strong> font = love.graphics.newFont(love.default_font, 40)
&nbsp;
    <i>-- inicializace grafického režimu</i>
    love.graphics.setMode(width, height, false, false, 0)
&nbsp;
    <i>-- nastavení fontu</i>
    love.graphics.setFont(font)
&nbsp;
    <i>-- načtení obrázku představujícího jednu částici</i>
    <strong>local</strong> particleImage = love.graphics.newImage("sprite1.png")
&nbsp;
    <i>-- vytvoření částicového systému s jeho inicializací</i>
    particleSystem = love.graphics.newParticleSystem(particleImage, particleCount)
&nbsp;
    <i>-- kolik nových částic se průměrně vygeneruje za sekundu</i>
    particleSystem:setEmissionRate(10)
&nbsp;
    <i>-- životnost emitoru částic i jednotlivých částic vytvářených v emitoru</i>
    particleSystem:setLifetime(-1)
    particleSystem:setParticleLife(5)
&nbsp;
    <i>-- pozice emitoru na obrazovce (mimo obrazovku)</i>
    particleSystem:setPosition(width/2, -50)
&nbsp;
    <i>-- počáteční rychlost částic</i>
    particleSystem:setSpeed(70, 100)
    particleSystem:setDirection(0)
    particleSystem:setSpread(360)
&nbsp;
    <i>-- další parametry systému: gravitace působící na částice</i>
    particleSystem:setGravity(100, 200)
    <i>-- velikost částic a relativní změna velikosti v čase</i>
    particleSystem:setSizes(1, 0.3)
    particleSystem:stop()
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná cca 30x za sekundu</i>
<i>--</i>
<strong>function</strong> love.update(dt)
    <i>-- přepočítat parametry částicového systému</i>
    particleSystem:update(dt)
&nbsp;
    <strong>local</strong> delay = 1/30
    <strong>if</strong> dt &lt; delay <strong>then</strong>
        love.timer.sleep(delay - dt)
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Tato funkce je volána automaticky při překreslení obsahu</i>
<i>-- okna či obrazovky.</i>
<i>--</i>
<strong>function</strong> love.draw()
    <i>-- režim vykreslování</i>
    love.graphics.setBlendMode("alpha")
&nbsp;
    <i>-- vykreslení částicového systému na obrazovku</i>
    love.graphics.draw(particleSystem, 0, 0)
&nbsp;
    <i>-- zprávy vypsané na obrazovky</i>
    love.graphics.print("Press Enter to start particle emitter.", 30, 415)
    love.graphics.print("Press Escape to exit.", 30, 433)
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Callback funkce zavolaná při stisku klávesy.</i>
<i>--</i>
<strong>function</strong> love.keypressed(k)
    <i>-- klávesou "Return" či "Enter" se částicový systém zapne</i>
    <strong>if</strong> k == 'return' <strong>then</strong>
        particleSystem:start()
    <strong>end</strong>
    <i>-- klávesou "Escape" se aplikace ukončí</i>
    <strong>if</strong> k == 'escape' <strong>then</strong>
        love.event.quit()
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- finito</i>
<i>--</i>
</pre>



<p><a name="k09"></a></p>
<h2 id="k09">9. Změna vlastností emitoru částic: počáteční směr a rozptyl</h2>

<p>Připomeňme si, že nejdůležitějšími vlastnostmi emitoru částic je jeho poloha v&nbsp;ploše a dále pak směr &bdquo;vystřelování&ldquo; nových částic. Poloha emitoru je určena jednoduše s&nbsp;využitím metody <strong>particleSystem:setPosition(x,y)</strong>, což jsme si již ostatně ukázali na dvou příkladech. Směr vystřelování nových částic je určen metodami <strong>particleSystem:setDirection(úhel)</strong> a <strong>particleSystem:setSpread(úhel)</strong>. Zatímco úhel předaný první z&nbsp;těchto metod reprezentuje směr, kterým je emitor obrácen (resp.&nbsp;přesněji řečeno směr jeho osy), tak úhel předaný druhé metodě reprezentuje rozptyl částic. Emitor částic si totiž můžeme představit jako reflektor, který můžeme libovolně natáčet a navíc můžeme měnit i rozptyl paprsku, a to od 0&deg; do celých 360&deg; (jen si musíme dát pozor na to, že velikosti všech úhlů se musí zadávat nikoli ve stupních, ale v&nbsp;radiánech).</p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/16.jpg"><img class="alignnone size-medium wp-image-5674" src="http://fedora.cz/wp-content/uploads/2015/09/16.jpg" alt="16" width="450" height="450" /></a>
<p><i>Obrázek 16: Patnáctý demonstrační příklad: počáteční stav.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/17.jpg"><img class="alignnone size-medium wp-image-5675" src="http://fedora.cz/wp-content/uploads/2015/09/17.jpg" alt="17" width="450" height="450" /></a>
<p><i>Obrázek 17: Patnáctý demonstrační příklad krátce po svém spuštění.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/18.jpg"><img class="alignnone size-medium wp-image-5676" src="http://fedora.cz/wp-content/uploads/2015/09/18.jpg" alt="18" width="450" height="450" /></a>
<p><i>Obrázek 18: Další stav částicového systému.</i></p>



<p><a name="k10"></a></p>
<h2 id="k10">10. Demonstrační příklad číslo 15: ohnivý déšť</h2>

<p>Změna směru emitování nových částic i rozptylu těchto částic je použita v&nbsp;patnáctém demonstračním příkladu pro vytvoření iluze ohnivého deště. Emitor je umístěn na plochu okna, takže uživatelé mohou vidět místo, kde částice vznikají, Namísto obrázku (spritu) globusu je zde použit poněkud odlišný obrázek, jehož pixely mají rozdílnou průhlednost, což díky nastavení míchacího režimu (<i>blend mode</i>) vede k&nbsp;tomu, že se intenzity barev jednotlivých částic slévají. Podívejme se na zdrojový kód tohoto (dnes již předposledního) příkladu:</p>

<pre>
<i>--</i>
<i>-- Knihovna LÖVE</i>
<i>--</i>
<i>-- Patnáctý demonstrační příklad</i>
<i>--</i>
<i>-- Použití jednoduchého částicového systému.</i>
<i>--</i>
&nbsp;
&nbsp;
<i>-- rozměry okna, do něhož se bude provádět vykreslování</i>
width = 450
height = 450
&nbsp;
<i>-- asociativní pole představující částicový systém</i>
<strong>local</strong> particleSystem = nil
&nbsp;
<i>-- maximální počet částic v částicovém systému</i>
particleCount = 1000
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná při inicializaci aplikace.</i>
<i>--</i>
<strong>function</strong> love.load()
    <i>-- načtení standardního fontu a nastavení grafického režimu</i>
    <strong>local</strong> font = love.graphics.newFont(love.default_font, 40)
&nbsp;
    <i>-- inicializace grafického režimu</i>
    love.graphics.setMode(width, height, false, false, 0)
&nbsp;
    <i>-- nastavení fontu</i>
    love.graphics.setFont(font)
&nbsp;
    <i>-- načtení obrázku představujícího jednu částici</i>
    <strong>local</strong> particleImage = love.graphics.newImage("particle.png")
&nbsp;
    <i>-- vytvoření částicového systému s jeho inicializací</i>
    particleSystem = love.graphics.newParticleSystem(particleImage, particleCount)
&nbsp;
    <i>-- kolik nových částic se průměrně vygeneruje za sekundu</i>
    particleSystem:setEmissionRate(100)
&nbsp;
    <i>-- životnost emitoru částic i jednotlivých částic vytvářených v emitoru</i>
    particleSystem:setLifetime(-1)
    particleSystem:setParticleLife(3)
&nbsp;
    <i>-- počáteční rychlost částic</i>
    particleSystem:setSpeed(100, 400)
&nbsp;
    <i>-- další parametry systému: gravitace působící na částice, změna barvy apod.</i>
    particleSystem:setGravity(200,500)
    particleSystem:setColors(255, 255, 0, 255, 255, 0, 0, 255)
&nbsp;
    <i>-- pozice emitoru částic, směr generování částic a rozptyl</i>
    particleSystem:setPosition(width/2, 50)
    particleSystem:setDirection(3.14/2)
    particleSystem:setSpread(0.3)
&nbsp;
    <i>-- další parametry systému: gravitace působící na částice</i>
    particleSystem:setGravity(100, 200)
    <i>-- velikost částic a relativní změna velikosti v čase</i>
    particleSystem:setSizes(1, 0.3)
    particleSystem:stop()
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná cca 30x za sekundu</i>
<i>--</i>
<strong>function</strong> love.update(dt)
    <i>-- přepočítat parametry částicového systému</i>
    particleSystem:update(dt)
&nbsp;
    <strong>local</strong> delay = 1/30
    <strong>if</strong> dt &lt; delay <strong>then</strong>
        love.timer.sleep(delay - dt)
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Tato funkce je volána automaticky při překreslení obsahu</i>
<i>-- okna či obrazovky.</i>
<i>--</i>
<strong>function</strong> love.draw()
    <i>-- režim vykreslování</i>
    love.graphics.setBlendMode("alpha")
&nbsp;
    <i>-- vykreslení částicového systému na obrazovku</i>
    love.graphics.draw(particleSystem, 0, 0)
&nbsp;
    <i>-- zprávy vypsané na obrazovky</i>
    love.graphics.print("Press Enter to start particle emitter.", 30, 415)
    love.graphics.print("Press Escape to exit.", 30, 433)
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Callback funkce zavolaná při stisku klávesy.</i>
<i>--</i>
<strong>function</strong> love.keypressed(k)
    <i>-- klávesou "Return" či "Enter" se částicový systém zapne</i>
    <strong>if</strong> k == 'return' <strong>then</strong>
        particleSystem:start()
    <strong>end</strong>
    <i>-- klávesou "Escape" se aplikace ukončí</i>
    <strong>if</strong> k == 'escape' <strong>then</strong>
        love.event.quit()
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- finito</i>
<i>--</i>
</pre>



<p><a name="k11"></a></p>
<h2 id="k11">11. Změna barvy a rotace emitovaných částic</h2>

<p>Dalším důležitým parametrem částicového systému je barva částic, která může být &ndash; podobně jako jejich velikost &ndash; v&nbsp;čase proměnná. Nastavení barvy se provádí metodou <strong>particleSystem:setColors( r1, g1, b1, a1, r2, g2, b2, a2, ..., r8, g8, b8, a8 )</strong>. Jak je z&nbsp;hlavičky této funkce patrné, lze jí předat až osm barev, resp.&nbsp;přesněji řečeno osm trojic představujících barvové složky červená+zelená+modrá a průhlednost aplikovanou na všechny pixely. Posledním parametrem částicového systému, o němž se dnes zmíníme, je rotace částic (neboli <i>spin</i>), který lze zadat metodou <strong>particleSystem:setSpin()</strong>. Předávaný parametr udává úhel rotace částice (v&nbsp;radiánech) za sekundu; tj.&nbsp;čím vyšší hodnota je předána, tím rychleji částice rotují. Oba tyto parametry jsou použity v&nbsp;dnešním posledním příkladu, který po svém spuštění vytvoří tuto animaci:</p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/19.jpg"><img class="alignnone size-medium wp-image-5677" src="http://fedora.cz/wp-content/uploads/2015/09/19.jpg" alt="19" width="450" height="450" /></a>
<p><i>Obrázek 19: Šestnáctý demonstrační příklad krátce po svém spuštění.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/20.jpg"><img class="alignnone size-medium wp-image-5678" src="http://fedora.cz/wp-content/uploads/2015/09/20.jpg" alt="20" width="450" height="450" /></a>
<p><i>Obrázek 20: Pokračování výbuchu.</i></p>

<a href="http://fedora.cz/wp-content/uploads/2015/09/21.jpg"><img class="alignnone size-medium wp-image-5679" src="http://fedora.cz/wp-content/uploads/2015/09/21.jpg" alt="21" width="450" height="450" /></a>
<p><i>Obrázek 21: Pokračování výbuchu.</i></p>



<p><a name="k12"></a></p>
<h2 id="k12">12. Demonstrační příklad číslo 16: výbuch</h2>

<p>Zatímco v&nbsp;patnáctém příkladu byly částice emitovány směrem dolů a vytvářely tak představu ohnivého deště, v&nbsp;příkladu šestnáctém směřuje počáteční vektor pohybu částic směrem nahoru (tj.&nbsp;vlastně proti gravitaci). Tímto způsobem lze vytvořit iluzi výbuchu. Barva částic je proměnná &ndash; od sytě žluté po červenou. Částice taktéž rotují, což celou simulaci dále vylepšuje. Opět se podívejme na zdrojový kód, který se příliš neliší od předchozích příkladů:</p>

<pre>
<i>--</i>
<i>-- Knihovna LÖVE</i>
<i>--</i>
<i>-- Šestnáctý demonstrační příklad</i>
<i>--</i>
<i>-- Použití jednoduchého částicového systému.</i>
<i>--</i>
&nbsp;
&nbsp;
<i>-- rozměry okna, do něhož se bude provádět vykreslování</i>
width = 450
height = 450
&nbsp;
<i>-- asociativní pole představující částicový systém</i>
<strong>local</strong> particleSystem = nil
&nbsp;
<i>-- maximální počet částic v částicovém systému</i>
particleCount = 1000
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná při inicializaci aplikace.</i>
<i>--</i>
<strong>function</strong> love.load()
    <i>-- načtení standardního fontu a nastavení grafického režimu</i>
    <strong>local</strong> font = love.graphics.newFont(love.default_font, 40)
&nbsp;
    <i>-- inicializace grafického režimu</i>
    love.graphics.setMode(width, height, false, false, 0)
&nbsp;
    <i>-- nastavení fontu</i>
    love.graphics.setFont(font)
&nbsp;
    <i>-- načtení obrázku představujícího jednu částici</i>
    <strong>local</strong> particleImage = love.graphics.newImage("particle.png")
&nbsp;
    <i>-- vytvoření částicového systému s jeho inicializací</i>
    particleSystem = love.graphics.newParticleSystem(particleImage, particleCount)
&nbsp;
    <i>-- kolik nových částic se průměrně vygeneruje za sekundu</i>
    particleSystem:setEmissionRate(200)
&nbsp;
    <i>-- životnost emitoru částic i jednotlivých částic vytvářených v emitoru</i>
    particleSystem:setLifetime(-1)
    particleSystem:setParticleLife(3)
&nbsp;
    <i>-- počáteční rychlost částic</i>
    particleSystem:setSpeed(100, 400)
&nbsp;
    <i>-- další parametry systému: gravitace působící na částice, změna barvy apod.</i>
    particleSystem:setGravity(200,500)
    particleSystem:setColors(255, 255, 0, 100, 255, 0, 0, 100)
&nbsp;
    <i>-- pozice emitoru částic, směr generování částic a rozptyl</i>
    particleSystem:setPosition(width/2, height)
    particleSystem:setDirection(-3.14/2)
    particleSystem:setSpread(0.3)
    particleSystem:setSpin(1, 3)
&nbsp;
    <i>-- další parametry systému: gravitace působící na částice</i>
    particleSystem:setGravity(100, 200)
&nbsp;
    <i>-- velikost částic a relativní změna velikosti v čase</i>
    particleSystem:setSizes(3, 0.5)
    particleSystem:stop()
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Funkce volaná cca 30x za sekundu</i>
<i>--</i>
<strong>function</strong> love.update(dt)
    <i>-- přepočítat parametry částicového systému</i>
    particleSystem:update(dt)
&nbsp;
    <strong>local</strong> delay = 1/30
    <strong>if</strong> dt &lt; delay <strong>then</strong>
        love.timer.sleep(delay - dt)
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Tato funkce je volána automaticky při překreslení obsahu</i>
<i>-- okna či obrazovky.</i>
<i>--</i>
<strong>function</strong> love.draw()
    <i>-- režim vykreslování</i>
    love.graphics.setBlendMode("alpha")
&nbsp;
    <i>-- vykreslení částicového systému na obrazovku</i>
    love.graphics.draw(particleSystem, 0, 0)
&nbsp;
    <i>-- zprávy vypsané na obrazovky</i>
    love.graphics.print("Press Enter to start particle emitter.", 30, 415)
    love.graphics.print("Press Escape to exit.", 30, 433)
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- Callback funkce zavolaná při stisku klávesy.</i>
<i>--</i>
<strong>function</strong> love.keypressed(k)
    <i>-- klávesou "Return" či "Enter" se částicový systém zapne</i>
    <strong>if</strong> k == 'return' <strong>then</strong>
        particleSystem:start()
    <strong>end</strong>
    <i>-- klávesou "Escape" se aplikace ukončí</i>
    <strong>if</strong> k == 'escape' <strong>then</strong>
        love.event.quit()
    <strong>end</strong>
<strong>end</strong>
&nbsp;
&nbsp;
&nbsp;
<i>--</i>
<i>-- finito</i>
<i>--</i>
</pre>



<p><a name="k13"></a></p>
<h2 id="k13">13. Repositář se zdrojovými kódy dnešních demonstračních příkladů</h2>

<p>Všech pět demonstračních příkladů, s&nbsp;nimiž jsme se v&nbsp;dnešním
článku seznámili, bylo uloženo do Git repositáře na GitHubu (<a
href="https://github.com/tisnik/presentations">https://github.com/tisnik/presentations</a>).
Každý demonstrační příklad obsahuje jak zdrojový kód <strong>main.lua</strong>,
tak i sprity potřebné pro jeho spuštění:</p>

<table>
<tr><th>#</th><th>Příklad</th><th>Zdrojový kód</th></tr>
<tr><td>1</td><td>example12</td><td><a href="https://github.com/tisnik/presentations/tree/master/love/example12">https://github.com/tisnik/presentations/tree/master/love/example12</a></td></tr>
<tr><td>2</td><td>example13</td><td><a href="https://github.com/tisnik/presentations/tree/master/love/example13">https://github.com/tisnik/presentations/tree/master/love/example13</a></td></tr>
<tr><td>3</td><td>example14</td><td><a href="https://github.com/tisnik/presentations/tree/master/love/example14">https://github.com/tisnik/presentations/tree/master/love/example14</a></td></tr>
<tr><td>4</td><td>example15</td><td><a href="https://github.com/tisnik/presentations/tree/master/love/example15">https://github.com/tisnik/presentations/tree/master/love/example15</a></td></tr>
<tr><td>5</td><td>example16</td><td><a href="https://github.com/tisnik/presentations/tree/master/love/example16">https://github.com/tisnik/presentations/tree/master/love/example16</a></td></tr>
</table>



<p><a name="k14"></a></p>
<h2 id="k14">14. Odkazy na Internetu</h2>

<ol>

<li>Particle Systems From the Ground Up<br />
<a href="http://buildnewgames.com/particle-systems/">http://buildnewgames.com/particle-systems/</a>
</li>

<li>Particle Systems<br />
<a href="http://natureofcode.com/book/chapter-4-particle-systems/">http://natureofcode.com/book/chapter-4-particle-systems/</a>
</li>

<li>Domovská stránka systému LÖVE<br />
<a href="http://love2d.org/">http://love2d.org/</a>
</li>

<li>Dokumentace k&nbsp;systému LÖVE<br />
<a href="http://love2d.org/wiki/love">http://love2d.org/wiki/love</a>
</li>

<li>Domovská stránka programovacího jazyka Lua<br />
<a href="http://www.lua.org/ ">http://www.lua.org/ </a>
</li>

<li>Seriál o programovacím jazyku Lua (root.cz):<br />
<a href="http://www.root.cz/serialy/programovaci-jazyk-lua/">http://www.root.cz/serialy/programovaci-jazyk-lua/</a>
</li>

<li>Domovská stránka systému LÖVE<br />
<a href="http://love2d.org/">http://love2d.org/</a>
</li>

<li>Domovská stránka programovacího jazyka Lua<br />
<a href="http://www.lua.org/ ">http://www.lua.org/ </a>
</li>

<li>Web o Lieru, Gusanos, GeneRally, Atari atd.<br />
<a href="http://karelik.wz.cz/">http://karelik.wz.cz/</a>
</li>

<li>Web o Lieru, Gusanos<br />
<a href="http://karelik.wz.cz/gusanos.php">http://karelik.wz.cz/gusanos.php</a>
</li>

<li>GUSANOS<br />
<a href="http://gusanos.sourceforge.net/">http://gusanos.sourceforge.net/</a>
</li>

<li>GUSANOS Download<br />
<a href="http://sourceforge.net/projects/gusanos/">http://sourceforge.net/projects/gusanos/</a>
</li>

<li>Lua<br />
<a href="http://www.linuxexpres.cz/praxe/lua">http://www.linuxexpres.cz/praxe/lua</a>
</li>

<li>Lua<br />
<a href="http://cs.wikipedia.org/wiki/Lua">http://cs.wikipedia.org/wiki/Lua</a>
</li>

<li>Lua (programming language)<br />
<a href="http://en.wikipedia.org/wiki/Lua_(programming_language)">http://en.wikipedia.org/wiki/Lua_(programming_language)</a>
</li>

<li>The Lua Programming Language<br />
<a href="http://www.tiobe.com/index.php/paperinfo/tpci/Lua.html">http://www.tiobe.com/index.php/paperinfo/tpci/Lua.html</a>
</li>

<li>Lua Programming Gems<br />
<a href="http://www.lua.org/gems/">http://www.lua.org/gems/</a>
</li>

<li>LuaForge<br />
<a href="http://luaforge.net/">http://luaforge.net/</a>
</li>

<li>Forge project tree<br />
<a href="http://luaforge.net/softwaremap/trove_list.php">http://luaforge.net/softwaremap/trove_list.php</a>
</li>

<li>SdlBasic home page<br />
<a href="http://www.sdlbasic.altervista.org/main/">http://www.sdlbasic.altervista.org/main/</a>
</li>

<li>SdlBasic examples<br />
<a href="http://nitrofurano.linuxkafe.com/sdlbasic/">http://nitrofurano.linuxkafe.com/sdlbasic/</a>
</li>

<li>SdlBasic na Wikipedii<br />
<a href="http://en.wikipedia.org/wiki/SdlBasic">http://en.wikipedia.org/wiki/SdlBasic</a>
</li>

<li>Simple DirectMedia Layer<br />
<a href="http://en.wikipedia.org/wiki/Simple_DirectMedia_Layer">http://en.wikipedia.org/wiki/Simple_DirectMedia_Layer</a>
</li>

<li>SDLBASIC &ndash; The high-level interpreter for all?<br />
<a href="http://openbytes.wordpress.com/2008/11/08/sdlbasic-the-high-level-interpreter-for-all/">http://openbytes.wordpress.com/2008/11/08/sdlbasic-the-high-level-interpreter-for-all/</a>
</li>

<li>FreeBasic home page<br />
<a href="http://www.freebasic.net/">http://www.freebasic.net/</a>
</li>

<li>FreeBASIC (Wikipedia EN)<br />
<a href="https://en.wikipedia.org/wiki/FreeBASIC">https://en.wikipedia.org/wiki/FreeBASIC</a>
</li>

<li>FreeBASIC Wiki<br />
<a href="http://www.freebasic.net/wiki/wikka.php?wakka=FBWiki">http://www.freebasic.net/wiki/wikka.php?wakka=FBWiki</a>
</li>

<li>FreeBASIC Manual<br />
<a href="http://www.freebasic.net/wiki/wikka.php?wakka=DocToc">http://www.freebasic.net/wiki/wikka.php?wakka=DocToc</a>
</li>

<li>FreeBASIC (Wikipedia CZ)<br />
<a href="http://cs.wikipedia.org/wiki/FreeBASIC">http://cs.wikipedia.org/wiki/FreeBASIC</a>
</li>

<li>The Griffon Legend<br />
<a href="http://syn9.thingie.net/?table=griffonlegend">http://syn9.thingie.net/?table=griffonlegend</a>
</li>

<li>Seriál Letní škola programovacího jazyka Logo<br />
<a href="http://www.root.cz/serialy/letni-skola-programovaciho-jazyka-logo/">http://www.root.cz/serialy/letni-skola-programovaciho-jazyka-logo/</a>
</li>

<li>Scratch: oficiální stránka projektu<br />
<a href="http://scratch.mit.edu/">http://scratch.mit.edu/</a>
</li>

<li>Scratch: galerie projektů vytvořených ve Scratchi<br />
<a href="http://scratch.mit.edu/galleries/browse/newest">http://scratch.mit.edu/galleries/browse/newest</a>
</li>

<li>Scratch: nápověda<br />
<a href="file:///usr/share/scratch/Help/en/index.html">file:///usr/share/scratch/Help/en/index.html</a>
</li>

<li>Scratch: obrazovky nápovědy<br />
<a href="file:///usr/share/scratch/Help/en/allscreens.html">file:///usr/share/scratch/Help/en/allscreens.html</a>
</li>

<li>Scratch (Wikipedie CZ)<br />
<a href="http://cs.wikipedia.org/wiki/Scratch">http://cs.wikipedia.org/wiki/Scratch</a>
</li>

<li>Scratch (programming language)<br />
<a href="http://en.wikipedia.org/wiki/Scratch_(programming_language)">http://en.wikipedia.org/wiki/Scratch_(programming_language)</a>
</li>

<li>Scratch Modification<br />
<a href="http://wiki.scratch.mit.edu/wiki/Scratch_Modification">http://wiki.scratch.mit.edu/wiki/Scratch_Modification</a>
</li>

<li>Scratch Lowers Resistance to Programming<br />
<a href="http://www.wired.com/gadgetlab/2009/03/scratch-lowers/">http://www.wired.com/gadgetlab/2009/03/scratch-lowers/</a>
</li>

<li>Snap!<br />
<a href="http://snap.berkeley.edu/">http://snap.berkeley.edu/</a>
</li>

<li>Prostředí Snap!<br />
<a href="http://snap.berkeley.edu/snapsource/snap.html">http://snap.berkeley.edu/snapsource/snap.html</a>
</li>

<li>Alternatives to Scratch<br />
<a href="http://wiki.scratch.mit.edu/wiki/Alternatives_to_Scratch">http://wiki.scratch.mit.edu/wiki/Alternatives_to_Scratch</a>
</li>

<li>Basic-256 home page<br />
<a href="http://www.basic256.org/index_en">http://www.basic256.org/index_en</a>
</li>

<li>Basic-256 Language Documentation<br />
<a href="http://doc.basic256.org/doku.php">http://doc.basic256.org/doku.php</a>
</li>

<li>Basic-256 Art Gallery<br />
<a href="http://www.basic256.org/artgallery">http://www.basic256.org/artgallery</a>
</li>

<li>Basic-256 Tutorial<br />
<a href="http://www.basic256.org/tutorials">http://www.basic256.org/tutorials</a>
</li>

<li>Why BASIC?<br />
<a href="http://www.basic256.org/whybasic">http://www.basic256.org/whybasic</a>
</li>

<li>A book to teach ANYBODY how to program a computer (using BASIC)<br />
<a href="http://www.basicbook.org/">http://www.basicbook.org/</a>
</li>

<li>BASIC Computer Games (published 1978) - Hammurabi<br />
<a href="http://atariarchives.org/basicgames/showpage.php?page=78">http://atariarchives.org/basicgames/showpage.php?page=78</a>
</li>

<li>Hamurabi - zdrojový kód v BASICu<br />
<a href="http://www.dunnington.u-net.com/public/basicgames/HMRABI">http://www.dunnington.u-net.com/public/basicgames/HMRABI</a>
</li>

</ol>



<p><a name="k15"></a></p>
<h2 id="k15">15. Literatura, v&nbsp;níž jsou zmíněny částicové systémy</h2>

<ol>

<li>Arvo James (editor):<br />
<i>Graphics Gems II</i>,<br />
Academic Press, 1991, ISBN 0-120-54481-9
</li>

<li>Baraff David and Witkin Andrew: <br />
<i>Physically Based Modeling</i>,<br />
SIGGRAPH Course Notes, July 1998, pages B1&ndash;C12
</li>

<li>Beer and Johnson: <br />
<i>Vector Mechanics for Engineers: Dynamics</i>,<br />
Sixth Edition, WCB/McGraw-Hill, New York, 1997, ISBN 0-07121-828-9
</li>

<li>Beneš B., Felkel P., Sochor J. and Žára J.:<br />
<i>Vizualizace</i><br />
Skripta ČVUT, Praha, 1997
</li>

<li>Benson Richard: <br />
<i>Particle Systems</i>,<br />
PowerPoint Presentation, 2002
</li>

<li>Blinn J. F.:<br />
<i>Light Reflection Functions for Simulation of Clouds and Dusty surfaces</i>,<br />
Computer Graphics 16(3), 1982, pages 21&ndash;29
</li>

<li>Blinn J. F.:<br />
<i>Jim Blin's Corner: Dirty Pixels</i>,<br />
Morgan Kaufmann, 1996, ISBN&nbsp;1-558-60455-3
</li>

<li>Foley J., Dam van A., Feiner S., Hughes J.:<br />
<i>Computer Graphics &ndash; Principles and Practice (Second Edition)</i>,<br />
Addison-Wesley, Reading, Massachusetts, 1990, ISBN 0-201-12110-7
</li>

<li>Hausen Ch.: <br />
<i>Visualization of Vector Fields (2D and 3D)</i>,<br />
tutorial, National Laboratory, Los Alamos, 1993
</li>

<li>Intarrante V. and Grosch Ch.: <br />
<i>Visualizing 3D Flow</i>,<br />
IEEE Computer graphics and Applications, July 1998, pages 49&ndash;53
</li>

<li>Landers, J.:<br />
<i>The Ocean Spray in Your Face</i>,<br />
Game Developer, Volume 5, Number 7, July 1998, pages 13&ndash;15.
</li>

<li>Loke T., Tan D., Seah H. and Er M.:<br />
<i>Rendering Fireworks Displays</i>,<br />
IEEE Computer Graphics &amp; Applications, May 1992, Volume 12, Number 3, pages 33&ndash;43
</li>

<li>Magnetat-Thalmann B., Thalmann D. and Arnaldi B.: <br />
<i>Computer Animation and Simulation 2000</i>,<br />
Springer Verlag, Wien, ISBN 3-2118-3549-0
</li>

<li>Max N., Crawfis R. and Williams D.: <br />
<i>Visualization for climate Modeling</i>,<br />
IEEE Computer graphics and Applications, July 1993, pages 34&ndash;40
</li>

<li>Reeves William T.:<br />
<i>Particle Systems &ndash; A Technique for Modeling a Class of Fuzzy objects</i>,<br />
Computer Graphics vol.17, Number 3, July 1983, pages 359&ndash;376
</li>

<li>Reeves William T. and Blau R.: <br />
<i>Approximate and Probabilistic Algorithms for Shading and Rendering Structured Particle System</i>,<br />
Proceedings of SIGGRAPH 1985, Volume 19(3), 1985, pages 313&ndash;322
</li>

<li>Rhudy R.:<br />
<i>Rendering Particle Systems Fast and Accurately</i>,<br />
(listopad 2002)
</li>

<li>Sims K.: <br />
<i>Particle Animation and Rendering Using Data Parallel Computation</i>,<br />
Computer Graphics (SIGGRAPH '90), Volume 24, Number 4, August 1990, pages 405&ndash;413
</li>

<li>Stalling D. et al.: <br />
<i>Fast Display of Illuminated Field Lines</i>,<br />
IEEE Transactions of Visualization and Computer Graphics, Volume 3, April 1997, pages 118&ndash;127
</li>

<li>Wijk van J.J:<br />
<i>Flow Visualization with Surface Particles</i>,<br />
IEEE Computer Graphics &amp; Applications, July 1993, pages 19&ndash;24
</li>

<li>Wijk van J.J, Hin A. J. S., de Leeuw W. C., Post F. H.:<br />
<i>Three Ways to Show 3D Fluid Flow</i>,<br />
IEEE Computer Graphics \&amp; Applications, September 1994, pages 33&ndash;39
</li>

</ol>



<p></p><p></p>
<p><small>Autor: <a href="http://www.fit.vutbr.cz/~tisnovpa">Pavel Tišnovský</a> &nbsp; 2015</small></p>
</body>
</html>

